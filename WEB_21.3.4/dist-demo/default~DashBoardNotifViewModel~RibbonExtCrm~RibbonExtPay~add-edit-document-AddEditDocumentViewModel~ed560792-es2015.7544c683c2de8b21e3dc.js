(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{"/G+I":function(e,t,s){"use strict";s.r(t),s.d(t,"DocClass",(function(){return c})),s.d(t,"IPrefetchFilter",(function(){return h}));var i=s("Do2H"),o=s("Lp6j"),n=s("vTM8"),a=s("eQJW"),l=s("ScVY"),r=s("dH+5"),D=s("MCLT"),C=s("uMy8"),u=s("USNh");class c{constructor(){this.ParentDocID=0,this.IsInventory=!1,this.IsDebit=!0,this.ShowAccountingData=!0,this.dvCommon=null,this.dvCommonTable=null,this._DocID=0,this.AbsDocID=0}get DocID(){return this._DocID}set DocID(e){this._DocID=e,this.AbsDocID=e<0?-e:e}Clone(){let e=new c;return e.DocID=this.DocID,e.AbsDocID=this.AbsDocID,e.ParentDocID=this.ParentDocID,e.IsInventory=this.IsInventory,e.IsDebit=this.IsDebit,e.dvCommon=this.dvCommon,e}}let h=(()=>{class e extends l.b{constructor(){super(...arguments),this._ShowFilter=!1,this._ShowStaticFilter=!1,this._ShowReport=!1,this._ReportVisibility=!0,this.IsSSRS=!1,this.SSRSVisibility=!1,this.SSRSReportName="",this.ShowRightPanel=!0,this._ShowMasters=!1,this._ShowPrintDesigner=!1,this._ShowOptions=!1,this.Filter=null,this.FieldsDialog=null,this.oReportDialog=null,this.Entities=new n.a,this.BaseReportColumns=[],this.ReportGroups=[],this.FormulaObjects=[],this.StaticReportType=0,this.CostCenterID=0,this.IgnoreTreeLoad=!1,this.DontApplyDateFilter=!1,this.RepeatOn="",this.RepeatStartIndex=-1,this.RepeatNextCols=0,this.RepeatSets=0,this.RepeatEmptyColumns=0,this.RepeatPrevData=0,this.RepeatPrevNextCols=1,this.RepeatType=r.d.None,this.RepeatShowPrevMn=!1,this.RepeatPrevDataFull=!1,this.RepeatPrevDiff=!1,this.RepeatPrevPercent=!1,this.RepeatPrevDataSeperately=!1,this.RepeatPrevDataOfCurrYr=!1,this.PrevDateColumsUsed=!1,this.LevelTreeCostCenterID=0,this.ExQCnt=0,this.LevelColumn=null,this.LevelSubGroup="",this.ReportViewType=r.e.General,this.IsPreProcessQuery=!1,this.IsPreProcessQueryClick=!1,this.IsInventory=!0,this.IsHistory=!1,this.IsRevision=!1,this.iHistoryStatusID=0,this.strHistorySepChar="",this.FileProtection="",this.LinkSubCCID=0,this.LinkSubVoucherNo="",this.IsBudgetFound=!1,this.IsBudgetNewFound=!1,this.IsAuthLevelReport=!1,this.IsNoDataGroups=!1,this.IsSummaryReportType=!1,this.IsKANBAN=!1,this.IsOpeningStockExists=!1,this.IsClosingStockExists=!1,this.IsAvgRateExists=!1,this.ShowUnAppDocsToApprove=!1,this.ShowUnAppDocsToApprove_UseFuncCall=!1,this.ShowMyUnAppDocsToBeApproved=!1,this.UnPostedDocsInclude=!1,this.UnPostedDocsReserveQtyInclude=!1,this.UnPostedDocsHoldQtyInclude=!1,this.IncludeUnPostedDocsReserveQty=!1,this.IncludeUnPostedDocsHoldQty=!1,this.PDCInclude=!1,this.ShowOnlyAccountingData=!1,this.ShowDebitCreditAmount=!1,this.IsNewFromClause=!0,this.IncludeNonAccDocs=null,this.UnPostedDocsList="",this.RowFiltersXML="",this.RowFiltersWhere="",this.dtLWApproval=null,this.sbQuery="",this.sbFinalQuery="",this.DocumentFiltersIDs=new n.a,this.DocumentFiltersText=new n.a,this.DocumentFilters=new n.a,this.SelectTag="",this.DbSelectTag="",this.FromTag="",this.FromTagExtra="",this.WhereTag="",this.OrderByTag="",this.SelectTagAliasOnly="",this.FinalQuery="",this.GroupSelectTag="",this.DbGroupSelectTag="",this.GroupFromTag="",this.GroupSelectTagAlias="",this.SummarySELECT="",this.SummaryGROUPBY="",this.DocumentFields=[135,23144,23145,23146,23147,23148,24500,24501,23149,23826,26583,23831,11364,11365,480020,480021,480022,480023,11375,11490,11405,11505,11516,11426,11683,11643],this.InvDocumentFields=[23150,23822,23823,23824,26250,21356,21357,25523,11371,11372,11373,11374,11383,11384,11403,11404,11484,13964,11491,11514,164,165,166,167,11361,11415,27266,182,11676,11677,11686,11494,11956],this.AccDocumentFields=[23825,23827,23828,23829,23830,11366,11367,11416,11417,205,206,11493],this.IgnoreObjectsForFields=[26648,11396,101,189,11509,11510,11511,11512,11513,26419,26420,50453,11515,11691,11692,170,181,182,209,11377,11378,11379,11380,214],this.ReportParams=new n.a,this.Report=null,this.ParentReport=null,this.ReportViewFrom=null,this.ReportViewFromReorder=null,this.MRPFilter=null,this.MRPII=null,this.BulkEdit=null,this.PrefetchReportTreeFilter=null,this.IncludeLFTColumn=[],this.earningfields=null,this.Vacationfields=null,this.EmpAsonDate=null,this.evalCheck=null,this.fldCheck=null}get ShowFilter(){return this._ShowFilter}set ShowFilter(e){e!=this._ShowFilter&&(e?(this.ShowReport=!1,this.ShowStaticFilter=!1,this.ShowPrintDesigner=!1,this.ShowOptions=!1):null!=this.PrefetchReportTreeFilter&&(this.PrefetchReportTreeFilter.ReportWidth="480",this.PrefetchReportTreeFilter.ReportHeight="430"),this._ShowFilter=e)}get ShowStaticFilter(){return this._ShowStaticFilter}set ShowStaticFilter(e){e!=this._ShowStaticFilter&&(e?(this.ShowFilter=!1,this.ShowReport=!1,this.ShowPrintDesigner=!1,this.ShowOptions=!1):null!=this.PrefetchReportTreeFilter&&(this.PrefetchReportTreeFilter.ReportWidth="480",this.PrefetchReportTreeFilter.ReportHeight="430"),this._ShowStaticFilter=e)}get ShowReport(){return this._ShowReport}set ShowReport(e){e!=this._ShowReport&&(e&&(this.ShowFilter=!1,this.ShowStaticFilter=!1,this.ShowPrintDesigner=!1,this.ShowOptions=!1,this.ShowMasters=!1,this.IsSSRS?(this.ReportVisibility=!1,this.SSRSVisibility=!0,this.ShowRightPanel=!1):this.ReportVisibility=!0,this.Chart&&this.Chart.RefreshChart()),this._ShowReport=e)}get ReportVisibility(){return this._ReportVisibility}set ReportVisibility(e){e!=this._ReportVisibility&&(e&&(this.ShowMasters=!1),this._ReportVisibility=e)}get ShowMasters(){return this._ShowMasters}set ShowMasters(e){e!=this._ShowMasters&&(e&&(this.ReportVisibility=!1),this._ShowMasters=e)}get ShowPrintDesigner(){return this._ShowPrintDesigner}set ShowPrintDesigner(e){}get ShowOptions(){return this._ShowOptions}set ShowOptions(e){e!=this._ShowOptions&&(e&&(this.ShowFilter=!1,this.ShowReport=!1,this.ShowStaticFilter=!1,this.ShowPrintDesigner=!1),this._ShowOptions=e)}static IPrefetchFilter(){e.HistoryTables.push(11375,["INV_DocDetails","ACC_DocDetails","COM_DocCCData","COM_DocNumData","COM_DocTextData"]),e.HistoryTables.push(11490,["INV_DocDetails","ACC_DocDetails","COM_DocCCData","COM_DocNumData","COM_DocTextData"]),e.HistoryTables.push(53517,["REN_Contract","REN_ContractExtended","REN_ContractParticulars","REN_ContractPayTerms"]),e.HistoryTables.push(11418,["ACC_Accounts","ACC_AccountsExtended"]),e.HistoryTables.push(11419,["INV_Product","INV_ProductExtended"]),e.HistoryTables.push(11684,["PRD_BillOfMaterial","PRD_BillOfMaterialExtended","PRD_BOMProducts","PRD_BOMResources","PRD_BOMStages"]),e.HistoryTables.push(191,["ADM_Users"]),e.HistoryTables.push(11701,["COM_Division","COM_CCCCDATA"]),e.HistoryTables.push(11702,["COM_Location","COM_CCCCDATA"]),e.HistoryTables.push(11703,["COM_Branch","COM_CCCCDATA"]),e.HistoryTables.push(11704,["COM_Department","COM_CCCCDATA"]),e.HistoryTables.push(11705,["COM_Salesman","COM_CCCCDATA"]),e.HistoryTables.push(11706,["COM_Category","COM_CCCCDATA"]),e.HistoryTables.push(11707,["COM_Area","COM_CCCCDATA"]),e.HistoryTables.push(11708,["COM_Teritory","COM_CCCCDATA"]);for(let t=9;t<=50;t++)e.HistoryTables.push(11700+t,["COM_CC"+(5e4+t),"COM_CCCCDATA"]);e.HistoryTables.push(11751,["COM_CC50051","COM_CCCCDATA"]),e.HistoryTables.push(12109,["PAY_EmpPay"]),e.HistoryTables.push(11951,["PAY_EmpDetail"]),e.HistoryTables.push(11952,["PAY_EmpDetail"]),e.HistoryTables.push(11953,["PAY_EmpDetail"]),e.HistoryTables.push(11954,["PAY_EmpDetail"]),e.HistoryTables.push(11955,["PAY_EmpDetail"])}SetQueryXMLTags(t=""){let s=0,l=0;this.IsHistory=!1,this.IsAuthLevelReport=!1,this.IsBudgetNewFound=!1,this.IsNoDataGroups=!1,this.LevelColumn=null;let C=null,u="",h="";this.SelectTag=this.FromTag=this.WhereTag=this.OrderByTag=this.SelectTagAliasOnly="",this.GroupSelectTag=this.GroupFromTag=this.GroupSelectTagAlias="",this.SummarySELECT=this.SummaryGROUPBY="",this.Entities=new n.a,this.Objects=[];let I=[];if(this.sbFinalQuery="",this.ReportParams.Clear(),this.fldCheck=null,null!=this.ParentReport&&this.ApplyParentReportFilters(),"ReportViewModel"==this.ClassName&&(this.Report=this,this.Report.SetDatePickers(),this.Report.Preferences.ContainsKey("IsKANBAN")&&(this.IsKANBAN=!0),this.ReportViewType==r.e.ExternalQuery))return void(this.FinalQuery=this.Report.Reportds.Tables[0][0].Query.toString());if(this.FormulaObjects.Clear(),this.BaseReportColumns.forEach(e=>{e.CDGDO.Formula=e.Formula.Text,e.FormulaExpression="",e.ColumnFilterExpression="",e.FormulaErrorMessage="",o.e.IsEmpty(e.Formula.Text)||this.ParseFormula(e,!0),""!=e.FormulaErrorMessage||o.e.IsEmpty(e.Expression.Text)||this.ParseFormula(e,!1),11406==e.CDGDO.FieldValue||11408==e.CDGDO.FieldValue||e.CDGDO.FieldValue>=11485&&e.CDGDO.FieldValue<=11489?this.IsBudgetNewFound=!0:181==e.CDGDO.FieldValue&&(e.CDGDO.Formula=e.FormulaEvaluateAtEnd.SelectedValue)}),this.ReportGroups.forEach(e=>{e.CDGDO.Formula=e.Formula.Text,e.FormulaExpression="",e.ColumnFilterExpression="",e.FormulaErrorMessage="",o.e.IsEmpty(e.Formula.Text)||this.ParseFormula(e,!0)}),0!=this.StaticReportType&&110!=this.StaticReportType&&144!=this.StaticReportType){try{-1==this.StaticReportType?this.SetQueryXMLTagsForQueryReports():this.SetQueryXMLTagsForStaticReports()}catch(g){Logger.ErrorLog("SetQueryXMLTagsForStaticReports/SetQueryXMLTagsForQueryReports :: "+g.stack)}return}if(0==this.StaticReportType&&this.IsPreProcessQuery&&!this.IsPreProcessQueryClick)return void this.SetQueryXMLTagsForPreProcessQuery();let d,T=[];for(this.BaseReportColumns.forEach(e=>{0==e.CDGDO.FieldValue||!o.e.IsEmpty(e.Formula.Text)&&188!=e.CDGDO.FieldValue&&"$TOTALHOURS$"!=e.Formula.Text||T.push(e.CDGDO)}),this.ReportGroups.forEach(e=>{o.e.IsEmpty(e.Formula.Text)&&T.push(e.CDGDO)}),T.AddRange(this.FormulaObjects),this.Filter.Fields.forEach(e=>{T.push(e.CDGDO)}),this.earningfields=T.filter(e=>(50051==e.CategoryValue||e.CategoryValue>=40051&&e.CategoryValue<=40099&&40064!=e.CategoryValue)&&(405==e.ColumnCostCenterID||406==e.ColumnCostCenterID||410==e.ColumnCostCenterID)),this.earningfields.length>0&&this.earningfields.forEach(e=>{T.Remove(e)}),this.Vacationfields=T.filter(e=>50051==e.CategoryValue&&411==e.ColumnCostCenterID),this.Vacationfields.length>0&&this.Vacationfields.forEach(e=>{T.Remove(e)}),this.EmpAsonDate=T.filter(e=>50051==e.CategoryValue&&-601==e.FieldValue),this.EmpAsonDate.length>0&&this.EmpAsonDate.forEach(e=>{T.Remove(e)}),T.find(e=>400==e.CategoryValue&&(205==e.FieldValue||206==e.FieldValue||207==e.FieldValue))&&(this.ShowOnlyAccountingData=!0,this.ShowDebitCreditAmount=!0),d=0;d<T.length;d++)if(Math.abs(T[d].CategoryValue)>4e4&&Math.abs(T[d].CategoryValue)<5e4){let e=this.FieldsDialog.DocumentTypes.filter(e=>e.CostCenterID==Math.abs(T[d].CategoryValue));e.length>0&&(this.IsInventory=Object(a.j)(e[0].IsInventory));let t="";if(0==I.filter(e=>e.DocID==T[d].CategoryValue).length)if(T[d].CategoryValue>0){let e=new c;e.DocID=T[d].CategoryValue,e.IsInventory=this.IsInventory,I.push(e)}else t="DocumentType=@DType",o.e.IsEmpty(T[d].ALLOtherDocuments)||(t="("+t+" or CostCenterID IN ("+T[d].ALLOtherDocuments.Replace("~1","")+"))");else o.e.IsEmpty(T[d].ALLOtherDocuments)||(t="",T[d].ALLOtherDocuments.Replace("~1","").split(",").forEach(e=>{null==I.find(t=>t.DocID==-parseInt(e))&&(t.length>0&&(t+=","),t+=e)}),t.length>0&&(t=" CostCenterID IN ("+t+")"));if(t.length>0){let e=i.a.report.DataSet("RPT032",Math.abs(T[d].CategoryValue).toString(),t);e.Tables[1].forEach(e=>{if(e.cType){let t=parseInt(e.cType);2==t?e.SysColumnName=e.SysColumnName.toString().Replace("dcNum","dcCalcNum"):3==t&&(e.SysColumnName=e.SysColumnName.toString().Replace("dcNum","dcCalcNumFC"))}}),e.Tables[0].forEach(t=>{let s=parseInt(t.CostCenterID);if(!I.find(e=>e.DocID==s)){let t=new c;t.DocID=s,t.IsInventory=this.IsInventory,t.ParentDocID=T[d].CategoryValue,I.push(t),s!=T[d].CategoryValue&&(I[I.length-1].dvCommonTable=e.Tables[1])}})}}for(let e=0;e<this.Filter.CostCenterFilters.length;e++){let t=this.Filter.CostCenterFilters[e];if(300==t.CostCenterID){if(I.filter(e=>e.DocID<-4e4).length>0&&t.SelectedNodes.length>0)for(let e=I.length-1;e>=0;e--)Math.abs(I[e].DocID)>4e4&&Math.abs(I[e].DocID)<5e4&&0==t.SelectedNodes.filter(t=>t.Id==Math.abs(I[e].DocID)).length&&I.RemoveAt(e);t.SelectedNodes.forEach(e=>{let t=this.FieldsDialog.DocumentTypes.filter(t=>t.CostCenterID==e.Id);if(t.length>0&&(this.IsInventory=Object(a.j)(t[0].IsInventory),0==I.filter(t=>Math.abs(t.DocID)==e.Id).length)){let t=new c;t.DocID=e.Id,t.IsInventory=this.IsInventory,I.push(t)}})}}if(this.ReportViewType==r.e.TransactionQuery||this.ReportViewType==r.e.LinkingQuery)if("LINKED_SUB_VOUCHERS"==t){this.IsInventory=!0,I.Clear();let e=new c;e.DocID=this.LinkSubCCID,e.IsInventory=this.IsInventory,I.push(e)}else if(null!=this.TQDocumentType&&this.TQDocumentType.SelectedValue>0&&(""==t||"LINKED_VOUCHERS"==t)){let e=this.FieldsDialog.DocumentTypes.filter(e=>e.CostCenterID==this.TQDocumentType.SelectedValue);e.length>0&&(this.IsInventory=Object(a.j)(e[0].IsInventory)),I.Clear();let t=new c;t.DocID=this.TQDocumentType.SelectedValue,t.IsInventory=this.IsInventory,I.push(t)}if(this.ShowOnlyAccountingData&&null!=this.IncludeNonAccDocs)for(let e=I.length-1;e>=0;e--)this.IncludeNonAccDocs.Contains(I[e].DocID.toString())&&I.Remove(I[e]);if(0==I.length)if(this.ShowOnlyAccountingData){let e=new c;e.DocID=-2,e.IsInventory=!1,I.push(e),e=new c,e.DocID=-1,e.IsInventory=!0,I.push(e)}else{if(T.filter(e=>400==e.CategoryValue&&this.InvDocumentFields.Contains(e.FieldValue)).length>0){let e=new c;e.DocID=-1,e.IsInventory=!0,I.push(e)}if(T.filter(e=>400==e.CategoryValue&&this.AccDocumentFields.Contains(e.FieldValue)).length>0){let e=new c;e.DocID=-2,e.IsInventory=!1,I.push(e)}if(T.filter(e=>!this.IgnoreObjectsForFields.Contains(e.FieldValue)&&e.CategoryValue>=400&&e.CategoryValue<=408&&210!=e.FieldValue&&0==I.length).length>0){let e=new c;e.DocID=-1,e.IsInventory=!0,I.push(e),e=new c,e.DocID=-2,e.IsInventory=!1,I.push(e)}if(0==I.length){let e=new c;e.DocID=0,e.IsInventory=!0,I.push(e)}}for(this.ShowOnlyAccountingData&&null!=this.IncludeNonAccDocs&&this.IncludeNonAccDocs.forEach(e=>{let t=new c;t.DocID=parseInt(e),t.IsInventory=!0,t.ShowAccountingData=!1,I.push(t)}),d=0;d<I.length;d++)for(let e=d+1;e<I.length;e++)Math.abs(I[d].DocID)==Math.abs(I[e].DocID)&&(0!=I[e].ParentDocID&&(I[d].DocID=I[e].DocID,I[d].dvCommon=I[e].dvCommon,I[d].dvCommonTable=I[e].dvCommonTable,I[d].ParentDocID=I[e].ParentDocID),I.RemoveAt(e),e--);if(this.ShowDebitCreditAmount)for(d=I.length-1;d>=0;d--)if(I[d].ShowAccountingData){let e=I[d].Clone();e.IsDebit=!1,I.push(e)}this.IsBudgetNewFound&&(l=o.e.Int(this.Filter.Budget.SelectedValue),C=i.a.report.DataSet("RPT033",l.toString()));try{let n="",c="",g=this.Filter.CostCenterFilters.find(e=>-100==e.CostCenterID);if(g&&g.SelectedNodes.length>0){let e="";for(let i=0;i<g.SelectedNodes.length;i++)i>0&&(e+=","),e+=g.SelectedNodes[i].Id;let t=i.a.report.ReportDataTable("RPT034",null!=this.Report&&this.Report.IsReportDB,e);if(Object(D.isNullOrUndefined)(t[0].Job))return void(this.FinalQuery="select 1 where 1!=1");let s=parseInt(t[0].Job);n=t[0].LinkDimension.toString(),s>0&&n.length>0?c="CREATE TABLE #TblJobDim(NodeID BIGINT)\nDECLARE @SQL NVARCHAR(MAX)\nset @SQL='insert into #TblJobDim\nselect "+n+"\nfrom inv_docdetails i with(nolock)\ninner join (select InvDocDetailsID from inv_docdetails with(nolock) where DocID IN ("+e.toString()+")) AS B on i.LinkedInvDocDetailsID=B.InvDocDetailsID\ninner join com_docccdata dcc with(nolock) on dcc.InvDocDetailsID=i.InvDocDetailsID \ngroup by "+n+"'\nEXEC(@SQL)\n":g=null}let F="";if(this.ShowUnAppDocsToApprove){let e=i.a.report.GetReportData(9,this.ShowUnAppDocsToApprove_UseFuncCall?0:1,'<XML UID="'+i.a.SessionManager.UserID+'" ShowMyQueue="'+(this.ShowMyUnAppDocsToBeApproved?"1":"0")+'"></XML>');F=o.e.String(e.Tables[0][0].Qry)}else if(this.ShowMyUnAppDocsToBeApproved){let e=i.a.report.GetReportData(10,this.ShowUnAppDocsToApprove_UseFuncCall?0:1,i.a.SessionManager.UserID.toString());F=o.e.String(e.Tables[0][0].Qry)}this.Filter.IsReportViewScreen&&this.Report.Preferences.ContainsKey("FromOldCode")&&(this.IsNewFromClause=!1);for(let D=0;D<I.length;D++){let c=I[D],S=null;this.IsInventory=c.IsInventory,this.SelectTag=this.FromTag=this.FromTagExtra=this.WhereTag=this.OrderByTag=this.SelectTagAliasOnly="",u="",h="",this.ExQCnt=0;let O=[];for(d=0;d<T.length;d++)this.IgnoreObject(c,T[d])||(Math.abs(T[d].CategoryValue)>4e4&&Math.abs(T[d].CategoryValue)<5e4?Math.abs(T[d].CategoryValue)!=Math.abs(c.DocID)&&T[d].CategoryValue!=c.ParentDocID||O.push(T[d]):400==T[d].CategoryValue?this.IsInventory&&!this.AccDocumentFields.Contains(T[d].FieldValue)?(O.push(T[d]),this.DocumentFields.Contains(T[d].FieldValue)&&(T[d].IsForeignKey?T[d].ParentTable="INV_DocDetails":T[d].Table="INV_DocDetails")):this.IsInventory||this.InvDocumentFields.Contains(T[d].FieldValue)||(O.push(T[d]),this.DocumentFields.Contains(T[d].FieldValue)&&(T[d].IsForeignKey?T[d].ParentTable="ACC_DocDetails":T[d].Table="ACC_DocDetails")):101==T[d].CategoryValue?""==T[d].Column||O.push(T[d]):144==T[d].CategoryValue&&65==T[d].ParentCostCenterID||O.push(T[d]));this.Entities.Clear(),this.Objects.Clear();for(let t=0;t<O.length;t++){let s=O[t];if("Shipping_Address"!=s.Table&&"Billing_Address"!=s.Table)if(this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(e=>e.FeatureID==(s.IsForeignKey?s.ParentCostCenterID:s.CategoryValue)),s.CategoryValue>=400&&s.CategoryValue<=408&&!s.IsForeignKey&&(this.drrCCTbl[0].TableName=this.IsInventory?"INV_DocDetails":"ACC_DocDetails"),this.ShowDebitCreditAmount&&c.ShowAccountingData&&207==s.FieldValue&&2==s.ParentCostCenterID&&(s.ParentColumn=c.IsDebit?"DebitAccount":"CreditAccount"),!this.Entities.ContainsKey(s.CategoryText)||null!=s.ChildCDGDO&&!this.Entities.ContainsKey(s.ChildCDGDO.CategoryText)){if(this.drrCCTbl.length>0){if(null!=s.ChildCDGDO){if(s.ChildCDGDO.ColumnCostCenterID>0&&s.ChildCDGDO.ParentTableAlias.Contains("_CCMAP")&&!this.Entities.ContainsKey(s.ChildCDGDO.ParentTableAlias)){let e,t;this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(e=>e.FeatureID==s.ChildCDGDO.CategoryValue),e=this.drrCCTbl[0].PK.toString(),t=this.drrCCTbl[0].TableName.toString(),400!=s.CategoryValue||this.IsInventory||"inv_docdetails"!=t.toLowerCase()||(e="AccDocDetailsID",t="ACC_DocDetails");let i=s.ChildCDGDO.CategoryText.substr(0,s.ChildCDGDO.CategoryText.lastIndexOf("."));if(i.Contains(".")&&!this.Entities.ContainsKey(i)){let e=s.CloneObject();e.ChildCDGDO=null,e.ParentCDGDO=null;let t=this.FieldsDialog.FilterView.filter(e=>e.CostCenterColID==s.FieldValue);e.Table=t[0].SysTableName.toString(),e.Column=t[0].SysColumnName.toString(),e.FieldText=t[0].UserColumnName.toString(),e.DataType=t[0].ColumnDataType.toString(),e.ParentCCDefaultColID=parseInt(t[0].ParentCCDefaultColID),t=this.FieldsDialog.FilterView.filter(t=>t.CostCenterColID==e.ParentCCDefaultColID),e.Table=t[0].SysTableName.toString(),e.Column=t[0].SysColumnName.toString(),this.Objects.push(e),this.Entities.push(e.CategoryText,"")}let o=s.ChildCDGDO.CloneObject();o.ColumnCostCenterID=0,o.ParentTableAlias=o.ParentTableAlias.Replace("_CCMAP",""),o.Table=o.ParentTable,o.ParentCostCenterColSysName="NodeID",o.ParentTable=t,o.ParentColumn=e,this.Objects.push(o),this.Entities.push(s.ChildCDGDO.ParentTableAlias,""),this.Objects.push(s.ChildCDGDO),this.Entities.push(s.ChildCDGDO.CategoryText,"")}else this.Entities.ContainsKey(s.CategoryText)||(this.Objects.push(s),this.Entities.push(s.CategoryText,"")),null==s.ChildCDGDO||144==s.ChildCDGDO.CategoryValue&&65==s.ChildCDGDO.ParentCostCenterID||this.Entities.ContainsKey(s.ChildCDGDO.CategoryText)||(this.Objects.push(s.ChildCDGDO),this.Entities.push(s.ChildCDGDO.CategoryText,""));continue}if(o.e.StringValue(this.drrCCTbl[0].TableName).toString()!=s.Table){let e=s.CloneObject();e.ParentCDGDO=null,e.Table=o.e.StringValue(this.drrCCTbl[0].TableName).toString(),this.Objects.push(e),this.Entities.push(s.CategoryText,""),s.ParentCDGDO=e,this.Objects.push(s),this.Entities.push(s.CategoryText+s.Table,"");continue}}if(s.ColumnCostCenterID>0&&null!=s.ParentTableAlias&&s.ParentTableAlias.Contains("_CCMAP")&&!this.Entities.ContainsKey(s.ParentTableAlias)){let e,t;this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(e=>e.FeatureID==s.CategoryValue),400!=s.CategoryValue||this.IsInventory?(e=this.drrCCTbl[0].PK.toString(),t=o.e.StringValue(this.drrCCTbl[0].TableName).toString()):(e="AccDocDetailsID",t="ACC_DocDetails");let i=s.CloneObject();if(i.ColumnCostCenterID=0,i.ParentTableAlias=i.ParentTableAlias.Replace("_CCMAP",""),i.Table=i.ParentTable,i.ParentCostCenterColSysName=400==s.CategoryValue||Math.abs(s.CategoryValue)>=40001&&Math.abs(s.CategoryValue)<5e4?e:"NodeID",i.ParentTable=t,i.ParentColumn=e,!this.Entities.ContainsKey(i.ParentTableAlias)){let e=i.CloneObject();e.Table=t,e.ColumnCostCenterID=0,e.CategoryText=i.ParentTableAlias,e.IsForeignKey=!1,this.Objects.push(e),this.Entities.push(i.ParentTableAlias,"")}this.Objects.push(i),this.Entities.push(s.ParentTableAlias,"")}else if(s.IsForeignKey&&!this.Entities.ContainsKey(s.ParentTableAlias)){let t=s.CloneObject();if(400==s.CategoryValue||Math.abs(s.CategoryValue)>=40001&&Math.abs(s.CategoryValue)<5e4)this.Entities.length>0&&210==s.FieldValue||(t.Table=this.IsInventory?"INV_DocDetails":"ACC_DocDetails",t.ColumnCostCenterID=0,t.CategoryText=s.ParentTableAlias,t.IsForeignKey=!1,this.Objects.push(t),this.Entities.push(s.ParentTableAlias,""));else if(e.ForeignMAPTables.Contains(s.Table.toUpperCase())){this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(e=>e.FeatureID==s.CategoryValue),t.Table=t.ParentTable;let e=s.CategoryText.substr(0,s.CategoryText.lastIndexOf("."));t.CategoryText=e,0!=o.e.stringCompare(t.Table,this.drrCCTbl[0].TableName.toString(),!0)&&(t.ParentCDGDO=this.Objects[this.Entities.keys.indexOf(e)]),t.ColumnCostCenterID=0,t.IsForeignKey=!1,this.Objects.push(t),this.Entities.push(s.ParentTableAlias,"")}else if("CRM_ProductMapping"==s.ParentTable){let e=s.CloneObject();e.ColumnCostCenterID=0,e.Table=e.ParentTable,e.ParentTableAlias=e.ParentTableAlias.Replace("CRM_ProductMapping",""),e.ParentCostCenterColSysName="CCNodeID",89==e.CategoryValue?(e.ParentTable="CRM_Opportunities",e.ParentColumn="OpportunityID"):(e.ParentTable="CRM_Leads",e.ParentColumn="LeadID"),this.Objects.push(e),this.Entities.push(s.ParentTableAlias,"")}else if("REN_QuotationParticulars"==s.ParentTable){let e=s.CloneObject();e.ColumnCostCenterID=0,e.Table=e.ParentTable,e.ParentTableAlias=e.ParentTableAlias.Replace("REN_QuotationParticulars",""),e.ParentCostCenterColSysName="CCNodeID",129==e.CategoryValue&&(e.ParentTable="REN_Quotation",e.ParentColumn="QuotationID"),this.Objects.push(e),this.Entities.push(s.ParentTableAlias,"")}else t.Table=s.ParentTable,t.ColumnCostCenterID=0,t.CategoryText=s.ParentTableAlias,t.IsForeignKey=!1,this.Objects.push(t),this.Entities.push(s.ParentTableAlias,"")}if(this.Objects.push(s),this.Entities.push(s.CategoryText,""),(64==s.ParentCCDefaultColID||65==s.ParentCCDefaultColID)&&!this.Entities.ContainsKey(s.CategoryText+"_MAXMIN")){let e=s.CloneObject();e.DimensionsFilter="MAXMIN",this.Objects.push(e),this.Entities.push(e.CategoryText+"_MAXMIN","")}}else{if(null!=s.ChildCDGDO&&this.Entities.ContainsKey(s.ChildCDGDO.CategoryText))continue;if(this.drrCCTbl.length>0)if(o.e.StringValue(this.drrCCTbl[0].TableName).toString()!=s.Table)s.ParentCDGDO=this.Objects[this.Entities.keys.indexOf(s.CategoryText)],this.Entities.ContainsKey(s.CategoryText+s.Table)||(this.Objects.push(s),this.Entities.push(s.CategoryText+s.Table,""));else if(64==s.ParentCCDefaultColID||65==s.ParentCCDefaultColID)this.Entities.ContainsKey(s.CategoryText+"_MAXMIN")||(this.Objects.push(s),s.DimensionsFilter="MAXMIN",this.Entities.push(s.CategoryText+"_MAXMIN",""));else if(599==s.FieldValue){let e="Product";if(s.ParentTableAlias=e,s.Column="BOMName",s.Table="PRD_BillOfMaterial",0!=o.e.stringCompare(s.Table,this.FieldsDialog.CostCenterTables[0].TableName.toString(),!0)){let t=this.Entities.Keys.IndexOf(e);-1!=t&&(s.ParentCDGDO=this.Objects[t])}s.ColumnCostCenterID=76,s.IsForeignKey=!1,this.Objects.push(s),this.Entities.ContainsKey("BOM")||this.Entities.push("BOM",""),s.CategoryText=e}}}for(let e=0;e<this.Objects.length;e++){let t=this.Entities.keys[e];if(Math.abs(this.Objects[e].CategoryValue)>4e4&&Math.abs(this.Objects[e].CategoryValue)<5e4||this.Objects[e].CategoryValue>=401&&this.Objects[e].CategoryValue<=408){let s=this.FieldsDialog.DocumentTypes.filter(t=>t.CostCenterID==this.Objects[e].CategoryValue);if(s.length>0&&(this.IsInventory=Object(a.j)(s[0].IsInventory)),this.Objects[e].IsForeignKey)t.endsWith("_CCMAP")&&"COM_DOCCCDATA"==this.Objects[e].Table.toUpperCase()?this.Entities.SetValue(t,"TDCC"):this.Entities.SetValue(t,"T"+e);else if(0==o.e.stringCompare(o.e.StringValue(this.Objects[e].Table),"COM_DocNumData",!0)){for(d=0;d<e;d++)if(this.Entities.keys[d].endsWith("COM_DocNumData")){this.Entities.SetValue(t,this.Entities.values[d]);break}d==e&&this.Entities.SetValue(t,"T"+e)}else if(0==o.e.stringCompare(o.e.StringValue(this.Objects[e].Table),"PAY_DocNumData",!0)){for(d=0;d<e;d++)if(this.Entities.keys[d].endsWith("PAY_DocNumData")){this.Entities.SetValue(t,this.Entities.values[d]);break}d==e&&this.Entities.SetValue(t,"T"+e)}else if(0==o.e.stringCompare(o.e.StringValue(this.Objects[e].Table),"COM_DocTextData",!0)){for(d=0;d<e;d++)if(this.Entities.keys[d].endsWith("COM_DocTextData")){this.Entities.SetValue(t,this.Entities.values[d]);break}d==e&&this.Entities.SetValue(t,"T"+e)}else this.IsInventory?0==o.e.stringCompare(o.e.StringValue(this.Objects[e].Table),"INV_DOCDETAILS",!0)?this.Entities.SetValue(t,"INV"):this.Entities.SetValue(t,"T"+e):0==o.e.stringCompare(o.e.StringValue(this.Objects[e].Table),"ACC_DOCDETAILS",!0)?this.Entities.SetValue(t,"ACC"):this.Entities.SetValue(t,"T"+e)}else 400==this.Objects[e].CategoryValue?this.Objects[e].IsForeignKey?t.endsWith("_CCMAP")&&"COM_DOCCCDATA"==this.Objects[e].Table.toUpperCase()?this.Entities.SetValue(t,"TDCC"):this.Entities.SetValue(t,"T"+e):this.IsInventory?(this.Objects[e].Table="INV_DocDetails",this.Entities.SetValue(t,"INV")):(this.Objects[e].Table="ACC_DocDetails",this.Entities.SetValue(t,"ACC")):this.Entities.SetValue(t,"T"+e)}if(Math.abs(c.DocID)>4e4&&Math.abs(c.DocID)<5e4&&(h=this.IsInventory?"INV.CostCenterID="+Math.abs(c.DocID):"ACC.CostCenterID="+Math.abs(c.DocID)),"LINKED_VOUCHERS"==t)this.SelectTag="DISTINCT INV.DocID,INV.CostCenterID,VoucherNo";else{this.sbQuery="",s=0;for(let t=0;t<this.BaseReportColumns.length;t++){let e=this.BaseReportColumns[t];if(!o.e.IsEmpty(e.FormulaExpression)&&0!=o.e.stringCompare(e.Formula.Text,"LATEST",!0)&&0!=o.e.stringCompare(e.Formula.Text,"OLDEST",!0)&&0!=o.e.stringCompare(e.Formula.Text,"$TOTALHOURS$",!0)&&"H"!=e.Formula.Text)continue;if(0==e.CDGDO.FieldValue)continue;if(!o.e.IsEmpty(e.PrevRowValue.SelectedValue))continue;if(this.earningfields.length>0&&this.earningfields.find(t=>t==e.CDGDO))continue;if(this.Vacationfields.length>0&&null!=this.Vacationfields.find(t=>t==e.CDGDO))continue;if(this.EmpAsonDate.length>0&&null!=this.EmpAsonDate.find(t=>t==e.CDGDO))continue;if(s>0&&(this.sbQuery+=","),this.SetActualColumn(e.CDGDO,c,e),11515==e.CDGDO.FieldValue)o.e.IsEmpty(e.CDGDO.ActualTable)&&(e.CDGDO.ActualTable=this.IsInventory?"INV":"ACC"),this.sbQuery+="stuff((select ','+[GUID]+'.'+FileExtension from COM_Files WITH(NOLOCK) WHERE FeatureID="+e.CDGDO.ActualTable+".CostCenterID AND FeaturePK="+e.CDGDO.ActualTable+".DocID FOR XML PATH('')),1,1,'') "+e.ID+"_ID,",e.CDGDO.ActualColumn="stuff((select ', '+ActualFileName from COM_Files WITH(NOLOCK) WHERE FeatureID="+e.CDGDO.ActualTable+".CostCenterID AND FeaturePK="+e.CDGDO.ActualTable+".DocID FOR XML PATH('')),1,2,'')";else if(e.CDGDO.FieldValue>=11678&&e.CDGDO.FieldValue<=11682)this.sbQuery+="stuff((select ','+[GUID]+'.'+FileExtension from COM_Files WITH(NOLOCK) WHERE FeatureID="+e.CDGDO.CategoryValue+" AND FeaturePK="+e.CDGDO.ActualTable+".NodeID FOR XML PATH('')),1,1,'') "+e.ID+"_ID,",e.CDGDO.ActualColumn="stuff((select ', '+ActualFileName from COM_Files WITH(NOLOCK) WHERE FeatureID="+e.CDGDO.CategoryValue+" AND FeaturePK="+e.CDGDO.ActualTable+".NodeID FOR XML PATH('')),1,2,'')";else if(27291==e.CDGDO.FieldValue||27291==e.CDGDO.ParentCCDefaultColID)this.sbQuery+="stuff((select ','+[GUID]+'.'+FileExtension from COM_Files WITH(NOLOCK) WHERE FeatureID=3 AND FeaturePK="+e.CDGDO.ActualTable+".ProductID FOR XML PATH('')),1,1,'') "+e.ID+"_ID,",e.CDGDO.ActualColumn="stuff((select ', '+ActualFileName from COM_Files WITH(NOLOCK) WHERE FeatureID=3 AND FeaturePK="+e.CDGDO.ActualTable+".ProductID FOR XML PATH('')),1,2,'')";else if(27290==e.CDGDO.FieldValue||27290==e.CDGDO.ParentCCDefaultColID)this.sbQuery+="stuff((select ','+[GUID]+'.'+FileExtension from COM_Files WITH(NOLOCK) WHERE FeatureID=2 AND FeaturePK="+e.CDGDO.ActualTable+".AccountID FOR XML PATH('')),1,1,'') "+e.ID+"_ID,",e.CDGDO.ActualColumn="stuff((select ', '+ActualFileName from COM_Files WITH(NOLOCK) WHERE FeatureID=2 AND FeaturePK="+e.CDGDO.ActualTable+".AccountID FOR XML PATH('')),1,2,'')";else if(e.CDGDO.FieldValue>=11801&&e.CDGDO.FieldValue<=11850||e.CDGDO.ParentCCDefaultColID>=11801&&e.CDGDO.ParentCCDefaultColID<=11850){let t;t=e.CDGDO.FieldValue>=11801&&e.CDGDO.FieldValue<=11850?e.CDGDO.CategoryValue:e.CDGDO.ParentCostCenterID,this.sbQuery+="stuff((select ','+[GUID]+'.'+FileExtension from COM_Files WITH(NOLOCK) WHERE FeatureID="+t+" AND FeaturePK="+e.CDGDO.ActualTable+".NodeID FOR XML PATH('')),1,1,'') "+e.ID+"_ID,",e.CDGDO.ActualColumn="stuff((select ', '+ActualFileName from COM_Files WITH(NOLOCK) WHERE FeatureID="+t+" AND FeaturePK="+e.CDGDO.ActualTable+".NodeID FOR XML PATH('')),1,2,'')"}else 50051==e.CDGDO.CategoryValue&&"Attachments"==e.CDGDO.Column?(this.sbQuery+="stuff((select ','+[GUID]+'.'+FileExtension from COM_Files WITH(NOLOCK) WHERE FeatureID=50051 AND FeaturePK="+e.CDGDO.ActualTable+".NodeId FOR XML PATH('')),1,1,'') "+e.ID+"_ID,",e.CDGDO.ActualColumn="stuff((select ', '+ActualFileName from COM_Files WITH(NOLOCK) WHERE FeatureID=50051 AND FeaturePK="+e.CDGDO.ActualTable+".NodeId FOR XML PATH('')),1,2,'')"):50051==e.CDGDO.CategoryValue&&"ServiceDays"==e.CDGDO.Column?(this.sbQuery+="(Select ISNULL((DATEDIFF(day,CONVERT(DATETIME,DOJ),GETDATE())+1),0) From COM_CC50051 WITH(NOLOCK) WHERE NodeID="+e.CDGDO.ActualTable+".NodeId ) "+e.ID+"_ID,",e.CDGDO.ActualColumn="(Select ISNULL((DATEDIFF(day,CONVERT(DATETIME,DOJ),GETDATE())+1),0) From COM_CC50051 WITH(NOLOCK) WHERE NodeID="+e.CDGDO.ActualTable+".NodeId )"):11691==e.CDGDO.FieldValue?(o.e.IsEmpty(e.CDGDO.ActualTable)&&(e.CDGDO.ActualTable=this.IsInventory?"INV":"ACC"),this.sbQuery+="convert(nvarchar,"+e.CDGDO.ActualTable+".CostCenterID)+'~'+convert(nvarchar,"+e.CDGDO.ActualTable+".DocID)"+e.ID+"_ID,",e.CDGDO.ActualColumn="'Activity'"):113==e.CDGDO.ParentCostCenterID&&"Status"==e.CDGDO.Column&&!this.IsInventory&&this.Report.Preferences.ContainsKey("ReplaceStatus")?e.CDGDO.ActualColumn="case when ACC.StatusID=429 then case when ACC.BillDate=1 then 'Replace' when ACC.BillDate=1 then 'Partial Replace' else 'Bounced' end else "+e.CDGDO.ActualColumn+" end":599==e.CDGDO.FieldValue&&(e.CDGDO.ActualColumn="BOMName");let i=e.CDGDO.ActualColumn;if("DATE"==e.CDGDO.DataType&&("MMM-yy"==e.DateType.Text&&this.ReportGroups.find(t=>t.ID==e.ID)?i="dateadd(day,1-datepart(day,"+i+"),"+i+")":"yyyy"==e.DateType.Text&&this.ReportGroups.find(t=>t.ID==e.ID)&&(i="convert(datetime,'01-01-'+convert(nvarchar,year("+i+")))")),this.sbQuery+=i,0==this.sbFinalQuery.length&&(this.IsSummaryReportType&&(this.SummarySELECT.length>0&&(this.SummarySELECT+=","),"FLOAT"==e.CDGDO.DataType?this.SummarySELECT+="sum("+e.ID+") AS "+e.ID:(this.SummarySELECT+=e.ID,this.SummaryGROUPBY.length>0&&(this.SummaryGROUPBY+=","),this.SummaryGROUPBY+=e.ID)),this.sbQuery+=" ["+e.ID+"]"),this.IncludeLFTColumn.Contains(e.ID)){let t=e.CDGDO.ActualColumn.lastIndexOf(".");this.sbQuery+=t>0?","+e.CDGDO.ActualColumn.substr(0,t+1)+"lft":",null",0==this.sbFinalQuery.length&&(this.sbQuery+=" ["+e.ID+"lft_CF]")}if(e.Sort.SelectedValue.startsWith("NUM"))this.sbQuery+=",CASE WHEN isnumeric("+e.CDGDO.ActualColumn+")=1 THEN CONVERT(FLOAT,"+e.CDGDO.ActualColumn+") ELSE 0 END AS ["+e.ID+"SORT]";else if(e.Sort.SelectedValue.startsWith("TREE")){let t=e.CDGDO.ActualColumn.lastIndexOf(".");t>0&&(this.sbQuery+=","+e.CDGDO.ActualColumn.substr(0,t+1)+"lft AS ["+e.ID+"SORT]")}else"VoucherNo"==e.CDGDO.Column&&0==e.CDGDO.IsForeignKey&&(400==e.CDGDO.CategoryValue||Math.abs(e.CDGDO.CategoryValue)>4e4&&Math.abs(e.CDGDO.CategoryValue)<5e4)&&(""!=e.Sort.SelectedValue||"1"==e.ShowAsColumn.SelectedValue?this.sbQuery+=0==this.sbFinalQuery.length?this.IsInventory?",INV.DocAbbr ["+e.ID+"Abr],INV.DocPrefix ["+e.ID+"prf],CONVERT(BIGINT,INV.DocNumber) ["+e.ID+"dno]":",ACC.DocAbbr ["+e.ID+"Abr],ACC.DocPrefix ["+e.ID+"prf],CONVERT(BIGINT,ACC.DocNumber) ["+e.ID+"dno]":this.IsInventory?",INV.DocAbbr,INV.DocPrefix,CONVERT(BIGINT,INV.DocNumber)":",ACC.DocAbbr,ACC.DocPrefix,CONVERT(BIGINT,ACC.DocNumber)":(this.sbQuery+=","+(this.IsInventory?"INV":"ACC")+".VersionNo",0==this.sbFinalQuery.length&&(this.sbQuery+=" ["+e.ID+"Ver]")),"2"==e.LinkType.SelectedValue?this.sbQuery+=this.IsInventory?",INV.InvDocDetailsID ["+e.ID+"_ID]":",ACC.AccDocDetailsID ["+e.ID+"_ID]":"8"==e.LinkType.SelectedValue&&(this.sbQuery+=this.IsInventory?",INV.DocID ["+e.ID+"_DID]":",ACC.DocID ["+e.ID+"_DID]"));if("-1"==e.LinkDimension.SelectedValue&&"1"==e.LinkType.SelectedValue&&(this.sbQuery+=this.IsInventory?",INV.DocID AS ["+e.ID+"_ID]":",ACC.DocID AS ["+e.ID+"_ID]"),e.IsReportMappingFilter||"3"==e.LinkType.SelectedValue||"4"==e.LinkType.SelectedValue){let t=0;t=null!=e.CDGDO.ChildCDGDO&&e.CDGDO.ChildCDGDO.IsForeignKey?e.CDGDO.ChildCDGDO.ParentCostCenterID:e.CDGDO.IsForeignKey?e.CDGDO.ParentCostCenterID:e.CDGDO.CategoryValue,400!=t&&(t<4e4||t>5e4)&&("NULL"!=e.CDGDO.ActualColumn?(this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(e=>e.FeatureID==t),this.sbQuery+=","+e.CDGDO.ActualTable+"."+this.drrCCTbl[0].PK.toString()+" AS ["+e.ID+"_ID]"):this.sbQuery+=",NULL AS ["+e.ID+"_ID]")}if("1"==e.ShowLevel.SelectedValue||"2"==e.ShowLevel.SelectedValue)if(null==S){if(null==S&&"NULL"!=e.CDGDO.ActualColumn&&(e.CDGDO.IsForeignKey&&e.CDGDO.ColumnCostCenterID>0||!e.CDGDO.IsForeignKey)){let t=e.CDGDO.ActualColumn.lastIndexOf(".");if(t>0){e.CDGDO.IsForeignKey?this.LevelTreeCostCenterID=e.CDGDO.ColumnCostCenterID:(this.LevelTreeCostCenterID=e.CDGDO.CategoryValue,e.CDGDO.ParentCostCenterSysName=e.CDGDO.Table,this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(t=>t.FeatureID==e.CDGDO.CategoryValue),e.CDGDO.ParentCostCenterColSysName=this.drrCCTbl[0].PK.toString());let s=e.CDGDO.ActualColumn.substr(0,t+1);this.sbQuery+=null!=e.CDGDO.ChildCDGDO?","+s+e.CDGDO.ChildCDGDO.ParentCostCenterColSysName+" AS TreeNodeID":","+s+e.CDGDO.ParentCostCenterColSysName+" AS TreeNodeID",null==this.LevelColumn&&(this.LevelColumn=e)}}S=this.LevelColumn}else this.LevelSubGroup=e.ID;s++}for(let t=0;t<this.ReportGroups.length;t++){let e=this.ReportGroups[t];if("0"==e.ShowAsColumn.SelectedValue){if(!o.e.IsEmpty(e.FormulaExpression))continue;s>0&&(this.sbQuery+=","),this.SetActualColumn(e.CDGDO,c);let t=e.CDGDO.ActualColumn;if("DATE"==e.CDGDO.DataType&&("MMM-yy"==e.DateType.Text?t="dateadd(day,1-datepart(day,"+t+"),"+t+")":"yyyy"==e.DateType.Text&&(t="convert(datetime,'01-01-'+convert(nvarchar,year("+t+")))")),this.sbQuery+=t,0==this.sbFinalQuery.length&&(this.sbQuery+=" ["+e.ID+"]"),e.Sort.SelectedValue.startsWith("NUM"))this.sbQuery+=",CASE WHEN isnumeric("+e.CDGDO.ActualColumn+")=1 THEN CONVERT(FLOAT,"+e.CDGDO.ActualColumn+") ELSE 0 END AS ["+e.ID+"SORT]";else if(e.Sort.SelectedValue.startsWith("TREE")){let t=e.CDGDO.ActualColumn.lastIndexOf(".");t>0&&(this.sbQuery+=","+e.CDGDO.ActualColumn.substr(0,t+1)+"lft AS ["+e.ID+"SORT]")}else"VoucherNo"==e.CDGDO.Column&&0==e.CDGDO.IsForeignKey&&(this.sbQuery+=0==this.sbFinalQuery.length?this.IsInventory?",INV.DocAbbr ["+e.ID+"Abr],INV.DocPrefix ["+e.ID+"prf],CONVERT(BIGINT,INV.DocNumber) ["+e.ID+"dno]":",ACC.DocAbbr ["+e.ID+"Abr],ACC.DocPrefix ["+e.ID+"prf],CONVERT(BIGINT,ACC.DocNumber) ["+e.ID+"dno]":this.IsInventory?",INV.DocAbbr,INV.DocPrefix,CONVERT(BIGINT,INV.DocNumber)":",ACC.DocAbbr,ACC.DocPrefix,CONVERT(BIGINT,ACC.DocNumber)");s++}}let e=0;for(let t=0;t<this.FormulaObjects.length;t++){let i=this.FormulaObjects[t];s>0&&(this.sbQuery+=","),this.SetActualColumn(i,c),this.sbQuery+=i.ActualColumn,0==this.sbFinalQuery.length&&(this.sbQuery+=" F"+e),s++,e++}if(this.IsAvgRateExists&&(this.StaticReportType>0||(0==c.DocID&&this.Entities.ContainsKey("Product")?this.sbQuery+=","+this.Entities.Product+".ProductID AvgRateOpStkPID,convert(float,convert(int,CONVERT(float,getdate()))) AvgRateOpStkDate":this.Entities.values.Contains("INV")?this.sbQuery+=",INV.ProductID AvgRateOpStkPID,INV.DocDate AvgRateOpStkDate":this.sbQuery+=",null AvgRateOpStkPID,null AvgRateOpStkDate")),this.IsAuthLevelReport){var m=this.BaseReportColumns.find(e=>95==e.CDGDO.CategoryValue||103==e.CDGDO.CategoryValue||104==e.CDGDO.CategoryValue||129==e.CDGDO.CategoryValue);this.sbQuery+=m&&95==m.CDGDO.CategoryValue?","+this.Entities.Contract+".WorkFlowLevel,"+this.Entities.Contract+".WorkFlowID":m&&103==m.CDGDO.CategoryValue?","+this.Entities.Quotation+".WorkFlowLevel,"+this.Entities.Quotation+".WorkFlowID":m&&104==m.CDGDO.CategoryValue?","+this.Entities["Purchase Contract"]+".WorkFlowLevel,"+this.Entities["Purchase Contract"]+".WorkFlowID":m&&129==m.CDGDO.CategoryValue?","+this.Entities["Unit Reservation"]+".WorkFlowLevel,"+this.Entities["Unit Reservation"]+".WorkFlowID":this.IsInventory?",INV.WorkFlowLevel,INV.WorkFlowID":",ACC.WorkFlowLevel,ACC.WorkFlowID"}else null!=this.BulkEdit&&this.BulkEdit.IsLWApproval&&(this.sbQuery+=this.IsInventory?",INV.WorkFlowID":",ACC.WorkFlowID");this.IsRevision&&(this.sbQuery+=this.IsInventory?",INV.VoucherNo RevDocNo,INV.VersionNo RevVersionNo,INV.ModifiedDate RevModDate":",ACC.VoucherNo RevDocNo,ACC.VersionNo RevVersionNo,ACC.ModifiedDate RevModDate"),o.e.IsEmpty(this.FileProtection)||("Account1"==this.FileProtection&&this.IsInventory?this.sbQuery+=",INV.Account1 FilePwdID":this.FileProtection.Contains("Account")?this.sbQuery+="INV":"Employee"==this.FileProtection&&(this.sbQuery+=",TDCC.dcCCNID51 FilePwdID")),112==this.CostCenterID&&(this.sbQuery+=",INV.InvDocDetailsID ReorderDetailsID"),this.SelectTag=this.sbQuery.toString()}this.sbQuery="";let R=[],P=[];if(this.IsNewFromClause){if(this.ShowOnlyAccountingData&&c.ShowAccountingData)if(c.IsInventory){if(this.sbQuery+="ACC_DocDetails ACC with(nolock) join ",Math.abs(c.DocID)<4e4&&null!=this.IncludeNonAccDocs){let e="";this.IncludeNonAccDocs.forEach(t=>{e.length>0&&(e+=","),e+="'"+t+"'"}),u.length>0&&(u+=" AND "),u+="INV.CostCenterID not in ("+e+")"}}else u.length>0&&(u+=" AND "),u+="ACC.InvDocDetailsID is null";if((this.Entities.values.Contains("INV")||this.Entities.values.Contains("ACC"))&&(this.IsInventory&&"INV"!=this.Entities.values[0]||!this.IsInventory&&"ACC"!=this.Entities.values[0])){var y=this.Entities.values,A=this.Entities.keys,p=this.Objects;let e=y.indexOf(this.IsInventory?"INV":"ACC");this.Entities.Clear(),this.Objects.Clear(),this.Entities.push(A[e],y[e]),this.Objects.push(p[e]);for(let t=0;t<y.length;t++)t!=e&&(this.Entities.push(A[t],y[t]),this.Objects.push(p[t]))}s=0;for(let t=0;t<this.Entities.length;t++){let n=this.Objects[t];for(d=0;d<t&&this.Entities.values[d]!=this.Entities.values[t];d++);if(d==t)if(s>0&&(this.sbQuery+=" left join "),null==n.DimensionsFilter||64!=n.ParentCCDefaultColID&&64!=n.ParentCCDefaultColID){if(210!=n.FieldValue){if(this.IsHistory&&e.HistoryTables[this.iHistoryStatusID].Contains(n.Table)?(this.Filter.ShowArchive.Visible&&this.Filter.ShowArchive.IsChecked&&(this.sbQuery+="PACT2C"+i.a.SessionManager.CompanyIndex+"_ARCHIVE.dbo."),this.iHistoryStatusID>=11701&&this.iHistoryStatusID<=11750&&0==o.e.stringCompare(e.HistoryTables[this.iHistoryStatusID][0],n.Table,!0)?(u.length>0&&(u+=" AND "),u+=this.Entities.values[t]+".CostCenterID="+n.CategoryValue,this.sbQuery+="COM_CCMastHistory "+this.Entities.values[t]+" with(nolock)"):this.sbQuery+=n.Table+this.strHistorySepChar+"History "+this.Entities.values[t]+" with(nolock)"):this.sbQuery+=n.Table+" "+this.Entities.values[t]+" with(nolock)","COM_ADDRESS"==n.Table.toUpperCase()){if(this.Entities.ContainsKey(n.CategoryText)){let e="NodeID";2==n.ColumnCostCenterID?e="AccountID":83==n.ColumnCostCenterID&&(e="CustomerID"),this.sbQuery+=" on "+this.Entities[n.CategoryText]+"."+e+"="+this.Entities.values[t]+".FeaturePK",this.sbQuery+=" AND "+this.Entities.values[t]+".AddressTypeID=1 AND "+this.Entities.values[t]+".FeatureID="+n.ColumnCostCenterID}}else if("COM_CONTACTSEXTENDED"==n.Table.toUpperCase());else if("COM_CONTACTS"==n.Table.toUpperCase()&&"COM_DOCCCDATA"!=n.ParentTable.toUpperCase()){if(65!=n.CategoryValue&&this.Entities.ContainsKey(n.CategoryText)||null!=n.ChildCDGDO&&(144!=n.ChildCDGDO.CategoryValue||65!=n.ChildCDGDO.ParentCostCenterID)){let e=n.ColumnCostCenterID>0?n.ColumnCostCenterID.toString():n.CategoryValue.toString();this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(t=>t.FeatureID==e);let s=n.CategoryText.lastIndexOf(".");this.sbQuery+=-1==s||"51"==e?" on "+this.Entities[n.CategoryText]+"."+this.drrCCTbl[0].PK.toString()+"="+this.Entities.values[t]+".FeaturePK":" on "+this.Entities[n.CategoryText.substr(0,s)]+"."+this.drrCCTbl[0].PK.toString()+"="+this.Entities.values[t]+".FeaturePK",this.sbQuery+=" AND "+this.Entities.values[t]+".FeatureID="+e}}else if("CRM_CONTACTS"==n.Table.toUpperCase()){if(this.Entities.ContainsKey(n.CategoryText)){let e="";e="Leads"==n.CategoryText?"LeadID":"Opportunity"==n.CategoryText?"OpportunityID":this.drrCCTbl[0].PK.toString(),this.sbQuery+=" on "+this.Entities[n.CategoryText]+"."+e+"="+this.Entities.values[t]+".FeaturePK",this.sbQuery+=" AND "+this.Entities.values[t]+".FeatureID="+n.CategoryValue}}else if("CRM_ACTIVITIES"==n.Table.toUpperCase()){if(144!=n.CategoryValue&&this.Entities.ContainsKey(n.CategoryText)&&null!=n.ParentTableAlias&&this.Entities.ContainsKey(n.ParentTableAlias))this.sbQuery+=" on "+this.Entities[n.ParentTableAlias]+"."+n.ParentColumn+"="+this.Entities.values[t]+"."+n.ParentCostCenterColSysName,this.sbQuery+=" AND "+this.Entities.values[t]+".CostCenterID="+n.CategoryValue;else if(this.Filter.ActivityTypes.Visible){let e="";this.Filter.ActivityTypes.Items.forEach(t=>{t.IsChecked&&(e+=t.Value+",")}),e.length>0&&(e=e.TrimEnd(","),e.Contains(",")?u+=this.Entities.values[t]+".CostCenterID IN ("+e+")":u+=this.Entities.values[t]+".CostCenterID="+e)}if(this.Filter.UsersList.Visible){let e="";this.Filter.UsersList.Items.forEach(t=>{t.IsChecked&&(e+=t.Value+",")}),0==e.length&&"1"!=i.a.SessionManager.RoleID&&(e="-1"),e.length>0&&(e=e.TrimEnd(","),e.length>0&&(this.sbQuery.length>0&&(this.sbQuery+=" join "),this.sbQuery+="  (select a.ISFROMACTIVITY,a.ccid,a.CCNODEID  from CRM_Assignment a with(nolock) where ISFROMACTIVITY>0 and UserID>0 and IsTeam=0 and IsRole=0 and IsGroup=0 and TeamNodeID=0 and a.UserID IN ("+e+") union select a.ISFROMACTIVITY,a.ccid,a.ccnodeid  from CRM_Assignment a with(nolock) join ADM_UserRoleMap map  with(nolock) on a.userid=map.roleid where ISFROMACTIVITY>0 and  a.UserID>0 and a.IsTeam=0 and a.IsRole=1 and a.IsGroup=0 and map.UserID IN ("+e+") union select a.ISFROMACTIVITY,a.ccid,a.ccnodeid  from CRM_Assignment a with(nolock) join com_groups g on a.TeamNodeID=g.gid join ADM_UserRoleMap map  with(nolock) on g.userid=map.userid or g.roleid=map.roleid where ISFROMACTIVITY>0 and  a.UserID=0 and a.IsTeam=0 and a.IsRole=0 and a.IsGroup=1 and a.TeamNodeID>0  and map.UserID IN ("+e+") union select a.ISFROMACTIVITY,a.ccid,a.ccnodeid   from CRM_Assignment a with(nolock) join CRM_Teams T   with(nolock) on a.TEAMNodeID=T.TEAMID and a.userid=t.userid where ISFROMACTIVITY>0 and a.UserID>0 and a.IsTeam=0 AND a.TeamNodeID>0 and a.IsRole=0 and a.IsGroup=0  and T.UserID IN ("+e+")) T ",this.sbQuery+=" on T.ISFROMACTIVITY="+this.Entities.values[t]+".ActivityID and T.ccid="+this.Entities.values[t]+".COSTCENTERID AND T.CCNODEID="+this.Entities.values[t]+".NODEID"))}}else if("CRM_FEEDBACK"==n.Table.toUpperCase()||"CRM_LEADCVRDETAILS"==n.Table.toUpperCase())this.Entities.ContainsKey(n.CategoryText)&&(this.sbQuery+=" on "+this.Entities[n.ParentTableAlias]+"."+n.ParentColumn+"="+this.Entities.values[t]+"."+n.ParentCostCenterColSysName,this.sbQuery+=" AND "+this.Entities.values[t]+".CCID="+n.CategoryValue);else if("CRM_PRODUCTMAPPING"==n.Table.toUpperCase())this.Entities.ContainsKey(n.CategoryText)&&(this.sbQuery+=" on "+this.Entities[n.ParentTableAlias]+"."+n.ParentColumn+"="+this.Entities.values[t]+"."+n.ParentCostCenterColSysName,this.sbQuery+=" AND "+this.Entities.values[t]+".CostCenterID="+n.CategoryValue);else if("COM_NOTES"==n.Table.toUpperCase())this.Entities.ContainsKey(n.CategoryText)&&(this.sbQuery+=" on "+this.Entities[n.ParentTableAlias]+"."+n.ParentColumn+"="+this.Entities.values[t]+"."+n.ParentCostCenterColSysName,this.sbQuery+=" AND "+this.Entities.values[t]+".FeatureID="+n.CategoryValue);else if("PAY_EMPPAY"==n.Table.toUpperCase())405==n.CategoryValue&&(this.sbQuery+=" on "+this.Entities.values[t]+".SeqNo IN (SELECT TOP 1 SeqNo FROM PAY_EMPPAY with(nolock) WHERE EmployeeID=TDCC.dcCCNID51 AND (DATEDIFF(day,CONVERT(DATETIME,EffectFrom),CONVERT(DATETIME,INV.DueDate))>=0 OR ((month(CONVERT(DATETIME,EffectFrom)))=MONTH(CONVERT(DATETIME,INV.DueDate)) AND (YEAR(CONVERT(DATETIME,EffectFrom)))=YEAR(CONVERT(DATETIME,INV.DueDate))))  ORDER BY EffectFrom DESC)");else if("REN_ContractParticulars"==n.Table||"REN_ContractPayTerms"==n.Table||"REN_QuotationParticulars"==n.Table||"REN_QuotationPayTerms"==n.Table){if(this.Entities.ContainsKey(n.CategoryText)&&!o.e.IsEmpty(n.ParentTableAlias)){let e=n.ColumnCostCenterID>0?n.ColumnCostCenterID.toString():n.CategoryValue.toString();this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(t=>t.FeatureID==e),this.sbQuery+=" on "+this.Entities[n.ParentTableAlias]+"."+this.drrCCTbl[0].PK.toString()+"="+this.Entities[n.ParentTableAlias.Replace(n.Table,"")]+"."+this.drrCCTbl[0].PK.toString()}}else"PRD_BILLOFMATERIAL"==n.Table.toUpperCase()&&599==n.FieldValue?this.sbQuery+=" on "+this.Entities[n.ParentTableAlias]+"."+n.FieldText.toString()+"="+this.Entities.Values[t]+".BOMID":n.IsForeignKey&&("ACC"==this.Entities[n.ParentTableAlias]&&"AccountID"==n.ParentColumn?(this.sbQuery+=" on ((ACC.DebitAccount>0 and ACC.DebitAccount="+this.Entities.values[t]+".AccountID) or (ACC.CreditAccount>0 and ACC.CreditAccount="+this.Entities.values[t]+".AccountID))",R.push(this.Entities.values[t]),P.push(this.Entities.values[t])):("INV_ProductExtended"==n.Table||"ACC_AccountsExtended"==n.Table||"REN_PropertyExtended"==n.Table||"REN_UnitsExtended"==n.Table||"REN_TenantExtended"==n.Table||(this.sbQuery+=this.ShowOnlyAccountingData&&c.ShowAccountingData&&c.IsInventory&&(2==n.ParentCostCenterID||12==n.ParentCostCenterID)?" on ACC."+n.ParentColumn+"="+this.Entities.values[t]+"."+n.ParentCostCenterColSysName:" on "+this.Entities[n.ParentTableAlias]+"."+n.ParentColumn+"="+this.Entities.values[t]+"."+n.ParentCostCenterColSysName),0==o.e.stringCompare("DebitAccount",n.ParentColumn,!0)?R.push(this.Entities.values[t]):0==o.e.stringCompare("CreditAccount",n.ParentColumn,!0)&&P.push(this.Entities.values[t]),65==n.CategoryValue?26645==n.FieldValue?this.sbQuery+=" AND "+this.Entities[n.ParentTableAlias]+".FeatureID=2":26644==n.FieldValue&&(this.sbQuery+=" AND "+this.Entities[n.ParentTableAlias]+".FeatureID=83"):24==n.CategoryValue&&107==n.FieldValue?this.sbQuery+=" AND "+this.Entities[n.ParentTableAlias]+".ProductID="+this.Entities.values[t]+".ProductID":86==n.CategoryValue?27179==n.FieldValue?this.sbQuery+=" AND "+this.Entities[n.ParentTableAlias]+".Mode=3":27180==n.FieldValue&&(this.sbQuery+=" AND "+this.Entities[n.ParentTableAlias]+".Mode=2"):73==n.CategoryValue&&(27303==n.FieldValue?this.sbQuery+=" AND "+this.Entities[n.ParentTableAlias]+".CustomerMode=2":27304==n.FieldValue&&(this.sbQuery+=" AND "+this.Entities[n.ParentTableAlias]+".CustomerMode=1"))),0==o.e.stringCompare(n.Table,"COM_CCCCData",!0)&&(this.sbQuery+=" AND "+this.Entities.values[t]+".CostCenterID="+n.CategoryValue),this.IsHistory&&e.HistoryTables[this.iHistoryStatusID].Contains(n.Table)&&(this.sbQuery+=this.iHistoryStatusID>=11701&&this.iHistoryStatusID<=11750?" AND "+this.Entities[n.ParentTableAlias]+".NodeHistoryID="+this.Entities.values[t]+".NodeHistoryID":" AND "+this.Entities[n.ParentTableAlias]+".ModifiedDate="+this.Entities.values[t]+".ModifiedDate"));if(null!=n.ParentCDGDO){let s=this.FieldsDialog.Relations.filter(e=>e.PK_Table==n.ParentCDGDO.Table.toUpperCase()&&e.FK_Table==n.Table.toUpperCase());s.length>0?(this.sbQuery+=" on "+this.Entities[n.ParentCDGDO.CategoryText]+"."+s[0].PK_Column.toString()+"="+this.Entities.values[t]+"."+s[0].FK_Column.toString(),this.IsHistory&&e.HistoryTables[this.iHistoryStatusID].Contains(n.Table)&&(this.sbQuery+=" AND "+this.Entities[n.ParentCDGDO.CategoryText]+".ModifiedDate="+this.Entities.values[t]+".ModifiedDate")):(s=this.FieldsDialog.Relations.filter(e=>e.FK_Table==n.ParentCDGDO.Table.toUpperCase()&&e.PK_Table==n.Table.toUpperCase()),s.length>0&&(this.sbQuery+=" on "+this.Entities[n.ParentCDGDO.CategoryText]+"."+s[0].FK_Column.toString()+"="+this.Entities.values[t]+"."+s[0].PK_Column.toString()))}0==t&&this.ShowOnlyAccountingData&&c.ShowAccountingData&&c.IsInventory&&(this.sbQuery+=" on ACC.InvDocDetailsID=INV.InvDocDetailsID"),s++}else if(this.IsInventory&&this.Filter.IsReportViewScreen){let e=o.e.IsEmpty(n.DimensionsFilter)?[null,null,null,null]:n.DimensionsFilter.split("~"),s=this;if(s.SetDatePickers(),o.e.IsEmptySpace(e[2])){let e=null!=O.find(e=>3==e.CategoryValue)?this.Entities.Product:"INV";this.sbQuery+="dbo.fnRPT_AvgRateAllProds('','','"+s.FromDatePicker.Date.ToString("dd MMM yyyy")+"','"+s.ToDatePicker.Date.ToString("dd MMM yyyy")+"',0,0,0,0,'') "+this.Entities.values[t],this.sbQuery+=" on "+this.Entities.values[t]+".ProductID="+e+".ProductID"}else{let i=o.e.IsEmptySpace(e[1])?0:parseInt(e[1]);this.sbQuery+="dbo."+e[2]+"('','','"+s.FromDatePicker.Date.ToString("dd MMM yyyy")+"','"+s.ToDatePicker.Date.ToString("dd MMM yyyy")+"',0,0,0,0,'') "+this.Entities.values[t],i>0?(e.length>3&&"1"==e[3]&&(u+=this.Entities.values[t]+".ProductID=INV.ProductID and"),this.sbQuery+=" on "+this.Entities.values[t]+".TagID=TDCC.dcCCNID"+(i-5e4)):this.sbQuery+=" on "+this.Entities.values[t]+".ProductID=INV.ProductID"}}}else this.sbQuery+="(select BaseID,max(Conversion) MaxConv,min(Conversion) MinConv from COM_UOM with(nolock) group by BaseID)"+this.Entities[n.CategoryText+"_MAXMIN"],this.sbQuery+=" on "+this.Entities[n.CategoryText]+".BaseID="+this.Entities[n.CategoryText+"_MAXMIN"]+".BaseID"}}else{if(this.ShowOnlyAccountingData&&c.ShowAccountingData)if(u.length>0&&(u+=" AND "),c.IsInventory){if(this.sbQuery+="ACC_DocDetails ACC with(nolock),",u+="ACC.InvDocDetailsID=INV.InvDocDetailsID",Math.abs(c.DocID)<4e4&&null!=this.IncludeNonAccDocs){let e="";this.IncludeNonAccDocs.forEach(t=>{e.length>0&&(e+=","),e+="'"+t+"'"}),u+=" AND INV.CostCenterID not in ("+e+")"}}else u+="ACC.InvDocDetailsID is null";s=0;for(let t=0;t<this.Entities.length;t++){let n=this.Objects[t];for(d=0;d<t&&this.Entities.values[d]!=this.Entities.values[t];d++);if(d==t)if(s>0&&(this.sbQuery+=","),null==n.DimensionsFilter||64!=n.ParentCCDefaultColID&&64!=n.ParentCCDefaultColID){if(210!=n.FieldValue){if(this.IsHistory&&e.HistoryTables[this.iHistoryStatusID].Contains(n.Table)?(this.Filter.ShowArchive.Visible&&this.Filter.ShowArchive.IsChecked&&(this.sbQuery+="PACT2C"+i.a.SessionManager.CompanyIndex+"_ARCHIVE.dbo."),this.iHistoryStatusID>=11701&&this.iHistoryStatusID<=11750&&0==o.e.stringCompare(e.HistoryTables[this.iHistoryStatusID][0],n.Table,!0)?(u.length>0&&(u+=" AND "),u+=this.Entities.values[t]+".CostCenterID="+n.CategoryValue,this.sbQuery+="COM_CCMastHistory "+this.Entities.values[t]+" with(nolock)"):this.sbQuery+=n.Table+this.strHistorySepChar+"History "+this.Entities.values[t]+" with(nolock)"):this.sbQuery+=n.Table+" "+this.Entities.values[t]+" with(nolock)","COM_ADDRESS"==n.Table.toUpperCase()){if(this.Entities.ContainsKey(n.CategoryText)){u.length>0&&(u+=" AND ");let e="NodeID";2==n.ColumnCostCenterID?e="AccountID":83==n.ColumnCostCenterID&&(e="CustomerID"),u+=this.Entities[n.CategoryText]+"."+e+"="+this.Entities.values[t]+".FeaturePK",u+=" AND "+this.Entities.values[t]+".AddressTypeID=1 AND "+this.Entities.values[t]+".FeatureID="+n.ColumnCostCenterID}}else if("COM_CONTACTSEXTENDED"==n.Table.toUpperCase());else if("COM_CONTACTS"==n.Table.toUpperCase()&&"COM_DOCCCDATA"!=n.ParentTable.toUpperCase()){if(65!=n.CategoryValue&&this.Entities.ContainsKey(n.CategoryText)||null!=n.ChildCDGDO&&(144!=n.ChildCDGDO.CategoryValue||65!=n.ChildCDGDO.ParentCostCenterID)){u.length>0&&(u+=" AND ");let e=n.ColumnCostCenterID>0?n.ColumnCostCenterID.toString():n.CategoryValue.toString();this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(t=>t.FeatureID==e);let s=n.CategoryText.lastIndexOf(".");u+=-1==s||"51"==e?this.Entities[n.CategoryText]+"."+this.drrCCTbl[0].PK.toString()+"="+this.Entities.values[t]+".FeaturePK":this.Entities[n.CategoryText.substr(0,s)]+"."+this.drrCCTbl[0].PK.toString()+"="+this.Entities.values[t]+".FeaturePK",u+=" AND "+this.Entities.values[t]+".FeatureID="+e}}else if("CRM_CONTACTS"==n.Table.toUpperCase()){if(this.Entities.ContainsKey(n.CategoryText)){let e="";u.length>0&&(u+=" AND "),e="Leads"==n.CategoryText?"LeadID":"Opportunity"==n.CategoryText?"OpportunityID":this.drrCCTbl[0].PK.toString(),u+=this.Entities[n.CategoryText]+"."+e+"="+this.Entities.values[t]+".FeaturePK",u+=" AND "+this.Entities.values[t]+".FeatureID="+n.CategoryValue}}else if("CRM_ACTIVITIES"==n.Table.toUpperCase()){if(144!=n.CategoryValue&&this.Entities.ContainsKey(n.CategoryText)&&null!=n.ParentTableAlias&&this.Entities.ContainsKey(n.ParentTableAlias))u.length>0&&(u+=" AND "),u+=this.Entities[n.ParentTableAlias]+"."+n.ParentColumn+"="+this.Entities.values[t]+"."+n.ParentCostCenterColSysName,u+=" AND "+this.Entities.values[t]+".CostCenterID="+n.CategoryValue;else if(this.Filter.ActivityTypes.Visible){let e="";this.Filter.ActivityTypes.Items.forEach(t=>{t.IsChecked&&(e+=t.Value+",")}),e.length>0&&(e=e.TrimEnd(","),e.Contains(",")?u+=this.Entities.values[t]+".CostCenterID IN ("+e+")":u+=this.Entities.values[t]+".CostCenterID="+e)}if(this.Filter.UsersList.Visible){let e="";this.Filter.UsersList.Items.forEach(t=>{t.IsChecked&&(e+=t.Value+",")}),0==e.length&&"1"!=i.a.SessionManager.RoleID&&(e="-1"),e.length>0&&(e=e.TrimEnd(","),e.length>0&&(this.sbQuery.length>0&&(this.sbQuery+=","),this.sbQuery+="  (select a.ISFROMACTIVITY,a.ccid,a.CCNODEID  from CRM_Assignment a with(nolock) where ISFROMACTIVITY>0 and UserID>0 and IsTeam=0 and IsRole=0 and IsGroup=0 and TeamNodeID=0 and a.UserID IN ("+e+") union select a.ISFROMACTIVITY,a.ccid,a.ccnodeid  from CRM_Assignment a with(nolock) join ADM_UserRoleMap map  with(nolock) on a.userid=map.roleid where ISFROMACTIVITY>0 and  a.UserID>0 and a.IsTeam=0 and a.IsRole=1 and a.IsGroup=0 and map.UserID IN ("+e+") union select a.ISFROMACTIVITY,a.ccid,a.ccnodeid  from CRM_Assignment a with(nolock) join com_groups g on a.TeamNodeID=g.gid join ADM_UserRoleMap map  with(nolock) on g.userid=map.userid or g.roleid=map.roleid where ISFROMACTIVITY>0 and  a.UserID=0 and a.IsTeam=0 and a.IsRole=0 and a.IsGroup=1 and a.TeamNodeID>0  and map.UserID IN ("+e+") union select a.ISFROMACTIVITY,a.ccid,a.ccnodeid   from CRM_Assignment a with(nolock) join CRM_Teams T   with(nolock) on a.TEAMNodeID=T.TEAMID and a.userid=t.userid where ISFROMACTIVITY>0 and a.UserID>0 and a.IsTeam=0 AND a.TeamNodeID>0 and a.IsRole=0 and a.IsGroup=0  and T.UserID IN ("+e+")) T ",u.length>0&&(u+=" AND "),u+="T.ISFROMACTIVITY="+this.Entities.values[t]+".ActivityID and T.ccid="+this.Entities.values[t]+".COSTCENTERID AND T.CCNODEID="+this.Entities.values[t]+".NODEID"))}}else"CRM_FEEDBACK"==n.Table.toUpperCase()||"CRM_LEADCVRDETAILS"==n.Table.toUpperCase()?this.Entities.ContainsKey(n.CategoryText)&&(u.length>0&&(u+=" AND "),u+=this.Entities[n.ParentTableAlias]+"."+n.ParentColumn+"="+this.Entities.values[t]+"."+n.ParentCostCenterColSysName,u+=" AND "+this.Entities.values[t]+".CCID="+n.CategoryValue):"CRM_PRODUCTMAPPING"==n.Table.toUpperCase()?this.Entities.ContainsKey(n.CategoryText)&&(u.length>0&&(u+=" AND "),u+=this.Entities[n.ParentTableAlias]+"."+n.ParentColumn+"="+this.Entities.values[t]+"."+n.ParentCostCenterColSysName,u+=" AND "+this.Entities.values[t]+".CostCenterID="+n.CategoryValue):"COM_NOTES"==n.Table.toUpperCase()?this.Entities.ContainsKey(n.CategoryText)&&(u.length>0&&(u+=" AND "),u+=this.Entities[n.ParentTableAlias]+"."+n.ParentColumn+"="+this.Entities.values[t]+"."+n.ParentCostCenterColSysName,u+=" AND "+this.Entities.values[t]+".FeatureID="+n.CategoryValue):n.IsForeignKey&&(u.length>0&&(u+=" AND "),"ACC"==this.Entities[n.ParentTableAlias]&&"AccountID"==n.ParentColumn?(u+="((ACC.DebitAccount>0 and ACC.DebitAccount="+this.Entities.values[t]+".AccountID) or (ACC.CreditAccount>0 and ACC.CreditAccount="+this.Entities.values[t]+".AccountID))",R.push(this.Entities.values[t]),P.push(this.Entities.values[t])):(u+=this.ShowOnlyAccountingData&&c.ShowAccountingData&&c.IsInventory&&(2==n.ParentCostCenterID||12==n.ParentCostCenterID)?"ACC."+n.ParentColumn+"="+this.Entities.values[t]+"."+n.ParentCostCenterColSysName:this.Entities[n.ParentTableAlias]+"."+n.ParentColumn+"="+this.Entities.values[t]+"."+n.ParentCostCenterColSysName,0==o.e.stringCompare("DebitAccount",n.ParentColumn,!0)?R.push(this.Entities.values[t]):0==o.e.stringCompare("CreditAccount",n.ParentColumn,!0)&&P.push(this.Entities.values[t]),65==n.CategoryValue?26645==n.FieldValue?u+=" AND "+this.Entities[n.ParentTableAlias]+".FeatureID=2":26644==n.FieldValue&&(u+=" AND "+this.Entities[n.ParentTableAlias]+".FeatureID=83"):24==n.CategoryValue&&107==n.FieldValue?u+=" AND "+this.Entities[n.ParentTableAlias]+".ProductID="+this.Entities.values[t]+".ProductID":86==n.CategoryValue?27179==n.FieldValue?u+=" AND "+this.Entities[n.ParentTableAlias]+".Mode=3":27180==n.FieldValue&&(u+=" AND "+this.Entities[n.ParentTableAlias]+".Mode=2"):73==n.CategoryValue&&(27303==n.FieldValue?u+=" AND "+this.Entities[n.ParentTableAlias]+".CustomerMode=2":27304==n.FieldValue&&(u+=" AND "+this.Entities[n.ParentTableAlias]+".CustomerMode=1"))),0==o.e.stringCompare(n.Table,"COM_CCCCData",!0)&&(u+=" AND "+this.Entities.values[t]+".CostCenterID="+n.CategoryValue),this.IsHistory&&e.HistoryTables[this.iHistoryStatusID].Contains(n.Table)&&(u+=this.iHistoryStatusID>=11701&&this.iHistoryStatusID<=11750?" AND "+this.Entities[n.ParentTableAlias]+".NodeHistoryID="+this.Entities.values[t]+".NodeHistoryID":" AND "+this.Entities[n.ParentTableAlias]+".ModifiedDate="+this.Entities.values[t]+".ModifiedDate"));if(null!=n.ParentCDGDO){let s=this.FieldsDialog.Relations.filter(e=>e.PK_Table==n.ParentCDGDO.Table.toUpperCase()&&e.FK_Table==n.Table.toUpperCase());s.length>0?(u.length>0&&(u+=" AND "),u+=this.Entities[n.ParentCDGDO.CategoryText]+"."+s[0].PK_Column.toString()+"="+this.Entities.values[t]+"."+s[0].FK_Column.toString(),this.IsHistory&&e.HistoryTables[this.iHistoryStatusID].Contains(n.Table)&&(u+=" AND "+this.Entities[n.ParentCDGDO.CategoryText]+".ModifiedDate="+this.Entities.values[t]+".ModifiedDate")):(s=this.FieldsDialog.Relations.filter(e=>e.FK_Table==n.ParentCDGDO.Table.toUpperCase()&&e.PK_Table==n.Table.toUpperCase()),s.length>0&&(u.length>0&&(u+=" AND "),u+=this.Entities[n.ParentCDGDO.CategoryText]+"."+s[0].FK_Column.toString()+"="+this.Entities.values[t]+"."+s[0].PK_Column.toString()))}s++}else if(this.IsInventory&&this.Filter.IsReportViewScreen){let e=o.e.IsEmpty(n.DimensionsFilter)?[null,null,null,null]:n.DimensionsFilter.split("~"),s=this;if(s.SetDatePickers(),o.e.IsEmptySpace(e[2])){let e=null!=O.find(e=>3==e.CategoryValue)?this.Entities.Product:"INV";this.sbQuery+="dbo.fnRPT_AvgRateAllProds('','','"+s.FromDatePicker.Date.ToString("dd MMM yyyy")+"','"+s.ToDatePicker.Date.ToString("dd MMM yyyy")+"',0,0,0,0,'') "+this.Entities.values[t],u.length>0&&(u+=" AND "),u+=this.Entities.values[t]+".ProductID="+e+".ProductID"}else{let i=o.e.IsEmptySpace(e[1])?0:parseInt(e[1]);this.sbQuery+="dbo."+e[2]+"('','','"+s.FromDatePicker.Date.ToString("dd MMM yyyy")+"','"+s.ToDatePicker.Date.ToString("dd MMM yyyy")+"',0,0,0,0,'') "+this.Entities.values[t],u.length>0&&(u+=" AND "),i>0?(this.sbQuery+=" on ",e.length>3&&"1"==e[3]&&(this.sbQuery+=this.Entities.vValues[t]+".ProductID=INV.ProductID and "),this.sbQuery+=this.Entities.values[t]+".TagID=TDCC.dcCCNID"+(i-5e4)):u+=this.Entities.values[t]+".ProductID=INV.ProductID"}}}else this.sbQuery+="(select BaseID,max(Conversion) MaxConv,min(Conversion) MinConv from COM_UOM with(nolock) group by BaseID)"+this.Entities[n.CategoryText+"_MAXMIN"],u.length>0&&(u+=" AND "),u+=this.Entities[n.CategoryText]+".BaseID="+this.Entities[n.CategoryText+"_MAXMIN"]+".BaseID"}}!this.Entities.values.Contains("TDCC")&&this.Filter.CostCenterFilters.find(e=>e.CostCenterID>5e4)&&(this.Entities.values.Contains("INV")||this.Entities.values.Contains("ACC"))&&(this.IsNewFromClause?(this.sbQuery+=" join COM_DocCCDATA TDCC with(nolock) on ",this.Entities.values.Contains("INV")?this.sbQuery+="INV.InvDocDetailsID=TDCC.InvDocDetailsID":this.sbQuery+="ACC.AccDocDetailsID=TDCC.AccDocDetailsID"):(this.sbQuery+=",COM_DocCCDATA TDCC with(nolock)",u.length>0&&(u+=" AND "),this.Entities.values.Contains("INV")?u+="INV.InvDocDetailsID=TDCC.InvDocDetailsID":u+="ACC.AccDocDetailsID=TDCC.AccDocDetailsID")),this.FromTagExtra.length>0&&(this.sbQuery+=this.FromTagExtra),this.ShowUnAppDocsToApprove&&!this.ShowUnAppDocsToApprove_UseFuncCall&&(this.sbQuery+=",#TblUsrWF WF");let b=this.BaseReportColumns.find(e=>27296==e.CDGDO.FieldValue);if(b&&(this.sbQuery+=" LEFT JOIN CRM_Assignment ASS WITH(nolock) ON "+this.Entities[b.CDGDO.CategoryText]+".ActivityID=ASS.ISFROMACTIVITY LEFT JOIN ADM_Users U WITH(NOLOCK) ON ASS.UserID=U.UserID"),null!=C){let e;this.sbQuery+=",COM_BudgetAlloc BALL with(nolock)";let t="BALL.BudgetDefID="+l;C.Tables[0].forEach(s=>{e=parseInt(s.CostCenterID),e>5e4?(t+=" AND BALL.CCNID"+(e-5e4)+"="+this.Entities.Documents_CCMAP+".dcCCNID"+(e-5e4),this.SelectTag+=",BALL.CCNID"+(e-5e4)+" AS BUD_"+e):2==e?(t+=this.IsInventory?" AND (BALL.AccountID=INV.DebitAccount OR BALL.AccountID=INV.CreditAccount)":" AND (BALL.AccountID=ACC.DebitAccount OR BALL.AccountID=ACC.CreditAccount)",this.SelectTag+=",BALL.AccountID AS BUD_2"):3==e&&(this.IsInventory&&(t+=" AND BALL.ProductID=INV.ProductID"),this.SelectTag+=",BALL.ProductID AS BUD_3")}),u.length>0?u+=" AND "+t:u=t}this.FromTag=this.sbQuery.toString(),this.sbQuery="";let f="";f+=u;let V=0;if(this.Filter.IsReportViewScreen){let e=this;e.Preferences.ContainsKey("DebitCreditAccountFilter")&&("CreditAccount"==e.Preferences.DebitCreditAccountFilter?V=1:"Both"==e.Preferences.DebitCreditAccountFilter&&(V=2))}let M=this.Filter.CostCenterFilters.find(e=>502==e.CostCenterID),_=this.Filter.CostCenterFilters.find(e=>-502==e.CostCenterID);if(M||_){let e="",t="";if(M&&M.SelectedNodes.forEach(t=>{e.length>0&&(e+=","),e+=t.Id}),_&&_.SelectedNodes.forEach(e=>{t.length>0&&(t+=","),t+=e.Id}),e.length>0||t.length>0){let s="ACC",i=null,o=null;c.IsInventory&&(s="INV"),R.length>0?i=R[0]+".AccountTypeID":this.ShowDebitCreditAmount&&c.ShowAccountingData&&!c.IsDebit&&0==t.length||(this.FromTag+=",ACC_Accounts XADRX with(nolock)",f.length>0&&(f+=" AND "),f+="XADRX.AccountID="+s+".DebitAccount",i="XADRX.AccountTypeID"),P.length>0?o=P[0]+".AccountTypeID":this.ShowDebitCreditAmount&&c.ShowAccountingData&&c.IsDebit&&0==t.length||(this.FromTag+=",ACC_Accounts XACRX with(nolock)",f.length>0&&(f+=" AND "),f+="XACRX.AccountID="+s+".CreditAccount",o="XACRX.AccountTypeID"),f.length>0&&(f+=" AND "),this.ShowDebitCreditAmount&&c.ShowAccountingData?(e.length>0&&(f+=c.IsDebit?i:o,e.Contains(",")?f+=" in ("+e+")":f+="="+e),t.length>0&&(e.length>0&&(f+=" and "),f+=c.IsDebit?o:i,t.Contains(",")?f+=" in ("+t+")":f+="="+t)):e.Contains(",")?f+="("+i+" in ("+e+") or "+o+" in ("+e+"))":f+="("+i+"="+e+" or "+o+"="+e+")"}}let L=0,v="1"==i.a.SessionManager.UserID||"1"==i.a.SessionManager.RoleID;for(let t=0;t<this.Filter.CostCenterFilters.length;t++){let s=this.Filter.CostCenterFilters[t];if(300!=s.CostCenterID&&-100!=s.CostCenterID&&502!=s.CostCenterID&&-502!=s.CostCenterID){if(44!=s.CostCenterID)if(113==s.CostCenterID&&Math.abs(c.DocID)>4e4&&Math.abs(c.DocID)<5e4){if(0!=s.SelectedNodes.length){f.length>0&&(f+=" AND "),f+=(c.IsInventory?"INV":"ACC")+".StatusID IN (";for(let e=0;e<s.SelectedNodes.length;e++)e>0&&(f+=","),f+=s.SelectedNodes[e].Id;f+=")"}}else{let t,i="";L++;let o,n="GT"+L,a=!1,l=s.CostCenterID;50==s.CostCenterID&&(l=this.Filter.lstPreFetchReportCC[s.LookupTypeID]);for(let r=0;r<this.Objects.length;r++)if("RptManager"!=this.Objects[r].ParentColumn&&(this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(e=>e.FeatureID==this.Objects[r].CategoryValue),t=400!=this.Objects[r].CategoryValue||this.IsInventory?this.drrCCTbl[0].TableName.toString():"ACC_DocDetails",(this.Objects[r].IsForeignKey&&this.Objects[r].ColumnCostCenterID==l&&null==this.Objects[r].ParentCDGDO||!this.Objects[r].IsForeignKey&&this.Objects[r].CategoryValue==l&&this.Objects[r].Table==t)&&(a=!0,this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(e=>e.FeatureID==l),this.drrCCTbl.length>0))){if(2==l&&-1==V)continue;if(o=this.drrCCTbl[0].PK.toString(),2==l&&2==V){if(V=-1,s.SelectedNodes.length>0||!s.DeleteButtonVisibility){if(f.length>0&&(f+=" AND "),f+="(",0==i.length){for(let e=0;e<s.SelectedNodes.length;e++)null!=s.SelectedNodes[e].Parent&&s.SelectedNodes[e].Parent.IsSelected||(i.length>0&&(i+=","),i+=s.SelectedNodes[e].Id);0==i.length&&(i+=-12912)}R.length>0&&(f+=R[0]+"."+o+"="+n+".GTID"),R.length>0&&P.length>0&&(f+=" OR "),P.length>0&&(f+=P[0]+"."+o+"="+n+".GTID"),f+=")"}}else{if(0==V){if(P.Contains(this.Entities.values[r]))continue}else if(1==V&&R.Contains(this.Entities.values[r]))continue;if(this.IsPreProcessQuery&&s.IsPrePocessFilter){this.SelectTag+=","+this.Entities.values[r]+"."+o+" PPQ"+l;continue}if(s.SelectedNodes.length>0||!s.DeleteButtonVisibility)if(f.length>0&&(f+=" AND "),e.IsGroupTree(s)&&(s.DeleteButtonVisibility||v)){if(0==i.length){for(let e=0;e<s.SelectedNodes.length;e++)null!=s.SelectedNodes[e].Parent&&s.SelectedNodes[e].Parent.IsSelected||(i.length>0&&(i+=","),i+=s.SelectedNodes[e].Id);0==i.length&&(i+=-12912)}f+=this.Entities.values[r]+"."+o+"="+n+".GTID"}else{f+=this.Entities.values[r]+"."+o+" IN (";for(let e=0;e<s.SelectedNodes.length;e++)e>0&&(f+=","),f+=s.SelectedNodes[e].Id;0==s.SelectedNodes.length&&(f+=-12912),f+=")"}}}if(!a&&l>5e4&&(this.Entities.values.Contains("INV")||this.Entities.values.Contains("ACC"))&&(s.SelectedNodes.length>0||!s.DeleteButtonVisibility))if(f.length>0&&(f+=" AND "),o="TDCC.dcCCNID"+(l-5e4),e.IsGroupTree(s)&&(s.DeleteButtonVisibility||v)){if(0==i.length){for(let e=0;e<s.SelectedNodes.length;e++)null!=s.SelectedNodes[e].Parent&&s.SelectedNodes[e].Parent.IsSelected||(i.length>0&&(i+=","),i+=s.SelectedNodes[e].Id);0==i.length&&(i+=-12912)}f+=o+"="+n+".GTID"}else{f+=o+" IN (";for(let e=0;e<s.SelectedNodes.length;e++)e>0&&(f+=","),f+=s.SelectedNodes[e].Id;0==s.SelectedNodes.length&&(f+=-12912),f+=")"}if(i.length>0&&(this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(e=>e.FeatureID==l),this.FromTag+="\r\n ,(select T."+this.drrCCTbl[0].PK.toString()+" GTID from "+this.drrCCTbl[0].TableName.toString()+" T with(nolock),"+this.drrCCTbl[0].TableName.toString()+" "+n+" with(nolock) where T.lft BETWEEN "+n+".lft AND "+n+".rgt AND "+n+"."+this.drrCCTbl[0].PK.toString()+" IN ("+i.toString()+") group by T."+this.drrCCTbl[0].PK.toString()+") AS "+n),7==l&&s.SelectedNodes.length>0){let e=[];e.AddRange(this.BaseReportColumns),e.AddRange(this.ReportGroups),e.forEach(e=>{if("CreatedBy"==e.CDGDO.Column||"ModifiedBy"==e.CDGDO.Column){f.length>0&&(f+=" AND "),f+=e.CDGDO.ActualColumn+" IN (";for(let e=0;e<s.SelectedNodes.length;e++)e>0&&(f+=","),f+="'"+s.SelectedNodes[e].Text[0]+"'";0==s.SelectedNodes.length&&(f+="NO USER"),f+=")"}})}}else if(s.SelectedNodes.length>0){let e=this.BaseReportColumns.find(e=>e.CDGDO.ColumnCCListViewTypeID==s.LookupTypeID&&(44==e.CDGDO.ColumnCostCenterID||44==e.CDGDO.LocalReference));if(e||(e=this.ReportGroups.find(e=>e.CDGDO.ColumnCCListViewTypeID==s.LookupTypeID&&(44==e.CDGDO.ColumnCostCenterID||44==e.CDGDO.LocalReference))),e){f.length>0&&(f+=" AND "),f+=e.CDGDO.ActualTable+" IN (";for(let e=0;e<s.SelectedNodes.length;e++)e>0&&(f+=","),f+="'"+s.SelectedNodes[e].Id+"'";0==s.SelectedNodes.length&&(f+="NO USER"),f+=")"}}}else 300==s.CostCenterID&&this.IsPreProcessQuery&&s.IsPrePocessFilter&&this.Entities.ContainsKey("Documents")&&(this.SelectTag+=","+this.Entities.Documents+".CostCenterID PPQ"+s.CostCenterID)}if(h.length>0&&(f.length>0&&(f+=" AND "),f+="("+h+")"),this.BaseReportColumns.find(e=>103==e.CDGDO.CategoryValue)?(f.length>0&&(f+=" AND "),f+=(this.Entities.ContainsKey("Quotation")?this.Entities.Quotation:"T0")+".CostCenterID=103"):this.BaseReportColumns.find(e=>129==e.CDGDO.CategoryValue)&&(f.length>0&&(f+=" AND "),f+=(this.Entities.ContainsKey("Unit Reservation")?this.Entities["Unit Reservation"]:"T0")+".CostCenterID=129"),this.BaseReportColumns.find(e=>251==e.CDGDO.CategoryValue)?(f.length>0&&(f+=" AND "),f+="T0.DType=251"):this.BaseReportColumns.find(e=>252==e.CDGDO.CategoryValue)?(f.length>0&&(f+=" AND "),f+="T0.DType=252"):this.BaseReportColumns.find(e=>253==e.CDGDO.CategoryValue)?(f.length>0&&(f+=" AND "),f+="T0.DType=253"):this.BaseReportColumns.find(e=>254==e.CDGDO.CategoryValue)?(f.length>0&&(f+=" AND "),f+="T0.DType=254"):this.BaseReportColumns.find(e=>255==e.CDGDO.CategoryValue)&&(f.length>0&&(f+=" AND "),f+="T0.DType=255"),this.ShowDebitCreditAmount&&c.ShowAccountingData){c.IsInventory||(f.length>0&&(f+=" AND "),f+=c.IsDebit?"ACC.DebitAccount>0":"ACC.CreditAccount>0");let e="";e=0==this.UnPostedDocsList.length?"(ACC.StatusID=369 or ACC.StatusID=429)":" ACC.StatusID IN (369,429,"+this.UnPostedDocsList+")",f.length>0&&(f+=" AND "),f+=c.IsInventory?e:this.PDCInclude?"(ACC.StatusID=370 OR (ACC.DocumentType<>14 AND ACC.DocumentType<>19 and "+e+"))":"ACC.DocumentType<>14 AND ACC.DocumentType<>19 and "+e}if(this.Entities.ContainsKey("Asset Management")){f.length>0&&(f+=" AND "),f+=this.Entities["Asset Management"]+".IsGroup=0";var E=this.Filter.Fields.find(e=>169==e.CDGDO.FieldValue);E&&(f+=" AND "+this.Entities["Asset Management"]+".DeprStartDate<=convert(float,convert(datetime,'"+E.ToDatePicker.Date.ToString("dd MMM yyyy")+"'))")}let w="",x="";for(let e=0;e<this.Filter.Fields.length;e++){let t=this.Filter.Fields[e];if(this.SetActualColumn(t.CDGDO,c),"NULL"!=t.CDGDO.ActualColumn&&!(this.EmpAsonDate.length>0&&null!=this.EmpAsonDate.filter(e=>e==t.CDGDO))){if(w="","DATE"==t.CDGDO.DataType){if(this.Filter.IsReportViewScreen&&!this.DontApplyDateFilter){if(this.IsPreProcessQuery&&t.IsPrePocessFilter){let e="";e=t.CDGDO.ActualColumn.Contains("CreatedDate")||t.CDGDO.ActualColumn.Contains("ModifiedDate")?t.CDGDO.ActualColumn.Replace("CONVERT(DATETIME,","CONVERT(DATETIME,floor(")+")":t.CDGDO.Column.startsWith("dcAlpha")?"CONVERT(DATETIME,"+t.CDGDO.ActualTable+"."+t.CDGDO.Column+")":t.CDGDO.ActualColumn,this.SelectTag+=","+e+" PPQ"+t.ID.Replace("-","")}let e="";if(t.CDGDO.Column.startsWith("dcAlpha")&&(67==t.CDGDO.DocumentType&&"DCALPHA1"==t.CDGDO.Column.toUpperCase()&&(e+="ISNULL("+t.CDGDO.ActualTable+"."+t.CDGDO.Column+",'')<>'' AND LEN("+t.CDGDO.ActualTable+"."+t.CDGDO.Column+")=11 AND "),e+="isDate("+t.CDGDO.ActualTable+"."+t.CDGDO.Column+")=1 AND ",e+="isNumeric("+t.CDGDO.ActualTable+"."+t.CDGDO.Column+")=0 AND "),t.CDGDO.ActualColumn.Contains("CreatedDate")||t.CDGDO.ActualColumn.Contains("ModifiedDate")?e+=t.CDGDO.ActualColumn.replace("CONVERT(DATETIME,","CONVERT(DATETIME,floor(")+")":t.CDGDO.Column.startsWith("dcAlpha")?67==t.CDGDO.DocumentType&&"DCALPHA1"==t.CDGDO.Column.toUpperCase()?e+="CONVERT(DATETIME,REPLACE(REPLACE("+t.CDGDO.ActualTable+"."+t.CDGDO.Column+",'/',' '),'-',' '))":e+="CONVERT(DATETIME,"+t.CDGDO.ActualTable+"."+t.CDGDO.Column+")":e+=t.CDGDO.ActualColumn,"Between"==t.Condition.SelectedValue||"NotBetween"==t.Condition.SelectedValue)e+=t.Condition.SelectedItem.Parent,e+="'"+t.FromDatePicker.Date.ToString("dd MMM yyyy")+"' AND ",e+="'"+t.ToDatePicker.Date.ToString("dd MMM yyyy")+"'";else if("FUTURE"==t.Condition.SelectedValue||"PAST"==t.Condition.SelectedValue){let s;t.ToDatePicker.Mode=1,t.FromDatePicker.Mode=1,s=o.e.Int(t.FromValue.TextBox.Text),0==s&&(s=1);let i="";if(i=""!=t.FromValue.ComboBox.SelectedValue?t.FromValue.ComboBox.SelectedValue:"Days","Days"==i)"FUTURE"==t.Condition.SelectedValue?(t.FromDatePicker.Date=Date.Today(),t.ToDatePicker.Date=Date.Today().AddDays(s)):(t.FromDatePicker.Date=Date.Today().AddDays(-s),t.ToDatePicker.Date=Date.Today());else if("Weeks"==i);else if("Months"==i)if("FUTURE"==t.Condition.SelectedValue){let e=Date.Today().AddMonths(s);e=e.MonthsFirst(),t.FromDatePicker.Date=e,e=e.AddMonths(s).AddDays(-1),t.ToDatePicker.Date=e}else{let e=Date.Today().AddMonths(-s);e=e.MonthsFirst(),t.FromDatePicker.Date=e,e=e.AddMonths(s).AddDays(-1),t.ToDatePicker.Date=e}else if("Quarter"==i)if("FUTURE"==t.Condition.SelectedValue){let e=Date.Today().AddMonths(3*s);e=new Date(e.getFullYear(),e.getMonth()-(e.getMonth()-1)%3,1),t.FromDatePicker.Date=e,e=e.AddMonths(3*s).AddDays(-1),t.ToDatePicker.Date=e}else{let e=Date.Today().AddMonths(3*-s);e=new Date(e.getFullYear(),e.getMonth()-(e.getMonth()-1)%3,1),t.FromDatePicker.Date=e,e=e.AddMonths(3*s).AddDays(-1),t.ToDatePicker.Date=e}else if("Year"==i)if("FUTURE"==t.Condition.SelectedValue){let e=Date.Today().AddYears(s);e=new Date(e.getFullYear(),0,1),t.FromDatePicker.Date=e,e=e.AddYears(s-1),e=new Date(e.getFullYear(),11,31),t.ToDatePicker.Date=e}else{let e=Date.Today().AddYears(1-s);e=new Date(e.getFullYear(),0,1),t.FromDatePicker.Date=e,t.ToDatePicker.Date=Date.Today()}e+=" BETWEEN ",e+="'"+t.FromDatePicker.Date.ToString("dd MMM yyyy")+"' AND ",e+="'"+t.ToDatePicker.Date.ToString("dd MMM yyyy")+"'"}else"IsNull"==t.Condition.SelectedValue||"IsNotNull"==t.Condition.SelectedValue?e+=t.Condition.SelectedItem.Parent:(e+=t.Condition.SelectedItem.Parent,e+="'"+t.FromDatePicker.Date.ToString("dd MMM yyyy")+"'");let s="";if("Between"==t.Condition.SelectedValue||"FUTURE"==t.Condition.SelectedValue||"PAST"==t.Condition.SelectedValue){let e=new Date(t.ToDatePicker.Date.getFullYear(),i.a.SessionManager.AccountingFromMonth-1,1);e>t.ToDatePicker.Date&&(e=e.AddYears(-1));let n="";if(t.CDGDO.Column.startsWith("dcAlpha")&&(67==t.CDGDO.DocumentType&&"DCALPHA1"==t.CDGDO.Column.toUpperCase()&&(n+="ISNULL("+t.CDGDO.ActualTable+"."+t.CDGDO.Column+",'')<>'' AND LEN("+t.CDGDO.ActualTable+"."+t.CDGDO.Column+")=11 AND "),n="isDate("+t.CDGDO.ActualTable+"."+t.CDGDO.Column+")=1 AND ",n="isNumeric("+t.CDGDO.ActualTable+"."+t.CDGDO.Column+")=0 AND "),t.CDGDO.ActualColumn.Contains("CreatedDate")||t.CDGDO.ActualColumn.Contains("ModifiedDate")?n+=t.CDGDO.ActualColumn.replace("CONVERT(DATETIME,","CONVERT(DATETIME,floor(")+")":t.CDGDO.Column.startsWith("dcAlpha")?n+="CONVERT(DATETIME,"+t.CDGDO.ActualTable+"."+t.CDGDO.Column+")":n+=t.CDGDO.ActualColumn,this.RepeatShowPrevMn){let i=e.AddYears(-1);for(let e=1;e<=this.RepeatPrevData;e++){if(s+=" OR ("+n+" BETWEEN ",this.RepeatPrevDataFull)s+="'"+i.ToString("dd MMM yyyy")+"' AND ",s+="'"+i.AddYears(1).AddDays(-1).ToString("dd MMM yyyy")+"'",i=i.AddYears(-1);else if(this.RepeatPrevDataOfCurrYr&&this.RepeatType==r.d.Monthly){let i=new Date(t.FromDatePicker.Date.getFullYear(),t.FromDatePicker.Date.getMonth(),1);i=i.AddMonths(-e),s+="'"+i.ToString("dd MMM yyyy")+"' AND ",s+="'"+i.AddMonths(1).AddDays(-1).ToString("dd MMM yyyy")+"'"}else s+="'"+t.FromDatePicker.Date.AddYears(-e).ToString("dd MMM yyyy")+"' AND ",s+="'"+t.ToDatePicker.Date.AddYears(-e).ToString("dd MMM yyyy")+"'";s+=")"}this.RepeatEmptyColumns=1}this.BaseReportColumns.find(e=>!o.e.IsEmpty(e.Formula.Text)&&e.Formula.Text.Contains("PRV_YEARSTART"))||this.ReportGroups.find(e=>!o.e.IsEmpty(e.Formula.Text)&&e.Formula.Text.Contains("PRV_YEARSTART"))?(this.PrevDateColumsUsed=!0,s+=" OR ("+n+" BETWEEN ",s+="'"+e.AddYears(-1).ToString("dd MMM yyyy")+"' AND ",s+="'"+e.AddDays(-1).ToString("dd MMM yyyy")+"'",s+=")"):(this.BaseReportColumns.find(e=>!o.e.IsEmpty(e.Formula.Text)&&e.Formula.Text.Contains("PRV_YEARFROMDATE"))||this.ReportGroups.find(e=>!o.e.IsEmpty(e.Formula.Text)&&e.Formula.Text.Contains("PRV_YEARFROMDATE"))||this.BaseReportColumns.find(e=>!o.e.IsEmpty(e.Formula.Text)&&e.Formula.Text.Contains("PRV_YEARTODATE"))||this.ReportGroups.find(e=>!o.e.IsEmpty(e.Formula.Text)&&e.Formula.Text.Contains("PRV_YEARTODATE")))&&(this.PrevDateColumsUsed=!0,s+=" OR ("+n+" BETWEEN ",s+="'"+t.FromDatePicker.Date.AddYears(-1).ToString("dd MMM yyyy")+"' AND ",s+="'"+t.ToDatePicker.Date.AddYears(-1).ToString("dd MMM yyyy")+"'",s+=")")}s.length>0?(w+="(("+e+")",w+=s.toString(),w+=")"):w+=e}}else if("Between"==t.Condition.SelectedValue||"NotBetween"==t.Condition.SelectedValue)if(t.FromValue.Visible){if(o.e.IsEmpty(t.FromValue.TextBox.Text)&&o.e.IsEmpty(t.ToValue.Text))continue;w+=t.CDGDO.ActualColumn,w+=t.Condition.SelectedItem.Parent,w+="'"+t.FromValue.TextBox.Text+"' AND ",w+="'"+t.ToValue.Text+"'"}else{if(o.e.IsEmpty(t.FromList.Text)&&o.e.IsEmpty(t.ToList.Text))continue;w+=t.CDGDO.ActualColumn,w+=t.Condition.SelectedItem.Parent,w+="'"+t.FromList.Text+"' AND ",w+="'"+t.ToList.Text+"'"}else if("Contains"==t.Condition.SelectedValue||"NotContain"==t.Condition.SelectedValue){if(o.e.IsEmpty(t.FromValue.TextBox.Text))continue;w+=t.CDGDO.ActualColumn,w+=t.Condition.SelectedItem.Parent,w+="'%"+t.FromValue.TextBox.Text+"%'"}else if("IsNull"==t.Condition.SelectedValue||"IsNotNull"==t.Condition.SelectedValue)w+=t.CDGDO.ActualColumn,w+=t.Condition.SelectedItem.Parent;else if(t.FromValue.Visible){if(o.e.IsEmpty(t.FromValue.TextBox.Text))continue;w+=t.CDGDO.ActualColumn,w+=t.Condition.SelectedItem.Parent,w+="'"+t.FromValue.TextBox.Text+"'"}else if(t.FromList.CCID>0){if(0==t.FromList.SelectedValue&&3!=t.FromList.CCID)continue;this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(e=>e.FeatureID==t.FromList.CCID),t.CDGDO.Column.startsWith("CCNID")&&null!=t.CDGDO.ChildCDGDO?w+=this.Entities[t.CDGDO.ChildCDGDO.CategoryText]+"."+this.drrCCTbl[0].PK.toString():w+=this.Entities[t.CDGDO.CategoryText]+"."+this.drrCCTbl[0].PK.toString(),w+=t.Condition.SelectedItem.Parent,w+=t.FromList.SelectedValue}w.length>0&&(t.QuickSearchField.IsChecked?(x.length>0&&(x+=" OR "),x+=w):(f.length>0&&(f+=" AND "),f+=w))}}if(x.length>0&&(f.length>0&&(f+=" AND "),f+="("+x+")"),!this.IsInventory&&this.Entities.values.Contains("ACC")&&this.Filter.IsReportViewScreen&&!this.Report.Preferences.ContainsKey("extrafieldsaccountposting")&&(f.length>0&&(f+=" AND "),f+="ACC.LinkedAccDocDetailsID is null"),this.IsNewFromClause&&c.IsInventory&&this.Filter.IsReportViewScreen&&this.Report.Preferences.ContainsKey("ExQtyCol")){var N=this.BaseReportColumns.find(e=>e.ID==this.Report.Preferences.ExQtyCol);N&&(f.length>0&&(f+=" AND "),!o.e.IsEmpty(N.CDGDO.ActualColumn)&&N.CDGDO.ActualColumn.Contains("ExQ")?f+="1"==this.Report.Preferences.ExQtyType?"(INV.LinkStatusID=445 or "+N.CDGDO.ActualTable+"=INV.Quantity)":"INV.LinkStatusID!=445 and ("+N.CDGDO.ActualTable+" is null or "+N.CDGDO.ActualTable+"<INV.Quantity)":f+="1"==this.Report.Preferences.ExQtyType?"(INV.LinkStatusID=445 or ("+N.CDGDO.ActualColumn+")=INV.Quantity)":"INV.LinkStatusID!=445 and ("+N.CDGDO.ActualColumn+")<INV.Quantity")}if(null!=this.TQDocPrefix&&(this.ReportViewType==r.e.TransactionQuery||this.ReportViewType==r.e.LinkingQuery&&"LINKED_VOUCHERS"==t)){if(null!=this.TQDocPrefix.SelectedValue&&"ALL"!=this.TQDocPrefix.SelectedValue&&(f.length>0&&(f+=" AND "),f+=this.IsInventory?"INV.DocPrefix='"+this.TQDocPrefix.SelectedValue+"'":"ACC.DocPrefix='"+this.TQDocPrefix.SelectedValue+"'"),!o.e.IsEmpty(this.TQDocNo_From.Text)){let e=o.e.Int(this.TQDocNo_From.Text);o.e.IsNum(this.TQDocNo_From.Text)&&(f.length>0&&(f+=" AND "),f+=this.IsInventory?"INV.DocNumber>="+e:"ACC.DocNumber>="+e)}if(!o.e.IsEmpty(this.TQDocNo_To.Text)){let e=o.e.Int(this.TQDocNo_To.Text);o.e.IsNum(this.TQDocNo_To.Text)&&(f.length>0&&(f+=" AND "),f+=this.IsInventory?"INV.DocNumber<="+e:"ACC.DocNumber<="+e)}}if(this.ReportViewType==r.e.LinkingQuery&&"LINKED_SUB_VOUCHERS"==t&&(f.length>0&&(f+=" AND "),f+="INV.VoucherNo='"+this.LinkSubVoucherNo+"'"),this.IsAuthLevelReport&&(f.length>0&&(f+=" AND "),m=this.BaseReportColumns.find(e=>95==e.CDGDO.CategoryValue||103==e.CDGDO.CategoryValue||104==e.CDGDO.CategoryValue||129==e.CDGDO.CategoryValue),f+=m&&95==m.CDGDO.CategoryValue?this.Entities.Contract+".WorkFlowID>0":m&&103==m.CDGDO.CategoryValue?this.Entities.Quotation+".WorkFlowID>0":m&&104==m.CDGDO.CategoryValue?this.Entities["Purchase Contract"]+".WorkFlowID>0":m&&129==m.CDGDO.CategoryValue?this.Entities["Unit Reservation"]+".WorkFlowID>0":this.IsInventory?"INV.WorkFlowID>0":"ACC.WorkFlowID>0 AND ACC.InvDocDetailsID IS NULL"),this.ShowUnAppDocsToApprove)if(this.ShowUnAppDocsToApprove_UseFuncCall)this.IsAuthLevelReport||(f.length>0&&(f+=" AND "),f+=this.IsInventory?"INV.WorkFlowID>0":"ACC.WorkFlowID>0 AND ACC.InvDocDetailsID IS NULL"),f.length>0&&(f+=" AND "),f+=this.IsInventory?F:F.Replace("INV.","ACC.");else{f.length>0&&(f+=" AND ");let e=this.BaseReportColumns.find(e=>95==e.CDGDO.CategoryValue||103==e.CDGDO.CategoryValue||104==e.CDGDO.CategoryValue||129==e.CDGDO.CategoryValue);f+=e&&95==e.CDGDO.CategoryValue?" WF.WID="+this.Entities.Contract+".WorkflowID and WF.LevelID>"+this.Entities.Contract+".WorkFlowLevel and("+this.Entities.Contract+".StatusID = 440 or "+this.Entities.Contract+".StatusID = 466 or "+this.Entities.Contract+".StatusID = 470) AND(WF.Type = 1 or("+this.Entities.Contract+".WorkFlowLevel + 1=WF.LevelID and "+this.Entities.Contract+".StatusID != 470)) ":e&&103==e.CDGDO.CategoryValue?" WF.WID="+this.Entities.Quotation+".WorkflowID and WF.LevelID>"+this.Entities.Quotation+".WorkFlowLevel  and("+this.Entities.Quotation+".StatusID = 440 or "+this.Entities.Quotation+".StatusID = 466 or "+this.Entities.Quotation+".StatusID = 470) AND(WF.Type = 1 or("+this.Entities.Quotation+".WorkFlowLevel + 1=WF.LevelID and "+this.Entities.Quotation+".StatusID != 470)) ":e&&104==e.CDGDO.CategoryValue?" WF.WID="+this.Entities["Purchase Contract"]+".WorkflowID and WF.LevelID>"+this.Entities["Purchase Contract"]+".WorkFlowLevel and("+this.Entities["Purchase Contract"]+".StatusID = 440 or "+this.Entities["Purchase Contract"]+".StatusID = 466 or "+this.Entities["Purchase Contract"]+".StatusID = 470) AND(WF.Type = 1 or("+this.Entities["Purchase Contract"]+".WorkFlowLevel + 1=WF.LevelID and "+this.Entities["Purchase Contract"]+".StatusID != 470)) ":e&&129==e.CDGDO.CategoryValue?" WF.WID="+this.Entities["Unit Reservation"]+".WorkflowID and WF.LevelID>"+this.Entities["Unit Reservation"]+".WorkFlowLevel and("+this.Entities["Unit Reservation"]+".StatusID = 440 or "+this.Entities["Unit Reservation"]+".StatusID = 466 or "+this.Entities["Unit Reservation"]+".StatusID = 470) AND(WF.Type = 1 or("+this.Entities["Unit Reservation"]+".WorkFlowLevel + 1=WF.LevelID and "+this.Entities["Unit Reservation"]+".StatusID != 470)) ":this.IsInventory?F:F.Replace("INV.","ACC.")}else this.ShowMyUnAppDocsToBeApproved&&(f.length>0&&(f+=" AND "),f+=this.IsInventory?F:F.Replace("INV.","ACC."));if(this.IsInventory&&null!=g&&g.SelectedNodes.length>0){let e="";for(let t=0;t<this.Objects.length;t++)if(this.Entities.keys[t].endsWith("_CCMAP")&&0==o.e.stringCompare(this.Objects[t].Table,"COM_DOCCCDATA",!0)){e=this.Entities.keys[t];break}o.e.IsEmpty(e)||(f.length>0&&(f+=" AND "),f+=this.Entities[e]+"."+n+" IN (select NodeID from #TblJobDim)")}this.DocumentFilters.ContainsKey("CRM_Masters_DocumentsTab")&&this.Entities.ContainsKey("Documents_CCMAP")&&(f.length>0&&(f+=" AND "),f+=this.DocumentFilters.CRM_Masters_DocumentsTab.Replace("DCC",this.Entities.Documents_CCMAP)),b=this.BaseReportColumns.find(e=>27295==e.CDGDO.FieldValue),b&&(f.length>0&&(f+=" AND "),f+="  ("+this.Entities[b.CDGDO.CategoryText]+".InviteRefActID>0  OR "+this.Entities[b.CDGDO.CategoryText]+".ActivityID IN (select InviteRefActID from CRM_Activities with(nolock)  where InviteRefActID>0))"),o.e.IsEmpty(i.a.SessionManager.sWHEmpFilteredEmpSeqNos)||(b=this.BaseReportColumns.find(e=>50051==e.CDGDO.CategoryValue||e.CDGDO.IsForeignKey&&50051==e.CDGDO.ParentCostCenterID),b&&(i.a.SessionManager.LocationID>0&&i.a.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&i.a.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(f.length>0&&(f+=" AND "),f+=b.CDGDO.ActualTable+".NodeID in (Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+i.a.SessionManager.LocationID+")"),f.length>0&&(f+=" AND "),f+=this.PayrollWidgetEmpID>0?b.CDGDO.ActualTable+".NodeID in ("+this.PayrollWidgetEmpID+")":b.CDGDO.ActualTable+".NodeID in ("+i.a.SessionManager.sWHEmpFilteredEmpSeqNos+")")),this.WhereTag=f.toString(),this.sbFinalQuery.length>0&&(this.sbFinalQuery+="\r\n UNION ALL \r\n"),0==c.DocID&&this.IsBudgetFound?this.SelectTag=this.SelectTag+","+this.Entities.Budget+".BudgetDefID,"+this.Entities.Budget+".BudgetAllocID":0==c.DocID&&(this.earningfields.length>0||this.Vacationfields.length>0)?this.SelectTag=this.SelectTag+",T0.NodeID  XEmpIDX":this.earningfields.length>0&&(b=this.BaseReportColumns.find(e=>50051==e.CDGDO.CategoryValue||e.CDGDO.IsForeignKey&&50051==e.CDGDO.ParentCostCenterID&&""!=e.CDGDO.ActualTable.toString()),null!=b&&(this.SelectTag=this.SelectTag+","+b.CDGDO.ActualTable+".NodeID  XEmpIDX")),this.sbFinalQuery+="SELECT "+this.SelectTag+"\r\n FROM "+this.FromTag,null!=this.WhereTag&&""!=this.WhereTag&&(this.sbFinalQuery+="\r\n WHERE "+this.WhereTag)}if(this.IsSummaryReportType&&(this.sbFinalQuery="select "+this.SummarySELECT+" from ("+this.sbFinalQuery+") AS T group by "+this.SummaryGROUPBY),this.IsPreProcessQuery&&null!=this.Report&&(this.sbFinalQuery="Select * into PACT2C"+i.a.SessionManager.CompanyIndex+"_TEMP.dbo.RPT_TBL"+this.Report.ReportID+" from ("+this.sbFinalQuery+") as T "),"LINKED_VOUCHERS"==t)this.OrderByTag="DocAbbr,DocPrefix,DocNumber";else{for(let e=0;e<this.ReportGroups.length;e++){let t=this.ReportGroups[e];o.e.IsEmpty(t.Formula.Text)&&(this.OrderByTag.length>0&&(this.OrderByTag+=","),t.Sort.SelectedValue.startsWith("NUM")||t.Sort.SelectedValue.startsWith("TREE")?this.OrderByTag+="["+t.ID+"SORT] "+t.Sort.SelectedValue.substr(4):this.OrderByTag+="VoucherNo"==t.CDGDO.Column&&0==t.CDGDO.IsForeignKey?"["+t.ID+"Abr] "+t.Sort.SelectedValue+",["+t.ID+"prf] "+t.Sort.SelectedValue+",["+t.ID+"dno] "+t.Sort.SelectedValue:"["+t.ID+"] "+t.Sort.SelectedValue)}for(let e=0;e<this.BaseReportColumns.length;e++){let t=this.BaseReportColumns[e];t.IsGroup||o.e.IsEmpty(t.Sort.SelectedValue)||!o.e.IsEmpty(t.Formula.Text)||(this.OrderByTag.length>0&&(this.OrderByTag+=","),t.Sort.SelectedValue.startsWith("NUM")||t.Sort.SelectedValue.startsWith("TREE")?this.OrderByTag+="["+t.ID+"SORT] "+t.Sort.SelectedValue.substr(4):this.OrderByTag+="VoucherNo"==t.CDGDO.Column&&0==t.CDGDO.IsForeignKey&&""!=t.Sort.SelectedValue?"["+t.ID+"Abr] "+t.Sort.SelectedValue+",["+t.ID+"prf] "+t.Sort.SelectedValue+",["+t.ID+"dno] "+t.Sort.SelectedValue:"["+t.ID+"] "+t.Sort.SelectedValue)}null!=this.OrderByTag&&""!=this.OrderByTag&&(this.sbFinalQuery+=" ORDER BY "+this.OrderByTag)}if(this.IsAuthLevelReport)this.sbFinalQuery+="\r\n SELECT WorkFlowID,MAX(LevelID) Levels FROM COM_WorkFlow with(nolock) GROUP BY WorkFlowID";else if(null!=this.LevelColumn){let e,t,s="";this.Entities.Clear(),null!=this.LevelColumn.CDGDO.ChildCDGDO?(e=this.LevelColumn.CDGDO.ChildCDGDO.ParentCostCenterColSysName,t="LT."+this.LevelColumn.CDGDO.ChildCDGDO.Column+" AS "+this.LevelColumn.ID,this.Entities.push(this.LevelColumn.CDGDO.ChildCDGDO.ParentCostCenterSysName,"LT"),t+=this.GetLink_IDColumn("LT",this.LevelColumn)):(e=this.LevelColumn.CDGDO.ParentCostCenterColSysName,t="LT."+this.LevelColumn.CDGDO.Column+" AS "+this.LevelColumn.ID,this.Entities.push(this.LevelColumn.CDGDO.ParentCostCenterSysName,"LT"),t+=this.GetLink_IDColumn("LT",this.LevelColumn));let i=[25900,26428];for(let n=0;n<this.BaseReportColumns.length;n++){let e=this.BaseReportColumns[n];e==this.LevelColumn||null==e.CDGDO.ActualColumn||o.e.IsEmpty(e.CDGDO.Column)||!(e.CDGDO.IsForeignKey&&e.CDGDO.ColumnCostCenterID>0)&&e.CDGDO.IsForeignKey||e.CDGDO.ActualColumn.lastIndexOf(".")>0&&!i.Contains(e.CDGDO.FieldValue)&&(e.CDGDO.IsForeignKey?e.CDGDO.ColumnCostCenterID==this.LevelTreeCostCenterID&&(this.Entities.ContainsKey(e.CDGDO.ParentCostCenterSysName),this.Entities.ContainsKey(e.CDGDO.ParentCostCenterSysName)&&("DATE"==e.CDGDO.DataType?t+=",CONVERT(DATETIME,"+this.Entities[e.CDGDO.ParentCostCenterSysName]+"."+e.CDGDO.Column+") AS "+e.ID:(t+=","+this.Entities[e.CDGDO.ParentCostCenterSysName]+"."+e.CDGDO.Column+" AS "+e.ID,t+=this.GetLink_IDColumn(this.Entities[e.CDGDO.ParentCostCenterSysName],e)))):e.CDGDO.CategoryValue==this.LevelTreeCostCenterID&&this.Entities.ContainsKey(e.CDGDO.Table)&&("DATE"==e.CDGDO.DataType?t+=",CONVERT(DATETIME,"+this.Entities[e.CDGDO.Table]+"."+e.CDGDO.Column+") AS "+e.ID:(t+=","+this.Entities[e.CDGDO.Table]+"."+e.CDGDO.Column+" AS "+e.ID,t+=this.GetLink_IDColumn(this.Entities[e.CDGDO.Table],e))))}null!=this.Report&&null!=this.Filter&&(this.Report.LevelNo=o.e.Int(this.Filter.ShowLevel.Text)),this.sbFinalQuery+=null!=this.Report&&-2==this.Report.LevelNo?"\r\n SELECT "+t+",LT."+e+" AS TreeNodeID,0 Depth,0 ParentID,LT.lft,LT.rgt,LT.IsGroup FROM ":"\r\n SELECT "+t+",LT."+e+" AS TreeNodeID,LT.Depth,LT.ParentID,LT.lft,LT.rgt,LT.IsGroup FROM ",this.sbFinalQuery+=null!=this.LevelColumn.CDGDO.ChildCDGDO?this.LevelColumn.CDGDO.ChildCDGDO.ParentCostCenterSysName:this.LevelColumn.CDGDO.ParentCostCenterSysName,this.sbFinalQuery+=" LT WITH(NOLOCK)"+s,this.sbFinalQuery+=" WHERE ",this.sbFinalQuery+="AccountID"!=this.LevelColumn.CDGDO.ParentCostCenterColSysName&&"ProductID"!=this.LevelColumn.CDGDO.ParentCostCenterColSysName||null!=this.LevelColumn.CDGDO.ChildCDGDO?"LT."+e+">0":"LT."+e+">1",null!=this.Report&&-2==this.Report.LevelNo&&(this.sbFinalQuery+=" and LT.IsGroup=0");for(let o=0;o<this.Filter.CostCenterFilters.length;o++){let t=this.Filter.CostCenterFilters[o];if(t.CostCenterID==this.LevelTreeCostCenterID){if(t.SelectedNodes.length>0||!t.DeleteButtonVisibility){this.sbFinalQuery+=" AND "+e+" IN (";for(let e=0;e<t.SelectedNodes.length;e++)e>0&&(this.sbFinalQuery+=","),this.sbFinalQuery+=t.SelectedNodes[e].Id;0==t.SelectedNodes.length&&(this.sbFinalQuery+=-12912),this.sbFinalQuery+=")"}break}}this.sbFinalQuery+=" ORDER BY lft"}else this.IsBudgetNewFound&&(this.sbFinalQuery+="\r\n SELECT D.CostCenterID,CONVERT(DATETIME,FinYearStartDate) StartDate FROM COM_BudgetDef B with(nolock),COM_BudgetDefDims D with(nolock) WHERE B.BudgetDefID="+l+" AND B.BudgetDefID=D.BudgetDefID\n                select * from COM_BudgetAlloc with(nolock) WHERE BudgetDefID="+l);if(this.earningfields.length>0){var S=this.Filter.Fields.find(e=>null!=e.CDGDO.DataType&&"DATE"==e.CDGDO.DataType.toUpperCase()&&50051==e.CDGDO.CategoryValue&&-601==e.CDGDO.FieldValue);this.sbFinalQuery+=null!=S?" SELECT Convert(DateTime,P.EffectFrom) as CEffectFrom,Convert(DateTime,P.ApplyFrom) as CApplyFrom, P.* FROM PAY_EMPPAY P with(nolock), COM_CC50051 C with(nolock) WHERE C.NodeID>2 AND C.NodeID=P.EmployeeID AND P.SeqNo IN (SELECT TOP 1 SeqNo FROM PAY_EMPPAY with(nolock) WHERE EmployeeID=C.NodeID AND Convert(DateTime,EffectFrom) <='"+S.FromDatePicker.Date.ToString("dd MMM yyyy")+"' ORDER BY EffectFrom DESC)":" SELECT Convert(DateTime,P.EffectFrom) as CEffectFrom,Convert(DateTime,P.ApplyFrom) as CApplyFrom, P.* FROM PAY_EMPPAY P with(nolock), COM_CC50051 C with(nolock) WHERE C.NodeID>2 AND C.NodeID=P.EmployeeID AND P.SeqNo IN (SELECT TOP 1 SeqNo FROM PAY_EMPPAY with(nolock) WHERE EmployeeID=C.NodeID ORDER BY EffectFrom DESC)"}if(null!=g&&g.SelectedNodes.length>0&&(this.sbFinalQuery=c+this.sbFinalQuery,this.sbFinalQuery+=" \r\n DROP TABLE #TblJobDim"),this.ShowUnAppDocsToApprove&&!this.ShowUnAppDocsToApprove_UseFuncCall&&(i.a.SessionManager.IsEmpUser&&i.a.SessionManager.IsRptManagerUser?(this.sbFinalQuery="create table #TblUsrWF(WID int,LevelID int,Type int,CtWef float,LvWef int)\n                EXEC spRPT_GetReportData @Type=8,@Param1="+i.a.SessionManager.UserID+",@strXML=null,@RoleID=-1\n"+this.sbFinalQuery,this.sbFinalQuery+=" \r\n DROP TABLE #TblUsrWF"):(this.sbFinalQuery="create table #TblUsrWF(WID int,LevelID int,Type int,CtWef float,LvWef int)\n                EXEC spRPT_GetReportData @Type=8,@Param1="+i.a.SessionManager.UserID+",@strXML=null,@RoleID="+i.a.SessionManager.RoleID+"\n"+this.sbFinalQuery,this.sbFinalQuery+=" \r\n DROP TABLE #TblUsrWF")),this.Filter.IsReportViewScreen&&this.Report.Preferences.ContainsKey("NoDataGroups")&&this.ReportGroups.length>0&&"1"==this.ReportGroups[0].Visibility.SelectedValue){var O=this.ReportGroups[0];let e,t,s;if(this.Entities.Clear(),s=null!=O.CDGDO.ChildCDGDO?O.CDGDO.ChildCDGDO:O.CDGDO,e=s.ParentCostCenterColSysName,t="NG."+s.Column+" AS "+O.ID,this.Entities.push(s.ParentCostCenterSysName,"NG"),O.CDGDO.IsForeignKey&&O.CDGDO.ColumnCostCenterID>0&&O.CDGDO.ActualColumn.lastIndexOf(".")>0&&(this.Entities.ContainsKey(s.ParentCostCenterSysName),this.Entities.ContainsKey(s.ParentCostCenterSysName)))if(t=this.Entities[s.ParentCostCenterSysName]+"."+s.Column+" AS NoDataGroup",O.IsReportMappingFilter){let e=O.CDGDO.IsForeignKey?O.CDGDO.ParentCostCenterID:O.CDGDO.CategoryValue;400!=e&&(e<4e4||e>5e4)&&("NULL"!=O.CDGDO.ActualColumn?(this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(t=>t.FeatureID==e),t+=","+this.Entities[O.CDGDO.ParentCostCenterSysName]+"."+this.drrCCTbl[0].PK.toString()+" AS ["+O.ID+"_ID]"):t+=",NULL AS ["+O.ID+"_ID]")}else if("3"==O.LinkType.SelectedValue||"4"==O.LinkType.SelectedValue){let e=O.CDGDO.IsForeignKey?O.CDGDO.ParentCostCenterID:O.CDGDO.CategoryValue;400!=e&&(e<4e4||e>5e4)&&("NULL"!=O.CDGDO.ActualColumn?(this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(t=>t.FeatureID==e),t+=","+this.Entities[O.CDGDO.ParentCostCenterSysName]+"."+this.drrCCTbl[0].PK.toString()+" AS ["+O.ID+"_ID]"):t+=",NULL AS ["+O.ID+"_ID]")}if(t.length>0){this.IsNoDataGroups=!0,this.sbFinalQuery+="\r\n SELECT "+t+", IsGroup FROM ",this.sbFinalQuery+=s.ParentCostCenterSysName,this.sbFinalQuery+=" NG WITH(NOLOCK)",this.sbFinalQuery+=" WHERE IsGroup=0";for(let t=0;t<this.Filter.CostCenterFilters.length;t++){let s=this.Filter.CostCenterFilters[t];if(s.CostCenterID==O.CDGDO.ColumnCostCenterID){if(s.SelectedNodes.length>0||!s.DeleteButtonVisibility){this.sbFinalQuery+=" AND NG."+e+" IN (";for(let e=0;e<s.SelectedNodes.length;e++)e>0&&(this.sbFinalQuery+=","),this.sbFinalQuery+=s.SelectedNodes[e].Id;0==s.SelectedNodes.length&&(this.sbFinalQuery+=-12912),this.sbFinalQuery+=")"}break}}this.sbFinalQuery+=" ORDER BY NoDataGroup"}}this.FinalQuery=this.sbFinalQuery.toString()}catch(g){Logger.ErrorLog("SetQueryXMLTags :: "+g.stack)}}SetQueryXMLTagsForStaticReports(){let e,t,s=0,l="",r=!1,D=!1,C=!1,h="",I="",d="";this.DbGroupSelectTag="";let T=new n.a;if(9==this.StaticReportType||10==this.StaticReportType||198==this.StaticReportType?l="B":(l="DCC",this.Entities.push("Documents",150==this.StaticReportType?"ACC":"D")),1==this.StaticReportType||86==this.StaticReportType||2==this.StaticReportType||3==this.StaticReportType||4==this.StaticReportType||200==this.StaticReportType?(this.Entities.push("Account","A1"),this.IsInventory=!1,1==this.StaticReportType&&(T.push("Documents","D"),this.ReportParams.push("ProductSelect",""),this.ReportParams.push("ProductFrom",""))):this.StaticReportType>=5&&this.StaticReportType<=12||198==this.StaticReportType||185==this.StaticReportType?this.Entities.push("Account","A"):118==this.StaticReportType?this.Entities.push("Asset Management","A"):73==this.StaticReportType||this.StaticReportType>=209&&this.StaticReportType<=215?(this.Entities.push("Contract","C"),this.Entities.push("Contract.Property","P"),this.Entities.push("Contract.Unit","U"),this.Entities.push("Contract.Tenant","T"),this.Entities.push("Contract.PropertyID","P"),this.Entities.push("Contract.UnitID","U"),this.Entities.push("Contract.TenantID","T"),this.Entities.push("ContractREN_ContractParticulars","CP"),this.Entities.push("Units","U")):87==this.StaticReportType?(this.Entities.push("Contract.Unit","U"),this.Entities.push("Contract.UnitID","U"),this.Entities.push("Units","U")):196==this.StaticReportType||(13==this.StaticReportType||14==this.StaticReportType||15==this.StaticReportType||16==this.StaticReportType||81==this.StaticReportType||82==this.StaticReportType||83==this.StaticReportType||84==this.StaticReportType||112==this.StaticReportType||114==this.StaticReportType||115==this.StaticReportType||158==this.StaticReportType||165==this.StaticReportType||195==this.StaticReportType||203==this.StaticReportType||204==this.StaticReportType?(this.Entities.push("Product","P"),82==this.StaticReportType?this.Entities.Add("Batch","B"):203!=this.StaticReportType&&204!=this.StaticReportType||this.Entities.push("Documents.Product Name","P")):this.IsInventory=!0),this.DocumentFilters.ContainsKey("GLParticularSelect")&&(this.DocumentFilters.Remove("GLParticularSelect"),this.DocumentFilters.Remove("GLParticularFrom")),1==this.StaticReportType||2==this.StaticReportType||3==this.StaticReportType||13==this.StaticReportType||81==this.StaticReportType||82==this.StaticReportType||86==this.StaticReportType||94==this.StaticReportType||95==this.StaticReportType||111==this.StaticReportType||150==this.StaticReportType||156==this.StaticReportType||158==this.StaticReportType||185==this.StaticReportType||195==this.StaticReportType||200==this.StaticReportType||203==this.StaticReportType||204==this.StaticReportType||207==this.StaticReportType||-2==this.StaticReportType){let i=new Array;i.AddRange(this.BaseReportColumns),i.AddRange(this.ReportGroups);for(let n=0;n<i.length;n++){let y=i[n];if(e=y.CDGDO,33==y.ID.length)if(400==e.CategoryValue||401==e.CategoryValue||402==e.CategoryValue||Math.abs(e.CategoryValue)>4e4&&Math.abs(e.CategoryValue)<5e4){if(1==this.StaticReportType&&[23150,23822,23823,23824,11491,11676].Contains(e.FieldValue)){if(e.ActualColumn=null,3==e.ColumnCostCenterID)T.ContainsKey(e.CategoryText)||T.push(e.CategoryText,"P"),"INV_Product"==e.Table?e.ActualColumn=T[e.CategoryText]+"."+e.Column:"INV_ProductExtended"==e.Table?(t=e.CategoryText+"INV_ProductExtended",T.ContainsKey(t)||(T.push(t,"PRODEXT"),this.ReportParams.ProductFrom+=" LEFT JOIN INV_ProductExtended AS "+T[t]+" with(nolock) ON P.ProductID=PRODEXT.ProductID"),e.ActualColumn=T[t]+"."+e.Column):null!=e.ChildCDGDO&&e.ChildCDGDO.IsForeignKey&&(T.ContainsKey(e.ChildCDGDO.CategoryText)||(t="T"+ ++s,T.push(e.ChildCDGDO.CategoryText,t),0==o.e.stringCompare(e.ChildCDGDO.ParentTable,"COM_CCCCData",!0)?(T.ContainsKey("CC")||(T.push("CC","CC"),this.ReportParams.ProductFrom+=" LEFT JOIN COM_CCCCData CC with(nolock) ON CC.NodeID=P.ProductID AND CC.CostCenterID="+e.ChildCDGDO.CategoryValue),this.ReportParams.ProductFrom+=" LEFT JOIN "+e.ChildCDGDO.ParentCostCenterSysName+" AS "+t+" with(nolock) ON "+t+"."+e.ChildCDGDO.ParentCostCenterColSysName+"=CC."+e.ChildCDGDO.ParentColumn):this.ReportParams.ProductFrom+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+t+" with(nolock) ON "+t+"."+e.ChildCDGDO.ParentCostCenterColSysName+"="+T.Product+"."+e.ChildCDGDO.ParentColumn,e.ActualColumn=t+"."+e.ChildCDGDO.Column));else{if(!T.ContainsKey(e.CategoryText))return;e.ActualColumn=T[e.CategoryText]+"."+e.Column}null!=e.ActualColumn&&(this.ReportParams.ProductSelect+=","+e.ActualColumn+" ["+y.ID+"]");continue}if(207==e.FieldValue){if(this.DocumentFilters.ContainsKey("GLParticularSelect")||(this.DocumentFilters.push("GLParticularSelect","A.AccountID"),this.DocumentFilters.push("GLParticularFrom","ACC_Accounts A with(nolock)")),"ACC_Accounts"==e.Table){this.DocumentFilters.GLParticularSelect+=",A."+e.Column+" AS ["+y.ID+"]";continue}if("ACC_AccountsExtended"==e.Table){t=e.CategoryText+"ACC_AccountsExtended",this.Entities.ContainsKey(t)||(this.Entities.push(t,"ACCEXT"),this.DocumentFilters.GLParticularFrom+=" LEFT JOIN ACC_AccountsExtended AS "+this.Entities[t]+" with(nolock) ON A.AccountID=ACCEXT.AccountID"),this.DocumentFilters.GLParticularSelect+=",ACCEXT."+e.Column+" AS ["+y.ID+"]";continue}if("COM_ADDRESS"==e.Table.toUpperCase()){t=e.CategoryText+"COM_ADDRESS",this.Entities.ContainsKey(t)||(this.Entities.push(t,"ACCADD"),this.DocumentFilters.GLParticularFrom+=" LEFT JOIN COM_ADDRESS AS "+this.Entities[t]+" with(nolock) ON ACCADD.AddressTypeID=1 AND ACCADD.FeatureID=2 AND A.AccountID=ACCADD.FeaturePK"),this.DocumentFilters.GLParticularSelect+=",ACCADD."+e.Column+" AS ["+y.ID+"]";continue}if("Shipping_Address"==e.Table||"Billing_Address"==e.Table){this.DocumentFilters.GLParticularSelect+=",(select "+this.GetAddressColumn(e.Column.substr(5))+" from COM_ADDRESS with(nolock) where AddressID=(select min(AddressID) from COM_ADDRESS with(nolock) where AddressTypeID="+("Shipping_Address"==e.Table?"3":"2")+" and FeatureID=2 AND A.AccountID=FeaturePK)) AS ["+y.ID+"]";continue}continue}if(401==e.CategoryValue||402==e.CategoryValue||Math.abs(e.CategoryValue)>4e4&&Math.abs(e.CategoryValue)<5e4)if("COM_DocTextData"==e.Table){this.Entities.ContainsKey(e.CategoryText)||this.Entities.push(e.CategoryText,this.Entities.Documents),t=e.CategoryText+"COM_DocTextData";let s=this.FieldsDialog.DocumentTypes.filter(t=>t.CostCenterID==Math.abs(e.CategoryValue));s.length>0&&Object(a.j)(s[0].IsInventory)?(this.Entities.ContainsKey(t)||this.Entities.push(t,"DOCTEXT"),r||(d+=" LEFT JOIN COM_DocTextData AS "+this.Entities[t]+" with(nolock) ON "+this.Entities[t]+".InvDocDetailsID="+this.Entities.Documents+".InvDocDetailsID"),r=!0):(this.Entities.ContainsKey(t)||this.Entities.push(t,"DOCATEXT"),D||(d+=" LEFT JOIN COM_DocTextData AS "+this.Entities[t]+" with(nolock) ON "+this.Entities[t]+".AccDocDetailsID="+this.Entities.Documents+".AccDocDetailsID"),D=!0),e.ParentCDGDO=new u.a}else if("COM_DocNumData"==e.Table){if(this.Entities.ContainsKey(e.CategoryText)||this.Entities.push(e.CategoryText,this.Entities.Documents),1==this.StaticReportType||2==this.StaticReportType||3==this.StaticReportType||86==this.StaticReportType||156==this.StaticReportType){188==e.FieldValue?(e.ActualColumn="CASE WHEN D.InvDocDetailsID is null THEN NULL ELSE\n(SELECT top 1 (select top 1 X.value('@Remarks','nvarchar(max)') from NUM.Remarks.nodes('/XML/Row') as Data(X) where ",o.e.IsEmpty(e.Formula)?e.ActualColumn+="X.value('@CreditAcount','bigint')=A1.AccountID or X.value('@DebitAcount','bigint')=A1.AccountID":e.ActualColumn+="X.value('@Columnname','nvarchar(50)')='dcNum"+e.Formula+"'",e.ActualColumn+=") FROM COM_DocNumData NUM WITH(NOLOCK) WHERE NUM.InvDocDetailsID=D.InvDocDetailsID) end",h+=","+e.ActualColumn+" AS ["+y.ID+"]",this.SelectTagAliasOnly+=","+y.ID):(this.FieldsDialog.DocumentTypes.filter(t=>t.CostCenterID==Math.abs(e.CategoryValue)),e.ActualColumn=this.FieldsDialog.DocumentTypes.length>0&&Object(a.j)(this.FieldsDialog.DocumentTypes[0].IsInventory)?" CASE WHEN D.CostCenterID="+Math.abs(e.CategoryValue)+" THEN (select sum("+e.Column+") from COM_DocNumData with(nolock) where InvDocDetailsID in (select InvDocDetailsID FROM INV_DocDetails with(nolock) WHERE VoucherNo=D.VoucherNo)) ELSE NULL END ":" CASE WHEN D.CostCenterID="+Math.abs(e.CategoryValue)+" THEN (select sum("+e.Column+") from COM_DocNumData with(nolock) where AccDocDetailsID in (select AccDocDetailsID FROM ACC_DocDetails with(nolock) WHERE VoucherNo=D.VoucherNo)) ELSE NULL END ",h+=","+e.ActualColumn+" AS ["+y.ID+"]",this.SelectTagAliasOnly+=","+y.ID);continue}t=e.CategoryText+"COM_DocNumData",this.Entities.ContainsKey(t)||this.Entities.push(t,"DOCNUM"),C||(d+=this.IsInventory?" LEFT JOIN COM_DocNumData AS "+this.Entities[t]+" with(nolock) ON "+this.Entities[t]+".InvDocDetailsID="+this.Entities.Documents+".InvDocDetailsID":" LEFT JOIN COM_DocNumData AS "+this.Entities[t]+" with(nolock) ON "+this.Entities[t]+".AccDocDetailsID="+this.Entities.Documents+".AccDocDetailsID"),C=!0,e.ParentCDGDO=new u.a}else if(2==e.ColumnCostCenterID&&-2!=this.StaticReportType&&0!=o.e.stringCompare(e.Formula,"LATEST")&&0!=o.e.stringCompare(e.Formula,"OLDEST")){let t=e.ParentColumn;this.Entities.ContainsKey(t)||(this.Entities.push(t,"T"+ ++s),d+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[t]+" with(nolock) ON "+this.Entities[t]+"."+e.ParentCostCenterColSysName+"="+this.Entities.Documents+"."+e.ParentColumn),e.ActualColumn=" CASE WHEN "+this.Entities.Documents+".CostCenterID="+Math.abs(e.CategoryValue)+" THEN "+this.Entities[t]+"."+e.Column+" ELSE NULL END",I+=","+e.ActualColumn,h+=","+e.ActualColumn+" AS ["+y.ID+"]",this.SelectTagAliasOnly+=","+y.ID;continue}if(e.ColumnCostCenterID>0&&null!=e.ParentTableAlias&&e.ParentTableAlias.Contains("_CCMAP")){if(this.Entities.ContainsKey(e.CategoryText)||(this.Entities.push(e.CategoryText,"T"+ ++s),d+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"="+l+"."+e.ParentColumn),"COM_ADDRESS"==e.Table.toUpperCase()){e.ActualColumn="(select CCADD."+e.Column+" from COM_ADDRESS CCADD with(nolock) where CCADD.AddressTypeID=1 AND CCADD.FeatureID="+e.ColumnCostCenterID+" AND "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"=CCADD.FeaturePK)",h+=","+e.ActualColumn,h+=" AS ["+y.ID+"]",this.SelectTagAliasOnly+=","+y.ID;continue}if(null!=e.ChildCDGDO&&!this.Entities.ContainsKey(e.ChildCDGDO.CategoryText))if("COM_CCCCDATA"==e.ChildCDGDO.ParentTable)this.Entities.ContainsKey(e.ChildCDGDO.ParentTableAlias)||(this.Entities.push(e.ChildCDGDO.ParentTableAlias,"T"+ ++s),d+=" LEFT JOIN COM_CCCCDATA AS "+this.Entities[e.ChildCDGDO.ParentTableAlias]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"="+this.Entities[e.ChildCDGDO.ParentTableAlias]+".NodeID and "+this.Entities[e.ChildCDGDO.ParentTableAlias]+".CostCenterID="+e.ParentCostCenterID),this.Entities.ContainsKey(e.ChildCDGDO.CategoryText)||(this.Entities.push(e.ChildCDGDO.CategoryText,"T"+ ++s),d+=" LEFT JOIN "+e.ChildCDGDO.ParentCostCenterSysName+" AS "+this.Entities[e.ChildCDGDO.CategoryText]+" with(nolock) ON "+this.Entities[e.ChildCDGDO.CategoryText]+"."+e.ChildCDGDO.ParentCostCenterColSysName+"="+this.Entities[e.ChildCDGDO.ParentTableAlias]+"."+e.ChildCDGDO.ParentColumn);else if(e.ChildCDGDO.ParentColumn.startsWith("ccAlpha")||e.ChildCDGDO.ParentColumn.startsWith("Alpha")||e.ChildCDGDO.ParentColumn.startsWith("alpha")){e.ActualColumn=" case when isnumeric("+this.Entities[e.CategoryText]+"."+e.ChildCDGDO.ParentColumn+")=1 then (select "+e.ChildCDGDO.Column+" from "+e.ChildCDGDO.ParentCostCenterSysName+" with(nolock) where "+e.ChildCDGDO.ParentCostCenterColSysName+"="+this.Entities[e.CategoryText]+"."+e.ChildCDGDO.ParentColumn+") else null end",h+=","+e.ActualColumn+" AS ["+y.ID+"]",this.SelectTagAliasOnly+=","+y.ID;continue}}else{if(2==e.ColumnCostCenterID&&156==this.StaticReportType){e.ActualColumn=" CASE WHEN D.CostCenterID="+Math.abs(e.CategoryValue)+" THEN (select "+e.Column+" from Acc_Accounts with(nolock) where AccountID =D."+e.ParentColumn+") ELSE NULL END ",h+=","+e.ActualColumn+" AS ["+y.ID+"]",this.SelectTagAliasOnly+=","+y.ID;continue}113==e.ColumnCostCenterID?this.Entities.ContainsKey(e.CategoryText)||(this.Entities.push(e.CategoryText,"T"+ ++s),d+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"="+this.Entities.Documents+"."+e.ParentColumn):12==e.ParentCostCenterID||16==e.ParentCostCenterID?this.Entities.ContainsKey(e.CategoryText)||(this.Entities.push(e.CategoryText,12==e.ParentCostCenterID?"T"+ ++s+"CUR":"T"+ ++s),d+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"="+this.Entities.Documents+"."+e.ParentColumn):7==e.ColumnCostCenterID?this.Entities.ContainsKey(e.CategoryText)||(this.Entities.push(e.CategoryText,"T"+ ++s),d+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"="+this.Entities.Documents+"."+e.ParentColumn):3!=e.ColumnCostCenterID||203!=this.StaticReportType&&204!=this.StaticReportType||this.Entities.ContainsKey(e.CategoryText)||(this.Entities.push(e.CategoryText,"T"+ ++s),d+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"="+this.Entities.Documents+"."+e.ParentColumn)}-2!=this.StaticReportType&&81!=this.StaticReportType||(2==e.ColumnCostCenterID?this.Entities.ContainsKey(e.CategoryText)||(this.Entities.push(e.CategoryText,"A"+ ++s),d+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"="+this.Entities.Documents+"."+e.ParentColumn):3==e.ColumnCostCenterID&&(this.Entities.ContainsKey(e.CategoryText)||(this.Entities.push(e.CategoryText,"PRD"),d+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"="+this.Entities.Documents+"."+e.ParentColumn)));try{if(400==e.CategoryValue)if(214==e.FieldValue){let t="",s=o.e.IsEmpty(e.DimensionsFilter)?[]:e.DimensionsFilter.split("~");if(s.length>2&&s[1].length>0&&s[2].length>0){let i=s[2].split(",");for(let e=0;e<i.length;e++)e>0&&(t+=","),i[e].startsWith("EFPRD_")?t+="P."+i[e].Replace("EFPRD_",""):i[e].startsWith("EF_")&&(t=this.SetExtFunctionParams(i[e],t));t.length>0&&(e.ActualColumn="dbo."+s[1]+"("+t+")")}else e.ActualColumn="null "}else if(11515==y.CDGDO.FieldValue)h+=",stuff((select ','+[GUID]+'.'+FileExtension from COM_Files WITH(NOLOCK) WHERE FeatureID="+this.Entities.Documents+".CostCenterID AND FeaturePK="+this.Entities.Documents+".DocID FOR XML PATH('')),1,1,'') "+y.ID+"_ID",this.SelectTagAliasOnly+=","+y.ID+"_ID",e.ActualColumn="stuff((select ', '+ActualFileName from COM_Files WITH(NOLOCK) WHERE FeatureID="+this.Entities.Documents+".CostCenterID AND FeaturePK="+this.Entities.Documents+".DocID FOR XML PATH('')),1,2,'')";else if(11484==y.CDGDO.FieldValue)e.ActualColumn="(SELECT VoucherNo FROM INV_DocDetails with(nolock)\tWHERE InvDocDetailsID IN (select LinkedInvDocDetailsID from INV_DocDetails with(nolock) WHERE InvDocDetailsID="+this.Entities.Documents+".InvDocDetailsID and LinkedInvDocDetailsID>0))";else if(11514==y.CDGDO.FieldValue)e.ActualColumn="(SELECT convert(datetime,DocDate) FROM INV_DocDetails with(nolock)\tWHERE InvDocDetailsID IN (select LinkedInvDocDetailsID from INV_DocDetails with(nolock) WHERE InvDocDetailsID="+this.Entities.Documents+".InvDocDetailsID and LinkedInvDocDetailsID>0))";else if(21358==y.CDGDO.FieldValue)this.Entities.ContainsKey(e.CategoryText)||(this.Entities.push(e.CategoryText,"DocumentType"),d+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"="+this.Entities.Documents+"."+e.ParentColumn),e.ActualColumn="DocumentType.DocumentName";else if(11413==y.CDGDO.FieldValue)e.ActualColumn="D.BankAccountID";else{let t=new c;t.DocID=-1,t.IsInventory=this.IsInventory,this.SetActualColumn(e,t)}else 0==o.e.stringCompare(e.Formula,"LATEST")||0==o.e.stringCompare(e.Formula,"OLDEST")?e.ActualColumn=this.GetLatestOldestQuery(e,"P",""):(this.Entities.ContainsKey(e.CategoryText)||this.Entities.push(e.CategoryText,this.Entities.Documents),this.SetActualColumn_1(e));I+=","+e.ActualColumn,h+=","+e.ActualColumn,h+=" AS ["+y.ID+"]",this.SelectTagAliasOnly+=","+y.ID,("3"==y.LinkType.SelectedValue||"4"==y.LinkType.SelectedValue)&&e.ColumnCostCenterID>5e4&&(h+=","+e.ActualTable+".NodeID",h+=" ["+y.ID+"_ID]",this.SelectTagAliasOnly+=","+y.ID+"_ID")}catch(m){}}else if(2==e.CategoryValue){if("ACC_AccountsExtended"==e.Table){t=e.CategoryText+"ACC_AccountsExtended",this.Entities.ContainsKey(t)||(this.Entities.push(t,"ACCEXT"),this.GroupFromTag+=" LEFT JOIN ACC_AccountsExtended AS "+this.Entities[t]+" with(nolock) ON "+this.Entities.Account+".AccountID=ACCEXT.AccountID"),this.GroupSelectTag+=",ACCEXT."+e.Column+" AS ["+y.ID+"]",this.GroupSelectTagAlias+=","+y.ID;continue}if("COM_ADDRESS"==e.Table.toUpperCase()){t=e.CategoryText+"COM_ADDRESS",this.Entities.ContainsKey(t)||(this.Entities.push(t,"ACCADD"),this.GroupFromTag+=" LEFT JOIN COM_ADDRESS AS "+this.Entities[t]+" with(nolock) ON ACCADD.AddressTypeID=1 AND ACCADD.FeatureID=2 AND "+this.Entities.Account+".AccountID=ACCADD.FeaturePK"),this.GroupSelectTag+=",ACCADD."+e.Column+" AS ["+y.ID+"]",this.GroupSelectTagAlias+=","+y.ID;continue}if("Shipping_Address"==e.Table||"Billing_Address"==e.Table){this.GroupSelectTag+=",(select "+this.GetAddressColumn(e.Column.substr(5))+" from COM_ADDRESS with(nolock) where AddressID=(select min(AddressID) from COM_ADDRESS with(nolock) where AddressTypeID="+("Shipping_Address"==e.Table?"3":"2")+" and FeatureID=2 AND "+this.Entities.Account+".AccountID=FeaturePK)) AS ["+y.ID+"]",this.GroupSelectTagAlias+=","+y.ID;continue}if(e.IsForeignKey&&(this.Entities.ContainsKey(e.CategoryText)||(t="T"+ ++s,this.Entities.push(e.CategoryText,t),0==o.e.stringCompare(e.ParentTable,"COM_CCCCData",!0)?(this.Entities.ContainsKey("CC")||(this.Entities.push("CC","CC"),this.GroupFromTag+=" LEFT JOIN COM_CCCCData CC with(nolock) ON CC.NodeID=P.AccountID AND CC.CostCenterID="+e.CategoryValue),this.GroupFromTag+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"=CC."+e.ParentColumn):this.GroupFromTag+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"="+this.Entities.Account+"."+e.ParentColumn)),!this.Entities.ContainsKey(e.CategoryText))return;let i=new c;i.DocID=-1,i.IsInventory=this.IsInventory,this.SetActualColumn(e,i),this.GroupSelectTag+=","+e.ActualColumn+" AS ["+y.ID+"]",this.GroupSelectTagAlias+=","+y.ID}else if(3==e.CategoryValue){if("INV_ProductExtended"==e.Table){t=e.CategoryText+"INV_ProductExtended",this.Entities.ContainsKey(t)||(this.Entities.push(t,"PRODEXT"),this.GroupFromTag+=" LEFT JOIN INV_ProductExtended AS "+this.Entities[t]+" with(nolock) ON P.ProductID=PRODEXT.ProductID"),this.DbGroupSelectTag+=",PRODEXT."+e.Column,this.GroupSelectTag+=",PRODEXT."+e.Column+" AS ["+y.ID+"]",this.GroupSelectTagAlias+=","+y.ID;continue}if(e.IsForeignKey&&(this.Entities.ContainsKey(e.CategoryText)||(t="T"+ ++s,this.Entities.push(e.CategoryText,t),0==o.e.stringCompare(e.ParentTable,"COM_CCCCData",!0)?(this.Entities.ContainsKey("CC")||(this.Entities.push("CC","CC"),this.GroupFromTag+=" LEFT JOIN COM_CCCCData CC with(nolock) ON CC.NodeID=P.ProductID AND CC.CostCenterID="+e.CategoryValue),this.GroupFromTag+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"=CC."+e.ParentColumn):this.GroupFromTag+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"="+this.Entities.Product+"."+e.ParentColumn)),!this.Entities.ContainsKey(e.CategoryText))return;let i=new c;i.DocID=-1,i.IsInventory=this.IsInventory,this.SetActualColumn(e,i),this.DbGroupSelectTag+=","+e.ActualColumn,this.GroupSelectTag+=","+e.ActualColumn+" AS ["+y.ID+"]",this.GroupSelectTagAlias+=","+y.ID}else if(16==e.CategoryValue){if(e.IsForeignKey&&(this.Entities.ContainsKey(e.CategoryText)||(t="T"+ ++s,this.Entities.push(e.CategoryText,t),0==o.e.stringCompare(e.ParentTable,"COM_CCCCData",!0)?(this.Entities.ContainsKey("CC")||(this.Entities.push("CC","CC"),this.GroupFromTag+=" LEFT JOIN COM_CCCCData CC with(nolock) ON CC.NodeID=B.BatchID AND CC.CostCenterID="+e.CategoryValue),this.GroupFromTag+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"=CC."+e.ParentColumn):this.GroupFromTag+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"="+this.Entities.Product+"."+e.ParentColumn)),!this.Entities.ContainsKey(e.CategoryText))return;let i=new c;i.DocID=-1,i.IsInventory=this.IsInventory,this.SetActualColumn(e,i),this.DbGroupSelectTag+=","+e.ActualColumn,this.GroupSelectTag+=","+e.ActualColumn+" AS ["+y.ID+"]",this.GroupSelectTagAlias+=","+y.ID}}112==this.CostCenterID&&(h+=",D.InvDocDetailsID ReorderDetailsID",this.SelectTagAliasOnly+=",ReorderDetailsID"),this.DbSelectTag=I.toString(),this.SelectTag=h.toString(),this.FromTag=d.toString()}else if(9==this.StaticReportType||10==this.StaticReportType||11==this.StaticReportType||198==this.StaticReportType){let n=!1,l=new Array;l.AddRange(this.BaseReportColumns),l.AddRange(this.ReportGroups);let r=!1,D="DocNo";"ReportViewModel"==this.ClassName&&this.Report.Preferences.ContainsKey("FIFO")&&"1"==this.Report.Preferences.FIFO&&(r=!0,D="VoucherNo");for(let C=0;C<l.length;C++){let u=l[C];if(e=u.CDGDO,33==u.ID.length)if(400==e.CategoryValue||401==e.CategoryValue||Math.abs(e.CategoryValue)>4e4&&Math.abs(e.CategoryValue)<5e4){if(n=!0,400==e.CategoryValue){if(214==e.FieldValue){let t="",s=o.e.IsEmpty(e.DimensionsFilter)?[]:e.DimensionsFilter.split("~");if(s.length>2&&s[1].length>0&&s[2].length>0){let e=s[2].split(",");for(let s=0;s<e.length;s++)s>0&&(t+=","),e[s].startsWith("EFPBW_")?t+="B."+e[s].Replace("EFPBW_",""):e[s].startsWith("EF_")?t=this.SetExtFunctionParams(e[s],t):t+="null";h+=t.length>0?",dbo."+s[1]+"("+t+")"+u.ID:",null "+u.ID}else h+=",null "+u.ID}else if(0==e.ColumnCostCenterID)"AmountFC"==e.Column?h+=",B."+e.Column+" "+u.ID:"ExchangeRate"==e.Column?h+=r?",B.ExchangeRate "+u.ID:",B.AdjExchRT "+u.ID:"CurrencyID"==e.ParentColumn?(this.Entities.ContainsKey(e.CategoryText)||(t="T"+ ++s,this.Entities.push(e.CategoryText,t),d+=" INNER JOIN "+e.ParentCostCenterSysName+" AS "+t+" with(nolock) ON "+t+".CurrencyID=",d+=r?"B.CurrencyID":"B.AdjCurrID"),h+=","+this.Entities[e.CategoryText]+"."+e.Column+" AS "+u.ID):"ChequeNumber"==e.Column||"ChequeDate"==e.Column||"ChequeMaturityDate"==e.Column?r?(e.ActualColumn="DATE"==e.DataType?"convert(datetime,B."+e.Column+")":"B."+e.Column,h+=",MAX("+e.ActualColumn+") "+u.ID,this.SelectTagAliasOnly+=","+u.ID):(e.ActualColumn="DATE"==e.DataType?"convert(datetime,DOC."+e.Column+")":"DOC."+e.Column,h+=",CASE WHEN DType.IsInventory=0 THEN (SELECT MAX("+e.ActualColumn+") FROM Acc_DocDetails DOC WITH(NOLOCK) WHERE DOC.VoucherNo=B.DocNo) ELSE NULL END "+u.ID):11516==e.FieldValue?h+=",CASE WHEN DType.IsInventory=0 THEN\nstuff((SELECT ','+N.Note FROM Acc_DocDetails DOC WITH(NOLOCK) INNER JOIN COM_Notes N WITH(NOLOCK) ON N.FeatureID=DOC.CostCenterID AND N.FeaturePK=DOC.DocID WHERE DOC.VoucherNo=B."+D+" FOR XML PATH('')),1,1,'')\nELSE\nstuff((SELECT ','+N.Note FROM INV_DocDetails DOC WITH(NOLOCK) INNER JOIN COM_Notes N WITH(NOLOCK) ON N.FeatureID=DOC.CostCenterID AND N.FeaturePK=DOC.DocID WHERE DOC.VoucherNo=B."+D+" FOR XML PATH('')),1,1,'')  END AS "+u.ID:11484==u.CDGDO.FieldValue?h+=",CASE WHEN DType.IsInventory=0 THEN NULL ELSE\n(STUFF((SELECT distinct ','+VoucherNo FROM INV_DocDetails with(nolock) WHERE InvDocDetailsID IN \n(select LinkedInvDocDetailsID from INV_DocDetails with(nolock) WHERE VoucherNo=B.DocNo and LinkedInvDocDetailsID>0) FOR XML PATH('')),1,1,'')) END AS "+u.ID:11514==u.CDGDO.FieldValue?h+=",CASE WHEN DType.IsInventory=0 THEN NULL ELSE\n(SELECT top 1 convert(datetime,DocDate) FROM INV_DocDetails with(nolock) WHERE InvDocDetailsID IN \n(select LinkedInvDocDetailsID from INV_DocDetails with(nolock) WHERE VoucherNo=B."+D+" and LinkedInvDocDetailsID>0)) END AS "+u.ID:21358==u.CDGDO.FieldValue?h+=",(select "+e.Column+" from ADM_DocumentTypes with(nolock) where CostCenterID=(select top 1 CostCenterID from ACC_DocDetails with(nolock) WHERE VoucherNo=B."+D+")) AS "+u.ID:(e.ActualColumn="DATE"==e.DataType?"convert(datetime,DOC."+e.Column+")":"DOC."+e.Column,h+=",CASE WHEN DType.IsInventory=0 THEN\n  (SELECT MAX("+e.ActualColumn+") FROM Acc_DocDetails DOC WITH(NOLOCK) WHERE DOC.VoucherNo=B."+D+" and Doc.DocSeqNo=B.DocSeqNo)\n  ELSE\n  (SELECT MAX("+e.ActualColumn+") FROM INV_DocDetails DOC WITH(NOLOCK) WHERE DOC.VoucherNo=B."+D+")  END AS "+u.ID);else if(7==e.ParentCostCenterID)h+=",CASE WHEN DType.IsInventory=0 THEN (select top 1 [USER]."+e.Column+" from ACC_DocDetails DOC with(nolock) JOIN "+e.ParentCostCenterSysName+" [USER] with(nolock) ON [USER]."+e.ParentCostCenterColSysName+"=DOC."+e.ParentColumn+" WHERE DOC.VoucherNo=B."+D+")\nELSE\n(select top 1 [USER]."+e.Column+" from INV_DocDetails DOC with(nolock) JOIN "+e.ParentCostCenterSysName+" [USER] with(nolock) ON [USER]."+e.ParentCostCenterColSysName+"=DOC."+e.ParentColumn+" WHERE DOC.VoucherNo=B."+D+")\nEND AS "+u.ID;else if(12==e.ParentCostCenterID)this.Entities.ContainsKey(e.CategoryText)||(this.Entities.push(e.CategoryText,"T"+ ++s),d+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"=B.AdjCurrID"),r?(h+=",max("+this.Entities[e.CategoryText]+"."+e.Column+") "+u.ID,this.SelectTagAliasOnly+=","+u.ID):h+=","+this.Entities[e.CategoryText]+"."+e.Column+" "+u.ID;else if(e.ColumnCostCenterID>5e4&&(0==this.ReportGroups.filter(e=>e.ID==u.ID).length||198==this.StaticReportType)){if("COM_ADDRESS"==e.Table.toUpperCase()){e.ActualColumn="(select CCADD."+e.Column+" from COM_ADDRESS CCADD with(nolock) where CCADD.AddressTypeID=1 AND CCADD.FeatureID="+e.ColumnCostCenterID+" AND B.dcCCNID"+(e.ColumnCostCenterID-5e4)+"=CCADD.FeaturePK)",h+=","+e.ActualColumn,h+=" AS ["+u.ID+"]";continue}this.Entities.ContainsKey(e.CategoryText)||(t="T"+ ++s,this.Entities.push(e.CategoryText,t),d+=" INNER JOIN "+e.ParentCostCenterSysName+" AS "+t+" with(nolock) ON "+t+".NodeID="+(r?"DCC.":"B.")+e.ParentColumn),r?(h+=",max("+this.Entities[e.CategoryText]+"."+e.Column+") "+u.ID,this.SelectTagAliasOnly+=","+u.ID):h+=","+this.Entities[e.CategoryText]+"."+e.Column+" "+u.ID}}else if(401==e.CategoryValue||Math.abs(e.CategoryValue)>4e4&&Math.abs(e.CategoryValue)<5e4){if("COM_DocTextData"==e.Table){if(e.CategoryValue>4e4)if(e.ColumnCostCenterID>0){let t,s,n;if(o.e.IsEmpty(e.ParentCostCenterSysName)){let o=i.a.report.GetTableColumns(e.ColumnCostCenterID);o.TableName=t,o.PrimaryKey=s,o.ColumnName=n}else t=e.ParentCostCenterSysName,s=e.ParentCostCenterColSysName,n=e.ParentColumn;h+=",(select "+n+" from "+t+" with(nolock) where "+s+"=\n                                        (CASE WHEN DType.IsInventory=0 THEN\n  (SELECT MAX(TXT."+e.Column+') FROM Acc_DocDetails DOC WITH(NOLOCK) INNER JOIN COM_DocTextData TXT WITH(NOLOCK)\n    ON TXT.AccDocDetailsID=DOC.AccDocDetailsID WHERE DOC.VoucherNo=B." + strDocNo + " AND DOC.CostCenterID='+e.CategoryValue+" and Doc.DocSeqNo=B.DocSeqNo and isnumeric(TXT."+e.Column+")=1)\n  ELSE\n  (SELECT MAX(TXT."+e.Column+") FROM INV_DocDetails DOC WITH(NOLOCK) INNER JOIN COM_DocTextData TXT WITH(NOLOCK)\n    ON TXT.InvDocDetailsID=DOC.InvDocDetailsID WHERE DOC.VoucherNo=B."+D+" AND DOC.CostCenterID="+e.CategoryValue+" and isnumeric(TXT."+e.Column+")=1)  END)) AS "+u.ID}else h+=",CASE WHEN DType.IsInventory=0 THEN\n  (SELECT MAX(TXT."+e.Column+") FROM Acc_DocDetails DOC WITH(NOLOCK) INNER JOIN COM_DocTextData TXT WITH(NOLOCK)\n    ON TXT.AccDocDetailsID=DOC.AccDocDetailsID WHERE DOC.VoucherNo=B."+D+" AND DOC.CostCenterID="+e.CategoryValue+" and Doc.DocSeqNo=B.DocSeqNo)\n  ELSE\n  (SELECT MAX(TXT."+e.Column+") FROM INV_DocDetails DOC WITH(NOLOCK) INNER JOIN COM_DocTextData TXT WITH(NOLOCK)\n    ON TXT.InvDocDetailsID=DOC.InvDocDetailsID WHERE DOC.VoucherNo=B."+D+" AND DOC.CostCenterID="+e.CategoryValue+")  END AS "+u.ID;else{let t=this.GetTextField_AllDocuments(e.CategoryValue,e.FieldText);if(t.Tables[1].length>0){let e=Object(a.j)(t.Tables[0][0].IsInventory),s=" CASE";for(let i=0;i<t.Tables[1].length;i++)s+=" WHEN MAX(DOC.CostCenterID)="+t.Tables[1][i].CostCenterID.toString(),s+=" THEN MAX(TXT."+t.Tables[1][i].SysColumnName.toString()+")";s+="END ",h+=e?",CASE WHEN DType.IsInventory=0 THEN NULL ELSE (SELECT "+s+" FROM INV_DocDetails DOC WITH(NOLOCK) INNER JOIN COM_DocTextData TXT WITH(NOLOCK) ON TXT.InvDocDetailsID=DOC.InvDocDetailsID WHERE DOC.VoucherNo=B."+D+") END AS "+u.ID:",CASE WHEN DType.IsInventory=1 THEN NULL ELSE (SELECT "+s+" FROM ACC_DocDetails DOC WITH(NOLOCK) INNER JOIN COM_DocTextData TXT WITH(NOLOCK) ON TXT.AccDocDetailsID=DOC.AccDocDetailsID WHERE DOC.VoucherNo=B."+D+") END AS "+u.ID}}continue}if("COM_DocNumData"==e.Table){if(401==e.CategoryValue)188==e.FieldValue?(h+=",CASE WHEN DType.IsInventory=0 THEN NULL\nELSE\n(SELECT top 1 (select  top 1 X.value('@Remarks','nvarchar(max)') from NUM.Remarks.nodes('/XML/Row') as Data(X) where ",o.e.IsEmpty(e.Formula)?h+="X.value('@CreditAcount','bigint')=A.AccountID or X.value('@DebitAcount','bigint')=A.AccountID":h+="X.value('@Columnname','nvarchar(50)')='dcNum"+e.Formula+"'",h+=") FROM INV_DocDetails DOC WITH(NOLOCK) INNER JOIN COM_DocNumData NUM WITH(NOLOCK)\nON NUM.InvDocDetailsID=DOC.InvDocDetailsID WHERE DOC.VoucherNo=B."+D+")  END AS "+u.ID):h+=",CASE WHEN DType.IsInventory=0 THEN\n  (SELECT SUM(NUM."+e.Column+") FROM Acc_DocDetails DOC WITH(NOLOCK) INNER JOIN COM_DocNumData NUM WITH(NOLOCK)\n    ON NUM.AccDocDetailsID=DOC.AccDocDetailsID WHERE DOC.VoucherNo=B."+D+" and Doc.DocSeqNo=B.DocSeqNo)\n  ELSE\n  (SELECT SUM(NUM."+e.Column+") FROM INV_DocDetails DOC WITH(NOLOCK) INNER JOIN COM_DocNumData NUM WITH(NOLOCK)\n    ON NUM.InvDocDetailsID=DOC.InvDocDetailsID WHERE DOC.VoucherNo=B."+D+")  END AS "+u.ID;else if(e.CategoryValue>4e4)h+=",CASE WHEN DType.IsInventory=0 THEN\n  (SELECT SUM(NUM."+e.Column+") FROM Acc_DocDetails DOC WITH(NOLOCK) INNER JOIN COM_DocNumData NUM WITH(NOLOCK)\n    ON NUM.AccDocDetailsID=DOC.AccDocDetailsID WHERE DOC.VoucherNo=B."+D+" AND DOC.CostCenterID="+e.CategoryValue+" and Doc.DocSeqNo=B.DocSeqNo)\n  ELSE\n  (SELECT SUM(NUM."+e.Column+") FROM INV_DocDetails DOC WITH(NOLOCK) INNER JOIN COM_DocNumData NUM WITH(NOLOCK)\n    ON NUM.InvDocDetailsID=DOC.InvDocDetailsID WHERE DOC.VoucherNo=B."+D+" AND DOC.CostCenterID="+e.CategoryValue+")  END AS "+u.ID;else{let t=this.GetTextField_AllDocuments(e.CategoryValue,e.FieldText);if(t.Tables[1].length>0){let e=Object(a.j)(t.Tables[0][0].IsInventory),s=" CASE";for(let i=0;i<t.Tables[1].length;i++)s+=" WHEN SUM(DOC.CostCenterID)="+t.Tables[1][i].CostCenterID.toString(),s+=" THEN SUM(NUM."+t.Tables[1][i].SysColumnName.toString()+")";s+="END ",h+=e?",CASE WHEN DType.IsInventory=0 THEN NULL ELSE (SELECT "+s+" FROM INV_DocDetails DOC WITH(NOLOCK) INNER JOIN COM_DocNumData NUM WITH(NOLOCK) ON NUM.InvDocDetailsID=DOC.InvDocDetailsID WHERE DOC.VoucherNo=B."+D+") END AS "+u.ID:",CASE WHEN DType.IsInventory=1 THEN NULL ELSE (SELECT "+s+" FROM ACC_DocDetails DOC WITH(NOLOCK) INNER JOIN COM_DocNumData NUM WITH(NOLOCK) ON NUM.AccDocDetailsID=DOC.AccDocDetailsID WHERE DOC.VoucherNo=B."+D+") END AS "+u.ID}}continue}2==e.ColumnCostCenterID&&(r?(h+=",CASE WHEN DType.IsInventory=0 THEN \n(select TOP 1 A."+e.Column+" from acc_accounts A with(nolock) where A.AccountID=max(B."+e.ParentColumn+"))\nELSE \n(select TOP 1 A."+e.Column+" from inv_docdetails D with(nolock) inner join acc_accounts A with(nolock) on A.AccountID=D."+e.ParentColumn+" where D.CostCenterID="+e.CategoryValue+" AND D.VoucherNo=B.VoucherNo) END AS ["+u.ID+"]",this.SelectTagAliasOnly+=","+u.ID):h+=",CASE WHEN DType.IsInventory=0 THEN \n(select TOP 1 A."+e.Column+" from acc_docdetails D with(nolock) inner join acc_accounts A with(nolock) on A.AccountID=D."+e.ParentColumn+" where D.CostCenterID="+e.CategoryValue+" AND D.VoucherNo=B.DocNo)\nELSE \n(select TOP 1 A."+e.Column+" from inv_docdetails D with(nolock) inner join acc_accounts A with(nolock) on A.AccountID=D."+e.ParentColumn+" where D.CostCenterID="+e.CategoryValue+" AND D.VoucherNo=B.DocNo) END AS ["+u.ID+"]")}}else if(2==e.CategoryValue){if(!this.Entities.ContainsKey(e.CategoryText)&&!e.IsForeignKey)return;if("ACC_AccountsExtended"==e.Table)t=e.CategoryText+"ACC_AccountsExtended",this.Entities.ContainsKey(t)||(this.Entities.push(t,"ACCEXT"),d+=" LEFT JOIN ACC_AccountsExtended AS "+this.Entities[t]+" with(nolock) ON A.AccountID=ACCEXT.AccountID"),h+=",ACCEXT."+e.Column+" AS ["+u.ID+"]";else if("COM_ADDRESS"==e.Table.toUpperCase())t=e.CategoryText+"COM_ADDRESS",this.Entities.ContainsKey(t)||(this.Entities.push(t,"ACCADD"),d+=" LEFT JOIN COM_ADDRESS AS "+this.Entities[t]+" with(nolock) ON ACCADD.AddressTypeID=1 AND ACCADD.FeatureID=2 AND A.AccountID=ACCADD.FeaturePK"),h+=",ACCADD."+e.Column+" AS ["+u.ID+"]";else if("Shipping_Address"==e.Table||"Billing_Address"==e.Table)h+=",(select "+this.GetAddressColumn(e.Column.substr(5))+" from COM_ADDRESS with(nolock) where AddressID=(select min(AddressID) from COM_ADDRESS with(nolock) where AddressTypeID="+("Shipping_Address"==e.Table?"3":"2")+" and FeatureID=2 AND A.AccountID=FeaturePK)) AS ["+u.ID+"]";else if(e.IsForeignKey)this.Entities.ContainsKey(e.CategoryText)||(t="T"+ ++s,this.Entities.push(e.CategoryText,t),0==o.e.stringCompare(e.ParentTable,"COM_CCCCData",!0)?(this.Entities.ContainsKey(e.ParentTableAlias)||(this.Entities.push(e.ParentTableAlias,e.ParentTableAlias),d+=" LEFT JOIN COM_CCCCData "+e.ParentTableAlias+" with(nolock) ON "+e.ParentTableAlias+".NodeID="+this.Entities.Account+".AccountID AND "+e.ParentTableAlias+".CostCenterID="+e.CategoryValue),d+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"="+e.ParentTableAlias+"."+e.ParentColumn):d+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"="+this.Entities.Account+"."+e.ParentColumn),r?(h+=",max("+this.Entities[e.CategoryText]+"."+e.Column+") "+u.ID,this.SelectTagAliasOnly+=","+u.ID):"accounttypeid"!=e.Column.toLowerCase()||9!=this.StaticReportType&&10!=this.StaticReportType&&11!=this.StaticReportType?h+=","+this.Entities[e.CategoryText]+"."+e.Column+" "+u.ID:h+=", AT.AccountType "+u.ID;else{let t=new c;t.DocID=-1,t.IsInventory=this.IsInventory,this.SetActualColumn(e,t),h+=","+e.ActualColumn+" ["+u.ID+"]",!e.ActualColumn.startsWith("A.")||"3"!=u.LinkType.SelectedValue&&"4"!=u.LinkType.SelectedValue||(h+=",A.AccountID AS "+u.ID+"_ID")}}}l.find(e=>"AgainstAccount"==e.ID&&"1"==e.Visibility.SelectedValue)&&(h+=",isnull((select top 1 SA.AccountName from ACC_DocDetails with(nolock)\ninner join ACC_Accounts SA with(nolock) on SA.AccountID=CreditAccount where B.RefDocNo is not null and VoucherNo=B.RefDocNo and DebitAccount=B.AccountID and (InvDocDetailsID is not null or DocSeqNo=B.RefDocSeqNo))\n,(select top 1 SA.AccountName from ACC_DocDetails with(nolock)\ninner join ACC_Accounts SA with(nolock) on SA.AccountID=DebitAccount where B.RefDocNo is not null and VoucherNo=B.RefDocNo and CreditAccount=B.AccountID and (InvDocDetailsID is not null or DocSeqNo=B.RefDocSeqNo))) AgainstAccount"),this.SelectTag=h.toString(),this.FromTag=d.toString(),this.SelectTag.length>0&&n&&this.SelectTag.Contains("DType.")&&(this.FromTag=" INNER JOIN (SELECT DocumentType DocType1,IsInventory FROM ADM_DocumentTypes with(nolock) Group By DocumentType,IsInventory) AS DType ON  DType.DocType1=B."+(r?"DocumentType ":"DocType ")+this.FromTag)}else if(171==this.StaticReportType){let i=new Array;i.AddRange(this.BaseReportColumns),i.AddRange(this.ReportGroups);let o=!1;"ReportViewModel"==this.ClassName&&this.Report.Preferences.ContainsKey("FIFO")&&"1"==this.Report.Preferences.FIFO&&(o=!0);for(let n=0;n<i.length;n++){let o=i[n];if(e=o.CDGDO,33==o.ID.length&&((400==e.CategoryValue||Math.abs(e.CategoryValue)>4e4&&Math.abs(e.CategoryValue)<5e4)&&(400==e.CategoryValue&&0==e.ColumnCostCenterID?"CurrencyID"==e.ParentColumn?(this.Entities.ContainsKey(e.CategoryText)||(t="T"+ ++s,this.Entities.push(e.CategoryText,t),d+=" INNER JOIN "+e.ParentCostCenterSysName+" AS "+t+" with(nolock) ON "+t+".CurrencyID=D.CurrencyID"),h+=","+this.Entities[e.CategoryText]+"."+e.Column+" "+o.ID,this.SelectTagAliasOnly+=","+o.ID):(e.ActualColumn="DATE"==e.DataType?"convert(datetime,D."+e.Column+")":"D."+e.Column,h+=","+e.ActualColumn+" "+o.ID,this.SelectTagAliasOnly+=","+o.ID):e.ColumnCostCenterID>5e4?(this.Entities.ContainsKey(e.CategoryText)||(t="T"+ ++s,this.Entities.push(e.CategoryText,t),d+=" INNER JOIN "+e.ParentCostCenterSysName+" AS "+t+" with(nolock) ON "+t+".NodeID=DCC."+e.ParentColumn),h+=","+this.Entities[e.CategoryText]+"."+e.Column+" "+o.ID,this.SelectTagAliasOnly+=","+o.ID):"COM_DocTextData"==e.Table&&(r||(d+=" LEFT JOIN COM_DocTextData AS DOCTEXT with(nolock) ON DOCTEXT.InvDocDetailsID=D.InvDocDetailsID"),r=!0,h+=",DOCTEXT."+e.Column+" "+o.ID,this.SelectTagAliasOnly+=","+o.ID)),400==e.CategoryValue&&2==e.ColumnCostCenterID||2==e.CategoryValue))if("ACC_AccountsExtended"==e.Table)t=e.CategoryText+"ACC_AccountsExtended",this.Entities.ContainsKey(t)||(this.Entities.push(t,"ACCEXT"),d+=" LEFT JOIN ACC_AccountsExtended AS "+this.Entities[t]+" with(nolock) ON A.AccountID=ACCEXT.AccountID"),h+=",ACCEXT."+e.Column+" AS ["+o.ID+"]";else if("COM_ADDRESS"==e.Table.toUpperCase())t=e.CategoryText+"COM_ADDRESS",this.Entities.ContainsKey(t)||(this.Entities.push(t,"ACCADD"),d+=" LEFT JOIN COM_ADDRESS AS "+this.Entities[t]+" with(nolock) ON ACCADD.AddressTypeID=1 AND ACCADD.FeatureID=2 AND A.AccountID=ACCADD.FeaturePK"),h+=",ACCADD."+e.Column+" AS ["+o.ID+"]";else{let t=new c;t.DocID=-1,t.IsInventory=this.IsInventory,this.SetActualColumn(e,t),h+=","+e.ActualColumn+" AS ["+o.ID+"]"}}this.SelectTag=h.toString(),this.FromTag=d.toString()}else if(4==this.StaticReportType||12==this.StaticReportType||this.StaticReportType>=5&&this.StaticReportType<=8){for(let i=0;i<this.BaseReportColumns.length;i++){let n=this.BaseReportColumns[i];if(e=n.CDGDO,33==n.ID.length)if(2==e.CategoryValue)if("ACC_AccountsExtended"==e.Table)t=e.CategoryText+"ACC_AccountsExtended",this.Entities.ContainsKey(t)||(this.Entities.push(t,"ACCEXT"),d+=" LEFT JOIN ACC_AccountsExtended AS "+this.Entities[t]+" with(nolock) ON "+this.Entities.Account+".AccountID=ACCEXT.AccountID"),h+=",ACCEXT."+e.Column+" AS ["+n.ID+"]";else if(null!=e.Table&&"COM_ADDRESS"==e.Table.toUpperCase())t=e.CategoryText+"COM_ADDRESS",this.Entities.ContainsKey(t)||(this.Entities.push(t,"ACCADD"),d+=" LEFT JOIN COM_ADDRESS AS "+this.Entities[t]+" with(nolock) ON ACCADD.AddressTypeID=1 AND ACCADD.FeatureID=2 AND "+this.Entities.Account+".AccountID=ACCADD.FeaturePK"),h+=",ACCADD."+e.Column+" AS ["+n.ID+"]";else if(e.IsForeignKey)this.Entities.ContainsKey(e.CategoryText)||(t="T"+ ++s,this.Entities.push(e.CategoryText,t),0==o.e.stringCompare(e.ParentTable,"COM_CCCCData",!0)?(this.Entities.ContainsKey("CC")||(this.Entities.push("CC","CC"),d+=" LEFT JOIN COM_CCCCData CC with(nolock) ON CC.NodeID="+this.Entities.Account+".AccountID AND CC.CostCenterID="+e.CategoryValue),d+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"=CC."+e.ParentColumn):d+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"="+this.Entities.Account+"."+e.ParentColumn),"accounttypeid"==e.Column.toLowerCase()&&12==this.StaticReportType?h+=", AT.AccountType AS ["+n.ID+"]":h+=","+this.Entities[e.CategoryText]+"."+e.Column+" AS ["+n.ID+"]";else if(11396==e.FieldValue){let t=new c;t.DocID=-1,t.IsInventory=!1,this.SetActualColumn(e,t),h+=","+e.ActualColumn+" AS ["+n.ID+"]"}else o.e.IsEmpty(e.Column)||(h+=","+this.Entities.Account+"."+e.Column+" AS ["+n.ID+"]");else if(400==e.CategoryValue&&214==e.FieldValue){let t="",s=o.e.IsEmpty(e.DimensionsFilter)?[]:e.DimensionsFilter.split("~");if(s.length>2&&s[1].length>0&&s[2].length>0){let e=s[2].split(",");for(let s=0;s<e.length;s++)s>0&&(t+=","),e[s].startsWith("EFPBW_")?t+="A."+e[s].Replace("EFPBW_",""):e[s].startsWith("EF_")?t=this.SetExtFunctionParams(e[s],t):t+="null";h+=t.length>0?",dbo."+s[1]+"("+t+")"+n.ID:",null "+n.ID}else h+=",null "+n.ID}}this.SelectTag=h.toString(),this.FromTag=d.toString()}else if(14==this.StaticReportType||15==this.StaticReportType||16==this.StaticReportType||83==this.StaticReportType||84==this.StaticReportType||112==this.StaticReportType||114==this.StaticReportType||115==this.StaticReportType||165==this.StaticReportType){for(let n=0;n<this.BaseReportColumns.length;n++){let a=this.BaseReportColumns[n];if(e=a.CDGDO,33==a.ID.length)if(11509==e.FieldValue||11510==e.FieldValue)h+=",(select top 1 StockValue/UOMConvertedQty from INV_DocDetails with(nolock) where ProductID=P.ProductID and VoucherType=1 and UOMConvertedQty>0",o.e.IsEmptySpace(e.ExecutedDocument)?h+=" and IsQtyIgnored=0":h+=" and CostCenterID IN ("+e.ExecutedDocument+")",h+=" order by docdate desc) AS ["+a.ID+"]";else if(189==e.FieldValue)o.e.IsEmptySpace(e.ExecutedDocument)?h+=",(select top 1 Rate*ExchangeRate from INV_DocDetails with(nolock) where ProductID=P.ProductID and IsQtyIgnored=0 and UOMConvertedQty>0 order by docdate desc) AS ["+a.ID+"]":h+=",(select top 1 Rate*ExchangeRate from INV_DocDetails with(nolock) where ProductID=P.ProductID and UOMConvertedQty>0 and CostCenterID IN ("+e.ExecutedDocument+") order by docdate desc) AS ["+a.ID+"]";else if(11508==e.FieldValue);else if(181==e.FieldValue){let t=new c;t.DocID=-1,t.IsInventory=this.IsInventory,this.SetActualColumn(e,t),this.GroupSelectTag+=","+e.ActualColumn+" AS ["+a.ID+"]",this.GroupSelectTagAlias+=","+a.ID}else if(214==e.FieldValue){let t="",s=o.e.IsEmpty(e.DimensionsFilter)?[]:e.DimensionsFilter.split("~");if(s.length>2&&s[1].length>0&&s[2].length>0){let e=s[2].split(",");for(let s=0;s<e.length;s++)s>0&&(t+=","),e[s].startsWith("EFPRD_")?t+="P."+e[s].Replace("EFPRD_",""):e[s].startsWith("EF_")&&(t=this.SetExtFunctionParams(e[s],t));t.length>0&&(h+=",dbo."+s[1]+"("+t+")"+a.ID)}else h+=",null "+a.ID}else if(3==e.CategoryValue)if("INV_ProductExtended"==e.Table)t=e.CategoryText+"INV_ProductExtended",this.Entities.ContainsKey(t)||(this.Entities.push(t,"PRODEXT"),d+=" LEFT JOIN INV_ProductExtended AS "+this.Entities[t]+" with(nolock) ON P.ProductID=PRODEXT.ProductID"),h+=",PRODEXT."+e.Column+" AS ["+a.ID+"]",this.GroupSelectTag+=",MAX(PRODEXT."+e.Column+") AS ["+a.ID+"]";else if(26419==a.CDGDO.FieldValue||26420==a.CDGDO.FieldValue||50453==a.CDGDO.FieldValue){if(26420==a.CDGDO.FieldValue&&null!=this.Report&&16==this.StaticReportType&&2==this.ReportGroups.length)continue;let t=new c;t.DocID=e.CategoryValue,t.IsInventory=!0,this.SetActualColumn(e,t),h+=","+e.ActualColumn+" AS ["+a.ID+"]",this.GroupSelectTag+=",MAX("+e.ActualColumn+") AS ["+a.ID+"]"}else if(170==a.CDGDO.FieldValue||208==a.CDGDO.FieldValue){let t=new c;t.DocID=0,t.IsInventory=!0,this.SetActualColumn(e,t),h+=","+e.ActualColumn+" AS ["+a.ID+"]",this.GroupSelectTag+=",MAX("+e.ActualColumn+") AS ["+a.ID+"]"}else if(e.IsForeignKey)this.Entities.ContainsKey(e.CategoryText)||(t="T"+ ++s,this.Entities.push(e.CategoryText,t),0==o.e.stringCompare(e.ParentTable,"COM_CCCCData",!0)?(this.Entities.ContainsKey("CC")||(this.Entities.push("CC","CC"),d+=" LEFT JOIN COM_CCCCData CC with(nolock) ON CC.NodeID=P.ProductID AND CC.CostCenterID="+e.CategoryValue),d+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"=CC."+e.ParentColumn):d+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"="+this.Entities.Product+"."+e.ParentColumn),h+=","+this.Entities[e.CategoryText]+"."+e.Column+" AS ["+a.ID+"]",this.GroupSelectTag+=",MAX("+this.Entities[e.CategoryText]+"."+e.Column+") AS ["+a.ID+"]";else if("BinDimension"==e.Column){if(this.ReportParams.ContainsKey("BinDimension")||this.ReportParams.push("BinDimension",a.ID),84==this.StaticReportType){let e=0;if(e=o.e.Int(i.a.SessionManager.Preferences.DimensionwiseBins),"TRUE"==i.a.SessionManager.Preferences["LW Bins"].toUpperCase()||"TRUE"==i.a.SessionManager.Preferences["DW Bins"].toUpperCase()||e>5e4){let e=i.a.report.GetDataTable("RPT024","");if(e.length>0){let t="";"TRUE"==i.a.SessionManager.Preferences["LW Bins"].toUpperCase()?t=this.ReportGroups.length>0&&50002==this.ReportGroups[0].CDGDO.ColumnCostCenterID?" AND B.Location=TBL.TagID":o.e.IsEmpty(this.oReportDialog.LocationWhere)||this.oReportDialog.LocationWhere.Contains(",")?" AND B.Location="+i.a.SessionManager.LocationID:" AND B.Location="+this.oReportDialog.LocationWhere:"TRUE"==i.a.SessionManager.Preferences["DW Bins"].toUpperCase()&&(t=this.ReportGroups.length>0&&50001==this.ReportGroups[0].CDGDO.ColumnCostCenterID?" AND B.Division=TBL.TagID":" AND B.Division="+i.a.SessionManager.DivisionID),h+=",stuff((select ', '+ D.Name from INV_ProductBins B with(nolock)\ninner join "+e[0].TableName.toString()+" D with(nolock) on B.BinNodeID=D.NodeID\nwhere B.NodeID=P.ProductID AND B.CostCenterID=3"+t+" FOR XML PATH('')),1,2,'') AS ["+a.ID+"]"}}}}else"ProductImage"==e.Column?(h+=",(select top 1 F.GUID+'.'+F.FileExtension from COM_Files F WITH(NOLOCK) where F.FeatureID=3 and F.IsProductImage=1 and F.FeaturePK="+this.Entities.Product+".ProductID and F.IsDefaultImage=1) ["+a.ID+"]",this.GroupSelectTag+=",MAX(select top 1 F.GUID+'.'+F.FileExtension from COM_Files F WITH(NOLOCK) where F.FeatureID=3 and F.IsProductImage=1 and F.FeaturePK="+this.Entities.Product+".ProductID and F.IsDefaultImage=1) ["+a.ID+"]"):(h+=",P."+e.Column+" AS ["+a.ID+"]",this.GroupSelectTag+=",MAX(P."+e.Column+") AS ["+a.ID+"]");else e.CategoryValue>4e4&&e.CategoryValue<5e4&&(0==o.e.stringCompare(a.Formula.Text,"LATEST",!0)?0==e.IsForeignKey&&("DocDate"==e.Column?h+=",(select TOP 1 CONVERT(DATETIME,A.DocDate) from inv_docdetails A with(nolock) @CCWHERE@ where A.productid=P.productID AND A.costcenterid="+e.CategoryValue+" order by A.DocDate desc,A.CreatedDate desc) AS ["+a.ID+"]":e.Column.startsWith("dcCalcNum")||e.Column.startsWith("dcNum")?h+=",(select TOP 1 N."+e.Column+" from inv_docdetails A with(nolock) inner join COM_DocNumData N with(nolock) on N.invdocdetailsid=A.invdocdetailsid @CCWHERE@ where A.productid=P.productID AND A.costcenterid="+e.CategoryValue+" order by A.DocDate desc,A.CreatedDate desc) AS ["+a.ID+"]":h+=",(select TOP 1 "+e.Column+" from inv_docdetails A with(nolock) @CCWHERE@ where A.productid=P.productID AND A.costcenterid="+e.CategoryValue+" order by A.DocDate desc,A.CreatedDate desc) AS ["+a.ID+"]"):0==o.e.stringCompare(a.Formula.Text,"OLDEST",!0)&&0==e.IsForeignKey&&("DocDate"==e.Column?h+=",(select TOP 1 CONVERT(DATETIME,A.DocDate) from inv_docdetails A with(nolock) @CCWHERE@ where A.productid=P.productID AND A.costcenterid="+e.CategoryValue+" order by A.DocDate asc,A.CreatedDate asc) AS ["+a.ID+"]":e.Column.startsWith("dcCalcNum")||e.Column.startsWith("dcNum")?h+=",(select TOP 1 N."+e.Column+" from inv_docdetails A with(nolock) inner join COM_DocNumData N with(nolock) on N.invdocdetailsid=A.invdocdetailsid @CCWHERE@ where A.productid=P.productID AND A.costcenterid="+e.CategoryValue+" order by A.DocDate asc,A.CreatedDate asc) AS ["+a.ID+"]":h+=",(select TOP 1 "+e.Column+" from inv_docdetails A with(nolock) @CCWHERE@ where A.productid=P.productID AND A.costcenterid="+e.CategoryValue+" order by A.DocDate asc,A.CreatedDate asc) AS ["+a.ID+"]"))}this.SelectTag=h.toString(),this.FromTag=d.toString()}else if(118==this.StaticReportType){for(let i=0;i<this.BaseReportColumns.length;i++){let n=this.BaseReportColumns[i];e=n.CDGDO,33==n.ID.length&&e.IsForeignKey&&(this.Entities.ContainsKey(e.CategoryText)||(t="T"+ ++s,this.Entities.push(e.CategoryText,t),0==o.e.stringCompare(e.ParentTable,"COM_CCCCData",!0)?(this.Entities.ContainsKey("CC")||(this.Entities.push("CC","CC"),d+=" LEFT JOIN COM_CCCCData CC with(nolock) ON CC.NodeID=P.ProductID AND CC.CostCenterID="+e.CategoryValue),d+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"=CC."+e.ParentColumn):d+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"=A."+e.ParentColumn),h+=","+this.Entities[e.CategoryText]+"."+e.Column+" AS ["+n.ID+"]")}this.SelectTag=h.toString(),this.FromTag=d.toString()}else if(196==this.StaticReportType){let n=new Array;n.AddRange(this.BaseReportColumns),n.AddRange(this.ReportGroups);for(let a=0;a<n.length;a++){let l=n[a];if(e=l.CDGDO,33==l.ID.length&&i.a.SessionManager.Preferences.Registers.length>0&&e.CategoryValue==parseInt(i.a.SessionManager.Preferences.Registers)){let i=e.CategoryText.split(".")[0];if(this.Entities.ContainsKey(i)||this.Entities.push(i,"R"),e.IsForeignKey&&(this.Entities.ContainsKey(e.CategoryText)||(t="T"+ ++s,this.Entities.push(e.CategoryText,t),0==o.e.stringCompare(e.ParentTable,"COM_CCCCData",!0)?(this.Entities.ContainsKey("REG_CC")||(this.Entities.push("REG_CC","REG_CC"),this.FromTag+=" LEFT JOIN COM_CCCCData CC with(nolock) ON REG_CC.NodeID=R.NodeID AND REG_CC.CostCenterID="+e.CategoryValue),this.FromTag+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"=REG_CC."+e.ParentColumn):this.FromTag+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"="+this.Entities[i]+"."+e.ParentColumn)),!this.Entities.ContainsKey(e.CategoryText))continue;let n=new c;n.DocID=-1,n.IsInventory=this.IsInventory,this.SetActualColumn(e,n),this.SelectTag+=","+e.ActualColumn+" AS ["+l.ID+"]"}}}else if(73==this.StaticReportType||87==this.StaticReportType||this.StaticReportType>=209&&this.StaticReportType<=215){let i=new Array;i.AddRange(this.BaseReportColumns),i.AddRange(this.ReportGroups);for(let n=0;n<i.length;n++){let a=i[n];if(33==a.ID.length&&(92==a.CDGDO.CategoryValue||93==a.CDGDO.CategoryValue||94==a.CDGDO.CategoryValue||95==a.CDGDO.CategoryValue))if(e=a.CDGDO,e.IsForeignKey){if(this.Entities.ContainsKey(e.CategoryText))if("REN_PropertyExtended"==e.Table)t=e.CategoryText+"REN_PropertyExtended",this.Entities.ContainsKey(t)||(this.Entities.push(t,"PRPEXT"),d+=" JOIN REN_PropertyExtended AS "+this.Entities[t]+" with(nolock) ON C.PropertyID=PRPEXT.NodeID"),h+=",PRPEXT."+e.Column+" AS ["+a.ID+"]";else if("REN_UnitsExtended"==e.Table)t=e.CategoryText+"REN_UnitsExtended",this.Entities.ContainsKey(t)||(this.Entities.push(t,"UNTEXT"),d+=" JOIN REN_UnitsExtended AS "+this.Entities[t]+" with(nolock) ON C.UnitID=UNTEXT.UnitID"),h+=",UNTEXT."+e.Column+" AS ["+a.ID+"]";else if("REN_TenantExtended"==e.Table)t=e.CategoryText+"REN_TenantExtended",this.Entities.ContainsKey(t)||(this.Entities.push(t,"TNTEXT"),d+=" JOIN REN_TenantExtended AS "+this.Entities[t]+" with(nolock) ON C.TenantID=TNTEXT.TenantID"),h+=",TNTEXT."+e.Column+" AS ["+a.ID+"]";else if(null!=e.ChildCDGDO&&e.IsForeignKey)0!=o.e.stringCompare(e.Table,"COM_CCCCData",!0)||this.Entities.ContainsKey(e.ChildCDGDO.ParentTableAlias)||(this.Entities.push(e.ChildCDGDO.ParentTableAlias,"RTCC"+ ++s),d+=" LEFT JOIN COM_CCCCData "+this.Entities[e.ChildCDGDO.ParentTableAlias]+" with(nolock) ON "+this.Entities[e.ChildCDGDO.ParentTableAlias]+".NodeID="+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+" AND "+this.Entities[e.ChildCDGDO.ParentTableAlias]+".CostCenterID="+e.ColumnCostCenterID),t=e.CategoryText+e.ChildCDGDO.Table,this.Entities.ContainsKey(t)||(this.Entities.push(t,"RT"+ ++s),d+=" JOIN "+e.ChildCDGDO.Table+" AS "+this.Entities[t]+" with(nolock) ON "+this.Entities[t]+"."+e.ChildCDGDO.ParentCostCenterColSysName+"="+this.Entities[e.ChildCDGDO.ParentTableAlias]+"."+e.ChildCDGDO.ParentColumn),h+=","+this.Entities[t]+"."+e.ChildCDGDO.Column+" AS ["+a.ID+"]";else{let t=new c;t.DocID=-1,t.IsInventory=this.IsInventory,this.SetActualColumn(e,t),h+=44==e.LocalReference?","+e.ActualColumn+" AS ["+a.ID+"]":","+this.Entities[e.CategoryText]+"."+e.Column+" AS ["+a.ID+"]"}else{let i=e.CategoryText.split(".")[0];this.Entities.ContainsKey(i)||this.Entities.push(i,"R"),0!=o.e.stringCompare(e.ParentTable,"COM_CCCCData",!0)||this.Entities.ContainsKey(e.ParentTableAlias)||(this.Entities.push(e.ParentTableAlias,"RTCC"+ ++s),95==e.CategoryValue&&(this.FromTag+=" LEFT JOIN COM_CCCCData "+this.Entities[e.ParentTableAlias]+" with(nolock) ON "+this.Entities[e.ParentTableAlias]+".NodeID="+this.Entities[i]+".ContractID  AND "+this.Entities[e.ParentTableAlias]+".CostCenterID="+e.CategoryValue),i=e.ParentTableAlias),t="X"+ ++s,this.Entities.push(e.CategoryText,t),this.FromTag+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"="+this.Entities[i]+"."+e.ParentColumn,h+=","+this.Entities[e.CategoryText]+"."+e.Column+" AS ["+a.ID+"]"}209==this.StaticReportType&&(this.GroupSelectTag+=",max("+a.ID+") ["+a.ID+"]"),214==this.StaticReportType&&(this.SelectTagAliasOnly+=","+a.ID)}else if(95==e.CategoryValue){if("REN_ContractExtended"==e.Table)t=e.CategoryText+"REN_ContractExtended",this.Entities.ContainsKey(t)||(this.Entities.push(t,"CNTEXT"),d+=" JOIN REN_ContractExtended AS "+this.Entities[t]+" with(nolock) ON C.ContractID=CNTEXT.NodeID"),h+=",CNTEXT."+e.Column+" AS ["+a.ID+"]";else if("REN_ContractParticulars"==e.Table)h+=","+this.Entities.ContractREN_ContractParticulars+"."+e.Column+" AS ["+a.ID+"]";else{let t=new c;t.DocID=-1,t.IsInventory=this.IsInventory,this.SetActualColumn(e,t),h+=","+e.ActualColumn+" AS ["+a.ID+"]"}209==this.StaticReportType&&(this.GroupSelectTag+=",max("+a.ID+") ["+a.ID+"]"),214==this.StaticReportType&&(this.SelectTagAliasOnly+=","+a.ID)}else this.Entities.ContainsKey(e.CategoryText)&&(h+=","+this.Entities[e.CategoryText]+"."+e.Column+" AS ["+a.ID+"]")}this.SelectTag+=h.toString(),this.FromTag+=d.toString()}}SetQueryXMLTagsForQueryReports(){if(this.BaseReportColumns.forEach(e=>{"1"==e.ShowLevel.SelectedValue&&null==this.LevelColumn&&(this.LevelColumn=e)}),this.Filter.IsReportViewScreen){let s=this;if(this.FinalQuery=s.ReportQuery,s.Preferences.Filters.length>0){let n,a="",l="",r=new o.f;r.LoadXml("<XML>"+s.Preferences.Filters+"</XML>");let D=r.DocumentElement.childNodes;for(let C=0;C<D.length;C++){let r=D[C];l="";let u=o.f.SelectNodes(r,"Filter");for(let D=0;D<u.length;D++){let r=u[D];n=r.attributes.MapField.value;let C=this.Filter.Fields.find(e=>e.ID==n);if(C){if(C.CDGDO.ActualColumn=r.attributes.Column.value,"DATE"==C.CDGDO.DataType){if(!this.DontApplyDateFilter)if(l+=" AND ",l+=C.CDGDO.ActualColumn,"Between"==C.Condition.SelectedValue||"NotBetween"==C.Condition.SelectedValue)l+=C.Condition.SelectedItem.Parent,l+="'"+C.FromDatePicker.Date.ToString("dd MMM yyyy")+"' AND ",l+="'"+C.ToDatePicker.Date.ToString("dd MMM yyyy")+"'";else if("FUTURE"==C.Condition.SelectedValue||"PAST"==C.Condition.SelectedValue){let e;e=o.e.Int(C.FromValue.TextBox.Text),0==e&&(e=1);let t="";if(t=""!=C.FromValue.ComboBox.SelectedValue?C.FromValue.ComboBox.SelectedValue:"Days",l+=" BETWEEN ","Days"==t)"FUTURE"==C.Condition.SelectedValue?(l+="'"+Date.Today().ToString("dd MMM yyyy")+"' AND ",l+="'"+Date.Today().AddDays(e).ToString("dd MMM yyyy")+"'"):(l+="'"+Date.Today().AddDays(-e).ToString("dd MMM yyyy")+"' AND ",l+="'"+Date.Today().ToString("dd MMM yyyy")+"'");else if("Weeks"==t)304!=s.Report.ReportID&&305!=s.Report.ReportID||!i.a.IsMobile||(l+="'"+Date.Today().ToString("dd MMM yyyy")+"' AND ",l+="'"+Date.Today().AddDays(7).ToString("dd MMM yyyy")+"'");else if("Months"==t)if("FUTURE"==C.Condition.SelectedValue){let t=Date.Today().AddMonths(e);t=new Date(t.getFullYear(),t.getMonth(),1),l+="'"+t.ToString("dd MMM yyyy")+"' AND ",t=t.AddMonths(e).AddDays(-1),l+="'"+t.ToString("dd MMM yyyy")+"'"}else{let t=Date.Today().AddMonths(-e);t=new Date(t.getFullYear(),t.getMonth(),1),l+="'"+t.ToString("dd MMM yyyy")+"' AND ",t=t.AddMonths(e).AddDays(-1),l+="'"+t.ToString("dd MMM yyyy")+"'"}else if("Quarter"==t)if("FUTURE"==C.Condition.SelectedValue){let t=Date.Today().AddMonths(3*e);t=new Date(t.getFullYear(),t.getMonth()-(t.getMonth()-1)%3,1),l+="'"+t.ToString("dd MMM yyyy")+"' AND ",t=t.AddMonths(3*e).AddDays(-1),l+="'"+t.ToString("dd MMM yyyy")+"'"}else{let t=Date.Today().AddMonths(3*-e);t=new Date(t.getFullYear(),t.getMonth()-(t.getMonth()-1)%3,1),l+="'"+t.ToString("dd MMM yyyy")+"' AND ",t=t.AddMonths(3*e).AddDays(-1),l+="'"+t.ToString("dd MMM yyyy")+"'"}else if("Year"==t)if("FUTURE"==C.Condition.SelectedValue){let t=Date.Today().AddYears(e);t=new Date(t.getFullYear(),0,1),l+="'"+t.ToString("dd MMM yyyy")+"' AND ",t=t.AddYears(e-1),t=new Date(t.getFullYear(),11,31),l+="'"+t.ToString("dd MMM yyyy")+"'"}else{let t=Date.Today().AddYears(1-e);t=new Date(t.getFullYear(),0,1),C.FromDatePicker.Date=t,C.ToDatePicker.Date=Date.Today(),l+="'"+t.ToString("dd MMM yyyy")+"' AND ",l+="'"+Date.Today().ToString("dd MMM yyyy")+"'"}}else l+=C.Condition.SelectedItem.Parent,l+="'"+C.FromDatePicker.Date.ToString("dd MMM yyyy")+"'"}else if("Between"==C.Condition.SelectedValue||"NotBetween"==C.Condition.SelectedValue)if(C.FromValue.Visible){if(o.e.IsEmpty(C.FromValue.TextBox.Text)&&o.e.IsEmpty(C.ToValue.Text))continue;l+=" AND ",l+=C.CDGDO.ActualColumn,l+=C.Condition.SelectedItem.Parent,l+="'"+C.FromValue.TextBox.Text+"' AND ",l+="'"+C.ToValue.Text+"'"}else{if(o.e.IsEmpty(C.FromList.Text)&&o.e.IsEmpty(C.ToList.Text))continue;l+=" AND ",l+=C.CDGDO.ActualColumn,l+=C.Condition.SelectedItem.Parent,l+="'"+C.FromList.Text+"' AND ",l+="'"+C.ToList.Text+"'"}else if("Contains"==C.Condition.SelectedValue||"NotContain"==C.Condition.SelectedValue){if(o.e.IsEmpty(C.FromValue.TextBox.Text))continue;l+=" AND ",l+=C.CDGDO.ActualColumn,l+=C.Condition.SelectedItem.Parent,l+="'%"+C.FromValue.TextBox.Text+"%'"}else if(C.FromValue.Visible){if(o.e.IsEmpty(C.FromValue.TextBox.Text))continue;l+=" AND ",l+=C.CDGDO.ActualColumn,"Equal"==C.Condition.SelectedValue&&C.FromValue.TextBox.Text.startsWith("'")&&C.FromValue.TextBox.Text.endsWith("'")?C.FromValue.TextBox.Text.Contains("','")?l+=" IN ("+C.FromValue.TextBox.Text+")":l+=C.Condition.SelectedItem.Parent+C.FromValue.TextBox.Text:(l+=C.Condition.SelectedItem.Parent,l+="'"+C.FromValue.TextBox.Text+"'")}else if(C.FromList.CCID>0){if(0==C.FromList.SelectedValue&&3!=C.FromList.CCID)continue;l+=" AND ",l+=C.CDGDO.ActualColumn,l+=C.Condition.SelectedItem.Parent,l+=C.FromList.SelectedValue}}else if(n.startsWith("CC_")){let s,i=0;n.startsWith("CC_44_")?(s=44,i=o.e.Int(n.substr(6))):s=o.e.Int(n.substr(3));let D=null;var t=this.Filter.CostCenterFilters.find(e=>e.CostCenterID==s&&e.LookupTypeID==i);if(null!=r.attributes.PRID&&(D=this.Filter.CostCenterFilters.find(e=>50==e.CostCenterID&&e.LookupTypeID==parseInt(r.attributes.PRID.value))),null==D&&null!=t){if(t.SelectedNodes.length>0||!t.DeleteButtonVisibility)if(a="",e.IsGroupTree(t)&&t.DeleteButtonVisibility){for(let i=0;i<t.SelectedNodes.length;i++)null!=t.SelectedNodes[i].Parent&&t.SelectedNodes[i].Parent.IsSelected||(a.length>0&&(a+=","),a+=t.SelectedNodes[i].Id);let e,s;0==a.length&&(a+=-12912),l+=" AND ",l+=r.attributes.Column.value+" IN (",this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(e=>e.FeatureID==t.CostCenterID),e=this.drrCCTbl[0].PK.toString(),s=this.drrCCTbl[0].TableName.toString(),l+="select T."+e+" from "+s+" T with(nolock),"+s+" GT with(nolock) where T.lft between GT.lft and GT.rgt and GT."+e+" IN ("+a.toString()+") group by T."+e,l+=")"}else{for(let e=0;e<t.SelectedNodes.length;e++)t.SelectedNodes[e].IsGroup||0==t.SelectedNodes[e].Id||(a.length>0&&(a+=","),a+=t.SelectedNodes[e].Id);0==a.length&&(a+=-12912),l+=" AND ",l+=r.attributes.Column.value+" IN (",l+=a.toString(),l+=")"}}else if(null!=D){a="";let e=new Array;for(let t=0;t<D.SelectedNodes.length;t++)0==D.SelectedNodes[t].Id||e.Contains(D.SelectedNodes[t].Id)||(a.length>0&&(a+=","),a+=D.SelectedNodes[t].Id,e.push(D.SelectedNodes[t].Id));D.DeleteButtonVisibility||0!=a.length||(a+=-12912),0!=a.length&&(l+=" AND ",l+=r.attributes.Column.value+" IN (",l+=a.toString(),l+=")")}}else"Employee_Filter"==n&&(o.e.IsEmpty(i.a.SessionManager.sWHEmpFilteredEmpSeqNos)||(i.a.SessionManager.LocationID>0&&i.a.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&i.a.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(l+=" AND ",l+=r.attributes.Column.value+" IN (Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+i.a.SessionManager.LocationID+")"),l+=" AND ",l+=this.PayrollWidgetEmpID>0?r.attributes.Column.value+" in ("+this.PayrollWidgetEmpID+")":r.attributes.Column.value+" in ("+i.a.SessionManager.sWHEmpFilteredEmpSeqNos+")"))}this.FinalQuery=this.FinalQuery.Replace(r.attributes.Name.value,l.toString())}}if(this.DocumentFilters.ContainsKey("CRM_Cases_DocumentsTab")&&(this.FinalQuery=this.FinalQuery.Replace("@CRM_Cases_DocumentsTab@",this.DocumentFilters.CRM_Cases_DocumentsTab)),this.DocumentFilters.ContainsKey("CRM_CasesRef_DocumentsTab")&&(this.FinalQuery=this.FinalQuery.Replace("@CRM_CasesRef_DocumentsTab@",this.DocumentFilters.CRM_CasesRef_DocumentsTab)),(this.FinalQuery.Contains("@TODATE@")||this.FinalQuery.Contains("@FROMDATE@"))&&(s.SetDatePickers(),this.FinalQuery=this.FinalQuery.Replace("@TODATE@","'"+s.ToDatePicker.Date.ToString("dd MMM yyyy")+"'"),this.FinalQuery=this.FinalQuery.Replace("@FROMDATE@","'"+s.FromDatePicker.Date.ToString("dd MMM yyyy")+"'")),this.FinalQuery.Contains("@USERID@")&&(this.FinalQuery=this.FinalQuery.Replace("@USERID@",i.a.SessionManager.UserID.toString())),this.FinalQuery.Contains("@ROLEID@")&&(this.FinalQuery=this.FinalQuery.Replace("@ROLEID@",i.a.SessionManager.RoleID.toString())),this.FinalQuery.Contains("@USERNAME@")&&(this.FinalQuery=this.FinalQuery.Replace("@ROLEID@",i.a.SessionManager.UserName)),this.FinalQuery.Contains("@SEARCHTEXT@")){let e=this.Filter.Fields.find(e=>null==e.CDGDO.DataType||"INT"!=e.CDGDO.DataType.toUpperCase()&&"FLOAT"!=e.CDGDO.DataType.toUpperCase()&&"DATE"!=e.CDGDO.DataType.toUpperCase());this.FinalQuery=this.FinalQuery.Replace("@SEARCHTEXT@",e&&null!=e.FromValue.TextBox.Text?"'"+e.FromValue.TextBox.Text+"'":"''")}if(308==s.Report.ReportID)if(i.a.SessionManager.IsEmpUser||i.a.SessionManager.IsRptManagerUser){let e=o.e.StringValue(i.a.SessionManager.Preferences.HolidaysBasedOn).split(","),t=" ",s="",n="";if(null!=e&&e.length>0)for(let i=0;i<e.length;i++)null!=e[i]&&""!=e[i]&&(s="dcCCNID"+(parseInt(e[i])-5e4)+"=",n="CC.CCNID"+(parseInt(e[i])-5e4));s.length>0&&(t=" DECLARE @WH NVARCHAR(MAX),@sQ nvarchar(max),@temp1 nvarchar(max)\n                        SET @temp1='@WH NVARCHAR(max) output'\n                        SET @sQ='\n                        SELECT @WH=''"+s+"''+CONVERT(NVARCHAR,"+n+") FROM COM_CC50051 C51 WITH(NOLOCK)\n                        JOIN COM_CCCCData CC WITH(NOLOCK) ON CC.NODEID=C51.NODEID AND CC.COSTCENTERID=50051\n                        WHERE C51.NODEID="+i.a.SessionManager.iEmployee+"'          \n                        EXEC sp_executesql @sQ,@temp1,@WH output\n                                                        \n",this.FinalQuery=t+this.FinalQuery)}else this.FinalQuery="DECLARE @WH NVARCHAR(MAX)  "+this.FinalQuery}}SetQuery(e,t){let s,i=0;this.IsInventory=t;let n,a="",l=!1,r=!1,D="",C="";a="DCC";for(let I=0;I<e.length;I++){let a=e[I];if(s=a.CDGDO,33==a.ID.length)if(400==s.CategoryValue||s.CategoryValue>4e4&&s.CategoryValue<5e4){if(s.CategoryValue>4e4&&s.CategoryValue<5e4&&("COM_DocTextData"==s.Table?(this.Entities.ContainsKey(s.CategoryText)||this.Entities.push(s.CategoryText,this.Entities.Documents),n=s.CategoryText+"COM_DocTextData",this.Entities.ContainsKey(n)||this.Entities.push(n,"DOCTEXT"),l||(C+=t?" LEFT JOIN COM_DocTextData AS "+this.Entities[n]+" with(nolock) ON "+this.Entities[n]+".InvDocDetailsID="+this.Entities.Documents+".InvDocDetailsID":" LEFT JOIN COM_DocTextData AS "+this.Entities[n]+" with(nolock) ON "+this.Entities[n]+".AccDocDetailsID="+this.Entities.Documents+".AccDocDetailsID"),l=!0,s.ParentCDGDO=new u.a):"COM_DocNumData"!=s.Table&&"PAY_DocNumData"!=s.Table||(this.Entities.ContainsKey(s.CategoryText)||this.Entities.push(s.CategoryText,this.Entities.Documents),n=s.CategoryText+s.Table,this.Entities.ContainsKey(n)||this.Entities.push(n,"DOCNUM"),r||(C+=t?" LEFT JOIN "+s.Table+" AS "+this.Entities[n]+" with(nolock) ON "+this.Entities[n]+".InvDocDetailsID="+this.Entities.Documents+".InvDocDetailsID":" LEFT JOIN "+s.Table+" AS "+this.Entities[n]+" with(nolock) ON "+this.Entities[n]+".AccDocDetailsID="+this.Entities.Documents+".AccDocDetailsID"),r=!0,s.ParentCDGDO=new u.a)),s.ColumnCostCenterID>0&&s.ParentTableAlias.Contains("_CCMAP"))this.Entities.ContainsKey(s.CategoryText)||(this.Entities.push(s.CategoryText,"T"+i),i++,C+=" LEFT JOIN "+s.ParentCostCenterSysName+" AS "+this.Entities[s.CategoryText]+" with(nolock) ON "+this.Entities[s.CategoryText]+"."+s.ParentCostCenterColSysName+"=DCC."+s.ParentColumn);else if(s.IsForeignKey){this.Entities.ContainsKey(s.CategoryText)||(n="T"+ ++i,this.Entities.push(s.CategoryText,n),0==o.e.stringCompare(s.ParentTable,"COM_CCCCData",!0)||(C+=" LEFT JOIN "+s.ParentCostCenterSysName+" AS "+this.Entities[s.CategoryText]+" with(nolock) ON "+this.Entities[s.CategoryText]+"."+s.ParentCostCenterColSysName+"="+this.Entities.Documents+"."+s.ParentColumn)),D+=","+this.Entities[s.CategoryText]+"."+s.Column+" AS ["+a.ID+"]";continue}try{let e=new c;e.DocID=-1,e.IsInventory=t,400==s.CategoryValue?this.SetActualColumn(s,e):0==o.e.stringCompare(s.Formula,"LATEST")||0==o.e.stringCompare(s.Formula,"OLDEST")?s.ActualColumn=this.GetLatestOldestQuery(s,"D","VENDOR"):(this.Entities.ContainsKey(s.CategoryText)||this.Entities.push(s.CategoryText,this.Entities.Documents),e=new c,e.DocID=s.CategoryValue,e.IsInventory=t,this.SetActualColumn(s,e)),D+=","+s.ActualColumn,D+=" AS ["+a.ID+"]",this.SelectTagAliasOnly+=","+a.ID}catch(h){}}else if(2==s.CategoryValue){if(!this.Entities.ContainsKey(s.CategoryText))return;let e=new c;e.DocID=-1,this.SetActualColumn(s,e),this.GroupSelectTag+=","+s.ActualColumn+" AS ["+a.ID+"]",this.GroupSelectTagAlias+=","+a.ID}}this.SelectTag=D.toString(),this.FromTag=C.toString()}SetQueryXMLTagsForPreProcessQuery(){let e=0,t="";"ReportViewModel"==this.ClassName&&(this.Report=this,this.Report.SetDatePickers(),this.Report.ProcessdOn.Visible=!1);for(let i=0;i<this.Filter.CostCenterFilters.length;i++){let s,o=this.Filter.CostCenterFilters[i];if(!o.IsPrePocessFilter)continue;let n="";e++;let a,l="GT"+e;if(s="RPT_TBL"+this.Report.ReportID,this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(e=>e.FeatureID==o.CostCenterID),this.FieldsDialog.CostCenterTables.length>0&&(a="T.PPQ"+o.CostCenterID,o.SelectedNodes.length>0||!o.DeleteButtonVisibility)){t.length>0&&(t+=" AND "),t+=a+" IN (";for(let e=0;e<o.SelectedNodes.length;e++)e>0&&(t+=","),t+=o.SelectedNodes[e].Id;0==o.SelectedNodes.length&&(t+=-12912),t+=")"}n.length>0&&(this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(e=>e.FeatureID==o.CostCenterID),this.FromTag+="\r\n ,(select T."+this.drrCCTbl[0].PK.toString()+" GTID from "+this.drrCCTbl[0].TableName.toString()+" T with(nolock),"+this.drrCCTbl[0].TableName.toString()+" "+l+" with(nolock) where T.lft BETWEEN "+l+".lft AND "+l+".rgt AND "+l+"."+this.drrCCTbl[0].PK.toString()+" IN ("+n.toString()+") group by T."+this.drrCCTbl[0].PK.toString()+") AS "+l)}let s="",n="";for(let a=0;a<this.Filter.Fields.length;a++){let e=this.Filter.Fields[a];if(s="","DATE"==e.CDGDO.DataType&&this.Filter.IsReportViewScreen&&!this.DontApplyDateFilter){let t="PPQ"+e.ID.Replace("-","");if("Between"==e.Condition.SelectedValue||"NotBetween"==e.Condition.SelectedValue)t+=e.Condition.SelectedItem.Parent,t+="'"+e.FromDatePicker.Date.ToString("dd MMM yyyy")+"' AND ",t+="'"+e.ToDatePicker.Date.ToString("dd MMM yyyy")+"'";else if("FUTURE"==e.Condition.SelectedValue||"PAST"==e.Condition.SelectedValue){e.ToDatePicker.Mode=1,e.FromDatePicker.Mode=1;let s=o.e.Int(e.FromValue.TextBox.Text);0==s&&(s=1);let i="";if(i=""!=e.FromValue.ComboBox.SelectedValue?e.FromValue.ComboBox.SelectedValue:"Days","Days"==i)"FUTURE"==e.Condition.SelectedValue?(e.FromDatePicker.Date=Date.Today(),e.ToDatePicker.Date=Date.Today().AddDays(s)):(e.FromDatePicker.Date=Date.Today().AddDays(-s),e.ToDatePicker.Date=Date.Today());else if("Weeks"==i){Date.Today().getDay();let t,i=new Date,o=0;i=Date.Today().AddDays(-o),"FUTURE"==e.Condition.SelectedValue?(i=i.AddDays(7*s),t=i.AddDays(7*s-1)):(i=i.AddDays(-7*s),t=i.AddDays(7*s-1)),e.FromDatePicker.Date=i,e.ToDatePicker.Date=t}else if("Months"==i)if("FUTURE"==e.Condition.SelectedValue){let t=Date.Today().AddMonths(s);t=new Date(t.getFullYear(),t.getMonth(),1),e.FromDatePicker.Date=t,t=t.AddMonths(s).AddDays(-1),e.ToDatePicker.Date=t}else{let t=Date.Today().AddMonths(-s);t=new Date(t.getFullYear(),t.getMonth(),1),e.FromDatePicker.Date=t,t=t.AddMonths(s).AddDays(-1),e.ToDatePicker.Date=t}else if("Quarter"==i)if("FUTURE"==e.Condition.SelectedValue){let t=Date.Today().AddMonths(3*s);t=new Date(t.getFullYear(),t.iMonth()-(t.iMonth()-1)%3-1,1),e.FromDatePicker.Date=t,t=t.AddMonths(3*s).AddDays(-1),e.ToDatePicker.Date=t}else{let t=Date.Today().AddMonths(3*-s);t=new Date(t.getFullYear(),t.iMonth()-(t.iMonth()-1)%3-1,1),e.FromDatePicker.Date=t,t=t.AddMonths(3*s).AddDays(-1),e.ToDatePicker.Date=t}else if("Year"==i)if("FUTURE"==e.Condition.SelectedValue){let t=Date.Today().AddYears(s);t=new Date(t.getFullYear(),0,1),e.FromDatePicker.Date=t,t=t.AddYears(s-1),t=new Date(t.getFullYear(),11,31),e.ToDatePicker.Date=t}else{let t=Date.Today().AddYears(1-s);t=new Date(t.getFullYear(),0,1),e.FromDatePicker.Date=t,e.ToDatePicker.Date=Date.Today()}t+=" BETWEEN ",t+="'"+e.FromDatePicker.Date.ToString("dd MMM yyyy")+"' AND ",t+="'"+e.ToDatePicker.Date.ToString("dd MMM yyyy")+"'"}else"IsNull"==e.Condition.SelectedValue||"IsNotNull"==e.Condition.SelectedValue?t+=e.Condition.SelectedItem.Parent:(t+=e.Condition.SelectedItem.Parent,t+="'"+e.FromDatePicker.Date.ToString("dd MMM yyyy")+"'");let n="";if("Between"==e.Condition.SelectedValue||"FUTURE"==e.Condition.SelectedValue||"PAST"==e.Condition.SelectedValue){let t=new Date(e.ToDatePicker.Date.getFullYear(),i.a.SessionManager.AccountingFromMonth-1,1);t>e.ToDatePicker.Date&&(t=t.AddYears(-1));let s="PPQ"+e.ID.Replace("-","");if(this.RepeatShowPrevMn){let i=t.AddYears(-1);for(let t=1;t<=this.RepeatPrevData;t++){if(n+=" OR ("+s+" BETWEEN ",this.RepeatPrevDataFull)n+="'"+i.ToString("dd MMM yyyy")+"' AND ",n+="'"+i.AddYears(1).AddDays(-1).ToString("dd MMM yyyy")+"'",i=i.AddYears(-1);else if(this.RepeatPrevDataOfCurrYr&&this.RepeatType==r.d.Monthly){let s=new Date(e.FromDatePicker.Date.getFullYear(),e.FromDatePicker.Date.getMonth(),1);s=s.AddMonths(-t),n+="'"+s.ToString("dd MMM yyyy")+"' AND ",n+="'"+s.AddMonths(1).AddDays(-1).ToString("dd MMM yyyy")+"'"}else n+="'"+e.FromDatePicker.Date.AddYears(-t).ToString("dd MMM yyyy")+"' AND ",n+="'"+e.ToDatePicker.Date.AddYears(-t).ToString("dd MMM yyyy")+"'";n+=")"}this.RepeatEmptyColumns=1}this.BaseReportColumns.find(e=>!o.e.IsEmpty(e.Formula.Text)&&e.Formula.Text.Contains("PRV_YEARSTART"))||this.ReportGroups.find(e=>!o.e.IsEmpty(e.Formula.Text)&&e.Formula.Text.Contains("PRV_YEARSTART"))?(this.PrevDateColumsUsed=!0,n+=" OR ("+s+" BETWEEN ",n+="'"+t.AddYears(-1).ToString("dd MMM yyyy")+"' AND ",n+="'"+t.AddDays(-1).ToString("dd MMM yyyy")+"'",n+=")"):(this.BaseReportColumns.find(e=>!o.e.IsEmpty(e.Formula.Text)&&e.Formula.Text.Contains("PRV_YEARFROMDATE"))||this.ReportGroups.find(e=>!o.e.IsEmpty(e.Formula.Text)&&e.Formula.Text.Contains("PRV_YEARFROMDATE"))||this.BaseReportColumns.find(e=>!o.e.IsEmpty(e.Formula.Text)&&e.Formula.Text.Contains("PRV_YEARTODATE"))||this.ReportGroups.find(e=>!o.e.IsEmpty(e.Formula.Text)&&e.Formula.Text.Contains("PRV_YEARTODATE")))&&(this.PrevDateColumsUsed=!0,n+=" OR ("+s+" BETWEEN ",n+="'"+e.FromDatePicker.Date.AddYears(-1).ToString("dd MMM yyyy")+"' AND ",n+="'"+e.ToDatePicker.Date.AddYears(-1).ToString("dd MMM yyyy")+"'",n+=")")}n.length>0?(s+="(("+t+")",s+=n.toString(),s+=")"):s+=t}s.length>0&&(e.QuickSearchField.IsChecked?(n.length>0&&(n+=" OR "),n+=s):(t.length>0&&(t+=" AND "),t+=s))}this.FinalQuery="select * from PACT2C"+i.a.SessionManager.CompanyIndex+"_TEMP.dbo.RPT_TBL"+this.Report.ReportID+" T with(nolock)",t.length>0&&(this.FinalQuery+=" where "+t.toString()),null!=this.Report&&i.a.report.ReportDataSetAsync("RPT022",this.Report.IsReportDB,"select convert(datetime,ProcessedOn) ProcessedOn from adm_revenureports with(nolock) where ReportID="+this.Report.ReportID).then(e=>{let t=e.Tables[0];t.length>0&&(this.Report.ProcessdOn.Label="[Processed On "+new Date(t[0].ProcessedOn).ToString(i.a.SessionManager.Preferences["Date Format"]+" hh:mm a")+"]",this.Report.ProcessdOn.Visible=!0)})}ApplyParentReportFilters(){if(null!=this.oReportDialog&&null!=this.oReportDialog.ParentReportDateFilter)this.oReportDialog.FromDate=this.oReportDialog.ParentReportDateFilter.FromDatePicker,this.oReportDialog.ToDate=this.oReportDialog.ParentReportDateFilter.ToDatePicker;else if(null!=this.ParentReport&&null!=this.ParentReport.oReportDialog){var e=this.Filter.Fields.find(e=>e.Temp&&"STATIC DATE FILTER"==o.e.String(e.Temp));if(e){if(this.ParentReport.oReportDialog.FromDate.Visible)e.FromDatePicker=this.ParentReport.oReportDialog.FromDate;else{if("MMM-yyyy"==this.ParentReport.oReportDialog.ToDate.CustomFormat)return e.FromDatePicker.Date=new Date(this.ParentReport.oReportDialog.ToDate.Date.getFullYear(),this.ParentReport.oReportDialog.ToDate.Date.getMonth(),1),void(e.ToDatePicker.Date=e.FromDatePicker.Date.AddMonths(1).AddDays(-1));e.FromDatePicker=this.ParentReport.oReportDialog.ToDate,e.Condition.SelectedValue="LessthanOrEqual",e.Condition.SetSelectedItem("LessthanOrEqual")}this.ParentReport.oReportDialog.ToDate.Visible&&(e.ToDatePicker=this.ParentReport.oReportDialog.ToDate)}}for(let s=0;s<this.Filter.CostCenterFilters.length;s++){let e=this.Filter.CostCenterFilters[s];if(e.ParentReportFilterCostCenterID>0){var t=this.ParentReport.Filter.CostCenterFilters.find(t=>t.CostCenterID==e.ParentReportFilterCostCenterID);t||null==this.ParentReport.oReportDialog||(t=this.ParentReport.oReportDialog.CostCenterFilters.find(t=>t.CostCenterID==e.ParentReportFilterCostCenterID)),t&&(e.SelectedNodes=t.SelectedNodes,null!=this.oReportDialog&&this.oReportDialog.TreeCCID==e.CostCenterID&&(this.oReportDialog.DefaultTreeSelectedNodes=e.SelectedNodes))}}}SetActualColumn(e,t,s=null){let n=!1,a=e.Column,l=e.CategoryText;if(null!=e.ParentCDGDO&&(l+=e.Table),"Shipping_Address"==e.Table||"Billing_Address"==e.Table){let t="Shipping_Address"==e.Table?"3":"2";return void(o.e.IsEmptySpace(e.ParentTableAlias)?(this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(t=>t.FeatureID==e.CategoryValue),e.ActualColumn="(select "+this.GetAddressColumn(e.Column.substr(5))+" from COM_ADDRESS with(nolock) where AddressID=(select min(AddressID) from COM_ADDRESS with(nolock) where AddressTypeID="+t+" and FeatureID="+e.CategoryValue+" AND "+this.Entities[e.CategoryText]+"."+this.FieldsDialog.CostCenterTables[0].PK.toString()+"=FeaturePK))"):e.ActualColumn="(select "+this.GetAddressColumn(e.Column.substr(5))+" from COM_ADDRESS with(nolock) where AddressID=(select min(AddressID) from COM_ADDRESS with(nolock) where AddressTypeID="+t+" and FeatureID="+e.ParentCostCenterID+" AND "+this.Entities[e.ParentTableAlias]+"."+e.ParentColumn+"=FeaturePK))")}64!=e.ParentCCDefaultColID&&65!=e.ParentCCDefaultColID||(l+="_MAXMIN");let r=!1;if(Math.abs(e.CategoryValue)>4e4&&Math.abs(e.CategoryValue)<5e4)if(e.CategoryValue>0)e.CategoryValue!=Math.abs(t.DocID)&&(r=!0);else if(e.CategoryValue!=t.ParentDocID)r=!0;else if(e.CategoryValue!=t.DocID&&(e.Column.startsWith("dcNum")||e.Column.startsWith("dcCalcNum")||e.Column.startsWith("dcAlpha")))if(t.dvCommon=t.dvCommonTable.filter(s=>s.CostCenterID==t.DocID&&s.CostCenterColID==e.FieldValue),t.dvCommon.length>0){let s;a=t.dvCommon[0].SysColumnName.toString(),s&&(!o.e.IsEmpty(e.ALLOtherDocuments)&&e.ALLOtherDocuments.Contains((-t.DocID).toString())?!e.Column.startsWith("dcAlpha")&&e.ALLOtherDocuments.Contains(-t.DocID+"~1")&&(n=!0):(a="",r=!0))}else r=!0;if(r||400!=e.CategoryValue)if(!r&&o.e.StringValue(e.Column).startsWith("dcAlpha")&&(402==e.CategoryValue||Math.abs(e.CategoryValue)>4e4&&Math.abs(e.CategoryValue)<5e4)){if(0!=e.ColumnCostCenterID&&44!=e.ColumnCostCenterID){let t,s,n;if(e.ActualTable=this.Entities[l],o.e.IsEmpty(e.ParentCostCenterSysName)){let o=i.a.report.GetTableColumns(e.ColumnCostCenterID);t=o.TableName,s=o.PrimaryKey,n=o.ColumnName}else t=e.ParentCostCenterSysName,s=e.ParentCostCenterColSysName,n=e.ParentColumn;return void(e.ActualColumn="(select "+n+" from "+t+" with(nolock) where "+s+"="+this.Entities[l]+"."+e.Column+")")}if(null!=s&&"5"==s.LinkType.SelectedValue)return this.sbQuery+="(select [GUID]+'.'+FileExtension from COM_Files WITH(NOLOCK) WHERE FeatureID="+(this.IsInventory?"INV":"ACC")+".CostCenterID AND FeaturePK="+(this.IsInventory?"INV":"ACC")+".DocID and (IsDefaultImage=100 or (IsDefaultImage=0 and "+(this.IsInventory?"INV":"ACC")+".DocSeqNo =RowSeqNo)) and ColName='"+e.Column+"')"+s.ID+"_ID,",void(e.ActualColumn="(select ActualFileName from COM_Files WITH(NOLOCK) WHERE FeatureID="+(this.IsInventory?"INV":"ACC")+".CostCenterID AND FeaturePK="+(this.IsInventory?"INV":"ACC")+".DocID and (IsDefaultImage=100 or (IsDefaultImage=0 and "+(this.IsInventory?"INV":"ACC")+".DocSeqNo =RowSeqNo)) and ColName='"+e.Column+"')")}else{if(!r&&null!=s&&"5"==s.LinkType.SelectedValue&&e.Column.Contains("Alpha")&&(Math.abs(e.CategoryValue)<4e4||Math.abs(e.CategoryValue)>5e4))return this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(t=>t.FeatureID==e.CategoryValue),this.sbQuery+="(select [GUID]+'.'+FileExtension from COM_Files WITH(NOLOCK) WHERE FeatureID="+e.CategoryValue+" AND FeaturePK="+this.Entities[e.CategoryText.split(".")[0]]+"."+this.drrCCTbl[0].PK.toString()+" and IsDefaultImage=100 and ColName='"+e.Column+"')"+s.ID+"_ID,",void(e.ActualColumn="(select ActualFileName from COM_Files WITH(NOLOCK) WHERE FeatureID="+e.CategoryValue+" AND FeaturePK="+this.Entities[e.CategoryText.split(".")[0]]+"."+this.drrCCTbl[0].PK.toString()+" and IsDefaultImage=100 and ColName='"+e.Column+"')");if(144==e.CategoryValue&&(e.Column.startsWith("Alpha")||null!=e.ParentColumn&&e.ParentColumn.startsWith("CCNID"))){if(0==e.LocalReference){let t=i.a.report.GetDataTable("RPT036",e.FieldValue.toString());t.length>0&&t[0].LocalReference&&(e.LocalReference=parseInt(t[0].LocalReference))}let s=this.GetKeyWordColumn(e,t);return e.ActualTable=this.Entities[l],e.ActualColumn=null!=e.ParentColumn&&e.ParentColumn.startsWith("CCNID")?0==e.LocalReference?"(CASE WHEN "+this.Entities[e.ParentTableAlias]+"."+e.ParentColumn+"> 0  THEN ":"(CASE WHEN "+this.Entities[e.ParentTableAlias]+".CostCenterID="+e.LocalReference+" THEN ":"(CASE WHEN "+e.ActualTable+".CostCenterID="+e.LocalReference+" THEN ",o.e.IsEmpty(s)?e.ActualColumn+="DATE"==e.DataType?"CONVERT(DATETIME,"+this.Entities[l]+"."+a+")":this.Entities[l]+"."+a:e.ActualColumn+="("+s+")",void(e.ActualColumn+=" ELSE NULL END)")}if(144==e.CategoryValue&&65==e.ParentCostCenterID||144==e.ParentCostCenterID&&null!=e.ChildCDGDO&&65==e.ChildCDGDO.ParentCostCenterID)return void(e.ActualColumn=144==e.ParentCostCenterID&&null!=e.ChildCDGDO&&65==e.ChildCDGDO.ParentCostCenterID?"(CASE WHEN "+this.Entities[e.CategoryText]+".contactid is null then null else (select "+e.ChildCDGDO.Column+" from com_contacts with(nolock) where contactid="+this.Entities[e.CategoryText]+".contactid) END)":"(CASE WHEN "+this.Entities[e.ParentTableAlias]+".contactid is null then null else (select "+e.Column+" from com_contacts with(nolock) where contactid="+this.Entities[e.ParentTableAlias]+".contactid) END)");if(144==e.CategoryValue&&(27295==e.FieldValue||27296==e.FieldValue))return void(27295==e.FieldValue?e.ActualColumn="(CASE WHEN ("+this.Entities[l]+".InviteRefActID=0 OR "+this.Entities[l]+".InviteRefActID IS NULL) then "+this.Entities[l]+".CreatedBy    END)":27296==e.FieldValue&&(e.ActualColumn="U.UserName"));if(o.e.StringValue(e.Column).startsWith("dcPOSRemarks"))return void(e.ActualColumn="STUFF((SELECT ', '+C.Symbol+' '+convert(nvarchar,P.AmountFC)+' @ '+convert(nvarchar,P.ExchangeRate) \nFROM COM_PosPayModes P with(nolock) \nleft join COM_Currency C with(nolock) on C.CurrencyID=P.Currency\nwhere P.DocID=INV.DocID and P.DBColumnName='"+e.Column.Replace("POSRemarks","")+"' FOR XML PATH('')),1,1,'')")}else this.IsInventory&&this.AccDocumentFields.Contains(e.FieldValue)?this.ShowOnlyAccountingData&&t.ShowAccountingData||(r=!0):!this.IsInventory&&this.InvDocumentFields.Contains(e.FieldValue)?r=!0:207!=e.FieldValue||t.ShowAccountingData||(r=!0);e.ActualTable="",r?e.ActualColumn="NULL":null!=e.ChildCDGDO?(a=e.ChildCDGDO.Column,l=e.ChildCDGDO.CategoryText,e.ChildCDGDO.ActualColumn=this.GetKeyWordColumn(e.ChildCDGDO,t),0==e.ChildCDGDO.ActualColumn.length&&this.Entities.ContainsKey(l)&&(e.ActualTable=this.Entities[l],e.ChildCDGDO.ActualColumn="DATE"==e.ChildCDGDO.DataType?"CONVERT(DATETIME,"+this.Entities[l]+"."+a+")":this.Entities[l]+"."+a),e.ActualColumn=e.ChildCDGDO.ActualColumn):(e.ActualColumn=this.GetKeyWordColumn(e,t),0==e.ActualColumn.length&&this.Entities.ContainsKey(l)&&(e.ActualTable=this.IsInventory&&this.ShowOnlyAccountingData&&t.ShowAccountingData&&this.AccDocumentFields.Contains(e.FieldValue)?"ACC":this.Entities[l],"DATE"==e.DataType?e.ActualColumn=a.startsWith("dcAlpha")?"case when isdate("+e.ActualTable+"."+a+")=1 and isNumeric("+e.ActualTable+"."+a+")=0 then CONVERT(DATETIME,"+e.ActualTable+"."+a+") else null end":"CONVERT(DATETIME,"+e.ActualTable+"."+a+")":this.ShowDebitCreditAmount&&t.ShowAccountingData&&206==e.FieldValue&&t.IsDebit||this.ShowDebitCreditAmount&&t.ShowAccountingData&&205==e.FieldValue&&!t.IsDebit?e.ActualColumn="NULL":this.ShowDebitCreditAmount&&t.ShowAccountingData&&23825==e.FieldValue?e.ActualColumn=t.IsDebit?e.ActualTable+"."+a:"-"+e.ActualTable+"."+a:e.CategoryValue>=405&&e.CategoryValue<=408?t.IsInventory?405==e.CategoryValue?e.ActualColumn=a.startsWith("xEarningType")?"(select Name from "+e.ActualTable+".Remarks.nodes('/XML/Component[@ComponentID=''"+a.Replace("xEarningType","")+"'']') as Data(X) join com_lookup L with(nolock) on X.value('EarDedType[1]','nvarchar(max)')=L.NodeID)":"case when INV.VoucherType=11 then "+e.ActualTable+"."+a+" else null end":406==e.CategoryValue?e.ActualColumn=a.startsWith("xDeductionType")?"(select Name from "+e.ActualTable+".Remarks.nodes('/XML/Component[@ComponentID=''"+a.Replace("xDeductionType","")+"'']') as Data(X) join com_lookup L with(nolock) on X.value('EarDedType[1]','nvarchar(max)')=L.NodeID)":"case when INV.VoucherType=12 then "+e.ActualTable+"."+a+" else null end":407==e.CategoryValue?e.ActualColumn="case when INV.VoucherType=13 then "+e.ActualTable+"."+a+" else null end":408==e.CategoryValue&&(e.ActualColumn="case when INV.VoucherType=14 then "+e.ActualTable+"."+a+" else null end"):e.ActualColumn="NULL":2==e.ParentCostCenterID&&("CreditLimit"==a||"DebitLimit"==a||"CreditDays"==a||"DebitDays"==a)&&this.Entities.values.Contains("TDCC")&&i.a.SessionManager.Preferences.DimWiseCreditDebit.length>0&&parseInt(i.a.SessionManager.Preferences.DimWiseCreditDebit)>5e4?e.ActualColumn="isnull((select "+a.Replace("Limit","Amount")+" from Acc_CreditDebitAmount with(nolock) where AccountID="+e.ActualTable+".AccountID and DimensionID=TDCC.dcCCNID"+(parseInt(i.a.SessionManager.Preferences.DimWiseCreditDebit)-5e4)+"),"+e.ActualTable+"."+a+")":166==e.CategoryValue&&"PolicyType"==a?e.ActualColumn="case "+e.ActualTable+"."+a+" when 1 then 'Dispose Full' when 2 then 'Sale Partial' when 3 then 'Sale Full' else 'Dispose Partial' end":this.StaticReportType>0&&113==e.ParentCostCenterID&&"Status"==e.Column&&this.Report.Preferences.ContainsKey("ReplaceStatus")?e.ActualColumn="case when "+e.ActualTable+".StatusID=429 then case when "+this.Entities.Documents+".BillDate=1 then 'Replace' when "+this.Entities.Documents+".BillDate=1 then 'Partial Replace' else 'Bounced' end else "+e.ActualTable+"."+a+" end":40054==e.CategoryValue&&a.toUpperCase().startsWith("DCALPHA")?(e.ActualColumn="case when INV.VoucherType=11 then "+e.ActualTable+"."+a+" else null end",n&&(e.ActualColumn="-"+e.ActualColumn),this.Filter.Fields.forEach(t=>{t.CDGDO.Column.toUpperCase()==a.toUpperCase()&&(e.ActualColumn=e.ActualTable+"."+a,n&&(e.ActualColumn="-"+e.ActualColumn))})):(e.ActualColumn=e.ActualTable+"."+a,n&&(e.ActualColumn="-"+e.ActualColumn))))}SetActualColumn_1(e){let t=e.CategoryText;if(null!=e.ParentCDGDO&&(t+=e.Table),e.ActualTable=this.Entities[t],e.CategoryValue>=40001&&e.CategoryValue<5e4){if(e.ActualColumn="CASE WHEN ",e.ActualColumn+=e.IsForeignKey?this.Entities[e.ParentTableAlias.Replace("_CCMAP","")]:this.Entities[e.CategoryText],e.ActualColumn+=".CostCenterID="+e.CategoryValue,"DATE"==e.DataType&&e.Column.startsWith("dcAlpha")&&(e.ActualColumn+=" and isdate("+this.Entities[t]+"."+e.Column+")=1"),e.ActualColumn+=" THEN ","DATE"==e.DataType)e.ActualColumn+="CONVERT(DATETIME,"+this.Entities[t]+"."+e.Column+")";else if(e.Column.startsWith("dcAlpha"))if(0!=e.ColumnCostCenterID&&44!=e.ColumnCostCenterID){let s,n,a;if(e.ActualTable=this.Entities[t],o.e.IsEmpty(e.ParentCostCenterSysName)){let t=i.a.report.GetTableColumns(e.ColumnCostCenterID);s=t.TableName,n=t.PrimaryKey,a=t.ColumnName}else s=e.ParentCostCenterSysName,n=e.ParentCostCenterColSysName,a=e.ParentColumn;e.ActualColumn+="(select "+a+" from "+s+" with(nolock) where "+n+"="+this.Entities[t]+"."+e.Column+")"}else e.ActualColumn+=this.Entities[t]+"."+e.Column;else e.ActualColumn+=this.Entities[t]+"."+e.Column;e.ActualColumn+=" ELSE NULL END"}else e.ActualColumn="DATE"==e.DataType?"CONVERT(DATETIME,"+this.Entities[t]+"."+e.Column+")":this.Entities[t]+"."+e.Column}GetKeyWordColumn(t,s){let n="ACC";if(s.IsInventory&&(n="INV"),s.IsInventory)if(11361==t.FieldValue||11415==t.FieldValue||27266==t.FieldValue||182==t.FieldValue){if(0==this.StaticReportType&&!o.e.IsEmpty(t.ALLOtherDocuments)&&!t.ALLOtherDocuments.Contains(s.AbsDocID.toString()))return"null";let n=t.ExecutedDocument,a="",l=null,D=null,C=!1,u=!1;if("ReportViewModel"==this.ClassName){let r=this;null!=r.ToDatePicker&&(r.ToDatePicker.Visible||r.FromDatePicker.Dependantinuse)&&(l=r.ToDatePicker.Date),null!=r.FromDatePicker&&(r.FromDatePicker.Visible||r.FromDatePicker.Dependantinuse)&&(D=r.FromDatePicker.Date),r.Preferences.ContainsKey("ExeQty_ConsiderDocDate")?a=null!=l&&l?",null,'"+l.ToString("dd MMM yyyy")+"'":",null,null":"FOR_PERIOD"==t.Formula?(a=null!=D&&D?",'"+D.ToString("dd MMM yyyy")+"'":",null",a+=null!=l&&l?",'"+l.ToString("dd MMM yyyy")+"'":",null"):"AFTER_PERIOD"==t.Formula?null!=l&&l?(D=l.AddDays(1),l=null,a=",'"+D.ToString("dd MMM yyyy")+"',null"):(D=null,a=",null,null"):a=",null,null",r.Preferences.ContainsKey("ExeQty_DontShowUnApproved")?(C=!0,a+=",1"):(C=!1,a+=",0"),r.Preferences.ContainsKey("ExeQty_ConsiderRejected")?(u=!0,a+=",1"):(u=!1,a+=",0"),!o.e.IsEmptySpace(t.ExecutedDocument)&&n.Contains(",")&&(n="",e.dtExDocs.ContainsKey(Math.abs(s.DocID))||e.dtExDocs.push(Math.abs(s.DocID),i.a.report.GetReportDetails(4,Math.abs(s.DocID)).Tables[0]),e.dtExDocs[Math.abs(s.DocID)].forEach(e=>{t.ExecutedDocument.Contains(e.CostCenterID.toString())&&(n.length>0&&(n+=","),n+=e.CostCenterID.toString())}),0==n.length&&(n="-123"))}if(11361==t.FieldValue){if(this.IsNewFromClause&&this.Filter.IsReportViewScreen&&this.Report.Preferences.ContainsKey("ExeQty_TblFunCall")&&(a+=null!=D&&D?",'"+D.ToString("dd MMM yyyy")+"'":",null",a+=null!=l&&l?",'"+l.ToString("dd MMM yyyy")+"'":",null"),o.e.IsEmptySpace(n)){let e="";return Math.abs(s.DocID)>4e4&&Math.abs(s.DocID)<5e4&&s.IsInventory&&(e=i.a.report.GetExecutedQtyQuery(0,Math.abs(s.DocID).toString(),D,l,C,u),e.Contains("NUM.")&&0==this.StaticReportType&&null!=(r=this.Entities.keys.find(e=>e.endsWith("COM_DocNumData")))&&(e=e.Replace("NUM.",this.Entities[r]+"."))),o.e.IsEmpty(e)?"0":e}return n.Contains(",")?this.IsNewFromClause&&this.Filter.IsReportViewScreen&&this.Report.Preferences.ContainsKey("ExeQty_TblFunCall")?(++this.ExQCnt,this.FromTagExtra+=" left join dbo.fnRPT_ExeQtyByDocsNewAll("+Math.abs(s.DocID)+",'"+n+"'"+a+") ExQ"+this.ExQCnt+" on ExQ"+this.ExQCnt+".InvDocDetailsID=INV.InvDocDetailsID",t.ActualTable="ExQ"+this.ExQCnt+".ExQty","isnull(ExQ"+this.ExQCnt+".ExQty,0)"):"dbo.fnRPT_ExeQtyByDocsNew(INV.CostCenterID,INV.InvDocDetailsID,'"+n+"'"+a+")":this.IsNewFromClause&&this.Filter.IsReportViewScreen&&this.Report.Preferences.ContainsKey("ExeQty_TblFunCall")?(++this.ExQCnt,this.FromTagExtra+=" left join dbo.fnRPT_ExeQtyByDocNewAll("+Math.abs(s.DocID)+","+n+a+") ExQ"+this.ExQCnt+" on ExQ"+this.ExQCnt+".InvDocDetailsID=INV.InvDocDetailsID",t.ActualTable="ExQ"+this.ExQCnt+".ExQty","isnull(ExQ"+this.ExQCnt+".ExQty,0)"):"dbo.fnRPT_ExeQtyByDocNew(INV.CostCenterID,INV.InvDocDetailsID,"+n+a+")"}if(11415==t.FieldValue)return this.StaticReportType>0?"dbo.fnRPT_ExeDocNosByDocNew(D.CostCenterID,D.InvDocDetailsID,'"+n+"'"+a+")":"dbo.fnRPT_ExeDocNosByDocNew(INV.CostCenterID,INV.InvDocDetailsID,'"+n+"'"+a+")";if(27266==t.FieldValue)return this.StaticReportType>0?"dbo.fnRPT_ExeDocDateByDocNew(D.CostCenterID,D.InvDocDetailsID,'"+n+"'"+a+")":"dbo.fnRPT_ExeDocDateByDocNew(INV.CostCenterID,INV.InvDocDetailsID,'"+n+"'"+a+")";if(182==t.FieldValue){let e=this.StaticReportType>0?"D":"INV",i="",l="",r=" FROM INV_DocDetails EINV with(nolock) ",D=n;if(s.AbsDocID>4e4&&s.AbsDocID<5e4&&!o.e.IsEmpty(D)&&D.Contains(s.AbsDocID.toString())){D=D.Replace(s.AbsDocID.toString(),"");let e=D.split(",");D="";for(let t=0;t<e.length;t++){let s=e[t];0!=s.length&&(D.length>0&&(D+=","),D+=s)}if(0==D.length)return"null"}if("FLOAT"==t.DataType)t.Column.startsWith("dcCalcNum")?(i="sum(ENUM."+t.Column+")",r+=" INNER JOIN COM_DocNumData ENUM WITH(NOLOCK) ON ENUM.InvDocDetailsID=EINV.InvDocDetailsID"):i="sum(EINV."+t.Column+")";else if("DATE"==t.DataType)if("ApprovalDate"==t.Column)if(null!=t.Formula&&t.Formula.startsWith("LEVEL")){let e=0;e=o.e.Int(t.Formula.substr(5)),i=" top 1 (select convert(datetime,CreatedDate) from COM_Approvals with(nolock) where ApprovalID IN (select top 1 ApprovalID\nfrom COM_Approvals with(nolock) where RowType=1 and (StatusID=441 or StatusID=369"+(1==e?" or StatusID=371":"")+") and ccid=EINV.costcenterid and ccnodeid=EINV.DocID AND (DocDetID=0 OR DocDetID=EINV.InvDocDetailsID) and WorkFlowLevel="+e+" order by ApprovalID desc))"}else i=" top 1 (select convert(datetime,CreatedDate) from COM_Approvals with(nolock) where ApprovalID IN (select top 1 ApprovalID\nfrom COM_Approvals with(nolock) where RowType=1 and StatusID=369 and ccid=EINV.costcenterid and ccnodeid=EINV.DocID AND (DocDetID=0 OR DocDetID=EINV.InvDocDetailsID) order by ApprovalID desc))";else i="max(EINV."+t.Column+")";else if(t.Column.startsWith("dcAlpha"))i="ETXT."+t.Column,r+=" INNER JOIN COM_DocTextData ETXT WITH(NOLOCK) ON ETXT.InvDocDetailsID=EINV.InvDocDetailsID";else if(t.Column.startsWith("CreditAccount"))i="EA.AccountName",r+=" INNER JOIN ACC_Accounts EA WITH(NOLOCK) ON EA.AccountID=EINV.CreditAccount";else if(t.Column.startsWith("DebitAccount"))i="EA.AccountName",r+=" INNER JOIN ACC_Accounts EA WITH(NOLOCK) ON EA.AccountID=EINV.DebitAccount";else if(t.Column.startsWith("Posting"))i="EA."+t.Column.substr(t.Column.length-11,11),o.e.IsEmptySpace(D)?r+=" JOIN ACC_DocDetails EACC with(nolock) on EACC.InvDocDetailsID=EINV.InvDocDetailsID INNER JOIN ACC_Accounts EA WITH(NOLOCK) ON EA.AccountID=EACC."+t.Column.substr(7,t.Column.length-11):r=" FROM ACC_DocDetails EINV with(nolock) INNER JOIN ACC_Accounts EA WITH(NOLOCK) ON EA.AccountID=EINV."+t.Column.substr(7,t.Column.length-11);else if(t.Column.startsWith("UOM"))i="U.UnitName",r+=" INNER JOIN COM_UOM U WITH(NOLOCK) ON U.UOMID=EINV.Unit";else if("ApprovalBy"==t.Column)if(null!=t.Formula&&t.Formula.startsWith("LEVEL")){let e=o.e.Int(t.Formula.substr(5));i=" top 1 (select CreatedBy from COM_Approvals with(nolock) where ApprovalID IN (select top 1 ApprovalID\nfrom COM_Approvals with(nolock) where RowType=1 and (StatusID=441 or StatusID=369"+(1==e?" or StatusID=371":"")+") and ccid=EINV.costcenterid and ccnodeid=EINV.DocID AND (DocDetID=0 OR DocDetID=EINV.InvDocDetailsID) and WorkFlowLevel="+e+" order by ApprovalID desc))"}else i=" top 1 (select CreatedBy from COM_Approvals with(nolock) where ApprovalID IN (select top 1 ApprovalID\nfrom COM_Approvals with(nolock) where RowType=1 and StatusID=369 and ccid=EINV.costcenterid and ccnodeid=EINV.DocID AND (DocDetID=0 OR DocDetID=EINV.InvDocDetailsID) order by ApprovalID desc))";else i="EINV."+t.Column;return o.e.IsEmptySpace(D)?(l=" WHERE EINV.LinkedInvDocDetailsID="+e+".InvDocDetailsID",l+=C?" and EINV.StatusID=369":" and EINV.StatusID!=376"):(r+=" INNER JOIN dbo.fnRPT_ExeDetailsIDByDoc(INV.CostCenterID,INV.InvDocDetailsID",D.Contains(",")?r+=",'"+D+"'":r+=","+D,r+=a+") AS ED  ON EINV.InvDocDetailsID=ED.DetailsID"),"FLOAT"==t.DataType||"DATE"==t.DataType||"ApprovalBy"==t.Column?i="(SELECT "+i+r+l+")":(0==l.length?l=" WHERE ":l+=" AND ",l+=i+" is not null and "+i+"!=''",i="STUFF((SELECT distinct ', '+"+i+r+l+" FOR XML PATH('')),1,2,'')"),i}}else{if(209==t.FieldValue){let e=this.StaticReportType>0?"D":"INV",s="",i="",n=" FROM INV_DocDetails EINV with(nolock) ";if("DATE"==t.DataType)s="ApprovalDate"==t.Column?"(select convert(datetime,CreatedDate) from COM_Approvals with(nolock) where ApprovalID IN (select top 1 ApprovalID\nfrom COM_Approvals with(nolock) where RowType=1 and StatusID=369 and ccid=EINV.costcenterid and ccnodeid=EINV.DocID AND (DocDetID=0 OR DocDetID=EINV.InvDocDetailsID) order by ApprovalID desc))":"EINV."+t.Column;else if(t.Column.startsWith("dcCalcNum"))s="ENUM."+t.Column,n+=" INNER JOIN COM_DocNumData ENUM WITH(NOLOCK) ON ENUM.InvDocDetailsID=EINV.InvDocDetailsID";else if(t.Column.startsWith("dcAlpha"))s="ETXT."+t.Column,n+=" INNER JOIN COM_DocTextData ETXT WITH(NOLOCK) ON ETXT.InvDocDetailsID=EINV.InvDocDetailsID";else if(t.Column.startsWith("CreditAccount"))s="EA.AccountName",n+=" INNER JOIN ACC_Accounts EA WITH(NOLOCK) ON EA.AccountID=EINV.CreditAccount";else if(t.Column.startsWith("DebitAccount"))s="EA.AccountName",n+=" INNER JOIN ACC_Accounts EA WITH(NOLOCK) ON EA.AccountID=EINV.DebitAccount";else if(t.Column.startsWith("Posting"))s="EA."+t.Column.substr(t.Column.length-11,11),n+=" JOIN ACC_DocDetails EACC with(nolock) on EACC.InvDocDetailsID=EINV.InvDocDetailsID INNER JOIN ACC_Accounts EA WITH(NOLOCK) ON EA.AccountID=EACC."+t.Column.substr(7,t.Column.length-11);else if(t.Column.startsWith("UOM"))s="U.UnitName",n+=" INNER JOIN COM_UOM U WITH(NOLOCK) ON U.UOMID=EINV.Unit";else if("ApprovalBy"==t.Column)if(null!=t.Formula&&t.Formula.startsWith("LEVEL")){let e=0;e=o.e.Int(t.Formula.substr(5)),s=" top 1 (select CreatedBy from COM_Approvals with(nolock) where ApprovalID IN (select top 1 ApprovalID\nfrom COM_Approvals with(nolock) where RowType=1 and (StatusID=441 or StatusID=369"+(1==e?" or StatusID=371":"")+") and ccid=EINV.costcenterid and ccnodeid=EINV.DocID AND (DocDetID=0 OR DocDetID=EINV.InvDocDetailsID) and WorkFlowLevel="+e+" order by ApprovalID desc))"}else s=" top 1 (select CreatedBy from COM_Approvals with(nolock) where ApprovalID IN (select top 1 ApprovalID\nfrom COM_Approvals with(nolock) where RowType=1 and StatusID=369 and ccid=EINV.costcenterid and ccnodeid=EINV.DocID AND (DocDetID=0 OR DocDetID=EINV.InvDocDetailsID) order by ApprovalID desc))";else s="EINV."+t.Column;return i=" WHERE EINV.InvDocDetailsID="+e+".LinkedInvDocDetailsID",s="case when "+e+".LinkedInvDocDetailsID>0 then (SELECT "+s+n+i+") else null end",s}if(13964==t.FieldValue){let e=o.e.IsEmptySpace(t.ExecutedDocument)?"":t.ExecutedDocument;return this.StaticReportType>0?"dbo.fnRPT_RefDocQty(D.CostCenterID,D.InvDocDetailsID,'"+e+"')":"dbo.fnRPT_RefDocQty(INV.CostCenterID,INV.InvDocDetailsID,'"+e+"')"}if(11484==t.FieldValue){let e=o.e.IsEmptySpace(t.ExecutedDocument)?"":t.ExecutedDocument;return this.StaticReportType>0?"dbo.fnRPT_RefDocNos(D.CostCenterID,D.InvDocDetailsID,'"+e+"')":"dbo.fnRPT_RefDocNos(INV.CostCenterID,INV.InvDocDetailsID,'"+e+"')"}if(11514==t.FieldValue){if(o.e.IsEmptySpace(t.ExecutedDocument))return this.StaticReportType>0?"(SELECT convert(datetime,DocDate) FROM INV_DocDetails with(nolock)\tWHERE InvDocDetailsID IN \n(select LinkedInvDocDetailsID from INV_DocDetails with(nolock) WHERE InvDocDetailsID=D.InvDocDetailsID and LinkedInvDocDetailsID>0))":"(SELECT convert(datetime,DocDate) FROM INV_DocDetails with(nolock)\tWHERE InvDocDetailsID IN \n(select LinkedInvDocDetailsID from INV_DocDetails with(nolock) WHERE InvDocDetailsID=INV.InvDocDetailsID and LinkedInvDocDetailsID>0))";{let e=o.e.IsEmptySpace(t.ExecutedDocument)?"":t.ExecutedDocument;return this.StaticReportType>0?"dbo.fnRPT_RefDocDate(D.CostCenterID,D.InvDocDetailsID,'"+e+"')":"dbo.fnRPT_RefDocDate(INV.CostCenterID,INV.InvDocDetailsID,'"+e+"')"}}if(11362==t.FieldValue){if(this.IsInventory){let e="",s="",n=" and A.StatusID!=376";if(this.Entities.values.Contains("TDCC"))if(o.e.IsEmpty(t.DimensionsFilter)){s=" AND A.ProductID=INV.ProductID";let t=0;i.a.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise stock")&&(t=o.e.Int(i.a.SessionManager.Preferences["Maintain Dimensionwise stock"])),0==t&&"True"==i.a.SessionManager.Preferences.EnableLocationWise.toString()&&"True"==i.a.SessionManager.Preferences["LW Reports"]&&(t=50002),0==t&&"True"==i.a.SessionManager.Preferences.EnableDivisionWise.toString()&&"True"==i.a.SessionManager.Preferences["DW Reports"]&&(t=50001),t>0&&(e=" AND DCC.dcCCNID"+(t-5e4)+"=TDCC.dcCCNID"+(t-5e4))}else{let i=t.DimensionsFilter.split("~");i.length>1&&""!=i[1]&&i[1].split(",").forEach(e=>{n+=" and A.StatusID!="+e}),(""==i[0]?[]:i[0].split(",")).forEach(t=>{"3"==t?s=" AND A.ProductID=INV.ProductID":e+=" AND DCC.dcCCNID"+(parseInt(t)-5e4)+"=TDCC.dcCCNID"+(parseInt(t)-5e4)})}else s=" AND A.ProductID=INV.ProductID";return e.length>0&&(s+=e,e=" INNER JOIN COM_DOCCCDATA DCC with(nolock) ON DCC.InvDocDetailsID=A.InvDocDetailsID"),"(SELECT ISNULL(SUM(A.UOMConvertedQty*A.VoucherType),0)\tFROM INV_DocDetails A WITH(NOLOCK)"+e+"\nWHERE (A.VoucherType=1 OR A.VoucherType=-1) AND A.IsQtyIgnored=0"+n+s+")"}return"0"}if(11363==t.FieldValue)return this.IsInventory?"(SELECT ISNULL(SUM(A.UOMConvertedQty*A.VoucherType),0)\tFROM INV_DocDetails A WITH(NOLOCK)\nWHERE A.ProductID=INV.ProductID AND (A.VoucherType=1 OR A.VoucherType=-1) AND A.IsQtyIgnored=0 AND A.StatusID<>376)":"0";if(148==t.FieldValue)return this.IsInventory?"(SELECT ISNULL(SUM(A.UOMConvertedQty*A.VoucherType),0)\tFROM INV_DocDetails A WITH(NOLOCK)\nWHERE A.ProductID=INV.ProductID AND A.BatchID>1 AND A.BatchID=INV.BatchID AND (A.VoucherType=1 OR A.VoucherType=-1) AND A.IsQtyIgnored=0 AND A.StatusID<>376)":"NULL";if(11693==t.FieldValue){if(this.IsInventory){let e=this.Entities.ContainsKey("Documents")?this.Entities.Documents:"INV";return"(select convert(datetime,max(LD.DocDate)) from INV_DocDetails LD with(nolock) where LD.RefInvDocDetailsID="+e+".InvDocDetailsID and LD.BatchID="+e+".BatchID and LD.VoucherType=-1 AND LD.IsQtyIgnored=0 AND LD.ProductID="+e+".ProductID AND LD.DocDate<=@To AND LD.StatusID<>376)"}return"NULL"}if(26428==t.FieldValue)return 0==s.DocID&&this.Entities.ContainsKey("Product")?"(SELECT ISNULL(SUM(A.UOMConvertedQty*A.VoucherType),0)\tFROM INV_DocDetails A WITH(NOLOCK)\nWHERE A.ProductID="+this.Entities.Product+".ProductID AND (A.VoucherType=1 OR A.VoucherType=-1) AND A.IsQtyIgnored=0 AND A.StatusID<>376)":"0";if(208==t.FieldValue)return 0==s.DocID&&this.Entities.ContainsKey("Product")?"case when exists(select ProductID from ADM_SchemesDiscounts with(nolock) where ProductID="+this.Entities.Product+".ProductID) then 'Y' else 'N' end":this.StaticReportType>0||this.IsInventory?"case when exists(select ProductID from ADM_SchemesDiscounts with(nolock) where ProductID=D.ProductID) then 'Y' else 'N' end":"";if(170==t.FieldValue){if(0==s.DocID&&this.Entities.ContainsKey("Product")){let e,s="",n="",a=0;i.a.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise stock")&&(a=o.e.Int(i.a.SessionManager.Preferences["Maintain Dimensionwise stock"])),0==a&&"True"==i.a.SessionManager.Preferences.EnableLocationWise.toString()&&"True"==i.a.SessionManager.Preferences["LW Reports"]&&(a=50002),50002==a&&i.a.SessionManager.LocationID>0&&(n=" INNER JOIN COM_DOCCCDATA DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=A.InvDocDetailsID AND DCC.dcCCNID2="+i.a.SessionManager.LocationID);let l="LATEST"==t.Formula;"DATE"==t.DataType?(l=!0,e=l?"top 1 convert(datetime,A."+t.Column+")":"max(convert(datetime,A."+t.Column+"))"):"FLOAT"==t.DataType?(t.Column.startsWith("dcCalcNum")?(s+=" INNER JOIN COM_DocNumData NUM WITH(NOLOCK) ON NUM.InvDocDetailsID=A.InvDocDetailsID",e="NUM."+t.Column):("Rate"==t.Column&&(l=!0),e="A."+t.Column),e=l?"top 1 "+e:"ISNULL(SUM("+e+"),0)"):t.Column.startsWith("dcAlpha")?(s+=" INNER JOIN COM_DocTextData TXT WITH(NOLOCK) ON TXT.InvDocDetailsID=A.InvDocDetailsID",e="TXT."+t.Column,e="top 1 "+e,l=!0):(l=!0,e="top 1 A."+t.Column);let r="(SELECT "+e+" FROM INV_DocDetails A WITH(NOLOCK)"+s+n;return r+=" WHERE A.ProductID="+this.Entities.Product+".ProductID AND A.StatusID<>376",o.e.IsEmptySpace(t.ExecutedDocument)||(t.ExecutedDocument.Contains(",")?r+=" AND A.CostCenterID IN ("+t.ExecutedDocument+")":r+=" AND A.CostCenterID="+t.ExecutedDocument),l&&(r+=" order by A.DocDate desc"),r+=")",r}return"NULL"}if(25900==t.FieldValue){if(0==s.DocID&&this.Entities.ContainsKey("Product")){let e="",s="",n=0;if(i.a.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise stock")&&(n=o.e.Int(i.a.SessionManager.Preferences["Maintain Dimensionwise stock"])),0==n&&"True"==i.a.SessionManager.Preferences.EnableLocationWise.toString()&&"True"==i.a.SessionManager.Preferences["LW Reports"]&&(n=50002),50002==n&&i.a.SessionManager.LocationID>0&&(e=" AND DCC.dcCCNID2="+i.a.SessionManager.LocationID),t.ParentCCDefaultColID>5e4){var l=this.Filter.CostCenterFilters.find(e=>e.CostCenterID==t.ParentCCDefaultColID);if(l&&(l.SelectedNodes.length>0||!l.DeleteButtonVisibility)){e.length>0&&(e+=" AND "),e+=" AND DCC.dcCCNID"+(t.ParentCCDefaultColID-5e4)+" IN (";for(let t=0;t<l.SelectedNodes.length;t++)t>0&&(e+=","),e+=l.SelectedNodes[t].Id;0==l.SelectedNodes.length&&(e+="-12912"),e+=")"}}return e.length>0&&(s=" INNER JOIN COM_DOCCCDATA DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=A.InvDocDetailsID"),"(SELECT ISNULL(SUM(A.UOMConvertedQty*A.VoucherType),0)\tFROM INV_DocDetails A WITH(NOLOCK)"+s+"\tWHERE A.ProductID="+this.Entities.Product+".ProductID AND (A.VoucherType=1 OR A.VoucherType=-1) AND A.IsQtyIgnored=0 AND A.StatusID<>376"+e+")"}return"0"}if(11420==t.FieldValue){if(this.IsInventory){let e="",s="",n="",a=" and A.StatusID!=376";if(this.Entities.values.Contains("TDCC"))if(o.e.IsEmpty(t.DimensionsFilter)){n=" AND A.ProductID=INV.ProductID";let e=0;i.a.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise stock")&&(e=o.e.Int(i.a.SessionManager.Preferences["Maintain Dimensionwise stock"])),0==e&&"True"==i.a.SessionManager.Preferences.EnableLocationWise.toString()&&"True"==i.a.SessionManager.Preferences["LW Reports"]&&(e=50002),0==e&&"True"==i.a.SessionManager.Preferences.EnableDivisionWise.toString()&&"True"==i.a.SessionManager.Preferences["DW Reports"]&&(e=50001),e>0&&(s=" AND DCC.dcCCNID"+(e-5e4)+"=TDCC.dcCCNID"+(e-5e4))}else{let e=t.DimensionsFilter.split("~");e.length>1&&""!=e[1]&&e[1].split(",").forEach(e=>{a+=" and A.StatusID!="+e}),(""==e[0]?[]:e[0].split(",")).forEach(e=>{"3"==e?n=" AND A.ProductID=INV.ProductID":s+=" AND DCC.dcCCNID"+(parseInt(e)-5e4)+"=TDCC.dcCCNID"+(parseInt(e)-5e4)})}else n=" AND A.ProductID=INV.ProductID";return s.length>0&&(n+=s,s=" INNER JOIN COM_DOCCCDATA DCC with(nolock) ON DCC.InvDocDetailsID=A.InvDocDetailsID"),e="(SELECT ISNULL(SUM(A.UOMConvertedQty*A.VoucherType),0)\tFROM INV_DocDetails A WITH(NOLOCK)"+s+" WHERE A.StatusID!=376 AND A.ProductID=INV.ProductID AND (A.VoucherType=1 OR A.VoucherType=-1) AND A.IsQtyIgnored=0"+a+n,null!=this.Report&&!o.e.IsEmpty(t.DimensionsFilter)&&t.DimensionsFilter.Contains("FROMDATE$1")?e+=" AND (A.DocumentType=3 OR A.DocDate<convert(float,convert(datetime,'"+this.Report.FromDatePicker.Date.ToString("dd MMM yyyy")+"')))":e+=" AND (A.DocumentType=3 OR A.DocDate<INV.DocDate)",e+=")",e}return"NULL"}if("HoldQuantity"==t.Column){let e="(select INV.HoldQuantity-(case when release>INV.HoldQuantity then INV.HoldQuantity else release end) Executed\nfrom  (\nSELECT isnull(sum(case when ";return o.e.IsEmpty(i.a.SessionManager.Preferences.HoldResCancelledDocs)?e+="l.IsQtyIgnored=0":e+="(l.IsQtyIgnored=0 or l.Costcenterid in("+i.a.SessionManager.Preferences.HoldResCancelledDocs+"))",e+="then l.Quantity else l.ReserveQuantity end),0) release \nFROM INV_DocDetails l WITH(NOLOCK) WHERE INV.InvDocDetailsID=l.LinkedInvDocDetailsID) as t)",e}if(26419==t.FieldValue||26420==t.FieldValue||50453==t.FieldValue||26419==t.ParentCCDefaultColID||26420==t.ParentCCDefaultColID||50453==t.ParentCCDefaultColID){let e="",s="",n=this.GetDimensionFilterForStock("DCCX.dcCCNID"),l="";n.length>0&&(s=" INNER JOIN COM_DocCCData DCCX WITH(NOLOCK)  ON DCCX.InvDocDetailsID=DX.InvDocDetailsID");let r="";this.StaticReportType>0?r="P.ProductID":this.Entities.ContainsKey("Product")?r=this.Entities.Product+".ProductID":(r="INV.ProductID",o.e.IsEmpty(t.DimensionsFilter)||(s=" INNER JOIN COM_DocCCData DCCX WITH(NOLOCK)  ON DCCX.InvDocDetailsID=DX.InvDocDetailsID",n="",t.DimensionsFilter.split(",").forEach(e=>{n+=" AND DCCX.dcCCNID"+(parseInt(e)-5e4)+"="+this.Entities.Documents_CCMAP+".dcCCNID"+(parseInt(e)-5e4)})));let D="sum(case when l.IsQtyIgnored=0 then l.UOMConvertedQty else l.ReserveQuantity end)";if(D=o.e.IsEmpty(i.a.SessionManager.Preferences.HoldResCancelledDocs)?"sum(case when l.IsQtyIgnored=0 then l.UOMConvertedQty else l.ReserveQuantity end)":"sum(case when (l.IsQtyIgnored=0 or l.Costcenterid in("+i.a.SessionManager.Preferences.HoldResCancelledDocs+")) then l.UOMConvertedQty else l.ReserveQuantity end)",n.length>0){let e=0;i.a.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise stock")&&(e=o.e.Int(i.a.SessionManager.Preferences["Maintain Dimensionwise stock"])),e>0&&(l=" left JOIN COM_DocCCData DCCXL WITH(NOLOCK)  ON DCCXL.InvDocDetailsID=l.InvDocDetailsID AND  DCCXL.dcCCNID"+(e-5e4)+"=DCCX.dcCCNID"+(e-5e4),D=o.e.StringIsNullOrEmpty(i.a.SessionManager.Preferences.HoldResCancelledDocs)?"sum(case when DCCXL.InvDocDetailsID is not null and l.IsQtyIgnored=0 then l.UOMConvertedQty when DCCXL.InvDocDetailsID is not null THEN l.ReserveQuantity else 0 end)":"sum(case when DCCXL.InvDocDetailsID is not null and (l.IsQtyIgnored=0 or l.Costcenterid in("+i.a.SessionManager.Preferences.HoldResCancelledDocs+")) then l.UOMConvertedQty when DCCXL.InvDocDetailsID is not null THEN l.ReserveQuantity else 0 end)")}if(26419==t.FieldValue||26419==t.ParentCCDefaultColID){e="(select isnull(sum(HoldQuantity-rel),0) from (select HoldQuantity,case when release>HoldQuantity then HoldQuantity else release end rel from \n                        (SELECT DX.HoldQuantity\n,isnull((select "+D+" from INV_DocDetails l WITH(NOLOCK)"+l+" where DX.InvDocDetailsID=l.LinkedInvDocDetailsID),0) release\nFROM INV_DocDetails DX WITH(NOLOCK)"+s+"\nWHERE DX.ProductID="+r+" AND DX.IsQtyIgnored=1 and DX.StatusID";let t=this;!o.e.IsEmpty(i.a.SessionManager.Preferences.ConsiderUnAppInHold)&&Object(a.j)(i.a.SessionManager.Preferences.ConsiderUnAppInHold)?"ReportViewModel"==this.ClassName&&t.Preferences.ContainsKey("IncludeUnPostedDocsHoldQty")&&"1"==t.Preferences.IncludeUnPostedDocsHoldQty?e+=" not in (372,376)":e+="AddEditReportViewModel"==this.ClassName&&null!=t.Options.GLIncludeUnPostedDocsHoldQty&&t.Options.GLIncludeUnPostedDocsHoldQty.Visible&&t.Options.GLIncludeUnPostedDocsHoldQty.IsChecked?" not in (372,376)":" in (371,441,369)":"ReportViewModel"==this.ClassName&&t.Preferences.ContainsKey("IncludeUnPostedDocsHoldQty")&&"1"==t.Preferences.IncludeUnPostedDocsHoldQty?e+=" not in (372,376)":e+="AddEditReportViewModel"==this.ClassName&&null!=t.Options.GLIncludeUnPostedDocsHoldQty&&t.Options.GLIncludeUnPostedDocsHoldQty.Visible&&t.Options.GLIncludeUnPostedDocsHoldQty.IsChecked?" not in (372,376)":"=369",e+=" and DX.DocumentType in (7,9,11,12,24) and DX.VoucherType=-1 "+n+" \n                ) as t)as temp) "}else if(26420==t.FieldValue||26420==t.ParentCCDefaultColID){let t="";16==this.StaticReportType&&null!=this.oReportDialog&&(t=" and DX.DocDate<=convert(float,convert(datetime,'"+this.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))"),n+=t,e="(select isnull(sum(HoldQuantity-rel),0) from (select HoldQuantity,case when release>HoldQuantity then HoldQuantity else release end rel from\n                    (SELECT DX.ReserveQuantity HoldQuantity\n,isnull((select "+D+" from INV_DocDetails l WITH(NOLOCK)"+l+" where DX.InvDocDetailsID=l.LinkedInvDocDetailsID"+t.replace("DX.DocDate","l.DocDate")+"),0) release\nFROM INV_DocDetails DX WITH(NOLOCK)"+s+"\nWHERE DX.ProductID="+r+" AND DX.IsQtyIgnored=1 and DX.StatusID",!o.e.IsEmpty(i.a.SessionManager.Preferences.ConsiderUnAppInHold)&&Object(a.j)(i.a.SessionManager.Preferences.ConsiderUnAppInHold)?e+=" in (371,441,369)":e+="=369";let C=this;!o.e.IsEmpty(i.a.SessionManager.Preferences.ConsiderUnAppInHold)&&Object(a.j)(i.a.SessionManager.Preferences.ConsiderUnAppInHold)?"ReportViewModel"==this.ClassName&&C.Preferences.ContainsKey("IncludeUnPostedDocsReserveQty")&&"1"==C.Preferences.IncludeUnPostedDocsReserveQty.ToString()?e+=" not in (372,376)":e+="AddEditReportViewModel"==this.ClassName&&null!=C.Options.GLIncludeUnPostedDocsReserveQty&&C.Options.GLIncludeUnPostedDocsReserveQty.Visible&&C.Options.GLIncludeUnPostedDocsReserveQty.IsChecked?" not in (372,376)":" in (371,441,369)":"ReportViewModel"==this.ClassName&&C.Preferences.ContainsKey("IncludeUnPostedDocsReserveQty")&&"1"==C.Preferences.IncludeUnPostedDocsReserveQty.ToString()?e+=" not in (372,376)":e+="AddEditReportViewModel"==this.ClassName&&null!=C.Options.GLIncludeUnPostedDocsReserveQty&&C.Options.GLIncludeUnPostedDocsReserveQty.Visible&&C.Options.GLIncludeUnPostedDocsReserveQty.IsChecked?" not in (372,376)":"=369",e+=" and DX.DocumentType in (7,9,11,12,24) and DX.VoucherType=-1 "+n+" \n) as t)as temp) "}else 50453!=t.FieldValue&&50453!=t.ParentCCDefaultColID||(e="(select isnull(sum(HoldQuantity-rel),0) from (select HoldQuantity,case when release>HoldQuantity then HoldQuantity else release end rel from\n                    (SELECT DX.ReserveQuantity HoldQuantity\n,isnull((select "+D+" from INV_DocDetails l WITH(NOLOCK)"+l+" where DX.InvDocDetailsID=l.LinkedInvDocDetailsID),0) release\nFROM INV_DocDetails DX WITH(NOLOCK)"+s+"\nWHERE DX.ProductID="+r+" AND DX.IsQtyIgnored=1 and DX.StatusID=369  and DX.DocumentType in (1,2,4,10,25,26,27) and DX.VoucherType=1 "+n+"\n) as t)as temp) ");return e}if(11383==t.FieldValue||11384==t.FieldValue){let e="dcCCNID2";return t.ParentCCDefaultColID>5e4&&t.ParentCCDefaultColID<51e3&&(e="dcCCNID"+(t.ParentCCDefaultColID-5e4)),"(SELECT TOP 1 "+(11383==t.FieldValue?"TOLOC.Code":"TOLOC.Name")+" FROM Inv_DocDetails ToINV WITH(NOLOCK) INNER JOIN COM_DocCCData TOCC WITH(NOLOCK) ON TOCC.InvDocDetailsID=ToINV.InvDocDetailsID INNER JOIN COM_Location TOLOC WITH(NOLOCK) ON TOCC."+e+"=TOLOC.NodeID WHERE ToINV.voucherno=INV.voucherno AND ToINV.DocSeqNo=INV.DocSeqNo AND ToINV.VoucherType!=INV.VoucherType)"}if(11424==t.FieldValue)return"(SELECT TOP 1 S.ProfileName FROM ADM_SchemesDiscounts S WITH(NOLOCK) WHERE S.SchemeID=INV.IsQtyFreeOffer)";if(11425==t.FieldValue)return this.StaticReportType>0?"(CASE WHEN D.IsQtyFreeOffer=1 OR (D.ParentSchemeID!='' and D.ParentSchemeID is not null) THEN D.Quantity ELSE 0.0 END)":"(CASE WHEN INV.IsQtyFreeOffer=1 OR (INV.ParentSchemeID!='' and INV.ParentSchemeID is not null) THEN INV.Quantity ELSE 0.0 END)";if(189==t.FieldValue)return"(select top 1 Rate from INV_DocDetails with(nolock) where  ProductID="+(this.StaticReportType>0?"D":"INV")+".ProductID and UOMConvertedQty>0"+(o.e.IsEmptySpace(t.ExecutedDocument)?" and IsQtyIgnored=0":" and CostCenterID IN ("+t.ExecutedDocument+")")+" order by docdate desc)";if(11509==t.FieldValue)return"(select top 1 StockValue/UOMConvertedQty from INV_DocDetails with(nolock) where  ProductID="+(this.StaticReportType>0?"D":"INV")+".ProductID and VoucherType=1 and UOMConvertedQty>0"+(o.e.IsEmptySpace(t.ExecutedDocument)?" and IsQtyIgnored=0":" and CostCenterID IN ("+t.ExecutedDocument+")")+" order by docdate desc)";if(11510==t.FieldValue){let e=o.e.IsEmptySpace(t.ExecutedDocument)?" and IsQtyIgnored=0":" and CostCenterID IN ("+t.ExecutedDocument+")";return this.StaticReportType>0?"(select top 1 StockValue/UOMConvertedQty from INV_DocDetails with(nolock) where  ProductID=D.ProductID and VoucherType=1 and UOMConvertedQty>0"+e+" order by docdate desc)":0==s.DocID&&this.Entities.ContainsKey("Product")?"(select top 1 StockValue/UOMConvertedQty from INV_DocDetails with(nolock) where  ProductID="+this.Entities.Product+".ProductID and VoucherType=1 and UOMConvertedQty>0"+e+" order by docdate desc)":"0"}if(11511==t.FieldValue||11512==t.FieldValue||11513==t.FieldValue)return this.IsAvgRateExists=!0,this.StaticReportType>0?"NULL":0==s.DocID&&this.Entities.ContainsKey("Product")||this.Entities.values.Contains("INV")?"0.0":"null";if(188==t.FieldValue){if(this.StaticReportType>0)return"NULL";var r;if(r=this.Entities.keys.find(e=>e.endsWith("COM_DocNumData"))){let e=o.e.Int(t.Formula);return"(select X.value('@Remarks','nvarchar(max)') from "+this.Entities[r]+".Remarks.nodes('/XML/Row') as Data(X) where X.value('@Columnname','nvarchar(50)')='dcNum"+e+"')"}return"NULL"}if(t.FieldValue>=164&&t.FieldValue<=167||t.FieldValue>=11657&&t.FieldValue<=11658){let e="STUFF( (select";return 164==t.FieldValue?e+="', '+SA1.AccountName from acc_docdetails S1 with(nolock)  inner join acc_accounts SA1 with(nolock) on SA1.AccountID=S1.DebitAccount\nwhere S1.InvDocDetailsID=INV.InvDocDetailsID  group by SA1.AccountName":165==t.FieldValue?e+="', '+SA1.AccountName from acc_docdetails S1 with(nolock)  inner join acc_accounts SA1 with(nolock) on SA1.AccountID=S1.CreditAccount\nwhere S1.InvDocDetailsID=INV.InvDocDetailsID  group by SA1.AccountName":166==t.FieldValue?e+="', '+convert(nvarchar,sum(S1.Amount)) from acc_docdetails S1 with(nolock)  inner join acc_accounts SA1 with(nolock) on SA1.AccountID=S1.DebitAccount\nwhere S1.InvDocDetailsID=INV.InvDocDetailsID  group by SA1.AccountName":167==t.FieldValue?e+="', '+convert(nvarchar,sum(S1.Amount)) from acc_docdetails S1 with(nolock)  inner join acc_accounts SA1 with(nolock) on SA1.AccountID=S1.CreditAccount\nwhere S1.InvDocDetailsID=INV.InvDocDetailsID  group by SA1.AccountName":11657==t.FieldValue?e+="', '+convert(nvarchar,sum(S1.AmountFC)) from acc_docdetails S1 with(nolock)  inner join acc_accounts SA1 with(nolock) on SA1.AccountID=S1.DebitAccount\nwhere S1.InvDocDetailsID=INV.InvDocDetailsID  group by SA1.AccountName":11658==t.FieldValue&&(e+="', '+convert(nvarchar,sum(S1.AmountFC)) from acc_docdetails S1 with(nolock)  inner join acc_accounts SA1 with(nolock) on SA1.AccountID=S1.CreditAccount\nwhere S1.InvDocDetailsID=INV.InvDocDetailsID  group by SA1.AccountName"),e+=" FOR XML PATH(''),type).value('.','nvarchar(max)'),1,2,'')",e}if(204==t.FieldValue)return"STUFF((SELECT ', '+SerialNumber from INV_SerialStockProduct with(nolock) where InvDocDetailsID="+(0==this.StaticReportType?"INV":"D")+".InvDocDetailsID FOR XML PATH('')),1,2,'')";if(181==t.FieldValue){let e="",s="Code"==t.Column?"Code":"Name",i=this.StaticReportType>0?"D":n;if(16==this.StaticReportType)return e;if(13==this.StaticReportType||81==this.StaticReportType||82==this.StaticReportType||83==this.StaticReportType||158==this.StaticReportType){if(this.Filter.IsReportViewScreen){let e=this;if(this.ReportParams.ContainsKey("BinDetail")&&this.ReportParams.Remove("BinDetail"),e.Preferences.ContainsKey("BinDetail")&&"1"==e.Preferences.BinDetail)return this.GroupFromTag.Contains("BIN.NodeID")||(this.GroupFromTag+=" left join INV_BinDetails BD with(nolock) on BD.InvDocDetailsID="+i+".InvDocDetailsID left join "+t.ParentCostCenterSysName+" BIN with(nolock) ON BIN.NodeID=BD.BinID"),this.ReportParams.ContainsKey("BinInfo")&&this.ReportParams.Remove("BinInfo"),this.ReportParams.ContainsKey("BinDetail")||this.ReportParams.push("BinDetail",""),"BIN."+s}e="STUFF((SELECT distinct ', '+B."+s,(81!=this.StaticReportType&&"2"!=t.Formula||82==this.StaticReportType||83==this.StaticReportType)&&(e+="+'-'+convert(nvarchar,Quantity)"),e+=" FROM INV_BinDetails BD with(nolock) inner join "+t.ParentCostCenterSysName+" B with(nolock) ON B.NodeID=BD.BinID WHERE BD.InvDocDetailsID="+i+".InvDocDetailsID\n                FOR XML PATH('')),1,2,'')",this.ReportParams.ContainsKey("BinInfo")||this.ReportParams.push("BinInfo",""),this.ReportParams.BinInfo=e}else e=0==this.StaticReportType?"STUFF((SELECT distinct ', '+B."+s+"+'-'+convert(nvarchar,Quantity) FROM INV_BinDetails BD with(nolock) inner join "+t.ParentCostCenterSysName+" B with(nolock) ON B.NodeID=BD.BinID WHERE BD.InvDocDetailsID="+i+".InvDocDetailsID FOR XML PATH('')),1,2,'')":"NULL";return e}if(26648==t.FieldValue){if(this.IsInventory&&("TRUE"==i.a.SessionManager.Preferences["LW Bins"].toUpperCase()||"TRUE"==i.a.SessionManager.Preferences["DW Bins"].toUpperCase())){let e=i.a.common.GetDataTable("RPT037","");if(e.Columns[0].Contains("TableName")&&e.Table[0].length>0){let t="dcCCNID1",s="Division";"TRUE"==i.a.SessionManager.Preferences["LW Bins"].toUpperCase()&&(t="dcCCNID2",s="Location");let n="";for(let e=0;e<this.Objects.length;e++)if(this.Entities.keys[e].endsWith("_CCMAP")&&"COM_DOCCCDATA"==this.Objects[e].Table.toUpperCase()){n=this.Entities.keys[e];break}if(!o.e.IsEmpty(n))return"(select TOP 1 D.Name from INV_ProductBins B with(nolock)\ninner join "+e.Table[0].TableName.toString()+" D with(nolock) on B.BinNodeID=D.NodeID\nwhere B."+s+"="+this.Entities[n]+"."+t+" AND B.NodeID=INV.ProductID AND B.CostCenterID=3)"}}return"NULL"}}else{if(11366==t.FieldValue)return this.StaticReportType>0?"(SELECT top 1 CPDC.VoucherNo FROM ACC_DocDetails CPDC with(nolock) WHERE CPDC.RefCCID=400 AND CPDC.refnodeid=D.AccDocDetailsID and CPDC.CostCenterID=(select TOP 1ConvertAS from ADM_DocumentTypes DTP with(nolock) where DTP.CostCenterID=D.CostCenterID ))":"(SELECT top 1 CPDC.VoucherNo FROM ACC_DocDetails CPDC with(nolock) WHERE CPDC.RefCCID=400 AND CPDC.refnodeid=ACC.AccDocDetailsID and CPDC.CostCenterID=(select ConvertAS from ADM_DocumentTypes D with(nolock) where d.CostCenterID=ACC.CostCenterID ))";if(11367==t.FieldValue)return this.StaticReportType>0?"(SELECT top 1 CPDC.VoucherNo FROM ACC_DocDetails CPDC with(nolock) WHERE CPDC.RefCCID=400 AND CPDC.refnodeid=D.AccDocDetailsID and CPDC.CostCenterID=(select TOP 1 ConvertAS from ADM_DocumentTypes DTP with(nolock) where DTP.CostCenterID=D.CostCenterID ))":"(SELECT top 1 CONVERT(DATETIME,CPDC.DocDate) FROM ACC_DocDetails CPDC with(nolock) WHERE CPDC.RefCCID=400 AND CPDC.refnodeid=ACC.AccDocDetailsID and CPDC.CostCenterID=(select ConvertAS from ADM_DocumentTypes D with(nolock) where d.CostCenterID=ACC.CostCenterID ))";if(11410==t.FieldValue)return"(SELECT top 1 CONVERT(DATETIME,CPDC.DocDate) FROM ACC_DocDetails CPDC with(nolock) WHERE CPDC.RefCCID=400 AND CPDC.refnodeid=ACC.AccDocDetailsID and CPDC.CostCenterID=(select IntermediateConvertion from ADM_DocumentTypes D with(nolock) where d.CostCenterID=ACC.CostCenterID ))";if(11411==t.FieldValue)return this.StaticReportType>0?"(SELECT top 1 CPDC.VoucherNo FROM ACC_DocDetails CPDC with(nolock) WHERE CPDC.RefCCID=400 AND CPDC.refnodeid=D.AccDocDetailsID and CPDC.CostCenterID=(select IntermediateConvertion from ADM_DocumentTypes DT with(nolock) where dT.CostCenterID=D.CostCenterID ))":"(SELECT top 1 CPDC.VoucherNo FROM ACC_DocDetails CPDC with(nolock) WHERE CPDC.RefCCID=400 AND CPDC.refnodeid=ACC.AccDocDetailsID and CPDC.CostCenterID=(select IntermediateConvertion from ADM_DocumentTypes D with(nolock) where d.CostCenterID=ACC.CostCenterID ))";if("DebitAmount"==t.Column)return"(CASE WHEN ACC.DebitAccount>0 THEN ACC.Amount ELSE 0 END)";if("CreditAmount"==t.Column)return"(CASE WHEN ACC.CreditAccount>0 THEN ACC.Amount ELSE 0 END)";if(210==t.FieldValue)return"NULL"}if(214==t.FieldValue){let e="";1!=this.StaticReportType&&-2!=this.StaticReportType||(n="D");let i=o.e.IsEmpty(t.DimensionsFilter)?[]:t.DimensionsFilter.split("~");if(i.length>2&&i[1].length>0&&i[2].length>0){let t=!1,o=!1,a=i[2].split(",");for(let i=0;i<a.length;i++)if(i>0&&(e+=","),a[i].startsWith("EFPD_"))"EFPD_AccDocDetailsID"==a[i]?o=!0:"EFPD_InvDocDetailsID"!=a[i]&&"EFPD_ProductID"!=a[i]||(t=!0),e+=o&&s.IsInventory||t&&!s.IsInventory?"null":"EFPD_Account"==a[i]?s.IsDebit?n+".DebitAccount":n+".CreditAccount":n+"."+a[i].Replace("EFPD_","");else if(a[i].startsWith("EF_"))e=this.SetExtFunctionParams(a[i],e);else if(a[i].startsWith("COL_")&&"ReportViewModel"==this.ClassName){var D=this.BaseReportColumns.find(e=>e.ID==a[i].substr(4));if(D){let t=D.CDGDO.IsForeignKey?D.CDGDO.ParentCostCenterID:D.CDGDO.CategoryValue;400!=t&&(t<4e4||t>5e4)&&("NULL"!=D.CDGDO.ActualColumn?(this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(e=>e.FeatureID==t),e+=D.CDGDO.ActualTable+"."+this.drrCCTbl[0].PK.toString()):e+="NULL")}}return e.length>0?e="dbo."+i[1]+"("+e+")":"null"}return"null"}if(11364==t.FieldValue)return"CASE WHEN (SELECT COUNT(*) FROM COM_Files WITH(NOLOCK) WHERE FeatureID="+n+".CostCenterID AND FeaturePK="+n+".DocID)>0 THEN 'YES' ELSE 'NO' END";if(11516==t.FieldValue)return"stuff((select ','+Note from COM_Notes WITH(NOLOCK) WHERE FeatureID="+n+".CostCenterID AND FeaturePK="+n+".DocID FOR XML PATH('')),1,1,'')";if(11690==t.FieldValue)return"stuff((select distinct ','+Note from COM_Notes WITH(NOLOCK) WHERE FeatureID="+n+".RefCCID AND FeaturePK="+n+".RefNodeid),1,1,'')";if("ProductImage"==t.Column)return"(select top 1 F.GUID+'.'+F.FileExtension from COM_Files F WITH(NOLOCK) where F.FeatureID=3 and F.IsProductImage=1 and F.FeaturePK="+this.Entities[t.CategoryText]+".ProductID and F.IsDefaultImage=1)";if("DimensionImage"==t.Column)return"(select top 1 F.GUID+'.'+F.FileExtension from COM_Files F WITH(NOLOCK) where F.FeatureID="+(t.ParentCostCenterID>0?t.ParentCostCenterID:t.CategoryValue)+" and F.IsProductImage=1 and F.FeaturePK="+this.Entities[t.CategoryText]+".NodeID and F.IsDefaultImage=1)";if(11368==t.FieldValue)return" (SELECT ISNULL(SUM(abs(AdjAmount)),0) FROM COM_Billwise CB WITH(NOLOCK) WHERE IsNewReference=0 AND (CB.RefDocNo="+n+".VoucherNo OR CB.DocNo="+n+".VoucherNo))";if(11409==t.FieldValue){let e=this;return"INV"==n?"AddEditReportViewModel"==this.ClassName&&e.Options.ExcludePDCAdjust.IsChecked||"ReportViewModel"==this.ClassName&&e.Preferences.ContainsKey("ExcludePDCsAdjust")&&"1"==e.Preferences.ExcludePDCsAdjust?" (SELECT ISNULL(SUM(abs(AdjAmount)),0) FROM COM_Billwise CB WITH(NOLOCK) WHERE CB.StatusID Not in (370) AND IsNewReference=0 and DynamicInvDocDetailsID is null AND ((CB.RefDocNo="+n+".VoucherNo and "+n+".DocSeqNo=CB.RefDocSeqNo) OR (CB.DocNo="+n+".VoucherNo AND "+n+".DocSeqNo=CB.DocSeqNo)))":" (SELECT ISNULL(SUM(abs(AdjAmount)),0) FROM COM_Billwise CB WITH(NOLOCK) WHERE IsNewReference=0 and DynamicInvDocDetailsID is null AND ((CB.RefDocNo="+n+".VoucherNo and "+n+".DocSeqNo=CB.RefDocSeqNo) OR (CB.DocNo="+n+".VoucherNo AND "+n+".DocSeqNo=CB.DocSeqNo)))":"AddEditReportViewModel"==this.ClassName&&e.Options.ExcludePDCAdjust.IsChecked||"ReportViewModel"==this.ClassName&&e.Preferences.ContainsKey("ExcludePDCsAdjust")&&"1"==e.Preferences.ExcludePDCsAdjust?" (SELECT ISNULL(SUM(abs(AdjAmount)),0) FROM COM_Billwise CB WITH(NOLOCK) WHERE CB.StatusID Not in (370) AND IsNewReference=0 AND ((CB.RefDocNo="+n+".VoucherNo and "+n+".DocSeqNo=CB.RefDocSeqNo) OR (CB.DocNo="+n+".VoucherNo AND "+n+".DocSeqNo=CB.DocSeqNo)))":" (SELECT ISNULL(SUM(abs(AdjAmount)),0) FROM COM_Billwise CB WITH(NOLOCK) WHERE IsNewReference=0 AND ((CB.RefDocNo="+n+".VoucherNo and "+n+".DocSeqNo=CB.RefDocSeqNo) OR (CB.DocNo="+n+".VoucherNo AND "+n+".DocSeqNo=CB.DocSeqNo)))"}if(213==t.FieldValue)return"stuff(\n(select ','+convert(nvarchar, convert(datetime,LastDate),106) from\n(SELECT DocNo, DocDate LastDate FROM COM_Billwise CB WITH(NOLOCK) WHERE IsNewReference=0 AND (CB.RefDocNo=INV.VoucherNo) \nUNION ALL\nSELECT RefDocNo,RefDocDate LastDate FROM COM_Billwise CB WITH(NOLOCK) WHERE IsNewReference=0 AND (CB.DocNo=INV.VoucherNo)\n) as T\ngroup by DocNo,LastDate FOR XML PATH('')), 1,1,'')";if(11369==t.FieldValue)return"(SELECT TOP 1 CONVERT(DATETIME,LastDate) FROM (\nSELECT DocDate LastDate FROM COM_Billwise CB WITH(NOLOCK) WHERE IsNewReference=0 AND (CB.RefDocNo="+n+".VoucherNo)\nUNION\nSELECT RefDocDate LastDate FROM COM_Billwise CB WITH(NOLOCK) WHERE IsNewReference=0 AND (CB.DocNo="+n+".VoucherNo) ) AS T ORDER BY LastDate DESC)";if(11370==t.FieldValue)return"(SELECT TOP 1 DocNo FROM (\nSELECT DocDate LastDate,CB.DocNo DocNo FROM COM_Billwise CB WITH(NOLOCK) WHERE IsNewReference=0 AND (CB.RefDocNo="+n+".VoucherNo)\nUNION\nSELECT RefDocDate LastDate,CB.RefDocNo DocNo FROM COM_Billwise CB WITH(NOLOCK) WHERE IsNewReference=0 AND (CB.DocNo="+n+".VoucherNo) ) AS T ORDER BY LastDate DESC)";if(11414==t.FieldValue)return this.StaticReportType>0?"dbo.fnRPT_GetAdjustedDocNos(D.VoucherNo)":"dbo.fnRPT_GetAdjustedDocNos("+n+".VoucherNo)";if(527==t.FieldValue)return this.StaticReportType>0?"dbo.fnRPT_GetAdjustedDocChequeDate(D.VoucherNo)":"dbo.fnRPT_GetAdjustedDocChequeDate("+n+".VoucherNo)";if(528==t.FieldValue)return this.StaticReportType>0?"dbo.fnRPT_GetAdjustedDocMaturityDate(D.VoucherNo)":"dbo.fnRPT_GetAdjustedDocMaturityDate("+n+".VoucherNo)";if(180==t.FieldValue){let e=this.StaticReportType>0?"D":n;return"STUFF((SELECT distinct ', '+B.BillNo FROM (\nSELECT CB.DocNo DocNo FROM COM_Billwise CB WITH(NOLOCK) WHERE IsNewReference=0 AND CB.RefDocNo="+e+".VoucherNo\nUNION\nSELECT CB.RefDocNo DocNo FROM COM_Billwise CB WITH(NOLOCK) WHERE IsNewReference=0 AND CB.DocNo="+e+".VoucherNo\n)AS T inner join inv_docdetails B with(nolock) on B.VoucherNo=T.DocNo\nwhere B.BillNo is not null and B.BillNo!=''\nFOR XML PATH('')),1,2,'')"}if(11506==t.FieldValue)return" (SELECT ISNULL(SUM(abs(AdjAmount)),0) FROM COM_ChequeReturn CB WITH(NOLOCK) WHERE IsNewReference=0 AND ((CB.RefDocNo="+n+".VoucherNo and "+n+".DocSeqNo=CB.RefDocSeqNo)))";if(11507==t.FieldValue)return this.StaticReportType>0?"dbo.fnRPT_GetChequeRetunAdjustedDocNos(D.VoucherNo)":"dbo.fnRPT_GetChequeRetunAdjustedDocNos("+n+".VoucherNo)";if(11659==t.FieldValue)return this.StaticReportType>0?"dbo.fnRPT_GetChequeRetunAdjustedDocDate(D.VoucherNo)":"dbo.fnRPT_GetChequeRetunAdjustedDocDate("+n+".VoucherNo)";if(202==t.FieldValue)return this.StaticReportType>0?"dbo.fnRPT_GetAdjustedDocInfo(D.VoucherNo)":"dbo.fnRPT_GetAdjustedDocInfo("+n+".VoucherNo)";if(11371==t.FieldValue||11372==t.FieldValue)return this.IsOpeningStockExists=!0,"0.0";if(11373==t.FieldValue||11374==t.FieldValue)return this.IsClosingStockExists=!0,"0.0";if(11377==t.FieldValue||11378==t.FieldValue||11379==t.FieldValue||11380==t.FieldValue){let e=n+".docid";var C=this.BaseReportColumns.find(e=>95==e.CDGDO.CategoryValue||103==e.CDGDO.CategoryValue||104==e.CDGDO.CategoryValue||129==e.CDGDO.CategoryValue);C&&95==C.CDGDO.CategoryValue?(n=this.Entities.Contract,e=this.Entities.Contract+".ContractID"):C&&129==C.CDGDO.CategoryValue&&(n=this.Entities["Unit Reservation"],e=this.Entities["Unit Reservation"]+".QuotationID");let i=0;if(null!=t.Formula&&t.Formula.startsWith("LEVEL")&&(i=o.e.Int(t.Formula.substr(5)),this.IsNewFromClause&&(this.FromTagExtra.Contains("COM_ApprovalSummary")||(this.FromTagExtra+=" left join COM_ApprovalSummary WFT on WFT.DocID="+e,0!=s.DocID&&-1!=s.DocID&&-2!=s.DocID&&(this.FromTagExtra+=" and WFT.CCID="+Math.abs(s.DocID)),400==t.CategoryValue&&(this.FromTagExtra+=" and (WFT.InvDocDetailsID=0 OR WFT.InvDocDetailsID="+n+".InvDocDetailsID)")),11378!=t.FieldValue||this.FromTagExtra.Contains("WFTU"+i+" ")||(this.FromTagExtra+=" left join ADM_Users WFTU"+i+" with(nolock) on WFT.L"+i+"UserID=WFTU"+i+".UserID "))),11377==t.FieldValue)return null!=t.Formula&&t.Formula.startsWith("LEVEL")?this.IsNewFromClause?"convert(datetime,floor(WFT.L"+i+"CreatedDate))":"(select convert(DATETIME,CreatedDate) from COM_Approvals with(nolock) where ApprovalID IN (select top 1 ApprovalID from COM_Approvals with(nolock) \nwhere (StatusID=441 or StatusID=369"+(1==i?" or StatusID=371":"")+") and RowType=1 and ccid="+n+".costcenterid and ccnodeid="+e+(400==t.CategoryValue?" AND (DocDetID=0 OR DocDetID="+n+".InvDocDetailsID)":"")+" and WorkFlowLevel="+i+" order by ApprovalID desc))":"(select convert(datetime,CreatedDate) from COM_Approvals with(nolock) where ApprovalID IN (select top 1 ApprovalID\nfrom COM_Approvals with(nolock) where RowType=1 and ccid="+n+".costcenterid and ccnodeid="+e+(400==t.CategoryValue?" AND (DocDetID=0 OR DocDetID="+n+".InvDocDetailsID)":"")+" order by ApprovalID desc))";if(11378==t.FieldValue)return null!=t.Formula&&t.Formula.startsWith("LEVEL")?this.IsNewFromClause?"WFTU"+i+"."+t.Column:"(select U."+t.Column+" from COM_Approvals A with(nolock) \ninner join ADM_Users U with(nolock) on A.UserID=U.UserID \nwhere A.ApprovalID IN (select top 1 ApprovalID from COM_Approvals with(nolock) \nwhere (StatusID=441 or StatusID=369"+(1==i?" or StatusID=371":"")+") and RowType=1 and ccid="+n+".costcenterid and ccnodeid="+e+(400==t.CategoryValue?" AND (DocDetID=0 OR DocDetID="+n+".InvDocDetailsID)":"")+" and WorkFlowLevel="+i+" order by ApprovalID desc))":"(select CreatedBy from COM_Approvals with(nolock) where ApprovalID IN (select top 1 ApprovalID\nfrom COM_Approvals with(nolock) where RowType=1 and ccid="+n+".costcenterid and ccnodeid="+e+(400==t.CategoryValue?" AND (DocDetID=0 OR DocDetID="+n+".InvDocDetailsID)":"")+" order by ApprovalID desc))";if(11379==t.FieldValue)return null!=t.Formula&&t.Formula.startsWith("LEVEL")?this.IsNewFromClause?"WFT.L"+i+"Remarks":"(select Remarks from COM_Approvals with(nolock) where ApprovalID IN (select top 1 ApprovalID from COM_Approvals with(nolock) \nwhere (StatusID=441 or StatusID=369"+(1==i?" or StatusID=371":"")+") and RowType=1 and ccid="+n+".costcenterid and ccnodeid="+e+(400==t.CategoryValue?" AND (DocDetID=0 OR DocDetID="+n+".InvDocDetailsID)":"")+" and WorkFlowLevel="+i+" order by ApprovalID desc))":"(select Remarks from COM_Approvals with(nolock) where ApprovalID IN (select top 1 ApprovalID\nfrom COM_Approvals with(nolock) where RowType=1 and ccid="+n+".costcenterid and ccnodeid="+e+(400==t.CategoryValue?" AND (DocDetID=0 OR DocDetID="+n+".InvDocDetailsID)":"")+" order by ApprovalID desc))";if(11380==t.FieldValue)return null!=t.Formula&&t.Formula.startsWith("LEVEL")?this.IsNewFromClause?"WFT.L"+i+"Status":"(select S.Status from COM_Approvals A with(nolock) \ninner join COM_Status S with(nolock) on A.StatusID=S.StatusID \nwhere A.ApprovalID IN (select top 1 ApprovalID from COM_Approvals with(nolock) \nwhere (StatusID=441 or StatusID=369"+(1==i?" or StatusID=371":"")+") and RowType=1 and ccid="+n+".costcenterid and ccnodeid="+e+(400==t.CategoryValue?" AND (DocDetID=0 OR DocDetID="+n+".InvDocDetailsID)":"")+" and WorkFlowLevel="+i+" order by ApprovalID desc))":"(SELECT Status FROM COM_Status with(nolock) WHERE StatusID IN (select statusid from COM_Approvals with(nolock) where ApprovalID IN (select top 1 ApprovalID\nfrom COM_Approvals with(nolock) where RowType=1 and ccid="+n+".costcenterid and ccnodeid="+e+(400==t.CategoryValue?" AND (DocDetID=0 OR DocDetID="+n+".InvDocDetailsID)":"")+" order by ApprovalID desc)))"}else{if(11666==t.FieldValue)return"(select top 1 ReviseReason from "+(this.IsInventory?"INV_DocDetails":"ACC_DocDetails")+"_History with(nolock) where VoucherNo="+n+".VoucherNo and ReviseReason is not null)";if(11381==t.FieldValue)return"CASE WHEN (SELECT COUNT(*) FROM COM_CCSchedules WITH(NOLOCK) WHERE CostCenterID="+n+".CostCenterID AND NodeID="+n+".DocID)>0 THEN 'YES' ELSE 'NO' END";if(11692==t.FieldValue)return"(select Status from CRM_Activities ACT with(nolock) join COM_Status S on S.StatusID=ACT.StatusID and ActivityID=(select max(ActivityID) from CRM_Activities ACT with(nolock) where ACT.CostCenterID="+n+".CostCenterID and ACT.NodeID="+n+".DocID))";if(!(95!=t.CategoryValue&&103!=t.CategoryValue&&104!=t.CategoryValue&&129!=t.CategoryValue||"RentAmount"!=t.Column&&"DiscountAmount"!=t.Column&&"Discount"!=t.Column))return 103==t.CategoryValue||129==t.CategoryValue?"isnull((select "+t.Column+" from "+t.Table+" with(nolock) where QuotationID=T0.QuotationID and Sno=1),0)":"isnull((select "+t.Column+" from "+t.Table+" with(nolock) where CONTRACTID=T0.CONTRACTID and Sno=1),0)";if(101==t.CategoryValue){if(""==t.Column)return this.IsBudgetFound=!0,"0.0"}else if("RefNO"==t.Column){if(Math.abs(s.DocID)>4e4&&Math.abs(s.DocID)<5e4&&s.IsInventory)return"(SELECT TOP 1 VoucherNo FROM INV_DocDetails Ref WITH(NOLOCK) WHERE Ref.InvDocDetailsID=INV.LinkedInvDocDetailsID)"}else if(11375==t.FieldValue||11490==t.FieldValue||53517==t.FieldValue||11418==t.FieldValue||11419==t.FieldValue||11684==t.FieldValue||191==t.FieldValue||11751==t.FieldValue||12109==t.FieldValue||t.FieldValue>=11700&&t.FieldValue<=11750||t.FieldValue>=11951&&t.FieldValue<=11955)this.strHistorySepChar=11375==t.FieldValue||11490==t.FieldValue||11751==t.FieldValue||12109==t.FieldValue||53517==t.FieldValue||t.FieldValue>=11951&&t.FieldValue<=11955?"_":"",this.IsHistory=!0,this.iHistoryStatusID=t.FieldValue,11490==t.FieldValue&&(this.IsRevision=!0);else{if(11406==t.FieldValue)return"0.0";if(11408==t.FieldValue||t.FieldValue>=11485&&t.FieldValue<=11489)return"0.0";if("LATEST"==t.Formula){if(s.DocID>4e4&&s.DocID<5e4&&s.IsInventory&&0==t.IsForeignKey)return"DocDate"==t.Column?"(select TOP 1 CONVERT(DATETIME,A.DocDate) from inv_docdetails A with(nolock) where A.productid=INV.productID AND A.costcenterid="+t.CategoryValue+" order by A.DocDate desc,A.CreatedDate desc)":"(select TOP 1 "+t.Column+" from inv_docdetails A with(nolock) where A.productid=INV.productID AND A.costcenterid="+t.CategoryValue+" order by A.DocDate desc,A.CreatedDate desc)"}else if("OLDEST"==t.Formula){if(s.DocID>4e4&&s.DocID<5e4&&s.IsInventory&&0==t.IsForeignKey)return"DocDate"==t.Column?"(select TOP 1 CONVERT(DATETIME,A.DocDate) from inv_docdetails A with(nolock) where A.productid=INV.productID AND A.costcenterid="+t.CategoryValue+" order by A.DocDate asc,A.CreatedDate asc)":"(select TOP 1 "+t.Column+" from inv_docdetails A with(nolock) where A.productid=INV.productID AND A.costcenterid="+t.CategoryValue+" order by A.DocDate asc,A.CreatedDate asc)"}else{if("H"==t.Formula){if((u=this.Filter.Fields.find(e=>"DATE"==e.CDGDO.DataType))&&t.IsForeignKey){let e=t.CategoryText.split(".")[0];if(this.Entities.ContainsKey(e)){let s=t.ColumnCostCenterID;return 25472==t.FieldValue?s=1:25467==t.FieldValue&&(s=2),this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(e=>e.FeatureID==t.CategoryValue),"(select top 1 HDD."+t.Column+" from COM_HistoryDetails HD left join "+t.ParentCostCenterSysName+" HDD with(nolock) on HD.HistoryNodeID=HDD.NodeID\nwhere HD.costcenterid="+t.CategoryValue+" and HD.NodeID="+this.Entities[e]+"."+this.drrCCTbl[0].PK.toString()+" and HD.HistoryCCID="+s+"\nand FromDate<=convert(float,convert(datetime,'"+u.ToDatePicker.Date.ToString("dd MMM yyyy")+"')) order by FromDate desc)"}}return"#"}if(44==t.ColumnCostCenterID||44==t.LocalReference){let e;if(0==s.DocID?e="CRM_CONTACTS"==t.Table.toUpperCase()||t.Table.endsWith("Extended")?t.CategoryText+t.Table:t.CategoryText:(e=t.CategoryText+t.Table,this.Entities.ContainsKey(e)||(e=t.CategoryText)),this.Entities.ContainsKey(e)){t.ActualTable=this.Entities[e]+"."+t.Column;let s=this.Entities[e]+"."+t.Column;return"case when "+s+" is not null and isnumeric("+s+")=1 then (select TOP 1 Name from COM_Lookup L with(nolock) where L.NodeID="+s+") else '' end"}}else{if(t.FieldValue>=93&&t.FieldValue<=99||169==t.FieldValue||11649==t.FieldValue||11650==t.FieldValue||11651==t.FieldValue||11665==t.FieldValue){var u=this.Filter.Fields.find(e=>169==e.CDGDO.FieldValue);if(this.Entities.ContainsKey("Asset Management")){if(94==t.FieldValue)return"(select sum(convert(float,ChangeValue)) from ACC_AssetChanges DP with(nolock) where DP.ChangeType=0 and DP.AssetID="+this.Entities["Asset Management"]+".AssetID)";if(93==t.FieldValue)return"(select sum(convert(float,ChangeValue)) from ACC_AssetChanges DP with(nolock) where DP.ChangeType=5 and DP.AssetID="+this.Entities["Asset Management"]+".AssetID)";if(11649==t.FieldValue)return"stuff((select ','+convert(nvarchar, convert(datetime,Date),106) from ACC_AssetsHistory with(nolock) where AssetManagementID="+this.Entities["Asset Management"]+".AssetID order by HistoryID FOR XML PATH('')), 1,1,'')";if(11650==t.FieldValue)return"stuff((select ','+VoucherNo from ACC_AssetsHistory with(nolock) where AssetManagementID="+this.Entities["Asset Management"]+".AssetID order by HistoryID FOR XML PATH('')), 1,1,'')";if(11651==t.FieldValue)return"stuff((select ','+(case PolicyType when 1 then 'Dispose Full' when 2 then 'Sale Partial' when 3 then 'Sale Full' else 'Dispose Partial' end) from ACC_AssetsHistory with(nolock) where AssetManagementID="+this.Entities["Asset Management"]+".AssetID order by HistoryID FOR XML PATH('')), 1,1,'')";if(11665==t.FieldValue)return null!=u?"(select top 1 case PolicyType when 1 then 'Dispose Full' when 2 then 'Sale Partial' when 3 then 'Sale Full' else 'Dispose Partial' end from ACC_AssetsHistory with(nolock) where AssetManagementID="+this.Entities["Asset Management"]+".AssetID and [Date]<=convert(float,convert(datetime,'"+u.ToDatePicker.Date.ToString("dd MMM yyyy")+"')) order by Date desc)":"(select top 1 case PolicyType when 1 then 'Dispose Full' when 2 then 'Sale Partial' when 3 then 'Sale Full' else 'Dispose Partial' end from ACC_AssetsHistory with(nolock) where AssetManagementID="+this.Entities["Asset Management"]+".AssetID order by Date desc)";if(null!=u)if(99==t.FieldValue||98==t.FieldValue||97==t.FieldValue){let e="";if(o.e.IsEmpty(t.DimensionsFilter)){if(99==t.FieldValue)return"(select sum(DepAmount) from ACC_AssetDepSchedule DP with(nolock) where DP.AssetID="+this.Entities["Asset Management"]+".AssetID and DP.DeprEndDate<=convert(float,convert(datetime,'"+u.ToDatePicker.Date.ToString("dd MMM yyyy")+"')))";if(98==t.FieldValue)return"(select sum(DepAmount) from ACC_AssetDepSchedule DP with(nolock) where DP.AssetID="+this.Entities["Asset Management"]+".AssetID and DP.DeprEndDate<convert(float,convert(datetime,'"+u.FromDatePicker.Date.ToString("dd MMM yyyy")+"')))";if(97==t.FieldValue)return"(select sum(DepAmount) from ACC_AssetDepSchedule DP with(nolock) where DP.AssetID="+this.Entities["Asset Management"]+".AssetID  and DP.DeprEndDate>=convert(float,convert(datetime,'"+u.FromDatePicker.Date.ToString("dd MMM yyyy")+"'))  and DP.DeprEndDate<=convert(float,convert(datetime,'"+u.ToDatePicker.Date.ToString("dd MMM yyyy")+"')))"}else{let s;if(t.DimensionsFilter.split(",").forEach(t=>{s=this.GetDimensionFilter(parseInt(t)),s.length>0&&(e+=" AND DCC.dcCCNID"+(parseInt(t)-5e4)+" in ("+s+")")}),s=" join ACC_DocDetails D with(nolock) on D.DocID=DP.DocID join COM_DocCCDATA DCC with(nolock) on D.AccDocDetailsID=DCC.AccDocDetailsID",e=" and D.DebitAccount>0"+e,99==t.FieldValue)return"(select sum(D.Amount) from ACC_AssetDepSchedule DP with(nolock)"+s+" where DP.AssetID="+this.Entities["Asset Management"]+".AssetID"+e+" and DP.DeprEndDate<=convert(float,convert(datetime,'"+u.ToDatePicker.Date.ToString("dd MMM yyyy")+"')))";if(98==t.FieldValue)return"(select sum(D.Amount) from ACC_AssetDepSchedule DP with(nolock)"+s+" where DP.AssetID="+this.Entities["Asset Management"]+".AssetID"+e+" and DP.DeprEndDate<convert(float,convert(datetime,'"+u.FromDatePicker.Date.ToString("dd MMM yyyy")+"')))";if(97==t.FieldValue)return"(select sum(D.Amount) from ACC_AssetDepSchedule DP with(nolock)"+s+" where DP.AssetID="+this.Entities["Asset Management"]+".AssetID"+e+"  and DP.DeprEndDate>=convert(float,convert(datetime,'"+u.FromDatePicker.Date.ToString("dd MMM yyyy")+"'))  and DP.DeprEndDate<=convert(float,convert(datetime,'"+u.ToDatePicker.Date.ToString("dd MMM yyyy")+"')))"}}else{if(96==t.FieldValue)return"(select sum(convert(float,ChangeValue)) from ACC_AssetChanges DP with(nolock) where DP.ChangeType=0 and DP.AssetID="+this.Entities["Asset Management"]+".AssetID and DP.ChangeDate>=convert(float,convert(datetime,'"+u.FromDatePicker.Date.ToString("dd MMM yyyy")+"'))  and DP.ChangeDate<=convert(float,convert(datetime,'"+u.ToDatePicker.Date.ToString("dd MMM yyyy")+"')))";if(95==t.FieldValue)return"(select sum(convert(float,ChangeValue)) from ACC_AssetChanges DP with(nolock) where DP.ChangeType=5 and DP.AssetID="+this.Entities["Asset Management"]+".AssetID and DP.ChangeDate>=convert(float,convert(datetime,'"+u.FromDatePicker.Date.ToString("dd MMM yyyy")+"'))  and DP.ChangeDate<=convert(float,convert(datetime,'"+u.ToDatePicker.Date.ToString("dd MMM yyyy")+"')))"}}return"NULL"}if(61==t.ColumnCostCenterID&&"VehicleName"==t.Column){let e=t.CategoryText;return null!=t.ParentCDGDO&&(e+=t.Table),this.Entities.ContainsKey(e)?this.Entities[e]+".Make+'-'+"+this.Entities[e]+".Model+'-'+"+this.Entities[e]+".Variant":"NULL"}if(11396==t.FieldValue||11396==t.ParentCCDefaultColID||11689==t.FieldValue||11689==t.ParentCCDefaultColID){let e="";if(12==this.StaticReportType)e="Account";else if(this.Entities.ContainsKey(t.CategoryText))e=t.CategoryText;else for(let t=0;t<this.Objects.length;t++)if("acc_accounts"==o.e.LowerCase(this.Objects[t].Table)){e=this.Entities.keys[t];break}if(o.e.IsEmpty(e))return"0";{let s,i=!1,n="",a="";s=this.GetDimensionFilterForStock("DCC.dcCCNID"),s.length>0&&(a=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK)  ON DCC.AccDocDetailsID=ACC.AccDocDetailsID"),11689==t.FieldValue||11689==t.ParentCCDefaultColID?(i=!0,s+=" AND (ACC.StatusID=370 or ACC.StatusID=439)"):(0==this.UnPostedDocsList.length?n=" AND (ACC.StatusID=369 or ACC.StatusID=429)":n+=" AND ACC.StatusID IN (369,429,"+this.UnPostedDocsList+")",s+=this.PDCInclude?" AND (ACC.StatusID=370 OR (ACC.DocumentType<>14 AND ACC.DocumentType<>19"+n+"))":" AND ACC.DocumentType<>14 AND ACC.DocumentType<>19"+n);let l=this.Filter.Fields.find(e=>101==e.CDGDO.FieldValue||23145==e.CDGDO.FieldValue);if(l)if(s+=" AND CONVERT(DATETIME,ACC.DocDate)","Between"==l.Condition.SelectedValue||"NotBetween"==l.Condition.SelectedValue)s+=l.Condition.SelectedItem.Parent,s+="'"+l.FromDatePicker.Date.ToString("dd MMM yyyy")+"' AND ",s+="'"+l.ToDatePicker.Date.ToString("dd MMM yyyy")+"'";else if("FUTURE"==l.Condition.SelectedValue||"PAST"==l.Condition.SelectedValue){let e=o.e.Int(l.FromValue.TextBox.Text);0==e&&(e=1),s+=" BETWEEN ","FUTURE"==l.Condition.SelectedValue?(s+="'"+Date.Today().ToString("dd MMM yyyy")+"' AND ",s+="'"+Date.Today().AddDays(e).ToString("dd MMM yyyy")+"'"):(s+="'"+Date.Today().AddDays(-e).ToString("dd MMM yyyy")+"' AND ",s+="'"+Date.Today().ToString("dd MMM yyyy")+"'")}else s+=l.Condition.SelectedItem.Parent,s+="'"+l.FromDatePicker.Date.ToString("dd MMM yyyy")+"'";else null!=this.oReportDialog&&(this.oReportDialog.FromDate.Visible||this.oReportDialog.ToDate.Visible)&&(s+=" AND ACC.DocDate",this.oReportDialog.FromDate.Visible&&(s+=">=CONVERT(float,CONVERT(DATETIME,'"+this.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"'))"),this.oReportDialog.ToDate.Visible&&(s+="<=CONVERT(float,CONVERT(DATETIME,'"+this.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))"));let r="(ISNULL((select SUM(Amount) FROM ACC_DocDetails ACC with(nolock)"+a+" WHERE ACC.DebitAccount="+this.Entities[e]+".AccountID"+s+"),0)";return a.length>0&&!i&&(r+="+ISNULL((select SUM(Amount) FROM ACC_DocDetails ACC with(nolock) INNER JOIN COM_DocCCData DCC WITH(NOLOCK)  ON DCC.InvDocDetailsID=ACC.InvDocDetailsID WHERE ACC.DebitAccount="+this.Entities[e]+".AccountID"+s+"),0)"),r+="-( ISNULL((select SUM(Amount) FROM ACC_DocDetails ACC with(nolock)"+a+"\nWHERE ACC.CreditAccount="+this.Entities[e]+".AccountID"+s+"),0)",a.length>0&&!i&&(r+="+ISNULL((select SUM(Amount) FROM ACC_DocDetails ACC with(nolock) INNER JOIN COM_DocCCData DCC WITH(NOLOCK)  ON DCC.InvDocDetailsID=ACC.InvDocDetailsID\nWHERE ACC.CreditAccount="+this.Entities[e]+".AccountID"+s+"),0)"),r+=")",r+=")",r}}if(101==t.FieldValue)return"NULL";if(8==t.ParentCostCenterID)try{let e,s=t.CategoryValue;this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(e=>e.FeatureID==s),e=t.AssignedDimID>0&&this.Entities.ContainsKey("Documents_CCMAP")?this.Entities.Documents_CCMAP+".dcCCNID"+(t.CategoryValue-5e4):this.Entities[t.CategoryText.substr(0,t.CategoryText.lastIndexOf("."))]+"."+this.drrCCTbl[0].PK.toString();let i=t.AssignedDimID>0?t.AssignedDimID:t.ParentCCDefaultColID;return this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(e=>e.FeatureID==i),"dbo.fnRPT_AssignedData("+s+","+e+","+i+",'"+this.drrCCTbl[0].TableName.toString()+"')"}catch(c){return Logger.ErrorLog("Assigned: "+c.stack),"#"}else if(25144==t.FieldValue||25144==t.ParentCCDefaultColID)try{return"dbo. fnGet_GetAssignedListForActivity("+this.Entities[t.CategoryText]+".ActivityID,0)"}catch(h){return"#"}else if(24246==t.FieldValue||25534==t.FieldValue||27252==t.FieldValue||27292==t.FieldValue)try{return this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(e=>e.FeatureID==t.CategoryValue),"dbo.fnGet_GetAssignedListForFeatures("+t.CategoryValue+","+this.Entities[t.CategoryText]+"."+this.drrCCTbl[0].PK.toString()+")  "}catch(I){return"#"}else if(24246==t.ParentCCDefaultColID||25534==t.ParentCCDefaultColID||27252==t.ParentCCDefaultColID||27292==t.ParentCCDefaultColID)try{return this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(e=>e.FeatureID==t.ColumnCostCenterID),"dbo.fnGet_GetAssignedListForFeatures("+t.ColumnCostCenterID+","+this.Entities[t.CategoryText]+"."+this.drrCCTbl[0].PK.toString()+")  "}catch(d){return"#"}}}}}return""}IgnoreObject(e,t){return!(!this.IgnoreObjectsForFields.Contains(t.FieldValue)&&!this.IgnoreObjectsForFields.Contains(t.ParentCCDefaultColID))||8==t.ParentCostCenterID||null!=t.ChildCDGDO&&8==t.ChildCDGDO.ParentCostCenterID||0==t.CategoryValue&&0==t.FieldValue||!(205!=t.FieldValue&&206!=t.FieldValue&&207!=t.FieldValue||e.ShowAccountingData)||!(95!=t.CategoryValue&&103!=t.CategoryValue&&104!=t.CategoryValue&&129!=t.CategoryValue||"RentAmount"!=t.Column&&"DiscountAmount"!=t.Column&&"Discount"!=t.Column)}ParseFormula(t,s){let i;if(t.FormulaErrorMessage="",188==t.CDGDO.FieldValue)return void(t.FormulaExpression="");let n=new C.a;n.SetKeyWords("REPORT");let a=[];if(s){if(i=t.Formula.Text,e.IgnoreFormulas.Contains(i))return void(t.FormulaExpression="")}else i=t.Expression.Text;n.ParseFormula(i,a);let l,r="",D=!1,c=null;for(let e=a.length-1;e>=0;e--){let t=a[e];l=t.getTokenValue().toString(),t.getTokenClass()!=C.d.OPERAND||null==c||c.getTokenClass()!=C.d.OPERAND?c=t:(c.SetAll("USERDEF",c.getTokenID(),C.d.OPERAND,C.e.REFERENCE,t.tokenValue.toString()+c.tokenValue.toString()),a.RemoveAt(e))}for(let e=0;e<a.length;e++){D=!1;let i=a[e];if(l=i.getTokenValue().toString(),i.getTokenClass()==C.d.OPERAND&&i.getTokenType()==C.e.REFERENCE){for(let e=0;e<this.BaseReportColumns.length;e++){let i=this.BaseReportColumns[e];if((!s||i!=t)&&0==o.e.stringCompare(i.Caption.Text.Replace(" ",""),l,!0)){D=!0,l=i.ID;break}}if(!D){for(let e=0;e<this.ReportGroups.length;e++){let s=this.ReportGroups[e];if(!o.e.IsEmpty(s.Prefix.Text)&&(s!=t||t.ID.length<33)&&0==o.e.stringCompare(s.Prefix.Text.Replace(" ",""),l,!0)){D=!0,l=s.ID;break}}if(!D&&(this.FieldsDialog.RefreshFieldsData_2(this.FieldsViewTbl,t.CDGDO.CategoryValue),this.FieldsView=this.FieldsViewTbl.filter(e=>e.CostCenterID==t.CDGDO.CategoryValue&&e.FormulaColumn==l),this.FieldsView.length>0)){let e,t=new u.a;for(this.FieldsDialog.SetCDGDO_3(t,this.FieldsView[0],o.e.String(this.FieldsView[0].ParentCCDefaultColID)),e=0;e<this.FormulaObjects.length&&(this.FormulaObjects[e].CategoryValue!=t.CategoryValue||this.FormulaObjects[e].FieldValue!=t.FieldValue);e++);e==this.FormulaObjects.length&&this.FormulaObjects.push(t),l="F"+e}}}"STRING"==i.getTokenName()?r+='"'+l+'"':(i.getTokenType()==C.e.KEYWORD&&(r+=" "),r+=l,i.getTokenType()==C.e.KEYWORD&&(r+=" "))}if(s){if(t.FormulaExpression=r,t.FormulaExpression.startsWith("LEVEL")&&(t.CDGDO.FieldValue>=11377&&t.CDGDO.FieldValue<=11380||182==t.CDGDO.FieldValue))return void(t.FormulaExpression="");this.IsAuthLevelReport||(t.FormulaExpression.startsWith("LEVEL")?o.e.IsNum(t.FormulaExpression.substr(5))&&(this.IsAuthLevelReport=!0):this.CheckFormula(r,t.Formula.Text,t))}else t.ColumnFilterExpression=r,this.CheckFormula(r,t.Expression.Text,t)}CheckFormula(e,t,s){}static IsGroupTree(e){return(2==e.CostCenterID||3==e.CostCenterID||e.CostCenterID>5e4)&&(e.SelectedNodes.filter(e=>e.IsGroup).length>0||!(""==i.a.SessionManager.Preferences.DynamicTrees||!i.a.SessionManager.Preferences.DynamicTrees.split(",").Contains(e.CostCenterID.toString())))}GetTextField_AllDocuments(e,t){return i.a.report.DataSet("RPT035",Math.abs(e).toString(),t)}GetLatestOldestQuery(e,t,s){if(0==o.e.stringCompare(e.Formula,"LATEST",!0)){if(0==e.IsForeignKey)return 0==o.e.stringCompare(e.DataType,"DATE",!0)?"(select TOP 1 CONVERT(DATETIME,A."+e.Column+" ) from inv_docdetails A with(nolock) @CCWHERE@ where A.productid="+t+".productID AND A.costcenterid="+e.CategoryValue+" order by A.DocDate desc,A.CreatedDate desc)":e.Column.startsWith("dcCalcNum")||e.Column.startsWith("dcNum")?"(select TOP 1 N."+e.Column+" from inv_docdetails A with(nolock) inner join COM_DocNumData N with(nolock) on N.invdocdetailsid=A.invdocdetailsid @CCWHERE@ where A.productid="+t+".productID AND A.costcenterid="+e.CategoryValue+" order by A.DocDate desc,A.CreatedDate desc)":"(select TOP 1 A."+e.Column+" from inv_docdetails A with(nolock) @CCWHERE@ where A.productid="+t+".productID AND A.costcenterid="+e.CategoryValue+" order by A.DocDate desc,A.CreatedDate desc)";if(2==e.ParentCostCenterID)return"(select top 1 "+e.Column+" from ACC_Accounts with(nolock) where AccountID=(select TOP 1 A."+e.ParentColumn+" from inv_docdetails A with(nolock) @CCWHERE@\nwhere A.productid="+t+".productID AND A.costcenterid="+e.CategoryValue+" order by A.DocDate desc,A.CreatedDate desc))"}else if(0==o.e.stringCompare(e.Formula,"OLDEST",!0)){if(0==e.IsForeignKey)return 0==o.e.stringCompare(e.DataType,"DATE",!0)?"(select TOP 1 CONVERT(DATETIME,A."+e.Column+" ) from inv_docdetails A with(nolock) @CCWHERE@ where A.productid="+t+".productID AND A.costcenterid="+e.CategoryValue+" order by A.DocDate asc,A.CreatedDate asc)":e.Column.startsWith("dcCalcNum")||e.Column.startsWith("dcNum")?"(select TOP 1 N."+e.Column+" from inv_docdetails A with(nolock) inner join COM_DocNumData N with(nolock) on N.invdocdetailsid=A.invdocdetailsid @CCWHERE@ where A.productid="+t+".productID AND A.costcenterid="+e.CategoryValue+" order by A.DocDate asc,A.CreatedDate asc)":"(select TOP 1 A."+e.Column+" from inv_docdetails A with(nolock) @CCWHERE@ where A.productid="+t+".productID AND A.costcenterid="+e.CategoryValue+" order by A.DocDate asc,A.CreatedDate asc)";if(2==e.ParentCostCenterID)return"(select top 1 "+e.Column+" from ACC_Accounts with(nolock) where AccountID=(select TOP 1 A."+e.ParentColumn+" from inv_docdetails A with(nolock) @CCWHERE@\nwhere A.productid="+t+".productID AND A.costcenterid="+e.CategoryValue+" order by A.DocDate asc,A.CreatedDate asc))"}return"NULL"}GetDimensionFilterForStock(e){let t="",s=0;null!=this.oReportDialog&&(s=this.oReportDialog.StockDimensionID);let i="";return null!=this.oReportDialog&&this.oReportDialog.Locations.Visible&&null!=this.oReportDialog.LocationWhere&&(i=o.e.IsEmpty(this.oReportDialog.LocationWhere)?"-1":this.oReportDialog.LocationWhere,t+=" AND "+e+(this.oReportDialog.StockDimensionID-5e4)+" IN ("+i+") "),(null!=this.oReportDialog?this.oReportDialog.CostCenterFilters:this.Filter.CostCenterFilters).forEach(i=>{if(i.SelectedNodes.length>0||!i.DeleteButtonVisibility)if(i.CostCenterID>5e4&&i.SelectedNodes.length>0&&i.CostCenterID!=s)if(t+=" AND ",1==i.SelectedNodes.length)t+=e+(i.CostCenterID-5e4)+"="+i.SelectedNodes[0].Id;else{t+=e+(i.CostCenterID-5e4)+" IN (";for(let e=0;e<i.SelectedNodes.length;e++)e>0&&(t+=","),t+=i.SelectedNodes[e].Id;t+=")"}else i.DeleteButtonVisibility||(t+=" AND ",t+=e+(i.CostCenterID-5e4)+"=-12912")}),t}GetDimensionFilter(e){let t="";var s=(null!=this.oReportDialog?this.oReportDialog.CostCenterFilters:this.Filter.CostCenterFilters).find(t=>t.CostCenterID==e);if(!s)return"";if(s.SelectedNodes.length>0||!s.DeleteButtonVisibility)if(s.CostCenterID>5e4&&s.SelectedNodes.length>0)if(1==s.SelectedNodes.length)t+=s.SelectedNodes[0].Id;else for(let i=0;i<s.SelectedNodes.length;i++)i>0&&(t+=","),t+=s.SelectedNodes[i].Id;else s.DeleteButtonVisibility||(t+="-12912");return t}GetLink_IDColumn(e,t){if("3"==t.LinkType.SelectedValue||"4"==t.LinkType.SelectedValue){let s=t.CDGDO.IsForeignKey?t.CDGDO.ParentCostCenterID:t.CDGDO.CategoryValue;if(400!=s&&(s<4e4||s>5e4)&&"NULL"!=t.CDGDO.ActualColumn)return this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(e=>e.FeatureID==s),","+e+"."+this.drrCCTbl[0].PK.toString()+" AS ["+t.ID+"_ID]"}return""}SetExtFunctionParams(e,t){if("EF_FROMDATE"==e)if("ReportViewModel"==this.ClassName){let e=this;e.SetDatePickers(),t+="'"+e.FromDatePicker.Date.ToString("dd MMM yyyy")+"'"}else 112!=this.StaticReportType&&165!=this.StaticReportType||(t+="'EF_FROMDATE'");else if("EF_TODATE"==e)if("ReportViewModel"==this.ClassName){let e=this;e.SetDatePickers(),t+="'"+e.ToDatePicker.Date.ToString("dd MMM yyyy")+"'"}else 112!=this.StaticReportType&&165!=this.StaticReportType||(t+="'EF_TODATE'");else"EF_ASONDATE"==e?112!=this.StaticReportType&&165!=this.StaticReportType||(t+="'EF_ASONDATE'"):"EF_LoginLocationID"==e&&"ReportViewModel"==this.ClassName?t+=i.a.SessionManager.LocationID:"EF_LoginDivisionID"==e&&"ReportViewModel"==this.ClassName?t+=i.a.SessionManager.DivisionID:"EF_USERID"==e?t+=i.a.SessionManager.UserID:"EF_USERNAME"==e&&(t+="'"+i.a.SessionManager.UserName+"'");return t}GetAddressColumn(e){if(e.startsWith("CCNID")){let t=o.e.GetTagTableName(5e4+parseInt(e.substring(5)));e="(select Name from "+t+" with(nolock) where NodeID=A."+e+")"}return e}}return e.dtExDocs=new n.c,e.ForeignMAPTables=["COM_ADDRESS","CRM_ACTIVITIES","CRM_FEEDBACK","COM_NOTES","CRM_LEADCVRDETAILS","COM_CONTACTS"],e.HistoryTables=new n.c,e.IgnoreFormulas=["FOR_PERIOD","AFTER_PERIOD"],e})()},USNh:function(e,t,s){"use strict";s.d(t,"b",(function(){return D})),s.d(t,"a",(function(){return C})),s.d(t,"c",(function(){return u})),s.d(t,"d",(function(){return c}));var i=s("Do2H"),o=s("Lp6j"),n=s("EQd/"),a=s("0/4Q"),l=s("ScVY"),r=s("NkMH");let D=(()=>{class e{constructor(t,s){this.FormulaExpression="",this.ColumnFilterExpression="",this.FormulaErrorMessage="",this.ColumnFiltersXML="",this.SubTotalXML="",this.ColumnFiltersUsed=[],this.ID=null,this.SubTotalRoundOffs=null,this.IsGroup=!1,this.IsReportMappingFilter=!1,this.IgnoreCheckedEvent=!1,this.Screen=null,this.DimensionsFilterVisible=!1,this.ALLOtherDocsVisible=!1,this.LINKINGExpanderVisibility=!1,this.RepeatExpanderVisibility=!0,this.RepeatPrevDataFull=!1,this.RepeatPrevDiff=!1,this.RepeatPrevPercent=!1,this.RepeatPrevDataOfCurrYr=!1,this.RepeatPrevDataSeperately=!1,this.Screen=t,this.IsGroup=s,this.CDGDO=new C,this.Caption=new n.d(0),this.Caption.Label=i.a.GetResource("Reports_Caption"),this.ArabicCaption=new n.d(0),this.ArabicCaption.Label=i.a.GetResource("Reports_ArabicCaption"),this.Type=new n.d(0),this.Type.Label=i.a.GetResource("AccountCreate_Type"),this.Type.Visible=!1,this.CType=new a.e(0),this.CType.Visible=!0,this.CType.Items=e.CTypeList,this.CType.SelectedValue="FLOAT",this.Formula=new n.d(0),this.Formula.Label=i.a.GetResource("DocumentDesigner_Formula"),this.FormulaEvaluateAtEnd=new a.e(0),this.FormulaEvaluateAtEnd.Label=i.a.GetResource("Reports_EvaluateAtEnd"),this.FormulaEvaluateAtEnd.Items=e.items_Evaluate,this.FormulaEvaluateAtEnd.SelectedValue="1",this.Prefix=new n.d(0),this.Prefix.Label=i.a.GetResource("Reports_Prefix"),this.Prefix.TextChangedCommand.Subscribe(this,"OnPrefixChanged"),this.DisplayMode=new a.e(0),this.DisplayMode.Label=i.a.GetResource("DisplayMode"),this.DisplayMode.Items.push(a.d.ComboBoxItems_2("Detailed","Detailed")),this.DisplayMode.Items.push(a.d.ComboBoxItems_2("Summary","Summary")),this.DisplayMode.SelectedValue="Detailed",this.DisplayMode.SelectedItem=this.DisplayMode.Items[0],this.ShowAsColumn=new a.e(0),this.ShowAsColumn.Label=i.a.GetResource("Reports_ShowAsColumn"),this.ShowAsColumn.Items=e.cmbTrueFalse,this.ShowAsColumn.SelectedValue="0",this.ShowAsColumn.SelectedItem=this.ShowAsColumn.Items[1],this.ShowCaption=new a.e(0),this.ShowCaption.Label="Show Caption",this.ShowCaption.SelectedValue="1",this.ShowLevel=new a.e(0),this.ShowLevel.Label=i.a.GetResource("Reports_ShowLevel"),this.ShowLevel.Items=e.items_ShowLevel,this.ShowLevel.SelectedValue="0",this.ShowLevel.SelectionChangedCommand.Subscribe(this,"OnSelectionChanged"),this.ShowAssigned=new a.e(0),this.ShowAssigned.Label=i.a.GetResource("Assigned"),null!=t&&null!=t.FieldsDialog&&(t.FieldsDialog.ReportFilterCostCenterList.filter(e=>e.FeatureID>5e4).sort((e,t)=>e.Name>t.Name).forEach(e=>{this.ShowAssigned.Items.push(a.d.ComboBoxItems_2(e.Name.toString(),e.FeatureID.toString()))}),this.ShowAssigned.Items.length>0&&(this.ShowAssigned.SelectedValue=this.ShowAssigned.Items[0].Value)),this.ExecutedDocument=new a.b(0),this.ExecutedDocument.Label="Executed Document",this.ExecutedDocument.Visible=!1,null!=t&&(this.ExecutedDocument.Items=t.ListOfInvDocuments,this.ExecutedDocument.CheckedChangedCommand.Subscribe(this,"OnListBoxCheckedChanged")),this.AccountingDocument=new a.b(0),this.AccountingDocument.Label="Accounting Documents",this.AccountingDocument.Visible=!1,null!=t&&(this.AccountingDocument.Items=t.ListOfAccEffectDocuments,this.AccountingDocument.CheckedChangedCommand.Subscribe(this,"OnListBoxCheckedChanged")),this.Alignment_Header=new a.e(0),this.Alignment_Header.Label=i.a.GetResource("Reports_Alignment"),this.Alignment_Header.Items=e.items_Alignment,this.Alignment_Header.SelectedValue="Center",this.Alignment_Header.SelectionChangedCommand.Subscribe(this,"OnSelectionChanged"),this.BackgroundClr_Header=new n.d(0),this.BackgroundClr_Header.Label=i.a.GetResource("Reports_BackgroundClr"),this.BackgroundClr_Header.Text="#FFFFFFFF",this.ForegroundClr_Header=new n.d(0),this.ForegroundClr_Header.Label=i.a.GetResource("Reports_ForegroundClr"),this.ForegroundClr_Header.Text="#FF000000",this.Font_Header=new a.e(0),this.Font_Header.Label=i.a.GetResource("Reports_Font"),this.Font_Header.Items=e.FontItems,this.Font_Header.SelectedValue="Calibri",this.FontSize_Header=new n.d(0),this.FontSize_Header.Label=i.a.GetResource("Reports_FontSize"),this.FontSize_Header.DataType="INT",this.FontSize_Header.Text="12",this.FontStyle_Header=new r.a,this.FontStyle_Header.Label=i.a.GetResource("Reports_FontStyle"),this.Bold_Header=new r.a,this.Italic_Header=new r.a,this.Underline_Header=new r.a,this.Width=new n.d(0),this.Width.Label=i.a.GetResource("ListView_Width"),this.Width.DataType="INT",this.Width.Text="120",this.Height=new n.d(0),this.Height.Label=i.a.GetResource("Reports_Height"),this.Height.DataType="INT",this.Height.Text="22",this.Alignment=new a.e(0),this.Alignment.Label=i.a.GetResource("Reports_Alignment"),this.Alignment.Items=e.items_Alignment,this.Alignment.SelectedValue="Left",this.BackgroundClr=new n.d(0),this.BackgroundClr.Label=i.a.GetResource("Reports_BackgroundClr"),this.BackgroundClr.Text="#FFFFFFFF",this.ForegroundClr=new n.d(0),this.ForegroundClr.Label=i.a.GetResource("Reports_ForegroundClr"),this.ForegroundClr.Text="#FF000000",this.Font=new a.e(0),this.Font.Label=i.a.GetResource("Reports_Font"),this.Font.Items=e.FontItems,this.Font.SelectedValue="Calibri",this.FontSize=new n.d(0),this.FontSize.Label=i.a.GetResource("Reports_FontSize"),this.FontSize.DataType="INT",this.FontSize.Text="13",this.FontStyle=new r.a,this.FontStyle.Label=i.a.GetResource("Reports_FontStyle"),this.Visibility=new a.e(0),this.Visibility.Label=i.a.GetResource("Reports_Visibility"),this.Visibility.Items=e.cmbTrueFalse,this.Visibility.SelectedValue="1",this.PrintVisibility=new a.e(0),this.PrintVisibility.Label="Print Visibility",this.PrintVisibility.Items=e.cmbTrueFalse,this.PrintVisibility.SelectedValue="1",this.Row=new n.d(0),this.Row.Label=i.a.GetResource("Reports_Row"),this.Row.DataType="INT",this.Row.Text="0",this.Column=new n.d(0),this.Column.Label=i.a.GetResource("Reports_Column"),this.Column.DataType="INT",this.Column.Text="0",this.Bold=new r.a,this.Italic=new r.a,this.Underline=new r.a,this.ShowUnder=new a.e(0),this.ShowUnder.Label=i.a.GetResource("Reports_ShowUnder"),null!=t&&(this.ShowUnder.Items=t.ShowUnder),this.STShowCollapsable=new a.e(0),this.STShowCollapsable.Label="Show @ Collapase",this.STShowCollapsable.Items=e.cmbTrueFalse,this.STShowCollapsable.SelectedValue="0",this.STShowCollapsable.Visible=!1,this.Border=new a.e(0),this.Border.Label=i.a.GetResource("Reports_Border"),this.Border.Visible=!1,this.Decimals=new a.e(0),this.Decimals.Label=i.a.GetResource("Reports_Decimals"),this.Decimals.Items=e.items_Decimals,this.Decimals.SelectedValue="-1",this.RoundOff=new n.d(0),this.RoundOff.Label=i.a.GetResource("Reports_Data"),this.RoundOff.DataType="FLOAT",this.RoundOff.Text="0.0",this.RoundOff_RT=new n.d(0),this.RoundOff_RT.Label=i.a.GetResource("Reports_ReportTotal2"),this.RoundOff_RT.DataType="FLOAT",this.RoundOff_RT.Text="0.0",this.RoundOff_ST=[],this.Commas=new a.e(0),this.Commas.Label=i.a.GetResource("Reports_Commas"),this.Commas.Items=e.items_Commas,this.Commas.SelectedValue="-1",this.Currency=new a.e(0),this.Currency.Label=i.a.GetResource("Reports_Currency"),this.Currency.Items=e.cmbTrueFalse,this.Currency.SelectedValue="0",this.NegativeNumber=new a.e(0),this.NegativeNumber.Label=i.a.GetResource("Reports_NegativeNumber"),this.NumberFormat=new n.d(0),this.NumberFormat.Text="",this.ShowAvg=new a.e(0),this.ShowAvg.Label="Show Average",this.ShowAvg.Items=e.cmbTrueFalse,this.ShowAvg.SelectedValue="0",this.ShowDefaultSign=new a.e(0),this.ShowDefaultSign.Label=i.a.GetResource("Reports_ShowDefaultSign"),this.ShowDefaultSign.Items=e.cmbTrueFalse,this.ShowDefaultSign.SelectedValue="0",this.PercentageOn=new a.e(0),this.PercentageOn.Label=i.a.GetResource("Reports_ShowPercentage"),null!=t&&(this.PercentageOn.Items=t.PercentageOnFields),this.PercentageOn.SelectedValue="",this.CumulativeTotals=new a.e(0),this.CumulativeTotals.Label="Cumulative Totals",this.CumulativeTotals.Items=e.items_CumulativeTotals,this.CumulativeTotals.SelectedValue="",this.PrevRowValue=new a.e(0),this.PrevRowValue.Label="Prev Row Value",null!=t&&(this.PrevRowValue.Items=t.PercentageOnFields),this.PrevRowValue.SelectedValue="",this.Expression=new n.d(0),this.Expression.Label=i.a.GetResource("Reports_Expression"),this.Sort=new a.e(0),this.Sort.Label=i.a.GetResource("Reports_Sort"),this.Sort.Items=e.items_Sort,this.Sort.SelectedValue="",this.Sort.Visible=!0,this.WrapText=new a.e(0),this.WrapText.Label=i.a.GetResource("Reports_WrapText"),this.WrapText.Items=e.cmbTrueFalse,this.WrapText.SelectedValue="0",this.WrapTextPrint=new a.e(0),this.WrapTextPrint.Label="Wrap Text(Print)",this.WrapTextPrint.Items=e.cmbTrueFalse,this.WrapTextPrint.SelectedValue="1",this.PrintChars=new n.d(0),this.PrintChars.Label="Print Chars",this.PrintChars.Text="0",this.PrintOnce=new a.e(0),this.PrintOnce.Label=i.a.GetResource("Reports_PrintOnce"),this.PrintOnce.Items=e.cmbTrueFalse,this.PrintOnce.SelectedValue="0",this.SuppressZero=new a.e(0),this.SuppressZero.Label="Suppress Zero",this.SuppressZero.Items=e.cmbTrueFalse,this.SuppressZero.SelectedValue="0",this.PinnedColumn=new a.e(0),this.PinnedColumn.Label=i.a.GetResource("Pinned Column"),this.PinnedColumn.Items=e.cmbTrueFalse,this.PinnedColumn.SelectedValue="0",this.DateType=new a.e(0),this.DateType.Label=i.a.GetResource("Reports_DateType"),this.DateType.Items=e.items_DateType,this.DateType.Text=i.a.SessionManager.Preferences["Date Format"],this.LinkType=new a.e(0),this.LinkType.Label=i.a.GetResource("Reports_LinkType"),this.LinkType.Items=e.items_LinkType,this.LinkType.SelectedValue="0",this.LinkType.SelectionChangedCommand.Subscribe(this,"OnSelectionChanged"),this.LinkDimension=new a.e(0),this.LinkDimension.Label="Show",this.LinkDimension.Items=e.items_LinkDocument,this.LinkDimension.SelectedValue="0",this.LinkDimension.Visible=!1,this.LinkDimensionView=new a.e(0),this.LinkDimensionView.Label="",this.LinkDimensionView.Items=e.items_LinkDimensionView,this.LinkDimensionView.SelectedValue="0",this.LinkDimensionView.Visible=!1,this.LinkReport=new a.e(0),this.LinkReport.Label="Link Report",this.LinkReport.Items=null!=t?t.MappedReportsList:null,this.LinkReport.SelectedValue="0",this.LinkReport.Visible=!1,this.RepeatType=new a.e(0),this.RepeatType.Label=i.a.GetResource("Reports_RepeatType"),this.RepeatType.SelectedValue="0",this.RepeatType.Items.push(a.d.ComboBoxItems_2("None","0")),null!=t&&111==t.StaticReportType?this.RepeatType.Items.push(a.d.ComboBoxItems_2("Repeat","1")):this.RepeatType.Items=e.items_RepeatType,this.RepeatNext=new n.d(0),this.RepeatNext.Label=i.a.GetResource("Reports_RepeatNext"),this.RepeatNext.Text="0",this.RepeatOn=new a.e(0),this.RepeatOn.Label=i.a.GetResource("Reports_RepeatOn"),null!=t&&(this.RepeatOn.Items=t.ReportNonNumericFields),this.RepeatEmptyColumns=new a.e(0),this.RepeatEmptyColumns.Label="Empty Columns",this.RepeatEmptyColumns.Items=e.items_RepeatEmptyCol,this.RepeatEmptyColumns.SelectedValue="0",this.UseOnce=new a.e(0),this.UseOnce.Label=i.a.GetResource("Reports_UseOnce"),this.UseOnce.Items=e.items_UseOnce,this.UseOnce.SelectedValue="0",this.RepeatPrevData=new a.e(0),this.RepeatPrevData.SelectedValue="0",this.RepeatPrevData.Items=e.items_RepeatPrevData,s&&(this.ShowAsColumn.SelectionChangedCommand.Subscribe(this,"OnShowAsColumnChange"),this.ShowCaption.Visible=!1,this.Width.Text="-1"),this.SetDataType(),this.Bold.Enable=!1,this.Bold_Header.Enable=!0,this.Italic.Enable=!1,this.Italic_Header.Enable=!1,this.Underline.Enable=!1,this.Underline_Header.Enable=!1}get ColumnFiltersColor(){return o.e.IsEmpty(this.ColumnFiltersXML)?null:"#FF00A9DA"}static ColumnProperties(){e.cmbTrueFalse.push(a.d.ComboBoxItems_2("True","1")),e.cmbTrueFalse.push(a.d.ComboBoxItems_2("False","0")),e.items_Evaluate.push(a.d.ComboBoxItems_2("True","1")),e.items_Evaluate.push(a.d.ComboBoxItems_2("False","0")),e.items_Evaluate.push(a.d.ComboBoxItems_2("Repeat/Matrix/Tree Group","2")),e.items_Evaluate.push(a.d.ComboBoxItems_2("Tree Node","3")),e.items_ShowLevel.push(a.d.ComboBoxItems_2("False","0")),e.items_ShowLevel.push(a.d.ComboBoxItems_2("True","1")),e.items_ShowLevel.push(a.d.ComboBoxItems_2("True (Totals At End)","2")),e.FontItems.push(a.d.ComboBoxItems_2("Arial","Arial")),e.FontItems.push(a.d.ComboBoxItems_2("Calibri","Calibri")),e.FontItems.push(a.d.ComboBoxItems_2("Times New Roman","Times New Roman")),e.FontItems.push(a.d.ComboBoxItems_2("Algerian","Algerian")),e.FontItems.push(a.d.ComboBoxItems_2("Verdana","Verdana")),e.FontItems.push(a.d.ComboBoxItems_2("Elephant","Elephant")),e.FontItems.push(a.d.ComboBoxItems_2("Bernard MT","Bernard MT")),e.FontItems.push(a.d.ComboBoxItems_2("Century Gothic","Century Gothic")),e.FontItems.push(a.d.ComboBoxItems_2("Code Pro Lc","Code Pro Lc")),e.CTypeList.push(a.d.ComboBoxItems_2("FLOAT","FLOAT")),e.CTypeList.push(a.d.ComboBoxItems_2("DATE","DATE")),e.CTypeList.push(a.d.ComboBoxItems_2("TIME","TIME")),e.CTypeList.push(a.d.ComboBoxItems_2("STRING","STRING")),e.items_Alignment.push(a.d.ComboBoxItems_2("Left","Left")),e.items_Alignment.push(a.d.ComboBoxItems_2("Center","Center")),e.items_Alignment.push(a.d.ComboBoxItems_2("Right","Right")),e.items_Decimals.push(a.d.ComboBoxItems_2("0","0")),e.items_Decimals.push(a.d.ComboBoxItems_2("GP","-1")),e.items_Decimals.push(a.d.ComboBoxItems_2("1","1")),e.items_Decimals.push(a.d.ComboBoxItems_2("2","2")),e.items_Decimals.push(a.d.ComboBoxItems_2("3","3")),e.items_Decimals.push(a.d.ComboBoxItems_2("4","4")),e.items_Decimals.push(a.d.ComboBoxItems_2("5","5")),e.items_Decimals.push(a.d.ComboBoxItems_2("6","6")),e.items_Decimals.push(a.d.ComboBoxItems_2("7","7")),e.items_Decimals.push(a.d.ComboBoxItems_2("8","8")),e.items_Decimals.push(a.d.ComboBoxItems_2("9","9")),e.items_Commas.push(a.d.ComboBoxItems_2("None","0")),e.items_Commas.push(a.d.ComboBoxItems_2("GP","-1")),e.items_Commas.push(a.d.ComboBoxItems_2("Millions","1")),e.items_Commas.push(a.d.ComboBoxItems_2("Lakhs","2")),e.items_CumulativeTotals.push(a.d.ComboBoxItems_2("False","")),e.items_CumulativeTotals.push(a.d.ComboBoxItems_2("True","0")),e.items_CumulativeTotals.push(a.d.ComboBoxItems_2("Till Group 1","1")),e.items_CumulativeTotals.push(a.d.ComboBoxItems_2("Till Group 2","2")),e.items_CumulativeTotals.push(a.d.ComboBoxItems_2("Till Group 3","3")),e.items_CumulativeTotals.push(a.d.ComboBoxItems_2("Till Group 4","4")),e.items_CumulativeTotals.push(a.d.ComboBoxItems_2("Till Group 5","5")),e.items_CumulativeTotals.push(a.d.ComboBoxItems_2("For Repeat Columns","-2")),e.items_Sort.push(a.d.ComboBoxItems_2("None","")),e.items_Sort.push(a.d.ComboBoxItems_2("Ascending","ASC")),e.items_Sort.push(a.d.ComboBoxItems_2("Descending","DESC")),e.items_Sort.push(a.d.ComboBoxItems_2("Ascending (Numeric)","NUM ASC")),e.items_Sort.push(a.d.ComboBoxItems_2("Descending (Numeric)","NUM DESC")),e.items_Sort.push(a.d.ComboBoxItems_2("Tree Order","TREE ASC")),e.items_DateType.push(a.d.ComboBoxItems_2("None","None")),e.items_DateType.push(a.d.ComboBoxItems_2("dd/MM/yyyy","dd/MM/yyyy")),e.items_DateType.push(a.d.ComboBoxItems_2("MM/dd/yyyy","MM/dd/yyyy")),e.items_DateType.push(a.d.ComboBoxItems_2("dd/MMM/yyyy","dd/MMM/yyyy")),e.items_DateType.push(a.d.ComboBoxItems_2("MMM/dd/yyyy","MMM/dd/yyyy")),e.items_DateType.push(a.d.ComboBoxItems_2("dd-MM-yyyy","dd-MM-yyyy")),e.items_DateType.push(a.d.ComboBoxItems_2("dd-MM-yy","dd-MM-yy")),e.items_DateType.push(a.d.ComboBoxItems_2("dd-MMM-yyyy","dd-MMM-yyyy")),e.items_DateType.push(a.d.ComboBoxItems_2("MMM-yy","MMM-yy")),e.items_DateType.push(a.d.ComboBoxItems_2("MMM-yyyy","MMM-yyyy")),e.items_DateType.push(a.d.ComboBoxItems_2("MMM/yy","MMM/yy")),e.items_DateType.push(a.d.ComboBoxItems_2("MMM/yyyy","MMM/yyyy")),e.items_DateType.push(a.d.ComboBoxItems_2("MMM","MMM")),e.items_DateType.push(a.d.ComboBoxItems_2("MMMM","MMMM")),e.items_DateType.push(a.d.ComboBoxItems_2("yyyy","yyyy")),e.items_DateType.push(a.d.ComboBoxItems_2("HH:mm","HH:mm")),e.items_DateType.push(a.d.ComboBoxItems_2("hh:mm a","hh:mm a")),e.items_DateType.push(a.d.ComboBoxItems_2("dd/MM/yyyy hh:mm","dd/MM/yyyy hh:mm a")),e.items_DateType.push(a.d.ComboBoxItems_2("MM/dd/yyyy hh:mm","MM/dd/yyyy hh:mm a")),e.items_DateType.push(a.d.ComboBoxItems_2("dd/MMM/yyyy hh:mm","dd/MMM/yyyy hh:mm a")),e.items_DateType.push(a.d.ComboBoxItems_2("MMM/dd/yyyy hh:mm","MMM/dd/yyyy hh:mm a")),e.items_DateType.push(a.d.ComboBoxItems_2("dd-MM-yyyy hh:mm","dd-MM-yyyy hh:mm a")),e.items_DateType.push(a.d.ComboBoxItems_2("dd-MM-yy hh:mm","dd-MM-yy hh:mm a")),e.items_DateType.push(a.d.ComboBoxItems_2("dd/MM/yyyy HH:mm","dd/MM/yyyy HH:mm")),e.items_DateType.push(a.d.ComboBoxItems_2("MM/dd/yyyy HH:mm","MM/dd/yyyy HH:mm")),e.items_DateType.push(a.d.ComboBoxItems_2("dd/MMM/yyyy HH:mm","dd/MMM/yyyy HH:mm")),e.items_DateType.push(a.d.ComboBoxItems_2("MMM/dd/yyyy HH:mm","MMM/dd/yyyy HH:mm")),e.items_DateType.push(a.d.ComboBoxItems_2("dd-MM-yyyy HH:mm","dd-MM-yyyy HH:mm")),e.items_DateType.push(a.d.ComboBoxItems_2("dd-MM-yy HH:mm","dd-MM-yy HH:mm")),e.items_DateType.push(a.d.ComboBoxItems_2("HH:mm:ss","HH:mm:ss")),e.items_DateType.push(a.d.ComboBoxItems_2("hh:mm:ss tt","hh:mm:ss tt")),e.items_DateType.push(a.d.ComboBoxItems_2("dd/MM/yyyy hh:mm:ss","dd/MM/yyyy hh:mm:ss tt")),e.items_DateType.push(a.d.ComboBoxItems_2("MM/dd/yyyy hh:mm:ss","MM/dd/yyyy hh:mm:ss tt")),e.items_DateType.push(a.d.ComboBoxItems_2("dd/MMM/yyyy hh:mm:ss","dd/MMM/yyyy hh:mm:ss tt")),e.items_DateType.push(a.d.ComboBoxItems_2("MMM/dd/yyyy hh:mm:ss","MMM/dd/yyyy hh:mm:ss tt")),e.items_DateType.push(a.d.ComboBoxItems_2("dd-MM-yyyy hh:mm:ss","dd-MM-yyyy hh:mm:ss tt")),e.items_DateType.push(a.d.ComboBoxItems_2("dd-MM-yy hh:mm:ss","dd-MM-yy hh:mm:ss tt")),e.items_LinkType.push(a.d.ComboBoxItems_2("None","0")),e.items_LinkType.push(a.d.ComboBoxItems_2("Document","1")),e.items_LinkType.push(a.d.ComboBoxItems_2("Document ID","8")),e.items_LinkType.push(a.d.ComboBoxItems_2("Document Detail ID","2")),e.items_LinkType.push(a.d.ComboBoxItems_2("Dimension","3")),e.items_LinkType.push(a.d.ComboBoxItems_2("Dimension Node","4")),e.items_LinkType.push(a.d.ComboBoxItems_2("Attachment","5")),e.items_LinkType.push(a.d.ComboBoxItems_2("Mapped Reports","6")),e.items_LinkType.push(a.d.ComboBoxItems_2("URL","7")),e.items_LinkType.push(a.d.ComboBoxItems_2("Add","9")),e.items_LinkDimension.push(a.d.ComboBoxItems_2("","0")),e.items_LinkDimension.push(a.d.ComboBoxItems_2("Sales Contract","95")),e.items_LinkDimension.push(a.d.ComboBoxItems_2("Purchase Contract","104")),e.items_LinkDimension.push(a.d.ComboBoxItems_2("Quotation","103")),e.items_LinkDimension.push(a.d.ComboBoxItems_2("Unit Reservation","129")),e.items_LinkDimension.push(a.d.ComboBoxItems_2("","0")),e.items_LinkDimension.push(a.d.ComboBoxItems_2("Preview","-4")),e.items_LinkDocument.push(a.d.ComboBoxItems_2("","0")),e.items_LinkDocument.push(a.d.ComboBoxItems_2("Map","-2")),e.items_LinkDocument.push(a.d.ComboBoxItems_2("Popup","-3")),e.items_LinkDocument.push(a.d.ComboBoxItems_2("Preview","-4")),e.items_LinkDocument.push(a.d.ComboBoxItems_2("Approval History","-1")),e.items_LinkAdd.push(a.d.ComboBoxItems_2("","0")),e.items_LinkAdd.push(a.d.ComboBoxItems_2("Activity","1")),e.items_LinkAdd.push(a.d.ComboBoxItems_2("Attachment","2")),e.items_RepeatType.push(a.d.ComboBoxItems_2("","0")),e.items_RepeatType.push(a.d.ComboBoxItems_2("Daily","1")),e.items_RepeatType.push(a.d.ComboBoxItems_2("Weekly","6")),e.items_RepeatType.push(a.d.ComboBoxItems_2("Hourly12","7")),e.items_RepeatType.push(a.d.ComboBoxItems_2("Hourly24","8")),e.items_RepeatType.push(a.d.ComboBoxItems_2("Monthly","2")),e.items_RepeatType.push(a.d.ComboBoxItems_2("Quarterly","3")),e.items_RepeatType.push(a.d.ComboBoxItems_2("Half-Yearly","5")),e.items_RepeatType.push(a.d.ComboBoxItems_2("Yearly","4")),e.items_RepeatType.push(a.d.ComboBoxItems_2("Dimension","10")),e.items_RepeatPrevData.push(a.d.ComboBoxItems_2("0","0")),e.items_RepeatPrevData.push(a.d.ComboBoxItems_2("1","1")),e.items_RepeatPrevData.push(a.d.ComboBoxItems_2("2","2")),e.items_RepeatPrevData.push(a.d.ComboBoxItems_2("3","3")),e.items_UseOnce.push(a.d.ComboBoxItems_2("False","0")),e.items_UseOnce.push(a.d.ComboBoxItems_2("True","1")),e.items_UseOnce.push(a.d.ComboBoxItems_2("True (Club Totals)","2")),e.items_UseOnce.push(a.d.ComboBoxItems_2("Distinct","-1")),e.items_RepeatEmptyCol.push(a.d.ComboBoxItems_2("Hide","0")),e.items_RepeatEmptyCol.push(a.d.ComboBoxItems_2("Show Nodes","2")),e.items_RepeatEmptyCol.push(a.d.ComboBoxItems_2("Show All","1"))}OnButtonClick(e){}OnSelectionChanged(t){"LinkType"==t&&("1"==this.LinkType.SelectedValue?(this.LinkDimension.Visible=!0,this.LinkDimension.Label="Show",this.LinkDimension.Items=e.items_LinkDocument,this.LinkDimensionView.Visible=!1):"3"==this.LinkType.SelectedValue?(this.LinkDimension.Visible=!0,this.LinkDimension.Label="Link Dimension",this.LinkDimension.Items=e.items_LinkDimension,this.LinkDimensionView.Visible=!0):"9"==this.LinkType.SelectedValue?(this.LinkDimension.Visible=!0,this.LinkDimension.Label="Type",this.LinkDimension.Items=e.items_LinkAdd,this.LinkDimensionView.Visible=!1):(this.LinkDimension.SelectedValue="0",this.LinkDimension.Visible=!1,this.LinkDimensionView.Visible=!1),this.LinkReport.Visible="6"==this.LinkType.SelectedValue)}OnListBoxCheckedChanged(e){}SetDataType(){this.Type.DBColumnName=this.CDGDO.DataType,0!=this.CDGDO.FieldValue&&214!=this.CDGDO.FieldValue?(this.Type.Text=this.CDGDO.DataType,this.Type.Visible=!0,this.CType.Visible=!1):(this.CType.SelectedValue=this.CDGDO.DataType,this.CType.Visible=!0,this.Type.Visible=!1),this.Decimals.Visible=!1,this.RoundOff.Visible=!1,this.RoundOff_RT.Visible=!1,this.Commas.Visible=!1,this.SuppressZero.Visible=!1,this.Currency.Visible=!1,this.NegativeNumber.Visible=!1,this.PercentageOn.Visible=!1,this.CumulativeTotals.Visible=!1,this.PrevRowValue.Visible=!1,this.Expression.Visible=!1,this.WrapText.Visible=!1,this.PinnedColumn.Visible=!1,this.WrapTextPrint.Visible=!1,this.PrintChars.Visible=!1,this.NumberFormat.Visible=!1,this.ShowAvg.Visible=!1,this.DateType.Visible=!1,this.ShowLevel.Visible=!1,this.ALLOtherDocsVisible=!1,this.ShowAssigned.Visible=this.CDGDO.ParentCostCenterID>5e4&&null!=this.CDGDO.ChildCDGDO&&8==this.CDGDO.ChildCDGDO.ParentCostCenterID,"INT"==this.CDGDO.DataType||"FLOAT"==this.CDGDO.DataType||"Float"==this.CDGDO.DataType||"TIME"==this.CDGDO.DataType?(this.Decimals.Visible=!0,this.RoundOff.Visible=!0,this.RoundOff_RT.Visible=!0,this.Commas.Visible=!0,this.SuppressZero.Visible=!0,this.Currency.Visible=!0,this.NegativeNumber.Visible=!0,this.PercentageOn.Visible=!0,this.CumulativeTotals.Visible=!0,this.PrevRowValue.Visible=!0,this.Expression.Visible=!0,this.WrapText.Visible=!0,this.NumberFormat.Visible=!0,this.ShowAvg.Visible=!0,this.CDGDO.CategoryValue>-5e4&&this.CDGDO.CategoryValue<-4e4&&(this.ALLOtherDocsVisible=!0,this.ALLOtherDocsLabel="Other Documents")):"Date"==this.CDGDO.DataType||"DATE"==this.CDGDO.DataType?this.DateType.Visible=!0:"IMAGE"==this.CDGDO.DataType?(this.WrapText.Visible=!0,this.WrapText.Label="Stretch Image"):(this.WrapText.Label=i.a.GetResource("Reports_WrapText"),this.Expression.Visible=!0,this.WrapText.Visible=!0,this.WrapTextPrint.Visible=!0,this.PrintChars.Visible=!0,this.ShowLevel.Visible=!0),Screen,!this.IsGroup&&Screen,170==this.CDGDO.FieldValue||182==this.CDGDO.FieldValue||189==this.CDGDO.FieldValue||11361==this.CDGDO.FieldValue||11415==this.CDGDO.FieldValue||11509==this.CDGDO.FieldValue||11510==this.CDGDO.FieldValue||27266==this.CDGDO.FieldValue||11484==this.CDGDO.FieldValue||13964==this.CDGDO.FieldValue||11514==this.CDGDO.FieldValue?(this.ExecutedDocument.Visible=!0,0==this.ExecutedDocument.Items.length&&Screen,182!=this.CDGDO.FieldValue&&11361!=this.CDGDO.FieldValue&&11415!=this.CDGDO.FieldValue&&27266!=this.CDGDO.FieldValue||(this.ALLOtherDocsVisible=!0,this.ALLOtherDocsLabel="For Documents")):this.ExecutedDocument.Visible=!1,11691==this.CDGDO.FieldValue&&(this.LinkType.SelectedValue="5"),this.AccountingDocument.Visible="FutureTrDedit"==this.ID||"FutureTrCredit"==this.ID,this.DimensionsFilterVisible=97==this.CDGDO.FieldValue||98==this.CDGDO.FieldValue||99==this.CDGDO.FieldValue||214==this.CDGDO.FieldValue||11362==this.CDGDO.FieldValue||11420==this.CDGDO.FieldValue||-173==this.CDGDO.ParentCostCenterID||26419==this.CDGDO.ParentCCDefaultColID||26420==this.CDGDO.ParentCCDefaultColID||50453==this.CDGDO.ParentCCDefaultColID}OnShowAsColumnChange(e){}OnPrefixChanged(e){}}return e.ReportHelper=null,e.CTypeList=[],e.FontItems=[],e.cmbTrueFalse=[],e.items_Alignment=[],e.items_Decimals=[],e.items_Commas=[],e.items_CumulativeTotals=[],e.items_Sort=[],e.items_DateType=[],e.items_LinkType=[],e.items_LinkDimension=[],e.items_LinkDimensionView=[],e.items_LinkDocument=[],e.items_LinkAdd=[],e.items_RepeatType=[],e.items_UseOnce=[],e.items_RepeatEmptyCol=[],e.items_RepeatPrevData=[],e.items_Evaluate=[],e.items_ShowLevel=[],e})();class C{constructor(){this.IsForeignKey=!1,this.ParentCostCenterID=0,this.AssignedDimID=0,this.ParentCCDefaultColID=0,this.DataType="FLOAT",this.CategoryValue=0,this.LocalReference=0,this.FieldValue=0,this.DocumentType=0,this.ExecutedDocument="",this.DimensionsFilter=null,this.ALLOtherDocuments=null,this.Visible=!1,this.ColumnCostCenterID=0,this.ColumnCCListViewTypeID=0,this.ParentCDGDO=null,this.ChildCDGDO=null,this.Visible=!0}CloneObject(){let e=new C;for(const t in this)e[t]=this[t];return e}}class u{constructor(e,t){this.Report=e,this.Obj=t}OnButtonClick(e){"SearchCategory"!=e&&"SearchField"!=e||this.Report.FieldsDialog.ShowDialog(null,this.Obj.CDGDO)}}class c extends l.b{constructor(){super(...arguments),this.Screen=null,this.dsFields=null,this.StaticFilterCols=null}static GetColumnFilter(e,t){let s,n,a,l,r,D,C="",u=0;e=(e=e.Replace('Condition="<"','Condition="&lt;"')).Replace('Condition="<="','Condition="&lt;="');let c=new o.f;c.LoadXml(e);for(let h=0;h<c.DocumentElement.children.length;h++){let e=c.DocumentElement.children[h];s=e.attributes.And.value,"AND"==s?s="&&":"OR"==s&&(s="||"),n=""!=e.attributes.Field.value?e.attributes.Field.value:"",a=e.attributes.Condition.value,l=e.attributes.ValueType.value,r=e.attributes.Value.value,D=null!=e.attributes.Value_Key?e.attributes.Value_Key.value:"0",u=0,null!=e.attributes.ValueCCID&&(u=parseInt(e.attributes.ValueCCID.value),t.Contains(n)||t.push(n)),""!=n&&(n="x."+n,"XDATEX"==l&&(n="+"+n+".ToServerDate()")),C+=" "+s;let I=l,d=n,T=n;switch("XDATEX"==I&&(r=r.toUpperCase(),"FROMDATE"!=r&&"TODATE"!=r&&"SYSTMEDATE"!=r||(r="@"+r+"@")),a){case"=":case"<>":if("LISTBOX"==I){let e=i.a.report.GetGrouplft_rgt(u,D);C+=e.length>0?"="==a?" ("+T+"lft_CF>="+e[0].lft.toString()+" && "+T+"lft_CF<="+e[0].rgt.toString()+")":" ("+T+"lft_CF<"+e[0].lft.toString()+" || "+T+"lft_CF>"+e[0].rgt.toString()+")":" 1=0"}else C+=" "+d+a+"+new Date('"+r+"').OnlyDate()";break;case"LIKE":case"NOT LIKE":C+=" "+d+" "+a+" '%"+r+"%'";break;case"IS NULL":case"IS NOT NULL":C+=" "+d+" "+a;break;case">":case">=":case"<":case"<=":C+=" "+d+a+"+new Date('"+r+"').OnlyDate()";break;case"PAST_TODATE":"XDATEX"==I&&o.e.Int(r)>0&&(C+=" ("+d+">=+new Date('@XTODATEX_"+r+"@').OnlyDate() && "+T+"<=+new Date('@TODATE@').OnlyDate())")}}return C.length>0&&(C="!("+C+")"),C}static GetRowFilter(e,t){let s,n,a,l,r,D,C="",u=0,c=new o.f;c.LoadXml(e);let h=c.DocumentElement.children;for(let I=0;I<h.length;I++){let e=h[I];if(s=e.attributes.And.value,n=""!=e.attributes.Field.value?e.attributes.Field.value:"",a=e.attributes.Condition.value,l=e.attributes.ValueType.value,r=e.attributes.Value.value,D=null!=e.attributes.Value_Key?e.attributes.Value_Key.value:"0",u=0,null!=e.attributes.ValueCCID)if(u=parseInt(e.attributes.ValueCCID.value),1==t&&2==u)n="A1.lft";else if(n.Contains("~")){let e=n.split("~");n=e[1]+".lft"}C+=" "+s;let c=l,d=n,T=n;switch("XDATEX"==c&&(r=r.toUpperCase(),"FROMDATE"!=r&&"TODATE"!=r&&"SYSTMEDATE"!=r||(r="@"+r+"@")),a){case"=":case"<>":if("LISTBOX"==c){let e=i.a.report.GetGrouplft_rgt(u,D);C+=e.length>0?"="==a?" ("+T+">="+e[0].lft.toString()+" and "+T+"<="+e[0].rgt.toString()+")":" ("+T+"<"+e[0].lft.toString()+" or "+T+">"+e[0].rgt.toString()+")":" 1=0"}else C+=" "+d+a+"'"+r+"'";break;case"LIKE":case"NOT LIKE":C+=" "+d+" "+a+" '%"+r+"%'";break;case">":case">=":case"<":case"<=":C+=" "+d+a+"'"+r+"'";break;case"PAST_TODATE":"XDATEX"==c&&o.e.Int(r)>0&&(C+=" ("+d+">='@XTODATEX_"+r+"@' and "+T+"<='@TODATE@')")}}return C.length>0&&(C="("+C+")"),C}}}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[199],{MPrf:function(e,t,s){"use strict";s.r(t),s.d(t,"QuickAddPropertyViewModel",(function(){return u}));var i=s("Do2H"),a=s("Lp6j"),r=s("eQJW"),o=s("ScVY"),h=s("EQd/"),l=s("0/4Q"),d=s("VxiT"),n=s("Q0PM"),p=s("k08F");class u extends o.b{constructor(e,t,s,r,o){if(super(),this.PRT={},this.propertyid=0,this.parentid=0,this.selectedNode=0,this.group=!1,this.ds=null,this.ScreenName="",this.Title="",this.Name=new h.d(25543),this.Code=new h.d(25542),this.Status=new l.e(25544),this.Group=new l.e(26394),this.RetValue=0,this.oScreen=new d.a,this.parent=e,this.propertyid=t,this.parentid=s,this.selectedNode=o,this.group=r,this.oScreen.LoadScreen_2(this,92),this.ds=i.a.rental.GetProperty(this.propertyid,0),this.ds.Tables[3].forEach(e=>{this.Status.Items.push(l.d.ComboBoxItems_2(e.Status.toString(),e.StatusID.toString())),this.Status.SelectedValue="422"}),this.ds.Tables.length>1&&this.ds.Tables[0].length>0)for(let i=0;i<this.ds.Tables[0].length;i++)this.Group.Items.push(l.d.ComboBoxItems_2(this.ds.Tables[0][i].Name.toString(),this.ds.Tables[0][i].NodeID.toString()));this.Group.SelectedValue=s.toString(),this.MessageVisibility=!1,0==this.group?0==this.propertyid?(this.Title=i.a.GetResource("RENTALSProperty_AddProperty"),this.AutoGenerateCode(),this.PRT.GUID="GUID"):(this.Title=i.a.GetResource("RENTALSProperty_EditProperty"),this.PRT.GUID=this.ds.Tables[2][0].GUID.toString(),this.ds.Tables.length>0&&this.ds.Tables[1].length>0&&(this.Code.Text=a.e.String(this.ds.Tables[2][0].Code),this.Name.Text=a.e.String(this.ds.Tables[2][0].Name),this.Status.SelectedValue=a.e.String(this.ds.Tables[2][0].StatusID),this.Group.SelectedValue=a.e.String(this.ds.Tables[2][0].ParentID))):(this.Title=i.a.GetResource("CRMLead_AddGroup"),this.AutoGenerateCode(),this.PRT.GUID="GUID"),null!=this.parent&&this.parent.Refresh()}AutoGenerateCode(){let e=i.a.common.GetAutoSequence(92,"",92,i.a.SessionManager.CompanyIndex.toString()),t=this.ds.Tables[1].filter(e=>"CodeAutoGen"==e.Name);t.length>0&&(Object(r.j)(t[0].Value)?(this.Code.Enable=!1,this.Code.Mandatory=!1,0==this.PRT.PropertyID&&(this.Code.Text=e)):this.Code.Enable=!0),t=this.ds.Tables[1].filter(e=>"CapsLock"==e.Name),t.length>0&&Object(r.j)(t[0].Value)&&(this.Name.IsAllCaps=!0),t=this.ds.Tables[1].filter(e=>"CapsToFirstLetter"==e.Name),t.length>0&&Object(r.j)(t[0].Value)&&(this.Name.IsFirstLetterCaps=!0)}OnSave(e){if("Cancel"==e)this.parent.DetailsVisibility=!0,i.a.page.HideDialog();else if("Save"==e){Logger.InfoLog("SavePropertyViewModel:: OnSave");try{if(this.PRT.PropertyID=this.propertyid,null==this.Code.Text||""==this.Code.Text)return this.MessageVisibility=!0,void(this.DisplayMessage="Enter Code");if(this.PRT.Code=this.Code.Text,null==this.Name.Text||""==this.Name.Text)return this.MessageVisibility=!0,void(this.DisplayMessage="Enter Name");this.PRT.Name=this.Name.Text,this.PRT.StatusID=parseInt(this.Status.SelectedValue),this.PRT.SelectedNodeID=this.selectedNode,this.PRT.DetailsXML="<Row />",this.PRT.IsGroup=this.group,i.a.rental.SaveProperty(this.PRT,"SaveProperty").subscribe(e=>{this.DisplayMessage=e.Message,this.MessageVisibility=!0,this.RetValue=e.RetValue,this.RetValue>0&&(this.Name.Text="",this.Status.SelectedValue="1",null!=this.parent&&this.parent.Refresh(),this.AutoGenerateCode(),Logger.InfoLog("SavePropertyViewModel:: OnSave"))},e=>{console.log(" Unit Save : "+JSON.stringify(e))})}catch(t){Logger.ErrorLog("SavePropertyViewModel:: OnSave"+t.stack)}}else{i.a.page.HideDialog();let e=new n.AddEditPropertyViewModel(this.propertyid,this.parentid,this.group);i.a.page.addNewTab({title:e.Title,component:p.AddEditPropertyComponent,params:{obj:e}})}}}}}]);
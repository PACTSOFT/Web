function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var n,i=_getPrototypeOf(e);if(t){var r=_getPrototypeOf(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return _possibleConstructorReturn(this,n)}}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{JUeo:function(e,t,n){"use strict";n.r(t),n.d(t,"ProductSearchField",(function(){return S})),n.d(t,"PactListSearchViewModel",(function(){return P})),n.d(t,"ProductSearchCatalogViewModel",(function(){return b}));var i=n("Do2H"),r=n("Lp6j"),a=n("eQJW"),s=n("ScVY"),o=n("0/4Q"),l=n("JIg3"),c=n("ockk"),u=n("6z9j"),d=n("n56n"),h=n("8B8H"),C=n("EQd/"),m=n("N0aR"),D=n("4/f/"),S=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,i,a,s,l,c,u,h,m){var D;if(_classCallCheck(this,n),(D=t.call(this)).IsColumnInuse=!1,D.OtherDimensions=null,D.OtherDimensionsTbl=null,D.IsEvaluated=!1,D.IsParentFilter=!1,D.OtherDimensionDisplayMember=null,D.IsColumnInuse=c,D.DataType=e,D.ColumnName=i,D.Header=a,D.Condition=new o.e(0),D.FromValue=new C.d(0),D.CC=new d.b(0),h.Contains("~")){var S=h.split("~");D.OtherDimensions=[],D.OtherDimensionsTbl=[];for(var P=0;P<S.length;P++)D.OtherDimensions.push(),D.OtherDimensionsTbl.push(),D.OtherDimensions[P]=parseInt(S[P])}else"PARENT"==h&&(D.IsParentFilter=!0);var b=r.e.Int(s);return b>0?(D.CC.CCID=b,b=1,b=r.e.Int(l),D.CC.TypeID=b,D.CC.Visible=!0,D.CC.Label=D.Header,u>0&&(D.CC.SelectedValue=u),3==D.CC.CCID&&0==D.CC.SelectedValue&&(D.CC.SelectedValue=-1),113==D.CC.CCID&&(D.CC.CustomWhere="CostCenterID="+m),D.Condition.Visible=!1,D.FromValue.Visible=!1):(D.CC.Visible=!1,D.Condition.Visible=!0,D.FromValue.Visible=!0,D.Condition.LblWidth="1",D.FromValue.LblWidth="1"),D.LoadConditions(D.DataType),_possibleConstructorReturn(D)}return _createClass(n,[{key:"LoadConditions",value:function(e){this.Condition.Items.Clear(),this.Condition.Items.push(o.d.ComboBoxItems_2(i.a.GetResource("Com_Equals"),"1")),this.Condition.Items.push(o.d.ComboBoxItems_2(i.a.GetResource("Com_NotEquals"),"2")),this.Condition.Items.push(o.d.ComboBoxItems_2(i.a.GetResource("Com_BeginsWith"),"3")),this.Condition.Items.push(o.d.ComboBoxItems_2(i.a.GetResource("Com_EndsWith"),"4")),this.Condition.Items.push(o.d.ComboBoxItems_2(i.a.GetResource("Com_Contains"),"5")),this.Condition.Items.push(o.d.ComboBoxItems_2(i.a.GetResource("Com_NotContains"),"6")),this.Condition.SelectedValue="5"}}]),n}(n("4HhE").c),P=function(){function e(t){_classCallCheck(this,e),this.ToSearch=t}return _createClass(e,[{key:"onClick",value:function(e){"AddNew"==e||"Cancel"!=e&&"click"!=e||i.a.page.HideDialog()}}]),e}(),b=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,s,d,m,D){var P;if(_classCallCheck(this,n),(P=t.call(this)).ProductID=null,P.ProductName=null,P.Width=0,P.ProductCode=null,P.FullTextSearchCtrl=new C.d,P.GridDataObj=new h.a,P.SelectedGridObj=new h.a,P.ProductsGridDataObj=new h.a,P.AllProducstsVisibility=!0,P.GridDataVisibility=!0,P.GrHeight=0,P.GrWidth=0,P.ReportVisibility=!1,P.IsDocument=!1,P.ReportsDialogVisibility=!1,P.SelectedItemsVisiblility=!0,P.Report=null,P.Options=new o.e(0),P.Reports=new o.e(0),P.ReportFromDate=new l.a(0),P.ReportToDate=new l.a(0),P.NextPrevious=!1,P.qtycc=[],P.Parent=null,P.GridViewID=0,P.CostCenterID=0,P.DisplayCOl=null,P.lstctrl=null,P.GridFilter="",P.sBarcodeWhere="",P.sFulltextSearchWhere="",P.lst=[],P.CostCenterID=d,P.GridViewID=s,P.DisplayCOl=m,P.lstctrl=D,P.Options.Label=i.a.GetResource("SearchType"),P.FullTextSearchCtrl.Label=i.a.GetResource("Tree_Fulltext"),P.Options.LblWidth="120",P.FullTextSearchCtrl.LblWidth="120",P.DisplayName=P.Title=i.a.GetResource("Search"),null!=e||null!=P.lstctrl?(P.Parent=e,P.IsDocument=!0,P.GrHeight=210):(P.IsDocument=!1,P.GrHeight=500),P.Options.Items.push(o.d.ComboBoxItems_2("All","3")),P.Options.Items.push(o.d.ComboBoxItems_2("Basic","0")),P.Options.Items.push(o.d.ComboBoxItems_2("Subtitutes","1")),P.Options.Items.push(o.d.ComboBoxItems_2("Linked","2")),P.Options.SelectedValue="3",3!=P.CostCenterID)P.NextPrevious=!0,P.Options.Visible=!1,P.SelectedItemsVisiblility=!1,null!=D&&(P.CostCenterID=D.CCID,P.GridViewID=D.GridViewID);else{null==e||"AddEditDocumentViewModel"!=e.ClassName||r.e.IsEmpty(e.HoldProdSearch)?e instanceof u.a&&(P.SelectedItemsVisiblility=!1):P.FullTextSearch=e.HoldProdSearch,P.setFullTextSearch=!1;i.a.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise stock")&&r.e.Int(i.a.SessionManager.Preferences["Maintain Dimensionwise stock"])>0&&P.qtycc.push(r.e.Int(i.a.SessionManager.Preferences["Maintain Dimensionwise stock"])),i.a.SessionManager.Preferences.ContainsKey("Location Stock")&&Object(a.j)(i.a.SessionManager.Preferences["Location Stock"])&&P.qtycc.push(50002),!1,i.a.SessionManager.Preferences.ContainsKey("Division Stock")&&Object(a.j)(i.a.SessionManager.Preferences["Division Stock"])&&P.qtycc.push(50001)}P.ProductFields=[];var b,y=i.a.inventory.GetProductSearchFields(P.GridViewID);if(null!=y&&y.Tables.length>0&&!y.Columns[0].Contains("ErrorMessage"))for(var f=0;f<y.Tables[0].length;f++)if(y.Tables[0][f].SysColumnName=r.e.String(y.Tables[0][f].SysColumnName),!y.Columns[0].Contains("columntype")||r.e.IsEmpty(y.Tables[0][f].columntype)||"2"!=y.Tables[0][f].columntype.toString())if("Dropdown"!=y.Tables[0][f].description.toString()||""==y.Tables[0][f].costcentercolid.toString()||261!=parseInt(y.Tables[0][f].costcentercolid.toString())&&262!=parseInt(y.Tables[0][f].costcentercolid.toString())){var g=0;"AddEditDocumentViewModel"==e.ClassName&&null!=e.SelectedRow&&y.Tables[0][f].SysColumnName.toString().startsWith("CCNID")&&e.SelectedRowColumns.Contains("dc"+y.Tables[0][f].SysColumnName.toString()+"_Key")&&!r.e.IsEmpty(e.SelectedRow["dc"+y.Tables[0][f].SysColumnName.toString()+"_Key"])&&(g=parseInt(e.SelectedRow["dc"+y.Tables[0][f].SysColumnName.toString()+"_Key"])),console.log(y.Tables[0]),P.ProductFields.push(new S(r.e.String(y.Tables[0][f].ColumnDataType),r.e.String(y.Tables[0][f].SysColumnName),r.e.String(y.Tables[0][f].ResourceData),r.e.String(y.Tables[0][f].ColumnCostCenterID),r.e.String(y.Tables[0][f].ColumnCCListViewTypeID),Object(a.j)(y.Tables[0][f].iscolumninuse),g,y.Tables[0][f].description.toString(),P.CostCenterID))}else 261==parseInt(y.Tables[0][f].costcentercolid.toString())?P.ProductFields.push(new S("ListBox",y.Tables[0][f].SysColumnName.toString(),y.Tables[0][f].Resourcedata.toString(),"3","100",Object(a.j)(y.Tables[0][f].iscolumninuse.toString()),0,y.Tables[0][f].description.toString(),P.CostCenterID)):262==parseInt(y.Tables[0][f].costcentercolid.toString())&&P.ProductFields.push(new S("ListBox",y.Tables[0][f].SysColumnName.toString(),y.Tables[0][f].Resourcedata.toString(),"3","10",Object(a.j)(y.Tables[0][f].iscolumninuse.toString()),0,y.Tables[0][f].description.toString(),P.CostCenterID));if((b=new c.a).Header="#",b.DisplayMember="Sno",b.DataType="TextBlock",b.Width=24,b.IsVisible=!0,b.ReadOnly=!0,b.IsFrozen=!0,P.ColumnSource.push(b),3==P.CostCenterID&&((b=new c.a).Header="#",b.DisplayMember="Sno",b.DataType="TextBlock",b.Width=24,b.ReadOnly=!0,P.SelectedColumnSource.push(b)),null==y||y.Tables.length>0&&y.Columns[0].Contains("ErrorMessage"))return _possibleConstructorReturn(P,(y.Tables[0].length>0&&(P.DisplayMessage=y.Tables[0][0].ErrorMessage.toString()),void(P.MessageVisibility=!0)));P.Width=null!=P.Parent&&null!=y&&y.Tables.length>2&&!y.Columns[2].Contains("ErrorMessage")&&y.Tables[2].length>0&&!r.e.IsEmpty(y.Tables[2][0].ColumnWidth)?parseInt(y.Tables[2][0].ColumnWidth):1e3,null!=y&&y.Tables.length>2&&y.Columns[2].Contains("Filter")&&y.Tables[2].length>0&&(P.GridFilter=y.Tables[2][0].Filter.toString(),P.GridFilter=P.GridFilter.replace("CC.","C.").replace("a.","P."));var O=y.Tables[0].filter((function(e){return 2==e.columntype}));if(O.Sort="columnorder",O.forEach((function(e){(b=new c.a).Header=e.ResourceData.toString(),b.DisplayMember=e.SysColumnName.toString(),b.DataType="TextBlock",b.ReadOnly=!0,b.Width=r.e.IsEmpty(e.ColumnWidth)?120:parseInt(e.ColumnWidth),P.ColumnSource.push(b),P.GridDataColumns.Contains(e.SysColumnName.toString())||(P.GridDataColumns.push(e.SysColumnName.toString()),3==P.CostCenterID&&(P.SelectedGridColumns.push(e.SysColumnName.toString()),P.SelectedColumnSource.push(b)))})),3==P.CostCenterID){(b=new c.a).Header="Total QOH",b.DisplayMember="QTYonHand",b.DataType="LINK",b.Width=80,b.Click.Subscribe(_assertThisInitialized(P),"onQtyClick"),i.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=i.a.SessionManager.Preferences.DecimalsinQty&&(b.DecimalPoints=i.a.SessionManager.Preferences.DecimalsinQty),P.ColumnSource.push(b);for(var p=0;p<P.ProductFields.length;p++)null!=P.ProductFields[p].OtherDimensions&&((b=new c.a).Header=P.ProductFields[p].Header,P.ProductFields[p].OtherDimensionDisplayMember="DIMNAME_"+P.ProductFields[p].OtherDimensions[P.ProductFields[p].OtherDimensions.length-1].toString().replace("-","N"),b.DisplayMember=P.ProductFields[p].OtherDimensionDisplayMember,b.DataType="TextBlock",b.ReadOnly=!0,b.Width=90,P.ColumnSource.push(b),P.GridDataColumns.Contains(b.DisplayMember)||(P.GridDataColumns.push(b.DisplayMember),P.SelectedGridColumns.push(b.DisplayMember),P.SelectedColumnSource.push(b)))}if((b=new c.a).Header=P.Parent instanceof u.a?"Select":"Add",b.DisplayMember="Add",b.DataType="LINK",b.Width=60,b.IsVisible=!0,b.ReadOnly=!0,b.Click.Subscribe(_assertThisInitialized(P),"onClick"),P.ColumnSource.push(b),3==P.CostCenterID){var T=i.a.report.GetQueryDefnScreenDetails(5,98,0);null!=T&&T.Tables.length>0&&(P.ReportFromDate.Date=i.a.SessionManager.ReportsFromDate,P.ReportToDate.Date=Date.Today(),T.Tables[0].forEach((function(e){P.Reports.Items.push(o.d.ComboBoxItems_2(e.ReportName.toString(),e.ReportID.toString()))})),P.Reports.Items.length>0&&(P.Reports.SelectedItem=P.Reports.Items[0],P.Reports.SelectedValue=P.Reports.Items[0].Value,(b=new c.a).Header="Analysis",b.DisplayMember="Analysis",b.DataType="LINK",b.Width=60,b.IsVisible=!1,b.ReadOnly=!0,b.Click.Subscribe(_assertThisInitialized(P),"onViewClick"),P.ColumnSource.push(b))),null!=e&&"AddEditDocumentViewModel"==e.ClassName&&e.ScreenObject.Preferences.ContainsKey("EnableSubtitutes")&&""!=e.ScreenObject.Preferences.EnableSubtitutes.toString()&&Object(a.j)(e.ScreenObject.Preferences.EnableSubtitutes)&&((b=new c.a).Header="Subtitutes",b.DisplayMember="Subtitutes",b.DataType="LINK",b.Width=80,b.IsVisible=!0,b.ReadOnly=!0,b.Click.Subscribe(_assertThisInitialized(P),"onSubtitutesClick"),P.ColumnSource.push(b)),(b=new c.a).Header="Quantity",b.DisplayMember="QTY",b.DataType="FLOAT",b.Width=75,i.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=i.a.SessionManager.Preferences.DecimalsinQty&&(b.DecimalPoints=i.a.SessionManager.Preferences.DecimalsinQty),P.SelectedColumnSource.push(b),P.SelectedGridColumns.push("Sno"),P.SelectedGridColumns.push("ProductName_Key"),P.SelectedGridColumns.push("QTY")}return P.GridDataColumns.push("Sno"),P.GridDataColumns.push("ProductName_Key"),P.GridDataColumns.push("QTYonHand"),P.GridDataColumns.push("Add"),P.GridDataColumns.push("Analysis"),P.GridDataColumns.push("Subtitutes"),P.setFullTextSearch=!0,P.GridDataObj.SearchVisible=!0,_possibleConstructorReturn(P)}return _createClass(n,[{key:"onSetFocusonGrid",value:function(e){this.setGridFocus=!0}},{key:"onSetFocusonSearch",value:function(e){this.setFullTextSearch=!0}},{key:"onSubtitutesClick",value:function(){if(this.DisplayMessage="",null!=this.SelectedRow){this.GridDataObj.TableColumns.Contains("ProductCode")&&(this.ProductCode=this.SelectedRow.ProductCode.toString()),this.GridDataObj.TableColumns.Contains("ProductName")&&(this.ProductName=this.SelectedRow.ProductName.toString()),this.ProductID=this.SelectedRow.ProductName_Key.toString();var e=null;if((e=this.Parent.ScreenObject.GetSubtituteProducts(parseInt(this.ProductID),this.Parent.DocumentDate,"0",this.Parent.SelectedRow?this.Parent.SelectedRow:null)).Tables.length>0&&!e.Columns[0].Contains("ErrorMessage")&&e.Tables[0].length>0){var t=new m.a(this.Parent,e.Tables[0],e.Columns[0],e.Tables[1],this.ProductName,this.ProductCode,this.ProductID.toString());t.ColumnSource[0].IsVisible=!1,t.GridData.length>0&&i.a.page.ShowDialog(t,D.a)}}}},{key:"onViewClick",value:function(){this.DisplayMessage="",null!=this.SelectedRow?(this.GridDataObj.TableColumns.Contains("ProductCode")&&(this.ProductCode=this.SelectedRow.ProductCode.toString()),this.GridDataObj.TableColumns.Contains("ProductName")&&(this.ProductName=this.SelectedRow.ProductName.toString()),this.ProductID=this.SelectedRow.ProductName_Key.toString(),this.ReportVisibility=!1,this.ReportsDialogVisibility=!0,this.SelectedItemsVisiblility=!1):this.DisplayMessage="Please Select Row"}},{key:"onQtyClick",value:function(){if(null!=this.SelectedRow){this.GridDataObj.TableColumns.Contains("ProductCode")&&(this.ProductCode=this.SelectedRow.ProductCode.toString()),this.GridDataObj.TableColumns.Contains("ProductName")&&(this.ProductName=this.SelectedRow.ProductName.toString()),this.ProductID=this.SelectedRow.ProductName_Key.toString();var e=Date.Today();null!=this.Parent&&"AddEditDocumentViewModel"==this.Parent.ClassName&&(e=this.Parent.DocumentDate);var t=i.a.inventory.GetProductQOH(this.ProductID,e,"");if(null!=t&&t.Tables.length>0&&t.Columns[0].Contains("QOH")){this.ProductsGridData.Clear();for(var n=[],r=0;r<t.Columns[0].length;r++){if("QOH"==t.Columns[0][r]){var a=new c.a;a.Header="QOH",a.DisplayMember="QOH",a.DataType="FLOAT",a.Width=75,i.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=i.a.SessionManager.Preferences.DecimalsinQty&&(a.DecimalPoints=i.a.SessionManager.Preferences.DecimalsinQty),this.ProductsGridDataColumns.push("QOH"),n.push(a);break}this.ProductsGridDataColumns.push(t.Columns[0][r+1]);var s=new c.a;s.Header=t.Columns[0][r],s.DisplayMember=t.Columns[0][r+1],s.DataType="TextBlock",s.Width=150,n.push(s),r++}this.ProductsColumnSource=n;for(var o=0;o<t.Tables[0].length;o++){for(var l=this.ProductsGridDataObj.NewRow(),u=0;u<t.Columns[0].length;u++){if("QOH"==t.Columns[0][u]){l.QOH=t.Tables[0][o].QOH.toString();break}l[t.Columns[0][u+1]]=t.Tables[0][o][t.Columns[0][u]].toString(),u++}this.ProductsGridDataObj.addRow(l)}}this.AllProducstsVisibility=!1,this.GridDataVisibility=!0}}},{key:"onClick",value:function(){var e=this;if(null!=this.lstctrl||null!=this.DisplayCOl&&3!=this.DisplayCOl.CostCenterID)this.AddData();else if(this.Parent instanceof u.a)this.SelectTreeNode();else if(null!=this.Parent&&null!=this.SelectedRow){if("AddEditDocumentViewModel"==this.Parent.ClassName&&!r.e.IsEmpty(this.SelectedRow.ProductName_Key)&&parseInt(this.SelectedRow.ProductName_Key)!=this.Parent.ScreenObject.TempProductID&&this.Parent.ScreenObject.Preferences.ContainsKey("DuplicateProduct_IncrementQuantity")&&""!=this.Parent.ScreenObject.Preferences.DuplicateProduct_IncrementQuantity&&Object(a.j)(this.Parent.ScreenObject.Preferences.DuplicateProduct_IncrementQuantity)){var t=this.SelectedGrid.filter((function(t){return t.ProductName_Key==e.SelectedRow.ProductName_Key}));if(t.length>0){var n=r.e.Double(t[0].QTY);return void(t[0].QTY=n+1)}}var i=this.SelectedGridObj.NewRow();i.Sno=(this.SelectedGrid.length+1).toString();for(var s=0;s<this.SelectedGridColumns.length;s++)"Sno"!=this.SelectedGridColumns[s]&&"ProductName_Key"!=this.SelectedGridColumns[s]&&"QTY"!=this.SelectedGridColumns[s]&&(i[this.SelectedGridColumns[s]]=this.SelectedRow[this.SelectedGridColumns[s]]);i.ProductName_Key=this.SelectedRow.ProductName_Key,i.QTY=1,this.SelectedGridObj.addRow(i)}}},{key:"AddData",value:function(){if(null!=this.SelectedRow&&!r.e.IsEmpty(this.SelectedRow.ProductName_Key)){if(null!=this.lstctrl){if(this.lstctrl.SelectedValue=parseInt(this.SelectedRow.ProductName_Key),i.a.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==i.a.SessionManager.Preferences.DisableAutoLoad.toLowerCase()){var e=this.ColumnSource.find((function(e){return"name"==e.DisplayMember.toLowerCase()}));2==this.CostCenterID&&(e=this.ColumnSource.find((function(e){return"accountname"==e.DisplayMember.toLowerCase()}))),e&&(this.lstctrl.SelectedValueText=this.SelectedRow[e.DisplayMember].toString())}}else if(null!=this.DisplayCOl&&"AddEditDocumentViewModel"==this.Parent.ClassName)if(38!=this.Parent.ScreenObject.DocumentType&&39!=this.Parent.ScreenObject.DocumentType||!i.a.SessionManager.Preferences.ContainsKey("POSItemCodeDimension")||i.a.SessionManager.Preferences.POSItemCodeDimension!=this.CostCenterID.toString())null!=this.Parent.SelectedRow&&(e=this.ColumnSource.find((function(e){return"name"==e.DisplayMember.toLowerCase()})),2==this.CostCenterID&&(e=this.ColumnSource.find((function(e){return"accountname"==e.DisplayMember.toLowerCase()}))),e&&this.Parent.SelectedRowColumns.Contains(this.DisplayCOl.DisplayMember)&&(this.Parent.SelectedRow[this.DisplayCOl.DisplayMember]=this.SelectedRow[e.DisplayMember].toString()),this.Parent.SelectedRowColumns.Contains(this.DisplayCOl.ValueMember)&&(this.Parent.SelectedRow[this.DisplayCOl.ValueMember]=this.SelectedRow.ProductName_Key.toString()));else{var t=this.Parent.GetEmptyRowPosition(this.Parent.ScreenObject.GridDataObj,"ProductID_Key"),n=this.Parent.ScreenObject.GridData[t];n[this.DisplayCOl.ValueMember]=this.SelectedRow.ProductName_Key.toString(),(e=this.ColumnSource.find((function(e){return"code"==e.DisplayMember.toLowerCase()})))&&this.Parent.AddProductData(n,!1,!1,!1,null,this.SelectedRow[e.DisplayMember].toString())}i.a.page.HideDialog()}}},{key:"GetLocations",value:function(e){var t=e.toString();return null!=i.a.SessionManager.Locations&&function(){for(var n=e;n>0;){var s=i.a.SessionManager.Locations.filter((function(e){return e.NodeID==n.toString()}));null!=s&&s.length>0&&!r.e.IsEmpty(s[0].parentid)&&parseInt(s[0].parentid.toString())>0?(n=parseInt(s[0].parentid.toString()),(s=i.a.SessionManager.Locations.filter((function(e){return e.NodeID==n.toString()}))).length>0&&!r.e.IsEmpty(s[0].IsGroup)&&Object(a.j)(s[0].IsGroup.toString())?t+=","+n.toString():n=0):n=0}}(),t}},{key:"onSave",value:function(e){var t=this;if("Clear"==e){this.GridDataObj.Clear();for(var n=0;n<this.ProductFields.length;n++)this.ProductFields[n].CC.Visible?this.ProductFields[n].CC.SelectedValue=0:this.ProductFields[n].FromValue.Text=""}else if("Add"==e||"DblClick"==e){if(null!=this.lstctrl||null!=this.DisplayCOl&&3!=this.DisplayCOl.CostCenterID)return void this.AddData();if(this.Parent instanceof u.a)return void this.SelectTreeNode();if(null!=this.SelectedRow&&null!=this.Parent){if("AddEditDocumentViewModel"==this.Parent.ClassName&&!r.e.IsEmpty(this.SelectedRow.ProductName_Key)&&parseInt(this.SelectedRow.ProductName_Key)!=this.Parent.ScreenObject.TempProductID&&this.Parent.ScreenObject.Preferences.ContainsKey("DuplicateProduct_IncrementQuantity")&&""!=this.Parent.ScreenObject.Preferences.DuplicateProduct_IncrementQuantity&&Object(a.j)(this.Parent.ScreenObject.Preferences.DuplicateProduct_IncrementQuantity)){var s=this.SelectedGrid.filter((function(e){return e.ProductName_Key==t.SelectedRow.ProductName_Key}));if(s.length>0){var l=r.e.Double(s[0].QTY);return void(s[0].QTY=l+1)}}var c=this.SelectedGridObj.NewRow();c.Sno=(this.SelectedGrid.length+1).toString();for(var d=0;d<this.SelectedGridColumns.length;d++)"Sno"!=this.SelectedGridColumns[d]&&"ProductName_Key"!=this.SelectedGridColumns[d]&&"QTY"!=this.SelectedGridColumns[d]&&(c[this.SelectedGridColumns[d]]=this.SelectedRow[this.SelectedGridColumns[d]]);c.ProductName_Key=this.SelectedRow.ProductName_Key,c.QTY=1,this.SelectedGridObj.addRow(c),"DblClick"==e&&this.onSave("OK")}this.AllProducstsVisibility=!0,this.ReportsDialogVisibility=!1,this.GridDataVisibility=!0}else if("ViewReport"==e);else if("back"==e)this.AllProducstsVisibility=!0,this.GridDataVisibility=!0,this.ReportsDialogVisibility=!1,this.SelectedItemsVisiblility=!0;else if("Cancel"==e){if(null!=this.lstctrl||null!=this.DisplayCOl&&3!=this.DisplayCOl.CostCenterID)return void i.a.page.HideDialog();if(null==this.Parent)return;null!=this.FullTextSearch&&"AddEditDocumentViewModel"==this.Parent.ClassName&&(this.Parent.HoldProdSearch=this.FullTextSearch.toString()),i.a.page.HideDialog()}else if("Filter"==e||"Next"==e||"Previous"==e){var h,C,m,D,S;this.AllProducstsVisibility=!0,this.ReportsDialogVisibility=!1,this.GridDataVisibility=!0;var P={},b=this.GetQuery(P);h=P.qtywhere,m=P.join,D=P.OtherDimSelect,S=P.LocWhere,(C=P.fulltext).length>3&&(C=C.Remove(0,3),""!=this.sFulltextSearchWhere&&(C=C+" "+this.sFulltextSearchWhere)),""!=this.GridFilter.Trim()?b.length>0?b+=" and "+this.GridFilter:b=this.GridFilter:b.length>0?b+=" and P.Isgroup=0":b=" P.Isgroup=0";var y=!1;if("Next"==e||"Previous"==e&&this.GridData.length>0){var f=this.ColumnSource.find((function(e){return"code"==e.DisplayMember.toLowerCase()}));2==this.CostCenterID&&(f=this.ColumnSource.find((function(e){return"accountcode"==e.DisplayMember.toLowerCase()}))),f||(f=this.ColumnSource.find(2==this.CostCenterID?function(e){return"accountname"==e.DisplayMember.toLowerCase()}:function(e){return"name"==e.DisplayMember.toLowerCase()})),f&&this.GridData.length>0&&("Next"==e?b+=" and "+f.DisplayMember+">'"+this.GridData[this.GridData.length-1][f.DisplayMember]+"'":(b+=" and "+f.DisplayMember+"<'"+this.GridData[0][f.DisplayMember]+"'",y=!0))}var g=Date.Today();"AddEditDocumentViewModel"==this.Parent.ClassName&&(g=this.Parent.DocumentDate),""!=this.sBarcodeWhere&&(b=b+" "+this.sBarcodeWhere);var O=i.a.inventory.SearchProductCatalog(this.GridViewID,b,h,g,this.Options.Visible?this.Options.SelectedValue:"0",C,m,D,S,y);if(null!=O&&O.Tables.length>0&&!O.Columns[0].Contains("ErrorMessage")){if(("Next"==e||"Previous"==e)&&0==O.Tables[0].length)return;this.GridDataObj.Clear();for(var p=0;p<O.Tables[0].length;p++){var T=this.GridDataObj.NewRow();T.Sno=(p+1).toString(),T.ProductName_Key=O.Tables[0][p].productid;for(var I=0;I<this.GridDataColumns.length;I++)"Sno"!=this.GridDataColumns[I]&&"ProductName_Key"!=this.GridDataColumns[I]&&"QTY"!=this.GridDataColumns[I]&&("productid"==this.GridDataColumns[I].toLowerCase()&&this.CostCenterID.toString()==i.a.SessionManager.Preferences.POSItemCodeDimension?T.Productid=O.Tables[0][p].ProductName:O.Columns[0].Contains(this.GridDataColumns[I])&&(T[this.GridDataColumns[I]]=O.Tables[0][p][this.GridDataColumns[I]]));O.Columns[0].Contains("onHand")&&(T.QTYonHand=O.Tables[0][p].onHand),T.Add=this.Parent instanceof u.a?"Select":"Add",T.Analysis="View",T.Subtitutes="Subtitutes",y&&this.GridData.length>0?this.GridDataObj.insertRowAt(T,0):this.GridDataObj.addRow(T)}if(y)for(var G=0;G<this.GridData.length;G++)this.GridData[G].Sno=(G+1).toString();O.Tables.length>1&&function(){t.lst.Clear();for(var e="",n=t.GridData.length,i=function(i){var r=O.Tables[0][i];if(e=r.ParentID.toString(),0==t.lst.filter((function(t){return t.Name==e})).length){var a=O.Tables[1].filter((function(e){return e.ProductID==r.ParentID}));if(t.lst.push(o.d.ComboBoxItems_1(e)),a.length>0){var s=t.GridDataObj.NewRow();s.Sno=(n+1).toString(),s.ProductName_Key=r.ParentID;for(var l=0;l<t.SelectedGridColumns.length;l++)"Sno"!=t.SelectedGridColumns[l]&&"ProductName_Key"!=t.SelectedGridColumns[l]&&"QTY"!=t.SelectedGridColumns[l]&&O.Columns[1].Contains(t.SelectedGridColumns[l])&&(s[t.SelectedGridColumns[l]]=a[0][t.SelectedGridColumns[l]]);s.Add="",s.Analysis="View",s.Subtitutes="Subtitutes",t.GridDataObj.addRow(s),n+=1}}},r=0;r<O.Tables[0].length;r++)i(r)}()}}else if("OK"==e){if(null!=this.lstctrl||null!=this.DisplayCOl&&3!=this.DisplayCOl.CostCenterID)return void this.AddData();if(this.Parent instanceof u.a)return void this.SelectTreeNode();if(null==this.Parent)return;if(null!=this.FullTextSearch&&(this.Parent.HoldProdSearch=this.FullTextSearch.toString()),i.a.page.HideDialog(),"AddEditDocumentViewModel"==this.Parent.ClassName){var N,j=0;null!=this.Parent.SelectedRow&&(j=this.Parent.ScreenObject.GridData.indexOf(this.Parent.SelectedRow));for(var w=0;w<this.SelectedGrid.length;w++)null!=this.Parent.SelectedRow&&w==this.SelectedGrid.length-1?N=this.Parent.SelectedRow:(N=this.Parent.ScreenObject.GridDataObj.NewRow(),this.Parent.ScreenObject.GridDataObj.insertRowAt(N,j+w)),N.ProductID_Key=this.SelectedGrid[w].ProductName_Key.toString(),N.ProductID_Key=this.SelectedGrid[w].ProductName_Key.toString(),N.ProductID_Key=this.SelectedGrid[w].ProductName_Key.toString(),N.Quantity=r.e.IsEmpty(this.SelectedGrid[w].QTY)?1:this.SelectedGrid[w].QTY,this.Parent.AddProductData(N,!1,!0),r.e.IsNum(N.UOMConversion)&&(N.UOMConvertedQty=r.e.Double(N.UOMConversion)*parseFloat(N.Quantity)),this.Parent.CalculateTotals(N,!1);this.Parent.ScreenObject.UpdateSequence(),this.Parent.RefreshGrid=!this.Parent.RefreshGrid}else if(null!=this.Parent&&"LeadsProductViewModel"==this.Parent.ClassName)for(var F=0;F<this.SelectedGrid.length;F++)r.e.IsEmpty(this.SelectedGrid[F].ProductName_Key)||this.Parent.AddProductToGrid(parseInt(this.SelectedGrid[F].ProductName_Key))}}},{key:"onTxtChanged",value:function(){}},{key:"OnTimerTick",value:function(e,t){this.FullTextSearch.length>3&&this.onSave("Filter"),this._timer.Stop(),this._timer=null}},{key:"GetTableName",value:function(e){return 50001==e?" COM_Division":50002==e?" COM_Location":50003==e?" COM_Branch":50004==e?" COM_Department":50005==e?" COM_Salesman":50006==e?" COM_Category":50007==e?" COM_Area":50008==e?" COM_Teritory":" COM_CC"+e}},{key:"GetQuery",value:function(e){var t=this;e.qtywhere="",e.fulltext="",e.join="",e.OtherDimSelect="",e.LocWhere="";var n="";this.sBarcodeWhere="",this.sFulltextSearchWhere="";for(var a,s="",o="",l=!1,c=[],u=0;u<this.ProductFields.length;u++){if(n="",a="",this.ProductFields[u].IsEvaluated=!1,113==this.ProductFields[u].CC.CCID&&(e.join=e.join+" left join COM_Status sta WITH(NOLOCK) ON P.StatusID=sta.StatusID ",s+="sta.Status='"+this.ProductFields[u].CC.Text+"' and "),this.ProductFields[u].CC.Visible){if(!(this.ProductFields[u].CC.SelectedValue>0)){if(!r.e.IsEmpty(this.FullTextSearch))if(3==this.ProductFields[u].CC.CCID&&this.CostCenterID.toString()!=i.a.SessionManager.Preferences.POSItemCodeDimension)e.fulltext+=" or "+this.ProductFields[u].ColumnName+" like '%"+this.FullTextSearch+"%' ";else if(""==this.ProductFields[u].ColumnName&&this.ProductFields[u].CC.CCID>5e4)if(null!=this.ProductFields[u].OtherDimensions){var d=void 0;this.ProductFields[u].IsEvaluated=!0;var h=-1,C="",m="",D=[];if(u>0){for(var S=0;S<u;S++)D.push(0);for(var P=0;P<u;P++)if(D[P]=-1,null!=this.ProductFields[P].OtherDimensions&&0!=this.ProductFields[P].IsEvaluated)for(var b=0;b<this.ProductFields[u].OtherDimensions.length&&b<this.ProductFields[P].OtherDimensions.length&&this.ProductFields[P].OtherDimensions[b]==this.ProductFields[u].OtherDimensions[b];b++)D[P]++;var y=Math.max.apply(null,D);if(y>=0)for(var f=0;f<u;f++)if(D[f]==y){h=f;break}}for(var g=0;g<this.ProductFields[u].OtherDimensions.length;g++)d=Math.abs(this.ProductFields[u].OtherDimensions[g]),n="DIM"+(C=this.ProductFields[u].OtherDimensions[g]<0?C+"_N"+d:C+"_"+d),-1!=h&&D[h]>=g?(this.ProductFields[u].OtherDimensionsTbl[g]=n,m=C):(this.ProductFields[u].OtherDimensions[g]<0?(a="CMAPDIM"+m,c.Contains(a)||(c.push(a),e.join+=0==g?"\nleft join COM_CostCenterCostCenterMap "+a+" with(nolock) on "+a+".ParentCostCenterID=3 AND "+a+".ParentNodeID=P.ProductID ":"\nleft join COM_CostCenterCostCenterMap "+a+" with(nolock) on "+a+".ParentCostCenterID="+Math.abs(this.ProductFields[u].OtherDimensions[g-1])+" and "+a+".ParentNodeID="+this.ProductFields[u].OtherDimensionsTbl[g-1]+".NodeID"),e.join+="\nleft join "+this.GetTableName(d)+" "+n+" with(nolock) on "+n+".NodeID="+a+".NodeID AND "+a+".CostCenterID="+d):0==g?e.join+="\nleft join "+this.GetTableName(d)+" "+n+" with(nolock) on C.CCNID"+(d-5e4).toString()+"="+n+".NodeID ":(c.Contains("C"+m)||(c.push("C"+m),e.join+="\nleft join COM_CCCCDATA C"+m+" with(nolock) on C"+m+".NodeID="+this.ProductFields[u].OtherDimensionsTbl[g-1]+".NodeID AND C"+m+".CostCenterID="+Math.abs(this.ProductFields[u].OtherDimensions[g-1])),e.join+="\nleft join "+this.GetTableName(d)+" "+n+" with(nolock) on C"+m+".CCNID"+(d-5e4).toString()+"="+n+".NodeID "),this.ProductFields[u].OtherDimensionsTbl[g]=n,m=this.ProductFields[u].OtherDimensions[g]<0?m+"_N"+d:m+"_"+d);e.fulltext+=" or "+n+".Name like '%"+this.FullTextSearch+"%' ",e.OtherDimSelect+=","+n+".Name "+this.ProductFields[u].OtherDimensionDisplayMember}else this.ProductFields[u].IsParentFilter?(a="GCMAP_"+this.ProductFields[u].CC.CCID,e.join+="\nleft join COM_CostCenterCostCenterMap "+a+" with(nolock) on "+a+".ParentCostCenterID=3 AND "+a+".CostCenterID="+this.ProductFields[u].CC.CCID+" and "+a+".ParentNodeID=P.ParentID ",e.join+="\nleft join "+this.GetTableName(this.ProductFields[u].CC.CCID)+" ft"+u.toString()+" with(nolock) on ft"+u.toString()+".NodeID="+a+".NodeID ",e.fulltext+=" or ft"+u.toString()+".Name like '%"+this.FullTextSearch+"%' "):(a="CMAP_"+this.ProductFields[u].CC.CCID,e.join+="\nleft join COM_CostCenterCostCenterMap "+a+" with(nolock) on "+a+".ParentCostCenterID=3 AND "+a+".CostCenterID="+this.ProductFields[u].CC.CCID+" and "+a+".ParentNodeID=P.ProductID ",e.join+="\nleft join "+this.GetTableName(this.ProductFields[u].CC.CCID)+" ft"+u.toString()+" with(nolock) on ft"+u.toString()+".NodeID="+a+".NodeID ",e.fulltext+=" or ft"+u.toString()+".Name like '%"+this.FullTextSearch+"%' ");else this.ProductFields[u].IsParentFilter?(l||(l=!0,e.join+=" join COM_CCCCData GC with(nolock) on GC.NodeID=p.ParentID  AND C.CostCenterID = 3 "),e.join+=" left join "+this.GetTableName(this.ProductFields[u].CC.CCID)+" ft"+u.toString()+" with(nolock) on GC.CCNID"+(this.ProductFields[u].CC.CCID-5e4).toString()+"=ft"+u.toString()+".NodeID ",e.fulltext+=" or ft"+u.toString()+".Name like '%"+this.FullTextSearch+"%' "):3==this.ProductFields[u].CC.CCID&&this.CostCenterID.toString()==i.a.SessionManager.Preferences.POSItemCodeDimension?e.fulltext+=" or PE.Productcode like '%"+this.FullTextSearch+"%' or PE.ProductName like '%"+this.FullTextSearch+"%' ":(e.join+=" left join "+this.GetTableName(this.ProductFields[u].CC.CCID)+" ft"+u.toString()+" with(nolock) on C.CCNID"+(this.ProductFields[u].CC.CCID-5e4).toString()+"=ft"+u.toString()+".NodeID ",e.fulltext+=" or ft"+u.toString()+".Name like '%"+this.FullTextSearch+"%' ");continue}if(this.qtycc.Contains(this.ProductFields[u].CC.CCID)&&(e.qtywhere+=" dcCCNID"+(this.ProductFields[u].CC.CCID-5e4).toString()+"="+this.ProductFields[u].CC.SelectedValue+" and "),3==this.CostCenterID&&i.a.SessionManager.Preferences.ContainsKey("LW Products")&&"True"==i.a.SessionManager.Preferences["LW Products"].toString()&&50002==this.ProductFields[u].CC.CCID&&(e.LocWhere=this.GetLocations(this.ProductFields[u].CC.SelectedValue)),!this.ProductFields[u].IsColumnInuse)continue;o=3==this.ProductFields[u].CC.CCID&&this.CostCenterID.toString()!=i.a.SessionManager.Preferences.POSItemCodeDimension?"='"+this.ProductFields[u].CC.Text+"'":"="+this.ProductFields[u].CC.SelectedValue}else{if(null==this.ProductFields[u].FromValue.Text||""==this.ProductFields[u].FromValue.Text.Trim()){r.e.IsEmpty(this.FullTextSearch)||("description"==this.ProductFields[u].ColumnName.toLowerCase()||"aliasname"==this.ProductFields[u].ColumnName.toLowerCase()||this.CostCenterID>5e4?e.fulltext+=" or p."+this.ProductFields[u].ColumnName+" like '%"+this.FullTextSearch+"%' ":0==this.ProductFields[u].CC.CCID&&"barcodeid"==this.ProductFields[u].ColumnName.toLowerCase()?(e.fulltext+=" or P."+this.ProductFields[u].ColumnName+" like '%"+this.FullTextSearch+"%' ",e.join+="  LEFT JOIN INV_PRODUCTBARCODE B WITH(NOLOCK) on B.ProductID=P.ProductID ",this.sFulltextSearchWhere=" or B.Barcode like '%"+this.FullTextSearch+"%' "):e.fulltext+=" or "+this.ProductFields[u].ColumnName+" like '%"+this.FullTextSearch+"%' ");continue}switch(this.ProductFields[u].Condition.SelectedValue){case"1":o=" ='"+this.ProductFields[u].FromValue.Text+"' ";break;case"2":o=" <>'"+this.ProductFields[u].FromValue.Text+"' ";break;case"3":o=" like '"+this.ProductFields[u].FromValue.Text+"%' ";break;case"4":o=" like '%"+this.ProductFields[u].FromValue.Text+"' ";break;case"5":o=" like '%"+this.ProductFields[u].FromValue.Text+"%' ";break;case"6":o=" not like '%"+this.ProductFields[u].FromValue.Text+"%' "}}if("description"==this.ProductFields[u].ColumnName.toLowerCase()||"aliasname"==this.ProductFields[u].ColumnName.toLowerCase())s+=" p."+this.ProductFields[u].ColumnName+o+" and ";else if(""==this.ProductFields[u].ColumnName&&this.ProductFields[u].CC.CCID>5e4)if(null!=this.ProductFields[u].OtherDimensions)if(""!=n)s+=n+".NodeID"+o+" and ";else{var O=void 0;this.ProductFields[u].IsEvaluated=!0;var p=-1,T="",I="",G=[];if(u>0){for(var N=0;N<u;N++)G.push(0);for(var j=0;j<u;j++)if(G[j]=-1,null!=this.ProductFields[j].OtherDimensions&&0!=this.ProductFields[j].IsEvaluated)for(var w=0;w<this.ProductFields[u].OtherDimensions.length&&w<this.ProductFields[j].OtherDimensions.length&&this.ProductFields[j].OtherDimensions[w]==this.ProductFields[u].OtherDimensions[w];w++)G[j]++;var F=Math.max.apply(null,G);if(F>=0)for(var M=0;M<u;M++)if(G[M]==F){p=M;break}}for(var R=0;R<this.ProductFields[u].OtherDimensions.length;R++)O=Math.abs(this.ProductFields[u].OtherDimensions[R]),n="DIM"+(T=this.ProductFields[u].OtherDimensions[R]<0?T+"_N"+O:T+"_"+O),-1!=p&&G[p]>=R?(this.ProductFields[u].OtherDimensionsTbl[R]=n,I=T):(this.ProductFields[u].OtherDimensions[R]<0?(a="CMAPDIM"+I,c.Contains(a)||(c.push(a),e.join+=0==R?"\nleft join COM_CostCenterCostCenterMap "+a+" with(nolock) on "+a+".ParentCostCenterID=3 AND "+a+".ParentNodeID=P.ProductID ":"\nleft join COM_CostCenterCostCenterMap "+a+" with(nolock) on "+a+".ParentCostCenterID="+Math.abs(this.ProductFields[u].OtherDimensions[R-1])+" and "+a+".ParentNodeID="+this.ProductFields[u].OtherDimensionsTbl[R-1]+".NodeID"),e.join+="\nleft join "+this.GetTableName(O)+" "+n+" with(nolock) on "+n+".NodeID="+a+".NodeID AND "+a+".CostCenterID="+O):0==R?e.join+="\nleft join "+this.GetTableName(O)+" "+n+" with(nolock) on C.CCNID"+(O-5e4).toString()+"="+n+".NodeID ":(c.Contains("C"+I)||(c.push("C"+I),e.join+="\nleft join COM_CCCCDATA C"+I+" with(nolock) on C"+I+".NodeID="+this.ProductFields[u].OtherDimensionsTbl[R-1]+".NodeID AND C"+I+".CostCenterID="+Math.abs(this.ProductFields[u].OtherDimensions[R-1])),e.join+="\nleft join "+this.GetTableName(O)+" "+n+" with(nolock) on C"+I+".CCNID"+(O-5e4).toString()+"="+n+".NodeID "),this.ProductFields[u].OtherDimensionsTbl[R]=n,I=this.ProductFields[u].OtherDimensions[R]<0?I+"_N"+O:I+"_"+O);s+=n+".NodeID"+o+" and ",e.OtherDimSelect+=","+n+".Name "+this.ProductFields[u].OtherDimensionDisplayMember}else this.ProductFields[u].IsParentFilter?(""==a&&(a="GCMAP",e.join+=" left join COM_CostCenterCostCenterMap "+a+" with(nolock) on "+a+".ParentCostCenterID=3 AND "+a+".CostCenterID="+this.ProductFields[u].CC.CCID+" and "+a+".ParentNodeID=P.ParentID "),s+=a+".NodeID"+o+" and "):(""==a&&(a="CMAP",e.join+=" left join COM_CostCenterCostCenterMap "+a+" with(nolock) on "+a+".ParentCostCenterID=3 AND "+a+".CostCenterID="+this.ProductFields[u].CC.CCID+" and "+a+".ParentNodeID=P.ProductID "),s+=a+".NodeID"+o+" and ");else this.ProductFields[u].CC.CCID>5e4?this.ProductFields[u].IsParentFilter?(l||(l=!0,e.join+=" join COM_CCCCData GC with(nolock) on GC.NodeID=P.ParentID  AND C.CostCenterID = 3 "),s+="GC."+this.ProductFields[u].ColumnName+o+" and "):s+="C."+this.ProductFields[u].ColumnName+o+" and ":3==this.ProductFields[u].CC.CCID&&this.CostCenterID.toString()==i.a.SessionManager.Preferences.POSItemCodeDimension?s+="p.ProductID"+o+" and ":this.CostCenterID>5e4?s+="p."+this.ProductFields[u].ColumnName+o+" and ":0==this.ProductFields[u].CC.CCID&&"barcodeid"==this.ProductFields[u].ColumnName.toLowerCase()?(s+="P."+this.ProductFields[u].ColumnName+o+" and ",e.join+="  LEFT JOIN INV_PRODUCTBARCODE B WITH(NOLOCK) on B.ProductID=P.ProductID ",this.sBarcodeWhere=" or B.Barcode "+o):s+=this.ProductFields[u].ColumnName+o+" and "}for(var v=function(e){null!=t.ProductFields[e].OtherDimensions&&(t.ColumnSource.find((function(n){return n.DisplayMember==t.ProductFields[e].OtherDimensionDisplayMember})).IsVisible=t.ProductFields[e].IsEvaluated)},_=0;_<this.ProductFields.length;_++)v(_);if(this.ProductFields.filter((function(e){return null!=e.OtherDimensions})).length>0){var k=[];this.ColumnSource.forEach((function(e){k.push(e)})),this.GridDataObj.Columns=k}return e.qtywhere.length>5&&(e.qtywhere=e.qtywhere.substr(0,e.qtywhere.length-4)),s.length>5?s.substr(0,s.length-4):""}},{key:"SelectTreeNode",value:function(){null!=this.SelectedRow&&this.SelectedRow.ProductName_Key.toString().length>0&&parseInt(this.SelectedRow.ProductName_Key),i.a.page.HideDialog()}},{key:"setGridFocus",set:function(e){}},{key:"setFullTextSearch",set:function(e){}},{key:"FullTextSearch",get:function(){return this.FullTextSearchCtrl.Text},set:function(e){this.FullTextSearchCtrl.Text=e}},{key:"GridData",get:function(){return this.GridDataObj.Table}},{key:"GridDataColumns",get:function(){return this.GridDataObj.TableColumns}},{key:"ColumnSource",get:function(){return this.GridDataObj.Columns}},{key:"SelectedRow",get:function(){return this.GridDataObj.SelectedItem}},{key:"SelectedIndex",get:function(){return this.GridDataObj.SelectedIndex}},{key:"SelectedGrid",get:function(){return this.SelectedGridObj.Table}},{key:"SelectedGridColumns",get:function(){return this.SelectedGridObj.TableColumns}},{key:"SelectedColumnSource",get:function(){return this.SelectedGridObj.Columns}},{key:"ProductsGridData",get:function(){return this.ProductsGridDataObj.Table}},{key:"ProductsGridDataColumns",get:function(){return this.ProductsGridDataObj.TableColumns}},{key:"ProductsColumnSource",get:function(){return this.ProductsGridDataObj.Columns},set:function(e){this.ProductsGridDataObj.Columns=e}}]),n}(s.b)},N0aR:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var i=n("Do2H"),r=n("Lp6j"),a=n("eQJW"),s=n("ScVY"),o=n("8B8H"),l=n("n56n"),c=n("ockk"),u=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,s,c,u,d,h,C){var m;_classCallCheck(this,n),(m=t.call(this)).GridDataObj=new o.a,m.Width=0,m.AllProducstsVisibility=!0,m.AllLocationVisibility=!0,m.Parent=null,m.ProductsGridDataObj=new o.a,m.PID="",m.GridDataObj.Columns=[],m.GridDataObj.Table=[],m.AllLocationVisibility=!1,m.Parent=e,m.PID=C,m.Title=" Subsitutes of : "+h+" - "+d,m.InitGrid(u,c.Contains("SubstituteType"));var D="",S=null;S=s;for(var P=0;P<S.length;P++){D+=S[P].ProductName_Key.toString()+",";var b=m.GridDataObj.NewRow();b.ProductName_Key=S[P].ProductName_Key.toString();for(var y=1;y<m.ColumnSource.length;y++)c.Contains(m.ColumnSource[y].DisplayMember)&&(b[m.ColumnSource[y].DisplayMember]=r.e.StringValue(S[P][m.ColumnSource[y].DisplayMember]));S[P].ProductName_Key.toString()==C?m.GridDataObj.insertRowAt(b,0):m.GridDataObj.addRow(b)}D.length>1&&(D=D.substr(D.length-1,1));var f=e.ScreenObject.ColumnSource.find((function(e){return null!=e.DisplayMember&&"rate"==e.DisplayMember.toLowerCase()})),g=null;if(f&&null!=f.Formula&&""!=f.Formula&&f.Formula.toLowerCase().Contains("avgrate")&&e.ScreenObject.AvgrateExists&&m.GridDataObj.TableColumns.Contains("Price")){var O=[],p=r.e.IntTryParse(i.a.SessionManager.Preferences["Maintain Dimensionwise AverageRate"]);p>5e4&&O.push(p),i.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&Object(a.j)(i.a.SessionManager.Preferences.EnableLocationWise)&&i.a.SessionManager.Preferences.ContainsKey("Location AverageRate")&&Object(a.j)(i.a.SessionManager.Preferences["Location AverageRate"])&&O.push(50002),i.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&Object(a.j)(i.a.SessionManager.Preferences.EnableDivisionWise)&&i.a.SessionManager.Preferences.ContainsKey("Division AverageRate")&&Object(a.j)(i.a.SessionManager.Preferences["Division AverageRate"])&&O.push(50001);var T="";T+="<PXML>";for(var I="",G=0;G<e.ScreenObject._CCFields.length;G++){var N=e.ScreenObject._CCFields[G];N instanceof l.b&&N.DBColumnName.Contains("TO")&&5==e.ScreenObject.DocumentType||N instanceof l.b&&N.SelectedValue>0&&O.Contains(N.CCID)&&(I+=" and dcCCNID"+(N.CCID-5e4).toString()+"="+N.SelectedValue.toString()+" ")}e.ScreenObject.ColumnSource.forEach((function(t){t.CostCenterID>5e4&&O.Contains(t.CostCenterID)&&!r.e.StringIsNullOrEmpty(e.ScreenObject.GridData[e.ScreenObject.SelectedGridRowIndex][t.ValueMember])&&(I+=" and dcCCNID"+(t.CostCenterID-5e4).toString()+"="+e.ScreenObject.GridData[e.ScreenObject.SelectedGridRowIndex][t.ValueMember].toString()+"  ")}));for(var j=0;j<s.length;j++)T+="<Row ",T+=' ProductID="'+s[j].ProductName_Key.toString()+'" ',T+=' QTY="1" ',T+=' DETAILSID="0" ',T+=' avgwhere="'+I+'" ></Row> ';T+="</PXML>",g=e.ScreenObject.GetReconcileAvgRate(T.toString(),e.DocumentDate)}if(m.GridDataObj.TableColumns.Contains("Price")||m.GridDataObj.TableColumns.Contains("SellingRateA")||e.ScreenObject.Preferences.ContainsKey("TransitDOcs")&&""!=e.ScreenObject.Preferences.TransitDOcs){var w,F=e.ScreenObject.GetProductDetails(D,e.DocumentDate,0,1,"0",null);if(null!=F&&F.Tables.length>0&&F.Columns[0].Contains("ProductID")){var M="";M=1==e.ScreenObject.DocumentType||25==e.ScreenObject.DocumentType||2==e.ScreenObject.DocumentType||3==e.ScreenObject.DocumentType||4==e.ScreenObject.DocumentType||10==e.ScreenObject.DocumentType||26==e.ScreenObject.DocumentType||27==e.ScreenObject.DocumentType||34==e.ScreenObject.DocumentType||31==e.ScreenObject.DocumentType?"PurchaseRate":"SellingRate",f&&null!=f.Formula&&F.Columns[0].Contains(f.Formula)&&"avgrate"!=f.Formula.toLowerCase().trim()?M=f.Formula:null!=f&&null!=f.Formula&&""!=f.Formula&&(M="",e.FillDictionary(e.SelectedRow,!1));for(var R=function(t){if(null==m.GridData[t].ProductName_Key)return"continue";var n=null;if(m.GridDataObj.TableColumns.Contains("Price"))if(F.Tables.length>1&&F.Tables[1].filter((function(e){return e.ProductID==m.GridData[t].ProductName_Key})).length>0?n=F.Tables[1].filter((function(e){return e.ProductID==m.GridData[t].ProductName_Key})):F.Tables.length>2&&F.Tables[2].filter((function(e){return e.ProductID==m.GridData[t].ProductName_Key})).length>0?n=F.Tables[2].filter((function(e){return e.ProductID==m.GridData[t].ProductName_Key})):F.Tables.length>0&&F.Tables[0].filter((function(e){return e.ProductID==m.GridData[t].ProductName_Key})).length>0&&(n=F.Tables[0].filter((function(e){return e.ProductID==m.GridData[t].ProductName_Key}))),""!=M)m.GridData[t].Price=null!=n&&n.length>0&&!r.e.StringIsNullOrEmpty(n[0][M])?n[0][M].toString():0;else{var s=e.ScreenObject.GridDataObj.NewRow();if(null!=n&&n.length>0){if(s.RATE=1==e.ScreenObject.DocumentType||25==e.ScreenObject.DocumentType||2==e.ScreenObject.DocumentType||3==e.ScreenObject.DocumentType||4==e.ScreenObject.DocumentType||10==e.ScreenObject.DocumentType||26==e.ScreenObject.DocumentType||27==e.ScreenObject.DocumentType||34==e.ScreenObject.DocumentType||31==e.ScreenObject.DocumentType?r.e.StringIsNullOrEmpty(n[0].PurchaseRate)?0:n[0].PurchaseRate.toString():r.e.StringIsNullOrEmpty(n[0].SellingRate)?0:n[0].SellingRate.toString(),null!=g&&g.Tables.length>0&&g.Columns[0].Contains("PID")){var o=g.Tables[0].filter((function(e){return e.PID==m.GridData[t].ProductName_Key}));o.length>0&&(s.AVGRATE=r.e.StringIsNullOrEmpty(o[0].AvgRate)?0:o[0].AvgRate.toString())}m.FillSalesPurchase(s,n[0]),e.CalculateTotals(s,!1),m.GridData[t].Price=s.RATE.toString()}}m.GridDataObj.TableColumns.Contains("SellingRateA")&&(w=1,i.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(a.j)(i.a.SessionManager.Preferences["Use Foreign Currency"])&&null!=e.Currency&&r.e.IsNum(e.Currency.ExchangeRate.Text)&&(w=parseFloat(e.Currency.ExchangeRate.Text)),m.GridData[t].SellingRateA=F.Tables.length>1&&F.Tables[1].filter((function(e){return e.ProductID==m.GridData[t].ProductName_Key})).length>0&&r.e.DoubleTryParse(F.Tables[1].filter((function(e){return e.ProductID==m.GridData[t].ProductName_Key}))[0].SellingRateA)>0?0!=w?parseFloat(F.Tables[1].filter((function(e){return e.ProductID==m.GridData[t].ProductName_Key.toString()}))[0].SellingRateA.toString())/w:F.Tables[1].filter((function(e){return e.ProductID==m.GridData[t].ProductName_Key.toString()}))[0].SellingRateA.toString():F.Tables.length>2&&F.Tables[2].filter((function(e){return e.ProductID==m.GridData[t].ProductName_Key.toString()})).length>0&&r.e.DoubleTryParse(F.Tables[2].filter((function(e){return e.ProductID==m.GridData[t].ProductName_Key.toString()}))[0].SellingRateA.toString())>0?0!=w?parseFloat(F.Tables[2].filter((function(e){return e.ProductID==m.GridData[t].ProductName_Key.toString()}))[0].SellingRateA.toString())/w:F.Tables[2].filter((function(e){return e.ProductID==m.GridData[t].ProductName_Key.toString()}))[0].SellingRateA.toString():F.Tables.length>0&&F.Tables[0].filter((function(e){return e.ProductID==m.GridData[t].ProductName_Key.toString()})).length>0&&r.e.DoubleTryParse(F.Tables[0].filter((function(e){return e.ProductID==m.GridData[t].ProductName_Key.toString()}))[0].SellingRateA.toString())>0?0!=w?parseFloat(F.Tables[0].filter((function(e){return e.ProductID==m.GridData[t].ProductName_Key.toString()}))[0].SellingRateA.toString())/w:F.Tables[0].filter((function(e){return e.ProductID==m.GridData[t].ProductName_Key.toString()}))[0].SellingRateA.toString():"0")},v=0;v<m.GridData.length;v++)R(v)}m.CheckGoodsinTransit(F)}return m.CheckLocationWiseQty(),m.ShowSubQOH(),m.GridData.length>0&&m.FillEmptyRows(),m}return _createClass(n,[{key:"CheckGoodsinTransit",value:function(e){var t=this;if(this.Parent.ScreenObject.Preferences.ContainsKey("TransitDOcs")&&""!=this.Parent.ScreenObject.Preferences.TransitDOcs){var n="",r=this.Parent.ScreenObject._CCFields.find((function(e){return e instanceof l.b&&50002==e.CCID}));if(r&&r instanceof l.b)n=r.Text;else{var a=this.ColumnSource.find((function(e){return null!=e.DisplayMember&&"50002"==e.DisplayMember}));a&&(n=a.Header)}this.GridDataObj.TableColumns.push("transit");var s=new c.a;if(s.Header=n+" transit",s.DisplayMember="transit",s.DataType="FLOAT",s.Width=80,s.ReadOnly=!0,s.DisableTab=!0,i.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=i.a.SessionManager.Preferences.DecimalsinQty&&(s.DecimalPoints=i.a.SessionManager.Preferences.DecimalsinQty),this.ColumnSource.length>9?this.ColumnSource.InsertAt(s,9):this.ColumnSource.push(s),null!=e&&e.Tables.length>3&&e.Columns[3].Contains("PendingOrders"))for(var o=function(n){null!=t.GridData[n].ProductName_Key&&e.Tables[3].filter((function(e){return e.ProductID==t.GridData[n].ProductName_Key.toString()})).length>0&&(t.GridData[n].transit=e.Tables[3].filter((function(e){return e.ProductID==t.GridData[n].ProductName_Key.toString()}))[0].PendingOrders.toString())},u=0;u<this.GridData.length;u++)o(u)}}},{key:"ShowSubQOH",value:function(){var e=this;if(this.Parent.ScreenObject.Preferences.ContainsKey("ShowSubQOH")&&""!=this.Parent.ScreenObject.Preferences.ShowSubQOH&&Object(a.j)(this.Parent.ScreenObject.Preferences.ShowSubQOH))if(this.GridDataObj.TableColumns.Contains("SubQOH")){var t=this.Parent.ScreenObject.ColumnSource.find((function(e){return!r.e.StringIsNullOrEmpty(e.OPParams)&&e.OPParams.Contains(t.ID)}));if(t){for(var n=[],s=t.IPParams.split(","),o=function(t){if(""!=s[t])if((c=e.Parent.ScreenObject.ColumnSource.find((function(e){return e.ID==s[t]})))&&3==c.CostCenterID){for(var i="",r=0;r<e.GridData.length;r++)null!=e.GridData[r].ProductName_Key&&(i+=e.GridData[r].ProductName_Key.toString()+",");i.length>1&&(i=i.substr(0,i.length-1)),n.push(i)}else n.push(e.Parent.ScreenObject.GetValueBYCOLID(s[t],e.Parent.SelectedRow))},l=0;l<s.length;l++){var c;o(l)}n.push(i.a.SessionManager.UserID),n.push(i.a.SessionManager.LanguageID);var u=i.a.document.GetData(JSON.stringify(n),t.SPName);if(null!=u&&u.Tables.length>0&&u.Columns[0].Contains("ProductID")&&u.Tables[0].length>0)for(var d=function(t){var n=u.Tables[0].filter((function(n){return n.ProductID==e.GridData[t].ProductName_Key.toString()}));n.length>0&&r.e.DoubleTryParse(n[0][u.Columns[0][0]])>0?n.length>0&&(e.GridData[t].SubQOH=n[0][u.Columns[0][0]].toString()):(e.GridDataObj.removeRow(e.GridData[t]),t--),h=t},h=0;h<this.GridData.length;h++)d(h)}for(var C=0,m=0;m<this.GridData.length;m++)if(!r.e.StringIsNullOrEmpty(this.GridData[m].ProductName_Key)&&this.GridData[m].ProductName_Key.toString()!=this.PID){C++;break}0==C&&this.GridData.Clear()}else if(this.GridDataObj.TableColumns.Contains("QOH"))for(var D=0;D<this.GridData.length;D++)null!=this.GridData[D].ProductName_Key&&(r.e.DoubleTryParse(this.GridData[D].QOH)>0||(this.GridDataObj.removeRow(this.GridData[D]),D--));else{for(var S="",P=0;P<this.GridData.length;P++)null!=this.GridData[P].ProductName_Key&&(S+=this.GridData[P].ProductName_Key.toString()+",");var b=this.Parent.ScreenObject.GetProductQtyOnHand(S,this.Parent.DocumentDate);if(""!=S&&null!=b&&b.Tables.length>0&&b.Columns[0].Contains("ProductID"))for(var y=function(t){var n=b.Tables[0].filter((function(n){return n.ProductID==e.GridData[t].ProductName_Key.toString()}));n.length>0&&r.e.DoubleTryParse(n[0].QOH)>0||(e.GridDataObj.removeRow(e.GridData[t]),t--),f=t},f=0;f<this.GridData.length;f++)y(f)}}},{key:"CheckLocationWiseQty",value:function(){var e=this;if(this.Parent.ScreenObject.Preferences.ContainsKey("LocationWiseQty")&&""!=this.Parent.ScreenObject.Preferences.LocationWiseQty&&Object(a.j)(this.Parent.ScreenObject.Preferences.LocationWiseQty)){for(var t="",n=0;n<this.GridData.length;n++)null!=this.GridData[n].ProductName_Key&&(t+=this.GridData[n].ProductName_Key.toString()+",");if(""!=t){var s=!1;t=t.substr(t.length-1,1);var o=Date.Today();r.e.IsType(this.Parent,"AddEditDocumentViewModel")&&(o=this.Parent.DocumentDate);var l=i.a.inventory.GetProductQOH("0",o,t);if(null!=l&&l.Tables.length>0&&l.Columns[0].Contains("QOH")){if(l.Tables.length>1&&l.Columns[1].Contains("NodeID"))for(var u=0;u<l.Tables[1].length;u++)if(s=i.a.SessionManager.IsActionAssigned(43,"Override Location For Substitutes"),!i.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")||""==i.a.SessionManager.Preferences.EnableLocationWise||!Object(a.j)(i.a.SessionManager.Preferences.EnableLocationWise)||i.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&""!=i.a.SessionManager.Preferences.EnableLocationWise&&Object(a.j)(i.a.SessionManager.Preferences.EnableLocationWise)&&(i.a.SessionManager.LocationWhere.Contains(","+l.Tables[1][u].NodeID.toString()+",")||i.a.SessionManager.LocationWhere.startsWith(l.Tables[1][u].NodeID.toString()+",")||i.a.SessionManager.LocationWhere.endsWith(","+l.Tables[1][u].NodeID.toString())||i.a.SessionManager.LocationWhere==l.Tables[1][u].NodeID.toString()||s)){this.GridDataObj.TableColumns.push(l.Tables[1][u].NodeID.toString());var d=new c.a;d.Header=l.Tables[1][u].Name.toString(),d.DisplayMember=l.Tables[1][u].NodeID.toString(),d.DataType="FLOAT",d.Width=50,d.ReadOnly=!0,d.DisableTab=!0,i.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=i.a.SessionManager.Preferences.DecimalsinQty&&(d.DecimalPoints=i.a.SessionManager.Preferences.DecimalsinQty),(this.Parent.ScreenObject.LocationID>0&&l.Tables[1][u].NodeID.toString()==this.Parent.ScreenObject.LocationID.toString()||i.a.SessionManager.LocationID>0&&l.Tables[1][u].NodeID.toString()==i.a.SessionManager.LocationID.toString())&&this.ColumnSource.length>8?this.ColumnSource.InsertAt(d,8):this.ColumnSource.push(d)}var h="";if("true"==i.a.SessionManager.Preferences.EnableLocationWise.toLowerCase()&&"true"==i.a.SessionManager.Preferences["Location Stock"].toLowerCase()&&(h="dcccnid2"),"true"==i.a.SessionManager.Preferences.EnableDivisionWise.toLowerCase()&&"true"==i.a.SessionManager.Preferences["Division Stock"].toLowerCase()&&(h="dcccnid1"),r.e.IntTryParse(i.a.SessionManager.Preferences["Maintain Dimensionwise stock"])>0&&(h="dcccnid"+(parseInt(i.a.SessionManager.Preferences["Maintain Dimensionwise stock"])-5e4)),l.Columns[0].Contains(h)){this.ColumnSource[4].IsVisible=!1,this.ColumnSource[5].DataType="FLOAT";for(var C=function(t){if(null==e.GridData[t].ProductName_Key)return"continue";for(var n=l.Tables[0].filter((function(n){return n.ProductID==e.GridData[t].ProductName_Key.toString()})),r=0;r<n.length;r++){if(!e.GridDataObj.TableColumns.Contains(n[r][h].toString())){if(l.Tables.length>1)continue;e.GridDataObj.TableColumns.push(n[r][h].toString());var a=new c.a;a.Header=n[r][0].toString(),a.DisplayMember=n[r][h].toString(),a.DataType="FLOAT",a.ReadOnly=!0,a.Width=80,i.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=i.a.SessionManager.Preferences.DecimalsinQty&&(a.DecimalPoints=i.a.SessionManager.Preferences.DecimalsinQty),e.ColumnSource.push(a)}e.GridData[t][n[r][h].toString()]=n[r].QOH.toString()}},m=0;m<this.GridData.length;m++)C(m)}for(var D=0;D<this.GridData.length;D++)if(null!=this.GridData[D].ProductName_Key)for(var S=5;S<this.GridDataObj.TableColumns.length;S++)""==this.GridData[D][S].toString()&&(this.GridData[D][S]=0)}}}}},{key:"FillEmptyRows",value:function(){for(var e=0;e<this.GridData.length;e++)if(null!=this.GridData[e].ProductName_Key)for(var t=1;t<this.ColumnSource.length;t++)!r.e.StringIsNullOrEmpty(this.ColumnSource[t].DecimalPoints)&&this.GridDataObj.TableColumns.Contains(this.ColumnSource[t].DisplayMember)&&r.e.IsNum(this.GridData[e][this.ColumnSource[t].DisplayMember])&&(this.GridData[e][this.ColumnSource[t].DisplayMember]=parseFloat(this.GridData[e][this.ColumnSource[t].DisplayMember].toString()).ToString("N"+this.ColumnSource[t].DecimalPoints));for(var n=this.GridData.length;n<10;n++)this.GridDataObj.addEmptyRow();for(var i=0;i<this.GridData.length;i++)this.GridData[i].Select=!1}},{key:"onClick",value:function(e,t){if(t&&null!=this.SelectedRow&&!r.e.StringIsNullOrEmpty(this.SelectedRow.ProductName_Key)){var n;if(i.a.page.HideDialog(),(n=this.Parent.SelectedRow).Subexists="1",n.ProductID_Key.toString()!=this.SelectedRow.ProductName_Key.toString()&&this.GridData.filter((function(e){return e.ProductName_Key==n.ProductID_Key})).length>0){var s=this.Parent.ScreenObject.Data.Tables[0];s.length>0&&((s=this.Parent.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&79==e.LocalReference&&55200==e.LinkData}))).length>0&&this.Parent.ScreenObject.GridDataObj.TableColumns.Contains(s[0].SysColumnName.toString())&&(this.Parent.ScreenObject.GridDataObj.TableColumns.Contains(s[0].SysColumnName.toString()+"_Key")?(n[s[0].SysColumnName.toString()+"_Key"]=n.ProductID_Key,this.Parent.ScreenObject.GridDataObj.TableColumns.Contains("ProductName")&&(n[s[0].SysColumnName.toString()]=n.ProductName)):n[s[0].SysColumnName.toString()]=n.ProductID_Key))}this.Parent.ScreenObject.Preferences.ContainsKey("Dontresetvaluesonproductchange")&&""!=this.Parent.ScreenObject.Preferences.Dontresetvaluesonproductchange&&Object(a.j)(this.Parent.ScreenObject.Preferences.Dontresetvaluesonproductchange)?n.ProductID_Key.toString()!=this.SelectedRow.ProductName_Key.toString()&&(n.ProductID_Key=this.SelectedRow.ProductName_Key.toString(),this.Parent.ScreenObject.GridDataObj.TableColumns.Contains("ProductCode")&&this.GridDataObj.TableColumns.Contains("ProductCode")&&(n.ProductCode=this.SelectedRow.ProductCode.toString()),this.Parent.ScreenObject.GridDataObj.TableColumns.Contains("ProductName")&&this.GridDataObj.TableColumns.Contains("ProductName")&&(n.ProductName=this.SelectedRow.ProductName.toString()),this.dontresetvalues(n)):(n.ProductID_Key=this.SelectedRow.ProductName_Key.toString(),this.Parent.ScreenObject.GridDataObj.TableColumns.Contains("ProductCode")&&this.GridDataObj.TableColumns.Contains("ProductCode")&&(n.ProductCode=this.SelectedRow.ProductCode.toString()),this.Parent.ScreenObject.GridDataObj.TableColumns.Contains("ProductName")&&this.GridDataObj.TableColumns.Contains("ProductName")&&(n.ProductName=this.SelectedRow.ProductName.toString()),n.Quantity="1",this.Parent.AddProductData(n,!1,!1,!0)),this.Parent.CalculateTotals(n,!1),this.Parent.SubDialogResult=!0,this.Parent.ReportDimension.SelectedValue=parseInt(this.SelectedRow.ProductName_Key.toString()),this.Parent.ProdID=0,this.Parent.ScreenObject.GridDataObj.updateRow(n)}}},{key:"dontresetvalues",value:function(e){var t=this,n=this.Parent.GetProductValues(e,0);if(null!=n&&n.Tables.length>0&&n.Tables[0].length>0&&!n.Columns[0].Contains("ErrorMessage")&&(e.Type=n.Tables[0][0].ProductTypeID.toString(),this.Parent.ScreenObject.GridDataColumns.Contains("BinWise")&&n.Columns[0].Contains("BinWise")&&(e.BinWise=n.Tables[0][0].BinWise.toString()),this.Parent.ScreenObject.GridDataColumns.Contains("QtyType")&&n.Columns[0].Contains("QtyAdjustType")&&(e.QtyType=n.Tables[0][0].QtyAdjustType.toString()),this.Parent.ScreenObject.GridDataColumns.Contains("PackType")&&n.Columns[0].Contains("IsPacking")&&(e.PackType=n.Tables[0][0].IsPacking.toString()),this.Parent.ScreenObject.GridDataColumns.Contains("IsTestCase")&&n.Columns[0].Contains("TestCaseExists")&&(e.IsTestCase=n.Tables[0][0].TestCaseExists.toString()),this.Parent.ScreenObject.GridDataColumns.Contains("landingType")&&n.Columns[0].Contains("IsBillOfEntry")&&(e.landingType=n.Tables[0][0].IsBillOfEntry.toString()),this.Parent.ScreenObject.GridDataColumns.Contains("SchemeProductID")&&(e.SchemeProductID=null),e.ExtraXML=null),this.Parent.ScreenObject.Preferences.ContainsKey("ResetFields")&&""!=this.Parent.ScreenObject.Preferences.ResetFields.toString()){for(var i="",a=this.Parent.ScreenObject.Preferences.ResetFields.toString().split(","),s=function(s){i+="'"+a[s]+"',",t.Parent.ScreenObject.GridDataObj.TableColumns.Contains(a[s])&&(e[a[s]]=null),t.Parent.ScreenObject.GridDataObj.TableColumns.Contains(a[s]+"_Key")&&(e[a[s]+"_Key"]=null);var o=n.Tables[4].filter((function(e){return e.SysColumnName==a[s]}));o.length>0?(e[a[s]]=o[0].Value.toString(),e["default"+a[s]]=o[0].Value.toString()):"Unit"==a[s]&&n.Tables.length>0&&n.Columns[0].Contains("uomid")&&!r.e.StringIsNullOrEmpty(n.Tables[0][0].uomid)?(e.Unit=n.Tables[0][0].UnitName.toString(),e.Unit_key=n.Tables[0][0].uomid.toString()):"Rate"==a[s]&&(n.Tables.length>3&&n.Tables[3].length>0?1==t.Parent.ScreenObject.DocumentType||25==t.Parent.ScreenObject.DocumentType||2==t.Parent.ScreenObject.DocumentType||3==t.Parent.ScreenObject.DocumentType||4==t.Parent.ScreenObject.DocumentType||10==t.Parent.ScreenObject.DocumentType||26==t.Parent.ScreenObject.DocumentType||27==t.Parent.ScreenObject.DocumentType||34==t.Parent.ScreenObject.DocumentType||31==t.Parent.ScreenObject.DocumentType?r.e.StringIsNullOrEmpty(n.Tables[3][0].PurchaseRate)||(e.Rate=n.Tables[3][0].PurchaseRate.toString()):r.e.StringIsNullOrEmpty(n.Tables[3][0].SellingRate)||(e.Rate=n.Tables[3][0].SellingRate.toString()):n.Tables.length>0&&n.Tables[0].length>0&&(1==t.Parent.ScreenObject.DocumentType||25==t.Parent.ScreenObject.DocumentType||2==t.Parent.ScreenObject.DocumentType||3==t.Parent.ScreenObject.DocumentType||4==t.Parent.ScreenObject.DocumentType||10==t.Parent.ScreenObject.DocumentType||26==t.Parent.ScreenObject.DocumentType||27==t.Parent.ScreenObject.DocumentType||34==t.Parent.ScreenObject.DocumentType||31==t.Parent.ScreenObject.DocumentType?r.e.StringIsNullOrEmpty(n.Tables[0][0].PurchaseRate)||(e.Rate=n.Tables[0][0].PurchaseRate.toString()):r.e.StringIsNullOrEmpty(n.Tables[0][0].SellingRate)||(e.Rate=n.Tables[0][0].SellingRate.toString())))},o=0;o<a.length;o++)s(o);i.length>1&&(i=i.substr(0,i.length-1));var l=this.Parent.ScreenObject.ColumnSource.find((function(e){return!r.e.StringIsNullOrEmpty(e.ValueMember)&&"productid_key"==e.ValueMember.toLowerCase()})),c=this.Parent.ScreenObject.Data.Tables[0].filter((function(e){return i.split(",").Contains(e.SysColumnName)&&null!=e.LocalReference&&e.LocalReference==l.ID}));c.length>0&&this.Parent.ScreenObject.GetLinkReferenceData(parseInt(l.ID),this.Parent.DocumentID,parseInt(e.ProductID_Key),Date.Today(),"",3,e,a);var u=this.Parent.ScreenObject.ColumnSource.find((function(e){return!r.e.StringIsNullOrEmpty(e.ValueMember)&&e.ValueMember.toLowerCase()==l.ValueMember.toLowerCase()&&e.ID!=l.ID}));u&&((c=this.Parent.ScreenObject.Data.Tables[0].filter((function(e){return i.split(",").Contains(e.SysColumnName)&&null!=e.LocalReference&&e.LocalReference==u.ID}))).length>0&&this.Parent.ScreenObject.GetLinkReferenceData(parseInt(u.ID),this.Parent.DocumentID,parseInt(e.ProductID_Key),Date.Today(),"",3,e,a))}}},{key:"InitGrid",value:function(e,t){var n,a=this;this.GridDataObj.TableColumns.push("Select"),this.GridDataObj.TableColumns.push("ProductName_Key"),this.GridDataObj.TableColumns.push("SubstituteType"),(n=new c.a).Header="Select",n.DisplayMember="Select",n.DataType="RadioButton",n.Width=50,n.CheckedChanged=this.onClick,n.IsFrozen=!0,n.IsVisible=!1,this.ColumnSource.push(n),t&&((n=new c.a).Header="Type",n.DisplayMember="SubstituteType",n.Width=75,n.IsFrozen=!0,n.ReadOnly=!0,this.ColumnSource.push(n));for(var s=0;s<e.length;s++)(n=new c.a).Header=e[s].UserColumnName.toString(),n.DisplayMember=r.e.StringValue(e[s].SYSCOLUMNNAME),n.Width=r.e.StringIsNullOrEmpty(e[s].ColumnWidth)?50:parseInt(e[s].ColumnWidth.toString()),""==r.e.StringValue(e[s].SYSCOLUMNNAME)?n.DisplayMember=e[s].CCID.toString():"26428"==e[s].ColID.toString()?n.DisplayMember="onHand":"PurchaseRate"==e[s].SYSCOLUMNNAME&&this.Parent.ScreenObject.IsPurchase?n.DisplayMember="Price":"SellingRate"!=e[s].SYSCOLUMNNAME||this.Parent.ScreenObject.IsPurchase||(n.DisplayMember="Price"),"FLOAT"==e[s].usercolumntype&&(n.DataType="FLOAT","onHand"==n.DisplayMember||"Price"==n.DisplayMember||n.DisplayMember.Contains("Rate")?i.a.SessionManager.Preferences.ContainsKey("DecimalsinAmount")&&""!=i.a.SessionManager.Preferences.DecimalsinAmount&&(n.DecimalPoints=i.a.SessionManager.Preferences.DecimalsinAmount):i.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=i.a.SessionManager.Preferences.DecimalsinQty&&(n.DecimalPoints=i.a.SessionManager.Preferences.DecimalsinQty)),n.ReadOnly=!0,this.ColumnSource.push(n),this.GridDataObj.TableColumns.push(n.DisplayMember);if(this.Parent.ScreenObject.Preferences.ContainsKey("SubstituteOnQty")&&""!=this.Parent.ScreenObject.Preferences.SubstituteOnQty&&this.Parent.ScreenObject.GridDataObj.TableColumns.Contains(this.Parent.ScreenObject.Preferences.SubstituteOnQty)){var o=this.Parent.ScreenObject.ColumnSource.find((function(e){return e.DisplayMember.toLowerCase()==a.Parent.ScreenObject.Preferences.SubstituteOnQty.toLowerCase()}));o&&((n=new c.a).Header=o.Header,n.DisplayMember="SubQOH",n.Width=o.Width,n.ReadOnly=!0,this.ColumnSource.push(n),this.GridDataObj.TableColumns.push(n.DisplayMember))}}},{key:"onQtyClick",value:function(){if(null!=this.SelectedRow&&null!=this.SelectedRow.ProductName_Key){this.GridDataObj.TableColumns.Contains("ProductCode")&&(this.ProductCode=this.SelectedRow.ProductCode.toString()),this.GridDataObj.TableColumns.Contains("ProductName")&&(this.ProductName=this.SelectedRow.ProductName.toString()),this.ProductID=this.SelectedRow.ProductName_Key.toString();var e=Date.Today();r.e.IsType(this.Parent,"AddEditDocumentViewModel")&&(e=this.Parent.DocumentDate);var t=i.a.inventory.GetProductQOH(this.ProductID,e,"");if(null!=t&&t.Tables.length>0&&t.Columns[0].Contains("QOH")){this.ProductsGridDataObj.Table=[];for(var n=[],a=0;a<t.Tables[0].Columns.length;a++){if("QOH"==t.Tables[0].Columns[a]){var s=new c.a;s.Header="QOH",s.DisplayMember="QOH",s.DataType="FLOAT",s.ReadOnly=!0,s.Width=75,i.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=i.a.SessionManager.Preferences.DecimalsinQty&&(s.DecimalPoints=i.a.SessionManager.Preferences.DecimalsinQty),this.ProductsGridDataObj.TableColumns.push("QOH"),n.push(s);break}this.ProductsGridDataObj.TableColumns.push(t.Tables[0].Columns[a+1]);var o=new c.a;o.Header=t.Tables[0].Columns[a],o.DisplayMember=t.Tables[0].Columns[a+1],o.DataType="TextBlock",o.ReadOnly=!0,o.Width=150,i.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=i.a.SessionManager.Preferences.DecimalsinQty&&(o.DecimalPoints=i.a.SessionManager.Preferences.DecimalsinQty),n.push(o),a++}this.ProductsGridDataObj.Columns=n;for(var l=0;l<t.Tables[0].length;l++){for(var u=this.ProductsGridDataObj.NewRow(),d=0;d<t.Tables[0].Columns.length;d++){if("QOH"==t.Tables[0].Columns[d]){u.QOH=t.Tables[0][l].QOH.toString();break}u[t.Tables[0].Columns[d+1]]=t.Tables[0][l][t.Tables[0].Columns[d]].toString(),d++}this.ProductsGridDataObj.addRow(u)}}this.AllProducstsVisibility=!1,this.AllLocationVisibility=!0}}},{key:"OnButtonClick",value:function(e){if("Cancel"==e)i.a.page.HideDialog(),null!=this.Parent&&null!=this.Parent.SelectedRow&&(this.Parent.SelectedRow.Subexists="1"),this.Parent.SubDialogResult=!1;else if("onClick"==e);else if("back"==e)this.AllProducstsVisibility=!0,this.AllLocationVisibility=!1;else if("OK"==e)return void this.onClick(this.SelectedRow,!0)}},{key:"FillSalesPurchase",value:function(e,t){this.FillDatarow(e,t,"22821","SellingRate"),this.FillDatarow(e,t,"22793","SellingRateA"),this.FillDatarow(e,t,"22794","SellingRateB"),this.FillDatarow(e,t,"22795","SellingRateC"),this.FillDatarow(e,t,"22796","SellingRateD"),this.FillDatarow(e,t,"22797","SellingRateE"),this.FillDatarow(e,t,"22798","SellingRateF"),this.FillDatarow(e,t,"22799","SellingRateG"),this.FillDatarow(e,t,"22820","PurchaseRate"),this.FillDatarow(e,t,"22786","PurchaseRateA"),this.FillDatarow(e,t,"22787","PurchaseRateB"),this.FillDatarow(e,t,"22788","PurchaseRateC"),this.FillDatarow(e,t,"22789","PurchaseRateD"),this.FillDatarow(e,t,"22790","PurchaseRateE"),this.FillDatarow(e,t,"22791","PurchaseRateF"),this.FillDatarow(e,t,"22792","PurchaseRateG")}},{key:"FillDatarow",value:function(e,t,n,i){var a=this.Parent.ScreenObject.Data.Tables[0];a.length>0&&((a=this.Parent.ScreenObject.Data.Tables[0].filter((function(e){return null!=e.LocalReference&&e.LinkData==n}))).length>0&&this.Parent.ScreenObject.GridDataColumns.Contains(a[0].SysColumnName.toString())&&(r.e.StringIsNullOrEmpty(t[i])?e[a[0].SysColumnName.toString()]=0:e[a[0].SysColumnName.toString()]=t[i].toString()))}},{key:"GridData",get:function(){return this.GridDataObj.Table}},{key:"ColumnSource",get:function(){return this.GridDataObj.Columns}},{key:"SelectedRow",get:function(){return this.GridDataObj.SelectedItem},set:function(e){this.GridDataObj.SelectedItem=e}},{key:"ProductsGridData",get:function(){return this.ProductsGridDataObj.Table}},{key:"ProductsColumnSource",get:function(){return this.ProductsGridDataObj.Columns}}]),n}(s.b)}}]);
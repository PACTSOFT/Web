(window.webpackJsonp=window.webpackJsonp||[]).push([[80],{LOar:function(e,t,o){"use strict";o.r(t),o.d(t,"ACC_CashFlow",(function(){return c}));var s=o("Do2H"),i=o("Lp6j"),l=o("vTM8"),n=o("1xwR"),a=o("mvPR"),h=o("uMy8"),r=o("0/4Q"),d=o("MCLT");class C{}var u=function(e){return e[e.None=0]="None",e[e.MonthWise=1]="MonthWise",e[e.QtrWise=4]="QtrWise",e[e.HalfYearWise=5]="HalfYearWise",e[e.YearWise=3]="YearWise",e[e.TagWise=2]="TagWise",e}({});class c extends n.b{constructor(e){super(e),this.Show=u.None,this.k=0,this.dtMonthBF=null,this.dtMonthTrans=null,this.dtMonthColsing=null,this.colSpanBF=-1,this.colTotalIndex=-1,this.colMonthIndex=-1,this.CntMonths=0,this.YTDIndex=0,this.YTD_LYIndex=0,this.BAL_LYIndex=0,this.ForeignCurrencyID=0,this.CurrencyType=0,this.ShowYearWise=!1,this.AllowFromDateFilter=!1,this.dsYTD=null,this.dsBAL_LY=null,this.dsYTD_LY=null,this.xCFDoc=new i.f,this.dbl=0,this.dblValue=0,this.SectionHeaderAppearance=new a.a,this.SectionHeadingAppearance=new a.a,this.MonthColumns=new Array,this.lstTags=new Array,this.YearSlots=new l.a,this.QtrSlot=new l.a,this.AllMnQtrSlot=new l.a,this.LYTDfldDict=new l.a,this.iLoop=0,this.YearfldDict=new l.a,this.RatioComplete1Promise=[],this.ShowTotal=!1,this.SectionRow=null,this.HeaderRow=null,this.SectionHeaderAppearance.IsBold=!0,this.SectionHeaderAppearance.FontSize=14,this.SectionHeaderAppearance.ForeColor="#FF00465A",this.SectionHeaderAppearance.BackColor="White",this.SectionHeaderAppearance.FontFamilyName="Arial",this.SectionHeadingAppearance.IsBold=!1,this.SectionHeadingAppearance.FontSize=12,this.SectionHeadingAppearance.ForeColor="#FF00465A",this.SectionHeadingAppearance.BackColor="White",this.SectionHeadingAppearance.FontFamilyName="Arial"}LoadReport(){this.GrdRow=-1,this.AggTotal=i.e.NumArray(this.oColumns.length,2);for(let o=0;o<this.ViewModel.ColumnSource.length;o++)if("FLOAT"==this.ViewModel.ColumnSource[o].ColumnType){this.colSpanBF=o;break}for(let o=this.ViewModel.ColumnSource.length-1;o>=0;o--)if("Months"==this.ViewModel.ColumnSource[o].ID){this.colMonthIndex=o;break}let e=new Array;for(let o=0;o<this.ViewModel.ColumnSource.length;o++)e.push(this.ViewModel.ColumnSource[o]);if(this.CntMonths=0,-1!=this.colMonthIndex)if(this.ViewModel.TotalCols.Clear(),this.ViewModel.GrpReportTotal.TotalCols.Clear(),this.ViewModel.AddTotalColumnsToGroup(this.ViewModel.GrpReportTotal,this.ViewModel.ReportDoc.SelectSingleNode("PactRevenURpts/PactRevenURptDef/ReportTotal/Columns")),this.ViewModel.TotalCols.Contains("Months")&&this.ViewModel.TotalCols.Remove("Months"),this.ViewModel.GrpReportTotal.TotalCols.ContainsKey("Months")&&this.ViewModel.GrpReportTotal.TotalCols.Remove("Months"),"1"!=this.ViewModel.Preferences.MonthWiseData)e.RemoveAt(this.colMonthIndex),this.colMonthIndex=-1;else{let t=new Date(this.ViewModel.FromDatePicker.Date.getFullYear(),this.ViewModel.FromDatePicker.Date.getMonth(),1),o=this.ViewModel.ToDatePicker.Date;for(;t<=o;){let o=this.ViewModel.ColumnSource[this.colMonthIndex].Clone();o.ID="Y"+t.getFullYear()+"M"+t.iMonth(),o.HeaderText=t.ToString("MMM yyyy"),e.Insert(this.colMonthIndex+this.CntMonths+1,o),t=t.AddMonths(1),this.ViewModel.TotalCols.push(o.ID),this.ViewModel.GrpReportTotal.TotalCols.push(o.ID,this.colMonthIndex+this.CntMonths),this.MonthColumns.push(o),this.CntMonths++}e.RemoveAt(this.colMonthIndex)}this.YTDIndex=this.YTD_LYIndex=this.BAL_LYIndex=-1;for(let o=e.length-1;o>=0;o--)"Balance"==e[o].ID?this.colTotalIndex=o:"YTD"==e[o].ID?(this.YTDIndex=o,this.LYTDfldDict.push(e[o].ID,null)):"LastYearBalance"==e[o].ID||"LastYearPeriodValue"==e[o].ID?(this.BAL_LYIndex=o,this.LYTDfldDict.push(e[o].ID,null)):"LastYearValue"==e[o].ID?this.LYTDfldDict.push(e[o].ID,null):"LastYearYTD"==e[o].ID&&(this.YTD_LYIndex=o,this.LYTDfldDict.push(e[o].ID,null));this.AggTotal=i.e.NumArray(e.length,2),this.ViewModel.ReportColumns=e,this.oColumns=this.ViewModel.ReportColumns,this.ViewModel.IsTotalColsAdded=!0,this.ViewModel.totals=i.e.NumArray(this.oColumns.length,4),this.dtYearStartMonth=new Date(Date.Today().getFullYear(),s.a.SessionManager.AccountingFromMonth-1,1),this.dtYearStartMonth>Date.Today()&&(this.dtYearStartMonth=this.dtYearStartMonth.AddYears(-1));try{if(this.PDCInclude=!(!this.ViewModel.Preferences.ContainsKey("IncludePDCs")||"1"!=this.ViewModel.Preferences.IncludePDCs),this.IncludeTerminatedPDC=!this.ViewModel.Preferences.ContainsKey("IncludeTerminatedPDC")||"0"!=this.ViewModel.Preferences.IncludeTerminatedPDC,this.UnPostedDocsInclude=!(!this.ViewModel.Preferences.ContainsKey("IncludeUnPostedDocs")||"1"!=this.ViewModel.Preferences.IncludeUnPostedDocs),this.UnPostedDocsList=this.UnPostedDocsInclude&&this.ViewModel.Preferences.ContainsKey("IncludeUnPostedDocsList")?this.ViewModel.Preferences.IncludeUnPostedDocsList:"",this.CurrencyType=0,this.ForeignCurrencyID=0,this.ViewModel.Preferences.ContainsKey("ForeignCurrency")){let e=new i.f;e.LoadXml("<XML>"+this.ViewModel.Preferences.ForeignCurrency+"</XML>");let t=i.f.SelectSingleNode(e.DocumentElement,"IsChecked");null!=t&&"1"==t.innerHTML&&(this.ForeignCurrencyID=parseInt(i.f.SelectSingleNode(e.DocumentElement,"Value").innerHTML))}else if(this.ViewModel.Preferences.ContainsKey("Currency")){let e=new i.f;e.LoadXml("<XML>"+this.ViewModel.Preferences.Currency+"</XML>"),this.CurrencyType=parseInt(i.f.SelectSingleNode(e.DocumentElement,"Type").innerHTML),1==this.CurrencyType?(i.e.IsEmpty(s.a.SessionManager.Preferences.DimensionwiseCurrency)||0==parseInt(s.a.SessionManager.Preferences.DimensionwiseCurrency))&&(this.CurrencyType=0):2==this.CurrencyType&&(this.ForeignCurrencyID=parseInt(i.f.SelectSingleNode(e.DocumentElement,"Value").innerHTML))}if(98==this.ViewModel.StaticReportType){let t="0";if(this.AllowFromDateFilter=!(!this.ViewModel.Preferences.ContainsKey("AllowFromDateFilter")||"1"!=this.ViewModel.Preferences.AllowFromDateFilter),this.AllowFromDateFilter&&this.ViewModel.Preferences.ContainsKey("FinalReportsShow")&&(t=this.ViewModel.Preferences.FinalReportsShow),"1"==t?this.Show=u.MonthWise:"4"==t?this.Show=u.QtrWise:"3"==t&&(this.Show=u.YearWise,this.ViewModel.oReportDialog.FromDate.Date.getFullYear()==this.ViewModel.oReportDialog.ToDate.Date.getFullYear()&&(this.ViewModel.Preferences.ContainsKey("FinalReportsShowPrevMn")||this.ViewModel.Preferences.ContainsKey("FinalReportsShowDifference")||this.ViewModel.Preferences.ContainsKey("FinalReportsShowVarPer")||(this.Show=u.None))),this.dtMain=[],this.dtColumnsMain=[],this.dtColumnsMain.push("RatioName"),this.dtColumnsMain.push("Value"),this.dtColumnsMain.push("Perc"),this.xCFDoc.LoadXml("<RatioAnalysisXml>"+this.ViewModel.Preferences.RatioAnalysisXml+"</RatioAnalysisXml>"),this.Show!=u.None){let t=!(!this.ViewModel.Preferences.ContainsKey("Sort")||"ASC"!=this.ViewModel.Preferences.Sort),o=new Date(this.dtYearStartMonth.getFullYear(),this.dtYearStartMonth.getMonth(),1),i=new Date(this.ViewModel.oReportDialog.FromDate.Date.getFullYear(),this.ViewModel.oReportDialog.FromDate.Date.getMonth(),1),l=1,n=this.Show==u.HalfYearWise?6:3,a="",h=!0,r=e.find(e=>"Value"==e.ID),d=e.indexOf(r),c=0;for(;i<=this.ViewModel.oReportDialog.ToDate.Date;){let D=r.Clone();if(this.Show==u.MonthWise)D.HeaderText=i.ToString("MMM yy"),D.ID="Y"+i.getFullYear()+"M"+i.iMonth(),this.YearSlots.push(D.ID,i);else if(this.Show==u.QtrWise||this.Show==u.HalfYearWise){if(h){for(i=new Date(this.ViewModel.FromDatePicker.Date.getFullYear(),s.a.SessionManager.AccountingFromMonth-1,1),i>this.ViewModel.FromDatePicker.Date&&(i=i.AddYears(-1)),l=1;i.AddMonths(n)<=this.ViewModel.FromDatePicker.Date;)l++,i=i.AddMonths(n);a=1==s.a.SessionManager.AccountingFromMonth?i.getFullYear().toString():i.iMonth()>=s.a.SessionManager.AccountingFromMonth?i.getFullYear().toString()+"-"+((i.getFullYear()+1)%100).toString():(i.getFullYear()-1).toString()+"-"+(i.getFullYear()%100).toString()}else l++,(this.Show==u.QtrWise&&5==l||this.Show==u.HalfYearWise&&3==l)&&(l=1),a=1==s.a.SessionManager.AccountingFromMonth?i.getFullYear().toString():i.iMonth()>=s.a.SessionManager.AccountingFromMonth?i.getFullYear().toString()+"-"+((i.getFullYear()+1)%100).toString():(i.getFullYear()-1).toString()+"-"+(i.getFullYear()%100).toString();D.HeaderText=(this.Show==u.HalfYearWise?"H":"Q")+l+" "+a,D.ID="Y"+i.getFullYear()+"M"+i.iMonth(),this.YearSlots.push(D.ID,i),h=!1;let e=new C;e.dtStart=i,e.dtEnd=i.AddMonths(n).AddDays(-1),this.QtrSlot.push(D.ID,e);let t=i;for(let o=0;o<n;o++)this.AllMnQtrSlot.push(t.ToString("yyyy-M"),D.ID),t=t.AddMonths(1)}else D.HeaderText=i.ToString("yyyy"),D.ID="Y"+i.getFullYear(),this.YearSlots.push(D.ID,o),o=o.AddYears(1);this.lstTags.push(D.ID),this.dtColumnsMain.push(D.ID),++c,e.Insert(t?d+c:d+1,D),i=this.Show==u.MonthWise?i.AddMonths(1):this.Show==u.QtrWise||this.Show==u.HalfYearWise?i.AddMonths(n):i.AddYears(1)}}else if(!this.AllowFromDateFilter&&this.ViewModel.Preferences.ContainsKey("ShowYearWise")){let t=new i.f;t.LoadXml("<XML>"+this.ViewModel.Preferences.ShowYearWise+"</XML>");let o=i.f.SelectSingleNode(t.DocumentElement,"IsChecked");if(null!=o&&"1"==o.innerHTML&&(this.ShowYearWise=!0,o=i.f.SelectSingleNode(t.DocumentElement,"Text"),this.CntMonths=i.e.Int(o.innerHTML),this.CntMonths<=0&&(this.ShowYearWise=!1),this.ShowYearWise)){let t=e.find(e=>"Value"==e.ID),o=e.indexOf(t);e.Remove(t);let i=new Date(Date.Today().getFullYear(),s.a.SessionManager.AccountingFromMonth-1,1);i>Date.Today()&&(i=i.AddYears(-1));let l=!(!this.ViewModel.Preferences.ContainsKey("Sort")||"ASC"!=this.ViewModel.Preferences.Sort);for(let s=0;s<this.CntMonths;s++){let s=t.Clone();s.HeaderText=i.ToString("yyyy"),s.ID=i.getFullYear().toString(),this.lstTags.push(s.ID),this.dtColumnsMain.push(s.ID),l?e.Insert(o,s):e.push(s),i=i.AddYears(-1)}this.ViewModel.ReportColumns=new Array,this.ViewModel.ReportColumns=e,this.oColumns=this.ViewModel.ReportColumns}}this.ViewModel.ReportColumns=e,this.oColumns=this.ViewModel.ReportColumns,this.eval=new h.b,this.fldDict=new l.a,this.YearfldDict.Clear(),this.iLoop=0;let o=i.f.SelectSingleNode(this.xCFDoc.DocumentElement,"VariablesList");this.xVarListMain=o.childNodes,this.Show!=u.None?(this.lstTags.forEach(e=>{this.YearfldDict.push(e,new l.a)}),this.YearfldDict.push("Value",new l.a),this.RatioCallBack_NotNone()):this.ShowYearWise?(this.lstTags.forEach(e=>{this.YearfldDict.push(e,new l.a)}),this.RatioCallBack_Year()):this.RatioCallBack_None()}else if(99==this.ViewModel.StaticReportType){let e;this.xCFDoc.LoadXml("<CashFlowXml>"+this.ViewModel.Preferences.CashFlowXml+"</CashFlowXml>"),this.ChunkSize=this.ViewModel.Preferences.ContainsKey("ChunkSize")?parseInt(this.ViewModel.Preferences.ChunkSize):1;let t="",o="",n=new Array,a=new Array;this.xCFDoc.DocumentElement.childNodes.forEach(s=>{for(let i=0;i<s.childNodes.length;i++)e=s.childNodes[i],"Group"==e.attributes.Type.value?a.Contains(e.attributes.ACC.value)||(t.length>0&&(t+=","),t+=e.attributes.ACC.value,a.push(e.attributes.ACC.value)):"Account"==e.attributes.Type.value&&(n.Contains(e.attributes.ACC.value)||(o.length>0&&(o+=","),o+=e.attributes.ACC.value,n.push(e.attributes.ACC.value)))});let h=[];h.push(this.ViewModel.oReportDialog.FromDate.Date),h.push(this.ViewModel.oReportDialog.ToDate.Date),h.push(this.UnPostedDocsInclude),h.push(this.PDCInclude),h.push(this.IncludeTerminatedPDC),h.push(t.toString()),h.push(o.toString()),h.push(-1!=this.colMonthIndex),"1"==this.ViewModel.Preferences.ShowProjections&&this.ViewModel.Preferences.ContainsKey("Documents")?h.push(this.ViewModel.Preferences.Documents):h.push("");let r="";this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(r=i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?" AND 1<>1":" AND DCC.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+")"),h.push(r+this.GetDimensionFilter("DCC.dcCCNID")),h.push(s.a.SessionManager.LanguageID);let d=new l.a;if(d.push("ds",s.a.report.GetCashFlow(h)),-1!=this.YTDIndex){let e=h.Copy();e[0]=this.dtYearStartMonth,e[6]=!1,d.push("dsYTD",s.a.report.GetCashFlow(e))}if(-1!=this.BAL_LYIndex){let e=h.Copy();e[0]=this.ViewModel.oReportDialog.FromDate.Date.AddYears(-1),e[1]=this.ViewModel.oReportDialog.ToDate.Date.AddYears(-1),e[6]=!1,d.push("dsBAL_LY",s.a.report.GetCashFlow(e))}if(-1!=this.YTD_LYIndex){let e=h.Copy();e[0]=this.dtYearStartMonth.AddYears(-1),e[1]=this.ViewModel.oReportDialog.ToDate.Date.AddYears(-1),e[6]=!1,d.push("dsYTD_LY",s.a.report.GetCashFlow(e))}Promise.all(d.values).then(e=>{let t;this.ds=e[0],this.dvAcc=this.dvAccTable=this.ds.Tables[0],this.dvAccColumns=this.ds.Columns[0],this.dvGroup=this.dvGroupTable=this.ds.Tables[1],this.dvGroupColumns=this.ds.Columns[1],-1!=this.YTDIndex&&(t=d.keys.indexOf("dsYTD"),this.dsYTD=e[t],this.ds.Columns[0].push("YTD"),this.ds.Columns[1].push("YTD")),-1!=this.BAL_LYIndex&&(t=d.keys.indexOf("dsBAL_LY"),this.dsBAL_LY=e[t],this.ds.Columns[0].push("LastYearBalance"),this.ds.Columns[1].push("LastYearBalance")),-1!=this.YTD_LYIndex&&(t=d.keys.indexOf("dsYTD_LY"),this.dsYTD_LY=e[t],this.ds.Columns[0].push("LastYearYTD"),this.ds.Columns[1].push("LastYearYTD")),this.AddMonthColumns(this.ds.Tables[0],this.ds.Columns[0]),this.AddMonthColumns(this.ds.Tables[1],this.ds.Columns[1]),this.dvBills=this.dvPaymentTerms=null,this.ds.Tables.length>=4&&(this.dvBills=this.dvBillsTable=this.ds.Tables[2],this.dvPaymentTerms=this.dvPaymentTermsTable=this.ds.Tables[3]),this.xCFDoc.DocumentElement.childNodes.forEach(e=>{this.AddRows(e)}),this.AddSectionHeadingTotal(1,!0),this.ViewModel.Preferences.ContainsKey("DontShowCashFlowData")&&"1"==this.ViewModel.Preferences.DontShowCashFlowData?this.ViewModel.process_RunWorkerCompleted():this.GetCashFlowData(r).then(e=>{let t=e.Tables[0];this.dtMonthBF=this.dtMonthTrans=this.dtMonthColsing=null,-1!=this.colMonthIndex&&(this.dtMonthBF=t.ToTable(!0,["AccountID","Particulars"]),this.dtMonthTrans=this.dtMonthBF.Copy(),this.dtMonthColsing=this.dtMonthBF.Copy()),this.AddCFBalance(t,this.dtMonthTrans,"Trans","Change In Cash / Bank / BankCC"),this.AddCFBalance(t,this.dtMonthBF,"Opening","Opening"),this.AddCFBalance(t,this.dtMonthColsing,"Closing","Closing"),this.ViewModel.process_RunWorkerCompleted()})})}}catch(t){return void Logger.ErrorLog("ACC_CashFlow::Error LoadReport ",t)}}RatioCallBack_None(){if(this.iLoop>=this.xVarListMain.length)return void this.RatioCallBack_Complete1();let e=this.xVarListMain[this.iLoop],t=new h.c;t.setFieldDetails(e.attributes.Name.value,2,1,"",1,!1,!1),i.f.SelectSingleNode(e,"Nodes"),this.GetVariableValue(e).then(o=>{t.setFieldValue(null!=o?parseFloat(o[0].Balance):0),this.fldDict.push(e.attributes.Name.value,t),this.iLoop++,this.RatioCallBack_None()})}RatioCallBack_NotNone(){if(this.iLoop>=this.xVarListMain.length)return void this.RatioCallBack_Complete1();let e=this.xVarListMain[this.iLoop];i.f.SelectSingleNode(e,"Nodes").innerHTML.length>0&&this.GetVariableValue(e).then(t=>{this.dbl=0;let o=new h.c;o.setFieldDetails(e.attributes.Name.value,2,1,"",0,!1,!1),this.YearfldDict.Value.push(e.attributes.Name.value,o);let s=null!=i.f.SelectSingleNode(e,"CurrentYear")?parseInt(i.f.SelectSingleNode(e,"CurrentYear").innerHTML):0;if(t&&t.length>0){let e=t.Compute("sum(Balance)","");null!=e&&o.setFieldValue(parseFloat(e)),this.Show==u.QtrWise?(t.Columns.push("Tag"),t.forEach(e=>{this.AllMnQtrSlot.ContainsKey(e.YrMn.toString())?e.Tag=this.AllMnQtrSlot[e.YrMn.toString()]:0==s&&(this.dbl+=parseFloat(e.Balance))})):0==s&&t.forEach(e=>{this.lstTags.Contains(e.Tag.toString())||(this.dbl+=parseFloat(e.Balance))})}for(let i=0;i<this.lstTags.length;i++){1==s&&(this.dbl=0);let o=new h.c;if(o.setFieldDetails(e.attributes.Name.value,2,1,"",1,!1,!1),this.YearfldDict[this.lstTags[i]].push(e.attributes.Name.value,o),t){let e=t.filter(e=>e.Tag==this.lstTags[i]);e.length>0&&(this.Show==u.QtrWise?e.forEach(e=>{null!=e.Balance&&(this.dbl+=parseFloat(e.Balance))}):null!=e[0].Balance&&(this.dbl+=parseFloat(e[0].Balance)))}o.setFieldValue(this.dbl)}this.iLoop++,this.RatioCallBack_NotNone()})}RatioCallBack_Year(){if(this.iLoop>=this.xVarListMain.length)return void this.RatioCallBack_Complete1();let e=this.xVarListMain[this.iLoop];if(this.lstTags.length>0){let t=i.f.SelectSingleNode(e,"Nodes"),o=new h.c;o.setFieldDetails(e.attributes.Name.value,2,1,"",1,!1,!1),this.YearfldDict[this.lstTags[0]].push(e.attributes.Name.value,o),t.innerHTML.length>0&&this.GetVariableValue(e).then(e=>{if(null!=e){let t=e.filter(e=>e.Tag==this.lstTags[0]);o.setFieldValue(t.length>0&&null!=t[0].Balance?parseFloat(t[0].Balance):0)}})}for(let t=1;t<this.lstTags.length;t++){let o=new h.c;o.setFieldDetails(e.attributes.Name.value,2,1,"",1,!1,!1),this.YearfldDict[this.lstTags[t]].push(e.attributes.Name.value,o),o.setFieldValue(0)}this.iLoop++,this.RatioCallBack_Year()}RatioCallBack_Complete1(){this.RatioComplete1Promise=[],this.LYTDfldDict.keys.forEach(e=>{this.dtColumnsMain.push(e),this.LYTDfldDict[e]=this.SetRationVariables(this.xVarListMain,e)}),Promise.all(this.RatioComplete1Promise).then(e=>{this.RatioCallBack_Complete2()})}RatioCallBack_Complete2(){let e=this.fldDict,t=this.ViewModel.oReportDialog.DefaultProperties.find(e=>e instanceof r.b&&"RatioList"==e.DBColumnName);for(i.f.SelectSingleNode(this.xCFDoc.DocumentElement,"RatiosList").childNodes.forEach(o=>{if(t.Items[0].IsChecked||t.Items.filter(e=>e.Name==o.attributes.Name.value&&e.IsChecked).length>0){let t={};if(t.RatioName=o.attributes.Name.value,null!=o.attributes.Perc&&(t.Perc="1"),o.attributes.Formula.value.length>0)try{this.Show!=u.None||this.ShowYearWise?this.YearfldDict.forEach(s=>{e=s.Value,t[s.Key]=this.eval.EvaluateExpression(o.attributes.Formula.value,e).toString()}):t.Value=this.eval.EvaluateExpression(o.attributes.Formula.value,e).toString(),this.LYTDfldDict.keys.forEach(s=>{e=this.LYTDfldDict[s],t[s]=this.eval.EvaluateExpression(o.attributes.Formula.value,e).toString()})}catch(s){}this.dtMain.push(t)}}),this.ViewModel.ReportData=this.dtMain,this.ViewModel.ReportDataColumns=this.dtColumnsMain,this.ViewModel.ConstructFormulaFields(!0),this.k=0;this.k<this.dtMain.length;this.k++){this.row=this.NewReportRow();for(let e=0;e<this.oColumns.length;e++)this.dtColumnsMain.Contains(this.oColumns[e].ID)&&(this.ViewModel.SetCellValue(this.dtMain[this.k][this.oColumns[e].ID],this.oColumns[e].DataFormat,this.oColumns[e].ColumnType,this.row.Cells[e]),e>0&&null!=this.dtMain[this.k].Perc&&!i.e.IsEmptySpace(this.row.Cells[e].Text)&&(this.row.Cells[e].Text=this.row.Cells[e].Text+"%"));this.ViewModel.addRow(this.row)}this.ViewModel.process_RunWorkerCompleted()}LoadReportWithPostFilters(e){}GetCashFlowData(e){let t,o,i="",l="",n="",a="",h="",r="",d="",C="",u="";this.ForeignCurrencyID>0?(t="AmountFC",o=" AND ACC.CurrencyID="+this.ForeignCurrencyID):(t=1==this.CurrencyType?"AmountBC":"Amount",o="");let c=this.GetDimensionFilter("DCC.dcCCNID");if((e.length>0||c.length>0)&&(l=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.AccDocDetailsID=ACC.AccDocDetailsID "+c+e,n=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=ACC.InvDocDetailsID "+c+e),-1!=this.colMonthIndex&&(r=",'Y'+CONVERT(NVARCHAR,yy)+'M'+ CONVERT(NVARCHAR,mm) Mn",d=",0 yy, 0 mm",C=",yy,mm",u=",YEAR(ACC.DocDate) yy, MONTH(ACC.DocDate) mm"),h="DocDate<@From",this.PDCInclude){let e="(ACC.StatusID=370 OR ACC.StatusID=439"+(this.IncludeTerminatedPDC?" OR ACC.StatusID=452":"")+")";this.UnPostedDocsInclude?(a=" AND ACC.DocumentType<>16 AND (\n"+e+" OR (ACC.DocumentType<>14 AND ACC.DocumentType<>19))",h+=" AND ("+e+" OR (ACC.DocumentType<>14 AND ACC.DocumentType<>19))"):(a=" AND ACC.DocumentType<>16 AND (\n"+e+" OR (ACC.DocumentType<>14 AND ACC.DocumentType<>19 AND (ACC.StatusID=369 or ACC.StatusID=429)))",h+=" AND ("+e+" OR (ACC.DocumentType<>14 AND ACC.DocumentType<>19 AND (ACC.StatusID=369 or ACC.StatusID=429)))")}else a=" AND ACC.DocumentType NOT IN (16,14,19)",h+=" AND ACC.DocumentType<>14 AND ACC.DocumentType<>19",this.UnPostedDocsInclude||(a+=" AND (ACC.StatusID=369 or ACC.StatusID=429)",h+=" AND (ACC.StatusID=369 or ACC.StatusID=429)");return i+="DECLARE @From FLOAT,@To FLOAT,@AccountID BIGINT\nSET @From=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"'))\nSET @To=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))\n\nSELECT A.AccountID,MAX(A.AccountName) Particulars,SUM(OP_Dr)-SUM(OP_Cr) Opening,SUM(TR_Dr)-SUM(TR_Cr) Trans"+r+"\nFROM (",i+="\n--Opening Dr\nSELECT DebitAccount AccountID"+d+",ACC."+t+" OP_Dr,0 OP_Cr,0 TR_Dr,0 TR_Cr\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+l+"\nWHERE (ACC.DocumentType=16 OR ("+h+"))"+o+"\nUNION ALL--Opening Cr\nSELECT CreditAccount AccountID"+d+",0 OP_Dr,ACC."+t+" OP_Cr,0 TR_Dr, 0 TR_Cr\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+l+"\nWHERE (ACC.DocumentType=16 OR ("+h+"))"+o+"\nUNION ALL--Transaction Dr\nSELECT DebitAccount AccountID"+u+",0 OP_Dr,0 OP_Cr,"+t+" TR_Dr,0 TR_Cr\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+l+"\nWHERE (DocDate BETWEEN @From AND @To)"+a+o+"\nUNION ALL--Transaction Cr\nSELECT CreditAccount AccountID"+u+",0 OP_Dr,0 OP_Cr,0 TR_Dr,"+t+" TR_Cr\nFROM ACC_DocDetails ACC  WITH(NOLOCK)"+l+"\nWHERE (DocDate BETWEEN @From AND @To)"+a+o,n.length>0&&(i+="\n--INEVENTORY DATA\nUNION ALL--Opening Dr\nSELECT DebitAccount AccountID"+d+",ACC."+t+" OP_Dr,0 OP_Cr,0 TR_Dr,0 TR_Cr\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+n+"\nWHERE (ACC.DocumentType=16 OR ("+h+"))"+o+"\nUNION ALL--Opening Cr\nSELECT CreditAccount AccountID"+d+",0 OP_Dr,ACC."+t+" OP_Cr,0 TR_Dr, 0 TR_Cr\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+n+"\nWHERE (ACC.DocumentType=16 OR ("+h+"))"+o+"\nUNION ALL--Transaction Dr\nSELECT DebitAccount AccountID"+u+",0 OP_Dr,0 OP_Cr, "+t+" TR_Dr,0 TR_Cr\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+n+"\nWHERE (DocDate BETWEEN @From AND @To)"+a+o+"\nUNION ALL--Transaction Cr\nSELECT CreditAccount AccountID"+u+",0 OP_Dr,0 OP_Cr,0 TR_Dr, "+t+" TR_Cr\nFROM ACC_DocDetails ACC  WITH(NOLOCK)"+n+"\nWHERE (DocDate BETWEEN @From AND @To)"+a+o),i+=") AS ACC INNER JOIN ACC_Accounts A WITH(NOLOCK) ON A.AccountID=ACC.AccountID\nGROUP BY A.AccountTypeID,A.AccountID,A.IsGroup,A.TB_INT"+C+"\nHAVING A.AccountID>1",i+=" AND A.AccountTypeID IN (1,2,3) AND A.IsGroup=0",i+=" Order By A.AccountTypeID,Particulars",s.a.report.ReportDataSetAsync("RPT022",this.ViewModel.IsReportDB,i.toString())}AddMonthColumns(e,t){let o=new Date(this.ViewModel.FromDatePicker.Date.getFullYear(),this.ViewModel.FromDatePicker.Date.getMonth(),1),s=this.ViewModel.ToDatePicker.Date;for(;o<=s;)t.push("Y"+o.getFullYear()+"M"+o.iMonth()),o=o.AddMonths(1)}AddRows(e){if(0==e.childNodes.length)return;let t;this.row=this.NewReportRow_2(a.f.Header,this.SectionHeaderAppearance),this.row.LevelNo=1,this.row.IsGroup=!0,this.row.IsExpanded=!0,this.row.Cells[0].Text=e.attributes.Caption.value,this.row.Cells[0].ColSpan=this.oColumns.length,this.SectionRow=this.row,this.ViewModel.addRow(this.row),this.ShowTotal=!1;let o,s,l,n,h,r,d,C,u,c=0;this.HeaderRow=null;for(let D=0;D<e.childNodes.length;D++)if(t=e.childNodes[D],"Heading"==t.attributes.Type.value)this.AddSectionHeadingTotal(3,this.ShowTotal),this.row=this.NewReportRow_2(a.f.SubReportHeader,this.GrossTotalAppearance),this.row.IsGroup=!0,this.row.IsExpanded=!0,this.row.LevelNo=2,this.row.Parent=this.SectionRow,this.HeaderRow=this.row,this.row.Cells[0].Text="  "+t.attributes.Heading.value,this.row.Cells[0].ColSpan=this.oColumns.length,this.ViewModel.addRow(this.row),this.ShowTotal="1"==t.attributes.Total.value;else{if(this.row=this.NewReportRow(),this.row.LevelNo=3,this.row.Parent=null==this.HeaderRow?this.SectionRow:this.HeaderRow,l=t.attributes.ACC.value,this.row.NodeID=parseInt(l),"Group"==t.attributes.Type.value?(u=1,h=r=this.dvGroup,d=this.dvGroupColumns):(u=0,h=r=this.dvAcc,d=this.dvAccColumns),h=r.filter(e=>e.AccountID==l),h.length>0){if(c=0,null!=this.dvBills){this.dvBills=this.dvBillsTable.filter(e=>e.AccountID==l);for(let e=0;e<this.dvBills.length;e++)this.dvPaymentTerms=this.dvPaymentTermsTable.filter(t=>t.VoucherNo==this.dvBills[e].DocNo),this.dvPaymentTerms.length>0?(o=Math.abs(parseFloat(this.dvBills[e].Paid)),s=parseFloat(this.dvBills[e].Amount),this.dvPaymentTerms.forEach(e=>{this.dbl=parseFloat(e.Amount),C=new Date(e.DueDate),this.dbl=this.dbl-o,this.dbl<0?o=-this.dbl:this.dbl>0?(o=0,s<0&&(this.dbl=-this.dbl),-1!=this.colMonthIndex?(n="Y"+C.getFullYear()+"M"+C.iMonth(),d.Contains(n)&&(this.dblValue=i.e.Double(h[0][n]),h[0][n]=this.dblValue+this.dbl),c+=this.dbl):(this.dblValue=i.e.Double(h[0].Balance),h[0].Balance=this.dblValue+this.dbl)):o=0})):(C=new Date(this.dvBills[e].DocDate),this.dblValue=parseFloat(this.dvBills[e].Amount)+parseFloat(this.dvBills[e].Paid),-1!=this.colMonthIndex?(n="Y"+C.getFullYear()+"M"+C.iMonth(),d.Contains(n)&&(i.e.Double(h[0][n]),h[0][n]=this.dbl+this.dblValue),c+=this.dblValue):(this.dbl=i.e.Double(h[0].Balance),h[0].Balance=this.dbl+this.dblValue))}if(-1!=this.colMonthIndex){let e=0;for(n=i.e.String(h[0].Mn),n.length>0&&(e=parseFloat(h[0].Balance),h[0][n]=h[0].Balance);h.length>1;)n=i.e.String(h[1].Mn),n.length>0&&(e+=parseFloat(h[1].Balance),h[0][n]=h[1].Balance),r.Remove(h[1]),h.Remove(h[1]);h[0].Balance=e+c}if(-1!=this.YTDIndex){let e=this.dsYTD.Tables[u].filter(e=>e.AccountID==l);e.length>0&&(h[0].YTD=e[0].Balance)}if(-1!=this.BAL_LYIndex){let e=this.dsBAL_LY.Tables[u].filter(e=>e.AccountID==l);e.length>0&&(h[0].LastYearBalance=e[0].Balance)}if(-1!=this.YTD_LYIndex){let e=this.dsYTD_LY.Tables[u].filter(e=>e.AccountID==l);e.length>0&&(h[0].LastYearYTD=e[0].Balance)}for(let e=0;e<this.oColumns.length;e++)this.CellValue=null,d.Contains(this.oColumns[e].ID)&&(this.CellValue=h[this.k][this.oColumns[e].ID]),null!=this.CellValue&&(0==e&&(this.CellValue="    "+this.CellValue.toString()),this.ViewModel.SetCellValue(this.CellValue,this.oColumns[e].DataFormat,this.oColumns[e].ColumnType,this.row.Cells[e]),i.e.IsNum(this.CellValue)&&(this.dbl=i.e.Double(this.CellValue),this.ViewModel.totals[e][3]+=this.dbl))}this.ViewModel.ApplyKPI(this.row),this.ViewModel.addRow(this.row)}this.AddSectionHeadingTotal(3,this.ShowTotal),this.AddSectionHeadingTotal(2,!0)}AddSectionHeadingTotal(e,t){if(t){let t="";for(let o=0;o<e-1;o++)t+="  ";3==e?(this.row=this.NewReportRow_2(a.f.ReportTotal,this.BalanceBFAppearance_Data),this.row.Parent=null==this.HeaderRow?this.SectionRow:this.HeaderRow,this.row.Cells[0].Text=t+"Total"):2==e?(this.row=this.NewReportRow_2(a.f.ReportTotal,this.GrossTotalAppearance_Data),this.row.Parent=this.SectionRow,this.row.Cells[0].Text=t+"TOTAL"):(this.row=this.NewReportRow_2(a.f.SubTotal,this.ViewModel.GrpReportTotal.SubTotalAppearance_Data),this.row.Cells[0].Text=t+this.ViewModel.GrpReportTotal.SubTotalPrefix[0]),this.row.LevelNo=e-1,this.row.Cells[0].CellAppearance.Alignment="Left";for(let o=0;o<this.oColumns.length;o++)this.ViewModel.GrpReportTotal.TotalCols.ContainsKey(this.oColumns[o].ID)&&this.ViewModel.SetCellValue(this.ViewModel.totals[o][e],this.oColumns[o].DataFormat,"FLOAT",this.row.Cells[o]),this.ViewModel.totals[o][e-1]+=this.ViewModel.totals[o][e],this.ViewModel.totals[o][e]=0;this.ViewModel.addRow(this.row)}else for(let o=0;o<this.oColumns.length;o++)this.ViewModel.totals[o][e-1]+=this.ViewModel.totals[o][e],this.ViewModel.totals[o][e]=0}AddCFBalance(e,t,o,s){this.row=this.NewReportRow_2(a.f.SubReportHeader,this.GrossTotalAppearance),this.row.IsGroup=!0,this.row.IsExpanded=!0,this.row.LevelNo=1,this.HeaderRow=this.row,this.row.Cells[0].Text=s,this.row.Cells[0].ColSpan=this.oColumns.length,this.ViewModel.addRow(this.row);let l=-1,n=-1;for(let i=0;i<this.oColumns.length;i++)"Particulars"==this.oColumns[i].ID?l=i:"Balance"==this.oColumns[i].ID&&(n=i);if(-1==this.colMonthIndex)for(this.k=0;this.k<e.length;this.k++)this.row=this.NewReportRow(),this.row.LevelNo=3,this.row.Parent=this.HeaderRow,-1!=l&&this.ViewModel.SetCellValue(e[this.k].Particulars,this.oColumns[l].DataFormat,this.oColumns[l].ColumnType,this.row.Cells[l]),-1!=n&&this.ViewModel.SetCellValue("Closing"==o?parseFloat(e[this.k].Opening)+parseFloat(e[this.k].Trans):e[this.k][o],this.oColumns[n].DataFormat,this.oColumns[n].ColumnType,this.row.Cells[n]),this.ViewModel.addRow(this.row);else{let s;if("Trans"==o)for(this.k=0;this.k<t.length;this.k++){let o=e.filter(e=>e.AccountID==t[this.k].AccountID);this.dbl=0,o.forEach(e=>{s=e.Mn.toString(),"Y0M0"!=s&&(t[this.k][e.Mn.toString()]=e.Trans,this.dbl+=parseFloat(e.Trans))}),t[this.k].Balance=this.dbl,this.row=this.NewReportRow(),this.row.LevelNo=3,this.row.Parent=this.HeaderRow,this.row.NodeID=parseInt(t[this.k].AccountID);for(let e=0;e<this.oColumns.length;e++)this.CellValue=null,Object(d.isUndefined)(t[this.k][this.oColumns[e].ID])||(this.CellValue=t[this.k][this.oColumns[e].ID]),null!=this.CellValue&&this.ViewModel.SetCellValue(this.CellValue,this.oColumns[e].DataFormat,this.oColumns[e].ColumnType,this.row.Cells[e]);this.ViewModel.addRow(this.row)}else if("Opening"==o)for(this.k=0;this.k<t.length;this.k++){let o=e.filter(e=>e.AccountID==t[this.k].AccountID&&"Y0M0"==e.Mn);this.dbl=0,o.length>0&&(this.dbl=parseFloat(o[0].Opening)),t[this.k][this.oColumns[this.colMonthIndex].ID]=this.dbl;for(let e=0;e<this.CntMonths-1;e++)this.dblValue=i.e.Double(this.dtMonthTrans[this.k][this.oColumns[this.colMonthIndex+e].ID]),this.dbl+=this.dblValue,t[this.k][this.oColumns[this.colMonthIndex+e+1].ID]=this.dbl;t[this.k].Balance=this.dbl,this.row=this.NewReportRow(),this.row.LevelNo=3,this.row.Parent=this.HeaderRow,this.row.NodeID=parseInt(t[this.k].AccountID);for(let e=0;e<this.oColumns.length;e++)this.CellValue=null,Object(d.isUndefined)(t[this.k][this.oColumns[e].ID])||(this.CellValue=t[this.k][this.oColumns[e].ID]),null!=this.CellValue&&this.ViewModel.SetCellValue(this.CellValue,this.oColumns[e].DataFormat,this.oColumns[e].ColumnType,this.row.Cells[e]);this.ViewModel.addRow(this.row)}else if("Closing"==o)for(this.k=0;this.k<t.length;this.k++){this.dbl=0;for(let e=0;e<this.CntMonths;e++)this.dbl=i.e.Double(this.dtMonthBF[this.k][this.oColumns[this.colMonthIndex+e].ID]),this.dblValue=i.e.Double(this.dtMonthTrans[this.k][this.oColumns[this.colMonthIndex+e].ID]),this.dbl=this.dbl+this.dblValue,t[this.k][this.oColumns[this.colMonthIndex+e].ID]=this.dbl;t[this.k].Balance=this.dbl,this.row=this.NewReportRow(),this.row.LevelNo=3,this.row.Parent=this.HeaderRow,this.row.NodeID=parseInt(t[this.k].AccountID);for(let e=0;e<this.oColumns.length;e++)this.CellValue=null,Object(d.isUndefined)(t[this.k][this.oColumns[e].ID])||(this.CellValue=t[this.k][this.oColumns[e].ID]),null!=this.CellValue&&this.ViewModel.SetCellValue(this.CellValue,this.oColumns[e].DataFormat,this.oColumns[e].ColumnType,this.row.Cells[e]);this.ViewModel.addRow(this.row)}}}SetRationVariables(e,t){let o=new l.a;return e.forEach(e=>{if(i.f.SelectSingleNode(e,"Nodes").innerHTML.length>0){let s=this.GetVariableValue(e,t).then(t=>{let s=0,i=new h.c;i.setFieldDetails(e.attributes.Name.value,2,1,"",1,!1,!1),o.push(e.attributes.Name.value,i),null!=t&&t.length>0&&(s=parseFloat(t[0].Balance)),i.setFieldValue(s)});this.RatioComplete1Promise.push(s)}else{let t=new h.c;t.setFieldDetails(e.attributes.Name.value,2,1,"",1,!1,!1),o.push(e.attributes.Name.value,t),t.setFieldValue(0)}}),o}GetVariableValue(e,t=""){let o="",l=e.attributes.Name.value.toLowerCase();if("openingstock"==l||"closingstock"==l){let t="";if(this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(t=i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?"-1":this.ViewModel.oReportDialog.LocationWhere),"OpeningStock"==e.attributes.Name.value)return s.a.report.GetStockBalance(1,t,this.ViewModel.oReportDialog.FromDate.Date,this.ViewModel.oReportDialog.ToDate.Date,this.UnPostedDocsInclude,this.CurrencyType,this.ForeignCurrencyID,this.ViewModel.IsReportDB).then(e=>{let t=e,o=[];return o.push({}),o[0].Balance=t,o});if("ClosingStock"==e.attributes.Name.value)return s.a.report.GetStockBalance(0,t,this.ViewModel.oReportDialog.FromDate.Date,this.ViewModel.oReportDialog.ToDate.Date,this.UnPostedDocsInclude,this.CurrencyType,this.ForeignCurrencyID,this.ViewModel.IsReportDB).then(e=>{let t=e,o=[];return o.push({}),o[0].Balance=t,o})}else"grossprofit"==l?o="4,5,8,9":"netprofit"==l&&(o="4,5,8,9,11,12");let n="",a=i.f.SelectSingleNode(e,"Nodes");if(0==a.innerHTML.length&&0==o.length)return null;let h,r,d=a.innerHTML,C=null!=i.f.SelectSingleNode(e,"GroupNodesExists"),c=null!=i.f.SelectSingleNode(e,"CurrentYear")?parseInt(i.f.SelectSingleNode(e,"CurrentYear").innerHTML):0,D="",T="",A="";this.ForeignCurrencyID>0?(h="AmountFC",r=" AND ACC.CurrencyID="+this.ForeignCurrencyID):(h=1==this.CurrencyType?"AmountBC":"Amount",r="");let w=this.GetDimensionFilter("DCC.dcCCNID"),M="";this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(M=i.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?" AND 1<>1":" AND DCC.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+")"),(M.length>0||w.length>0)&&(D=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.AccDocDetailsID=ACC.AccDocDetailsID",T=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=ACC.InvDocDetailsID");let p="";0==this.UnPostedDocsList.length?p=" AND (ACC.StatusID=369 or ACC.StatusID=429)":p+=" AND ACC.StatusID IN (369,429,"+this.UnPostedDocsList+")",A=this.PDCInclude?" AND ((ACC.StatusID=370 OR ACC.StatusID=439"+(this.IncludeTerminatedPDC?" OR ACC.StatusID=452":"")+") OR (ACC.DocumentType<>14 AND ACC.DocumentType<>19"+p+"))":" AND ACC.DocumentType NOT IN (14,19)"+p;let m="";m=c>0||this.ShowYearWise||t.length>0||o.length>0?"(DocDate BETWEEN @From AND @To)":"(DocDate<=@To)",m+=w+M;let I="",g="",R="";o.length>0?(I="-",g=" join ACC_Accounts AT on AT.AccountID=T1.AccountID",R="AT.AccountTypeID IN ("+o+")"):C?(R="T1.AccountID=GTP.GTID",g=d.Contains(",")?",(select T.AccountID GTID from ACC_Accounts T with(nolock),ACC_Accounts GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.AccountID IN ("+d+") group by T.AccountID) AS GTP ":",(select T.AccountID GTID from ACC_Accounts T with(nolock),ACC_Accounts GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.AccountID="+d+" group by T.AccountID) AS GTP "):R=d.Contains(",")?"T1.AccountID IN ("+d+")":"T1.AccountID="+d;let S="",V="",N=new Date(this.ViewModel.oReportDialog.ToDate.Date.getFullYear(),s.a.SessionManager.AccountingFromMonth-1,1);N>this.ViewModel.oReportDialog.ToDate.Date&&(N=N.AddYears(-1));let f=this.AllowFromDateFilter?this.ViewModel.oReportDialog.FromDate.Date:N,F=this.ViewModel.oReportDialog.ToDate.Date;if("YTD"==t)f=N,F=this.ViewModel.oReportDialog.ToDate.Date;else if("LastYearYTD"==t)f=N.AddYears(-1),F=this.ViewModel.oReportDialog.ToDate.Date.AddYears(-1);else if("LastYearPeriodValue"==t)f=this.ViewModel.oReportDialog.FromDate.Date.AddYears(-1),F=this.ViewModel.oReportDialog.ToDate.Date.AddYears(-1);else if("LastYearValue"==t)f=N.AddYears(-1),F=f.AddYears(1).AddDays(-1);else if(this.Show==u.MonthWise)f=this.ViewModel.oReportDialog.FromDate.Date,S=",'Y'+CONVERT(NVARCHAR,YEAR(convert(datetime,ACC.DocDate)))+'M'+ CONVERT(NVARCHAR,Month(convert(datetime,ACC.DocDate))) Tag",V=",Tag";else if(this.Show==u.QtrWise||this.Show==u.HalfYearWise)f=this.ViewModel.oReportDialog.FromDate.Date,S=",CONVERT(NVARCHAR,YEAR(convert(datetime,ACC.DocDate)))+'-'+ CONVERT(NVARCHAR,Month(convert(datetime,ACC.DocDate))) YrMn",V=",YrMn";else if(this.Show==u.YearWise)f=this.ViewModel.oReportDialog.FromDate.Date,S=",'Y'+CONVERT(NVARCHAR,Year(convert(datetime,ACC.DocDate))) Tag",V=",Tag";else if(this.ShowYearWise){let e=1;for(;e<this.CntMonths;)N=N.AddYears(-1),e++;f=N,S=",Year(convert(datetime,ACC.DocDate)) Tag",V=",Tag"}return n+="DECLARE @From FLOAT,@To FLOAT\nSET @From=CONVERT(FLOAT,CONVERT(DATETIME,'"+f.ToString("dd MMM yyyy")+"'))\nSET @To=CONVERT(FLOAT,CONVERT(DATETIME,'"+F.ToString("dd MMM yyyy")+"'))\n\nSELECT "+I+"SUM(Balance) Balance"+V+" FROM (\nSELECT T1.AccountID,ISNULL(SUM(DR),0)-IsNULL(SUM(CR),0) Balance"+V+" FROM (",n+="\n--Opening Dr\nSELECT DebitAccount AccountID,ACC."+h+" DR,0 CR"+S+"\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+D+"\nWHERE "+m+A+r+"\nUNION ALL--Opening Cr\nSELECT CreditAccount AccountID,0 DR,ACC."+h+" CR"+S+"\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+D+"\nWHERE "+m+A+r,T.length>0&&(n+="\n--INEVENTORY DATA\nUNION ALL--Opening Dr\nSELECT DebitAccount AccountID,ACC."+h+" DR,0 CR"+S+"\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+T+"\nWHERE "+m+A+r+"\nUNION ALL--Opening Cr\nSELECT CreditAccount AccountID,0 DR,ACC."+h+" CR"+S+"\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+T+"\nWHERE "+m+A+r),n+=") AS T1"+g,n+=" WHERE "+R,n+=" GROUP BY T1.AccountID"+V,n+=") AS T2",V.length>0&&(n+=" GROUP BY "+V.TrimStart(",")),s.a.report.ReportDataSetAsync("RPT022",this.ViewModel.IsReportDB,n).then(e=>(this.ds=e,null!=this.ds&&this.ds.Tables[0].length>0&&null!=this.ds.Tables[0][0].Balance?this.ds.Tables[0]:null))}}}}]);
function _defineProperties(e,t){for(var o=0;o<t.length;o++){var l=t[o];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}function _createClass(e,t,o){return t&&_defineProperties(e.prototype,t),o&&_defineProperties(e,o),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var o,l=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;o=Reflect.construct(l,arguments,n)}else o=l.apply(this,arguments);return _possibleConstructorReturn(this,o)}}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(window.webpackJsonp=window.webpackJsonp||[]).push([[83],{"2Ofj":function(e,t,o){"use strict";o.r(t),o.d(t,"INV_ComparisonReport",(function(){return v}));var l=o("mrSG"),n=o("Do2H"),s=o("Lp6j"),i=o("1xwR"),a=o("8B8H"),r=o("mvPR"),u=o("uMy8"),c=o("vTM8"),d=o("ScVY"),h=o("0/4Q"),C=o("EQd/"),p=o("ockk"),D=o("MCLT"),w=o("D9Bi"),m=o("CUWK"),f=o("MCKn"),I=o("4HhE"),R=function e(){_classCallCheck(this,e),this.DocSeqNo=0,this.InvID_QTN=0,this.InvID_MRN=0,this.UsedQty=0,this.ReqQty=0},v=function(e){_inherits(o,e);var t=_createSuper(o);function o(e){var l;return _classCallCheck(this,o),(l=t.call(this,e)).i=0,l.k=0,l.ds=null,l.AttachReportWithPO=!1,l.CanApproveAll=!1,l.dvQuotations=null,l.dvQuotationsTable=null,l.EnquiryVoucher="",l.strLinkedInvDocDetailsIDs="",l.QuotationDocument=0,l.PurchaseOrderDocument=0,l.QuotationComparisonDocument=0,l.Userlevel=0,l.ccid=0,l.docid=0,l.WID=0,l.QtnIDs="",l.cntGroups=0,l.cntCols=0,l.cntHiddenCols=0,l.cntHiddenGroups=0,l.cntVisibleGroups=0,l.Quotations=new Array,l.QuotationDate=new Array,l.strQuotationNumericFields="",l.AllProductRows=new Array,l.TagID=0,l.IsAvgRate=0,l.fldDict=new c.a,l.ComparisonDocID=0,l.ComparisonQtyField="",l.ComparisonStatusField="",l.QtnCols=new Array,l.isConfirm_Web="No",l.oDocument=null,l}return _createClass(o,[{key:"LoadReport",value:function(){var e=this;if(this.EnquiryVoucher=this.ViewModel.Preferences.EnquiryNo,this.QuotationDocument=parseInt(this.ViewModel.Preferences.QuotationDocument),!this.ViewModel.ButtonAction.Visible&&"DONE"!=this.ViewModel.ButtonAction.SysColumnName){this.ViewModel.ButtonAction.SysColumnName="DONE";var t=n.a.report.ReportDataTable("RPT022",this.ViewModel.IsReportDB,"select PrefValue from com_documentpreferences with(nolock) where CostCenterID="+this.QuotationDocument+" and PrefName='ApprOnComparitiveAnalysis' and PrefValue='True'");t.length>0&&t.Columns.Contains("PrefValue")&&(this.ViewModel.ButtonAction.AccDimInUse=!0)}if(this.ViewModel.DocumentFiltersIDs.ContainsKey("23148")&&(this.strLinkedInvDocDetailsIDs=this.ViewModel.DocumentFiltersIDs[23148]),this.ViewModel.Preferences.ContainsKey("PurchaseOrderDocument")&&this.ViewModel.Preferences.PurchaseOrderDocument.length>0&&(this.PurchaseOrderDocument=parseInt(this.ViewModel.Preferences.PurchaseOrderDocument)),this.ViewModel.Preferences.ContainsKey("QuotationComparisonDocument")&&this.ViewModel.Preferences.QuotationComparisonDocument.length>0&&(this.QuotationComparisonDocument=parseInt(this.ViewModel.Preferences.QuotationComparisonDocument),this.ComparisonQtyField=this.ViewModel.Preferences.ContainsKey("QTNComp_Qty")?this.ViewModel.Preferences.QTNComp_Qty:"",this.ComparisonStatusField=this.ViewModel.Preferences.ContainsKey("QTNComp_Status")?this.ViewModel.Preferences.QTNComp_Status:""),this.ViewModel.Preferences.ContainsKey("QuotationNumericFields")&&this.ViewModel.Preferences.QuotationNumericFields.length>0)this.strQuotationNumericFields=this.ViewModel.Preferences.QuotationNumericFields,this.NumericFields=this.ViewModel.Preferences.QuotationNumericFields.split(","),this.NumericFieldsBold=new Array(this.NumericFields.length).fill(!1),this.NumericFieldsIgnoreTotal=new Array(this.NumericFields.length).fill(!1);else if(this.ViewModel.Preferences.ContainsKey("QuotationNumericFieldsXML")&&this.ViewModel.Preferences.QuotationNumericFieldsXML.length>0){var o=new s.f;o.LoadXml("<xml>"+this.ViewModel.Preferences.QuotationNumericFieldsXML+"</xml>"),this.NumericFields=new Array(o.DocumentElement.children.length),this.NumericFieldsBold=new Array(this.NumericFields.length).fill(!1),this.NumericFieldsIgnoreTotal=new Array(this.NumericFields.length).fill(!1);for(var l=0,i=0;i<o.DocumentElement.children.length;i++){var a=o.DocumentElement.children[i];this.NumericFields[l]=a.attributes.ID.value,this.strQuotationNumericFields.length>0&&(this.strQuotationNumericFields+=","),this.strQuotationNumericFields+=a.attributes.ID.value,null!=a.attributes.Bold&&"1"==a.attributes.Bold.value&&(this.NumericFieldsBold[l]=!0),null!=a.attributes.IgnoreAtTotal&&"1"==a.attributes.IgnoreAtTotal.value&&(this.NumericFieldsIgnoreTotal[l]=!0),l++}}else this.NumericFields=[];this.TextFields=this.ViewModel.Preferences.QuotationTextFields.length>0?this.ViewModel.Preferences.QuotationTextFields.split(","):[],this.IsAvgRate=this.ViewModel.ColumnSource.filter((function(e){return"AvgRate"==e.ID})).length,n.a.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise stock")&&(this.TagID=s.e.Int(n.a.SessionManager.Preferences["Maintain Dimensionwise stock"])),0==this.TagID&&"True"==n.a.SessionManager.Preferences.EnableLocationWise.toString()&&"True"==n.a.SessionManager.Preferences["LW Reports"]&&(this.TagID=50002),this.AttachReportWithPO=!(!this.ViewModel.Preferences.ContainsKey("AttachReportWithPO")||"1"!=this.ViewModel.Preferences.AttachReportWithPO),this.RateKPIColumn=this.ViewModel.Preferences.ContainsKey("RateKPIColumn")?this.ViewModel.Preferences.RateKPIColumn:"",this.RateKPIColumnColor=this.ViewModel.Preferences.ContainsKey("RateKPIColumnColor")?this.ViewModel.Preferences.RateKPIColumnColor:"Green",this.ExecutedClr=this.ViewModel.Preferences.ContainsKey("ExecutedClr")?this.ViewModel.Preferences.ExecutedClr:"#FFC4BFC0",this.PartialExecutedClr=this.ViewModel.Preferences.ContainsKey("PartialExecutedClr")?this.ViewModel.Preferences.PartialExecutedClr:"#FFE6E6FA",this.FullSelectedClr=this.ViewModel.Preferences.ContainsKey("FullSelectedClr")?this.ViewModel.Preferences.FullSelectedClr:"",this.PartialSelectedClr=this.ViewModel.Preferences.ContainsKey("PartialSelectedClr")?this.ViewModel.Preferences.PartialSelectedClr:"",this.GrandTotalColumnID=this.ViewModel.Preferences.ContainsKey("GrandTotalColumn")?this.ViewModel.Preferences.GrandTotalColumn:"",this.ViewModel.Preferences.ContainsKey("HideRegenerate")&&(this.ViewModel.RegenerateVisibility=!1),this.LoadDataSet().then((function(){if(null!=e.ds){e.Quotations.Clear(),e.QuotationDate.Clear(),e.ds.Tables[1].forEach((function(t){e.Quotations.Contains(t.VoucherNo.toString())||(e.Quotations.push(t.VoucherNo.toString()),e.QuotationDate.push(new Date(t.DocDate).ToString(n.a.SessionManager.Preferences["Date Format"])))})),e.cntCols=0,e.cntGroups=0,e.cntHiddenCols=0,e.cntHiddenGroups=0,e.QtnCols.Clear();for(var t,o=new Array,l=0;l<e.ViewModel.ColumnSource.length;l++)l>=e.ViewModel.RepeatStartIndex&&l<=e.ViewModel.RepeatStartIndex+e.ViewModel.RepeatNextCols?(e.cntCols++,e.QtnCols.push(e.ViewModel.ColumnSource[l]),e.ViewModel.ColumnSource[l].HeaderAppearance.IsVisible||e.cntHiddenCols++):(e.cntGroups++,o.push(e.ViewModel.ColumnSource[l].Clone()),e.ViewModel.ColumnSource[l].HeaderAppearance.IsVisible||e.cntHiddenGroups++);e.cntVisibleGroups=e.cntGroups-e.cntHiddenGroups;for(var i=0;i<e.Quotations.length;i++)for(var a=0;a<e.QtnCols.length;a++)o.push(e.QtnCols[a].Clone()),o[o.length-1].MatixRepeatID=i.toString();e.ViewModel.ConstructFormulaFields(!1),e.eval=new u.b,e.eval.ThrowException=!1,e.eval.SetKeyWords("REPORT"),e.QtnCols.forEach((function(o){e.fldDict.ContainsKey(o.ID)||((t=new u.c).setFieldDetails(o.ID,3,1,"",0,!1,!1),e.fldDict.push(o.ID,t))}));for(var c=e.NewReportRow_3(r.f.ReportTotal,e.ViewModel.GrpReportTotal.SubTotalAppearance,o.length),d=e.NewReportRow_3(r.f.ReportTotal,e.ViewModel.GrpReportTotal.SubTotalAppearance,o.length),h=e.NewReportRow_3(r.f.ReportTotal,e.ViewModel.GrpReportTotal.SubTotalAppearance,o.length),C=e.ViewModel.Preferences.ContainsKey("ShowStatus")?e.NewReportRow_3(r.f.ReportTotal,e.ViewModel.GrpReportTotal.SubTotalAppearance,o.length):null,p=e.ViewModel.Preferences.ContainsKey("ShowApprovalRemarks")?e.NewReportRow_3(r.f.ReportTotal,e.ViewModel.GrpReportTotal.SubTotalAppearance,o.length):null,D=function(t){e.dvQuotations=e.dvQuotationsTable.filter((function(o){return o.VoucherNo==e.Quotations[t]})),e.dvQuotations.length>0&&(c.Cells[e.cntGroups+t*e.cntCols].Text=e.dvQuotations[0].CreditAccountName.toString(),e.ViewModel.ButtonPost.Visible&&(c.Cells[e.cntGroups+t*e.cntCols].CellAppearance.ColumnType="LINK_VENDOR"),null!=C&&(C.Cells[e.cntGroups+t*e.cntCols].Text="Posted"==s.e.String(e.dvQuotations[0].QTNStatus)?n.a.GetResource("Reports_LblPosted"):"Un Approved"==s.e.String(e.dvQuotations[0].QTNStatus)?n.a.GetResource("Reports_LblUnApproved"):"Approved"==s.e.String(e.dvQuotations[0].QTNStatus)?n.a.GetResource("Reports_LblApproved"):"Rejected"==s.e.String(e.dvQuotations[0].QTNStatus)?n.a.GetResource("Reports_LblRjected"):s.e.String(e.dvQuotations[0].QTNStatus),C.Cells[e.cntGroups+t*e.cntCols].Value=e.dvQuotations[0].DocID,C.Cells[e.cntGroups+t*e.cntCols].CellAppearance.Alignment="Left",C.Cells[e.cntGroups+t*e.cntCols].ColSpan=e.cntCols-e.cntHiddenCols,C.Cells[e.cntGroups+t*e.cntCols].CellAppearance.IsBold=!1,C.Cells[e.cntGroups+t*e.cntCols].CellAppearance.ColumnType="LINK_STATUS",C.Cells[e.cntGroups+t*e.cntCols].Text.startsWith("Rejected")&&(C.Cells[e.cntGroups+t*e.cntCols].CellAppearance.ForeColor="Red")),null!=p&&(p.Cells[e.cntGroups+t*e.cntCols].Text=e.dvQuotations[0].QTNApprovalRemarks.toString(),p.Cells[e.cntGroups+t*e.cntCols].CellAppearance.Alignment="Left",p.Cells[e.cntGroups+t*e.cntCols].ColSpan=e.cntCols-e.cntHiddenCols,p.Cells[e.cntGroups+t*e.cntCols].CellAppearance.IsBold=!1)),c.Cells[e.cntGroups+t*e.cntCols].CellAppearance.Alignment="Left",c.Cells[e.cntGroups+t*e.cntCols].ColSpan=e.cntCols-e.cntHiddenCols,c.Cells[e.cntGroups+t*e.cntCols].CellAppearance.IsBold=!1,d.Cells[e.cntGroups+t*e.cntCols].Text=e.QuotationDate[t],d.Cells[e.cntGroups+t*e.cntCols].CellAppearance.Alignment="Left",d.Cells[e.cntGroups+t*e.cntCols].ColSpan=e.cntCols-e.cntHiddenCols,d.Cells[e.cntGroups+t*e.cntCols].CellAppearance.IsBold=!1,h.Cells[e.cntGroups+t*e.cntCols].Text=e.Quotations[t],h.Cells[e.cntGroups+t*e.cntCols].CellAppearance.Alignment="Left",h.Cells[e.cntGroups+t*e.cntCols].CellAppearance.ColumnType="LINK_DOCUMENT",h.Cells[e.cntGroups+t*e.cntCols].ColSpan=e.cntCols-e.cntHiddenCols,h.Cells[e.cntGroups+t*e.cntCols].CellAppearance.IsBold=!1},w=0;w<e.Quotations.length;w++)D(w);var m=e.cntGroups-e.cntHiddenGroups>3?2:1;c.Cells[m].Text=n.a.GetResource("Reports_LblNameofthesupplier"),d.Cells[m].Text=n.a.GetResource("Reports_LblDocDate"),h.Cells[m].Text=n.a.GetResource("Reports_LblDocNo"),e.cntGroups-e.cntHiddenGroups>3?(c.Cells[2].ColSpan=d.Cells[2].ColSpan=h.Cells[2].ColSpan=e.cntGroups-(2+e.cntHiddenGroups),c.Cells[2].CellAppearance.Alignment=d.Cells[2].CellAppearance.Alignment=h.Cells[2].CellAppearance.Alignment="Left",e.ds.Tables[0].length>0&&(d.Cells[0].Text=new Date(e.ds.Tables[0][0].DocDate).ToString(n.a.SessionManager.Preferences["Date Format"]),d.Cells[0].CellAppearance.IsBold=!1,h.Cells[0].Text=e.ds.Tables[0][0].VoucherNo.toString(),h.Cells[0].CellAppearance.ColumnType="LINK_DOCUMENT",h.Cells[0].CellAppearance.IsBold=!1),c.Cells[0].ColSpan=d.Cells[0].ColSpan=h.Cells[0].ColSpan=2,null!=C&&(C.Cells[0].ColSpan=2),null!=p&&(p.Cells[0].ColSpan=2)):(c.Cells[1].ColSpan=d.Cells[1].ColSpan=h.Cells[1].ColSpan=e.cntGroups-(1+e.cntHiddenGroups),c.Cells[1].CellAppearance.Alignment=d.Cells[1].CellAppearance.Alignment=h.Cells[1].CellAppearance.Alignment="Left",null!=C&&(C.Cells[1].ColSpan=e.cntGroups-(1+e.cntHiddenGroups),C.Cells[1].CellAppearance.Alignment="Left"),null!=p&&(p.Cells[1].ColSpan=e.cntGroups-(1+e.cntHiddenGroups),p.Cells[1].CellAppearance.Alignment="Left"),d.Cells[0].Text=new Date(e.ds.Tables[0][0].DocDate).ToString(n.a.SessionManager.Preferences["Date Format"]),d.Cells[0].CellAppearance.IsBold=!1,h.Cells[0].Text=e.ds.Tables[0][0].VoucherNo.toString(),h.Cells[0].CellAppearance.IsBold=!1),null!=C&&(C.Cells[m].Text=n.a.GetResource("Reports_LblDocStatus"),C.Cells[m].ColSpan=h.Cells[m].ColSpan,C.Cells[m].CellAppearance.Alignment="Left"),null!=p&&(p.Cells[m].Text="Approval Remarks",p.Cells[m].ColSpan=h.Cells[m].ColSpan,p.Cells[m].CellAppearance.Alignment="Left"),e.oHeadiQtyRate=new r.d(o.length,e.ViewModel.RowHeight+2),e.oHeadiQtyRate.Type=r.f.Header;for(var f=0;f<o.length;f++)e.oHeadiQtyRate.Cells[f].Text=o[f].HeaderText,e.oHeadiQtyRate.Cells[f].CellAppearance=o[f].HeaderAppearance,e.oHeadiQtyRate.Cells[f].IsNormal=!1;for(var I=0;I<o.length;I++)o[I].HeaderText="";e.oColumns=o,e.ViewModel.ReportColumns=o,e.ViewModel.colSNoIndex=e.ViewModel.ReportColumns.indexOf(e.ViewModel.ReportColumns.find((function(e){return 0==s.e.stringCompare(e.Formula,"SNO",!0)}))),e.ViewModel.IsTotalColsAdded=!0,e.ViewModel.totals=s.e.NumArray(e.oColumns.length,e.Quotations.length+1),e.ViewModel.Preferences.ContainsKey("HideSupplier")&&"0"!=e.ViewModel.Preferences.HideSupplier||e.ViewModel.addRow(c),e.ViewModel.addRow(d),null!=C&&e.ViewModel.addRow(C),null!=p&&e.ViewModel.addRow(p),e.ViewModel.addRow(h),e.ViewModel.addRow(e.oHeadiQtyRate),e.AddRows(),e.AllProductRows.forEach((function(t){e.ViewModel.addRow(t)})),e.ViewModel.AddSubtotals_RT(e.ViewModel.GrpReportTotal,0),e.ViewModel.Preferences.ContainsKey("HideBasicTotal")&&"0"!=e.ViewModel.Preferences.HideBasicTotal||e.ViewModel.addRow(e.oBasicValueRow);for(var R=0;R<e.NumericRows.length;R++)e.ViewModel.addRow(e.NumericRows[R]);e.ViewModel.Preferences.ContainsKey("HideGrandTotal")&&"0"!=e.ViewModel.Preferences.HideGrandTotal||e.ViewModel.addRow(e.oTotalRow);for(var v=0;v<e.TextRows.length;v++)e.ViewModel.addRow(e.TextRows[v]);if(e.ViewModel.Preferences.ContainsKey("ShowPTProfile")&&"1"==e.ViewModel.Preferences.ShowPTProfile){e.oRow=e.NewReportRow(),e.oRow.Cells[0].Text="Payment Terms",e.oRow.Cells[0].ColSpan=e.cntGroups-e.cntHiddenGroups,e.oRow.Cells[0].IsNormal=!1,e.oRow.Cells[0].CellAppearance=e.ViewModel.GrpReportTotal.SubTotalAppearance_Data.Clone(),e.oRow.Cells[0].CellAppearance.Alignment="Left";for(var T=function(t){var o=e.oRow.Cells[e.cntGroups+t*e.cntCols];o.IsNormal=!1,o.ColSpan=e.cntCols-e.cntHiddenCols,o.CellAppearance=e.ViewModel.ReportColumns[1+t*e.cntCols].DataAppearance.Clone(),o.CellAppearance.Alignment="Left",e.dvQuotations=e.dvQuotationsTable.filter((function(o){return o.VoucherNo==e.Quotations[t]})),e.dvQuotations.length>0&&(o.Text=s.e.String(e.dvQuotations[0].PayTermProfile),o.Text.length>0&&(o.Value=e.Quotations[t],o.CellAppearance.ColumnType="LINK_PAYTERM"))},g=0;g<e.Quotations.length;g++)T(g);e.ViewModel.addRow(e.oRow)}if(e.ViewModel.Preferences.ContainsKey("ShowAttachments")){e.oRow=e.NewReportRow(),e.oRow.Cells[0].Text=n.a.GetResource("Reports_LblAttachments"),e.oRow.Cells[0].ColSpan=e.cntGroups-e.cntHiddenGroups,e.oRow.Cells[0].IsNormal=!1,e.oRow.Cells[0].CellAppearance=e.ViewModel.GrpReportTotal.SubTotalAppearance_Data.Clone(),e.oRow.Cells[0].CellAppearance.Alignment="Left";for(var V=function(t){var o=e.oRow.Cells[e.cntGroups+t*e.cntCols];o.IsNormal=!1,o.ColSpan=e.cntCols-e.cntHiddenCols,e.dvQuotations=e.dvQuotationsTable.filter((function(o){return o.VoucherNo==e.Quotations[t]})),e.dvQuotations.length>0&&(o.Text=s.e.String(e.dvQuotations[0].QTNAttachments),o.Value=s.e.String(e.dvQuotations[0].QTNAttachments_ID)),o.CellAppearance=e.ViewModel.ReportColumns[1+t*e.cntCols].DataAppearance.Clone(),o.CellAppearance.Alignment="Left",o.CellAppearance.ColumnType="LINK_ATTACHMENT"},M=0;M<e.Quotations.length;M++)V(M);e.ViewModel.addRow(e.oRow)}e.QuotationComparisonDocument>4e4&&e.InitGrid()}})).then((function(){e.ViewModel.process_RunWorkerCompleted()}))}},{key:"LoadDataSet",value:function(){var e=this,t=this.strQuotationNumericFields;this.ViewModel.Preferences.QuotationTextFields.length>0&&(t.length>0&&(t+=","),t+=this.ViewModel.Preferences.QuotationTextFields),t="'"+t.Replace(",","','")+"'",this.ViewModel.FromTag.Contains("DCC.")&&(this.ViewModel.FromTag=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=D.InvDocDetailsID "+this.ViewModel.FromTag);var o,l,i=this.ViewModel.SelectTag,a=this.ViewModel.FromTag,r=new Array,u=this.ViewModel.BaseReportColumns.find((function(e){return!s.e.IsEmpty(e.RepeatType.SelectedValue)&&parseInt(e.RepeatType.SelectedValue)>0})),c=this.ViewModel.BaseReportColumns.indexOf(u);if(-1!=c)for(var d=c;d<=c+this.ViewModel.RepeatNextCols;d++)r.push(this.ViewModel.BaseReportColumns[d]);this.ViewModel.Entities.Clear(),this.ViewModel.Entities.push("Documents","D"),this.ViewModel.SetQuery(r,!0),this.ViewModel.FromTag.Contains("DCC.")&&(this.ViewModel.FromTag=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=D.InvDocDetailsID "+this.ViewModel.FromTag),o=this.ViewModel.SelectTag,l=this.ViewModel.FromTag,this.ViewModel.Preferences.ContainsKey("ShowPTProfile")&&"1"==this.ViewModel.Preferences.ShowPTProfile&&(o+=",(SELECT top 1 PD.ProfileName PaymentTerm_ProfileName FROM COM_DocPayTerms P with(nolock) \nleft join Acc_PaymentDiscountProfile PD with(nolock) on P.ProfileID=PD.ProfileID WHERE VoucherNo=D.VoucherNo) PayTermProfile"),this.ViewModel.Preferences.ContainsKey("ShowAttachments")&&(o+=",stuff((select ','+[GUID]+'.'+FileExtension from COM_Files WITH(NOLOCK) WHERE FeatureID=D.CostCenterID AND FeaturePK=D.DocID FOR XML PATH('')),1,1,'') QTNAttachments_ID,stuff((select ', '+ActualFileName from COM_Files WITH(NOLOCK) WHERE FeatureID=D.CostCenterID AND FeaturePK=D.DocID FOR XML PATH('')),1,2,'') QTNAttachments"),this.ViewModel.Preferences.ContainsKey("ShowStatus")&&(o+=",S.Status+case when W.LevelName is null then '' else ' ('+W.LevelName+')' end QTNStatus",l+=" left join COM_Status S with(nolock) on S.StatusID=D.StatusID",l+=" left join COM_WorkFlow W with(nolock) on W.WorkFlowID=D.WorkFlowID and W.LevelID=D.WorkFlowLevel"),this.ViewModel.Preferences.ContainsKey("ShowApprovalRemarks")&&(o+=",(select Remarks from COM_Approvals with(nolock) where ApprovalID IN (select top 1 ApprovalID\nfrom COM_Approvals with(nolock) where RowType=1 and this.ccid=D.costcenterid and ccnodeid=D.DocID AND (DocDetID=0 OR DocDetID=D.InvDocDetailsID) order by ApprovalID desc)) QTNApprovalRemarks"),this.ViewModel.Preferences.ContainsKey("QTNSelect")&&(o+=this.ViewModel.Preferences.QTNSelect),this.ViewModel.Preferences.ContainsKey("QTNJoin")&&(!l.Contains("COM_DocCCData")&&this.ViewModel.Preferences.QTNJoin.Contains("dcCCNID")&&(l+=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=D.InvDocDetailsID"),l+=this.ViewModel.Preferences.QTNJoin),o=o.Replace("@CCWHERE@","");var h="";this.TagID>5e4&&n.a.SessionManager.LocationID>0&&(h=" AND DCC.DCCCNID"+(this.TagID-5e4).toString()+" IN ("+n.a.SessionManager.LocationID+")");var C=this.GetDimensionFilter("DCC.dcCCNID"),p=this.ViewModel.oReportDialog.CostCenterFilters.find((function(e){return 3==e.CostCenterID}));if(p&&null!=p.SelectedNodes&&p.SelectedNodes.length>0)if(1==p.SelectedNodes.length)C+=" AND D.ProductID="+p.SelectedNodes[0].Id;else{C+=" AND D.ProductID IN (";for(var D=0;D<p.SelectedNodes.length;D++)D>0&&(C+=","),C+=p.SelectedNodes[D].Id;C+=")"}var w,m="";this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(m=s.e.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?" AND dcCCNID"+(this.ViewModel.oReportDialog.Locations.DBColumnID-5e4)+" IN (-1)":" AND dcCCNID"+(this.ViewModel.oReportDialog.Locations.DBColumnID-5e4)+" IN ("+this.ViewModel.oReportDialog.LocationWhere+")"),w=i.Replace("@CCWHERE@",m.length>0?" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON A.InvDocDetailsID=DCC.InvDocDetailsID "+m:"");var f=[];return f.push(this.EnquiryVoucher),f.push(w),f.push(a),f.push(C),f.push(this.QuotationDocument),f.push(this.QuotationComparisonDocument),f.push(this.PurchaseOrderDocument),f.push(o),f.push(l),this.ComparisonQtyField.startsWith("dcNum")?f.push(",N."+this.ComparisonQtyField+" SelectedQty"):f.push(0==this.ComparisonQtyField.length?"":",D."+this.ComparisonQtyField+" SelectedQty"),this.ComparisonStatusField.startsWith("dcAlpha")?f.push("TXT."+this.ComparisonStatusField):f.push(""),f.push(t),f.push(this.IsAvgRate),f.push(h),f.push(this.strLinkedInvDocDetailsIDs),f.push(this.ViewModel.Preferences.ContainsKey("ShowQtnAddOns")),f.push(n.a.SessionManager.LanguageID),n.a.report.GetComperativeStmt(f,this.ViewModel.IsReportDB).then((function(t){if(e.ds=t,e.dvQuotations=e.dvQuotationsTable=e.ds.Tables[1],e.ViewModel.Preferences.ContainsKey("ShowLinkedPrds")&&"1"==e.ViewModel.Preferences.ShowLinkedPrds)for(var o=function(t){0==e.ds.Tables[1].filter((function(o){return o.LinkedInvDocDetailsID==parseInt(e.ds.Tables[0][t].InvDocDetailsID)})).length&&e.ds.Tables[0].RemoveAt(t)},l=e.ds.Tables[0].length-1;l>=0;l--)o(l);var s;(e.dvFields=e.dvFieldsTable=e.ds.Tables[3],e.IsAvgRate>0)&&(e.ds.Columns[0].push("AvgRate"),e.ds.Tables[0].forEach((function(t){(s=e.ds.Tables[4].filter((function(e){return e.ProductID==t.ProductID}))).length>0&&(t.AvgRate=s[0].AvgRate)})));var i=null;if(e.ViewModel.ButtonAction.AccDimInUse){e.ViewModel.ButtonPost.Visible=!1,e.docid=parseInt(e.ds.Tables[0][0].docid.toString()),e.ccid=parseInt(e.ds.Tables[0][0].costcenterid.toString());var a=e.dvQuotations.ToTable(!0,["DocID"]);e.QtnIDs="";for(var r=0;r<a.length;r++)r>0&&(e.QtnIDs+=","),e.QtnIDs+=a[r].DocID.toString();0==e.QtnIDs.length?e.ViewModel.ButtonAction.Visible=!1:""!=(i=n.a.report.GetWorkflowCanApprove(e.docid,e.ccid,e.dvQuotations[0].InvDocDetailsID.toString(),e.QtnIDs)).Tables[0][0].userlevel.toString()&&(e.Userlevel=parseInt(i.Tables[0][0].userlevel.toString()),""!=i.Tables[0][0].WorkFlowID.toString()&&(e.WID=parseInt(i.Tables[0][0].WorkFlowID.toString())),e.ViewModel.ButtonAction.Visible="1"==i.Tables[0][0].canApprove.toString(),"1"==i.Tables[0][0].canPost.toString()&&(e.ViewModel.ButtonPost.Visible=!0),e.Userlevel>1&&"1"==i.Tables[0][0].Appall.toString()&&(e.CanApproveAll=!0))}e.QuotationComparisonDocument>4e4&&(e.ViewModel.ComparisonQuotationVisible=!(e.ViewModel.ButtonPost.Visible||null==i||!i.Columns[0].Contains("StatusID")||"369"!=i.Tables[0][0].StatusID.toString())||e.ViewModel.ButtonPost.Visible)}))}},{key:"LoadReportWithPostFilters",value:function(e){}},{key:"InitGrid",value:function(){var e,t=this;this.Grid=new a.a,this.Grid.CanEvaluateFormulas=!1,this.Grid.Width="",this.Grid.HeaderHeight=40,this.Grid.Table=[],this.Grid.OnBeginEdit.Subscribe(this,"Grid_BeginEdit"),this.Grid.OnCellEditEnding.Subscribe(this,"Grid_EndEdit");var o=new Array,l=0,s=0;for(l=0;l<this.cntVisibleGroups;l++){var i=this.ViewModel.ReportColumns[l];(e=new p.a).Header=i.HeaderText,e.Header=this.oHeadiQtyRate.Cells[l].Text,e.DisplayMember="C"+l,e.ReadOnly=!0,s+=parseInt(i.width),e.IsFrozen=l<this.cntVisibleGroups&&s<600,e.Width=parseInt(i.width),e.DisableTab=!0,"FLOAT"==i.ColumnType?(l>=this.cntVisibleGroups&&(e.ReadOnly=!1),e.DataType="FLOAT",e.DecimalPoints=i.DataFormat.DecimalsPoints.toString(),this.Grid.TableColumns.push(e.DisplayMember)):this.Grid.TableColumns.push(e.DisplayMember),o.push(e)}var r=n.a.SessionManager.Preferences.DecimalsinQty,u=this.ViewModel.BaseReportColumns.find((function(e){return null!=e.CDGDO&&"1"==e.Visibility.SelectedValue&&"Quantity"==e.CDGDO.Column}));if(u){var c=this.ViewModel.ReportColumns.find((function(e){return e.ID==u.ID}));c&&(r=c.DataFormat.DecimalsPoints.toString())}for(l=0;l<this.Quotations.length;l++)(e=new p.a).Header=n.a.GetResource("Reports_LblReqQty")+" ["+this.Quotations[l]+"]",this.dvQuotations=this.dvQuotationsTable.filter((function(e){return e.VoucherNo==t.Quotations[l]})),this.dvQuotations.length>0&&(e.Header+="\r\n"+this.dvQuotations[0].CreditAccountName.toString()),e.DisplayMember="ReqQty"+l,e.ReadOnly=!0,e.Width=180,e.DisableTab=!1,e.DataType="FLOAT",e.DecimalPoints=r,this.Grid.TableColumns.push(e.DisplayMember),this.Grid.TableColumns.push("ExeQty"+l),o.push(e);this.Grid.TableColumns.push("ReportRowId"),this.Grid.Columns=o,this.ds.Tables[2].length>0?(this.ComparisonDocID=parseInt(this.ds.Tables[2][0].DocID),this.ds.Columns[2].Contains("VoucherNo")&&(this.ViewModel.ComparisonINTERQTN=this.ds.Tables[2][0].VoucherNo.toString())):(this.ComparisonDocID=0,this.ViewModel.ComparisonINTERQTN="");for(var d=function(e){var o=t.ViewModel.Data[e];if(null==o.DataRow)return"continue";var n=!1,s=t.Grid.NewRow();for(s.ReportRowId=e,l=0;l<t.Quotations.length;l++)if(null!=o.DataRow["InvDocDetailsID_QTN"+l]){var i=t.ds.Tables[2].filter((function(e){return e.SelectedQty>0&&e.LinkedInvDocDetailsID==o.DataRow["InvDocDetailsID_QTN"+l]}));0==i.length?s["ReqQty"+l]=0:(s["ExeQty"+l]=i[0].POQty,t.ds.Columns[2].Contains("SelectedQty")&&(s["ReqQty"+l]=i[0].SelectedQty),n=!0)}if(n){for(l=0;l<t.cntVisibleGroups;l++)if(null!=o.Cells[l].Text)try{s[t.Grid.TableColumns[l]]="FLOAT"==t.ViewModel.ReportColumns[l].ColumnType?o.Cells[l].Value:o.Cells[l].Text}catch(a){}t.Grid.addRow(s),t.SetSelectedColor(s)}},h=0;h<this.ViewModel.Data.length;h++)d(h);this.Grid.Height=160,console.log(this.Grid)}},{key:"AddRows",value:function(){for(var e,t,o,l,i=this,a=1,u=this.cntGroups;u<=this.cntGroups+this.ViewModel.RepeatNextCols;u++)"Gross"==this.ViewModel.ColumnSource[u].ID&&(a=u-this.cntGroups);if(this.ViewModel.Preferences.ContainsKey("ShowQtnAddOns"))for(var d=function(e){var t=i.ds.Tables[1][e];if(null!=t.LinkedInvDocDetailsID)return"continue";var o=i.ds.Tables[0].filter((function(e){return e.ProductID==t.ProductID&&e.InvDocDetailsID==-parseInt(t.InvDocDetailsID)}));if(0==o.length)if(0!=o.length)parseFloat(o[0].Quantity)<parseFloat(t.Quantity)&&(o[0].Quantity=t.Quantity),t.LinkedInvDocDetailsID=o[0].InvDocDetailsID;else{var l={};i.ds.Tables[0].length>0&&(l.CostCenterID=i.ds.Tables[0][0].CostCenterID),i.ds.Columns[0].forEach((function(e){i.ds.Columns[1].Contains(e)&&(l[e]=t[e])})),l.InvDocDetailsID=-parseInt(l.InvDocDetailsID),t.LinkedInvDocDetailsID=l.InvDocDetailsID,i.ds.Tables[0].push(l)}},h=0;h<this.ds.Tables[1].length;h++)d(h);this.NumericRows=new Array(this.NumericFields.length),this.TextRows=new Array(this.TextFields.length),this.ProductRows=new Array(this.ds.Tables[0].length),this.oBasicValueRow=this.NewReportRow_2(r.f.ReportTotal,this.ViewModel.GrpReportTotal.SubTotalAppearance_Data),this.oBasicValueRow.Cells[0].Text=n.a.GetResource("Reports_LblTotalBasicValue"),this.oBasicValueRow.Cells[0].ColSpan=this.cntGroups-this.cntHiddenGroups,this.oBasicValueRow.Cells[0].CellAppearance.Alignment="Left",this.oTotalRow=this.NewReportRow_2(r.f.ReportTotal,this.ViewModel.GrpReportTotal.SubTotalAppearance_Data),this.oTotalRow.Cells[0].Text=n.a.GetResource("Reports_LblTotal"),this.oTotalRow.Cells[0].ColSpan=this.cntGroups-this.cntHiddenGroups,this.oTotalRow.Cells[0].CellAppearance.Alignment="Left",this.ViewModel.SNo=0;var C,p,w=new Array(this.Quotations.length).fill(0),m=new Array(this.Quotations.length).fill(0),f=s.e.NumArray(this.NumericFields.length,this.Quotations.length),I=new c.c,R=new c.c;for(this.ds.Columns[0].push("KPICols"),this.i=0;this.i<this.Quotations.length;this.i++)this.ds.Columns[0].push("InvDocDetailsID_QTN"+this.i);var v=new Array,T=this.ds.Tables[0];for(this.i=0;this.i<T.length;this.i++){v.Clear(),v.push(new r.d(this.oColumns.length,this.ViewModel.RowHeight)),v[0].DataRow=T[this.i];for(var g=0;g<this.cntGroups;g++){if(this.oColumns[g].Row>0){if(v.length-1<this.oColumns[g].Row)for(var V=0;V<=this.oColumns[g].Row;V++)v.length-1<V&&(v.push(new r.d(this.oColumns.length,this.ViewModel.SubRowHeight)),v[v.length-1].Type=r.f.Detail);C=this.oColumns[g].Row,p=this.oColumns[g].Column,v[C].Cells[p].IsNormal=!1,v[C].Cells[p].CellAppearance=this.oColumns[g].DataAppearance}else C=0,p=g;var M="";""!=this.oColumns[g].Formula&&"LATEST"!=this.oColumns[g].Formula&&"OLDEST"!=this.oColumns[g].Formula?M=this.ViewModel.CalculateFormula_1(this.oColumns[g].Formula,T[this.i],v):this.ds.Columns[0].Contains(this.oColumns[g].ID)&&(M=s.e.String(T[this.i][this.oColumns[g].ID])),""!=M&&(this.ViewModel.SetCellValue(M,this.oColumns[g].DataFormat,this.oColumns[g].ColumnType,v[C].Cells[p]),this.ViewModel.TotalCols.Contains(this.oColumns[g].ID)&&(this.ViewModel.totals[g][0]+=s.e.Double(M)))}if(-1!=this.ViewModel.colSNoIndex&&(v[0].Cells[this.ViewModel.colSNoIndex].Value=++this.ViewModel.SNo,v[0].Cells[this.ViewModel.colSNoIndex].Text=this.ViewModel.SNo.toString()),this.PurchaseOrderDocument>0){var Q=parseFloat(T[this.i].Quantity),y=parseFloat(T[this.i].ExeQty);if(0!=y)for(var S=0;S<this.ViewModel.ReportColumns.length;S++)null==v[0].Cells[S].CellAppearance&&(v[0].Cells[S].CellAppearance=this.ViewModel.ReportColumns[S].DataAppearance.Clone()),v[0].Cells[S].IsNormal=!1,v[0].Cells[S].CellAppearance.BackColor=Q<=y?this.ExecutedClr:this.PartialExecutedClr}this.oRow=v[0],I.Clear(),R.Clear();for(var A=function(e){if(i.dvQuotations=i.dvQuotationsTable.filter((function(t){return t.VoucherNo==i.Quotations[e]&&t.LinkedInvDocDetailsID==i.ds.Tables[0][i.i].InvDocDetailsID})),i.dvQuotations.length>0){v[0].DataRow["InvDocDetailsID_QTN"+e]=i.dvQuotations[0].InvDocDetailsID;for(var t=i.cntGroups;t<=i.cntGroups+i.ViewModel.RepeatNextCols;t++){if(i.oColumns[t].Row>0){if(v.length-1<i.oColumns[t].Row)for(var o=0;o<=i.oColumns[t].Row;o++)v.length-1<o&&(v.push(new r.d(i.oColumns.length,i.ViewModel.SubRowHeight)),v[v.length-1].Type=r.f.Detail);C=i.oColumns[t].Row,p=i.oColumns[t].Column,v[C].Cells[p+e*i.cntCols].IsNormal=!1,v[C].Cells[p+e*i.cntCols].CellAppearance=i.oColumns[t].DataAppearance.Clone()}else C=0,p=t;var n="";""!=i.oColumns[t].Formula&&i.CalculateFormula(i.oColumns[t],i.dvQuotations[0]),Object(D.isNullOrUndefined)(i.dvQuotations[0][i.oColumns[t].ID])||(n=i.dvQuotations[0][i.oColumns[t].ID].toString()),""!=n&&(l=v[C].Cells[p+e*i.cntCols],i.ViewModel.SetCellValue(n,i.oColumns[t].DataFormat,"FLOAT",l),i.ViewModel.TotalCols.Contains(i.oColumns[t].ID)&&(i.ViewModel.totals[t][0]+=s.e.Double(n)),i.oColumns[t].ID==i.GrandTotalColumnID&&(m[e]+=s.e.Double(n)),i.oColumns[t].ID==i.RateKPIColumn&&(I.push(p+e*i.cntCols,parseFloat(n)),R.push(p+e*i.cntCols,l)))}w[e]+=parseFloat(i.dvQuotations[0].Gross)}},N=0;N<this.Quotations.length;N++)A(N);if(this.ProductRows[this.i]=v[0],v.forEach((function(e){i.AllProductRows.push(e)})),I.length>0){var P=I.values.filter((function(e){return 0!=e}));P.length>0&&function(){var e=Math.min.apply(null,P);I.keys.forEach((function(t){e==I[t]&&(null==R[t].CellAppearance&&(R[t].CellAppearance=i.ViewModel.ReportColumns[t].DataAppearance.Clone()),R[t].IsNormal=!1,R[t].CellAppearance.BackColor=i.RateKPIColumnColor,R[t].CellAppearance.ForeColor="White",i.oRow.Cells.Contains(R[t])&&(i.oRow.DataRow.KPICols=s.e.IsEmpty(i.oRow.DataRow.KPICols)?t:s.e.String(i.oRow.DataRow.KPICols)+","+t))}))}()}}for(var b=0;b<this.Quotations.length;b++)this.ViewModel.SetCellValue(w[b],this.oColumns[this.cntGroups+b*this.cntCols+a].DataFormat,"FLOAT",this.oBasicValueRow.Cells[this.cntGroups+b*this.cntCols+a]);for(this.i=0;this.i<this.NumericFields.length;this.i++){this.NumericRows[this.i]=this.NewReportRow(),this.dvFields=this.dvFieldsTable.filter((function(e){return e.SysColumnName==i.NumericFields[i.i]})),this.NumericRows[this.i].Cells[0].Text=this.dvFields.length>0?this.dvFields[0].UserColumnName.toString():this.NumericFields[this.i],this.NumericRows[this.i].Cells[0].ColSpan=this.cntGroups-this.cntHiddenGroups,this.NumericFieldsBold[this.i]&&(this.NumericRows[this.i].Cells[0].IsNormal=!1,this.NumericRows[this.i].Cells[0].CellAppearance=this.oColumns[0].DataAppearance.Clone(),this.NumericRows[this.i].Cells[0].CellAppearance.IsBold=!0);for(var G=new Array,F=function(e){for(o=0,G.Clear(),i.dvQuotations=i.dvQuotationsTable.filter((function(t){return t.VoucherNo==i.Quotations[e]})),i.k=0;i.k<i.dvQuotations.length;i.k++)t=s.e.Double(i.dvQuotations[i.k][i.NumericFields[i.i].Insert(2,"Calc")]),f[e]+=t,t=s.e.Double(i.dvQuotations[i.k][i.NumericFields[i.i]]),o+=t,G.Contains(t)||G.push(t);if(i.NumericFieldsIgnoreTotal[i.i]||(w[e]+=f[i.i][e]),i.ViewModel.SetCellValue(f[e],i.oColumns[i.cntGroups+e*i.cntCols+1].DataFormat,"FLOAT",i.NumericRows[i.i].Cells[i.cntGroups+e*i.cntCols+a]),i.NumericFieldsBold[i.i]&&(i.NumericRows[i.i].Cells[i.cntGroups+e*i.cntCols+a].IsNormal=!1,i.NumericRows[i.i].Cells[i.cntGroups+e*i.cntCols+a].CellAppearance=i.oColumns[i.cntGroups+e*i.cntCols+a].DataAppearance.Clone(),i.NumericRows[i.i].Cells[i.cntGroups+e*i.cntCols+a].CellAppearance.IsBold=!0),Math.abs(o-f[i.i][e])>.001&&((l=i.NumericRows[i.i].Cells[i.cntGroups+e*i.cntCols+a-1]).IsNormal=!1,l.CellAppearance=i.ViewModel.ReportColumns[i.cntGroups+a].DataAppearance.Clone(),l.CellAppearance.Alignment="Left",i.NumericFieldsBold[i.i]&&(l.CellAppearance.IsBold=!0),G.length>0)){var n="";G.sort((function(e,t){return e-t}));for(var r=0;r<G.length;r++)n.length>0&&(n+=", "),n+=G[r].toString();l.Text="@"+n}},L=0;L<this.Quotations.length;L++)F(L)}var O=new Array;for(this.i=0;this.i<this.TextFields.length;this.i++){this.TextRows[this.i]=this.NewReportRow(),this.dvFields=this.dvFieldsTable.filter((function(e){return e.SysColumnName==i.TextFields[i.i]})),this.TextRows[this.i].Cells[0].Text=this.dvFields.length>0?this.dvFields[0].UserColumnName.toString():this.TextFields[this.i],this.TextRows[this.i].Cells[0].ColSpan=this.cntGroups-this.cntHiddenGroups;for(var k=function(t){for((l=i.TextRows[i.i].Cells[i.cntGroups+t*i.cntCols]).IsNormal=!1,l.ColSpan=i.cntCols-i.cntHiddenCols,l.Text="",l.CellAppearance=i.ViewModel.ReportColumns[1+t*i.cntCols].DataAppearance.Clone(),l.CellAppearance.Alignment="Left",O.Clear(),i.dvQuotations=i.dvQuotationsTable.filter((function(e){return e.VoucherNo==i.Quotations[t]})),i.k=0;i.k<i.dvQuotations.length;i.k++)(e=i.TextFields[i.i].startsWith("dcAlpha")?s.e.String(i.dvQuotations[i.k][i.TextFields[i.i]]):s.e.String(i.dvQuotations[i.k][i.TextFields[i.i]+"Name"])).length>0&&!O.Contains(e)&&(O.push(e),l.Text.length>0&&(l.Text+=","),l.Text+=e)},_=0;_<this.Quotations.length;_++)k(_)}if(w.length>0)if(s.e.IsEmpty(this.GrandTotalColumnID))for(var x=Math.min.apply(null,w),E=0;E<this.Quotations.length;E++)this.ViewModel.SetCellValue(w[E],this.oColumns[this.cntGroups+E*this.cntCols+a].DataFormat,"FLOAT",this.oTotalRow.Cells[this.cntGroups+E*this.cntCols+a]),x==w[E]&&(this.oTotalRow.Cells[this.cntGroups+E*this.cntCols+a].CellAppearance.BackColor=this.RateKPIColumnColor,this.oTotalRow.Cells[this.cntGroups+E*this.cntCols+a].CellAppearance.ForeColor="White");else for(var B=Math.min.apply(null,m),H=0;H<this.Quotations.length;H++)this.ViewModel.SetCellValue(m[H],this.oColumns[this.cntGroups+H*this.cntCols+a].DataFormat,"FLOAT",this.oTotalRow.Cells[this.cntGroups+H*this.cntCols+a]),B==m[H]&&(this.oTotalRow.Cells[this.cntGroups+H*this.cntCols+a].CellAppearance.BackColor=this.RateKPIColumnColor,this.oTotalRow.Cells[this.cntGroups+H*this.cntCols+a].CellAppearance.ForeColor="White")}},{key:"CalculateFormula",value:function(e,t){for(var o=this.fldDict,l=0;l<this.fldDict.keys.length;l++){var n={Key:this.fldDict.keys[l]};Object(D.isNullOrUndefined)(t[n.Key])?this.fldDict[n.Key].setFieldValue(0):this.fldDict[n.Key].setFieldValue(null!=t[n.Key]?t[n.Key]:"")}if(!s.e.IsEmpty(e.Formula))try{t[e.ID]=this.eval.EvaluateExpression(e.Formula,o).toString()}catch(i){}return!1}},{key:"RowDblClick",value:function(e,t){var o=this;if(parseFloat(e.DataRow.Quantity)!=parseFloat(e.DataRow.ExeQty))if(0!=this.QuotationComparisonDocument){var l,i=this.ViewModel.Data.indexOf(e);if(-1==i)return void(this.ViewModel.DisplayMessage="Product Row Not Found");var a="";-1!=t&&t>=this.cntVisibleGroups&&!s.e.IsEmpty(this.ViewModel.ReportColumns[t].MatixRepeatID)&&(a=this.Quotations[parseInt(this.ViewModel.ReportColumns[t].MatixRepeatID)]);var r=new T(this,a,e.DataRow,i);if(0==r.VendorsList.Items.length)return void(this.ViewModel.DisplayMessage="No quotations raised for selected product");n.a.page.ShowDialog(r,w.a,{ShowCenter:!0}).subscribe((function(){if(r.IsOkClick){var t,n=!1,s=o.Grid.Table.filter((function(e){return e.ReportRowId==i}));if(0==s.length?(n=!0,(t=o.Grid.NewRow()).ReportRowId=o.ViewModel.Data.indexOf(e)):t=s[0],t["ReqQty"+o.Quotations.indexOf(r.VendorsList.SelectedValue)]=r.Quantity.Text,n){for(l=0;l<o.cntVisibleGroups;l++)if(null!=e.Cells[l].Text)try{t[l]="FLOAT"==o.ViewModel.ReportColumns[l].ColumnType?e.Cells[l].Value:e.Cells[l].Text}catch(a){}o.Grid.addRow(t)}o.SetSelectedColor(t)}}))}else{var u=s.e.String(e.DataRow.KPICols).split(",");e.IsSelected=!e.IsSelected;for(var c=0;c<e.Cells.length;c++)u.Contains(c.toString())||(null==e.Cells[c].CellAppearance&&(e.Cells[c].CellAppearance=this.ViewModel.ReportColumns[c].DataAppearance.Clone()),e.Cells[c].IsNormal=!1,e.Cells[c].CellAppearance.ForeColor=e.IsSelected?"#FF00A9DA":"Black");this.ViewModel.updateRow(e),this.ViewModel.refreshDataView(e),this.ViewModel.SelectedRow=e}}},{key:"SelectAllRows",value:function(e){var t=this;if(0!=this.QuotationComparisonDocument){this.ViewModel.ReportColumns.indexOf(e);var o="";if(s.e.IsEmpty(e.MatixRepeatID)||(o=this.Quotations[parseInt(e.MatixRepeatID)]),""!=o){if(this.Grid.Table.length>0){if(!confirm("Quoation already selected. Do you want to change?"))return;this.Grid.Clear()}for(var l=parseInt(e.MatixRepeatID),n=function(e){if(t.oRow=t.ViewModel.Data[e],null==t.oRow.DataRow)return"continue";if(null==t.oRow.DataRow["InvDocDetailsID_QTN"+l])return"continue";var o=void 0,n=!1,s=t.Grid.Table.filter((function(t){return t.ReportRowId==e}));if(0==s.length?(n=!0,(o=t.Grid.NewRow()).ReportRowId=e):o=s[0],t.dvQuotations=t.dvQuotationsTable.filter((function(e){return e.InvDocDetailsID==t.oRow.DataRow["InvDocDetailsID_QTN"+l]})),0!=t.dvQuotations.length&&(o["ReqQty"+l]=t.dvQuotations[0].Quantity.toString(),n)){for(var i=0;i<t.cntVisibleGroups;i++)if(null!=t.oRow.Cells[i].Text)try{o[i]="FLOAT"==t.ViewModel.ReportColumns[i].ColumnType?t.oRow.Cells[i].Value:t.oRow.Cells[i].Text}catch(a){}t.Grid.addRow(o)}},i=0;i<this.ViewModel.Data.length;i++)n(i);this.ViewModel.DisplayMessage=o+" - All Rows Added"}else this.ViewModel.DisplayMessage="Please Click On Quotation Columns"}}},{key:"Grid_BeginEdit",value:function(e,t,o){if((t=e.args.column.field).startsWith("ReqQty")){var l=parseInt(t.Replace("ReqQty","")),n=parseInt(e.ReportRowId);if(null==this.ViewModel.Data[n].DataRow["InvDocDetailsID_QTN"+l])return e.args.Cancel=!0,!0}return e.args.Cancel=!1,!1}},{key:"Grid_EndEdit",value:function(e,t,o){if(t.startsWith("ReqQty")){this.ViewModel.DisplayMessage="";var l=parseInt(t.Replace("ReqQty",""));parseFloat(e["ReqQty"+l])<parseFloat(e["ExeQty"+l])&&(e["ReqQty"+l]=e["ExeQty"+l],this.ViewModel.DisplayMessage="Please enter required qty greater than executed qty")}}},{key:"Post",value:function(){var e=this;if(null!=this.ProductRows)if(0==this.ProductRows.length)this.ViewModel.DisplayMessage="No products found";else if(0==this.Quotations.length)this.ViewModel.DisplayMessage="No vendors found to post";else if(this.QuotationComparisonDocument>4e4){if(0==this.Grid.Table.length)return void(this.ViewModel.DisplayMessage="Select products to post");this.PostQuotationComparison()}else{var t=new T(this,"",null,0);n.a.page.ShowDialog(t,w.a,{ShowCenter:!0,Title:"Post",NoWidth:!0}).subscribe((function(){t.IsOkClick&&e.PostPO(t)}))}}},{key:"PostPO",value:function(e){return Object(l.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var o,l,s,i,a,r,u=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:0==(o=this.ProductRows.filter((function(e){return 1==e.IsSelected}))).length&&(o=this.ProductRows),l=0,this.ViewModel.Preferences.ContainsKey("PurchaseOrderDocument")&&this.ViewModel.Preferences.PurchaseOrderDocument.length>0&&(l=parseInt(this.ViewModel.Preferences.PurchaseOrderDocument)),0==l?this.ViewModel.DisplayMessage="Purchase Order document is not configured":(n.a.page.ShowLoading=!0,s="",i=new Array,null==e.VendorsList.SelectedIndex&&(e.VendorsList.SelectedIndex=0),a="InvDocDetailsID_QTN"+e.VendorsList.SelectedIndex,o.forEach((function(e){null!=e.DataRow[a]&&(0==s.length&&(s=e.DataRow[a].toString()),i.push(e.DataRow[a].toString()))})),r=null,s.length>0&&(0==(r=n.a.report.ReportDataTable("RPT045",this.ViewModel.IsReportDB,s)).length&&(r=null)),m.RibbonExtViewModel.GetDocumentObject(l,"",null==r,r).then((function(t){var o,l=t.ScreenObject.Link.LinkCombo.Items.find((function(e){return e.Parent==u.QuotationDocument.toString()}));l?function(){null!=(o=e.VendorsList.GetselectedItem())&&null!=t.ScreenObject.CreditAccount&&(t.ScreenObject.CreditAccount.SelectedValue=o.CurrID);for(var s=t.ScreenObject.GetLinkDocDetails(e.VendorsList.SelectedValue,parseInt(l.Value)),a=function(e){if(i.Contains(s.Tables[0][e].DocDetailsID.toString())){var t=s.Tables[0].filter((function(t){return t.DynamicInvDocDetailsID==s.Tables[0][e].DocDetailsID}));e+=t.length}else{for(var o=s.Tables[0].filter((function(t){return t.DynamicInvDocDetailsID==s.Tables[0][e].DocDetailsID})),l=0;l<o.length;l++)s.Tables[0].RemoveAt(e),s.Tables[1].RemoveAt(e),s.Tables[2].RemoveAt(e),s.Tables[3].RemoveAt(e);s.Tables[0].RemoveAt(e),s.Tables[1].RemoveAt(e),s.Tables[2].RemoveAt(e),s.Tables[3].RemoveAt(e),e--,e-=o.length}r=e},r=0;r<s.Tables[0].length;r++)a(r);t.LoadLinkData(s,new Array,0,new Array,null),n.a.page.addNewTab({component:f.AddEditDocumentComponent,params:{obj:t}})}():u.ViewModel.DisplayMessage="Please place linking between Quotation and Purchase Order Docuemnt"})));case 4:case"end":return t.stop()}}),t,this)})))}},{key:"PostQuotationComparison",value:function(){var e=this,t=this.ViewModel.Preferences.ContainsKey("PQDCIPostOnlySelected"),o=this.ProductRows.filter((function(e){return 1==e.IsSelected}));0==o.length&&(o=this.ProductRows);var l=null;0==this.ComparisonDocID&&this.Quotations.length>0&&(0==(l=n.a.report.ReportDataTable("RPT022",this.ViewModel.IsReportDB,"select top  1 DCC.* from inv_docdetails D with(nolock) join com_docccdata DCC with(nolock) on DCC.InvDocDetailsID=D.InvDocDetailsID where D.VoucherNo='"+this.Quotations[0]+"'")).length&&(l=null)),m.RibbonExtViewModel.GetDocumentObject(this.QuotationComparisonDocument,"Post Document",this.ComparisonDocID>0,l).then((function(o){if(e.oDocument=o,0==e.ComparisonDocID&&!e.oDocument.DialogResult)return!1;e.oDocument.SaveCallBack=new I.b,e.oDocument.SaveCallBack.Subscribe(e,"OnSaveCallBack");var l=e.oDocument.ScreenObject.Link.LinkCombo.Items.find((function(t){return t.Parent==e.QuotationDocument.toString()}));if(l){for(var n,i="",a=new Array,r=new Array,u=0;u<e.Grid.Table.length;u++)for(var c=e.Grid.Table[u],d=0;d<e.Quotations.length;d++)if(null!=c["ReqQty"+d]&&!((n=parseFloat(c["ReqQty"+d]))<=0)){var h=parseInt(c.ReportRowId),C=e.ViewModel.Data[h].DataRow,p={};p[0]=parseInt(C["InvDocDetailsID_QTN"+d]),t&&a.push(p);var D=new R;D.InvID_QTN=parseInt(C["InvDocDetailsID_QTN"+d]),D.UsedQty=0,D.ReqQty=n,r.push(D)}for(var w=0;w<e.Quotations.length;w++)w>0&&(i+=","),i+="'"+e.Quotations[w]+"'";if(e.ComparisonDocID>0&&m.RibbonExtViewModel.OnDocPrefixChanged(e.oDocument,e.ComparisonDocID),i.length>0){for(var f,v,T=new Array,g=0;g<e.oDocument.GRIDTABLE.length;g++)null!=e.oDocument.GRIDTABLE[g].LinkedInvDocDetailsID&&0!=parseInt(e.oDocument.GRIDTABLE[g].LinkedInvDocDetailsID)&&T.push(g);i=i.Trim("'"),e.oDocument.FillLink(i,parseInt(l.Value),a,new Array);for(var V=0;V<e.oDocument.GRIDTABLE.length;V++)if(T.Contains(V)){f=e.oDocument.GRIDTABLE[V];for(var M=V+1;M<e.oDocument.GRIDTABLE.length;M++)null!=(v=e.oDocument.GRIDTABLE[M]).LinkedInvDocDetailsID&&parseInt(f.LinkedInvDocDetailsID)==parseInt(v.LinkedInvDocDetailsID)&&e.oDocument.GRIDTABLE.RemoveAt(M)}for(var Q=function(t){var o=e.oDocument.GRIDTABLE[t];o[e.ComparisonQtyField]=0,o[e.ComparisonStatusField]="",null!=o.LinkedInvDocDetailsID&&(S=r.find((function(e){return e.InvID_QTN==parseInt(o.LinkedInvDocDetailsID)})))&&(e.ComparisonQtyField.length>0&&e.oDocument.ScreenObject.GridDataColumns.Contains(e.ComparisonQtyField)&&(o[e.ComparisonQtyField]=S.ReqQty+S.UsedQty),e.ComparisonStatusField.length>0&&e.oDocument.ScreenObject.GridDataColumns.Contains(e.ComparisonStatusField)&&(o[e.ComparisonStatusField]="SELECTED"))},y=0;y<e.oDocument.GRIDTABLE.length;y++){var S;Q(y)}var A=new Array,N=e.ds.Tables[1];N.Sort="LinkedInvDocDetailsID";for(var P=0;P<N.length;P++){var b=N[P];if(null!=b.LinkedInvDocDetailsID){var G=new R;G.InvID_QTN=parseInt(b.InvDocDetailsID),G.InvID_MRN=parseInt(b.LinkedInvDocDetailsID),A.push(G)}}for(var F=function(t){var o=e.oDocument.GRIDTABLE[t];o.IndentID=0,null!=o.LinkedInvDocDetailsID&&0!=parseInt(o.LinkedInvDocDetailsID)&&(e.dvQuotations=e.dvQuotationsTable.filter((function(e){return e.InvDocDetailsID==o.LinkedInvDocDetailsID})),e.dvQuotations.length>0&&(o.IndentID=e.dvQuotations[0].LinkedInvDocDetailsID))},L=0;L<e.oDocument.GRIDTABLE.length;L++)F(L);var O=e.oDocument.GRIDTABLE.filter((function(e){return s.e.IsNum(e.ProductID_Key)&&0!=e.ProductID_Key}));O.SortBy(["IndentID"]);for(var k=0;k<O.length;k++)O[k].DocSeqNo=k+1;return e.oDocument.SaveInventoryDocument(0!=e.oDocument.DocID?"Revise":"Save",!0,!0,"SYNC_SAVE")}return e.ViewModel.DisplayMessage="Please enter PO Qty.",!1}return e.ViewModel.DisplayMessage="Please place linking between Quotation and Comparison Docuemnt",!1}))}},{key:"OnSaveCallBack",value:function(e,t){return null!=this.oDocument&&(this.ComparisonDocID=t,this.ViewModel.ComparisonINTERQTN=this.oDocument.ScreenObject.VoucherNo,this.ViewModel.DisplayMessage=this.oDocument.DisplayMessage,this.ViewModel.ShowMessageBox(this.oDocument.DisplayMessage,"Alert")),""}},{key:"SetSelectedColor",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(0!=this.FullSelectedClr.length||0!=this.PartialSelectedClr.length){var o=0;if(!t)for(var l=0;l<this.Quotations.length;l++)null!=e["ReqQty"+l]&&(o+=parseFloat(e["ReqQty"+l]));for(var n=parseInt(e.ReportRowId),s=this.ViewModel.Data[n],i=parseFloat(s.DataRow.Quantity),a=0;a<this.ViewModel.ReportColumns.length;a++)null==s.Cells[a].CellAppearance&&(s.Cells[a].CellAppearance=this.ViewModel.ReportColumns[a].DataAppearance.Clone()),s.Cells[a].IsNormal=!1,0==o?s.Cells[a].CellAppearance.ForeColor=this.ViewModel.ReportColumns[a].DataAppearance.ForeColor:o<i&&this.PartialSelectedClr.length>0?s.Cells[a].CellAppearance.ForeColor=this.PartialSelectedClr:o>=i&&this.FullSelectedClr.length>0&&(s.Cells[a].CellAppearance.ForeColor=this.FullSelectedClr);this.ViewModel.Data.RemoveAt(n),this.ViewModel.Data.Insert(n,s),this.ViewModel.SelectedRow==s&&(this.ViewModel.SelectedRow=null,this.ViewModel.SelectedRow=s)}}},{key:"Grid",get:function(){return this.ViewModel.ComparisonGrid},set:function(e){this.ViewModel.ComparisonGrid=e}}]),o}(i.b),T=function(e){_inherits(o,e);var t=_createSuper(o);function o(e,l,n,i){var a;_classCallCheck(this,o),(a=t.call(this)).IsOkClick=!1,a.iRowId=0,a.QTNCol="",a.MRNQty=0,a.oComp=e,a.VendorsList=new h.e,a.Quantity=new C.d,a.VendorsList.Label="Select Vendor",a.Quantity.Label="Select Quantity";for(var r=function(t){e.dvQuotations=e.dvQuotationsTable.filter((function(o){return o.VoucherNo==e.Quotations[t]})),null!=n&&null==n["InvDocDetailsID_QTN"+t]||(null!=n&&(a.MRNQty=parseFloat(n.Quantity)),a.VendorsList.Items.push(h.d.ComboBoxItems_3(e.dvQuotations[0].CreditAccountName.toString()+" ["+e.Quotations[t]+"]",e.Quotations[t],t.toString())),a.VendorsList.Items[a.VendorsList.Items.length-1].CurrID=parseInt(e.dvQuotations[0].CreditAccount),null!=n&&null!=n["InvDocDetailsID_QTN"+t]&&(e.dvQuotations=e.dvQuotationsTable.filter((function(e){return e.InvDocDetailsID==n["InvDocDetailsID_QTN"+t]})),e.dvQuotations.length>0&&(a.VendorsList.Items[a.VendorsList.Items.length-1].Aliasname=e.dvQuotations[0].Quantity.toString())))},u=0;u<e.Quotations.length;u++)r(u);return a.VendorsList.SelectedValue=!s.e.IsEmpty(l)&&a.VendorsList.Items.find((function(e){return e.Value==l}))?l:a.VendorsList.Items[0].Value,0==e.QuotationComparisonDocument?a.Quantity.Visible=!1:(a.Quantity.Text="0",a.iRowId=i,a.VendorsList.SelectionChangedCommand.Subscribe(_assertThisInitialized(a),"OnVendorChange"),a.OnVendorChange(null)),e.ViewModel.Preferences.ContainsKey("RestrictQTNQtyEdit")&&(a.Quantity.Enable=!1),a}return _createClass(o,[{key:"OnVendorChange",value:function(e){var t=this,o=0,l=this.VendorsList.GetselectedItem(),i=this.oComp.Grid.Table.filter((function(e){return e.ReportRowId==t.iRowId}));this.QTNCol=l.Parent,i.length>0&&(o=null!=i[0]["ReqQty"+l.Parent]?parseFloat(i[0]["ReqQty"+l.Parent]):0),0!=o||null==l||s.e.IsEmpty(l.Aliasname)||(o=parseFloat(l.Aliasname)),this.Quantity.Text=o.ToString("N"+n.a.SessionManager.Preferences.DecimalsinQty)}},{key:"OnButtonClick",value:function(e){var t=this;if(this.oComp.ViewModel.DisplayMessage="","Cancel"==e)n.a.page.HideDialog();else if("OK"==e){if(this.oComp.QuotationComparisonDocument>4e4){var o=s.e.Double(this.Quantity.Text),l=0,i=this.oComp.Grid.Table.filter((function(e){return e.ReportRowId==t.iRowId}));if(i.length>0&&(l=null!=i[0]["ExeQty"+this.QTNCol]?parseFloat(i[0]["ExeQty"+this.QTNCol]):0),o<0)return void(this.oComp.ViewModel.DisplayMessage="Please enter valid quantity");if(0==o){if(0==i.length)return void(this.oComp.ViewModel.DisplayMessage="Please enter valid quantity");for(var a=!1,r=0;r<this.oComp.Quotations.length;r++)if(r.toString()!=this.QTNCol&&null!=i[0]["ReqQty"+r]&&parseFloat(i[0]["ReqQty"+r])>0){a=!0;break}if(!a)return this.oComp.SetSelectedColor(i[0],!0),this.oComp.Grid.removeRow(i[0]),this.IsOkClick=!1,void n.a.page.HideDialog()}else{if(o<l)return void(this.oComp.ViewModel.DisplayMessage="Quantity should not be less than executed quantity");var u=this.VendorsList.GetselectedItem();if(null!=u&&!s.e.IsEmpty(u.Aliasname)&&this.oComp.ViewModel.Preferences.ContainsKey("QTNC_MRNQtyCheck")&&"1"==this.oComp.ViewModel.Preferences.QTNC_MRNQtyCheck){var c=o;if(i.length>0)for(var d=0;d<this.oComp.Quotations.length;d++)d.toString()!=this.QTNCol&&null!=i[0]["ReqQty"+d]&&parseFloat(i[0]["ReqQty"+d])>0&&(c+=parseFloat(i[0]["ReqQty"+d]));if(this.MRNQty<c)return void(this.oComp.ViewModel.DisplayMessage="Quantity should not be greater than requisition quantity")}}}this.IsOkClick=!0,n.a.page.HideDialog()}}}]),o}(d.b)}}]);
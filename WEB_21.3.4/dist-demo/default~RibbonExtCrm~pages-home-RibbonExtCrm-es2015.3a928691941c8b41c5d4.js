(window.webpackJsonp=window.webpackJsonp||[]).push([[55,141,150,160],{D3Vc:function(e,t,s){"use strict";s.r(t),s.d(t,"RibbonExtCrm",(function(){return Ve}));var i=s("Do2H"),a=s("vwWw"),o=s("mrSG"),l=s("Lp6j"),n=s("eQJW"),h=s("ScVY"),r=s("VxiT"),d=s("EQd/"),c=s("n56n"),C=s("0/4Q"),u=s("JIg3"),m=s("EggS"),b=s("EuF+"),S=s("v8xd");class p extends h.b{constructor(e,t,s,i,a){super(),this.Height=700,this.obj=new m.a,this.ScreenObject=new r.a,this.ParentId=0,this.CustomerCode=null,this.CustomerName=null,this.Status=null,this.Group=null,this.QuickAddVisibility=!1,this.DetailButtonVisibility=!0,this.RetVal=0,this.Load(e,t,s,t>0&&1==i||i,a)}get CustomerID(){return this.obj.CustomerID}set CustomerID(e){this.obj.CustomerID=e}Load(e,t,s,a,o){this.Parent=o,this.CustomerID=e,this.obj.CustomerID=this.CustomerID,this.ScreenObject.LoadQuickScreen(this,83,a),this.CustomerCode=this.ScreenObject.GetQuickCode(24200),this.CustomerName=this.ScreenObject.GetQuickText(24201),this.Status=this.ScreenObject.GetQuickCombo(24204),this.ParentId=s,this.obj.ParentID=s,this.obj.IsGroup=a,null!=this.Status&&(this.ScreenObject.Data.Tables[3].forEach(e=>{this.Status.Items.push(C.d.ComboBoxItems_2(e.Status.toString(),e.StatusID.toString()))}),this.Status.SelectedValue="393"),this.ScreenObject.InitAutoCode(this.ScreenObject.Data.Tables[6],this.obj.IsGroup),this.obj.CustomerID>0&&0==a?(this.LoadEditData(),null!=this.Group&&(this.Group.Enable=!1,this.Group.CCID=83,this.Group.TypeID=2)):(this.obj.GUID="",null!=this.Group&&(this.Group.CCID=83,this.Group.TypeID=2)),this.DisplayName=this.ScreenName,this.obj.SelectedNodeID=t,this.obj.IsGroup=a,0==this.CustomerID&&this.AutoGenerateCode();let l=this.ScreenObject.Data.Tables[5].filter(e=>"CapsLock"==e.Name);l.length>0&&Object(n.j)(l[0].Value)&&null!=this.CustomerName&&(this.CustomerName.IsAllCaps=!0),l=this.ScreenObject.Data.Tables[5].filter(e=>"CapsToFirstLetter"==e.Name),l.length>0&&Object(n.j)(l[0].Value)&&null!=this.CustomerName&&(this.CustomerName.IsFirstLetterCaps=!0),a?(this.DetailButtonVisibility=!1,this.CustomerID>0?(this.LoadEditData(),this.Title=i.a.GetResource("Customer_EditGroup")):this.Title=i.a.GetResource("Customer_AddGroup")):this.Title=i.a.GetResource(this.CustomerID>0?"Customer_EditCustomer":"Customer_AddCustomer"),this.QuickAddVisibility=!0,this.DisplayName=this.Title,null!=this.Group&&(this.Group.SelectedValue=s),Logger.InfoLog("QuickAddCustomersViewModel::Exiting QuickAddCustomersViewModel")}AutoGenerateCode(){0==this.CustomerID&&null!=this.CustomerCode&&this.ScreenObject.SetAutoCode(this.CustomerCode,this.obj.IsGroup,this.ParentId,this.ScreenObject.Data.Tables[6])}LoadEditData(){Logger.InfoLog("QuickAddCustomersViewModel::Entering LoadEditData");let e=this.obj.GetCustomerDetails();null!=this.CustomerCode&&(this.CustomerCode.Text=this.obj.CustomerCode,(this.ScreenObject.InheritParentCode||this.ScreenObject.IsAutoCode)&&(this.CustomerCode.Enable=!1));let t=null;e.Tables[7].length>0&&(t=e.Tables[7][0]),this.ScreenObject.FillControls(e.Tables[0][0],e.Tables[1][0],t,null),null!=this.Group&&(this.Group.SelectedValue=parseInt(e.Tables[0][0].ParentID)),Logger.InfoLog("QuickAddCustomersViewModel::Exiting LoadEditData")}OnSaveCustomer(e){return Object(o.b)(this,void 0,void 0,(function*(){if("Cancel"==e.toString())null!=this.Parent?(this.Parent.QuickAddCustomersVisibility=!1,this.Parent.SetDetailsVisibile(),this.QuickAddVisibility=!1,this.Parent.DetailsVisibility=!0):i.a.page.HideDialog();else if(Logger.InfoLog("QuickAddCustomersViewModel::Entering OnSaveCustomer"),"Details"==e.toString()){i.a.page.HideDialog();let e=new b.a(this.obj.CustomerID,this.obj.SelectedNodeID,this.obj.ParentID,this.obj.IsGroup);i.a.page.addNewTab({component:S.AddCustomerComponent,params:{obj:e}})}else try{let e=this.ScreenObject.ValidateData();if(!l.e.IsEmpty(e))return this.DisplayMessage=e,void(this.MessageVisibility=!0);if(0==this.obj.CustomerID){if(null!=this.CustomerCode){let e={StrCode:this.obj.CustomerCode,CodePrefix:this.obj.CodePrefix,CodeNumber:this.obj.CodeNumber};if(this.DisplayMessage=this.ScreenObject.SetAutoCodeParams_3(this.CustomerCode,this.ParentId,this.ScreenObject.Data.Tables[6],e),this.obj.CustomerCode=e.StrCode,this.obj.CodePrefix=e.CodePrefix,this.obj.CodeNumber=e.CodeNumber,this.DisplayMessage.length>0)return}else this.obj.CustomerCode=null!=this.CustomerCode?this.CustomerCode.Text:"";if(null!=this.CustomerName&&null!=this.CustomerName.Text&&""!=this.CustomerName.Text.Trim()&&(this.obj.CustomerName=this.CustomerName.Text),null==this.obj.AliasName&&(this.obj.AliasName=""),this.obj.SelectedNodeID=null!=this.Group&&this.Group.SelectedValue>0?this.Group.SelectedValue:this.ParentId,null!=this.Status&&this.Status.Enable&&null!=this.Status.SelectedValue&&""!=this.Status.SelectedValue&&(this.obj.StatusID=parseInt(this.Status.SelectedValue)),0==this.CustomerID&&(this.obj.AliasName=this.obj.CustomerName),this.obj.ContactsXML="",this.obj.NotesXML="",this.obj.AttachmetsXML="",this.obj.AddressXML="",this.obj.CustomFieldsQuery=this.ScreenObject.GetQuickExtraFieldsQuery(),this.obj.CustomCostCenterFieldsQuery=this.ScreenObject.GetQuickExtraCCFieldsQuery(),this.obj.PrimaryContactQuery="",!this.ScreenObject.ValidateDataonSave())return;let e=this.obj.SaveCustomer();this.DisplayMessage=e.Message,this.RetVal=e.RetValue}else{this.obj.StatusID=this.ScreenObject.GetTextComboValue_int(24204,0);let e=this.ScreenObject.GetStaticFieldsQuery();if(this.obj.StaticFieldsQuery=e,this.obj.CustomFieldsQuery=this.ScreenObject.GetQuickExtraFieldsQuery(),this.obj.CustomCostCenterFieldsQuery=this.ScreenObject.GetQuickExtraCCFieldsQuery(),!this.ScreenObject.ValidateDataonSave())return;let t=this.obj.SaveCustomerQuick();this.DisplayMessage=t.Message,this.RetVal=t.RetValue}this.MessageVisibility=!0,this.RetVal>0&&(this.AutoGenerateCode(),null!=this.CustomerName&&(this.CustomerName.Text=""),null!=this.Group&&(this.Group.SelectedValue=this.ParentId),null!=this.Parent&&(null!=this.Parent.SelectedNode&&(this.Parent.tree[0].SetFocusNodeID=this.Parent.SelectedNode.Id),this.Parent.Refresh()),this.ScreenObject.Clear(),null!=this.CustomerCode&&(this.CustomerCode.Text=""),Logger.InfoLog("QuickAddCustomersViewModel::Exiting OnSaveCustomer"))}catch(t){Logger.ErrorLog("QuickAddCustomersViewModel:: OnSaveCustomer"+t.stack)}}))}GetCustomFieldsQuery(){let e,t="";return this.ScreenObject.CustomFields.forEach(s=>{(s instanceof d.d||s instanceof C.e||s instanceof u.a)&&(e=null,t+=s.DBColumnName+"='null',")}),t.toString()}GetCustomCostCenterFieldsQuery(){let e,t="";return this.ScreenObject.CustomFields.forEach(s=>{s instanceof c.b&&(e=null,t+=s.DBColumnName+"='null',")}),t}}var D=s("NkMH"),g=s("CQvG"),T=s("DKUf"),I=s("r2z3"),V=s("2mtM"),y=s("ThYU"),w=s("c6C+"),L=s("8BPh"),M=s("xnJf"),A=s("THE7"),O=s("OvA8"),N=s("RJs6"),f=s("4HhE"),E=s("jgdN"),x=s("W7OG"),P=s("GQfG"),R=s("Jnyl"),v=s("wlFP");class j extends h.b{constructor(e){super(),this.ScreenObject=new r.a,this.ProductList=new c.b(0),this.FeedbackDate=new u.a(0),this.Technical=new d.c(0),this.SMS=new v.a(0),this.Email=new v.a(0),this.Commercial=new d.c(0),this.Fields=new Array,this.CVRVisibility=!0,this.SMSEmailVisibility=!1,this.GroupsItems=new Array,this.oText=null,this.oDate=null,this.oCombo=null,this.oTextArea=null,this.OComboText=null,this.Dset=null,this.CVRVisibility=!0,this.ClassName="CVRDataViewModel",this.FeedbackDate.Label=i.a.GetResource("Feed_Date"),this.ProductList.Label=i.a.GetResource("CVR_Product"),this.Technical.Label=i.a.GetResource("CVR_Technical"),this.Commercial.Label=i.a.GetResource("CVR_Commercial"),this.Title="CVR";try{this.ProductList.CCID=3,this.ProductList.TypeID=10,this.SMS.Label="SMS",this.Email.Label="Email",this.ProductList.Visible=!1;let t=i.a.crmService.GetFeedbackDetails(146);this.OnLoad(),this.Oparent=e;let s=0,a=0;for(let e=0;e<t.Tables[0].length;e++){if("TEXT"!=t.Tables[0][e].UserColumnType.toString()&&"NUMERIC"!=t.Tables[0][e].UserColumnType.toString()||("True"==t.Tables[0][e].Iscolumninuse.toString()&&"True"==t.Tables[0][e].IsColumnUserDefined.toString()&&(this.oText=new d.d(0),this.oText.Label=t.Tables[0][e].UserColumnName.toString(),this.oText.DBColumnName=t.Tables[0][e].COSTCENTERCOLID.toString(),this.oText.SysColumnName=t.Tables[0][e].SysColumnName.toString(),this.oText.Column=s,this.oText.Row=a,a+=1),this.Fields.push(this.oText)),"DATE"==t.Tables[0][e].UserColumnType.toString()&&("True"==t.Tables[0][e].Iscolumninuse.toString()&&"True"==t.Tables[0][e].IsColumnUserDefined.toString()&&(this.oDate=new u.a(0),this.oDate.Label=t.Tables[0][e].UserColumnName.toString(),this.oDate.DBColumnName=t.Tables[0][e].COSTCENTERCOLID.toString(),this.oDate.SysColumnName=t.Tables[0][e].SysColumnName.toString(),this.oDate.Column=s,this.oDate.Row=a,a+=1),this.Fields.push(this.oDate)),"COMBOBOX"==t.Tables[0][e].UserColumnType.toString()){if("True"==t.Tables[0][e].Iscolumninuse.toString()&&"True"==t.Tables[0][e].IsColumnUserDefined.toString()){this.oCombo=new C.e(0),this.oCombo.Label=t.Tables[0][e].UserColumnName.toString(),this.oCombo.DBColumnName=t.Tables[0][e].COSTCENTERCOLID.toString(),this.oCombo.SysColumnName=t.Tables[0][e].SysColumnName.toString(),this.oCombo.Column=s;let i=t.Tables[0][e].UserProbableValues.toString().Trim();if(i.length>0){let e=i.split(";");for(let t=0;t<e.length;t++)this.oCombo.Items.push(C.d.ComboBoxItems_2(e[t],e[t]));this.oCombo.SelectedValue=this.oCombo.Items[0].Value}this.oCombo.Row=a,a+=1}this.Fields.push(this.oCombo)}"TEXTAREA"==t.Tables[0][e].UserColumnType.toString()&&("True"==t.Tables[0][e].Iscolumninuse.toString()&&"True"==t.Tables[0][e].IsColumnUserDefined.toString()&&(this.oTextArea=new d.c(0),this.oTextArea.Label=t.Tables[0][e].UserColumnName.toString(),this.oTextArea.DBColumnName=t.Tables[0][e].COSTCENTERCOLID.toString(),this.oTextArea.SysColumnName=t.Tables[0][e].SysColumnName.toString(),this.oTextArea.Column=s,this.oTextArea.Row=a,a+=1),this.Fields.push(this.oTextArea)),"COMBOTEXT"==t.Tables[0][e].UserColumnType.toString()&&("True"==t.Tables[0][e].Iscolumninuse.toString()&&"True"==t.Tables[0][e].IsColumnUserDefined.toString()&&(this.OComboText=new R.a(0),this.OComboText.Label=t.Tables[0][e].UserColumnName.toString(),this.OComboText.DBColumnName=t.Tables[0][e].COSTCENTERCOLID.toString(),this.OComboText.SysColumnName=t.Tables[0][e].SysColumnName.toString(),this.OComboText.Column=s,this.OComboText.Row=a,a+=1),this.Fields.push(this.OComboText)),"LISTBOX"==t.Tables[0][e].UserColumnType.toString()&&("True"==t.Tables[0][e].Iscolumninuse.toString()&&"True"==t.Tables[0][e].IsColumnUserDefined.toString()&&(this.oPactCombo=new c.b(0),this.oPactCombo.CCID=parseInt(t.Tables[0][e].ColumnCostCenterID),this.oPactCombo.TypeID=0==t.Tables[0][e].ColumnCCListViewTypeID.toString().Trim().length?1:parseInt(t.Tables[0][e].ColumnCCListViewTypeID),this.oPactCombo.Label=t.Tables[0][e].UserColumnName.toString(),this.oPactCombo.DBColumnName=t.Tables[0][e].COSTCENTERCOLID.toString(),this.oPactCombo.SysColumnName=t.Tables[0][e].SysColumnName.toString(),this.oPactCombo.Column=s,this.oPactCombo.Row=a,a+=1),this.Fields.push(this.oPactCombo)),3==s&&(a+=1,s=0),s+=1}this.Dset=t}catch(t){throw Logger.ErrorLog("FeedbackViewModel:: FeedbackViewModel",t),t}Logger.InfoLog("FeedbackViewModel::Exiting FeedbackViewModel")}OnCheckedChanged(e){let t=e;if("0"==t.Value){if(this.GroupsItems.Contains(t))for(let e=0;e<this.GroupsItems.length;e++)this.GroupsItems[e].IsChecked=t.IsChecked}else t.IsChecked||this.GroupsItems.Contains(t)&&(this.GroupsItems[0].IsChecked=!1)}OnLoad(){let e=i.a.common.GetWorkFlowScreenDetails();if(null!=e&&e.Tables.length>2){this.GroupsItems.push(C.c.CheckedListBoxItem_3("All","0"));for(let t=0;t<e.Tables[2].length;t++)this.GroupsItems.push(C.c.CheckedListBoxItem_3(e.Tables[2][t].GroupName.toString(),e.Tables[2][t].GroupID.toString()))}}OnSave(e){try{if("EmailCancel"==e.toString())i.a.page.HideDialog();else if("Cancel"==e.toString())i.a.page.HideDialog();else if("Ok"==e.toString())i.a.page.HideDialog();else if("Save"==e.toString()){if(null==this.Oparent.SelectedRow){let e=this.Oparent.FeedBackDataObj.NewRow();e.Date=this.FeedbackDate.Date.ToString("dd/MMM/yyyy"),e.Product_Key=this.ProductList.SelectedValue,e.Product=this.ProductList.Text,e.Technical=this.Technical.Text,e.Commercial=this.Commercial.Text;for(let t=0;t<this.Fields.length;t++){let s=this.Fields[t];s instanceof d.d&&(this.oText=s,e[this.oText.SysColumnName]=this.oText.Text),s instanceof u.a&&(this.oDate=s,e[this.oDate.SysColumnName]=this.oDate.Date),s instanceof C.e&&(this.oCombo=s,e[this.oCombo.SysColumnName]=this.oCombo.SelectedValue),s instanceof R.a&&(this.OComboText=s,e[this.OComboText.SysColumnName]=this.OComboText.TextBox.Text),s instanceof d.c&&(this.oTextArea=s,e[this.oTextArea.SysColumnName]=this.oTextArea.Text),s instanceof c.b&&(this.oPactCombo=s,e[this.oPactCombo.SysColumnName]=this.oPactCombo.SelectedValue)}this.Oparent.FeedBackDataObj.addRow(e)}else{this.Oparent.SelectedRow.Date=this.FeedbackDate.Date.ToString("dd/MMM/yyyy"),this.Oparent.SelectedRow.Product_Key=this.ProductList.SelectedValue,this.Oparent.SelectedRow.Technical=this.Technical.Text,this.Oparent.SelectedRow.Commercial=this.Commercial.Text,this.Oparent.SelectedRow.Product=this.ProductList.Text;for(let e=0;e<this.Fields.length;e++){let t=this.Fields[e];t instanceof d.d&&(this.oText=t,this.Oparent.SelectedRow[this.oText.SysColumnName]=this.oText.Text),t instanceof u.a&&(this.oDate=t,this.Oparent.SelectedRow[this.oDate.SysColumnName]=this.oDate.Date),t instanceof C.e&&(this.oCombo=t,this.Oparent.SelectedRow[this.oCombo.SysColumnName]=this.oCombo.SelectedValue),t instanceof R.a&&(this.OComboText=t,this.Oparent.SelectedRow[this.OComboText.SysColumnName]=this.OComboText.TextBox.Text),t instanceof d.c&&(this.oTextArea=t,this.Oparent.SelectedRow[this.oTextArea.SysColumnName]=this.oTextArea.Text),t instanceof c.b&&(this.oPactCombo=t,this.Oparent.SelectedRow[this.oPactCombo.SysColumnName]=this.oPactCombo.SelectedValue)}this.Oparent.FeedBackDataObj.updateRow(this.Oparent.SelectedRow),this.Oparent.SelectedRow=null}this.ProductList.SelectedValue=0,this.Commercial.Text="",this.Technical.Text="",this.ClearFields()}}catch(t){throw Logger.ErrorLog("FeedbackViewModel:: OnSave",t),t}Logger.InfoLog("FeedbackViewModel::Exiting OnSave")}ClearFields(){for(let e=0;e<this.Fields.length;e++){let t=this.Fields[e];t instanceof d.d&&(this.oText=t,this.oText.Text=""),t instanceof u.a&&(this.oDate=t),t instanceof C.e&&(this.oCombo=t,this.oCombo.SelectedValue=""),t instanceof R.a&&(this.OComboText=t,this.OComboText.TextBox.Text=""),t instanceof d.c&&(this.oTextArea=t,this.oTextArea.Text=""),t instanceof c.b&&(this.oPactCombo=t,this.oPactCombo.SelectedValue=0)}}}var G=s("8B8H"),F=s("ockk"),k=s("Q5a/");class B extends h.b{constructor(e){super(),this.Module="CRM",this.Visible=!0,this.ColumnSpan="4",this.FeedBackDataObj=new G.a,this.res="";try{this.Parent=e,this.ClassName="ViewCVRViewModel";let t,s=i.a.crmService.GetFeedbackDetails(146).Tables[0];this.FeedBackDataObj.Table=[],this.FeedBackDataObj.TableColumns.push("Product"),this.FeedBackDataObj.TableColumns.push("Product_Key"),this.FeedBackDataObj.TableColumns.push("Date"),this.FeedBackDataObj.TableColumns.push("Technical"),this.FeedBackDataObj.TableColumns.push("Commercial"),this.FeedBackDataObj.TableColumns.push("Print");for(let e=1;e<=50;e++)this.FeedBackDataObj.TableColumns.push("Alpha"+e);let a=new Array;this.FeedBackDataObj.Columns=a,t=new F.a,t.Header=i.a.GetResource("Print"),t.DisplayMember="Print",t.DataType="CheckBox",t.Width=50,t.IsVisible=!0,a.push(t),t=new F.a,t.Header=i.a.GetResource("Feed_Date"),t.DisplayMember="Date",t.DataType="TEXTBOX",t.Width=150,t.IsVisible=!0,t.ReadOnly=!0,a.push(t),t=new F.a,t.Header=i.a.GetResource("CVR_Product"),t.DisplayMember="Product",t.DataType="TEXTBOX",t.Width=150,t.IsVisible=!1,t.ReadOnly=!0,a.push(t),t=new F.a,t.Header=i.a.GetResource("CVR_Technical"),t.DisplayMember="Technical",t.DataType="TEXTBOX",t.Width=150,t.IsVisible=!0,t.ReadOnly=!0,a.push(t),t=new F.a,t.Header=i.a.GetResource("CVR_Commercial"),t.DisplayMember="Commercial",t.DataType="TEXTBOX",t.Width=150,t.IsVisible=!0,t.ReadOnly=!0,a.push(t);for(let e=0;e<s.length;e++)"True"==s[e].IsVisible.toString()&&(t=new F.a,t.Header=s[e].UserColumnName.toString(),t.DisplayMember=s[e].SysColumnName.toString(),t.DataType="TEXTBOX",t.Width=150,t.IsVisible=!0,t.ReadOnly=!0,a.push(t))}catch(t){throw Logger.ErrorLog("ViewFeedbackViewModel:: ViewFeedbackViewModel",t),t}Logger.InfoLog("ViewFeedbackViewModel::Exiting ViewFeedbackViewModel")}get angularGrid(){return this.FeedBackDataObj.angularGrid}get SelectedRow(){return this.FeedBackDataObj.SelectedItem}set SelectedRow(e){this.FeedBackDataObj.SelectedItem=e}get FeedBackData(){return this.FeedBackDataObj.Table}OnNewClick(e){"New"==e?(this.Parent.CVR=new j(this),this.Parent.CVR.ClearFields(),this.FeedBackDataObj.SelectedItem=null,this.Parent.CVR.CVRVisibility=!0,i.a.page.ShowDialog(this.Parent.CVR,k.a)):"Assign"==e&&(this.Parent.CVR.CVRVisibility=!1,this.Parent.CVR.SMSEmailVisibility=!0)}OnCmnItem_Click(e){switch(Logger.InfoLog("ViewFeedbackViewModel::Entering OnCmnItem_Click"),this.Parent.CVRVisibility||(this.Parent.CVRVisibility=!0),e){case"EDIT":if(null!=this.SelectedRow){let e=this.SelectedRow;if(!l.e.IsEmpty(e.Date)){this.Parent.CVR.FeedbackDate.Date=new Date(e.Date),l.e.IsEmpty(e.Product)||(this.Parent.CVR.ProductList.SelectedValue=parseInt(e.Product_Key)),this.Parent.CVR.Technical.Text=e.Technical.toString(),this.Parent.CVR.Commercial.Text=e.Commercial.toString();let t,s=null,i=null,a=null,o=null,n=null;for(let l=0;l<this.Parent.CVR.Fields.length;l++){let h=this.Parent.CVR.Fields[l];h instanceof d.d&&(s=h,s.Text=e[s.SysColumnName].toString()),h instanceof u.a&&(i=h,i.Date=new Date(e[i.SysColumnName].toString())),h instanceof C.e&&(a=h,a.SelectedValue=e[a.SysColumnName].toString()),h instanceof R.a&&(n=h,n.TextBox.Text=e[n.SysColumnName].toString()),h instanceof d.c&&(o=h,o.Text=e[o.SysColumnName].toString()),h instanceof c.b&&(t=h,""!=e[t.SysColumnName].toString()&&null!=e[t.SysColumnName]&&(t.SelectedValue=parseInt(e[t.SysColumnName])))}}i.a.page.ShowDialog(this.Parent.CVR,k.a)}break;case"DELETE":null!=this.SelectedRow&&this.FeedBackDataObj.removeRow(this.SelectedRow)}Logger.InfoLog("ViewFeedbackViewModel::Exiting OnCmnItem_Click")}OnMessageCallBack(){this.res="Yes"}GetXML(){Logger.InfoLog("ViewFeedbackViewModel::Entering GetXML");try{let e="";e+="<XML>";for(let t=0;t<this.FeedBackData.length;t++)if(""!=this.FeedBackData[t].Date.toString()){e+="<Row ",e+=' Date="'+this.FeedBackData[t].Date+'"',e+=' Product="'+B.GetValidXml(this.FeedBackData[t].Product_Key.toString())+'"',e+=' Technical="'+B.GetValidXml(this.FeedBackData[t].Technical.toString())+'"',e+=' Commercial="'+B.GetValidXml(this.FeedBackData[t].Commercial.toString())+'"';for(let s=1;s<=50;s++)e+=" Alpha"+s+'="'+B.GetValidXml(this.FeedBackData[t]["Alpha"+s].toString())+'"';e+="></Row>  "}return e+="</XML>",e.toString()}catch(e){return""}Logger.InfoLog("ViewFeedbackViewModel::Exiting GetXML")}static GetValidXml(e){return(e=(e=(e=e.Replace("&","&amp;")).Replace("'","&apos;&apos;")).Replace('"',"&quot;")).Replace("<","&lt;")}static GetValidXmlReserve(e){return(e=(e=(e=e.Replace("&amp;","&")).Replace("''","'")).Replace("&quot;",'"')).Replace("&lt;","<")}LoadData(e){try{for(let t=0;t<e.length;t++){let s=this.FeedBackDataObj.NewRow();s.Date=new Date(e[t].d).ToString("dd/MMM/yyyy"),s.Product=l.e.String(e[t].PRODUCT1),s.Product_Key=l.e.String(e[t].PRODUCTID),s.Technical=B.GetValidXmlReserve(l.e.String(e[t].TechnicalInfo)),s.Commercial=B.GetValidXmlReserve(l.e.String(e[t].CommercialInfo));for(let i=1;i<=50;i++)s["Alpha"+i]=B.GetValidXmlReserve(l.e.String(e[t]["Alpha"+i]));this.FeedBackDataObj.addRow(s)}}catch(t){throw t}Logger.InfoLog("ViewFeedbackViewModel::Exiting LoadData")}}var _=s("E6JT"),U=s("nFYD"),X=s("N0rE"),H=s("wunX"),Q=s("7oCR");class W extends h.b{constructor(e,t,s){super(),this.LED=new I.a,this.Oppor=new Q.a,this.ds=null,this.CCID=0,this.Leads=new v.a(86),this.AddressDetails=new v.a(86),this.Opportunity=new v.a(86),this.Account=new v.a(86),this.Customer=new v.a(86),this.AccountContactVisible=new v.a(2),this.CustomerContactVisible=new v.a(86),this.Contact=new v.a(86),this.Ret=0,this.Title=this.DisplayName=i.a.GetResource("CRMLead_ConvertTo"),this.Leads.DBColumnName="Leads",this.Opportunity.DBColumnName="Opportunity",this.AddressDetails.DBColumnName="AddressDetails",this.Account.DBColumnName="Account",this.Customer.DBColumnName="Customer",this.AccountContactVisible.DBColumnName="AccountContactVisible",this.CustomerContactVisible.DBColumnName="CustomerContactVisible",this.Contact.DBColumnName="Contact",this.Leads.Label=i.a.GetResource("Leads"),this.Opportunity.Label=i.a.GetResource("CRMLead_Opportunity"),this.AddressDetails.Label=i.a.GetResource("CRMLead_CopyContacts"),this.Account.Label=i.a.GetResource("CRMLead_Account"),this.Customer.Label=i.a.GetResource("CRMLead_Customer"),this.AccountContactVisible.Label=i.a.GetResource("CRMLead_CopyContacts"),this.CustomerContactVisible.Label=i.a.GetResource("CRMLead_CopyContacts"),this.Contact.Label=i.a.GetResource("CRMLead_Contact"),this.CustomerContactVisible.Visible=!1,this.AccountContactVisible.Visible=!1,this.AddressDetails.Visible=!1,this.Opportunity.CheckedChangedCommand.Subscribe(this,"Opportunity_PropertyChanged"),this.Account.CheckedChangedCommand.Subscribe(this,"Account_PropertyChanged"),this.Customer.CheckedChangedCommand.Subscribe(this,"Customer_PropertyChanged"),this.CCID=s,88==this.CCID?(this.Campgn.CampaignId=e,this.ds=this.Campgn.GetCompaignDetails(),0!=this.ds.Tables[21].length&&(this.Opportunity.IsChecked=!0,this.Opportunity.Enable=!1),0!=this.ds.Tables[22].length&&(this.Leads.IsChecked=!0,this.Leads.Enable=!1),this.Leads.Visible=!0,this.Opportunity.Visible=!0,this.Customer.Visible=!1,this.Account.Visible=!1,this.Contact.Visible=!1):89==this.CCID?(this.Oppor.OpportunityID=e,this.Leads.Visible=!1,this.Opportunity.Visible=!1,this.Account.Visible=!0,this.Contact.Visible=!1,this.Customer.Visible=!0,this.AddressDetails.Visible=!1,this.ds=this.Oppor.GetOpportunity(e),null!=this.ds&&this.ds.Tables.length>15&&0!=this.ds.Tables[16].length&&(this.Customer.IsChecked=!0,this.Customer.Enable=!1),null!=this.ds&&this.ds.Tables.length>16&&0!=this.ds.Tables[17].length&&(this.Account.IsChecked=!0,this.Account.Enable=!1),this.CustomerContactVisible.Visible=!1,this.AccountContactVisible.Visible=!1):(this.LED.LeadID=e,this.ds=t,this.Account.Enable=!0,this.Customer.Enable=!0,this.ds.Tables[0].length>0&&!l.e.IsEmpty(this.ds.Tables[0][0].Mode.toString())&&""!=this.ds.Tables[0][0].Mode.toString()&&("2"==this.ds.Tables[0][0].Mode.toString()&&(this.Account.Enable=!1),"3"==this.ds.Tables[0][0].Mode.toString()&&(this.Customer.Enable=!1)),this.ds.Tables[5].length>0&&(this.Opportunity.IsChecked=!0,this.Opportunity.Enable=!1,this.AddressDetails.Visible=!1),this.ds.Tables[6].length>0&&(this.Customer.IsChecked=!0,this.Customer.Enable=!1,this.CustomerContactVisible.Visible=!1),this.ds.Tables[14].length>0&&(this.Account.IsChecked=!0,this.Account.Enable=!1,this.AccountContactVisible.Visible=!1),(this.ds.Tables[7].length>0&&"0"!=this.ds.Tables[7][0][0].toString()||this.ds.Tables[0].length>0&&!l.e.IsEmpty(this.ds.Tables[0][0].ContactID.toString())&&""!=this.ds.Tables[0][0].ContactID.toString()&&"0"!=this.ds.Tables[0][0].ContactID.toString())&&(this.Contact.IsChecked=!0,this.Contact.Enable=!1),this.Opportunity.Visible=!!i.a.SessionManager.IsActionAssigned(86,"Convert_Opportunity"),this.Customer.Visible=!!i.a.SessionManager.IsActionAssigned(86,"Convert_Customer"),this.Account.Visible=!!i.a.SessionManager.IsActionAssigned(86,"Convert_Account"),this.Contact.Visible=!!i.a.SessionManager.IsActionAssigned(86,"Convert_Contact"),this.Leads.Visible=!1,this.Opportunity.Visible||this.Customer.Visible||this.Account.Visible||this.Contact.Visible||(this.DisplayMessage="Access Denied"))}Opportunity_PropertyChanged(e){86==this.Opportunity.DBColumnID&&this.Opportunity.IsChecked?this.AddressDetails.Visible=!0:86==this.Account.DBColumnID&&(this.AddressDetails.Visible=!1)}Account_PropertyChanged(e){86==this.Account.DBColumnID&&this.Account.IsChecked?this.AccountContactVisible.Visible=!0:86==this.Account.DBColumnID&&(this.AccountContactVisible.Visible=!1)}Customer_PropertyChanged(e){86==this.Customer.DBColumnID&&this.Customer.IsChecked?this.CustomerContactVisible.Visible=!0:86==this.Customer.DBColumnID&&(this.CustomerContactVisible.Visible=!1)}OnSave(e){if("Cancel"==e)i.a.page.HideDialog();else if(86==this.CCID)if(null!=this.ds&&0!=this.ds.Tables[5].length&&0!=this.ds.Tables[6].length&&0!=this.ds.Tables[7].length)this.DisplayMessage="Already Converted";else if(Logger.InfoLog("Convertion :: Entering OnConvertionLead"),this.Opportunity.IsChecked||this.Contact.IsChecked||this.Customer.IsChecked||this.Account.IsChecked){this.LED.ConvOpportunity=this.Opportunity.IsChecked,this.LED.ConvContact=this.Contact.IsChecked,this.LED.ConvCustomer=this.Customer.IsChecked,this.LED.ConvAccount=this.Account.IsChecked,this.LED.ConvCustomerContacts=this.CustomerContactVisible.IsChecked,this.LED.ConvAccountContacts=this.AccountContactVisible.IsChecked,this.LED.ConvLeadAddressDetails=this.AddressDetails.IsChecked;let e=this.LED.ConvertLead();this.DisplayMessage=e.Message,this.Ret=e.RetValue,this.Ret>0&&(this.Opportunity.Enable=!this.Opportunity.IsChecked,this.Customer.Enable=!this.Customer.IsChecked,this.Account.Enable=!this.Account.IsChecked,this.Contact.Enable=!this.Contact.IsChecked)}else this.DisplayMessage="Select atleast one option";else if(88==this.CCID)if(this.Opportunity.IsChecked||this.Leads.IsChecked){this.LED.ConvOpportunity=this.Opportunity.IsChecked,this.LED.ConvLead=this.Leads.IsChecked,this.LED.CampaignID=this.Campgn.CampaignId;let e=this.LED.ConvertLeadFromCampaign();this.DisplayMessage=e.Message,this.Ret=e.RetValue,this.Ret>0&&(this.Opportunity.Enable=!this.Opportunity.IsChecked,this.Leads.Enable=!this.Leads.IsChecked)}else this.DisplayMessage="Select atleast one option";else if(89==this.CCID)if(this.Customer.IsChecked||this.Account.IsChecked){this.Oppor.ConvAccount=this.Account.IsChecked,this.Oppor.ConvCustomer=this.Customer.IsChecked,this.Oppor.ConvCustomerContacts=this.CustomerContactVisible.IsChecked,this.Oppor.ConvAccountContacts=this.AccountContactVisible.IsChecked;let e=this.Oppor.ConvertOpportunity();this.DisplayMessage=e.Message,this.Ret=e.RetValue,this.Ret>0&&(this.Customer.Enable=!this.Customer.IsChecked,this.Account.Enable=!this.Account.IsChecked)}else this.DisplayMessage="Select atleast one option"}}var J=s("/W8Q"),K=s("EPb/"),z=s("CXnT"),Y=s("wnwj"),q=s("7i9q"),Z=s("2Dtv"),$=s("yWgc"),ee=s("F+4J");class te extends h.b{constructor(e){super(),this.ColumnSpan="4",this.ListObj=new G.a,Logger.InfoLog("ViewAssignCRMHistroyViewModel::Entering ViewAssignCRMHistroyViewModel with Parent="+e),this.Parent=e,this.ListObj.Table=[],this.ListObj.Columns=[],this.ListObj.TableColumns.push("From"),this.ListObj.TableColumns.push("AssignFrom"),this.ListObj.TableColumns.push("AssignTo"),this.ListObj.TableColumns.push("Date"),this.ListObj.TableColumns.push("Description"),Logger.InfoLog("ViewAssignCRMHistroyViewModel::Exiting ViewAssignCRMHistroyViewModel ")}LoadCRMHistroy_1(e,t){Logger.InfoLog("ViewAssignCRMHistroyViewModel::Entering LoadHistroy");try{this.ListObj.Clear();let s=(new ee.a).GetCRMHistoryDetails(e,t);if(null!=s&&s.Tables.length>0&&s.Tables[0].length>0)for(let e=0;e<s.Tables[0].length;e++){let t=this.ListObj.NewRow();t.From=s.Tables[0][e].IsFrom.toString(),t.AssignFrom=s.Tables[0][e].ASSIGNEDFROM.toString(),t.AssignTo=s.Tables[0][e].ASSIGNEDTO.toString(),t.Date=new Date(s.Tables[0][e].DATE).ToString(i.a.SessionManager.Preferences["Date Format"].toString()),t.Description=s.Tables[0][e].Description.toString(),this.ListObj.addRow(t)}}catch(s){Logger.InfoLog("ViewAssignCRMHistroyViewModel::Exiting LoadHistroy")}Logger.InfoLog("ViewAssignCRMHistroyViewModel::Exiting LoadHistroy")}LoadCRMHistroy(e){try{if(this.ListObj.Clear(),null!=e&&e.length>0)for(let t=0;t<e.length;t++){let s=this.ListObj.NewRow();s.From=e.Rows[t].IsFrom.toString(),s.AssignFrom=e.Rows[t].ASSIGNEDFROM.toString(),s.AssignTo=e.Rows[t].ASSIGNEDTO.toString(),s.Date=new Date(e.Rows[t].DATE).ToString(i.a.SessionManager.Preferences["Date Format"].toString()),s.Description=e.Rows[t].Description.toString(),this.ListObj.addRow(s)}}catch(t){}}}class se extends h.b{constructor(e,t,s){super(),this.timerDraft=new l.d,this.LED=new I.a,this.LeadID=0,this.DefaultcontactsVisible=!1,this.ContactsBasedOnLeads=!1,this.IncludeNewInMode=!1,this.PrintVisible=!1,this.NextPreviousVisibility=!0,this.AssignVisiblity=!1,this.IsAssign=!1,this.CloseVisiblity=!1,this.ContactVisibility=!1,this.CostCenterID=0,this.ScreenObject=new r.a,this.ButtonEnable=!0,this.Code=new d.a(24198),this.Mode=new C.e(26637),this.Date=new u.a(25068),this.Status=new C.e(24400),this.Subject=new d.d(25069),this.AssignedTo=new d.d(25534),this.ContactList=new C.e(26651),this.Company=new c.c(24399),this.Source=new c.b(25071),this.Rating=new c.b(25072),this.Campaign=new c.b(25073),this.Industry=new c.b(25074),this.Salutation=new c.b(25042),this.FirstName=new d.d(25039),this.MiddleName=new d.d(25040),this.LastName=new d.d(25041),this.JobTitle=new d.d(25043),this.Phone1=new d.d(25044),this.Phone2=new d.d(25045),this.Email=new d.d(25046),this.Fax=new d.d(25047),this.Department=new d.d(25048),this.Role=new c.b(25049),this.Gender=new C.e(25057),this.Birthday=new u.a(25058),this.Anniversary=new u.a(25059),this.Address1=new d.d(25050),this.Address2=new d.d(25051),this.Address3=new d.d(25052),this.City=new d.d(25053),this.State=new d.d(25054),this.Zip=new d.d(25055),this.Country=new C.e(25056),this.CreatedDate=new u.a(25535),this.Owner=new d.d(25532),this.ContactPersonColID=0,this.PrimaryVisibility=!1,this.ActVisibility=!1,this.NodeID=0,this.StatusColor="#736F6F",this.ProductVisiblity=!1,this.Ret=0,this.ParentId=1,this.IsGroup=!1,this.dvContacts=null,this.dvContactsTable=null,this.dsLeadData=null,this.isCust=!1,this.isAccount=!1,this.isLead=!1,this.lstModeDetails=new Array,this.bShowAssignedCustomers=!1,this.ClassName="AddEditLeads";try{if(this.ParentId=t,this.IsGroup=s,this.LED.SelectedNodeID=this.ParentId,this.ScreenObject.LoadScreen_2(this,86),this.CostCenterID=86,this.NodeID=e,this.Company.Code.Visible=!1,this.Company.TextVisible=!0,null!=this.ScreenObject.Data&&this.ScreenObject.Data.Tables[4].length>0){let e=this.ScreenObject.Data.Tables[4].filter(e=>"ActContactPerson"==e.Name);e.length>0&&!l.e.IsEmpty(e[0].Value)&&(this.ContactPersonColID=parseInt(e[0].Value)),e=this.ScreenObject.Data.Tables[4].filter(e=>"AutoDraft"==e.Name),e.length>0&&!l.e.IsEmpty(e[0].Value)&&(this.timerDraft.Enabled=Object(n.j)(e[0].Value)),this.timerDraft.Enabled&&(e=this.ScreenObject.Data.Tables[4].filter(e=>"AutoDraftTime"==e.Name),this.timerDraft.Interval=e.length>0&&!l.e.IsEmpty(e[0].Value)?1e3*parseInt(e[0].Value):6e4,this.timerDraft.Elapsed(this,"timerDraft_Elapsed")),e=this.ScreenObject.Data.Tables[4].filter(e=>"ContactsBasedOnLeads"==e.Name),e.length>0&&!l.e.IsEmpty(e[0].Value)&&(this.ContactsBasedOnLeads=Object(n.j)(e[0].Value)),e=this.ScreenObject.Data.Tables[4].filter(e=>"IncludeNewInMode"==e.Name),e.length>0&&!l.e.IsEmpty(e[0].Value)&&(this.IncludeNewInMode=Object(n.j)(e[0].Value)),e=this.ScreenObject.Data.Tables[4].filter(e=>"CapsLock"==e.Name),e.length>0&&Object(n.j)(e[0].Value)&&(this.Company.IsAllCaps=!0),e=this.ScreenObject.Data.Tables[4].filter(e=>"CapsToFirstLetter"==e.Name),e.length>0&&Object(n.j)(e[0].Value)&&(this.Company.IsFirstLetterCaps=!0)}if(this.ViewContactMethod=new X.ContactMethod,this.LeadID=e,this.ViewAssignHistroy=new V.a(this),this.ViewCRMHistroy=new te(this),this.ViewActivities=new g.b(this),this.Activities=new T.a(this,!1),this.ViewActivities.Activities=this.Activities,this.ViewNotes=new N.a(this),this.ViewFeedback=new U.a(this),this.ViewCVRViewModel=new B(this),this.Note=new w.AddNoteViewModel,this.Attachment=new M.AddAttachmentViewModel,this.CVR=new j(this.ViewCVRViewModel),this.Feedback=new _.a(this.ViewFeedback),this.Mode.SelectionChangedCommand.Subscribe(this,"OnModeChange"),this.Status.SelectionChangedCommand.Subscribe(this,"onStatusSelectionChanged"),this.ContactList.SelectionChangedCommand.Subscribe(this,"onContactlistChanged"),this.ViewAttachments=new O.ViewAttachmentViewModel(this),this.LeadsProduct=new x.a(this,86),this.PriContact=new L.a,this.PriContact.QuickAddDContactViewModel_1(this),this.PriContact.IsPrimaryContact=!0,this.ViewContacts=new A.a(this),this.ButtonApprove=new D.a,this.ButtonClose=new D.a,this.ButtonConvert=new D.a,this.ButtonAssign=new D.a,this.ButtonSave=new D.a,this.ButtonEmail=new D.a,this.worker_DoWork(),this.AutoGenerateCode(),0==this.LeadID?(this.Owner.Text=i.a.SessionManager.UserName,this.CreatedDate.Text=(new Date).ToString(i.a.SessionManager.Preferences["Date Format"]+" hh:mm a"),this.DisplayName=i.a.GetResource("CRMLead_AddLead"),this.LED.GUID="Guid",this.LeadStatus="UnApproved",this.NextPreviousVisibility=!1,this.ButtonConvert.Visible=!1,this.ButtonApprove.Visible=!1,this.ButtonClose.Visible=!1,this.Campaign.CCID=88,this.Campaign.TypeID=2):(this.Campaign.CCID=88,this.Campaign.TypeID=2,this.ButtonConvert.Visible=!0,this.ButtonApprove.Visible=!0,this.Load(this.LeadID),this.DisplayName=i.a.GetResource("CRMLead_EditLead"),this.PrintVisible=!0),this.Title=this.DisplayName,this.loadtabs(),this.ScreenObject.CheckEstimateRevenueMapping(this.LeadsProduct.DestProductValueMapping),0==this.LeadID?i.a.SessionManager.HideUnathorizedAccess?this.ButtonSave.Visible=i.a.SessionManager.IsActionAssigned(86,"Create"):this.ButtonSave.Enable=i.a.SessionManager.IsActionAssigned(86,"Create"):i.a.SessionManager.HideUnathorizedAccess?this.ButtonSave.Visible=i.a.SessionManager.IsActionAssigned(86,"Update"):this.ButtonSave.Enable=i.a.SessionManager.IsActionAssigned(86,"Update"),0!=this.LeadID&&(i.a.SessionManager.HideUnathorizedAccess?this.ButtonApprove.Visible=i.a.SessionManager.IsActionAssigned(86,"Approved"):this.ButtonApprove.Enable=i.a.SessionManager.IsActionAssigned(86,"Approved")),0!=this.LeadID?(i.a.SessionManager.HideUnathorizedAccess?this.ButtonConvert.Visible=i.a.SessionManager.IsActionAssigned(86,"Convert"):this.ButtonConvert.Enable=i.a.SessionManager.IsActionAssigned(86,"Convert"),i.a.SessionManager.HideUnathorizedAccess?this.ButtonAssign.Visible=i.a.SessionManager.IsActionAssigned(86,"Assign"):this.ButtonAssign.Enable=i.a.SessionManager.IsActionAssigned(86,"Assign")):this.ButtonAssign.Visible=!1,0!=this.LeadID&&(i.a.SessionManager.HideUnathorizedAccess?this.ButtonEmail.Visible=i.a.SessionManager.IsActionAssigned(86,"Email"):this.ButtonEmail.Enable=i.a.SessionManager.IsActionAssigned(86,"Email")),this.Owner.Enable=!1,this.AssignedTo.Enable=!1,this.CreatedDate.Enable=!1,this.Company.Code.SelectionChangedCommand.Subscribe(this,"onCompanySelectionChanged"),this.ContactList.SelectionChangedCommand.Subscribe(this,"onContactlistChanged"),this.PrimaryVisibility=!0,this.ContactVisibility=!1,this.PriContact.Visiblebtns=!1,null!=this.ScreenObject.Data&&this.ScreenObject.Data.Tables[4].length>0){let e=this.ScreenObject.Data.Tables[4].filter(e=>"HidePrimaryContact"==e.Name);this.PrimaryVisibility=e.length>0&&!Object(n.j)(e[0].Value)}this.ScreenObject.HeaderFields.sort((e,t)=>e.Row>t.Row||e.Row==t.Row&&e.Column>t.Column?1:-1)}catch(a){Logger.ErrorLog("AddEditLeads:: AddEditLeads"+a.stack)}Logger.InfoLog("AddEditLeads::Exiting AddEditLeads")}OnMessageCallBack(){this.res="Yes"}OnAddNote(){this.Note=new w.AddNoteViewModel,this.Note.AddNoteViewModel_2(this)}OnAddContact(){this.Contact=new L.a,this.Contact.QuickAddDContactViewModel_1(this)}OnAddAttachment(){this.Attachment=new M.AddAttachmentViewModel,this.Attachment.AddAttachmentViewModel_2(this)}timerDraft_Elapsed(e,t){let s=i.a.page.tabs.find(e=>{var t;return(null===(t=e.params)||void 0===t?void 0:t.obj)==this});s&&s.active&&this.timerDraft.Enabled&&this.OnSave("SaveDraft")}EnableControls(e){this.FirstName.Visible&&(this.FirstName.Enable=e,this.FirstName.Text=""),this.LastName.Visible&&(this.LastName.Enable=e,this.LastName.Text=""),this.MiddleName.Visible&&(this.MiddleName.Enable=e,this.MiddleName.Text=""),this.Salutation.Visible&&(this.Salutation.Enable=e,this.Salutation.SelectedValue=0),this.JobTitle.Visible&&(this.JobTitle.Enable=e,this.JobTitle.Text=""),this.Phone1.Visible&&(this.Phone1.Enable=e,this.Phone1.Text=""),this.Phone2.Visible&&(this.Phone2.Enable=e,this.Phone2.Text=""),this.Email.Visible&&(this.Email.Enable=e,this.Email.Text=""),this.Fax.Visible&&(this.Fax.Enable=e,this.Fax.Text=""),this.Department.Visible&&(this.Department.Enable=e,this.Department.Text=""),this.Role.Visible&&(this.Role.Enable=e,this.Role.SelectedValue=0)}onContactlistChanged(e){this.EnableControls(!0),null!=this.dvContacts&&null!=this.ContactList.SelectedValue&&"0"!=this.ContactList.SelectedValue&&(this.dvContacts=this.dvContactsTable.filter(e=>e.ContactID==this.ContactList.SelectedValue),this.dvContacts.length>0&&(this.EnableControls(!1),this.FirstName.Visible&&(this.FirstName.Text=l.e.String(this.dvContacts[0].FirstName)),this.LastName.Visible&&(this.LastName.Text=l.e.String(this.dvContacts[0].LastName)),this.MiddleName.Visible&&(this.MiddleName.Text=l.e.String(this.dvContacts[0].MiddleName)),this.Salutation.Visible&&!l.e.IsEmpty(this.dvContacts[0].SalutationID)&&(this.Salutation.SelectedValue=parseInt(this.dvContacts[0].SalutationID)),this.JobTitle.Visible&&(this.JobTitle.Text=l.e.String(this.dvContacts[0].JobTitle)),this.Phone1.Visible&&(this.Phone1.Text=l.e.String(this.dvContacts[0].Phone1)),this.Phone2.Visible&&(this.Phone2.Text=l.e.String(this.dvContacts[0].Phone2)),this.Email.Visible&&(this.Email.Text=l.e.String(this.dvContacts[0].Email1)),this.Fax.Visible&&(this.Fax.Text=l.e.String(this.dvContacts[0].Fax)),this.Department.Visible&&(this.Department.Text=l.e.String(this.dvContacts[0].Department)),this.Role.Visible&&!l.e.IsEmpty(this.dvContacts[0].RoleLookUpID)&&(this.Role.SelectedValue=parseInt(this.dvContacts[0].RoleLookUpID))))}onStatusSelectionChanged(e){this.MessageVisibility=!1,""==this.Status.SelectedValue||"417"!=this.Status.SelectedValue&&("419"!=this.Status.SelectedValue||this.IsAssign)||(this.Status.SelectedIndex=0)}ChangeAllSecondary(e,t,s,i){for(let a=0;a<e.Tables[t].length;a++)e.Tables[t][a][s]=i}onCompanySelectionChanged(e){if(this.EnableControls(!0),this.ContactList.Items.Clear(),"3"==this.Mode.SelectedValue){if(this.Company.Code.SelectedValue==this.Company.Code.PreviousSelectedValue)return;if(0!=this.Company.Code.SelectedValue){let e=new m.a;e.CustomerID=this.Company.Code.SelectedValue;let t=e.GetCustomerDetails(),s=null;if(null!=t&&t.Tables[0].length>0){this.ViewContacts.ContactsListObj.Clear(),null==this.dsLeadData&&(this.dsLeadData=I.a.GetLeadScrenDetails(86));let e=this.dsLeadData.Tables[4];if(e.RowFilter="CostCenterid=83",e=e.filter(e=>83==e.Costcenterid),this instanceof se){let s=null,i=null,a=null;if(null!=this.ScreenObject)for(let o=0;o<e.length;o++)for(let n=0;n<this.ScreenObject.CustomTab.Pages.length;n++)"Contacts"!=this.ScreenObject.CustomTab.Pages[n].Name&&"Products"!=this.ScreenObject.CustomTab.Pages[n].Name&&"Contact Methods"!=this.ScreenObject.CustomTab.Pages[n].Name&&"History"!=this.ScreenObject.CustomTab.Pages[n].Name&&"Activities"!=this.ScreenObject.CustomTab.Pages[n].Name&&"Notes"!=this.ScreenObject.CustomTab.Pages[n].Name&&"Attachments"!=this.ScreenObject.CustomTab.Pages[n].Name&&"Documents"!=this.ScreenObject.CustomTab.Pages[n].Name&&"Follow Up"!=this.ScreenObject.CustomTab.Pages[n].Name&&"CVR DATA"!=this.ScreenObject.CustomTab.Pages[n].Name&&"CRM History"!=this.ScreenObject.CustomTab.Pages[n].Name&&this.ScreenObject.CustomTab.Pages[n].Fields.forEach(n=>{n instanceof f.c&&null!=n.DBColumnName&&(n instanceof d.d?(s=n,t.Columns[1].Contains(e[o].LSysColumnName.toString())&&s.DBColumnID==parseInt(e[o].CostCenterColIDBase)&&t.Tables[1].length>0&&(s.Text=l.e.String(t.Tables[1][0][e[o].LSysColumnName.toString()]))):n instanceof C.e?(i=n,t.Columns[1].Contains(e[o].LSysColumnName.toString())&&i.DBColumnID==parseInt(e[o].CostCenterColIDBase)&&t.Tables[1].length>0&&(n.SelectedValue=l.e.String(t.Tables[1][0][e[o].LSysColumnName.toString()]))):n instanceof c.b&&(a=n,t.Columns[7].Contains(e[o].LSysColumnName.toString())&&a.DBColumnID==parseInt(e[o].CostCenterColIDBase)&&t.Tables[7].length>0?a.SelectedValue=parseInt(t.Tables[7][0][e[o].LSysColumnName]):t.Columns[1].Contains(e[o].LSysColumnName.toString())&&a.DBColumnID==parseInt(e[o].CostCenterColIDBase)&&t.Tables[1].length>0&&(a.SelectedValue=l.e.Int(t.Tables[1][0][e[o].LSysColumnName.toString()]))))})}if(this.ContactList.Items.push(C.d.ComboBoxItems_2("New","0")),this.ContactList.SelectedValue="0",s=t.Tables[2].Copy(),t.Tables.length>1&&s.length>0){s=t.Tables[2].Copy();for(let t=0;t<s.length;t++)this.ContactList.Items.push(C.d.ComboBoxItems_2(l.e.String(s[t].FirstName),s[t].ContactID.toString()));this.dvContacts=s,this.dvContactsTable=this.dvContacts,t.Tables.length>5&&t.Tables[5].length>0&&this.dvContactsTable.AddRange(t.Tables[5]);let e=this.ScreenObject.Data.Tables[4].filter(e=>"ContactsBasedOnCustomer"==e.Name);e.length>0&&(l.e.IsEmpty(e[0].Value)||"0"==e[0].Value.toString()||Object(n.j)(e[0].Value)&&(t.Tables[5].Columns.ContactID.Expression="0",this.ChangeAllSecondary(t,2,"AddressTypeID","2"),t.Tables[2].Columns.ContactID.Expression="0",t.Tables[2].AcceptChanges(),this.ViewContacts.LoadContactsWithOutClearingRows(t.Tables[2])))}}this.Company.Code.SelectedValue!=this.Company.Code.PreviousSelectedValue&&(this.Company.Code.PreviousSelectedValue=this.Company.Code.SelectedValue,this.ScreenObject.OnGetReference(this.Company.Code))}}else if("2"==this.Mode.SelectedValue){if(0!=this.Company.Code.SelectedValue){let e=i.a.accounting.GetAccountDetails(this.Company.Code.SelectedValue);if(null!=e&&e.Tables.length>0&&!e.Columns[0].Contains("ErrorMessage")&&e.Tables[0].length>0){let t=null;if(null!=e&&e.Tables[0].length>0&&(this.ViewContacts.ContactsListObj.Clear(),this.ContactList.Items.push(C.d.ComboBoxItems_2("New","0")),this.ContactList.SelectedValue="0",t=e.Tables[2].Copy(),e.Tables.length>1&&t.length>0)){t=e.Tables[8].Copy();for(let e=0;e<t.length;e++)this.ContactList.Items.push(C.d.ComboBoxItems_2(l.e.String(t[e].FirstName),t[e].ContactID.toString()));t=e.Tables[2].Copy();for(let e=0;e<t.length;e++)this.ContactList.Items.push(C.d.ComboBoxItems_2(l.e.String(t[e].FirstName),t[e].ContactID.toString()));this.dvContacts=t,this.dvContactsTable=this.dvContacts,e.Tables.length>8&&e.Tables[8].length>0&&this.dvContactsTable.AddRange(e.Tables[8]);let s=this.ScreenObject.Data.Tables[4].filter(e=>"ContactsBasedOnAccount"==e.Name);s.length>0&&(l.e.IsEmpty(s[0].Value)||"0"==s[0].Value.toString()||Object(n.j)(s[0].Value)&&(this.ChangeAllSecondary(e,8,"AddressTypeID","2"),this.ChangeAllSecondary(e,2,"AddressTypeID","2"),e.Tables[8].Columns.ContactID.Expression="0",e.Tables[8].AcceptChanges(),this.ViewContacts.LoadContactsWithOutClearingRows(e.Tables[8]),e.Tables[2].Columns.ContactID.Expression="0",e.Tables[2].AcceptChanges(),this.ViewContacts.LoadContactsWithOutClearingRows(e.Tables[2])))}this.Company.Code.SelectedValue!=this.Company.Code.PreviousSelectedValue&&(this.Company.Code.PreviousSelectedValue=this.Company.Code.SelectedValue,this.ScreenObject.OnGetReference(this.Company.Code))}}}else if("1"==this.Mode.SelectedValue){let e=-1,t=i.a.common.GetDataSet("PAY066",this.Company.Code.SelectedValue.toString());null!=t&&t.Tables[0].length>0&&(e=parseInt(t.Tables[0][0][0]));let s=this.LED.GetCRMContacts(86,0);this.dvContacts=s.Tables[0].filter(t=>t.FeaturePK==e),this.dvContactsTable=this.dvContacts,this.dvContacts.length>0&&(this.EnableControls(!1),this.FirstName.Visible&&(this.FirstName.Text=l.e.String(this.dvContacts[0].FirstName)),this.LastName.Visible&&(this.FirstName.Text=l.e.String(this.dvContacts[0].LastName)),this.MiddleName.Visible&&(this.MiddleName.Text=l.e.String(this.dvContacts[0].MiddleName)),this.Salutation.Visible&&!l.e.IsEmpty(this.dvContacts[0].SalutationID)&&(this.Salutation.SelectedValue=parseInt(this.dvContacts[0].SalutationID)),this.JobTitle.Visible&&(this.JobTitle.Text=l.e.String(this.dvContacts[0].JobTitle)),this.Phone1.Visible&&(this.Phone1.Text=l.e.String(this.dvContacts[0].Phone1)),this.Phone2.Visible&&(this.Phone2.Text=l.e.String(this.dvContacts[0].Phone2)),this.Email.Visible&&(this.Email.Text=l.e.String(this.dvContacts[0].Email1)),this.Fax.Visible&&(this.Fax.Text=l.e.String(this.dvContacts[0].Fax)),this.Department.Visible&&(this.Department.Text=l.e.String(this.dvContacts[0].Department)),this.Role.Visible&&!l.e.IsEmpty(this.dvContacts[0].RoleLookUpID)&&(this.Role.SelectedValue=parseInt(this.dvContacts[0].RoleLookUpID)))}}GetRecords(e){this.ButtonSave.Enable||(this.ButtonSave.Enable=!0);let t=0,s=!1;"NEXT"==e.toString().toUpperCase()?s=!0:"PREVIOUS"==e.toString().toUpperCase()&&(s=!1);let a=i.a.common.GetNextPreviousRecords(this.CostCenterID,this.LeadID,s,0,this.IsGroup?1:0);null!=a&&a.Tables.length>0&&a.Tables[0].length>0&&(t=parseInt(a.Tables[0][0][a.Columns[0][0]]),t>0&&(this.Mode.Items.Clear(),this.lstModeDetails.Clear(),this.IncludeNewInMode&&this.Mode.Items.push(C.d.ComboBoxItems_2("New","0")),this.ScreenObject.Clear(),this.Load(t)))}ActivityRefresh(){"0"==this.Mode.SelectedValue?this.Activities.CRMCustomer.Text=this.Company.Text:(null!=this.Activities.CRMCustomer&&(this.Activities.CRMCustomer.Code.CCID=this.Company.Code.CCID,this.Activities.CRMCustomer.Code.TypeID=this.Company.Code.TypeID),this.Activities.CRMCustomer.Text=this.Company.Code.Text,this.Activities.CRMCustomer.Code.SelectedValue=this.Company.Code.SelectedValue,this.Activities.onCustomerSelectionChange("Customer"));var e=this.ScreenObject.StaticFields.find(e=>e.DBColumnID==this.ContactPersonColID);e&&e instanceof d.d&&(this.Activities.CRMContactPerson.Text=e.Text),this.Activities.Location.Text=i.a.SessionManager.LocationName}worker_DoWork(){try{let e=this.ScreenObject.Data.Tables[6].filter(e=>16==e.LookupType);for(let t=0;t<this.ScreenObject.CustomTab.Pages.length;t++)if("Address Details"==this.ScreenObject.CustomTab.Pages[t].Name)for(let s=0;s<this.ScreenObject.CustomTab.Pages[t].Fields.length;s++)if("Country"==this.ScreenObject.CustomTab.Pages[t].Fields[s].Label&&e.length>0){for(let i=0;i<e.length;i++)this.ScreenObject.CustomTab.Pages[t].Fields[s].Items.push(C.d.ComboBoxItems_2(l.e.String(e[i].Name),e[i].NodeID.toString()));this.ScreenObject.CustomTab.Pages[t].Fields[s].SelectedValue=this.ScreenObject.CustomTab.Pages[t].Fields[s].Items[0].Value}this.ScreenObject.Data.Tables[5].forEach(e=>{this.Status.Items.push(C.d.ComboBoxItems_2(e.Status.toString(),e.StatusID.toString()))}),this.Status.SelectedValue="415",this.IncludeNewInMode&&(this.Mode.Items.push(C.d.ComboBoxItems_2("New","0")),this.Mode.SelectedValue="0"),this.ContactList.Items.push(C.d.ComboBoxItems_2("New","0")),this.ContactList.SelectedValue="0";for(let t=0;t<this.ScreenObject.CustomTab.Pages.length;t++)if("Personal Information"==this.ScreenObject.CustomTab.Pages[t].Name)for(let e=0;e<this.ScreenObject.CustomTab.Pages[t].Fields.length;e++)"Gender"==this.ScreenObject.CustomTab.Pages[t].Fields[e].Label&&(this.ScreenObject.CustomTab.Pages[t].Fields[e].Items.push(C.d.ComboBoxItems_2(i.a.GetResource("CRMLead_Male"),"1")),this.ScreenObject.CustomTab.Pages[t].Fields[e].Items.push(C.d.ComboBoxItems_2(i.a.GetResource("CRMLead_Female"),"2")),this.ScreenObject.CustomTab.Pages[t].Fields[e].SelectedValue="1");e=this.ScreenObject.Data.Tables[6].filter(e=>44==e.LookupType),e.forEach(e=>{this.ViewContactMethod.Preferred.Items.push(C.d.ComboBoxItems_2(e.Name.toString(),e.NodeID.toString()))}),this.ViewContactMethod.Preferred.SelectedValue="141",this.Campaign.SelectedValue=1,this.ScreenObject.InitAutoCode(this.ScreenObject.Data.Tables[7],!1)}catch(e){throw e}}OnModeChange(e){if("1"==this.Mode.SelectedValue){if(this.Company.Code.Visible=!0,this.Company.TextVisible=!1,!this.isLead&&this.lstModeDetails.filter(e=>"LEAD"==e.Value.toUpperCase()).length>0){var t=this.lstModeDetails.find(e=>"Lead"==e.Value);this.Company.Code.CCID=parseInt(t.Name),this.Company.Code.TypeID=1,this.Company.Code.CustomWhere="",this.Company.Code.PreviousSelectedValue=0,this.Company.Code.SelectedValue=0,this.Company.Code.Refresh(),this.isCust=!1,this.isAccount=!1,this.isLead=!0}}else"2"==this.Mode.SelectedValue?(this.Company.Code.Visible=!0,this.Company.TextVisible=!1,!this.isAccount&&this.lstModeDetails.filter(e=>"ACCOUNT"==e.Value.toUpperCase()).length>0&&(this.Company.Code.DBColumnName="AccountID",this.Company.Code.PreviousSelectedValue=0,this.Company.Code.CCID=2,t=this.lstModeDetails.find(e=>"Account"==e.Value),this.Company.Code.TypeID=parseInt(t.Name),this.Company.Code.CustomWhere="",this.Company.Code.SelectedValue=0,this.Company.Code.Refresh(),this.isCust=!1,this.isLead=!1,this.isAccount=!0)):"3"==this.Mode.SelectedValue?(this.Company.Code.Visible=!0,this.Company.TextVisible=!1,!this.isCust&&this.lstModeDetails.filter(e=>"CUSTOMER"==e.Value.toUpperCase()).length>0&&(this.Company.Code.DBColumnName="CustomerID",this.Company.Code.PreviousSelectedValue=0,this.Company.Code.CCID=83,t=this.lstModeDetails.find(e=>"Customer"==e.Value),this.Company.Code.TypeID=1,this.Company.Code.SelectedValue=0,this.Company.Code.CustomWhere=this.bShowAssignedCustomers?this.ReturnWhereForCustomer():"",this.Company.Code.Refresh(),this.isAccount=!1,this.isLead=!1,this.isCust=!0)):(this.Company.Code.Visible=!1,this.Company.TextVisible=!0,this.isCust=!1,this.isAccount=!1,this.isLead=!1,83==this.Company.Code.CCID?this.isCust=!0:2==this.Company.Code.CCID?this.isAccount=!0:this.Company.Code.CCID>5e4&&(this.isLead=!0))}ReturnWhereForCustomer(){let e="";return e+="('"+i.a.SessionManager.UserID+"'=1 or a.CreatedBy in ('"+i.a.SessionManager.UserName+"') or '"+i.a.SessionManager.UserID+"' in ",e+="( select UserID from CRM_Assignment with(nolock) where CCID=83 and CCNODEID=a.CustomerID and IsTeam=0) or '"+i.a.SessionManager.UserID+"' in",e+="( select  UserID from COM_GROUPS with(nolock) where   GROUPNAME<>'''' AND GID  IN (select teamnodeid from CRM_Assignment with(nolock) where CCID=83 and CCNODEID=a.CustomerID and ISGROUP=1) )",e+=" or '"+i.a.SessionManager.UserID+"' in ( select  UserID from ADM_UserRoleMap with(nolock) where ROLEID IN  (select teamnodeid from CRM_Assignment with(nolock) where CCID=83 and CCNODEID=a.CustomerID and ISROLE=1) )",e+=" or '"+i.a.SessionManager.UserID+"' in (select userid from crm_teams with(nolock) where isowner=0 and  teamid in ( select teamnodeid from CRM_Assignment with(nolock) where CCID=83 and CCNODEID=a.CustomerID and IsTeam=1))  )",""!=i.a.SessionManager.LocationWhere&&(e+=" OR  a.CustomerID in ( SELECT NODEID FROM COM_CCCCDATA with(nolock) WHERE COSTCENTERID=83 AND CCNID2 IN ("+i.a.SessionManager.LocationWhere+"))   "),e="("+e+")",e}loadtabs(){try{this.AssignRowColumns();for(let e=this.ScreenObject.CustomTab.Pages.length-1;e>=0;e--){let t=this.ScreenObject.CustomTab.Pages[e];switch(t.Name){case"Contacts":t.Fields.push(this.ViewContacts),this.DefaultcontactsVisible=!0;break;case"Products":t.Fields.push(this.LeadsProduct);break;case"Contact Methods":t.Fields.AddRange(this.ViewContactMethod.Fields);break;case"History":t.Fields.push(this.ViewAssignHistroy.ListObj);break;case"Activities":t.Fields.push(this.ViewActivities);break;case"Notes":t.Fields.push(this.ViewNotes);break;case"Attachments":t.Fields.push(this.ViewAttachments);break;case"Follow Up":t.Fields.push(this.ViewFeedback);break;case"CVR DATA":t.Fields.push(this.ViewCVRViewModel);break;case"CRM History":t.Fields.push(this.ViewCRMHistroy)}}}catch(e){throw e}Logger.InfoLog("AddEditLeads::Exiting worker_DoWork")}AssignRowColumns(){try{let e;e=this.ScreenObject.CustomFields.length;for(let t=0;t<e;t++)this.ScreenObject.CustomFields[t].Row=t/4,this.ScreenObject.CustomFields[t].Column=t%4}catch(e){throw e}}details(){try{let e="";return e+="<Row ",e+=""!=this.FirstName.Text&&""!=this.FirstName.Text?' FirstName="'+se.GetValidXml(this.FirstName.Text)+'"':' FirstName=""',e+=""!=this.MiddleName.Text&&""!=this.MiddleName.Text?' MiddleName="'+se.GetValidXml(this.MiddleName.Text)+'"':' MiddleName=""',e+=""!=this.LastName.Text&&""!=this.LastName.Text?' LastName="'+se.GetValidXml(this.LastName.Text)+'"':' LastName=""',l.e.IsEmpty(this.Salutation.SelectedValue)?e+=' Salutation="0"':e+=' Salutation="'+this.Salutation.SelectedValue+'"',e+=""!=this.JobTitle.Text&&""!=this.JobTitle.Text?' JobTitle="'+se.GetValidXml(this.JobTitle.Text)+'"':' JobTitle=""',e+=""!=this.Phone1.Text&&""!=this.Phone1.Text?' Phone1="'+se.GetValidXml(this.Phone1.Text)+'"':' Phone1=""',e+=""!=this.Phone2.Text&&""!=this.Phone2.Text?' Phone2="'+se.GetValidXml(this.Phone2.Text)+'"':' Phone2=""',e+=""!=this.Email.Text&&""!=this.Email.Text?' Email="'+se.GetValidXml(this.Email.Text)+'"':' Email=""',e+=""!=this.Fax.Text&&""!=this.Fax.Text?' Fax="'+se.GetValidXml(this.Fax.Text)+'"':' Fax="'+this.Fax.Text+'"',e+=""!=this.Department.Text&&""!=this.Department.Text?' Department="'+se.GetValidXml(this.Department.Text)+'"':' Department=""',e+=0!=this.Role.SelectedValue?' Role="'+this.Role.SelectedValue+'"':' Role="0"',e+="/>",e}catch(e){return""}}static GetValidXml(e){return(e=(e=(e=e.Replace("&","&amp;")).Replace("'","&apos;&apos;")).Replace('"',"&quot;")).Replace("<","&lt;")}getFields(){Logger.InfoLog("AddEditLeads::Entering getFields");try{let e,t="",s="";return s+="<Row ",this.ScreenObject.CustomTab.Pages.forEach(i=>{i.Fields.forEach(i=>{i instanceof f.c&&null!=i.DBColumnName&&(i instanceof d.d?(t=i.Text,l.e.IsEmpty(t)&&(t="",e=null),s+=i.DBColumnName+'="'+se.GetValidXml(t)+'" '):i instanceof C.e?(t=i.SelectedValue,l.e.IsEmpty(t)&&(t=""),"Gender"==i.DBColumnName?null!=i.SelectedItem&&(s+=i.DBColumnName+'="'+se.GetValidXml(i.SelectedItem.Name)+'" '):"Country"==i.DBColumnName?null!=i.SelectedValue&&""!=i.SelectedValue&&(s+=i.DBColumnName+'="'+i.SelectedValue+'" '):s+=i.DBColumnName+'="'+se.GetValidXml(t)+'" '):i instanceof u.a?(t=l.e.IsEmpty(i.Date)?"":i.Date.ToString("dd/MMM/yyyy"),l.e.IsEmpty(t)&&(t=""),s+=i.DBColumnName+'="'+t+'" '):i instanceof E.a?(t=i.Text,l.e.IsEmpty(t)&&(t=""),s+=i.DBColumnName+'="'+t+'" '):i instanceof c.b&&(this.oPactCombo=i,s+=this.oPactCombo.DBColumnName+'="'+this.oPactCombo.SelectedValue+'" '))})}),s+=' PreferredID="'+this.ViewContactMethod.Preferred.SelectedValue+'" ',s+=' PreferredName="'+this.ViewContactMethod.Preferred.Text+'" ',s+=" />",s}catch(e){throw e}}ClearFields(){this.Subject.Text="",this.Date.Date=new Date((new Date).ToString("dd/MMM/yyyy")),this.Company.Text="",null!=this.Rating&&(this.Rating.SelectedValue=1),null!=this.Industry&&(this.Industry.SelectedValue=1),this.FirstName.Text="",this.MiddleName.Text="",this.LastName.Text="",null!=this.Salutation&&(this.Salutation.SelectedValue=1),this.JobTitle.Text="",this.Phone1.Text="",this.Phone2.Text="",this.Email.Text="",this.ContactList.Items.Clear(),this.ContactList.Items.push(C.d.ComboBoxItems_2("New","0")),this.Fax.Text="",this.Department.Text="",this.ScreenObject.Clear(),this.Status.SelectedValue="415",null!=this.Campaign&&(this.Campaign.SelectedValue=1),null!=this.Source&&(this.Source.SelectedValue=1),null!=this.Role&&(this.Role.SelectedValue=1)}AutoGenerateCode(){Logger.InfoLog("AddEditLeads::Entering AutoGenerateCode");try{0==this.LeadID&&this.ScreenObject.SetAutoCode(this.Code,!1,this.ParentId,this.ScreenObject.Data.Tables[7]);let e=this.ScreenObject.Data.Tables[4].filter(e=>"ShowAssignedCustomers"==e.Name);e.length>0&&!l.e.IsEmpty(e[0].Value)&&(this.bShowAssignedCustomers="0"==e[0].Value.toString()||"1"==e[0].Value.toString()?!!Object(n.j)(parseInt(e[0].Value)):!!Object(n.j)(e[0].Value)),0==this.LeadID&&(e=this.ScreenObject.Data.Tables[4].filter(e=>"LinkDimension"==e.Name),e.length>0&&!l.e.IsEmpty(e[0].Value)&&(this.Mode.Items.push(C.d.ComboBoxItems_2("Existing lead","1")),this.lstModeDetails.push(C.d.ComboBoxItems_2(e[0].Value.toString(),"Lead"))),e=this.ScreenObject.Data.Tables[4].filter(e=>"AccountLinkDimension"==e.Name),e.length>0&&!l.e.IsEmpty(e[0].Value)&&(this.Mode.Items.push(C.d.ComboBoxItems_2("Account","2")),this.lstModeDetails.push(C.d.ComboBoxItems_2(e[0].Value.toString(),"Account"))),e=this.ScreenObject.Data.Tables[4].filter(e=>"CustomerInMode"==e.Name),e.length>0&&Object(n.j)(e[0].Value)&&(this.Mode.Items.push(C.d.ComboBoxItems_2("Customer","3")),this.lstModeDetails.push(C.d.ComboBoxItems_2(e[0].Value.toString(),"Customer"))),e=this.ScreenObject.Data.Tables[4].filter(e=>"DefaultModeSelection"==e.Name),e.length>0&&!l.e.IsEmpty(e[0].Value)&&(this.Mode.SelectedValue=this.Mode.Items.filter(t=>t.Value==e[0].Value.toString()).length>0?this.Mode.SelectedValue=e[0].Value.toString():"0",parseInt(this.Mode.SelectedValue)>0&&this.OnModeChange(this.Mode.SelectedValue)))}catch(e){throw e}Logger.InfoLog("AddEditLeads::Exiting AutoGenerateCode")}Load(e){Logger.InfoLog("AddEditLeads::Entering Load");try{if(this.LeadID=e,this.ds=this.LED.GetLead(e),this.ScreenObject.CheckViewForUser(!0),this.ScreenObject.IsAutoCode&&(this.Code.Enable=!1),null!=this.ds){if(this.ds.Tables.length>5&&this.ds.Columns[5].Contains("ConvertFromLeadID")&&this.ds.Tables[5].length>0&&parseInt(this.ds.Tables[5][0][this.ds.Columns[5][0]])>0&&(this.ButtonSave.Enable=!1,this.DisplayMessage="Lead is converted to Opportunity cannot be edited"),this.ds.Tables.length>2&&this.ds.Tables[2].length>0){let e=this.ds.Tables[2].filter(e=>"LinkDimension"==e.Name);e.length>0&&!l.e.IsEmpty(e[0].Value)&&(this.Mode.Items.push(C.d.ComboBoxItems_2("Existing lead","1")),this.lstModeDetails.push(C.d.ComboBoxItems_2(e[0].Value.toString(),"Lead"))),e=this.ds.Tables[2].filter(e=>"AccountLinkDimension"==e.Name),e.length>0&&!l.e.IsEmpty(e[0].Value)&&(this.Mode.Items.push(C.d.ComboBoxItems_2("Account","2")),this.lstModeDetails.push(C.d.ComboBoxItems_2(e[0].Value.toString(),"Account"))),e=this.ds.Tables[2].filter(e=>"CustomerInMode"==e.Name),e.length>0&&Object(n.j)(e[0].Value)&&(this.Mode.Items.push(C.d.ComboBoxItems_2("Customer","3")),this.lstModeDetails.push(C.d.ComboBoxItems_2(e[0].Value.toString(),"Customer"))),e=this.ds.Tables[2].filter(e=>"ShowAssignedCustomers"==e.Name),e.length>0&&(this.bShowAssignedCustomers=!!Object(n.j)(e[0].Value))}if(this.ds.Tables.length>0&&this.ds.Tables[0].length>0){if(l.e.IsEmpty(this.ds.Tables[0][0].Code)||(this.Code.Text=this.ds.Tables[0][0].Code.toString()),l.e.IsEmpty(this.ds.Tables[0][0].Subject)||(this.Subject.Text=this.ds.Tables[0][0].Subject.toString()),l.e.IsEmpty(this.ds.Tables[0][0].CDate)||(this.Date.Date=new Date(this.ds.Tables[0][0].CDate.toString())),l.e.IsEmpty(this.ds.Tables[0][0].StatusID)||(this.Status.SelectedValue=this.ds.Tables[0][0].StatusID.toString()),l.e.IsEmpty(this.ds.Tables[0][0].CreatedBy)||(this.Owner.Text=this.ds.Tables[0][0].CreatedBy.toString()),l.e.IsEmpty(this.ds.Tables[0][0].CvtDate)||(this.CreatedDate.Text=new Date(this.ds.Tables[0][0].CvtDate).ToString("dd/MMM/yyyy hh:mm a")),this.CreatedDate.Date=new Date(new Date(this.ds.Tables[0][0].CvtDate).ToString("dd/MMM/yyyy hh:mm a")),l.e.IsEmpty(this.ds.Tables[0][0].AssignedTo)||(this.AssignedTo.Text=this.ds.Tables[0][0].AssignedTo.toString()),this.LeadStatus=l.e.IsEmpty(this.ds.Tables[0][0].IsApproved)||!Object(n.j)(this.ds.Tables[0][0].IsApproved)?"UnApproved":"Approved",this.Status.Enable="417"!=this.Status.SelectedValue&&"419"!=this.Status.SelectedValue,this.ButtonClose.Visible=!("419"!=this.Status.SelectedValue||!i.a.SessionManager.IsActionAssigned(86,"Close")),this.Mode.SelectedValue=l.e.IsEmpty(this.ds.Tables[0][0].Mode)?"0":this.ds.Tables[0][0].Mode.toString(),l.e.IsEmpty(this.ds.Tables[0][0].Company)||(this.OnModeChange(null),"0"==this.Mode.SelectedValue?this.Company.Text=this.ds.Tables[0][0].Company.toString():(this.Company.Code.SelectedValue=parseInt(this.ds.Tables[0][0].SelectedModeID),this.Company.Code.PreviousSelectedValue=this.Company.Code.SelectedValue,this.ScreenObject.OnGetReference(this.Company.Code))),"3"==this.Mode.SelectedValue){this.ContactList.Items.Clear();let e=new m.a;e.CustomerID=this.Company.Code.SelectedValue;let t=e.GetCustomerDetails();if(null!=t&&t.Tables[0].length>0){if(this.ContactList.Items.push(C.d.ComboBoxItems_2("New","0")),this.ContactList.SelectedValue="0",t.Tables.length>5&&t.Tables[5].length>0)for(let e=0;e<t.Tables[5].length;e++)this.ContactList.Items.push(C.d.ComboBoxItems_2(l.e.String(t.Tables[5][e].FirstName),t.Tables[5][e].ContactID.toString()));if(t.Tables.length>1&&t.Tables[2].length>0){for(let e=0;e<t.Tables[2].length;e++)this.ContactList.Items.push(C.d.ComboBoxItems_2(l.e.String(t.Tables[2][e].FirstName),t.Tables[2][e].ContactID.toString()));this.dvContacts=t.Tables[2],this.dvContactsTable=this.dvContacts,t.Tables.length>5&&t.Tables[5].length>0&&this.dvContactsTable.AddRange(t.Tables[5])}}}if("2"==this.Mode.SelectedValue){this.ContactList.Items.Clear();let e=i.a.accounting.GetAccountDetails(this.Company.Code.SelectedValue);if(null!=e&&e.Tables[0].length>0){if(this.ContactList.Items.push(C.d.ComboBoxItems_2("New","0")),this.ContactList.SelectedValue="0",e.Tables.length>8&&e.Tables[8].length>0)for(let t=0;t<e.Tables[8].length;t++)this.ContactList.Items.push(C.d.ComboBoxItems_2(l.e.String(e.Tables[8][t].FirstName),e.Tables[8][t].ContactID.toString()));if(e.Tables.length>1&&e.Tables[2].length>0){for(let t=0;t<e.Tables[2].length;t++)this.ContactList.Items.push(C.d.ComboBoxItems_2(l.e.String(e.Tables[2][t].FirstName),e.Tables[2][t].ContactID.toString()));this.dvContacts=e.Tables[2],this.dvContactsTable=this.dvContacts,e.Tables.length>8&&e.Tables[8].length>0&&this.dvContactsTable.AddRange(e.Tables[8])}}}l.e.IsEmpty(this.ds.Tables[0][0].ContactID)||(this.ContactList.SelectedValue=this.ds.Tables[0][0].ContactID.toString()),null!=this.ContactList.SelectedValue&&"0"!=this.ContactList.SelectedValue&&this.EnableControls(!1),l.e.IsEmpty(this.ds.Tables[0][0].SourceLookUpID)||(this.Source.SelectedValue=parseInt(this.ds.Tables[0][0].SourceLookUpID)),l.e.IsEmpty(this.ds.Tables[0][0].RatinglookupID)||(this.Rating.SelectedValue=parseInt(this.ds.Tables[0][0].RatinglookupID)),l.e.IsEmpty(this.ds.Tables[0][0].IndustryLookUpID)||(this.Industry.SelectedValue=parseInt(this.ds.Tables[0][0].IndustryLookUpID)),l.e.IsEmpty(this.ds.Tables[0][0].CampaignID)||(this.Campaign.SelectedValue=parseInt(this.ds.Tables[0][0].CampaignID))}this.ds.Tables.length>4&&this.ScreenObject.LoadCustomFieldsData(this.ds.Tables[4],!0),this.ds.Tables.length>3&&this.ds.Tables[3].length>0&&(l.e.IsEmpty(this.ds.Tables[3][0].FirstName)||(this.FirstName.Text=this.ds.Tables[3][0].FirstName.toString()),l.e.IsEmpty(this.ds.Tables[3][0].MiddleName)||(this.MiddleName.Text=this.ds.Tables[3][0].MiddleName.toString()),l.e.IsEmpty(this.ds.Tables[3][0].LastName)||(this.LastName.Text=this.ds.Tables[3][0].LastName.toString()),l.e.IsEmpty(this.ds.Tables[3][0].SalutationID)||(this.Salutation.SelectedValue=parseInt(this.ds.Tables[3][0].SalutationID)),l.e.IsEmpty(this.ds.Tables[3][0].JobTitle)||(this.JobTitle.Text=this.ds.Tables[3][0].JobTitle.toString()),l.e.IsEmpty(this.ds.Tables[3][0].Company)||(this.Company.Text=this.ds.Tables[3][0].Company.toString()),l.e.IsEmpty(this.ds.Tables[3][0].Phone1)||(this.Phone1.Text=this.ds.Tables[3][0].Phone1.toString()),l.e.IsEmpty(this.ds.Tables[3][0].Phone2)||(this.Phone2.Text=this.ds.Tables[3][0].Phone2.toString()),l.e.IsEmpty(this.ds.Tables[3][0].Email1)||(this.Email.Text=this.ds.Tables[3][0].Email1.toString()),l.e.IsEmpty(this.ds.Tables[3][0].Fax)||(this.Fax.Text=this.ds.Tables[3][0].Fax.toString()),l.e.IsEmpty(this.ds.Tables[3][0].Department)||(this.Department.Text=this.ds.Tables[3][0].Department.toString()),l.e.IsEmpty(this.ds.Tables[3][0].RoleLookUpID)||(this.Role.SelectedValue=parseInt(this.ds.Tables[3][0].RoleLookUpID.toString())),this.ScreenObject.LoadCustomFieldsData(this.ds.Tables[3],!0),l.e.IsEmpty(this.ds.Tables[3][0].PreferredID)||(this.ViewContactMethod.Preferred.SelectedValue=this.ds.Tables[3][0].PreferredID.toString()),l.e.IsEmpty(this.ds.Tables[3][0].IsEmailOn)||(1==Object(n.j)(this.ds.Tables[3][0].IsEmailOn)?(this.ViewContactMethod.EmailAllow.IsChecked=!0,this.ViewContactMethod.EmailNotAllow.IsChecked=!1):(this.ViewContactMethod.EmailNotAllow.IsChecked=!0,this.ViewContactMethod.EmailAllow.IsChecked=!1)),l.e.IsEmpty(this.ds.Tables[3][0].IsBulkEmailOn)||(1==Object(n.j)(this.ds.Tables[3][0].IsBulkEmailOn)?(this.ViewContactMethod.BulkEmailAllow.IsChecked=!0,this.ViewContactMethod.BulkEmailNotAllow.IsChecked=!1):(this.ViewContactMethod.BulkEmailNotAllow.IsChecked=!0,this.ViewContactMethod.BulkEmailAllow.IsChecked=!1)),l.e.IsEmpty(this.ds.Tables[3][0].IsMailOn)||(1==Object(n.j)(this.ds.Tables[3][0].IsMailOn)?(this.ViewContactMethod.MailAllow.IsChecked=!0,this.ViewContactMethod.MailNotAllow.IsChecked=!1):(this.ViewContactMethod.MailNotAllow.IsChecked=!0,this.ViewContactMethod.MailAllow.IsChecked=!1)),l.e.IsEmpty(this.ds.Tables[3][0].IsPhoneOn)||(1==Object(n.j)(this.ds.Tables[3][0].IsPhoneOn)?(this.ViewContactMethod.PhoneAllow.IsChecked=!0,this.ViewContactMethod.PhoneNotAllow.IsChecked=!1):(this.ViewContactMethod.PhoneNotAllow.IsChecked=!0,this.ViewContactMethod.PhoneAllow.IsChecked=!1)),l.e.IsEmpty(this.ds.Tables[3][0].IsFaxOn)||(1==Object(n.j)(this.ds.Tables[3][0].IsFaxOn)?(this.ViewContactMethod.FaxAllow.IsChecked=!0,this.ViewContactMethod.FaxNotAllow.IsChecked=!1):(this.ViewContactMethod.FaxNotAllow.IsChecked=!0,this.ViewContactMethod.FaxAllow.IsChecked=!1))),this.ds.Tables.length>8&&this.ViewActivities.LoadActivityData(this.ds.Tables[8]),this.ds.Tables.length>9&&this.ViewNotes.LoadNotes(this.ds.Tables[9]),this.ds.Tables.length>10&&this.ViewAttachments.LoadAttachments(this.ds.Tables[10]),this.ds.Tables.length>11&&this.ScreenObject.LoadCustomFieldsCCData(this.ds.Tables[11]),this.ds.Tables.length>12&&this.LeadsProduct.LoadProductData(this.ds.Tables[12],this.ds.Columns[12]),this.ds.Tables.length>13&&this.ViewFeedback.LoadData(this.ds.Tables[13]),this.ds.Tables.length>15&&this.ViewContacts.LoadContacts(this.ds.Tables[15],this.ds.Columns[15]),this.ds.Tables.length>16&&this.ViewCVRViewModel.LoadData(this.ds.Tables[16]),this.ds.Tables.length>17&&this.PriContact.LoadContacts(this.ds.Tables[17]),this.ds.Tables.length>18&&this.ViewAssignHistroy.LoadHistroy_2(this.ds.Tables[18]),this.ds.Tables.length>19&&this.ViewCRMHistroy.LoadCRMHistroy(this.ds.Tables[18]),this.LoadReport()}}catch(t){Logger.ErrorLog("AddEditLeads:: Load"+t.stack)}Logger.InfoLog("AddEditLeads::Exiting Load")}LoadReport(){let e=this.ScreenObject.CustomTab.Pages.find(e=>"Documents"==e.Name);if(e&&null!=this.ds){let t=this.ds.Tables[2].filter(e=>"LinkDimension"==e.Name);if(t.length>0&&!l.e.IsEmpty(t[0].Value)&&this.ds.Tables[0].length>0){let s=0,i=parseInt(t[0].Value)-5e4;s=l.e.Int(this.ds.Tables[0][0].CCLeadID),0==s&&(s=-123);let a="DCC.dcCCNID"+i+"="+s,o="";if(t=this.ds.Tables[2].filter(e=>"CreateDocuments"==e.Name),t.length>0&&!l.e.IsEmpty(t[0].Value)&&(o=t[0].Value.toString().Replace(";",",")),o.length>0){let t="<XML><Row ColID='300' Value='"+o+"'/>";t+="<Row ColID='CRM_Masters_DocumentsTab' Value='"+a+"'/>",t+="</XML>",null==this.Report?(this.Report=new y.ReportViewModel,this.Report.ReportViewModel_Document(86,t,162,!1,null,null),this.Report.ShowHeaderButtons=!1,this.Report.ShowRightPanel=!1,this.Report.SearchVisibility=!1,e.Fields.Clear(),e.Fields.push(this.Report)):(this.Report.LoadDocFilterXML(t),this.Report.OnReportClick(this.Report.ReportID,0))}}}}OnSave(e){if("CloseVisiblity"==e)this.CloseLead=new P.a(this.LeadID,this,86),i.a.page.ShowDialog(this.CloseLead,H.CloseLeadComponent,{ShowCenter:!0,NoWidth:!0});else if("Save"==e||"SaveDraft"==e)try{this.LED.LeadID=this.LeadID;let t=this.ScreenObject.ValidateData();if(!l.e.IsEmpty(t))return this.DisplayMessage=t,void(this.MessageVisibility=!0);if(0==this.LED.LeadID){let e={StrCode:this.LED.Code,CodePrefix:this.LED.CodePrefix,CodeNumber:this.LED.CodeNumber};if(this.DisplayMessage=this.ScreenObject.SetAutoCodeParams_3(this.Code,this.ParentId,this.ScreenObject.Data.Tables[7],e),this.LED.Code=e.StrCode,this.LED.CodePrefix=e.CodePrefix,this.LED.CodeNumber=e.CodeNumber,this.DisplayMessage.length>0)return}else this.LED.Code=this.Code.Text;if(null!=this.Mode.SelectedValue&&""!=this.Mode.SelectedValue||(this.Mode.SelectedValue="0"),this.LED.Mode=parseInt(this.Mode.SelectedValue),this.Company.Visible?"0"==this.Mode.SelectedValue?this.LED.Company=null!=this.Company.Text?this.Company.Text:"":(this.LED.Company=null!=this.Company.Code.Text?this.Company.Code.Text:"",this.LED.SelectedModeID=this.Company.Code.SelectedValue):this.Company.Enable&&this.Company.Visible||(this.LED.Company=this.Code.Text),this.Subject.Visible?this.LED.Name=this.Subject.Text:this.Subject.Enable&&this.Subject.Visible||(this.LED.Name=this.Code.Text),this.Status.Visible?this.LED.StatusID=parseInt(this.Status.SelectedValue):this.Status.Enable&&this.Status.Visible||(this.LED.StatusID=415),this.Date.Visible?this.LED.Date=this.Date.Date:this.Date.Enable&&this.Date.Visible||(this.LED.Date=Date.Today()),this.LED.CampaignID=this.Campaign.Visible||0!=this.Campaign.SelectedValue?this.Campaign.SelectedValue:1,this.LED.SourceID=this.Source.Visible&&0!=this.Source.SelectedValue?this.Source.SelectedValue:0,this.LED.RatingID=this.Rating.Visible&&0!=this.Rating.SelectedValue?this.Rating.SelectedValue:0,this.LED.IndustryID=this.Industry.Enable&&0!=this.Industry.SelectedValue?this.Industry.SelectedValue:0,this.LED.Contact=this.ContactList.Visible&&""!=this.ContactList.SelectedValue?parseInt(this.ContactList.SelectedValue):0,this.LED.Details=this.details(),this.LED.ActivityXML=this.ViewActivities.ActivitiesXML(),this.LED.ProductsXML=this.LeadsProduct.GetProductXML(),this.LED.TabXML=this.getFields(),this.LED.CustomFieldsQuery=this.ScreenObject.GetCustomFieldsQuery(),this.LED.CustomCostCenterFieldsQuery=this.ScreenObject.GetCustomCostCenterFieldsQuery(),this.LED.EmailsAllow=this.ViewContactMethod.EmailAllow.IsChecked,this.LED.BulkEmailAllow=this.ViewContactMethod.BulkEmailAllow.IsChecked,this.LED.PhoneAllow=this.ViewContactMethod.PhoneAllow.IsChecked,this.LED.FaxAllow=this.ViewContactMethod.FaxAllow.IsChecked,this.LED.MailAllow=this.ViewContactMethod.MailAllow.IsChecked,this.LED.NotesXML=this.ViewNotes.GetXML(),this.LED.FeedBackXML=this.ViewFeedback.GetXML(),this.LED.CVRXML=this.ViewCVRViewModel.GetXML(),this.LED.AttachmentXML=this.ViewAttachments.GetXML(),this.LED.ContactsXML=this.ViewContacts.GetXML(),null!=this.PriContact&&this.PriContact.CheckPrimaryDuplicateContact())return void(this.DisplayMessage="Duplicate Contact[s] in Contacts DB");if(this.LED.PrimaryContactXML=this.PriContact.GetXML(),!this.ScreenObject.ValidateDataonSave())return;let s=this.LED.SaveLead();this.DisplayMessage=s.Message,this.Ret=s.RetValue,this.Ret>0&&("SaveDraft"==e&&(this.LeadID=this.Ret,this.LeadID>0&&this.Load(this.LeadID)),"SaveDraft"!=e&&(this.ClearFields(),this.LED.LeadID>0&&(this.ButtonSave.Enable=!1,this.Code.Text=""),this.Status.SelectedValue="415",this.Mode.Items.Clear(),this.IncludeNewInMode&&(this.Mode.Items.push(C.d.ComboBoxItems_2("New","0")),this.Mode.SelectedValue="0"),this.lstModeDetails.Clear(),this.AutoGenerateCode(),this.ViewActivities.Activity.SelectedValue="-1",this.ViewContacts.ContactsListObj.Clear(),this.ViewNotes.NotesListObj.Clear(),this.ViewContacts.DeletedContacts.Clear(),this.ViewAttachments.AttachmentsListObj.Clear(),this.LeadsProduct.ClearGrid(),this.ViewActivities.ActivityGridDataObj.Clear(),this.ViewAssignHistroy.ListObj.Clear(),this.ViewCRMHistroy.ListObj.Clear(),this.ViewFeedback.FeedBackDataObj.Clear(),this.ViewCVRViewModel.FeedBackDataObj.Clear(),null!=this.PriContact&&this.PriContact.ClearFields()),Logger.InfoLog("AddEditLeads :: Exiting OnSaveLead"))}catch(t){Logger.ErrorLog("AddEditLeads :: OnSaveLead"+t.stack)}else if("Convert"==e){let e=null;if(e=this.ds.Tables[2].filter(e=>"ConvertApprovedLeads"==e.Name),e.length>0)if(l.e.IsEmpty(e[0].Value)||"0"==e[0].Value.toString()){let e=new W(this.LeadID,this.ds,86);i.a.page.ShowDialog(e,J.a,{ShowCenter:!0})}else if(Object(n.j)(e[0].Value)){if(null!=this.ds&&this.ds.Tables.length>1&&this.ds.Tables[0].length>0&&this.ds.Columns[0].Contains("IsApproved")&&!Object(n.j)(this.ds.Tables[0][0].IsApproved))return void alert("Lead should be in approved status!");let e=new W(this.LeadID,this.ds,86);i.a.page.ShowDialog(e,J.a,{ShowCenter:!0})}else{let e=new W(this.LeadID,this.ds,86);i.a.page.ShowDialog(e,J.a,{ShowCenter:!0})}}else if("Assign"==e){if(this.LeadID>0){this.IsAssign=!0;let e=new Z.AssignFeatureViewModel;e.AssignFeatureViewModel_1(this,this.LeadID,86),i.a.page.ShowDialog(e,$.AssignFeatureComponent,{ShowCenter:!0})}}else if("Approve"==e){let e=new K.a(this,86,this.LeadID);i.a.page.ShowDialog(e,z.a,{ShowCenter:!0})}else"Email"==e&&this.LeadID>0&&i.a.page.ShowDialog(new Y.SendEmailSMSViewModel(!0,this.CostCenterID,this.LeadID,this),q.SendEmailSMSComponent)}OnShowContact(){}}var ie=s("unEg");class ae extends h.b{constructor(e,t,s,a,o){super(),this.leadmodel=new I.a,this.ScreenObject=new r.a,this.parentid=1,this.selectedNode=0,this.group=!1,this.Company=null,this.Subject=null,this.Code=new d.a(24198),this.Status=null,this.Mode=null,this.Group=null,this.Ret=0,this.RetValue=0,this.CostCenterID=0,this.NodeID=0,this.ActVisibility=!1,this.ClassName="QuickAddLeads",this.parent=e,this.NodeID=t,this.parentid=s,this.selectedNode=o,this.CostCenterID=86,this.group=a,this.ButtonSave=new D.a,this.ScreenObject.LoadQuickScreen(this,86,a),a?this.ActVisibility=!1:ae.SetActivityUI(this,this.ScreenObject.dtActivityQuick),this.leadmodel.LeadID=this.NodeID;let h=this.ScreenObject.GetQuickCode(24198);if(null!=h?this.Code=h:this.Code.Visible=!1,this.Company=this.ScreenObject.GetQuickText(24399),this.Status=this.ScreenObject.GetQuickCombo(24400),this.Mode=this.ScreenObject.GetQuickCombo(26637),this.Group=this.ScreenObject.GetQuickField(25905),this.Subject=this.ScreenObject.GetQuickText(25069),null!=this.Group&&(this.Group.Enable=!1,this.Group.CCID=86,this.Group.TypeID=2,this.Group.SelectedValue=s),null!=this.Status&&(this.ScreenObject.Data.Tables[3].forEach(e=>{this.Status.Items.push(C.d.ComboBoxItems_2(l.e.String(e.Status),e.StatusID.toString()))}),this.Status.SelectedValue="415"),null!=this.Company){let e=this.ScreenObject.Data.Tables[4].filter(e=>"CapsLock"==e.Name);e.length>0&&Object(n.j)(e[0].Value)&&(this.Company.IsAllCaps=!0),e=this.ScreenObject.Data.Tables[4].filter(e=>"CapsToFirstLetter"==e.Name),e.length>0&&Object(n.j)(e[0].Value)&&(this.Company.IsFirstLetterCaps=!0)}this.ScreenObject.InitAutoCode(this.ScreenObject.Data.Tables[7],this.group),this.AutoGenerateCode(),0==this.NodeID?(this.Title=i.a.GetResource("CRMLead_AddLead"),this.leadmodel.GUID="GUID"):(this.Title=i.a.GetResource("CRMLead_EditLead"),this.LoadEditData()),this.Title=0==this.group?i.a.GetResource(0==this.NodeID?"CRMLead_AddLead":"CRMLead_EditLead"):0==this.NodeID?i.a.GetResource("CRMLead_AddGroup"):"Edit Group"}LoadEditData(){let e=this.leadmodel.GetLead(this.NodeID);null!=e&&e.Tables.length>5&&e.Columns[5].Contains("ConvertFromLeadID")&&e.Tables[5].length>0&&parseInt(e.Tables[5][0][e.Columns[5][0]].toString())>0&&(this.ButtonSave.Enable=!1,this.DisplayMessage="Lead is converted to Opportunity cannot be edited"),null!=this.Code&&(this.Code.Text=e.Tables[0][0].Code.toString(),(this.ScreenObject.InheritParentCode||this.ScreenObject.IsAutoCode)&&(this.Code.Enable=!1)),this.leadmodel.GUID=e.Tables[0][0].GUID.toString(),this.leadmodel.Company=e.Tables[0][0].Company.toString(),this.leadmodel.Code=e.Tables[0][0].Code.toString();let t=null;e.Tables[11].length>0&&(t=e.Tables[11][0]);let s=null;e.Tables[3].length>0&&(s=e.Tables[3][0]),this.ScreenObject.FillControls(e.Tables[0][0],e.Tables[4][0],t,s),this.ScreenObject.LoadPrimaryContactData(e.Tables[3],e.Columns[3]),this.ActVisibility&&!this.group&&e.Tables.length>7&&(this.ViewActivities.LoadActivityData(e.Tables[8]),this.ViewActivities.ActivityGridData.length>0?(this.ViewActivities.SelectedRow=this.ViewActivities.ActivityGridData[this.ViewActivities.ActivityGridData.length-1],this.ViewActivities.OnCmnItem_Click("EDIT","EDIT")):this.ActVisibility=!1),null!=this.Group&&(this.Group.SelectedValue=parseInt(e.Tables[0][0].ParentID)),null!=this.Status&&(this.Status.SelectedValue=e.Tables[0][0].StatusID.toString()),Logger.InfoLog("QuickAddCustomersViewModel::Exiting LoadEditData")}AutoGenerateCode(){let e;0==this.NodeID&&null!=this.Code&&this.ScreenObject.SetAutoCode(this.Code,this.group,this.parentid,this.ScreenObject.Data.Tables[7]);var t=this.ScreenObject.StaticFields.find(e=>26637==e.DBColumnID);t&&t instanceof C.e&&(t.Items.Clear(),e=this.ScreenObject.Data.Tables[4].filter(e=>"IncludeNewInMode"==e.Name),e.length>0&&""!=e[0].Value.toString()&&Object(n.j)(e[0].Value.toString())&&(t.Items.push(C.d.ComboBoxItems_2("New","0")),t.SelectedValue="0"),e=this.ScreenObject.Data.Tables[4].filter(e=>"LinkDimension"==e.Name),e.length>0&&""!=e[0].Value.toString()&&t.Items.push(C.d.ComboBoxItems_2("Existing lead","1")),e=this.ScreenObject.Data.Tables[4].filter(e=>"AccountLinkDimension"==e.Name),e.length>0&&""!=e[0].Value.toString()&&t.Items.push(C.d.ComboBoxItems_2("Account","2")),e=this.ScreenObject.Data.Tables[4].filter(e=>"CustomerInMode"==e.Name),e.length>0&&Object(n.j)(e[0].Value)&&t.Items.push(C.d.ComboBoxItems_2("Customer","3")))}OnSave(e){if("Cancel"==e)this.parent.DetailsVisibility=!0;else if("Save"==e)try{this.leadmodel.LeadID=this.NodeID,this.leadmodel.IsGroup=this.group;let e=this.ScreenObject.ValidateData();if(!l.e.IsEmpty(e))return this.DisplayMessage=e,void(this.MessageVisibility=!0);if(0==this.leadmodel.LeadID){if(0==this.leadmodel.LeadID&&null!=this.Code){let e={StrCode:this.leadmodel.Code,CodePrefix:this.leadmodel.CodePrefix,CodeNumber:this.leadmodel.CodeNumber};if(this.DisplayMessage=this.ScreenObject.SetAutoCodeParams_3(this.Code,this.parentid,this.ScreenObject.Data.Tables[7],e),this.leadmodel.Code=e.StrCode,this.leadmodel.CodePrefix=e.CodePrefix,this.leadmodel.CodeNumber=e.CodeNumber,this.DisplayMessage.length>0)return}if(this.Company&&(this.leadmodel.Company=this.Company.Text),this.Subject?this.leadmodel.Name=this.Subject.Text:this.Code&&(this.leadmodel.Name=this.Code.Text),this.leadmodel.StatusID=this.Status?parseInt(this.Status.SelectedValue):415,this.leadmodel.SelectedNodeID=this.Group&&this.Group.SelectedValue>0?this.Group.SelectedValue:this.parentid,this.leadmodel.Date=this.ScreenObject.GetDatePickerValue(25068,Date.Today()),this.leadmodel.CampaignID=this.ScreenObject.GetPactListValue(25073,1),this.leadmodel.SourceID=this.ScreenObject.GetTextComboValue_int(25071,0),this.leadmodel.RatingID=this.ScreenObject.GetTextComboValue_int(25072,0),this.leadmodel.IndustryID=this.ScreenObject.GetTextComboValue_int(25074,0),this.leadmodel.Contact=this.ScreenObject.GetTextComboValue_int(26651,0),this.leadmodel.Details=this.details(),this.ActVisibility){if(this.Activities.onSaveActivity("Save"),!l.e.IsEmpty(this.Activities.DisplayMessage))return void(this.DisplayMessage=this.Activities.DisplayMessage);this.leadmodel.ActivityXML=this.ViewActivities.ActivitiesXML()}else this.leadmodel.ActivityXML="";if(this.leadmodel.ProductsXML="",this.leadmodel.TabXML="",this.leadmodel.CustomFieldsQuery=this.ScreenObject.GetQuickExtraFieldsQuery(),this.leadmodel.CustomCostCenterFieldsQuery=this.ScreenObject.GetQuickExtraCCFieldsQuery(),this.leadmodel.NotesXML="",this.leadmodel.FeedBackXML="",this.leadmodel.CVRXML="",this.leadmodel.AttachmentXML="",this.leadmodel.ContactsXML="",this.leadmodel.PrimaryContactXML=this.ScreenObject.GetPrimaryContact(),!this.ScreenObject.ValidateDataonSave())return;let e=this.leadmodel.SaveLead();this.DisplayMessage=e.Message,this.Ret=e.RetValue}else{if(null!=this.Code&&(this.leadmodel.Code=this.Code.Text),null!=this.Company&&(this.leadmodel.Company=this.Company.Text),this.ActVisibility){if(this.Activities.onSaveActivity("Save"),!l.e.IsEmpty(this.Activities.DisplayMessage))return void(this.DisplayMessage=this.Activities.DisplayMessage);this.leadmodel.ActivityXML=this.ViewActivities.ActivitiesXML()}else this.leadmodel.ActivityXML="";if(this.leadmodel.StaticFieldsQuery=this.ScreenObject.GetStaticFieldsQuery(),this.leadmodel.CustomFieldsQuery=this.ScreenObject.GetQuickExtraFieldsQuery(),this.leadmodel.CustomCostCenterFieldsQuery=this.ScreenObject.GetQuickExtraCCFieldsQuery(),this.leadmodel.Details=this.details(),!this.ScreenObject.ValidateDataonSave())return;let e=this.leadmodel.SaveLeadQuick();this.DisplayMessage=e.Message,this.Ret=e.RetValue}this.MessageVisibility=!0,this.RetValue=this.Ret,this.Ret>0&&(null!=this.Company&&(this.Company.Text=""),null!=this.Status&&(this.Status.SelectedValue="415"),null!=this.parent&&(null!=this.parent.SelectedNode&&(this.parent.obj.SetFocusNodeID=this.parent.SelectedNode.Id),this.parent.Refresh()),this.AutoGenerateCode(),null!=this.Activities&&this.Activities.ClearFields())}catch(t){Logger.ErrorLog("SaveLeadViewModel:: OnSave"+t.stack)}else{let e=new se(this.NodeID,this.parentid,this.group);this.ScreenObject.StaticFields.forEach(t=>{var s=e.ScreenObject.StaticFields.find(e=>e.DBColumnID==t.DBColumnID);s&&(s instanceof d.d?s.Text=t.Text:s instanceof c.c?t instanceof d.d&&(s.Text=t.Text):s instanceof C.e||s instanceof c.b?s.SelectedValue=t.SelectedValue:s instanceof u.a?s.Date=t.Date:s instanceof d.a&&t instanceof d.a&&(s.Text=t.Text,s.SuffixCode=t.SuffixCode,s.PrefixCode=t.PrefixCode))}),i.a.page.addNewTab({component:ie.AddEditLeadComponent,params:{obj:e}}),i.a.page.HideDialog()}}static GetValidXml(e){return(e=(e=(e=e.Replace("&","&amp;")).Replace("'","&apos;&apos;")).Replace('"',"&quot;")).Replace("<","&lt;")}details(){Logger.InfoLog("AddEditLeads::Entering details");try{let e="";return 0==this.NodeID?(e+="<Row ",this.ScreenObject.StaticFields.forEach(t=>{"CRM_CONTACTS"==t.SysTableName.toUpperCase()&&("FirstName"==t.DBColumnName&&""!=t.Text?e+=' FirstName="'+ae.GetValidXml(t.Text)+'"':"MiddleName"==t.DBColumnName&&""!=t.Text?e+=' MiddleName="'+ae.GetValidXml(t.Text)+'"':"LastName"==t.DBColumnName&&""!=t.Text?e+=' LastName="'+ae.GetValidXml(t.Text)+'"':"JobTitle"==t.DBColumnName&&""!=t.Text?e+=' JobTitle="'+ae.GetValidXml(t.Text)+'"':"Phone1"==t.DBColumnName&&""!=t.Text?e+=' Phone1="'+ae.GetValidXml(t.Text)+'"':"Phone2"==t.DBColumnName&&""!=t.Text?e+=' Phone2="'+ae.GetValidXml(t.Text)+'"':"Email"==t.DBColumnName&&""!=t.Text?e+=' Email="'+ae.GetValidXml(t.Text)+'"':"Fax"==t.DBColumnName&&""!=t.Text?e+=' Fax="'+ae.GetValidXml(t.Text)+'"':"Department"==t.DBColumnName&&""!=t.Text&&(e+=' Department="'+ae.GetValidXml(t.Text)+'"'))}),e+="/>"):this.ScreenObject.StaticFields.forEach(t=>{"CRM_CONTACTS"==t.SysTableName.toUpperCase()&&"CRM_CONTACTS"==t.SysTableName.toUpperCase()&&("FirstName"==t.DBColumnName&&""!=t.Text?e+=" FirstName='"+ae.GetValidXml(t.Text)+"'":"MiddleName"==t.DBColumnName&&""!=t.Text?e+=" MiddleName='"+ae.GetValidXml(t.Text)+"'":"LastName"==t.DBColumnName&&""!=t.Text?e+=" LastName='"+ae.GetValidXml(t.Text)+"'":"JobTitle"==t.DBColumnName&&""!=t.Text?e+=" JobTitle='"+ae.GetValidXml(t.Text)+"'":"Phone1"==t.DBColumnName&&""!=t.Text?e+=" Phone1='"+ae.GetValidXml(t.Text)+"'":"Phone2"==t.DBColumnName&&""!=t.Text?e+=" Phone2='"+ae.GetValidXml(t.Text)+"'":"Email"==t.DBColumnName&&""!=t.Text?e+=" Email='"+ae.GetValidXml(t.Text)+"'":"Fax"==t.DBColumnName&&""!=t.Text?e+=" Fax='"+ae.GetValidXml(t.Text)+"'":"Department"==t.DBColumnName&&""!=t.Text&&(e+=" Department='"+ae.GetValidXml(t.Text)+"'"))}),e.toString()}catch(e){return""}}static SetActivityUI(e,t){if(t.length>0){e.ActVisibility=!0,e.Activities=new T.a(e,!1),e.Activities.IsPopup=!1,e.Activities.LoadCustomFields(86),e.Activities.AssignVisiblity=!1,e.Activities.HeaderVisible=!1,e.Activities.ButtonsVisible=!1,e.ViewActivities=new g.b(e),e.ViewActivities.Activities=e.Activities;let s=t.filter(e=>"ActivityTypeName"==e.SysColumnName);e.Activities.ActivityType.Visible=s.length>0,s=t.filter(e=>"StatusID"==e.SysColumnName),e.Activities.StatusVisible=s.length>0,s=t.filter(e=>"Subject"==e.SysColumnName),e.Activities.Subject.Visible=s.length>0,s=t.filter(e=>"CRMCustomer"==e.SysColumnName),e.Activities.CRMCustomer.Visible=s.length>0,s=t.filter(e=>"CRMContactPerson"==e.SysColumnName),e.Activities.CRMContactPerson.Visible=s.length>0,s=t.filter(e=>"AssignUserID"==e.SysColumnName),e.Activities.AssignUserList.Visible=s.length>0,s=t.filter(e=>"Remarks"==e.SysColumnName),e.Activities.Remarks.Visible=s.length>0,e.Activities.Fields.forEach(e=>{s=t.filter(t=>t.SysColumnName==e.SysColumnName),e.Visible=s.length>0})}else e.ActVisibility=!1}}var oe=s("5Crg"),le=s("uMy8"),ne=s("vTM8");class he extends h.b{constructor(e){super(),this.ButtonClick=new f.b,this.ds=[],this.dr1=[],this.Date=new u.a(0),this.Status=new C.e(0),this.Reason=new C.e(0),this.EstimatedRevenue=new d.d(0),this.Remark=new d.d(0),this.oparent=e,this.ButtonClick.Subscribe(this,"OnSave"),e.ScreenObject.Data.Tables[0].forEach(e=>{"24320"==e.CostCenterColID.toString()&&(this.Status.Label=e.ResourceData.toString()),"25403"==e.CostCenterColID.toString()&&(this.EstimatedRevenue.Label=e.ResourceData.toString()),"25405"==e.CostCenterColID.toString()&&(this.Date.Label=e.ResourceData.toString()),"53583"==e.CostCenterColID.toString()&&(this.Reason.Label=e.ResourceData.toString(),this.Reason.Mandatory=Object(n.j)(e.IsMandatory)),"25953"==e.CostCenterColID.toString()&&(this.Remark.Label=e.ResourceData.toString(),this.Remark.Mandatory=Object(n.j)(e.IsMandatory))});let t=i.a.admin.GetLookupDataByType(0);if(this.dr1=t.Tables[1].filter(e=>19==e.LookupType),this.dr1.length>0){for(let e=0;e<this.dr1.length;e++)this.Reason.Items.push(C.d.ComboBoxItems_2(this.dr1[e].Name.toString(),this.dr1[e].NodeID.toString()));this.Reason.SelectedValue=this.Reason.Items[0].Value.toString()}if(null==e.ds)return;this.drr=e.ds.Tables[0].filter(e=>"CloseStatus"==e.Name);let s=null;if(this.drr.length>0&&""!=this.drr[0].Value.toString()&&(s=this.drr[0].Value.toString().split(";")),null!=s&&s.length>0)for(let i=0;i<s.length;i++)for(let t=0;i<e.Status.Items.length;t++){let a=e.Status.Items[t];if(s[i]==a.Value){this.Status.Items.push(a);break}}this.Status.Items.length>0&&(this.Status.SelectedValue=this.Status.Items[0].Value),this.Title=this.DisplayName=i.a.GetResource("CRMOpportunity_CloseOpportunity")}OnSave(e){"Cancel"==e?i.a.page.HideDialog():"OK"==e&&(null!=this.oparent.Status&&this.oparent.Status.Mandatory&&l.e.StringIsNullOrEmpty(this.Status.SelectedValue)?(this.DisplayMessage=i.a.GetResource("Select")+"  Status",this.MessageVisibility=!0):null!=this.Reason&&this.Reason.Mandatory&&l.e.StringIsNullOrEmpty(this.Reason.SelectedValue)?(this.DisplayMessage=i.a.GetResource("Select")+" Status",this.MessageVisibility=!0):null!=this.oparent.EstimatedRevenue&&this.oparent.EstimatedRevenue.Mandatory&&l.e.StringIsNullOrEmpty(this.EstimatedRevenue.Text)?(this.DisplayMessage=" Please Enter Revenue",this.MessageVisibility=!0):(this.oparent.Status.SelectedValue=this.Status.SelectedValue,this.oparent.EstimateRevenceData(this.EstimatedRevenue.Text,Date.Today(),this.Reason.SelectedValue),i.a.page.HideDialog()))}}var re=s("Sbfj");class de extends h.b{constructor(e,t,s){super(),this.PrintVisible=!1,this.PrintViewVisible=!1,this.AssignVisiblity=!1,this.dt=null,this.Opp=new Q.a,this.OppID=0,this.ScreenObject=new r.a,this.ButtonEnable=!0,this.CloseVisible=!1,this.Salutation=new C.e(26670),this.FirstName=new d.d(26661),this.MiddleName=new d.d(26662),this.LastName=new d.d(26663),this.JobTitle=new d.d(26664),this.Phone1=new d.d(26665),this.Phone2=new d.d(26666),this.Email=new d.d(26667),this.Fax=new d.d(26668),this.Department=new d.d(26669),this.Code=new d.a(24317),this.Date=new u.a(24319),this.Status=new C.e(24320),this.Subject=new d.d(24318),this.Company=new c.c(25400),this.Campaign=new C.e(25399),this.Mode=new C.e(26639),this.Lead=new c.b(25401),this.ContactCombo=new C.e(25402),this.EstimateRow=0,this.EstimateColumn=0,this.EstimateColumnSpan=1,this.EstimatedRevenue=new d.d(25403),this.Currency=new c.b(25404),this.EstimatedCloseDate=new u.c(25405),this.Probability=new c.b(25406),this.Rating=new c.b(25407),this.CloseDate=new d.d(25408),this.Document=new C.e(0),this.Activity=new C.e(0),this.Address1=new d.d(26679),this.Address2=new d.d(26680),this.Address3=new d.d(26681),this.City=new d.d(26682),this.State=new d.d(26683),this.Zip=new d.d(26684),this.Country=new C.e(26685),this.ActivityGridData=[],this.ActivityColumnSource=new Array,this.ContactPersonColID=0,this.Ret=0,this.CostCenterID=0,this.NodeID=0,this.NextPreviousVisibility=!0,this.ContactVisibility=!1,this.PrimaryVisibility=!1,this.ParentId=1,this.LeadModeID=0,this.LeadMode=0,this.IsGroup=!1,this.dtStatusProbability=null,this.dvContacts=null,this.dvContactsTable=null,this.lstModeDetails=new Array,this.ParentId=t,this.IsGroup=s,this.ClassName="AddEditOpportunity",this.Opp.SelectedNodeID=this.ParentId,this.CostCenterID=89,this.NodeID=e,this.OppID=e;let a=i.a.admin.GetLookupDataByType(0);if(this.LeadsProduct=new x.a(this,89),this.ViewFeedback=new U.a(this),i.a.SessionManager.IsWebApplication&&(this.Feedback=new _.a(this.ViewFeedback)),this.ViewContacts=new A.a(this),this.PrimaryContact=new L.a,this.PrimaryContact.QuickAddDContactViewModel_1(this),this.PrimaryContact.IsPrimaryContact=!0,this.ViewActivities=new g.b(this),this.Activities=new T.a(this,!1),this.ViewActivities.Activities=this.Activities,this.ViewNotes=new N.a(this),this.ViewAttachments=new O.ViewAttachmentViewModel(this),this.ViewAssignHistroy=new V.a(this),this.ScreenObject.LoadScreen_2(this,89),this.EstimateRow=this.EstimatedRevenue.Row,this.EstimateColumn=this.EstimatedRevenue.Column,this.EstimateColumnSpan=this.EstimatedRevenue.ColumnSpan,this.Mode.Items.push(C.d.ComboBoxItems_2("New","0")),this.Mode.Items.push(C.d.ComboBoxItems_2("Converted","4")),null!=this.ScreenObject.Data&&this.ScreenObject.Data.Tables[4].length>0){let e=this.ScreenObject.Data.Tables[4].filter(e=>"ActContactPerson"==e.Name);e.length>0&&!l.e.IsEmpty(e[0].Value)&&(this.ContactPersonColID=parseInt(e[0].Value)),e=this.ScreenObject.Data.Tables[4].filter(e=>"CapsLock"==e.Name),e.length>0&&Object(n.j)(e[0].Value)&&(this.Company.IsAllCaps=!0),e=this.ScreenObject.Data.Tables[4].filter(e=>"CapsToFirstLetter"==e.Name),e.length>0&&Object(n.j)(e[0].Value)&&(this.Company.IsFirstLetterCaps=!0),e=this.ScreenObject.Data.Tables[4].filter(e=>"AccountLinkDimension"==e.Name),e.length>0&&!l.e.IsEmpty(e[0].Value)&&(this.Mode.Items.push(C.d.ComboBoxItems_2("Account","2")),this.lstModeDetails.push(C.d.ComboBoxItems_2(e[0].Value.toString(),"Account"))),e=this.ScreenObject.Data.Tables[4].filter(e=>"CustomerInMode"==e.Name),e.length>0&&Object(n.j)(e[0].Value)&&(this.Mode.Items.push(C.d.ComboBoxItems_2("Customer","3")),this.lstModeDetails.push(C.d.ComboBoxItems_2(e[0].Value.toString(),"Customer"))),e=this.ScreenObject.Data.Tables[4].filter(e=>"HidePrimaryContact"==e.Name),this.PrimaryVisibility=e.length>0&&!Object(n.j)(e[0].Value)}this.Company.Code.Visible=!1,this.Company.TextVisible=!0,this.ScreenObject.Data.Tables.length>5&&(this.dtStatusProbability=this.ScreenObject.Data.Tables[6]),this.Lead.SelectionChangedCommand.Subscribe(this,"onClickLeadCommand"),this.Mode.SelectionChangedCommand.Subscribe(this,"OnModeChange"),this.Status.SelectionChangedCommand.Subscribe(this,"onStatusSelectionChanged"),this.ContactCombo.SelectionChangedCommand.Subscribe(this,"onContactSelectionChanged"),this.EstimatedRevenue.Enable=!1,this.Company.Code.SelectionChangedCommand.Subscribe(this,"onCompanySelectionChanged");let o=a.Tables[1].filter(e=>56==e.LookupType);o.length>0&&C.e.FillComboWithDefaultOption(o,this.Status),o=a.Tables[1].filter(e=>20==e.LookupType),o.length>0&&C.e.FillComboWithDefaultOption(o,this.Salutation),o=a.Tables[1].filter(e=>16==e.LookupType);for(let i=0;i<this.ScreenObject.CustomTab.Pages.length;i++)if("Address Details"==this.ScreenObject.CustomTab.Pages[i].Name.toString())for(let e=0;e<this.ScreenObject.CustomTab.Pages[i].Fields.length;e++)if(26685==this.ScreenObject.CustomTab.Pages[i].Fields[e].DBColumnID&&o.length>0){for(let t=0;t<o.length;t++)this.ScreenObject.CustomTab.Pages[i].Fields[e].Items.push(C.d.ComboBoxItems_2(o[t].Name.toString(),o[t].NodeID.toString()));this.ScreenObject.CustomTab.Pages[i].Fields[e].SelectedValue=this.ScreenObject.CustomTab.Pages[i].Fields[e].Items[0].Value}if(this.ContactCombo.Items.push(C.d.ComboBoxItems_2("New","0")),this.ContactCombo.SelectedValue="0",this.Campaign.Items.push(C.d.ComboBoxItems_2("Default","1")),this.Campaign.SelectedValue="1",null!=this.dt&&this.dt.Tables.length>1&&this.dt.Tables[1].length>0){for(let e=0;e<this.dt.Tables[1].length;e++)this.Document.Items.push(C.d.ComboBoxItems_2(this.dt.Tables[1][e].DOCNAME.toString(),this.dt.Tables[1][e].DOCID.toString()));this.Document.SelectedValue="-1"}this.Activity.Items.push(C.d.ComboBoxItems_2("All","-1")),this.Activity.Items.push(C.d.ComboBoxItems_2("Open","1")),this.Activity.Items.push(C.d.ComboBoxItems_2("Closed","2")),this.Activity.SelectedValue="1",this.loadtabs(),this.ButtonSave=new D.a,this.ButtonEmail=new D.a,0==e&&(i.a.SessionManager.HideUnathorizedAccess?this.ButtonSave.Visible=i.a.SessionManager.IsActionAssigned(89,"Create"):this.ButtonSave.Enable=i.a.SessionManager.IsActionAssigned(89,"Create")),0!=e?i.a.SessionManager.HideUnathorizedAccess?this.ButtonEmail.Visible=i.a.SessionManager.IsActionAssigned(this.CostCenterID,"Email"):this.ButtonEmail.Enable=i.a.SessionManager.IsActionAssigned(this.CostCenterID,"Email"):i.a.SessionManager.HideUnathorizedAccess?this.ButtonSave.Visible=i.a.SessionManager.IsActionAssigned(89,"Update"):this.ButtonSave.Enable=i.a.SessionManager.IsActionAssigned(89,"Update"),this.ScreenObject.InitAutoCode(this.ScreenObject.Data.Tables[7],!1),this.AutoGenerateCode(),this.ds=[],0==e?(this.DisplayName=i.a.GetResource("CRMOpportunity_AddOpportunity"),this.Opp.GUID="Guid",this.GetCurrency(),this.NextPreviousVisibility=!1,this.Lead.CCID=86,this.Currency.CCID=12,this.Lead.TypeID=this.Currency.TypeID=1,this.Lead.SelectedValue=this.Currency.SelectedValue=1,this.CloseDate.IsReadOnly=!0,this.CloseVisible=!1,this.OnModeChange(null)):(this.Lead.CCID=86,this.Currency.CCID=12,this.Lead.TypeID=this.Currency.TypeID=1,this.Lead.SelectedValue=this.Currency.SelectedValue=1,this.DisplayName=i.a.GetResource("CRMOpportunity_EditOpportunity"),this.LoadData(e),this.CloseDate.IsReadOnly=!0,this.PrintVisible=!0,this.PrintViewVisible=!0,this.CloseVisible=!0),this.Title=this.DisplayName,this.PrimaryContact.Visiblebtns=!1,this.ContactVisibility=!1,this.ScreenObject.CheckEstimateRevenueMapping(this.LeadsProduct.DestProductValueMapping),this.ScreenObject.HeaderFields.sort((e,t)=>e.Row>t.Row||e.Row==t.Row&&e.Column>t.Column?1:-1)}OnAddContact(){this.Contact=new L.a,this.Contact.QuickAddDContactViewModel_1(this)}OnAddNote(){this.Note=new w.AddNoteViewModel,this.Note.AddNoteViewModel_2(this)}OnAddAttachment(){this.Attachment=new M.AddAttachmentViewModel,this.Attachment.AddAttachmentViewModel_2(this)}onStatusSelectionChanged(e){if(""!=this.Status.SelectedValue){let e=this.dtStatusProbability.filter(e=>e.Status==this.Status.SelectedValue);e.length>0?(this.Probability.SelectedValue=parseInt(e[0].Probability.toString()),this.Probability.Enable=!1):this.Probability.Enable=!0}}onCompanySelectionChanged(e){if(this.EnableControls(!0),this.ContactCombo.Items.Clear(),"3"==this.Mode.SelectedValue){if(0!=this.Company.Code.SelectedValue){let e=new m.a;e.CustomerID=this.Company.Code.SelectedValue;let t=e.GetCustomerDetails();if(null!=t&&t.Tables[0].length>0){if(this.ViewContacts.ContactsListObj.Clear(),this.ContactCombo.Items.push(C.d.ComboBoxItems_2("New","0")),this.ContactCombo.SelectedValue="0",t.Tables.length>5&&t.Tables[5].length>0)for(let e=0;e<t.Tables[5].length;e++)l.e.IsEmpty(t.Tables[5][e].ContactID)||this.ContactCombo.Items.push(C.d.ComboBoxItems_2(l.e.String(t.Tables[5][e].FirstName),l.e.String(t.Tables[5][e].ContactID)));if(t.Tables.length>2&&t.Tables[2].length>0){for(let e=0;e<t.Tables[2].length;e++)l.e.IsEmpty(t.Tables[2][e].ContactID)||this.ContactCombo.Items.push(C.d.ComboBoxItems_2(l.e.String(t.Tables[2][e].FirstName),l.e.String(t.Tables[2][e].ContactID)));this.dvContacts=t.Tables[2],this.dvContactsTable=this.dvContacts,t.Tables.length>5&&t.Tables[5].length>0&&this.dvContactsTable.AddRange(t.Tables[5])}}this.Company.Code.SelectedValue!=this.Company.Code.PreviousSelectedValue&&(this.Company.Code.PreviousSelectedValue=this.Company.Code.SelectedValue,this.ScreenObject.OnGetReference(this.Company.Code))}}else if("2"==this.Mode.SelectedValue){if(0!=this.Company.Code.SelectedValue){let e=i.a.accounting.GetAccountDetails(this.Company.Code.SelectedValue);if(null!=e&&e.Tables[0].length>0){if(this.ContactCombo.Items.push(C.d.ComboBoxItems_2("New","0")),this.ContactCombo.SelectedValue="0",e.Tables.length>8&&e.Tables[8].length>0)for(let t=0;t<e.Tables[8].length;t++)this.ContactCombo.Items.push(C.d.ComboBoxItems_2(e.Tables[8][t].FirstName.toString(),e.Tables[8][t].ContactID.toString()));if(e.Tables.length>2&&e.Tables[2].length>0){for(let t=0;t<e.Tables[2].length;t++)this.ContactCombo.Items.push(C.d.ComboBoxItems_2(e.Tables[2][t].FirstName.toString(),e.Tables[2][t].ContactID.toString()));this.dvContacts=e.Tables[2],this.dvContactsTable=this.dvContacts,e.Tables.length>8&&e.Tables[8].length>0&&this.dvContactsTable.AddRange(e.Tables[8])}}this.Company.Code.SelectedValue!=this.Company.Code.PreviousSelectedValue&&(this.Company.Code.PreviousSelectedValue=this.Company.Code.SelectedValue,this.ScreenObject.OnGetReference(this.Company.Code))}}else this.ViewContacts.isPick=!1}onContactSelectionChanged(e){this.EnableControls(!0),null!=this.dvContacts&&null!=this.ContactCombo.SelectedValue&&"0"!=this.ContactCombo.SelectedValue&&(this.dvContacts=this.dvContactsTable.filter(e=>e.ContactID==this.ContactCombo.SelectedValue),this.dvContacts.length>0&&(this.EnableControls(!1),this.FirstName.Visible&&(this.FirstName.Text=this.dvContacts[0].FirstName.toString()),this.LastName.Visible&&(this.LastName.Text=this.dvContacts[0].LastName.toString()),this.MiddleName.Visible&&(this.MiddleName.Text=this.dvContacts[0].MiddleName.toString()),this.Salutation.Visible&&(this.Salutation.SelectedValue=this.dvContacts[0].SalutationID.toString()),this.JobTitle.Visible&&(this.JobTitle.Text=this.dvContacts[0].JobTitle.toString()),this.Phone1.Visible&&(this.Phone1.Text=this.dvContacts[0].Phone1.toString()),this.Phone2.Visible&&(this.Phone2.Text=this.dvContacts[0].Phone2.toString()),this.Email.Visible&&(this.Email.Text=this.dvContacts[0].Email1.toString()),this.Fax.Visible&&(this.Fax.Text=this.dvContacts[0].Fax.toString()),this.Department.Visible&&(this.Department.Text=this.dvContacts[0].Department.toString())))}GetRecords(e){this.ButtonSave.Enable||(this.ButtonSave.Enable=!0);let t=0,s=!1;"NEXT"==e.toString().toUpperCase()?s=!0:"PREVIOUS"==e.toString().toUpperCase()&&(s=!1);let a=i.a.common.GetNextPreviousRecords(this.CostCenterID,this.OppID,s,0,this.IsGroup?1:0);if(null!=a&&a.Tables.length>0&&a.Tables[0].length>0&&(t=parseInt(a.Tables[0][0][a.Columns[0][0]]),t>0)){this.Mode.Items.Clear(),this.lstModeDetails.Clear(),this.Mode.Items.push(C.d.ComboBoxItems_2("New","0")),this.Mode.Items.push(C.d.ComboBoxItems_2("Converted","4"));let e=this.ScreenObject.Data.Tables[4].filter(e=>"AccountLinkDimension"==e.Name);e.length>0&&""!=e[0].Value.toString()&&(this.Mode.Items.push(C.d.ComboBoxItems_2("Account","2")),this.lstModeDetails.push(C.d.ComboBoxItems_2(e[0].Value.toString(),"Account"))),e=this.ScreenObject.Data.Tables[4].filter(e=>"CustomerInMode"==e.Name),e.length>0&&Object(n.j)(e[0].Value)&&(this.Mode.Items.push(C.d.ComboBoxItems_2("Customer","3")),this.lstModeDetails.push(C.d.ComboBoxItems_2(e[0].Value.toString(),"Customer"))),this.LoadData(t)}}OnModeChange(e){if(this.ViewContacts.isPick=!1,"4"==this.Mode.SelectedValue&&this.Mode.Enable&&(this.Mode.SelectedValue="0"),"1"==this.Mode.SelectedValue){if(this.Company.Code.Visible=!0,this.Company.TextVisible=!1,this.lstModeDetails.filter(e=>"LEAD"==e.Value.toUpperCase()).length>0){let e=this.lstModeDetails.find(e=>"Lead"==e.Value);this.Company.Code.CCID=parseInt(e.Name),this.Company.Code.TypeID=1,this.Company.Label="Company",this.Company.Code.Refresh()}}else if("3"==this.Mode.SelectedValue){if(this.ViewContacts.isPick=!0,this.Company.Code.Visible=!0,this.Company.TextVisible=!1,this.lstModeDetails.filter(e=>"CUSTOMER"==e.Value.toUpperCase()).length>0){this.Company.Code.PreviousSelectedValue=0,this.Company.Code.DBColumnName="CustomerID",this.Company.Code.CCID=83,this.Company.Label="Customer";var t=this.lstModeDetails.find(e=>"Customer"==e.Value);this.Company.Code.TypeID=1,this.Company.Code.Refresh()}}else"2"==this.Mode.SelectedValue?(this.ViewContacts.isPick=!0,this.Company.Code.Visible=!0,this.Company.TextVisible=!1,this.lstModeDetails.filter(e=>"ACCOUNT"==e.Value.toUpperCase()).length>0&&(this.Company.Code.PreviousSelectedValue=0,this.Company.Code.DBColumnName="AccountID",this.Company.Code.CCID=2,this.Company.Label="Account",t=this.lstModeDetails.find(e=>"Account"==e.Value),this.Company.Code.TypeID=parseInt(t.Name),this.Company.Code.Refresh())):(this.Company.Label="Company",this.Company.Code.Visible=!1,this.Company.TextVisible=!0)}onClickLeadCommand(e){}onTabSelectionChanged(e){if(null!=this.ScreenObject.CustomTab.SelectedTab)if("Activities"==this.ScreenObject.CustomTab.SelectedTab.Name){this.ScreenObject.CustomTab.ColumnSpan=4,"0"==this.Mode.SelectedValue||"4"==this.Mode.SelectedValue?(this.Activities.CRMCustomer.Text=this.Company.Text,"4"!=this.Mode.SelectedValue||2!=this.LeadMode&&3!=this.LeadMode||(2==this.LeadMode?this.Activities.CRMCustomer.Code.CCID=2:3==this.LeadMode&&(this.Activities.CRMCustomer.Code.CCID=83),this.Activities.CRMCustomer.Code.TypeID=1,this.LeadModeID>0&&(this.Activities.CRMCustomer.Code.SelectedValue=this.LeadModeID),this.Activities.onCustomerSelectionChange("Customer"))):(this.Activities.CRMCustomer.Text=this.Company.Code.Text,null!=this.Activities.CRMCustomer&&(this.Activities.CRMCustomer.Code.CCID=this.Company.Code.CCID,this.Activities.CRMCustomer.Code.TypeID=this.Company.Code.TypeID),this.Activities.CRMCustomer.Text=this.Company.Code.Text,this.Activities.CRMCustomer.Code.SelectedValue=this.Company.Code.SelectedValue,this.Activities.onCustomerSelectionChange("Customer"));var t=this.ScreenObject.StaticFields.find(e=>e.DBColumnID==this.ContactPersonColID);null!=t&&t instanceof d.d&&(this.Activities.CRMContactPerson.Text=t.Text),this.Activities.Location.Text=i.a.SessionManager.LocationName,this.Activities.Location.Enable=!1,this.Activities.CRMCustomer.Enable=!1,this.Activities.AssignVisiblity=!1,this.PrimaryVisibility=!1,this.PrimaryContact.Visiblebtns=!1,this.ContactVisibility=!1}else"Contacts"==this.ScreenObject.CustomTab.SelectedTab.Name&&(this.PrimaryVisibility=!1,this.PrimaryContact.Visiblebtns=!0,this.ViewContacts.OnShowNewContact(null),1==this.Contact.isPopup&&(this.ContactVisibility=!1))}LoadData(e){if(this.OppID=e,this.ds=this.Opp.GetOpportunity(e),this.ScreenObject.IsAutoCode&&(this.Code.Enable=!1),null!=this.ds&&this.ds.Tables.length>1&&this.ds.Tables[1].length>0){if(l.e.IsEmpty(this.ds.Tables[1][0].Code)||(this.Code.Text=this.ds.Tables[1][0].Code.toString()),l.e.IsEmpty(this.ds.Tables[1][0].Subject)||(this.Subject.Text=this.ds.Tables[1][0].Subject.toString()),l.e.IsEmpty(this.ds.Tables[1][0].Date)||(this.Date.Date=new Date(this.ds.Tables[1][0].Date.toString())),l.e.IsEmpty(this.ds.Tables[1][0].StatusID)||(this.Status.SelectedValue=this.ds.Tables[1][0].StatusID.toString()),l.e.IsEmpty(this.ds.Tables[1][0].LeadID)||(this.Lead.SelectedValue=parseInt(this.ds.Tables[1][0].LeadID.toString())),l.e.IsEmpty(this.ds.Tables[1][0].CampaignID)||(this.Campaign.SelectedValue=this.ds.Tables[1][0].CampaignID.toString()),this.EstimatedRevenue.Text="0",l.e.IsEmpty(this.ds.Tables[1][0].EstimatedRevenue)||(this.EstimatedRevenue.Text=l.e.Double(this.ds.Tables[1][0].EstimatedRevenue).ToString("N2")),l.e.IsEmpty(this.ds.Tables[1][0].CurrencyID)||(this.Currency.SelectedValue=parseInt(this.ds.Tables[1][0].CurrencyID.toString())),l.e.IsEmpty(this.ds.Tables[1][0].EstimatedCloseDate)||(this.EstimatedCloseDate.Date=new Date(this.ds.Tables[1][0].EstimatedCloseDate.toString())),l.e.IsEmpty(this.ds.Tables[1][0].ProbabilityLookUpID)||(this.Probability.SelectedValue=parseInt(this.ds.Tables[1][0].ProbabilityLookUpID.toString())),l.e.IsEmpty(this.ds.Tables[1][0].ReasonLookUpID)||(this.Reason=this.ds.Tables[1][0].ReasonLookUpID.toString()),l.e.IsEmpty(this.ds.Tables[1][0].RatingLookUpID)||(this.Rating.SelectedValue=parseInt(this.ds.Tables[1][0].RatingLookUpID.toString())),l.e.IsEmpty(this.ds.Tables[1][0].CloseDate)||(this.CloseDate.Text=new Date(this.ds.Tables[1][0].CloseDate.toString()).ToString(i.a.SessionManager.Preferences["Date Format"].toString()),this.CloseDate.Tag=new Date(this.ds.Tables[1][0].CloseDate.toString()).toString()),l.e.IsEmpty(this.ds.Tables[1][0].Mode)||("4"==this.ds.Tables[1][0].Mode.toString()?(this.Lead.Enable=!1,this.Mode.Enable=!1,l.e.IsEmpty(this.ds.Tables[1][0].LeadMode)||(this.LeadMode=parseInt(this.ds.Tables[1][0].LeadMode.toString()),l.e.IsEmpty(this.ds.Tables[1][0].CustomerID)||(this.LeadModeID=parseInt(this.ds.Tables[1][0].CustomerID.toString())))):(this.Lead.Enable=!0,this.Mode.Enable=!0),this.Mode.SelectedValue=this.ds.Tables[1][0].Mode.toString()),this.ds.Tables.length>0&&this.ds.Tables[0].length>0){let e=this.ds.Tables[0].filter(e=>"StatusReadOnly"==e.Name),t=null;if(e.length>0&&!l.e.IsEmpty(e[0].Value)&&(t=e[0].Value.toString().split(";")),null!=t&&t.length>0)for(let s=0;s<t.length;s++)if(t[s]==this.Status.SelectedValue){this.ButtonSave.Enable=!1;break}}if(l.e.IsEmpty(this.ds.Tables[1][0].Company)||(this.OnModeChange(null),"0"==this.Mode.SelectedValue||"4"==this.Mode.SelectedValue?this.Company.Text=this.ds.Tables[1][0].Company.toString():(this.Company.Code.SelectedValue=parseInt(this.ds.Tables[1][0].SelectedModeID),this.ScreenObject.OnGetReference(this.Company.Code))),"3"==this.Mode.SelectedValue){this.ContactCombo.Items.Clear();let e=new m.a;e.CustomerID=this.Company.Code.SelectedValue;let t=e.GetCustomerDetails();if(null!=t&&t.Tables[0].length>0){if(this.ContactCombo.Items.push(C.d.ComboBoxItems_2("New","0")),this.ContactCombo.SelectedValue="0",t.Tables.length>5&&t.Tables[5].length>0)for(let e=0;e<t.Tables[5].length;e++)l.e.IsEmpty(t.Tables[5][e].ContactID)||this.ContactCombo.Items.push(C.d.ComboBoxItems_2(t.Tables[5][e].FirstName.toString(),t.Tables[5][e].ContactID.toString()));if(t.Tables.length>1&&t.Tables[2].length>0){for(let e=0;e<t.Tables[2].length;e++)l.e.IsEmpty(t.Tables[2][e].ContactID)||this.ContactCombo.Items.push(C.d.ComboBoxItems_2(t.Tables[2][e].FirstName.toString(),t.Tables[2][e].ContactID.toString()));this.dvContacts=t.Tables[2],this.dvContactsTable=this.dvContacts,t.Tables.length>5&&t.Tables[5].length>0&&this.dvContactsTable.AddRange(t.Tables[5])}}}if("2"==this.Mode.SelectedValue){this.ContactCombo.Items.Clear();let e=i.a.accounting.GetAccountDetails(this.Company.Code.SelectedValue);if(null!=e&&e.Tables[0].length>0){if(this.ContactCombo.Items.push(C.d.ComboBoxItems_2("New","0")),this.ContactCombo.SelectedValue="0",e.Tables.length>8&&e.Tables[8].length>0)for(let t=0;t<e.Tables[8].length;t++)l.e.IsEmpty(e.Tables[8][t].ContactID)||this.ContactCombo.Items.push(C.d.ComboBoxItems_2(e.Tables[8][t].FirstName.toString(),e.Tables[8][t].ContactID.toString()));if(e.Tables.length>1&&e.Tables[2].length>0){for(let t=0;t<e.Tables[2].length;t++)l.e.IsEmpty(e.Tables[2][t].ContactID)||this.ContactCombo.Items.push(C.d.ComboBoxItems_2(e.Tables[2][t].FirstName.toString(),e.Tables[2][t].ContactID.toString()));this.dvContacts=e.Tables[2],this.dvContactsTable=this.dvContacts,e.Tables.length>8&&e.Tables[8].length>0&&this.dvContactsTable.AddRange(e.Tables[8])}}}if("4"==this.Mode.SelectedValue&&(this.ContactCombo.Items.Clear(),this.ds.Tables.length>15)){if(this.ContactCombo.Items.push(C.d.ComboBoxItems_2("New","0")),this.ContactCombo.SelectedValue="0",this.ds.Tables[15].length>0)for(let e=0;e<this.ds.Tables[15].length;e++)l.e.IsEmpty(this.ds.Tables[15][e].ContactID)||this.ContactCombo.Items.push(C.d.ComboBoxItems_2(this.ds.Tables[15][e].FirstName.toString(),this.ds.Tables[15][e].ContactID.toString()));if(this.ds.Tables[14].length>0)for(let e=0;e<this.ds.Tables[14].length;e++)l.e.IsEmpty(this.ds.Tables[14][e].ContactID)||this.ContactCombo.Items.push(C.d.ComboBoxItems_2(l.e.String(this.ds.Tables[14][e].FirstName),this.ds.Tables[14][e].ContactID.toString()));this.dvContacts=this.ds.Tables[14],this.dvContactsTable=this.dvContacts,this.ds.Tables[15].length>0&&this.dvContactsTable.AddRange(this.ds.Tables[15])}l.e.IsEmpty(this.ds.Tables[1][0].ContactID.toString())||(this.ContactCombo.SelectedValue=this.ds.Tables[1][0].ContactID.toString()),null!=this.ContactCombo.SelectedValue&&"0"!=this.ContactCombo.SelectedValue&&this.EnableControls(!1),null==this.ContactCombo.GetselectedItem()&&this.ContactCombo.Items.length>1&&(this.ContactCombo.SelectedValue=this.ContactCombo.Items[1].Value),null!=this.ds&&this.ds.Tables.length>12&&this.ds.Tables[13].length>0&&(l.e.IsEmpty(this.ds.Tables[13][0].FirstName.toString())||(this.FirstName.Text=this.ds.Tables[13][0].FirstName.toString()),l.e.IsEmpty(this.ds.Tables[13][0].MiddleName.toString())||(this.MiddleName.Text=this.ds.Tables[13][0].MiddleName.toString()),l.e.IsEmpty(this.ds.Tables[13][0].LastName.toString())||(this.LastName.Text=this.ds.Tables[13][0].LastName.toString()),l.e.IsEmpty(this.ds.Tables[13][0].SalutationID.toString())||(this.Salutation.SelectedValue=this.ds.Tables[13][0].SalutationID.toString()),l.e.IsEmpty(this.ds.Tables[13][0].JobTitle.toString())||(this.JobTitle.Text=this.ds.Tables[13][0].JobTitle.toString()),l.e.IsEmpty(this.ds.Tables[13][0].Company.toString())||(this.Company.Text=this.ds.Tables[13][0].Company.toString()),l.e.IsEmpty(this.ds.Tables[13][0].Phone1.toString())||(this.Phone1.Text=this.ds.Tables[13][0].Phone1.toString()),l.e.IsEmpty(this.ds.Tables[13][0].Phone2.toString())||(this.Phone2.Text=this.ds.Tables[13][0].Phone2.toString()),l.e.IsEmpty(this.ds.Tables[13][0].Email1.toString())||(this.Email.Text=this.ds.Tables[13][0].Email1.toString()),l.e.IsEmpty(this.ds.Tables[13][0].Fax.toString())||(this.Fax.Text=this.ds.Tables[13][0].Fax.toString()),l.e.IsEmpty(this.ds.Tables[13][0].Department.toString())||(this.Department.Text=this.ds.Tables[13][0].Department.toString()),this.LoadCustomFieldsData(this.ds.Tables[13],this.ds.Columns[13])),null!=this.ds&&this.ds.Tables.length>4&&this.ViewActivities.LoadActivityData(this.ds.Tables[4]),null!=this.ds&&this.ds.Tables.length>5&&this.LeadsProduct.LoadProductData(this.ds.Tables[5],this.ds.Columns[5]),null!=this.ds&&this.ds.Tables.length>8&&this.ScreenObject.LoadCustomFieldsData(this.ds.Tables[8]),null!=this.ds&&this.ds.Tables.length>9&&this.ViewNotes.LoadNotes(this.ds.Tables[9]),null!=this.ds&&this.ds.Tables.length>10&&this.ViewAttachments.LoadAttachments(this.ds.Tables[10]),null!=this.ds&&this.ds.Tables.length>11&&this.ScreenObject.LoadCustomFieldsCCData(this.ds.Tables[11]),null!=this.ds&&this.ds.Tables.length>12&&this.ViewFeedback.LoadData(this.ds.Tables[12]),null!=this.PrimaryContact&&this.PrimaryContact.LoadContacts(this.ds.Tables[14]),this.ViewContacts.LoadContacts(this.ds.Tables[15],this.ds.Columns[15]),this.ViewAssignHistroy.LoadHistroy_1(89,this.OppID),this.LoadReport()}}LoadCustomFieldsData(e,t){if(null!=e&&e.length>0)try{this.ScreenObject.CustomTab.Pages.forEach(s=>{s.Fields.forEach(s=>{s instanceof f.c&&null!=s.DBColumnName&&t.Contains(s.DBColumnName)&&(s instanceof d.d?s.Text=l.e.String(e[0][s.DBColumnName]).Replace("&amp","&").Replace("''","'"):s instanceof d.c?s.Text=l.e.String(e[0][s.DBColumnName]).Replace("&amp;","&").Replace("''","'"):s instanceof C.e?s.SelectedValue="Gender"==s.DBColumnName.toString()?"Female"==e[0][s.DBColumnName].toString()?"2":"1":l.e.String(e[0][s.DBColumnName]).Replace("&amp;","&").Replace("''","'"):s instanceof u.a?l.e.isValidDate(e[0][s.DBColumnName])&&(s.Date=new Date(e[0][s.DBColumnName])):s instanceof E.a?s.Text=e[0][s.DBColumnName].toString():s instanceof c.b&&l.e.IsNum(e[0][s.DBColumnName])&&(s.SelectedValue=parseInt(e[0][s.DBColumnName])))})})}catch(s){Logger.ErrorLog("AddEditLeads::  LoadCustomFieldsData : "+s.stack)}}EnableControls(e){this.FirstName.Visible&&(this.FirstName.Enable=e,this.FirstName.Text=""),this.LastName.Visible&&(this.LastName.Enable=e,this.LastName.Text=""),this.MiddleName.Visible&&(this.MiddleName.Enable=e,this.MiddleName.Text=""),this.Salutation.Visible&&(this.Salutation.Enable=e,this.Salutation.SelectedValue="0"),this.JobTitle.Visible&&(this.JobTitle.Enable=e,this.JobTitle.Text=""),this.Phone1.Visible&&(this.Phone1.Enable=e,this.Phone1.Text=""),this.Phone2.Visible&&(this.Phone2.Enable=e,this.Phone2.Text=""),this.Email.Visible&&(this.Email.Enable=e,this.Email.Text=""),this.Fax.Visible&&(this.Fax.Enable=e,this.Fax.Text=""),this.Department.Visible&&(this.Department.Enable=e,this.Department.Text="")}details(){Logger.InfoLog("AddEditLeads::Entering details");try{let e="";return e+="<Row ",e+=""!=this.FirstName.Text&&""!=this.FirstName.Text?' FirstName="'+se.GetValidXml(this.FirstName.Text)+'"':' FirstName=""',e+=""!=this.MiddleName.Text&&""!=this.MiddleName.Text?' MiddleName="'+se.GetValidXml(this.MiddleName.Text)+'"':' MiddleName=""',e+=""!=this.LastName.Text&&""!=this.LastName.Text?' LastName="'+se.GetValidXml(this.LastName.Text)+'"':' LastName=""',e+=""!=this.Salutation.SelectedValue?' Salutation="'+this.Salutation.SelectedValue+'"':' Salutation="0"',e+=""!=this.JobTitle.Text&&""!=this.JobTitle.Text?' JobTitle="'+se.GetValidXml(this.JobTitle.Text)+'"':' JobTitle=""',e+=""!=this.Phone1.Text&&""!=this.Phone1.Text?' Phone1="'+se.GetValidXml(this.Phone1.Text)+'"':' Phone1=""',e+=""!=this.Phone2.Text&&""!=this.Phone2.Text?' Phone2="'+se.GetValidXml(this.Phone2.Text)+'"':' Phone2=""',e+=""!=this.Email.Text&&""!=this.Email.Text?' Email="'+se.GetValidXml(this.Email.Text)+'"':' Email=""',e+=""!=this.Fax.Text&&""!=this.Fax.Text?' Fax="'+se.GetValidXml(this.Fax.Text)+'"':' Fax="'+this.Fax.Text+'"',e+=""!=this.Department.Text&&""!=this.Department.Text?' Department="'+se.GetValidXml(this.Department.Text)+'"':' Department=""',e+="/>",Logger.InfoLog("AddEditLeads::Exiting details"),e.toString()}catch(e){return""}}ClearFields(){this.Subject.Text="",this.Company.Text="",this.Status.SelectedValue="1",this.Campaign.SelectedValue="",this.Lead.SelectedValue=0,this.ContactCombo.SelectedValue="53",this.EstimatedRevenue.Text="",this.Currency.SelectedValue=1,this.Probability.SelectedValue=0,this.Rating.SelectedValue=0,this.CloseDate.Text="",this.ViewActivities.ActivityGridData.Clear(),this.ViewActivities.ActivityGridDataObj.refreshDataView(),this.ViewActivities.Activity.SelectedValue="-1",this.LeadsProduct.ClearGrid(),this.ScreenObject.Clear()}EstimateRevenceData(e,t,s){try{this.EstimatedRevenue.Text=parseFloat(e).ToString("N2")}catch(a){this.EstimatedRevenue.Text="0"}this.CloseDate.Text=t.ToString(i.a.SessionManager.Preferences["Date Format"].toString()),this.CloseDate.Tag=t.toString(),this.Reason=s}AutoGenerateCode(){0==this.OppID&&this.ScreenObject.SetAutoCode(this.Code,!1,this.ParentId,this.ScreenObject.Data.Tables[7])}OnCellEditEnding(e){let t=e.item;if("Microsoft.Windows.Controls.DataGridComboBoxColumn"!=e.OriginalSource.Column.GetType().toString()){if(t.Table.Columns.Contains("UOM")&&"ProductName"==e.OriginalSource.Column.Binding.Path.Path&&!l.e.IsEmpty(t.ProductName_Key)){let e=r.a.GetProductTypeDetails(parseInt(t.ProductName_Key.toString()),this.Date.Date,0,81,"",!1,!1,!1,!1,!1,!1,!1,!1,!1);e.Tables.length>0&&e.Columns[0].Contains("uomid")&&!l.e.IsEmpty(e.Tables[0][0].uomid)&&(t.UOM=e.Tables[0][0].UnitName.toString(),t.UOM_Key=e.Tables[0][0].uomid.toString(),e.Tables.length>3&&e.Tables[3].length>0&&e.Columns[3].Contains("PurchaseRate")&&!l.e.IsEmpty(e.Tables[3][0].PurchaseRate)?t.UnitPrice=e.Tables[3][0].PurchaseRate.toString():e.Tables.length>0&&e.Tables[0].length>0&&e.Columns[0].Contains("PurchaseRate")&&!l.e.IsEmpty(e.Tables[0][0].PurchaseRate)&&(t.UnitPrice=e.Tables[0][0].PurchaseRate.toString()),t.AcceptChanges())}this.CalculateTotals(t)}}CalculateTotals(e){let t=new ne.a,s=new le.c;s.setFieldDetails("RATE",1,1,"",1,!1,!1),t.push("RATE",s),s=new le.c,s.setFieldDetails("QTY",4,1,"",1,!1,!1),t.push("QTY",s),e.Table.Columns.Contains("UnitPrice")&&!l.e.IsEmpty(e.UnitPrice)?t.RATE.setFieldValue(e.UnitPrice):t.RATE.setFieldValue(0),e.Table.Columns.Contains("Qty")&&!l.e.IsEmpty(e.Qty)?t.QTY.setFieldValue(e.Qty):t.QTY.setFieldValue(0),e.Value=i.a.eval.EvaluateExpression("QTY*RATE",t).toString()}onBeginEdit(e){if("DataGridPactListBoxColumn"==e.column.className){let t=e.column.DgCol;if(11==t.CostCenterID){let s=e.item,i=" (BaseID IN ";i+=" (SELECT BaseID ",i+=" FROM COM_UOM AS COM_UOM_1 WITH(NOLOCK) ",i=i+" WHERE (UOMID ="+s.UOM_Key.toString()+" ))) ",""==s.UOM_Key.toString()&&(i=" (BaseID IN ",i+=" (SELECT BaseID ",i+=" FROM COM_UOM AS COM_UOM_1 WITH(NOLOCK) ",i+=" WHERE (UOMID =-1 ))) "),t.FilterCondition=i}}}loadtabs(){this.AssignRowColumns();for(let e=this.ScreenObject.CustomTab.Pages.length-1;e>=0;e--){let t=this.ScreenObject.CustomTab.Pages[e];switch(t.Name){case"Products":t.Fields.push(this.LeadsProduct);break;case"Activities":t.Fields.push(this.ViewActivities);break;case"History":t.Fields.push(this.ViewAssignHistroy.ListObj);break;case"Attachments":t.Fields.push(this.ViewAttachments);break;case"Notes":t.Fields.push(this.ViewNotes);break;case"Follow Up":t.Fields.push(this.ViewFeedback);break;case"Contacts":t.Fields.push(this.ViewContacts)}}}AssignRowColumns(){let e=this.ScreenObject.CustomFields.length;for(let t=0;t<e;t++)this.ScreenObject.CustomFields[t].Row=t/4,this.ScreenObject.CustomFields[t].Column=t%4}GetCurrency(){let e=[];e.push(0),e.push(i.a.SessionManager.UserID);let t=i.a.admin.GetCurrencies(e);null!=t&&t.Tables.length>0&&t.Columns[0].Contains("CurrencyID")&&(this.Currency.SelectedValue=l.e.IsEmpty(t.Tables[0][0].CurrencyID)?0:parseInt(t.Tables[0][0].CurrencyID.toString()))}LoadReport(){let e=this.ScreenObject.CustomTab.Pages.find(e=>"Documents"==e.Name);if(null!=e&&null!=this.ds){let t=this.ds.Tables[0].filter(e=>"LinkDimension"==e.Name&&89==e.CostCenterID);if(t.length>0&&!l.e.IsEmpty(t[0].Value)&&this.ds.Tables[2].length>0){let s=0,i=0,a=parseInt(t[0].Value)-5e4;s=l.e.Int(this.ds.Tables[1][0].CCOpportunityID),0==s&&(s=-123);let o="(DCC.dcCCNID"+a+"="+s;t=this.ds.Tables[0].filter(e=>"LinkDimension"==e.Name&&89==e.CostCenterID),t.length>0&&!l.e.IsEmpty(t[0].Value)&&(i=l.e.Int(this.ds.Tables[1][0].CCLeadID),i>0&&(o+=" OR DCC.dcCCNID"+(parseInt(t[0].Value)-5e4)+"="+i)),o+=")";let n="";if(t=this.ds.Tables[0].filter(e=>"CreateDocuments"==e.Name&&89==e.CostCenterID),t.length>0&&!l.e.IsEmpty(t[0].Value)&&(n=t[0].Value.toString().Replace(";",",")),i>0&&(t=this.ds.Tables[0].filter(e=>"CreateDocuments"==e.Name&&89==e.CostCenterID),t.length>0&&!l.e.IsEmpty(t[0].Value)&&(n.length>0&&(n+=","),n+=t[0].Value.toString().Replace(";",","))),n.length>0){let t="<XML><Row ColID='300' Value='"+n+"'/>";t+="<Row ColID='CRM_Masters_DocumentsTab' Value='"+o+"'/>",t+="</XML>",null==this.Report?(e.Fields.Clear(),e.Fields.push(this.Report)):(this.Report.LoadDocFilterXML(t),this.Report.OnReportClick(this.Report.ReportID,0))}}}}OnSave(e){if("Close"==e&&i.a.page.ShowDialog(new he(this),re.a,{ShowCenter:!0}),"EstimateRevenue"==e&&""!=this.EstimatedRevenue.Text&&(this.EstimatedRevenue.Enable=!0),"Save"==e||"SaveDraft"==e){Logger.InfoLog("SaveOpportunityViewModel:: OnSave");try{this.Opp.OpportunityID=this.OppID;let t=this.ScreenObject.ValidateData();if(!l.e.IsEmpty(t))return this.DisplayMessage=t,void(this.MessageVisibility=!0);if(0==this.Opp.OpportunityID){let e={StrCode:this.Opp.Code,CodePrefix:this.Opp.CodePrefix,CodeNumber:this.Opp.CodeNumber};if(this.DisplayMessage=this.ScreenObject.SetAutoCodeParams_3(this.Code,this.ParentId,this.ScreenObject.Data.Tables[7],e),this.Opp.Code=e.StrCode,this.Opp.CodePrefix=e.CodePrefix,this.Opp.CodeNumber=e.CodeNumber,this.DisplayMessage.length>0)return}else this.Opp.Code=this.Code.Text;if(this.Opp.Subject=this.Subject.Text,l.e.IsEmpty(this.Mode.SelectedValue)&&(this.Mode.SelectedValue="0"),this.Opp.Mode=parseInt(l.e.String(this.Mode.SelectedValue)),this.Company.Visible?"0"==this.Mode.SelectedValue||"4"==this.Mode.SelectedValue?this.Opp.Company=null!=this.Company.Text?this.Company.Text:"":(this.Opp.Company=null!=this.Company.Code.Text?this.Company.Code.Text:"",this.Opp.SelectedModeID=this.Company.Code.SelectedValue):this.Company.Enable&&this.Company.Visible||(this.Opp.Company=this.Code.Text),this.Opp.GUID=this.OppID>0?this.ds.Tables[1][0].GUID.toString():"GUID",this.Opp.Status=""!=this.Status.SelectedValue?parseInt(this.Status.SelectedValue):0,this.Opp.Date=this.Date.Date,this.Opp.Leadid=0!=this.Lead.SelectedValue?this.Lead.SelectedValue:0,this.Opp.Contactid=""!=this.ContactCombo.SelectedValue?parseInt(this.ContactCombo.SelectedValue):0,this.Opp.Campaignid=""!=this.Campaign.SelectedValue?parseInt(this.Campaign.SelectedValue):0,this.Opp.EstimateRevenue=this.EstimatedRevenue.Text,this.Opp.Currency=0!=this.Currency.SelectedValue?this.Currency.SelectedValue:0,this.Opp.EstimateCloseDate=this.EstimatedCloseDate.Date?this.EstimatedCloseDate.Date:null,this.Opp.Probabilityid=0!=this.Probability.SelectedValue?this.Probability.SelectedValue:0,this.Opp.Ratingid=0!=this.Rating.SelectedValue?this.Rating.SelectedValue:0,""!=this.CloseDate.Text&&null!=this.CloseDate.Tag?this.Opp.CloseDate=new Date(this.CloseDate.Tag):""!=this.CloseDate.Text&&(this.Opp.CloseDate=new Date(this.CloseDate.Text)),this.Opp.Details=this.details(),this.Opp.OppProXML=this.LeadsProduct.GetProductXML(),this.Opp.ActivityXml=this.ViewActivities.ActivitiesXML(),this.Opp.Reason=this.Reason,this.Opp.CustomFieldsQuery=this.ScreenObject.GetCustomFieldsQuery(),this.Opp.CustomCostCenterFieldsQuery=this.ScreenObject.GetCustomCostCenterFieldsQuery(),this.Opp.NotesXML=this.ViewNotes.GetXML(),this.Opp.AttachmetsXML=this.ViewAttachments.GetXML(),this.Opp.FeedbackXML=this.ViewFeedback.GetXML(),this.Opp.TabXML=this.getFields(),this.Opp.ContactXML=this.ViewContacts.GetXML(),null!=this.PrimaryContact&&this.PrimaryContact.CheckPrimaryDuplicateContact())return this.DisplayMessage="Duplicate Contact[s] in Contacts DB",void(this.MessageVisibility=!0);if(this.Opp.PrimaryContactXML=this.PrimaryContact.GetXML(),!this.ScreenObject.ValidateDataonSave())return;let s=this.Opp.SaveOpportunity();this.DisplayMessage=s.Message,this.Ret=s.RetValue,this.Ret>0&&(this.OppID=this.Ret,"SaveDraft"==e?(this.ds=this.Opp.GetOpportunity(this.OppID),this.OppID>0&&null!=this.ds&&this.ds.Tables[1].length>0&&(l.e.IsEmpty(this.ds.Tables[1][0].GUID)||(this.Opp.GUID=this.ds.Tables[1][0].GUID.toString()))):(this.LeadsProduct.ClearGrid(),this.Opp.OpportunityID>0?(this.ButtonSave.Enable=!1,this.Code.Text=""):this.OppID=0,this.ClearFields(),this.AutoGenerateCode(),this.LeadsProduct.ProductGridObj.Clear(),this.ViewFeedback.FeedBackDataObj.Clear(),this.ViewNotes.NotesListObj.Clear(),this.ViewContacts.ContactsListObj.Clear(),this.ViewAttachments.AttachmentsListObj.Clear(),this.ViewAssignHistroy.ListObj.Clear(),this.ViewFeedback.FeedBackDataObj.Clear())),Logger.InfoLog("SaveOpportunityViewModel:: OnSave")}catch(t){Logger.ErrorLog("SaveOpportunityViewModel:: OnSave"+t.stack)}}else"Email"==e&&this.OppID>0&&i.a.page.ShowDialog(new Y.SendEmailSMSViewModel(!0,this.CostCenterID,this.OppID,this),q.SendEmailSMSComponent)}getFields(){Logger.InfoLog("AddEditLeads::Entering getFields");try{let e,t="";return t+="<Row ",this.ScreenObject.CustomTab.Pages.forEach(s=>{s.Fields.forEach(s=>{s instanceof f.c&&null!=s.DBColumnName&&(s instanceof d.d?(e=s.Text,l.e.IsEmpty(e)&&(e=""),t+=s.DBColumnName+'="'+se.GetValidXml(e)+'" '):s instanceof C.e?(e=s.SelectedValue,l.e.IsEmpty(e)&&(e=""),"Gender"==s.DBColumnName?null!=s.SelectedItem&&(t+=s.DBColumnName+'="'+se.GetValidXml(s.SelectedItem.Name)+'" '):"Country"==s.DBColumnName?null!=s.SelectedValue&&""!=s.SelectedValue&&(t+=s.DBColumnName+'="'+s.SelectedValue+'" '):t+=s.DBColumnName+'="'+se.GetValidXml(e)+'" '):s instanceof u.a?(e=l.e.IsEmpty(s.Date)?"":s.Date.ToString("dd/MMM/yyyy"),l.e.IsEmpty(e)&&(e=""),t+=s.DBColumnName+'="'+e+'" '):s instanceof E.a?(e=s.Text,l.e.IsEmpty(e)&&(e=""),t+=s.DBColumnName+'="'+e+'" '):s instanceof c.b&&(this.oPactCombo=s,t+=this.oPactCombo.DBColumnName+'="'+this.oPactCombo.SelectedValue+'" '))})}),t+=" />",Logger.InfoLog("AddEditLeads::Exiting getFields"),t.toString()}catch(e){throw e}}}var ce=s("/7g1"),Ce=s("ZwlZ"),ue=s("LCKI"),me=s("W4+j"),be=s("MMwJ"),Se=s("Qq+n"),pe=s("5DrK"),De=s("il++"),ge=s("Hzm0");class Te extends h.b{constructor(e,t,s,a,o){super(),this.lstatusid="",this.AllowCreationofCase=!1,this.ActMandatory=!1,this.ScreenObject=new r.a,this.Casesmodel=new pe.a,this.CaseID=0,this.parentid=1,this.selectedNode=1,this.group=!1,this.GroupVisible=!1,this.QuickVisible=!0,this.DetailButtonVisibility=!0,this.RetValue=0,this.CName=new d.a(0),this.CaseDate=new u.a(0),this.Status=new C.e(0),this.Customer=new c.b(0),this.Group=new c.b(0),this.dsinfo=null,this.CostCenterID=0,this.NodeID=0,this.ActVisibility=!1,this.CaseID=t;let l=this.Casesmodel.GetCaseScreenDetails(this.CaseID);this.parent=e,this.parentid=s,this.selectedNode=o,this.CostCenterID=73,this.group=a,this.ScreenObject.LoadQuickScreen(this,73,this.group),a?(this.GroupVisible=!0,this.QuickVisible=!1,this.CName.Label=i.a.GetResource("CRMCases_CaseNumber"),this.CaseDate.Label=i.a.GetResource("CRMCases_CaseDate"),this.Status.Label=i.a.GetResource("CRMCases_Status"),this.Group.Label=i.a.GetResource("CRMCases_Group"),this.Customer.Label=i.a.GetResource("CRMCases_Customer")):(this.QuickVisible=!0,this.GroupVisible=!1,this.CaseDate=this.ScreenObject.GetQuickField(24233),null==this.CaseDate&&(this.CaseDate=new u.a(24233),this.CaseDate.Visible=!1,this.CaseDate.Date=Date.Today()),this.CName=this.ScreenObject.GetQuickCode(24234),this.Status=this.ScreenObject.GetQuickCombo(24235),null==this.Status&&(this.Status=new C.e(24235),this.Status.Visible=!1),this.Customer=this.ScreenObject.GetQuickField(24238),null==this.Customer&&(this.Customer=new c.b(24238),this.Customer.Visible=!1),this.Group=this.ScreenObject.GetQuickField(24398),null==this.Group&&(this.Group=new c.b(24398)),this.FillComboBoxItems(l)),null!=this.Group?(this.Group.Visible=!0,this.Group.CCID=73,this.Group.TypeID=2):(this.Group=new c.b(0),this.Group.SelectedValue=s),null!=this.Customer&&(this.Customer.CCID=83,this.Customer.TypeID=1),this.dsinfo=this.ScreenObject.Data,this.ScreenObject.Data=this.dsinfo,this.ScreenObject.CostCenterID=73,a?this.ActVisibility=!1:(Te.SetActivityUI(this,this.ScreenObject.dtActivityQuick),null!=this.Activities&&this.Activities.AssignRowColumns()),0==this.group?this.Title=i.a.GetResource(0==this.CaseID?"CRMCase_AddCase":"CRMCase_EditCase"):(this.Title=i.a.GetResource("CRMLead_AddGroup"),this.DetailButtonVisibility=!1,this.Casesmodel.GUID="GUID"),this.Casesmodel.CaseID=this.CaseID,null!=this.ScreenObject.Data&&this.ScreenObject.Data.Tables.length>7&&this.ScreenObject.Data.Columns[7].Contains("IsParentCodeInherited")&&this.ScreenObject.Data.Tables[7].length>0&&this.ScreenObject.InitAutoCode(this.ScreenObject.Data.Tables[7],this.group);let h=this.ScreenObject.Data.Tables[4].filter(e=>"AllowCreationofCase"==e.Name);h.length>0&&""!=h[0].Value.toString()&&(this.AllowCreationofCase=Object(n.j)(h[0].Value)),this.AllowCreationofCase&&(h=this.ScreenObject.Data.Tables[4].filter(e=>"StatusDuplicateCreationofCases"==e.Name),h.length>0&&""!=h[0].Value.toString()&&(this.lstatusid=h[0].Value.toString())),h=this.ScreenObject.Data.Tables[4].filter(e=>"Activitymandatorywhilecreatingcase"==e.Name),h.length>0&&""!=h[0].Value.toString()&&(this.ActMandatory=Object(n.j)(h[0].Value)),null!=this.Status&&this.dsinfo.Tables[5].forEach(e=>{this.Status.Items.push(C.d.ComboBoxItems_2(e.Name.toString(),e.NodeID.toString())),Object(n.j)(e.IsDefault)&&(this.Status.SelectedValue=e.NodeID.toString(),this.Status.DefaultValue=e.NodeID.toString())}),null!=this.Group&&this.Group.SelectionChangedCommand.Subscribe(this,"OnGroupSelectionChanged"),0==this.CaseID?(this.Group.SelectedValue=s,this.AutoGenerateCode(),this.Casesmodel.GUID="GUID",i.a.SessionManager.Preferences.ContainsKey("Date Format")&&(this.CaseDate.Text=(new Date).ToString(i.a.SessionManager.Preferences["Date Format"].toString()))):(l.Tables.length>4&&l.Tables[4].length>0&&((this.ScreenObject.InheritParentCode||this.ScreenObject.IsAutoCode)&&(this.CName.Enable=!1),this.Casesmodel.GUID=l.Tables[4][0].GUID.toString(),this.CaseDate.Date=new Date(l.Tables[4][0].CDAte.toString()),this.CName.Text=l.Tables[4][0].CaseNumber.toString(),this.Status.SelectedValue=l.Tables[4][0].StatusID.toString(),this.Group.SelectedValue=parseInt(l.Tables[4][0].ParentID),this.Customer.SelectedValue=parseInt(l.Tables[4][0].CustomerID)),this.ActVisibility&&!this.group&&l.Tables.length>7&&(this.ViewActivities.LoadActivityData(l.Tables[7]),this.ViewActivities.ActivityGridData.length>0?(this.ViewActivities.SelectedRow=this.ViewActivities.ActivityGridData[this.ViewActivities.ActivityGridData.length-1],this.ViewActivities.OnCmnItem_Click("EDIT","EDIT")):this.ActVisibility=!1)),this.MessageVisibility=!1}FillComboBoxItems(e){this.cType=this.ScreenObject.GetQuickCombo(24397),null!=this.cType&&C.e.FillComboWithDefaultOption(e.Tables[7],this.ScreenObject.GetQuickCombo(24397)),this.origin=this.ScreenObject.GetQuickCombo(24237),null!=origin&&C.e.FillComboWithDefaultOption(e.Tables[6],this.ScreenObject.GetQuickCombo(24237)),this.priority=this.ScreenObject.GetQuickCombo(24236),null!=this.priority&&C.e.FillComboWithDefaultOption(e.Tables[5],this.ScreenObject.GetQuickCombo(24236)),this.cmode=this.ScreenObject.GetQuickCombo(53516),null!=this.cmode&&(this.cmode.Items.Clear(),this.cmode.Items.push(C.d.ComboBoxItems_2("Manual","Manual")),this.cmode.Items.push(C.d.ComboBoxItems_2("PM","PM")),this.cmode.SelectedValue="Manual")}OnGroupSelectionChanged(e){this.Group.SelectedValue>0&&(this.parentid=this.Group.SelectedValue,this.AutoGenerateCode())}AutoGenerateCode(){this.ScreenObject.SetAutoCode(this.CName,this.group,this.parentid,this.dsinfo.Tables[7])}OnSave(e){if("Cancel"==e)i.a.page.HideDialog();else if("Save"==e)try{let e=0;if(!this.group&&(0==this.Customer.SelectedValue||null==this.Customer.SelectedValue))return this.DisplayMessage="Select "+this.Customer.Label,void(this.MessageVisibility=!0);if(0==this.Casesmodel.CaseID){if(0==this.Casesmodel.CaseID&&this.AllowCreationofCase){let e=0,t=0,s="";2==this.Customer.CCID?t=1:83==this.Customer.CCID&&(t=2);let a=i.a.common.GetDataSet3("CRM002",this.lstatusid.toString().Replace(";",","),t.toString(),this.Customer.SelectedValue.toString());if(null!=a&&a.Tables.length>0&&a.Tables[0].length>0&&""!=a.Tables[0][0][0].toString()&&(e=parseInt(a.Tables[0][0][1].toString()),s=a.Tables[0][0][0].toString(),e>0&&!confirm("Case already opened with Customer and Case Number is "+s+", Are you sure you want to continue?")))return}if(0==this.Casesmodel.CaseID&&this.ActMandatory)return void alert("Activity is mandatory");let e={StrCode:this.Casesmodel.CaseNumber,CodePrefix:this.Casesmodel.CodePrefix,CodeNumber:this.Casesmodel.CodeNumber};if(this.DisplayMessage=this.ScreenObject.SetAutoCodeParams_3(this.CName,this.parentid,this.ScreenObject.Data.Tables[7],e),this.Casesmodel.CaseNumber=e.StrCode,this.Casesmodel.CodePrefix=e.CodePrefix,this.Casesmodel.CodeNumber=e.CodeNumber,this.DisplayMessage.length>0)return}else this.Casesmodel.CaseNumber=this.CName.Text;if(this.group){if(null==this.CaseDate.Date)return this.MessageVisibility=!0,void(this.DisplayMessage="Please Enter Case Date");this.Casesmodel.CaseDate=this.CaseDate.Date,this.Casesmodel.StatusID=parseInt(this.Status.SelectedValue),this.Casesmodel.IsGroup=this.group,this.Casesmodel.Customer=this.Customer.SelectedValue,2==this.Customer.CCID?this.Casesmodel.CustomerMode=1:83==this.Customer.CCID&&(this.Casesmodel.CustomerMode=2),this.Casesmodel.SelectedNodeID=this.Group.SelectedValue}else{if(null==this.CaseDate.Date)return this.MessageVisibility=!0,void(this.DisplayMessage="Please Enter Case Date");this.Casesmodel.CaseDate=this.ScreenObject.GetDatePickerValue(24233,Date.Today()),""==this.Status.DefaultValue&&(this.Status.DefaultValue="0"),""==this.Customer.DefaultValue&&(this.Customer.DefaultValue="0"),""==this.Group.DefaultValue&&(this.Group.DefaultValue=this.selectedNode.toString()),this.Casesmodel.StatusID=this.ScreenObject.GetTextComboValue_int(24235,parseInt(this.Status.DefaultValue)),this.Casesmodel.IsGroup=this.group,this.Casesmodel.Customer=this.ScreenObject.GetPactListValue(24238,parseInt(this.Customer.DefaultValue)),2==this.Customer.CCID?this.Casesmodel.CustomerMode=1:83==this.Customer.CCID&&(this.Casesmodel.CustomerMode=2),this.Casesmodel.SelectedNodeID=null==this.ScreenObject.GetQuickField(24398)?this.selectedNode:this.ScreenObject.GetPactListValue(24398,parseInt(this.Group.DefaultValue))}if(this.ActVisibility){if(this.Activities.onSaveActivity("Save"),!l.e.IsEmpty(this.Activities.DisplayMessage))return void(this.DisplayMessage=this.Activities.DisplayMessage);this.Casesmodel.ActivityXml=this.ViewActivities.ActivitiesXML()}else this.Casesmodel.ActivityXml="";if(this.Casesmodel.Subject=this.ScreenObject.GetTextComboValue_string(27293,""),null!=this.cType&&(this.Casesmodel.CaseTypeID=this.ScreenObject.GetTextComboValue_int(24397,0)),null!=origin&&(this.Casesmodel.CaseOriginID=this.ScreenObject.GetTextComboValue_int(24237,0)),null!=this.priority&&(this.Casesmodel.CasePriorityID=this.ScreenObject.GetTextComboValue_int(24236,0)),null!=this.cmode&&(this.Casesmodel.Mode=this.ScreenObject.GetTextComboValue_string(53516,"")),!this.ScreenObject.ValidateDataonSave())return;if(0==this.Casesmodel.CaseID){let t=this.Casesmodel.SaveCase(0,0);e=t.RetValue,this.DisplayMessage=t.Message}else{let t=this.Casesmodel.QuickUpdateCase();e=t.RetValue,this.DisplayMessage=t.RetValue}this.RetValue=e,e>0&&(this.CName.Text="",this.Casesmodel.CaseID=0,i.a.SessionManager.Preferences.ContainsKey("Date Format")&&(this.CaseDate.Text=(new Date).ToString(i.a.SessionManager.Preferences["Date Format"].toString())),this.Status.SelectedValue="1",null!=this.parent&&(null!=this.parent.SelectedNode&&(this.parent.tree[0].SetFocusNodeID=this.parent.SelectedNode.Id),this.parent.Refresh()),this.AutoGenerateCode(),this.Group.SelectedValue=this.selectedNode)}catch(t){Logger.ErrorLog("SaveCaseViewModel:: OnSave",t)}else if("Details"==e.toString()){null!=this.Group&&(this.parentid=this.Group.SelectedValue);let e=new ge.AddEditCasesViewModel(this.CaseID,this.parentid,this.group);e.isClose||i.a.page.addNewTab({component:De.AddEditCaseComponent,params:{obj:e}}),i.a.page.HideDialog()}}static SetActivityUI(e,t){if(t.length>0){e.ActVisibility=!0,e.Activities=new T.a(e,!1),e.Activities.IsPopup=!1,e.Activities.LoadCustomFields(73),e.Activities.AssignVisiblity=!1,e.Activities.HeaderVisible=!1,e.Activities.ButtonsVisible=!1,e.ViewActivities=new g.b(e),e.ViewActivities.Activities=e.Activities;let s=t.filter(e=>"ActivityTypeName"==e.SysColumnName);e.Activities.ActivityType.Visible=s.length>0,s=t.filter(e=>"StatusID"==e.SysColumnName),e.Activities.StatusVisible=s.length>0,s=t.filter(e=>"Subject"==e.SysColumnName),e.Activities.Subject.Visible=s.length>0,s=t.filter(e=>"CRMCustomer"==e.SysColumnName),e.Activities.CRMCustomer.Visible=s.length>0,s=t.filter(e=>"CRMContactPerson"==e.SysColumnName),e.Activities.CRMContactPerson.Visible=s.length>0,s=t.filter(e=>"AssignUserID"==e.SysColumnName),e.Activities.AssignUserList.Visible=s.length>0,s=t.filter(e=>"Remarks"==e.SysColumnName),e.Activities.Remarks.Visible=s.length>0,e.Activities.Fields.forEach(e=>{s=t.filter(t=>t.SysColumnName==e.SysColumnName),e.Visible=s.length>0})}else e.ActVisibility=!1}}var Ie=s("k8LF");class Ve{static AddPage(e,t,s,o,l,n){let h=e.obj;if(83==h.CostCenterID)if(i.a.page.ShowLoading=!0,h.IsQuickNodeDefined&&!t){let t=new p(o,h.SelectedNode.id,l,s?h.SelectedNode.IsGroup:n,e);i.a.page.ShowDialog(t,a.a)}else{let e=new b.a(o,h.SelectedNode.id,l,!1);i.a.page.addNewTab({component:S.AddCustomerComponent,params:{obj:e}})}else if(86==h.CostCenterID)if(i.a.page.ShowLoading=!0,h.IsQuickNodeDefined&&!t){let t=new ae(e,o,l,s?h.SelectedNode.IsGroup:n,h.SelectedNode.id);i.a.page.ShowDialog(t,oe.a)}else{let e=new se(o,h.SelectedNode.id,!1);i.a.page.addNewTab({component:ie.AddEditLeadComponent,params:{obj:e}})}else if(88==h.CostCenterID){i.a.page.ShowLoading=!0;let e=new be.a(o,h.SelectedNode.id);i.a.page.addNewTab({component:Se.AddEditCampaignComponent,params:{obj:e}})}else if(89==h.CostCenterID){i.a.page.ShowLoading=!0;{let e=new de(o,h.SelectedNode.id,!1);i.a.page.addNewTab({component:ce.AddEditOpportunityComponent,params:{obj:e}})}}else if(73==h.CostCenterID)if(i.a.page.ShowLoading=!0,h.IsQuickNodeDefined&&!t){let t=new Te(e,o,l,s?h.SelectedNode.IsGroup:n,h.SelectedNode.id);i.a.page.ShowDialog(t,Ie.a)}else{let e=new ge.AddEditCasesViewModel(o,h.SelectedNode.id,!1);i.a.page.addNewTab({component:De.AddEditCaseComponent,params:{obj:e}})}else if(65==h.CostCenterID){i.a.page.ShowLoading=!0;{let e=new X.AddDContactViewModel(o,!1,h.SelectedNode.id);i.a.page.addNewTab({component:Ce.a,params:{obj:e}})}}}static Convert(e){if(e.SelectedNode.IsGroup)alert("Group cannot be converted ");else if(null!=e.SelectedNode)if(83==e.CostCenterID){let t=new b.a(83,e.SelectedNode.id,1,!1);t.CustomerID=e.SelectedNode.id;let s=new ue.a;s.ConvertCustomer_1(t),i.a.page.ShowDialog(s,me.a,{ShowCenter:!0})}else if(86==e.CostCenterID){let t=(new I.a).GetLead(e.SelectedNode.id),s=null;if(s=t.Tables[2].filter(e=>"ConvertApprovedLeads"==e.Name),s.length>0)if(l.e.IsEmpty(s[0].Value)||"0"==s[0].Value.toString()){let s=new W(e.SelectedNode.id,t,e.CostCenterID);i.a.page.ShowDialog(s,J.a,{ShowCenter:!0})}else if(Object(n.j)(s[0].Value)){if(null!=t&&t.Tables.length>1&&t.Tables[0].length>0&&t.Columns[0].Contains("IsApproved")&&(l.e.IsEmpty(t.Tables[0][0].IsApproved)||!Object(n.j)(t.Tables[0][0].IsApproved)))return void alert("Lead should be in approved status! ");let s=new W(e.SelectedNode.id,t,e.CostCenterID);i.a.page.ShowDialog(s,J.a,{ShowCenter:!0})}else{let s=new W(e.SelectedNode.id,t,e.CostCenterID);i.a.page.ShowDialog(s,J.a,{ShowCenter:!0})}}else if(89==e.CostCenterID){let t=new W(e.SelectedNode.id,null,e.CostCenterID);i.a.page.ShowDialog(t,J.a,{ShowCenter:!0})}}static Close(e,t){if(t.SelectedNode.IsGroup)alert("Group cannot be converted ");else if(null!=t.SelectedNode&&86==t.CostCenterID){let s=i.a.common.GetDataSet("CRM001",t.SelectedNode.id.toString());if(null!=s&&s.Tables.length>0&&s.Tables[0].length>0&&"419"==s.Tables[0][0].StatusID.toString()){let s=new P.a(t.SelectedNode.id,e,86);i.a.page.ShowDialog(s,H.CloseLeadComponent,{ShowCenter:!0,NoWidth:!0})}else t.DisplayMessage="Select Assigned lead"}}static Assign(e,t){if(null!=t.SelectedNode){if(1==t.SelectedNode.id)return;let e=new Array;null!=t.SelectedNodes&&t.SelectedNodes.forEach(t=>{e.push(C.c.CheckedListBoxItem_6(t.Text[0],t.Id.toString(),!0,t.TypeID))});let s=new Z.AssignFeatureViewModel;e.length>0?s.AssignFeatureViewModel_2(this,e,t.CostCenterID):s.AssignFeatureViewModel_1(this,t.SelectedNode.id,t.CostCenterID),i.a.page.ShowDialog(s,$.AssignFeatureComponent)}}static ShowQuickAdd_CRMIsQuick(e,t){if(83==e){let e=new p(t,0,1,!1,null);return e.Height=400,i.a.page.ShowDialog(e,a.a),e.CustomerID}return 0}static ShowQuickAdd_CRM(e,t){if(83==e){let e=null;e=0==t?new b.a(0,0,1,!1):new b.a(83,t,1,!1),i.a.page.ShowDialog(e,S.AddCustomerComponent,{ShowCenter:!0})}}static GetCRMActivityScreen(e){let t=null;return 86==e.FeatureID?t=new se(e.DBColumnID,0,!1):89==e.FeatureID?t=new de(e.DBColumnID,0,!1):73==e.FeatureID?t=new ge.AddEditCasesViewModel(e.DBColumnID,0,!1):88==e.FeatureID?t=new be.a(e.DBColumnID,0):83==e.FeatureID&&(t=new b.a(e.DBColumnID,e.DBColumnID,0,!1)),t}}},ouML:function(e,t,s){"use strict";s.r(t),s.d(t,"DocumentDraftsViewModel",(function(){return c}));var i=s("mrSG"),a=s("Do2H"),o=s("Lp6j"),l=s("ScVY"),n=s("8B8H"),h=s("ockk"),r=s("rJVx"),d=s("CUWK");class c extends l.b{constructor(e,t,s=0){if(super(),this.Grid=new n.a,this.IsFromDocs=!1,this.PopupWidth=0,this.ReportType=0,this.Parent=null,this.CCID=0,this.WID=0,this.LevelID=0,this.PactGridVisible=!1,this.CCID=s,this.Parent=e,this.ReportType=t,this.Parent instanceof r.GeneralDashboardViewModel||"DashAddOnsViewModel"==this.Parent.ClassName)1==t&&(this.ColSource=r.GeneralDashboardViewModel.InitColumns("Document Drafts_DashBoardCustomize"));else{let e;1==t?this.DisplayName="Drafts":2==t?this.DisplayName="Hold Documents":3==t?this.DisplayName="Approval History":4==t&&(this.DisplayName="Level Info",this.PactGrid=new n.a),this.Title=this.DisplayName,this.IsFromDocs=!0,this.FillGrid(),this.Grid.OnLinkClick.Subscribe(this,"GridLinkClick"),this.ColSource=[],1==t?(this.ColSource=r.GeneralDashboardViewModel.InitColumns("Document Drafts_DashBoardCustomize"),this.PopupWidth=22,this.ColSource.forEach(e=>{this.PopupWidth=this.PopupWidth+e.Width})):2==t?(e=new h.a,e.DataType="TextBlock",e.Header="Hold Date",e.DisplayMember="HoldDate_Key",e.Width=100,this.ColSource.push(e),e=new h.a,e.DataType="LINK",e.Header=a.a.GetResource("DocName"),e.DisplayMember="DocName",e.Width=135,this.ColSource.push(e),e=new h.a,e.DataType="TextBlock",e.Header="NetValue",e.DisplayMember="NetValue",e.Width=100,this.ColSource.push(e),e=new h.a,e.DataType="TextBlock",e.Header="NoOfProducts",e.DisplayMember="NoOfProducts",e.Width=50,this.ColSource.push(e),e=new h.a,e.DataType="LINK",e.Header=a.a.GetResource("Delete"),e.DisplayMember="Delete",e.Width=100,this.ColSource.push(e),this.PopupWidth=450):3==t?(e=new h.a,e.DataType="TextBlock",e.Header="User",e.DisplayMember="CreatedBy",e.Width=90,this.ColSource.push(e),e=new h.a,e.DataType="TextBlock",e.Header="FirstName",e.DisplayMember="FirstName",e.Width=90,this.ColSource.push(e),e=new h.a,e.DataType="TextBlock",e.Header="LastName",e.DisplayMember="LastName",e.Width=90,this.ColSource.push(e),e=new h.a,e.DataType="TextBlock",e.Header="Email",e.DisplayMember="Email1",e.Width=150,this.ColSource.push(e),e=new h.a,e.DataType="TextBlock",e.Header=a.a.GetResource("Date"),e.DisplayMember="AppDate",e.Width=128,this.ColSource.push(e),e=new h.a,e.DataType="LINK",e.Header="Level",e.DisplayMember="LevelName",e.Width=93,this.ColSource.push(e),e=new h.a,e.DataType="TextBlock",e.Header="Status",e.DisplayMember="Status",e.Width=80,this.ColSource.push(e),e=new h.a,e.DataType="Format",e.Header="Remarks",e.DisplayMember="Remarks",e.Width=190,this.ColSource.push(e),this.PopupWidth=950,"AddEditDocumentViewModel"==this.Parent.ClassName&&(e=new h.a,e.Header="WorkFlowName",e.DisplayMember="WorkFlowName",e.Width=200,this.ColSource.push(e)),this.PopupWidth=950):4==t&&(e=new h.a,e.DataType="TextBlock",e.ReadOnly=!0,e.Header="User Name",e.DisplayMember="UserName",e.Width=120,this.ColSource.push(e),e=new h.a,e.DataType="TextBlock",e.ReadOnly=!0,e.Header="First Name",e.DisplayMember="FirstName",e.Width=120,this.ColSource.push(e),e=new h.a,e.DataType="TextBlock",e.ReadOnly=!0,e.Header="Last Name",e.DisplayMember="LastName",e.Width=120,this.ColSource.push(e),this.PactGrid.Columns=this.ColSource,this.PopupWidth=400)}}get Table(){return this.Grid.Table}set Table(e){this.Grid.Table=e}get TableColumns(){return this.Grid.TableColumns}set TableColumns(e){this.Grid.TableColumns=e}get ColSource(){return this.Grid.Columns}set ColSource(e){this.Grid.Columns=e}get SelectedRow(){return this.Grid.SelectedItem}set SelectedRow(e){this.Grid.SelectedItem=e}onClick(e){event.preventDefault(),null!=this.SelectedRow&&this.LoadDraft(this.SelectedRow)}FillGrid(){let e=0,t=null;if(o.e.IsType(this.Parent,"AddEditDocumentViewModel")?(t=this.Parent,e=0==this.CCID?t.CostCenterID:this.CCID):o.e.IsEmpty(this.Parent.ClassName)||"AddEditRenContractViewModel"!=this.Parent.ClassName||(e=this.CCID),1==this.ReportType||2==this.ReportType){let s;s=o.e.IsEmpty(this.Parent.ClassName)||"AddEditRenContractViewModel"!=this.Parent.ClassName?null==t||38!=t.ScreenObject.DocumentType&&39!=t.ScreenObject.DocumentType?a.a.document.GetDocumentDrafts(0,e,this.ReportType,!1):a.a.document.GetDocumentDrafts(t.ScreenObject.RegisterNodeID,e,this.ReportType,!1,!0):a.a.document.GetDocumentDrafts(0,this.Parent.CostCenterID,this.ReportType,!1),s.subscribe(e=>{this.Table=e.Tables[0],this.Grid.TableColumns.Contains("Date_Text")||(this.Grid.TableColumns.push("Date_Text"),this.Grid.TableColumns.push("Delete")),this.Grid.TableColumns.Contains("HoldDate_Key")||this.Grid.TableColumns.push("HoldDate_Key"),this.Table.forEach(e=>{e.Delete="Delete",e.id=a.a.slick.rowid,e.Date_Text=new Date(e.Date).ToString(a.a.SessionManager.Preferences["Date Format"]+" hh:mm a"),null!=e.HoldDate&&(e.HoldDate_Key=new Date(e.HoldDate).ToString(a.a.SessionManager.Preferences["Date Format"]))})})}else if(3==this.ReportType){let t=null;if(o.e.IsType(this.Parent,"AddEditDocumentViewModel")?(t=this.Parent.ScreenObject.GetDocStatusHistory(),t.Tables.length>1&&t.Tables[1].length>0&&t.Columns[1].Contains("WID")&&(this.WID=parseInt(t.Tables[1][0].WID))):o.e.IsEmpty(this.Parent.ClassName)||"AddEditRenContractViewModel"!=this.Parent.ClassName?o.e.IsEmpty(this.Parent.ClassName)||"AddEditCasesViewModel"!=this.Parent.ClassName||(t=this.GetDocStatusHistory(73,this.Parent.CaseID,!1)):t=a.a.rental.GetHistory(e,this.Parent.ContractID),null!=t&&t.Tables.length>0){this.Table=t.Tables[0],this.Grid.TableColumns.push("AppDate");for(let t=0;t<this.Table.length;t++)""!=this.Table[t].Date.toString()&&(this.Table[t].AppDate=new Date(this.Table[t].Date.toString()).ToString(a.a.SessionManager.Preferences["Date Format"]+" hh:mm a"));let e=0,s=0;this.Table.length>0&&(e=o.e.IntTryParse(this.Table[this.Table.length-1].WorkFlowLevel.toString()),s=o.e.IntTryParse(this.Table[this.Table.length-1].StatusID.toString())),369!=s&&(t.Tables[1]=t.Tables[1].filter(t=>t.levelID>e),t.Tables[1].forEach(e=>{let t=this.Grid.NewRow();t.LevelName=e.LevelName,t.Status="Pending",t.WorkFlowLevel=e.LevelID,this.Grid.addRow(t)}));for(let t=this.Table.length;t<7;t++)this.Grid.addEmptyRow()}}else if(4==this.ReportType){let e=null;if("WFLevelDoc"==this.Parent.ClassName?e=a.a.SessionManager.Preferences.ContainsKey("CanApproveFunction")&&"True"==a.a.SessionManager.Preferences.CanApproveFunction?a.a.report.GetExtWFDet(this.Parent.WID,this.Parent.LevelID,this.Parent.ccid,this.Parent.DOcId):a.a.report.GetWorkFlowLevelDetails(this.Parent.WID,this.Parent.LevelID,this.Parent.ccDate):this.Parent instanceof c&&(a.a.SessionManager.Preferences.ContainsKey("CanApproveFunction")&&"True"==a.a.SessionManager.Preferences.CanApproveFunction?"AddEditDocumentViewModel"==this.Parent.Parent.ClassName?e=a.a.report.GetExtWFDet(this.Parent.WID,this.Parent.LevelID,this.Parent.Parent.CostCenterID,this.Parent.Parent.ScreenObject.DocID):"ReportViewModel"==this.Parent.Parent.ClassName&&"INV_ComparisonReport"==this.Parent.Parent.StaticReportObject&&(e=a.a.report.GetExtWFDet(this.Parent.WID,this.Parent.LevelID,this.Parent.Parent.StaticReportObject.QuotationDocument,this.Parent.Parent.StatusDocID)):e=a.a.report.GetWorkFlowLevelDetails(this.Parent.WID,this.Parent.LevelID,"AddEditDocumentViewModel"==this.Parent.Parent.ClassName?this.Parent.Parent.ScreenObject.DocDate.Date:Date.Today())),null!=e){for(let t=e.Tables[0].length;t<8;t++)e.Tables[0].push();this.PactGrid.Table=e.Tables[0]}this.PactGrid.Width="",this.PactGrid.SearchVisible=!0,this.PactGrid.SearchCols.Width="85",this.PactGrid.SearchOptions.Width="90",this.PactGrid.SearchText.Width="110",this.PactGridVisible=!0}}GetDocStatusHistory(e,t,s){Logger.InfoLog("DocumentDraftsViewModel:: Inside GetDocStatusHistory");let i=[];i.push(e),i.push(t),i.push(s),i.push(a.a.SessionManager.UserID),i.push(a.a.SessionManager.LanguageID);let o=a.a.document.GetDocStatusHistory(i);return Logger.InfoLog("DocumentDraftsViewModel:: Exiting GetDocStatusHistory"),o}OnButtonClick(e){"Cancel"==e.toString()&&(o.e.IsType(this.Parent,"AddEditDocumentViewModel")&&this.CCID>0&&(this.Parent.res="No"),a.a.page.HideDialog())}DeleteDraft(e){let t;t=o.e.IsEmpty(this.Parent.ClassName)||"AddEditRenContractViewModel"!=this.Parent.ClassName?a.a.document.DeleteDocumentDraft(parseInt(e.DraftID)):a.a.rental.DeleteQuotation(parseInt(e.CostCenterID),parseInt(e.DraftID)),t.RetValue>0&&this.Grid.removeRow(e)}LoadDraft(e){return Object(i.b)(this,void 0,void 0,(function*(){if(o.e.IsEmpty(this.Parent.ClassName)||"AddEditRenContractViewModel"!=this.Parent.ClassName){const{AddEditDocumentViewModel:t}=yield Promise.all([s.e(2),s.e(1),s.e(3),s.e(5),s.e(4),s.e(6),s.e(7),s.e(10),s.e(9),s.e(12),s.e(11),s.e(13),s.e(19),s.e(15),s.e(21),s.e(20),s.e(16),s.e(14),s.e(18),s.e(17),s.e(22),s.e(89)]).then(s.bind(null,"1Cra")),{AddEditDocumentComponent:i}=yield Promise.all([s.e(4),s.e(6)]).then(s.bind(null,"MCKn"));let o,l;l=a.a.document.GetDocumentDrafts(parseInt(e.DraftID),0,1,!1),l.subscribe(s=>{if(o=s.Tables[0],null!=o&&o.length>0)if("AddEditDocumentViewModel"==this.Parent.ClassName||"POSDocumentViewModel"==this.Parent.ClassName)this.CCID>0||(this.Parent.clear(1),this.Parent.LoadDraftXML(o[0]),a.a.page.HideDialog(),this.Parent.ScreenObject.GridDataObj.RefreshGridView());else{let s=1==this.ReportType,l=new t(parseInt(e.CostCenterID),e.Type.toString(),s);a.a.page.addNewTab({component:i,params:{obj:l}}),l.LoadDraftXML(o[0],s)}})}else d.RibbonExtViewModel.LoadDraftRentalContract(this.Parent,parseInt(e.DraftID)),a.a.page.HideDialog()}))}GridLinkClick(e,t,s){event.preventDefault(),"Delete"==t?this.DeleteDraft(e):"Date_Text"!=t&&"DocName"!=t||this.LoadDraft(e)}}},rJVx:function(e,t,s){"use strict";s.r(t),s.d(t,"GeneralDashboardViewModel",(function(){return d}));var i=s("mrSG"),a=s("Do2H"),o=s("Lp6j"),l=s("ScVY"),n=s("NkMH"),h=s("ockk"),r=s("JIg3");class d extends l.b{constructor(){super(),this.ButtonPDC=new n.a,this.timerdashboard=new o.d,this.Date=new r.a(0),this.tdMaximize=new Array(4).fill(!1),Logger.InfoLog("DashboardViewModel::Entering DashboardViewModel"),this.timerdashboard.Enabled=!0,this.timerdashboard.Interval=6e4,a.a.SessionManager.IsWebApplication||this.timerdashboard.Elapsed(this,"timerdashboard_Elapsed"),this.DisplayName=a.a.GetResource("Dashboard_Maindashboard"),this.loadDrafts(),Logger.InfoLog("DashboardViewModel::Exiting DashboardViewModel")}loadDrafts(){return Object(i.b)(this,void 0,void 0,(function*(){const{DocumentDraftsViewModel:e}=yield s.e(150).then(s.bind(null,"ouML"));this.DocumentDrafts=new e(this,1),setTimeout(()=>{this.DocumentDrafts.FillGrid()},500);const{UnAppDocumentsViewModel:t}=yield s.e(0).then(s.bind(null,"AyOk"));this.UnApprovedDocuments=new t;const{DashBoardNotifViewModel:i}=yield Promise.all([s.e(2),s.e(1),s.e(5),s.e(26),s.e(42),s.e(0),s.e(73)]).then(s.bind(null,"Wh9R"));this.NotifEvents=new i(2),this.PDCDocuments=new i(4)}))}timerdashboard_Elapsed(e,t){a.a.page.isActiveTab(this)&&(this.OnButtonClick("RefreshPDC"),this.OnButtonClick("RefreshEvents"),this.NotifEvents.RefreshData(),this.UnApprovedDocuments.OnLoad())}OnButtonClick(e){"PostPDC"==e||("RefreshPDC"==e?(this.PDCDocuments.EventsType=4,this.PDCDocuments.InitColumns()):"PostEvents"==e||("RefreshEvents"==e?this.NotifEvents.RefreshData():"UnApproved"==e?this.UnApprovedDocuments.OnLoad():"Drafts"==e&&this.DocumentDrafts.FillGrid()))}OnMessageCallBack(){this.res="Yes"}static InitColumns(e){let t,s="",i=[];if(a.a.SessionManager.Preferences.ContainsKey(e)&&(s=a.a.SessionManager.Preferences[e]),s.length>0){let l=new o.f;l.LoadXml(s);for(let s=0;s<l.DocumentElement.children.length;s++){let o=l.DocumentElement.children[s];t=new h.a,t.Header=a.a.GetResource(o.attributes.Header.value),t.DisplayMember=o.attributes.ID.value,t.ReadOnly=!0,t.Width=parseInt(o.attributes.Width.value),i.push(t),"Un Approved Documents_DashBoardCustomize"==e?"VoucherNo"==t.DisplayMember?t.DataType="LINK":"Amount"==t.DisplayMember&&(t.DataType="FLOAT",t.DecimalPoints=a.a.SessionManager.Preferences.DecimalsinAmount.toString()):"Document Drafts_DashBoardCustomize"==e?"Date_Text"!=t.DisplayMember&&"Delete"!=t.DisplayMember||(t.DataType="LINK"):"Post Dated Documents_DashBoardCustomize"==e?"VoucherNo"==t.DisplayMember?t.DataType="LINK":"Amount"==t.DisplayMember&&(t.DataType="FLOAT",t.DecimalPoints=a.a.SessionManager.Preferences.DecimalsinAmount.toString()):"Notification Events_DashBoardCustomize"==e&&"VoucherNo"==t.DisplayMember&&(t.DataType="LINK")}}return i}static IsActionAssigned(e,t){return a.a.SessionManager.IsActionAssigned(e,t)}}}}]);
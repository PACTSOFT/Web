function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var r,i=_getPrototypeOf(e);if(t){var s=_getPrototypeOf(this).constructor;r=Reflect.construct(i,arguments,s)}else r=i.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}(window.webpackJsonp=window.webpackJsonp||[]).push([[52],{bSOb:function(e,t,r){"use strict";r.r(t),r.d(t,"AddPriceChartNewViewModel",(function(){return T})),r.d(t,"AddGroupViewModel",(function(){return g}));var i=r("8B8H"),s=r("ockk"),n=r("0/4Q"),a=r("Do2H"),o=r("Lp6j"),l=r("eQJW"),u=r("EQd/"),c=r("JIg3"),h=r("ZDA+"),d=r("8iaB"),C=r("7JXL"),f=r("XFVb"),D=r("6z9j"),p=r("n56n"),I=r("/G+I"),S=r("vTM8"),y=r("4HhE"),m=r("J5xz"),T=function(e){_inherits(r,e);var t=_createSuper(r);function r(e){var i,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return _classCallCheck(this,r),(i=t.call(this)).Module="INV",i.ClassName="AddPriceChartNewViewModel",i.Visible=!0,i.contextVisible=!0,i.ProfileID=0,i.SelectedNodeID=0,i.Mode="",i.DeletedIDs=new Array,i.iRateStartIndex=0,i.oChart=new f.a,i.DisplayName="",i.ScreenName="",i.ColumnSpan="",i.IsFromReport=!1,i.TreeViewModel=null,i.PriceChartAtProduct=!1,i.RightPanelVisibility=!0,i.MessageVisibility=!1,i.Title="",i.DisplayMessage="",i.FilterVisibility=!1,i.IsEdit=!1,i._IsEditFilter=!1,i._GenerateVisibility=!0,i.CopyVisible=!1,i._ChartType_All=!0,i._ChartType_Sale=!1,i._ChartType_Purchase=!1,i._ChartType_Reorder=!1,i.Name=new u.d(0),i.Price=new u.d(0),i.WEF=new c.a(0),i.TillDate=new c.c(0),i.Remarks=new u.d(0),i.UOM=new n.b(0),i.StatusID=1,i.CreatedBy=0,i.HasAccess=!1,i._SelectAll=!1,i.RateColumnCount=0,i.j=0,i.ProductNameIndex=1,i.stkValue="",i.ProductUOM="",i.stkCC=null,i.stkID=null,i.stkName=null,i.stkCode=null,i.dbQuery="",i.dblPrices=null,i.lstTemp=new Array,i.lstTempCC=new Array,i.sbQuery="",i.dicBaseUnits=new S.a,i.ProfileID=s,i.Mode=e,i.SelectedNodeID=a,i.TillDate.Date=null,"ADD"==e||"DOCUMENT"==e||"REPORT"==e?i.ScreenName="Add Price Chart":"EDIT"==e?(i.ScreenName="Edit Price Chart",i.IsEdit=!0,i.IsEditFilter=!0,i.CopyVisible=!0):"SEARCH"==e?(i.ScreenName="Search Price Chart",i.GenerateVisibility=!1,i.CopyVisible=!1):"PRODUCT_SEARCH"==e&&(i.GenerateVisibility=!1,i.CopyVisible=!1,e="SEARCH",i.Title="",i.PriceChartAtProduct=!0,i.Name.Visible=!1),i.Title=i.ScreenName,i.MessageVisibility=!1,i.DisplayMessage="",i.tree=[],i.CostCenters=new n.e(0),i.CostCenterFilters=[],i.CostCenters.SelectionChangedCommand.Subscribe(_assertThisInitialized(i),"OnCostCenterChange"),i.NodeSelectedCallBack=new y.b,i.NodeSelectedCallBack.Subscribe(_assertThisInitialized(i),"OnNodeSelectedCallBack"),i.Title=i.ScreenName,i.DisplayName=i.ScreenName,i.InitControls(),i.FilterVisibility=!0,null!=i.UOM&&(i.UOM.Label="UOM"),i}return _createClass(r,[{key:"selectNodes",value:function(e){var t=this;this.tree[0].Rows.forEach((function(r){t.tree[0].SelectNode_1(r,e)})),this.tree[0].RefreshSelectionText(),this.tree[0].OnNodeSelected()}},{key:"InitControls",value:function(){var e=this;this.Rates=new Array,this.PriceGrid=new i.a,this.PriceGrid.OnLinkClick.Subscribe(this,"OnGridLinkClick"),this.PriceGrid.OnPreviewKeyDown.Subscribe(this,"OnPreviewKeyDown"),this.Name.Label=a.a.GetResource("Com_Contacts_Name"),this.WEF.Label=a.a.GetResource("Service_WEF"),this.TillDate.Label=a.a.GetResource("TillDate"),this.TillDate.Visible=!1,this.Price.Label=a.a.GetResource("Price"),this.CostCenters.Label=a.a.GetResource("CostCenter_CostCenterslist"),this.Remarks.Label=a.a.GetResource("Remarks"),this.Remarks.Visible=!1;var t=a.a.inventory.GetPriceChart(0,this.ProfileID,"");if("EDIT"==this.Mode){var r=new C.a(3,"","Product",this);switch(r.SelectedNodes=[],r.HideFilter.Enable=!1,r.HideFilter.IsChecked=!0,this.CostCenterFilters.push(r),this.Name.Text=t.Tables[1][0].ProfileName.toString(),this.StatusID=parseInt(t.Tables[1][0].StatusID),t.Tables.length>5&&t.Tables[5].length>0&&(this.CreatedBy=parseInt(t.Tables[5][0].UserID),this.HasAccess=Object(l.j)(t.Tables[5][0].HasAccess)),parseInt(t.Tables[1][0].PriceType)){case 0:this.ChartType_All=!0;break;case 1:this.ChartType_Sale=!0;break;case 2:this.ChartType_Purchase=!0;break;case 3:this.ChartType_Reorder=!0}for(var s=function(r){var i=n.d.ComboBoxItems_2(t.Tables[0][r].NAME.toString(),t.Tables[0][r].ID.toString());if(e.CostCenters.Items.push(i),t.Tables[4].filter((function(e){return e.CostCenterID==+i.Value})).length>0&&(i.Aliasname="BOLD","3"!=i.Value)){var s=new C.a(parseInt(i.Value),"",i.Name,e);s.SelectedNodes=[],e.CostCenterFilters.push(s)}},u=0;u<t.Tables[0].length;u++)s(u)}else if("SEARCH"==this.Mode){for(var c=function(r){e.CostCenters.Items.push(n.d.ComboBoxItems_2(t.Tables[0][r].NAME.toString(),t.Tables[0][r].ID.toString())),t.Tables[4].filter((function(e){return e.CostCenterID==t.Tables[0][r].ID.toString()})).length>0&&(e.CostCenters.Items[e.CostCenters.Items.length-1].Aliasname="BOLD")},d=0;d<t.Tables[0].length;d++)c(d);if("True"==o.e.String(a.a.SessionManager.Preferences.EnableLocationWise)&&"True"==a.a.SessionManager.Preferences["LW PChart"]&&"1"!=a.a.SessionManager.RoleID){var f=this.CostCenters.Items.find((function(e){return"50002"==e.Value}));if(null!=f){var D=new C.a(50002,"",f.Name,this);if(D.SelectedNodes=[],0!=a.a.SessionManager.LocationID){var p=new h.a;p.Id=a.a.SessionManager.LocationID,p.IsSelected=!0,p.Text.push(a.a.SessionManager.LocationName),D.SelectedNodes.push(p),D.SelectedNodesTag=a.a.SessionManager.LocationName}else o.e.StringIsNullOrEmpty(a.a.SessionManager.LocationWhere)||(a.a.SessionManager.LocationWhere.split(",").forEach((function(e){var t=new h.a;t.Id=parseInt(e),t.IsSelected=!0,t.Text.push(e),D.SelectedNodes.push(t)})),D.SelectedNodesTag="[FILTER]");D.DeleteButtonVisibility=!1,this.CostCenterFilters.push(D)}}if("True"==a.a.SessionManager.Preferences.EnableDivisionWise.toString()&&"True"==a.a.SessionManager.Preferences["DW PChart"]&&"1"!=a.a.SessionManager.RoleID){var I=this.CostCenters.Items.find((function(e){return"50001"==e.Value}));if(null!=I){var S=new C.a(50001,"",I.Name,this);if(S.SelectedNodes=[],0!=a.a.SessionManager.LocationID){var y=new h.a;y.Id=a.a.SessionManager.DivisionID,y.IsSelected=!0,y.Text.push(a.a.SessionManager.DivisionName),S.SelectedNodes.push(y),S.SelectedNodesTag=a.a.SessionManager.DivisionName}else o.e.StringIsNullOrEmpty(a.a.SessionManager.DivisionWhere)||(a.a.SessionManager.DivisionWhere.split(",").forEach((function(e){var t=new h.a;t.Id=parseInt(e),t.IsSelected=!0,t.Text.push(e),S.SelectedNodes.push(t)})),S.SelectedNodesTag="[FILTER]");S.DeleteButtonVisibility=!1,this.CostCenterFilters.push(S)}}}else for(var m=0;m<t.Tables[0].length;m++)this.CostCenters.Items.push(n.d.ComboBoxItems_2(t.Tables[0][m].NAME.toString(),t.Tables[0][m].ID.toString()));"DOCUMENT"!=this.Mode&&"REPORT"!=this.Mode&&(this.CostCenters.SelectedValue="3",this.OnCostCenterChange(null)),this.RefeshGrid(t.Tables[2],t.Tables[3])}},{key:"OnPreviewKeyDown",value:function(e,t){var r="";if(e.grid.getCellEditor()&&e.grid.getCellEditor().args.column.name&&(r=e.grid.getCellEditor().args.column.name),"F6"==t.Key){if(!confirm(" Are you sure you want to Close Reservation ? "))return!0;for(var i=this.PriceGrid.Table,s=0;s<i.length;s++)i[s][r]=e[r].toString(),this.oTableColumns.Contains(r+"_Key")&&(i[s][r+"_Key"]=e[r+"_Key"].toString()),this.PriceGrid.updateRow(i[s]);return!0}return!1}},{key:"RefeshGrid",value:function(e,t){var r=this,i=e[0][Object.keys(e[0])[0]].toString(),o=120,l=180,c=e.filter((function(e){return"Price Chart Rates"==e.Name}));if(c.length>0&&(i=c[0][Object.keys(c[0])[0]].toString()),(c=e.filter((function(e){return"Price Chart Widths"==e.Name}))).length>0){var h=c[0].Value.toString().split(";");h.length>0&&h[0].Contains("ProductCode")&&(o=parseInt(h[0].replace("ProductCode=",""))),h.length>1&&h[1].Contains("ProductName")&&(l=parseInt(h[1].replace("ProductName=","")))}this.Rates.Clear(),this.oTableColumns=[],this.oTableColumns.push("sno"),this.oTableColumns.push("select"),this.oTableColumns.push("Combination"),this.oTableColumns.push("wef"),this.oTableColumns.push("wef_Key"),this.oTableColumns.push("tillDate"),this.oTableColumns.push("tillDate_Key"),this.oTableColumns.push("Account"),this.oTableColumns.push("Product"),this.oTableColumns.push("ProductCode"),this.oTableColumns.push("Product_Key"),this.oTableColumns.push("UOM"),this.oTableColumns.push("UOM_Key"),this.oTableColumns.push("Query"),this.oTableColumns.push("Action"),this.oTableColumns.push("PriceCCID"),this.oTableColumns.push("ProfileName"),this.oTableColumns.push("PriceType"),this.oTableColumns.push("Remarks"),this.iRateStartIndex=19;var d=[],C=new s.a;C.Header=a.a.GetResource("Service_Sno"),C.DisplayMember="sno",C.ReadOnly=!0,C.IsFrozen=!0,C.Width=40,d.push(C),this.CopyVisible&&((C=new s.a).Header="",C.DisplayMember="select",C.DataType="CheckBox",C.IsFrozen=!0,C.Width=30,d.push(C)),this.PriceChartAtProduct||((C=new s.a).Header=a.a.GetResource("Service_Action"),C.DisplayMember="Action",C.DataType="LINK",C.ReadOnly=!0,C.IsFrozen=!0,C.Width=60,d.push(C)),(C=new s.a).Header=a.a.GetResource("Inv_Substitute_ProductCode"),C.DisplayMember="ProductCode",C.ReadOnly=!0,C.IsFrozen=!0,o>0?C.Width=o:C.IsVisible=!1,d.push(C),"SEARCH"==this.Mode&&((C=new s.a).Header="ProfileName",C.DisplayMember="ProfileName",C.ReadOnly=!0,C.Width=120,C.IsFrozen=!0,d.push(C)),(C=new s.a).Header="Product",C.DisplayMember="Product",C.ReadOnly=!0,l>0?C.Width=l:C.IsVisible=!1,C.IsFrozen=!0,d.push(C),(C=new s.a).Header=a.a.GetResource("UOM"),C.DisplayMember="UOM",C.ReadOnly=!0,C.Width=90,d.push(C);var f,D=t,p=i.split(",");this.RateColumnCount=0;for(var I=function(e){if((D=t.filter((function(t){return t.SysColumnName==p[e]}))).length>0){f=D[0].SysColumnName.toString(),r.oTableColumns.push(f),(C=new s.a).Header=a.a.GetResource(D[0].ResourceData.toString()),C.DisplayMember=f,C.IsCalculated=1,C.DataType="FLOAT",C.DecimalPoints=D[0].DecimalPoints.toString(),C.Width=100,d.push(C);var i=new u.d(0);i.Label=C.Header,i.DBColumnName=f,r.Rates.push(i),r.RateColumnCount++}},S=0;S<p.length;S++)I(S);(C=new s.a).Header=a.a.GetResource("Service_WEF"),C.DisplayMember="wef",C.DataType="DATE",C.Width=115,d.push(C);for(var y=0;y<p.length;y++)"TillDate"==p[y]&&(this.TillDate.Visible=!0,(C=new s.a).Header=a.a.GetResource("TillDate"),C.DisplayMember="tillDate",C.DataType="DATE",C.Width=115,d.push(C));p.Contains("Remarks")&&(this.Remarks.Visible=!0,(C=new s.a).Header=a.a.GetResource("Remarks"),C.DisplayMember="Remarks",C.Width=150,d.push(C)),(C=new s.a).Header=a.a.GetResource("Service_Combination"),C.DisplayMember="Combination",C.ReadOnly=!0,C.DefaultValue="Select",C.Width=260,d.push(C);var m=new Array;m.push(n.d.ComboBoxItems_2("All","0")),m.push(n.d.ComboBoxItems_2("Sale","1")),m.push(n.d.ComboBoxItems_2("Purchase","2")),m.push(n.d.ComboBoxItems_2("Reorder Level","3")),(C=new s.a).Header="Type",C.DisplayMember="PriceType",C.Width=100,C.ComboData=m,C.ValueBinding="PriceType",C.DataType="ComboBox",C.DisplayMember="Name",C.ValueMember="Value",d.push(C),this.PriceGrid.SelectAll.Visible=!0,this.PriceGrid.SearchVisible=!0,this.PriceGrid.SortVisible=!0,this.PriceGrid.SearchColStartIndex=3,this.PriceGrid.Columns=d,this.PriceGrid.Table=[]}},{key:"LoadDefaultProfile",value:function(e,t){var r=this;this.IsFromReport=!0;var i,s=this.oChart.GetPriceChart(6,e,"");if(!(null==s||s.Tables.length<2||0==s.Tables[0].length)){var n=o.e.String(s.Tables[0][0][Object.keys(s.Tables[0][0])[0]]).split(","),l="",u="",c=this.oChart.GetProductLocationNames(e,t);if(c.Tables[0].length>0){var d=new C.a(3,"","Product",this);d.SelectedNodes=[],d.HideFilter.Enable=!1,d.HideFilter.IsChecked=!0,this.CostCenterFilters.push(d);var f=new h.a;f.Id=parseInt(c.Tables[0][0].ProductID),f.Text.push(c.Tables[0][0].ProductName.toString()),d.SelectedNodes.push(f),u=c.Tables[0][0].ProductName.toString(),l=c.Tables[0][0].ProductCode.toString(),d.RefreshSelectedNodesText(),this.FillUOM(!1,d.SelectedNodes)}var D=null;for(i=0;i<n.length;i++){var p=this.CostCenters.Items.find((function(e){return e.Value==n[i]}));if(null!=p){var I=new C.a(parseInt(n[i]),"",p.Name,this);I.SelectedNodes=[],this.CostCenterFilters.push(I),50002==I.CostCenterID&&(D=I)}}null!=D&&(c.Tables[1].forEach((function(e){var t=new h.a;t.Id=parseInt(e.NodeID),t.Text.push(e.Name.toString()),D.SelectedNodes.push(t)})),D.RefreshSelectedNodesText());for(var S=function(e){50002!=r.CostCenterFilters[e].CostCenterID&&2!=r.CostCenterFilters[e].CostCenterID&&(r.oChart.GetTagData(o.e.GetTagTableName(r.CostCenterFilters[e].CostCenterID)).forEach((function(t){var i=new h.a;i.Id=parseInt(t.NodeID),i.Text.push(t.Name.toString()),r.CostCenterFilters[e].SelectedNodes.push(i)})),r.CostCenterFilters[e].RefreshSelectedNodesText())},y=1;y<this.CostCenterFilters.length;y++)S(y);if(c.Tables[0].length>0){var m;this.PriceGrid.Clear();for(var T,g=1,b=0,P=function(e){var t=s.Tables[1][e];if(null==D||null==D.SelectedNodes.find((function(e){return e.Id==parseInt(t.CCNID2)}))){(m=r.PriceGrid.NewRow()).sno=g;for(var n=function(e){b=parseFloat(t[r.oTableColumns[e]]),m[r.oTableColumns[e]]=b.ToString("N"+r.PriceGrid.Columns.filter((function(t){return t.DisplayMember==r.oTableColumns[e]}))[0].DecimalPoints)},o=r.iRateStartIndex;o<r.oTableColumns.length;o++)n(o);if(m.Product=u,m.ProductCode=l,m.Product_Key=t.ProductID.toString(),m.PriceCCID=t.PriceCCID,m.wef=new Date(t.WEF_DATE).ToString(a.a.SessionManager.Preferences["Date Format"]),m.wef_Key=t.WEF_DATE,m.PriceType=t.PriceType,m.Action="Delete",r.sbQuery="",r.sbQuery+=' ProductID="'+t.ProductID+'"',parseInt(t.UOMID)>0&&(r.sbQuery+=' UOMID="'+t.UOMID+'"',m.UOM=t.UOMName.toString(),m.UOM_Key=t.UOMID.toString()),parseInt(t.AccountID)>0){r.sbQuery+=' AccountID="'+t.AccountID+'"',m.Account=t.AccountName.toString();var c=r.CostCenterFilters.find((function(e){return 2==e.CostCenterID}));if(null!=c&&null!=c.SelectedNodes.find((function(e){return e.Id==parseInt(t.AccountID)}))){var d=new h.a;d.Id=parseInt(t.AccountID),d.Text.push(t.AccountName.toString()),c.SelectedNodes.push(d)}}if(parseInt(t.CurrencyID)>0){r.sbQuery+=' CurrencyID="'+t.CurrencyID+'"',m.CurrencyID=t.Currency.toString();var C=r.CostCenterFilters.find((function(e){return 12==e.CostCenterID}));if(null!=C&&null!=C.SelectedNodes.find((function(e){return e.Id==parseInt(t.CurrencyID)}))){var f=new h.a;f.Id=parseInt(t.CurrencyID),f.Text.push(t.Currency.toString()),C.SelectedNodes.push(f)}}for(T="",i=1;i<=50;i++)if(parseInt(t["CCNID"+i])>0){r.sbQuery+=" CC"+i+'="'+t["CCNID"+i]+'"',T.length>0&&(T+="::");var p=r.CostCenterFilters.find((function(e){return e.CostCenterID==5e4+i}));if(null!=p){var I=p.SelectedNodes.find((function(e){return e.Id==parseInt(t["CCNID"+i])}));null!=I&&(T+=I.Text[0])}}m.Query=r.sbQuery.toString(),m.Combination=T,r.PriceGrid.addRow(m),g++}},N=0;N<s.Tables[1].length;N++)P(N)}this.PriceGrid.Table.length>0&&(this.FilterVisibility=!1)}}},{key:"LoadFromDocument",value:function(e){var t=this;this.FilterVisibility=!1;var r,i,s,n,u,d="",f="",D=0,I=!1,S=e.ScreenObject.GridData,y=[],m=null,T=new o.f;T.LoadXml(e.ScreenObject.Preferences.PriceChartMapping);var g=T.DocumentElement.SelectSingleNode("WEF");if(null==g||o.e.IsEmpty(g.axttributes.Name.value)||(d=g.axttributes.Name.value.toString(),S.GridDataColumns.Contains(d)||(S.GridDataColumns.push(d),S.GridDataColumns.push(d+"_Key"))),null==(g=T.DocumentElement.SelectSingleNode("TillDate"))||o.e.IsEmpty(g.axttributes.Name.value)||(f=g.axttributes.Name.value.toString(),S.GridDataColumns.Contains(f)||(S.GridDataColumns.push(f),S.GridDataColumns.push(f+"_Key"))),null!=T.DocumentElement.SelectSingleNode("PCSelectedLocation")&&(I=!0),null==(g=T.DocumentElement.SelectSingleNode("PriceType")))this.ChartType_All=!0;else switch(parseInt(g.axttributes.Name.value)){case 0:this.ChartType_All=!0;break;case 1:this.ChartType_Sale=!0;break;case 2:this.ChartType_Purchase=!0;break;case 3:this.ChartType_Reorder=!0}for(e.ScreenObject.HeaderFields.forEach((function(t){if(t instanceof c.c){var r=t;S.GridDataColumns.Contains(r.DBColumnName)&&S.forEach((function(t){parseInt(t.DocDetailsID)>0&&(t[r.DBColumnName]=r.Text,t[r.DBColumnName+"_Key"]=r.Date,e.ScreenObject.GridDataObj.updateRow(t))}))}else if(t instanceof c.d){var i=t;S.GridDataColumns.Contains(i.DBColumnName)&&S.forEach((function(t){parseInt(t.DocDetailsID)>0&&(t[i.DBColumnName]=i.Text,t[i.DBColumnName+"_Key"]=i.Date,e.ScreenObject.GridDataObj.updateRow(t))}))}})),e.ScreenObject._TextFields.forEach((function(t){if(t instanceof c.c){var r=t;S.GridDataColumns.Contains(r.DBColumnName)&&S.forEach((function(t){parseInt(t.DocDetailsID)>0&&(t[r.DBColumnName]=r.Text,t[r.DBColumnName+"_Key"]=r.Date,e.ScreenObject.GridDataObj.updateRow(t))}))}})),this.Name.Text=e.ScreenObject.VoucherNo,D=0;D<S.length&&0!=o.e.String(S[D].DocDetailsID).length&&0!=parseInt(S[D].DocDetailsID);D++);if(null!=(g=T.DocumentElement.SelectSingleNode("Dimensions"))&&g.InnerText.length>0&&(y=g.InnerText.split(",")),a.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==o.e.String(a.a.SessionManager.Preferences.EnableLocationWise)&&!y.Contains("50002")){var b="";null!=g&&g.InnerText.length>0&&(b=g.InnerText),b.Contains("50002")||(b.length>0&&(b+=","),b+="50002"),y=b.split(",")}m=T.DocumentElement.SelectNodes("Rates/R");var P="",N=new C.a(3,"","Product",this);for(N.SelectedNodes=[],N.HideFilter.Enable=!1,N.HideFilter.IsChecked=!0,this.CostCenterFilters.push(N),r=0;r<D;r++){P=S.GridDataColumns.Contains("ProductName")?S[r].ProductName.toString():S.GridDataColumns.Contains("ProductCode")?S[r].ProductCode.toString():"";var v=new h.a;v.Id=parseInt(S[r].ProductID_Key),v.Text.push(P),N.SelectedNodes.push(v)}N.RefreshSelectedNodesText(),this.FillUOM(!1,N.SelectedNodes);var _=null,M=e.ScreenObject.DocumentType;1==M||2==M||10==M||26==M||27==M||3==M||4==M||25==M||13==M?_=e.ScreenObject.CreditAccount:11!=M&&6!=M&&7!=M&&8!=M&&9!=M&&12!=M&&24!=M||(_=e.ScreenObject.DebitAccount);for(var R=null,w=null,k=function(n){var u=t.CostCenters.Items.find((function(e){return e.Value==y[n]}));if(null!=u&&((w=new C.a(parseInt(y[n]),"",u.Name,t)).SelectedNodes=[],t.CostCenterFilters.push(w)),2!=w.CostCenterID)if(s="dcCCNID"+(w.CostCenterID-5e4),i=s+"_Key",!I&&a.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==o.e.String(a.a.SessionManager.Preferences.EnableLocationWise)&&50002==w.CostCenterID){R=w;var c=a.a.admin.getLocationRoles(["50002",a.a.SessionManager.LangID]).Tables[0];c=c.sort((function(e,t){return e.Name-t.Name}));for(var d=a.a.SessionManager.LocationWhere.split(","),f=0;f<c.length;f++)if(d.Contains(c[f][0].toString())&&!Object(l.j)(c[f].IsGroup)){var m=new h.a;m.Id=parseInt(c[f][0]),m.Text.push(c[f][2].toString()),w.SelectedNodes.push(m)}w.RefreshSelectedNodesText()}else if(S.GridDataColumns.Contains(i)){var T=function(){var e;if((e=o.e.Int(S[r][i]))>0&&null==w.SelectedNodes.find((function(t){return t.Id==e}))){var t=new h.a;t.Id=e,t.Text.push(S[r][s].toString()),w.SelectedNodes.push(t)}};for(r=0;r<D;r++)T()}else{var g=e.ScreenObject._CCFields.find((function(e){return e instanceof p.b&&e.CCID==w.CostCenterID}));if(null!=g){var b=new h.a;b.Id=g.SelectedValue,b.Text.push(null==g.Text?"[]":g.Text),w.SelectedNodes.push(b)}}else if(null!=_){var P=new h.a;P.Id=_.SelectedValue,P.Text.push(null==_.Text?"[]":_.Text),w.SelectedNodes.push(P)}else S.GridDataColumns.Contains("AccountID_Key");w.RefreshSelectedNodesText()},G=0;G<y.length;G++)k(G);var O,E,F,A=new Array,x=new Array;null!=m&&m.forEach((function(e){t.oTableColumns.Contains(e.axttributes.Name.value)&&S.GridDataColumns.Contains(e.axttributes.ID.value)&&(A.push(e.axttributes.Name.value),x.push(e.axttributes.ID.value))})),this.PriceGrid.Clear();var V=1,L=!1;for(r=0;r<D;r++){var U=0;do{E=this.PriceGrid.NewRow(),F=S[r],L=!1;for(var j=function(e){(O=o.e.Double(F[x[e]]))>0&&(E[A[e]]=O.ToString("N"+t.PriceGrid.Columns.filter((function(t){return t.DisplayMember==A[e]}))[0].DecimalPoints),L=!0)},W=0;W<A.length;W++)j(W);if(L){E.sno=V,V++,S.GridDataColumns.Contains("ProductCode")&&(E.ProductCode=F.ProductCode.toString()),S.GridDataColumns.Contains("ProductName")&&(E.Product=F.ProductName.toString()),E.Product_Key=F.ProductID_Key.toString(),""!=d?(E.wef=F[d].toString(),E.wef_Key=F[d+"_Key"].toString()):(E.wef=e.DocumentDate.Date.ToString(a.a.SessionManager.Preferences["Date Format"]),E.wef_Key=e.DocumentDate.Date),""!=f&&(E.tillDate=F[f].toString(),E.tillDate_Key=F[f+"_Key"].toString()),E.Action="Delete";var K=0;this.ChartType_Sale?K=1:this.ChartType_Purchase?K=2:this.ChartType_Reorder&&(K=3),E.PriceType=K,this.sbQuery="",this.sbQuery+=' ProductID="'+F.ProductID_Key.toString()+'"',F.Unit_Key.toString().length>0&&parseInt(F.Unit_Key)>0&&(this.sbQuery+=' UOMID="'+F.Unit_Key+'"',E.UOM=F.Unit.toString(),E.UOM_Key=F.Unit_Key.toString()),u="";for(var Q=function(r){if(n="1",2!=t.CostCenterFilters[r].CostCenterID){if(null!=R&&50002==t.CostCenterFilters[r].CostCenterID&&R.SelectedNodes.length>0)n=R.SelectedNodes[U].Id.toString(),P=R.SelectedNodes[U].Text[0];else if(P="",s="dcCCNID"+(t.CostCenterFilters[r].CostCenterID-5e4),i=s+"_Key",S.Columns.Contains(i))n=F[i].toString(),P=F[s].toString();else{var a=e.ScreenObject._CCFields.find((function(e){return e instanceof p.b&&e.CCID==t.CostCenterFilters[r].CostCenterID}));null!=a&&(P=a.Text,n=a.SelectedValue.toString())}t.sbQuery+=" CC"+(t.CostCenterFilters[r].CostCenterID-5e4)+'="'+n+'"',u.length>0&&(u+="::"),u+=P}else null!=_&&(E.Account=_.Text,_.SelectedValue>0&&(n=_.SelectedValue.toString())),t.sbQuery+=' AccountID="'+n+'"'},B=1;B<this.CostCenterFilters.length;B++)Q(B);E.Query=this.sbQuery.toString(),E.Combination=u,this.PriceGrid.addRow(E),U++}}while(null!=R&&R.SelectedNodes.length>U)}if(this.PriceGrid.Table.length>0)for(var H=this.iRateStartIndex;H<this.oTableColumns.length;H++)this.Rates[H-this.iRateStartIndex].Text=this.PriceGrid.Table[0][H].toString()}},{key:"OnButtonClick",value:function(e){var t=this;if(this.DisplayMessage="","FilterCancel"==e)this.FilterVisibility=!1;else if("ShowFilter"==e)this.FilterVisibility=!0;else if("Generate"==e)"EDIT"==this.Mode?this.IsEditFilter?this.LoadEditData():this.GenerateClick():"SEARCH"==this.Mode?this.LoadEditData():this.GenerateClick();else if("Load"==e)m.AddTaxChartNewViewModel.LoadDimensionNodes(this,this.ProfileID);else if("Save"==e)this.IsFromReport?this.ReportSaveClick():this.SaveClick();else if("Customize"==e);else if("CLEAR"==e)this.PriceGrid.Table.Clear();else if("LatestData"==e)this.GetLatestData();else if("Copy"==e){var r=this.PriceGrid.Table.filter((function(e){return 1==e.select})),i=this.PriceGrid.Table.length,s=null;r.forEach((function(e){e.select=!1;for(var r=t.PriceGrid.NewRow(),i=0;i<t.oTableColumns.length;i++){var n=t.oTableColumns[i];r[n]=e[n]}r.wef=(new Date).ToString(a.a.SessionManager.Preferences["Date Format"]),r.wef_key=new Date,r.select=!1,r.PriceCCID=null,r.sno=t.PriceGrid.Table.length+1,null==s&&(s=r),t.PriceGrid.addRow(r)})),r.length>0?(this.DisplayMessage="Duplicate rows added at end",this.PriceGrid.SelectedItem=this.PriceGrid.Table[i]):this.DisplayMessage="Please select row to copy"}}},{key:"LoadEditData",value:function(){var e=1,t="",r="",i="";this.CostCenterFilters.forEach((function(s){if(2==s.CostCenterID?(t="AccountID",r="T.AccountID"):3==s.CostCenterID?(t="ProductID",r="T.ProductID"):12==s.CostCenterID?(t="CurrencyID",r="T.CurrencyID"):s.CostCenterID>5e4&&(e=2,t="NodeID",r="T.CCNID"+(s.CostCenterID-5e4)),s.SelectedNodes.length>0){if(1==s.SelectedNodes.length)i+=" AND ",i+=r+"="+s.SelectedNodes[0].Id;else if(null==s.SelectedNodes.find((function(t){return t.Id==e&&t.IsGroup})))if(i+=" AND ",I.IPrefetchFilter.IsGroupTree(s)){for(var n="",a=0;a<s.SelectedNodes.length;a++)null!=s.SelectedNodes[a].Parent&&s.SelectedNodes[a].Parent.IsSelected||(n.length>0&&(n+=","),n+=s.SelectedNodes[a].Id);0==n.length&&(n+=-12912),i+=r+" IN ",i+=" (select T."+t+" GTID from "+o.e.GetTagTableName(s.CostCenterID)+" T with(nolock),"+o.e.GetTagTableName(s.CostCenterID)+" GTP with(nolock) where T.lft BETWEEN GTP.lft AND GTP.rgt AND GTP."+t+" IN ( "+n.toString()+" )  group by T."+t+")"}else{i+=r+" IN (";for(var l=0;l<s.SelectedNodes.length;l++)l>0&&(i+=","),i+=s.SelectedNodes[l].Id;i+=")"}}else s.DeleteButtonVisibility||(i+=" AND ",i+=r+"=-12912")})),this.LoadProfileData(-1,0,(new Date).Date(),"",i.toString(),null),this.FilterVisibility=!1}},{key:"OnGridLinkClick",value:function(e,t,r){"Action"==t&&(null!=e.PriceCCID&&parseInt(e.PriceCCID)>0&&!this.DeletedIDs.Contains(parseInt(e.PriceCCID))&&this.DeletedIDs.push(parseInt(e.PriceCCID)),this.PriceGrid.removeRow(e),this.PriceGrid.RefreshSno())}},{key:"SaveClick",value:function(){var e=this;if("SEARCH"!=this.Mode&&"REPORT"!=this.Mode&&o.e.StringIsNullOrEmpty(this.Name.Text))this.DisplayMessage="Select "+this.Name.Label;else if(!(this.ProfileID>0&&1!=this.StatusID)||a.a.SessionManager.UserID==this.CreatedBy.toString()&&this.HasAccess){var t="",r=!0;this.PriceGrid.Table.forEach((function(i){if(r)if(o.e.StringIsNullOrEmpty(i.Product_Key))r=!1;else{t+="<Row ",o.e.StringIsNullOrEmpty(i.PriceCCID)||(t+=' PriceCCID="'+i.PriceCCID.toString()+'"'),t+=i.Query,!o.e.StringIsNullOrEmpty(i.wef_key)&&o.e.isValidDate(i.wef_key.toString())?t+=' WEF="'+new Date(i.wef_key).ToString("dd/MMM/yyyy")+'"':t+=' WEF="'+e.WEF.Date.ToString("dd/MMM/yyyy")+'"',!o.e.StringIsNullOrEmpty(i.tillDate_key)&&o.e.isValidDate(i.tillDate_key.toString())&&(t+=' TillDate="'+new Date(i.tillDate_key).ToString("dd/MMM/yyyy")+'"'),e.Remarks.Visible&&(t+=' Remarks="'+o.e.EncodeXML(i.Remarks.toString())+'"'),o.e.StringIsNullOrEmpty(i.PriceType)?t+=' Type="0"':t+=' Type="'+i.PriceType.toString()+'"';for(var s=e.iRateStartIndex;s<e.oTableColumns.length;s++)t+=" "+e.oTableColumns[s]+'="'+i[e.oTableColumns[s]]+'"';t+="/>"}}));var i="";if(this.DeletedIDs.length>0&&(i+="<XML>",this.DeletedIDs.forEach((function(e){i+='<Row  ID="'+e+'" />'})),i+="</XML>"),t.length>0||i.length>0){t="<XML>"+t+"</XML>";var s=0;this.ChartType_Sale?s=1:this.ChartType_Purchase?s=2:this.ChartType_Reorder&&(s=3);var n,l=this.oChart.SetPriceChartNew(this.ProfileID,this.Name.Text,this.SelectedNodeID,!1,t.toString(),i.toString(),s,!1);n=l.Message,l.RetValue>0&&("EDIT"==this.Mode||(null!=this.TreeViewModel&&this.TreeViewModel.Refresh(),this.Name.Text=""),this.Clear()),this.DisplayMessage=n}}else this.DisplayMessage="In-Active profiles can not be modified"}},{key:"ReportSaveClick",value:function(){var e=!1,t=!1;if(this.PriceGrid.Table.forEach((function(r){o.e.StringIsNullOrEmpty(r.PriceCCID)?t=!0:e=!0})),t){if(o.e.StringIsNullOrEmpty(this.Name.Text))return void(this.DisplayMessage="Select "+this.Name.Label);e=!1,this.ProfileID=0,this.SaveClick()}else e&&(this.ProfileID=-100,this.SaveClick())}},{key:"Clear",value:function(){null!=this.PriceGrid&&null!=this.PriceGrid.Table&&this.PriceGrid.Table.Clear(),this.IsFromReport=!1,this.DeletedIDs.Clear()}},{key:"GenerateClick",value:function(){var e=this;this.DisplayMessage="",this.dblPrices=Array(this.RateColumnCount);for(var t=0;t<this.RateColumnCount;t++)if(!o.e.StringIsNullOrEmpty(this.Rates[t].Text))try{this.dblPrices[t]=parseFloat(this.Rates[t].Text)}catch(u){}var r=this.CostCenterFilters.find((function(e){return 3==e.CostCenterID}));if(null!=r){if(this.ProductNameIndex=1,r.SelectedNodes.length>0&&r.SelectedNodes[0].Tree instanceof D.a)for(var i=r.SelectedNodes[0].Tree.ColumnsSource,s=0;s<i.length;s++)if("ProductName"==i[s].DBName){this.ProductNameIndex=s;break}this.lstTemp.Clear(),this.lstTempCC.Clear(),this.lstTempCC.push(3),this.lstTempCC.push(11),this.lstTemp.push(null),this.lstTemp.push(null);var n,a=this.CostCenterFilters.length+1;this.CostCenterFilters=this.CostCenterFilters.sort((function(e,t){return e.CostCenterID-t.CostCenterID})),this.CostCenterFilters.forEach((function(t){if(t.HideFilter.IsChecked){if(0==(n=t.SelectedNodes.filter((function(e){return!e.IsGroup}))).length)return void(e.DisplayMessage="Please Select "+t.CostCenter)}else{n=new Array;for(var r=0;r<t.SelectedNodes.length;r++)null!=t.SelectedNodes[r].Parent&&t.SelectedNodes[r].Parent.IsSelected||n.push(t.SelectedNodes[r]);if(0==n.length)return void(e.DisplayMessage="Please Select "+t.CostCenter)}3==t.CostCenterID?e.lstTemp[0]=n:(e.lstTemp.push(n),e.lstTempCC.push(t.CostCenterID))}));var l=new Array;this.UOM.Items.find((function(e){return"87"==e.Value})),this.UOM.Items.filter((function(e){return e.IsChecked})).forEach((function(e){var t=new h.a;t.Id=parseInt(e.Value),l.push(t),l[l.length-1].Text.push(e.Name)})),this.lstTemp[1]=l,0!=l.length?(this.stkCC=new Array(a),this.stkID=new Array(a),this.stkName=new Array(a),this.stkCode=new Array(a),this.CallRecursive(0),this.FilterVisibility=!1):this.DisplayMessage="Please Select UOM"}else this.DisplayMessage="Please Select Product"}},{key:"CallRecursive",value:function(e){for(var t=this,r=0;r<this.lstTemp[e].length;r++)if(this.stkName[e]=this.lstTemp[e][r].Text.length>1?0==e?this.lstTemp[e][r].Text[this.ProductNameIndex]:this.lstTemp[e][r].Text[1]:this.lstTemp[e][r].Text[0],this.stkCode[e]=this.lstTemp[e][r].Text[0],this.stkCC[e]=this.lstTempCC[e],this.stkID[e]=this.lstTemp[e][r].Id,0==e&&(this.ProductUOM=this.lstTemp[e][r].Tag.toString()),1!=e||null==this.ProductUOM||this.ProductUOM.split(",").Contains(this.lstTemp[e][r].Id.toString()))if(e==this.lstTemp.length-1){var i=function(){var e=t.PriceGrid.NewRow();for(t.sbQuery="",t.dbQuery="",t.j=0;t.j<t.stkCC.length;t.j++)3==t.stkCC[t.j]?(t.sbQuery+=' ProductID="'+t.stkID[t.j]+'"',t.dbQuery+=" ProductID='"+t.stkID[t.j]+"' and "):2==t.stkCC[t.j]?(t.sbQuery+=' AccountID="'+t.stkID[t.j]+'"',t.dbQuery+=" AccountID='"+t.stkID[t.j]+"' and "):11==t.stkCC[t.j]?(t.sbQuery+=' UOMID="'+t.stkID[t.j]+'"',t.dbQuery+=" UOMID='"+t.stkID[t.j]+"' and "):12==t.stkCC[t.j]?(t.sbQuery+=' CurrencyID="'+t.stkID[t.j]+'"',t.dbQuery+=" CurrencyID='"+t.stkID[t.j]+"' and "):(t.sbQuery+=" CC"+(parseInt(t.stkCC[t.j])-5e4)+'="'+t.stkID[t.j]+'"',t.dbQuery+=" CCNID"+(parseInt(t.stkCC[t.j])-5e4)+"='"+t.stkID[t.j]+"' AND");e.Query=t.sbQuery.toString();var r=0;if(t.ChartType_Sale?r=1:t.ChartType_Purchase?r=2:t.ChartType_Reorder&&(r=3),e.PriceType=r,t.PriceGrid.Table.filter((function(e){return e.Query==t.sbQuery.toString()&&e.wef_Key==t.WEF.Date.ToString("dd/MMM/yyyy")&&e.PriceType==r.toString()})).length>0)return{v:(t.DisplayMessage="Data already exists with same combination on wef date",void(t.MessageVisibility=!0))};if(t.dbQuery.length>0){var i=a.a.common.GetDataSet3("PTC002",t.dbQuery,t.WEF.Date.ToString("dd/MMM/yyyy"),r.toString());if(null!=i&&i.Tables.length>0&&i.Tables[0].length>0)return{v:(t.DisplayMessage="Data already exists with same combination on wef date",void(t.MessageVisibility=!0))};t.PriceGrid.addRow(e)}else t.PriceGrid.addRow(e);e[0]=t.PriceGrid.Table.length,e.Product=t.stkName[0],e.Product_Key=t.stkID[0],null!=t.stkCode&&(e.ProductCode=t.stkCode[0]),e.UOM=t.stkName[1],e.UOM_Key=t.stkID[1];for(var s=t.iRateStartIndex;s<t.oTableColumns.length;s++)e[s]=t.dblPrices[s-t.iRateStartIndex];for(e.wef=t.WEF.Date.ToString(a.a.SessionManager.Preferences["Date Format"]),e.wef_key=t.WEF.Date,t.TillDate.Date&&(e.tillDate=t.TillDate.Date.ToString(a.a.SessionManager.Preferences["Date Format"]),e.tillDate_key=t.TillDate.Date),t.Remarks.Visible&&!o.e.IsNullOrWhiteSpace(t.Remarks.Text)&&(e.Remarks=t.Remarks.Text),e.Action=a.a.GetResource("Delete"),t.stkValue="",t.j=2;t.j<t.stkName.length;t.j++)t.stkValue.length>0&&(t.stkValue+="::"),t.stkValue+=t.stkName[t.j];e.Combination=t.stkValue}();if("object"==typeof i)return i.v}else this.CallRecursive(e+1)}},{key:"LoadProfileData",value:function(e,t,r,i,s,n){var o,l=this,u=a.a.inventory.GetPriceChart(2,this.ProfileID,s),c=[];this.DeletedIDs.Clear();var h,d,C=1,f=0;u.Tables[0].forEach((function(s){if((o={}).sno=C,o.select=!1,null==n)for(var D=function(e){0!=(f=parseFloat(s[l.oTableColumns[e]]))&&(o[l.oTableColumns[e]]=f.ToString("N"+l.PriceGrid.Columns.filter((function(t){return t.DisplayMember==l.oTableColumns[e]}))[0].DecimalPoints))},p=l.iRateStartIndex;p<l.oTableColumns.length;p++)D(p);else n.forEach((function(r){f=parseFloat(s[r]),1==e?f+=t:2==e?f+=f*t/100:3==e?(f-=t)<0&&(f=0):4==e&&((f-=f*t/100)<0&&(f=0)),0!=f&&(o[r]=f.ToString("N"+l.PriceGrid.Columns.filter((function(e){return e.DisplayMember==r}))[0].DecimalPoints))}));for(o.Product=s.ProductName.toString(),o.ProductCode=s.ProductCode.toString(),o.Product_Key=s.ProductID.toString(),"SEARCH"==l.Mode&&(o.ProfileName=s.ProfileName.toString()),-1==e?(o.wef=new Date(s.WEF_DATE).ToString(a.a.SessionManager.Preferences["Date Format"]),o.wef_Key=s.WEF_DATE,o.PriceCCID=s.PriceCCID,null!=s.Till_Date&&(o.tillDate=new Date(s.Till_Date).ToString(a.a.SessionManager.Preferences["Date Format"]),o.tillDate_Key=s.Till_Date),o.Remarks=s.Remarks):(o.wef=r.ToString(a.a.SessionManager.Preferences["Date Format"]),o.wef_Key=r,""!=i&&(o.tillDate=new Date(i).ToString(a.a.SessionManager.Preferences["Date Format"]),o.tillDate_Key=new Date(i)),l.Remarks.Visible&&(o.Remarks=l.Remarks.Text)),o.Action="Delete",o.PriceType=s.PriceType,l.sbQuery="",l.sbQuery+=' ProductID="'+s.ProductID+'"',parseInt(s.UOMID)>0&&(l.sbQuery+=' UOMID="'+s.UOMID+'"',o.UOM=s.UOMName.toString(),o.UOM_Key=s.UOMID.toString()),d="",parseInt(s.AccountID)>0&&(l.sbQuery+=' AccountID="'+s.AccountID+'"',d+=s.AccountName.toString()),parseInt(s.CurrencyID)>0&&(l.sbQuery+=' CurrencyID="'+s.CurrencyID+'"',d.length>0&&(d+="::"),d+=s.Currency.toString()),h=0;h<u.Columns[0].length;h++)if(u.Columns[h].toUpperCase().startsWith("CCNID")&&parseInt(s[u.Columns[h]])>0){var I=parseInt(u.Columns[h].toUpperCase().Replace("CCNID",""));l.sbQuery+=" CC"+I+'="'+s[u.Columns[h]]+'"',d.length>0&&(d+="::"),d+=s["CC"+I].toString()}o.Query=l.sbQuery.toString(),o.Combination=d,c.push(o),C++})),this.PriceGrid.Table=c}},{key:"GetLatestData",value:function(){for(var e=this,t=1,r="",i=0;i<this.PriceGrid.Table.length;i++){var s=this.PriceGrid.Table[i];if(0==o.e.String(s.Product_Key).length)break;r+="<Row ",r+='ID="'+t.toString()+'"',r+=s.Query,r+="/>",t++}r.length>0&&(r="<XML>"+r+"</XML>");var n,a=this.oChart.GetPriceChartLatestData(r.toString());null!=a&&a.Tables.length>0&&a.Columns[0].Contains("SellingRate")?(t=0,a.Tables[0].forEach((function(r){n=e.PriceGrid.Table[t];for(var i=e.iRateStartIndex;i<e.oTableColumns.length;i++)o.e.IsEmpty(r[e.oTableColumns[i]])||(n[e.oTableColumns[i]]=r[e.oTableColumns[i]],e.PriceGrid.updateRow(n));t++}))):this.DisplayMessage="Error in loading latest data"}},{key:"OnCostCenterChange",value:function(e){if(!o.e.StringIsNullOrEmpty(this.CostCenters.SelectedValue)&&(0==this.tree.length||this.tree[0].CostCenterID!=parseInt(this.CostCenters.SelectedValue))){var t=0;null==this.CostCenters.SelectedItem||o.e.StringIsNullOrEmpty(this.CostCenters.SelectedItem.Parent)||(t=o.e.Int(this.CostCenters.SelectedItem.Parent)),this.LoadCostCenterTree(parseInt(this.CostCenters.SelectedValue),t,0,null)}}},{key:"LoadCostCenterTree",value:function(e,t,r,i){this.tree.Clear();var s="";50002==e&&"1"!=a.a.SessionManager.RoleID&&"True"==a.a.SessionManager.Preferences.EnableLocationWise.toString()&&"True"==a.a.SessionManager.Preferences["LW Reports"]&&(s=o.e.StringIsNullOrEmpty(a.a.SessionManager.LocationWhere)?"A.NodeID IN (-1234)":"A.NodeID IN ("+a.a.SessionManager.LocationWhere+")");var n=new D.a;if(null==i)for(var l=0;l<this.CostCenterFilters.length;l++){var u=this.CostCenterFilters[l];if(u.CostCenterID==e&&u.LookupTypeID==t){i=u.SelectedNodes;break}}null==i?n.TreeViewModel_5(e,this,r,s,""):n.TreeViewModel_6(e,this,r,s,i,""),n.LookupTypeID=t,n.HeaderVisiblity=!1,n.OnNodeSelected||(n.OnNodeSelected=new y.b,n.OnNodeSelected.Subscribe(this,"OnNodeSelected")),this.tree.push(n)}},{key:"OnNodeSelectedCallBack",value:function(){if(3==this.tree[0].CostCenterID&&this.tree[0].SelectedNodes.length>0){var e=this.CostCenterFilters.find((function(e){return 3==e.CostCenterID}));null!=e&&(e.HideFilter.Enable=!1,e.HideFilter.IsChecked=!0),this.FillUOM(this.tree[0].IsDynamicTree,this.tree[0].SelectedNodes)}}},{key:"FillUOM",value:function(e,t){var r=this;e&&t.filter((function(e){return e.IsGroup})).length>0||function(){for(var e="",i="",s=t.filter((function(e){return null==e.Tag})),a=s.length,o=0;o<a;o+=100){i="";for(var l=o;l<a&&l-o<100;l++)i.length>0&&(i+=","),i+=s[l].Id.toString();var u=r.oChart.GetProductsUOM(i.toString());if(null!=u&&u.Tables.length>0&&!u.Columns[0].Contains("ErrorMessage"))for(var c=function(t){var i=u.Tables[0].filter((function(e){return e.ProductID==s[t].Id}));if(i.length>0){var a=parseInt(i[0].BaseID);r.dicBaseUnits.ContainsKey(a)||(e="",u.Tables[1].filter((function(e){return e.BaseID==a.toString()})).forEach((function(t){""!=e&&(e+=","),e+=t.UOMID.toString(),0==r.UOM.Items.filter((function(e){return e.Value==t.UOMID.toString()})).length&&r.UOM.Items.push(n.c.CheckedListBoxItem_5(null!=i[0].PCode?t.UnitName.toString()+" ~ "+i[0].PCode.toString():t.UnitName.toString(),t.UOMID.toString(),1==parseInt(t.UnitID.toString())))})),r.dicBaseUnits.push(a,e)),s[t].Tag=r.dicBaseUnits[a]}},h=o;h<a&&h-o<100;h++)c(h)}}()}},{key:"IsEditFilter",get:function(){return this._IsEditFilter},set:function(e){e!=this._IsEditFilter&&(e&&(this.GenerateVisibility=!1),this._IsEditFilter=e)}},{key:"GenerateVisibility",get:function(){return this._GenerateVisibility},set:function(e){e!=this._GenerateVisibility&&(e&&(this.IsEditFilter=!1),this._GenerateVisibility=e)}},{key:"ChartType_All",get:function(){return this._ChartType_All},set:function(e){e!=this._ChartType_All&&(e&&(this.ChartType_Sale=!1,this.ChartType_Purchase=!1,this.ChartType_Reorder=!1),this._ChartType_All=e)}},{key:"ChartType_Sale",get:function(){return this._ChartType_Sale},set:function(e){e!=this._ChartType_Sale&&(e&&(this.ChartType_All=!1,this.ChartType_Purchase=!1,this.ChartType_Reorder=!1),this._ChartType_Sale=e)}},{key:"ChartType_Purchase",get:function(){return this._ChartType_Purchase},set:function(e){e!=this._ChartType_Purchase&&(e&&(this.ChartType_All=!1,this.ChartType_Sale=!1,this.ChartType_Reorder=!1),this._ChartType_Purchase=e)}},{key:"ChartType_Reorder",get:function(){return this._ChartType_Reorder},set:function(e){e!=this._ChartType_Reorder&&(e&&(this.ChartType_All=!1,this.ChartType_Sale=!1,this.ChartType_Purchase=!1),this._ChartType_Reorder=e)}},{key:"SelectAll",get:function(){return this._SelectAll},set:function(e){e!=this._SelectAll&&(this._SelectAll=e,this.selectNodes(e))}}]),r}(d.a),g=function(){function e(){_classCallCheck(this,e),this.selectedid=0,this.CostCenterID=0,this.NodeID=0,this.Title="",this.MessageVisibility=!1,this.DisplayMessage="",this.ReportName=new u.d(0),this.Group=new n.e(0)}return _createClass(e,[{key:"AddGroupViewModel",value:function(e,t,r,i){var s=this;this.parent=e,this.NodeID=r,this.CostCenterID=t,this.selectedid=i,this.ReportName.Label="Name",this.Group.Label="Group";var o=a.a.common.GetDataSet("PTC003",t.toString());if(o.Tables[0].forEach((function(e){s.Group.Items.push(n.d.ComboBoxItems_2(e.Name.toString(),e.ID.toString()))})),this.Group.SetSelectedItem(i.toString()),null==this.Group.SelectedValue&&(this.Group.SelectedValue=o.Tables[0][0].ID.toString()),this.Group.SelectionChangedCommand.Subscribe(this,"onGroupChange"),0==r)this.Title=a.a.GetResource("RevenUReport_CreateGroup");else if(r>0){this.Title=a.a.GetResource("RevenUReport_EditGroup");var l=o.Tables[0].filter((function(e){return e.ID==r}));l.length>0&&(this.ReportName.Text=l[0].Name.toString(),this.Group.SelectedValue=l[0].ParentID.toString(),this.Group.Enable=!1)}}},{key:"OnButtonClick",value:function(e){if("Cancel"==e.toString())a.a.page.HideDialog();else if("Save"==e.toString()){var t;if(o.e.IsNullOrWhiteSpace(this.ReportName.Text))return this.DisplayMessage="Enter Group Name",void(this.MessageVisibility=!0);if(t=0,40==this.CostCenterID){var r=(new f.a).SetPriceChartNew(this.NodeID,this.ReportName.Text,this.selectedid,!0,"","",0,!1);this.DisplayMessage=r.Message,t=r.RetValue}else 45==this.CostCenterID&&new f.a;t>0&&(this.ReportName.Text="",this.NodeID=0)}}},{key:"onGroupChange",value:function(e){this.selectedid=parseInt(this.Group.SelectedValue)}}]),e}()}}]);
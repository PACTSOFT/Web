(window.webpackJsonp=window.webpackJsonp||[]).push([[76],{dZHe:function(e,t,s){"use strict";s.r(t),s.d(t,"RibbonExtPay",(function(){return ae}));var i=s("V7Sd"),a=s("Saj9"),l=s("Do2H"),o=s("V+gx"),n=s("+0zN"),r=s("E7Kr"),h=s("R89Y"),d=s("Lp6j"),m=s("vTM8"),p=s("eQJW"),C=s("8B8H"),c=s("ScVY"),g=s("VxiT"),y=s("ockk"),M=s("0/4Q"),P=s("s7Y5"),D=s("/G+I"),u=s("1xwR"),E=s("PGQ+"),I=s("EUZL");class S extends c.b{constructor(e){super(),this.DialogResult=!1,this.dtData=null,this.dtDataColumns=null,this.ExcelData=[],this.DisplayMessage="",this.Parent=e[0],this.Parent.Opacity=.3,this.dgv=new C.a,this.dgv.Columns=new Array,this.dgv.Width="450",this.dgv.Table=[]}Button_Click(e){if("Load"==e.toString()){if(0==this.dgv.Table.length)return this.DisplayMessage="View the data before loading.",void(this.MessageVisibility=!0);try{let e;this.dtData=[],this.dtDataColumns=[];for(let t=0;t<this.dgv.Columns.length;t++)this.dtDataColumns.push(this.dgv.TableColumns[t]);for(let t=0;t<this.dgv.Table.length;t++){e={};for(let s=0;s<this.dgv.Columns.length;s++)null!=this.dgv.Table[t][s]&&null!=this.dgv.Table[t][s]&&(e[s]=this.dgv.Table[t][s].toString());this.dtData.push(e)}this.dtData=this.dgv.Table}catch(s){}null!=this.Parent&&(this.Parent.Opacity=1,this.Parent.DialogResult=!0),this.DialogResult=!0,l.a.page.HideDialog()}else if("View"==e.toString()){let e;this.dgv.Columns.Clear(),this.dgv.TableColumns.Clear(),this.dgv.Clear();var t=new Array;if(null!=this.ExcelTable&&this.ExcelTable.length>0){for(let i=0;i<this.ExcelTableColumns.length;i++)e=new y.a,e.Header=this.ExcelTableColumns[i],e.DisplayMember=this.ExcelTableColumns[i],e.ID=this.ExcelTableColumns[i],e.Width=100,e.ReadOnly=!0,t.push(e),this.dgv.TableColumns.push(this.ExcelTableColumns[i]);let s;this.dgv.Columns=t;for(let e=1;e<this.ExcelTable.length;e++){s=this.dgv.NewRow();for(let t=0;t<this.ExcelTableColumns.length;t++)s[this.ExcelTableColumns[t]]=this.ExcelTable[e][t];this.dgv.Table.push(s),this.dgv.updateRow(s)}}}else"Browse"==e.toString()||"Cancel"==e.toString()&&(null!=this.Parent&&(this.Parent.Opacity=1,this.Parent.DialogResult=!1),this.DialogResult=!1,l.a.page.HideDialog());Logger.InfoLog("ConsMPLoadViewModel::Exiting Button_Click")}OpenFile(e){if(1!==e.target.files.length)throw new Error("Cannot use multiple files");const t=new FileReader,s=e.target.files[0];this.fileExt=s.name.split(".").pop(),this.fileName=s.name,t.onload=e=>{const s=I.read(t.result,{type:"binary"});if(this.ExcelData=I.utils.sheet_to_json(s.Sheets[s.SheetNames[0]],{header:1}),!d.e.IsEmpty(this.ExcelData)&&this.ExcelData.length>0)try{this.ExcelTable=this.ExcelData,this.ExcelTableColumns=this.ExcelData[0],this.ActualFileName=this.fileName}catch(i){return void(this.DisplayMessage=i.Message)}},t.readAsBinaryString(s)}}var T=s("qeHP"),L=s("BUEH"),b=s("Iab2");class F extends c.b{constructor(e){super(),this.Opacity=1,this.DialogResult=!1,this.ProgressVisibility=!1,this.ProgressValue=0,this.ProgressMax=0,this._SelectAll=!1,this.IsProcessWithArrears=!1,this.PostVisiblility=!0,this.UnPostVisiblility=!0,this.ExportVisiblility=!0,this.GridColumnType=new m.a,this.CostCenterID=0,this.sCrAccount="0",this.sDrAccount="0",this.dtRes=null,this.drwRes=null,this.SelectUnCheck=0,this.objCMPLData=null,this.IsProcessed=!1,this.sFilter="",this.sBGWorkType="",this.dtArrData=null,this.iEmpIndex=0,this.strResult="",this.Failed="",this.FailedCount=0,this.DefProdID=0;try{Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering ConsolidatedMonthlyPayrollViewModel()"),this.ClassName="ConsolidatedMonthlyPayrollViewModel",this.CostCenterID=40054,this.dtRes=l.a.common.GetDataTable("PAY073",l.a.SessionManager.LangID),this.DisplayName=l.a.GetResource(e.Replace(" ","")),this.Title=l.a.GetResource(e.Replace(" ","")),this.DisplayMessage="",this.sPayrollMonth=" / ["+l.a.SessionManager.PayrollMonth.ToString("MMM-yyyy")+"]",this.lblPayrollMonth=l.a.SessionManager.PayrollMonth.ToString("MMM, yyyy"),this.lblPayrollMonthStart=l.a.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy"),this.lblPayrollMonthEnd=l.a.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy"),this.PostVisiblility=l.a.SessionManager.IsActionAssigned(this.CostCenterID,"Create"),this.UnPostVisiblility=l.a.SessionManager.IsActionAssigned(this.CostCenterID,"Delete"),this.ExportVisiblility=l.a.SessionManager.IsActionAssigned(this.CostCenterID,"Export"),this.LoadGrid(),this.btnFilter_Click()}catch(t){Logger.ErrorLog("ConsolidatedMonthlyPayrollViewModel::EXCEPTION ConsolidatedMonthlyPayrollViewModel()",t)}}get SelectAll(){return this._SelectAll}set SelectAll(e){e!=this._SelectAll&&(this._SelectAll=e,this.SelectUnselectAll(e))}SerializeGridColumnType(){this.GridColumnType.ContainsKey("id")||this.GridColumnType.push("id","Int64");for(let e=0;e<this.dgvEmployees.TableColumns.length;e++);}sPayrollMonth_MouseDoubleClick(e){let t=new a.SetPayrollDateViewModel;l.a.page.ShowDialog(t,o.SetPayrollDateComponent,{ShowCenter:!0,Title:l.a.GetResource("Pay_SetPayrollDate")}).subscribe(()=>{t.DialogResult&&this.btnClear_Click()})}dgvEmployees_EndEdit(e,t,s){let i=this.dgvEmployees.Table.indexOf(e);this.iEmpIndex=this.lstSelectedEmps.indexOf(i),this.iEmpIndex<0||("DaysAttended"==t?(this.oCMP.SetDaysAttended(this.iEmpIndex,"Days Attended",parseFloat(e[t])),this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays<0?(this.DisplayMessage=l.a.GetResource("EnterValidDaysAttended"),this.MessageVisibility=!0):this.oCMP.arrLstOthMPFields[this.iEmpIndex].dblLeavesLOP>0&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays<this.oCMP.arrLstOthMPFields[this.iEmpIndex].dblLeavesLOP?(this.DisplayMessage="Employee Should have atleast "+this.oCMP.arrLstOthMPFields[this.iEmpIndex].dblLeavesLOP+" LOP Days",this.MessageVisibility=!0):this.DisplayMessage="",e.LOPDays=this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays.ToString("0.0")):"LOPDays"==t?this.oCMP.SetDaysAttended(this.iEmpIndex,"LOP",parseFloat(e[t])):t.startsWith("EarningOTHrs")?this.oCMP.ReEvaluateData(this.iEmpIndex,1,parseInt(t.Replace("EarningOTHrs","")),e[t].toString()):t.startsWith("Earning")&&!t.endsWith("_Arr")?this.oCMP.ReEvaluateData(this.iEmpIndex,0,parseInt(t.Replace("Earning","")),e[t].toString()):t.startsWith("DeductionOTHrs")?this.oCMP.ReEvaluateData(this.iEmpIndex,3,parseInt(t.Replace("DeductionOTHrs","")),e[t].toString()):t.startsWith("Deduction")&&!t.endsWith("_Arr")?this.oCMP.ReEvaluateData(this.iEmpIndex,2,parseInt(t.Replace("Deduction","")),e[t].toString()):t.startsWith("dcAlpha")?t.endsWith("_Key")?this.oCMP.UpdateExtraFieldData(this.iEmpIndex,t.Replace("_Key",""),new Date(e[t]).ToString("dd/MMM/yyyy")):this.oCMP.UpdateExtraFieldData(this.iEmpIndex,t,e[t].toString()):t.startsWith("dcCCNID")&&(e.Table.Columns.Contains(t+"_Key")?this.oCMP.UpdateExtraFieldData(this.iEmpIndex,t,e[t+"_Key"].toString()):this.oCMP.UpdateExtraFieldData(this.iEmpIndex,t,e[t].toString())),this.dgvEmployees.updateRow(e),this.FillProcessedData(i))}GetResource(e,t){let s=e;return this.drwRes=this.dtRes.filter(s=>s.CCID==t&&s.Code==e),null!=this.drwRes&&this.drwRes.length>0?1==l.a.SessionManager.LanguageID?this.drwRes[0].Name.toString():this.drwRes[0].AliasName.toString():s}LoadGrid(){let e,t=new g.a;this.dsDocDesig=t.GetScreenInfo(this.CostCenterID),e=this.dsDocDesig.Tables[0].filter(e=>"CreditAccount"==e.SysColumnName),null!=e&&e.length>0&&!d.e.IsEmptySpace(e[0].UserDefaultValue)&&(this.sCrAccount=e[0].UserDefaultValue.toString()),e=this.dsDocDesig.Tables[0].filter(e=>"DebitAccount"==e.SysColumnName),null!=e&&e.length>0&&!d.e.IsEmptySpace(e[0].UserDefaultValue)&&(this.sDrAccount=e[0].UserDefaultValue.toString()),this.dgvEmployees=new C.a,this.dgvEmployees.gridtype="CMP",this.dgvEmployees.Height=0,this.dgvEmployees.SelectAll.Visible=!0,this.dgvEmployees.OnCellEditEnding.Subscribe(this,"dgvEmployees_EndEdit"),this.dgvEmployees.CanUserDeleteRows=!0,this.dgvEmployees.UpdateFooter(),this.dgvEmployees.UpdateTotals();let s=new y.a;if(this.dgvEmployees.Columns=new Array,this.dgvEmployees.Table=[],s=new y.a,s.Header=this.GetResource("Select",40054),s.DisplayMember="Select",s.ID="Select",s.DataType="CheckBox",s.Width=50,s.IsFrozen=!0,s.CheckedChanged.Subscribe(this,"dgColSelect_CheckedChanged"),this.dgvEmployees.Columns.push(s),this.dgvEmployees.TableColumns.push("Select"),this.dgvEmployees.DataTypes.Bool.push("Select"),s=new y.a,s.Header=this.GetResource("S No",40054),s.DisplayMember="SNo",s.ID="SNo",s.DataType="TextBlock",s.Width=50,s.ReadOnly=!0,s.IsFrozen=!0,this.dgvEmployees.Columns.push(s),this.dgvEmployees.TableColumns.push("SNo"),s=new y.a,s.Header="EmpSeqNo",s.DisplayMember="EmpSeqNo",s.ID="EmpSeqNo",s.DataType="TextBlock",s.Width=50,s.ReadOnly=!0,s.IsFrozen=!0,s.IsVisible=!1,this.dgvEmployees.Columns.push(s),this.dgvEmployees.TableColumns.push("EmpSeqNo"),s=new y.a,s.Header=this.GetResource("Employee Code",40054),s.DisplayMember="EmpCode",s.ID="EmpCode",s.CrRefColName="dcCCNID51",s.DataType="TextBlock",s.Width=150,s.ReadOnly=!0,s.IsFrozen=!0,this.dgvEmployees.Columns.push(s),this.dgvEmployees.TableColumns.push("EmpCode"),s=new y.a,s.Header=this.GetResource("Employee Name",40054),s.DisplayMember="EmpName",s.ID="EmpName",s.CrRefColName="dcCCNID51",s.DataType="TextBlock",s.Width=250,s.ReadOnly=!0,s.IsFrozen=!0,this.dgvEmployees.Columns.push(s),this.dgvEmployees.TableColumns.push("EmpName"),s=new y.a,s.Header=this.GetResource("dcAlpha3",40054),s.DisplayMember="NetSalary",s.ID="NetSalary",s.CrRefColName="dcAlpha3",s.DataType="FLOAT",s.DecimalPoints=l.a.SessionManager.Preferences.PayrollNoOfDecimals,s.Width=90,s.ReadOnly=!0,s.IsFontBold=!0,s.IsFrozen=!0,s.ShowTotal=!0,s.IsCalculated=1,this.dgvEmployees.Columns.push(s),this.dgvEmployees.TableColumns.push("NetSalary"),this.dgvEmployees.DataTypes.Double.push("NetSalary"),s=new y.a,s.Header=this.GetResource("Month Days",40054),s.DisplayMember="MonthDays",s.ID="MonthDays",s.CrRefColName="dcAlpha4",s.DataType="FLOAT",s.DecimalPoints="1",s.Width=60,s.ReadOnly=!0,this.dgvEmployees.Columns.push(s),this.dgvEmployees.TableColumns.push("MonthDays"),this.dgvEmployees.DataTypes.Double.push("MonthDays"),s=new y.a,s.Header=this.GetResource("dcAlpha5",40054),s.DisplayMember="DaysAttended",s.ID="DaysAttended",s.CrRefColName="dcAlpha5",s.DataType="FLOAT",s.DecimalPoints="1",s.Width=60,s.ReadOnly=!1,this.dgvEmployees.Columns.push(s),this.dgvEmployees.TableColumns.push("DaysAttended"),this.dgvEmployees.DataTypes.Double.push("DaysAttended"),s=new y.a,s.Header=this.GetResource("dcAlpha24",40054),s.DisplayMember="PaidLeaves",s.ID="PaidLeaves",s.CrRefColName="dcAlpha24",s.DataType="FLOAT",s.DecimalPoints="1",s.Width=60,s.ReadOnly=!0,s.ForeColor="Gray",this.dgvEmployees.Columns.push(s),this.dgvEmployees.TableColumns.push("PaidLeaves"),this.dgvEmployees.DataTypes.Double.push("PaidLeaves"),s=new y.a,s.Header=this.GetResource("dcAlpha6",40054),s.DisplayMember="TotalLeaves",s.ID="TotalLeaves",s.CrRefColName="dcAlpha6",s.DataType="FLOAT",s.DecimalPoints="1",s.Width=60,s.ReadOnly=!0,s.ForeColor="Gray",this.dgvEmployees.Columns.push(s),this.dgvEmployees.TableColumns.push("TotalLeaves"),this.dgvEmployees.DataTypes.Double.push("TotalLeaves"),s=new y.a,s.Header=this.GetResource("dcAlpha7",40054),s.DisplayMember="WeeklyOffs",s.ID="WeeklyOffs",s.CrRefColName="dcAlpha7",s.DataType="FLOAT",s.DecimalPoints="1",s.Width=60,s.ReadOnly=!0,s.ForeColor="Gray",this.dgvEmployees.Columns.push(s),this.dgvEmployees.TableColumns.push("WeeklyOffs"),this.dgvEmployees.DataTypes.Double.push("WeeklyOffs"),s=new y.a,s.Header=this.GetResource("dcAlpha8",40054),s.DisplayMember="Holidays",s.ID="Holidays",s.CrRefColName="dcAlpha8",s.DataType="FLOAT",s.DecimalPoints="1",s.Width=60,s.ReadOnly=!0,s.ForeColor="Gray",this.dgvEmployees.Columns.push(s),this.dgvEmployees.TableColumns.push("Holidays"),this.dgvEmployees.DataTypes.Double.push("Holidays"),s=new y.a,s.Header=this.GetResource("dcAlpha9",40054),s.DisplayMember="LOPDays",s.ID="LOPDays",s.CrRefColName="dcAlpha9",s.DataType="FLOAT",s.DecimalPoints="1",s.Width=60,s.ReadOnly=!1,this.dgvEmployees.Columns.push(s),this.dgvEmployees.TableColumns.push("LOPDays"),this.dgvEmployees.DataTypes.Double.push("LOPDays"),s=new y.a,s.Header=this.GetResource("dcAlpha10",40054),s.DisplayMember="UnpaidDays",s.ID="UnpaidDays",s.CrRefColName="dcAlpha10",s.DataType="FLOAT",s.DecimalPoints="1",s.Width=60,s.ReadOnly=!0,s.ForeColor="Gray",this.dgvEmployees.Columns.push(s),this.dgvEmployees.TableColumns.push("UnpaidDays"),this.dgvEmployees.DataTypes.Double.push("UnpaidDays"),s=new y.a,s.Header=this.GetResource("dcAlpha4",40054),s.DisplayMember="TotalDays",s.ID="TotalDays",s.CrRefColName="dcAlpha4",s.DataType="FLOAT",s.DecimalPoints="1",s.Width=60,s.ReadOnly=!0,s.ForeColor="Gray",this.dgvEmployees.Columns.push(s),this.dgvEmployees.TableColumns.push("TotalDays"),this.dgvEmployees.DataTypes.Double.push("TotalDays"),this.dsStructure=l.a.common.GetDataSet("PAY058",l.a.SessionManager.PayrollMonth.ToString("dd MMM yyyy")),null!=this.dsStructure&&this.dsStructure.Tables.length>0){if(e=this.dsStructure.Tables[0].filter(e=>1==e.Type&&"Yes"==e.Applicable),e.SortBy(["SNo"]),null!=e&&e.length>0)for(let t=0;t<e.length;t++)(d.e.IsEmpty(e[t].Behaviour)||"Accruals"!=e[t].Behaviour.toString()&&"Accruals-AccumulateForPreviousYears"!=e[t].Behaviour.toString())&&(s=new y.a,s.Header=this.GetResource(e[t].ComponentCode.toString(),50052),s.CrRefColID=parseInt(e[t].ComponentID),s.DisplayMember="Earning"+e[t].SNo.toString(),s.ID="Earning"+e[t].SNo.toString(),s.DataType="FLOAT",s.DecimalPoints=l.a.SessionManager.Preferences.PayrollNoOfDecimals,s.ReadOnly=!0,s.ShowTotal=!0,s.IsCalculated=1,s.HeaderBackColor="LightBlue",s.Width=80,"OverTime"==e[t].FieldType.toString()?(s.DisplayMember="EarningOTHrs"+e[t].SNo.toString(),s.ID="EarningOTHrs"+e[t].SNo.toString(),s.DecimalPoints="2",s.Width=60,s.ReadOnly=!1):"Monthly"==e[t].FieldType.toString()?s.ReadOnly=!1:s.ForeColor="Gray","-1"!=e[t].Visible.toString()&&(s.IsVisible="1"==e[t].Visible.toString()),"-1"!=e[t].Width.toString()&&(s.Width=parseInt(e[t].Width)),"-1"!=e[t].IndexValue.toString()&&(s.DisplayIndex=parseInt(e[t].IndexValue)),"-1"!=e[t].ReadOnly.toString()&&(s.ReadOnly="1"==e[t].ReadOnly.toString()),"-1"!=e[t].Mandatory.toString()&&(s.Mandatory="1"==e[t].Mandatory.toString()),this.dgvEmployees.Columns.push(s),this.dgvEmployees.TableColumns.push(s.DisplayMember),this.dgvEmployees.DataTypes.Double.push(s.DisplayMember),"OverTime"==e[t].FieldType.toString()&&(s=new y.a,s.Header=this.GetResource(e[t].ComponentCode.toString(),50052)+"_Amount",s.CrRefColID=parseInt(e[t].ComponentID),s.DisplayMember="EarningOTAmt"+e[t].SNo.toString(),s.ID="EarningOTAmt"+e[t].SNo.toString(),s.DataType="FLOAT",s.DecimalPoints=l.a.SessionManager.Preferences.PayrollNoOfDecimals,s.Width=80,s.ReadOnly=!0,s.ShowTotal=!0,s.IsCalculated=1,s.ForeColor="Gray",s.HeaderBackColor="LightBlue","-1"!=e[t].Visible.toString()&&(s.IsVisible="1"==e[t].Visible.toString()),"-1"!=e[t].Width.toString()&&(s.Width=parseInt(e[t].Width)),"-1"!=e[t].IndexValue.toString()&&(s.DisplayIndex=parseInt(e[t].IndexValue)),"-1"!=e[t].ReadOnly.toString()&&(s.ReadOnly="1"==e[t].ReadOnly.toString()),"-1"!=e[t].Mandatory.toString()&&(s.Mandatory="1"==e[t].Mandatory.toString()),this.dgvEmployees.Columns.push(s),this.dgvEmployees.TableColumns.push(s.DisplayMember),this.dgvEmployees.DataTypes.Double.push(s.DisplayMember)));if(s=new y.a,s.Header=this.GetResource("dcAlpha11",40054),s.DisplayMember="TotalEarnings",s.ID="TotalEarnings",s.CrRefColName="dcAlpha11",s.DataType="FLOAT",s.DecimalPoints=l.a.SessionManager.Preferences.PayrollNoOfDecimals,s.ReadOnly=!0,s.ShowTotal=!0,s.IsCalculated=1,s.HeaderBackColor="LightBlue",s.Width=90,this.dgvEmployees.Columns.push(s),this.dgvEmployees.TableColumns.push(s.DisplayMember),this.dgvEmployees.DataTypes.Double.push(s.DisplayMember),null!=e&&e.length>0)for(let t=0;t<e.length;t++)d.e.IsEmpty(e[t].Behaviour)||"Accruals"!=e[t].Behaviour.toString()&&"Accruals-AccumulateForPreviousYears"!=e[t].Behaviour.toString()||(s=new y.a,s.Header=this.GetResource(e[t].ComponentCode.toString(),50052),s.CrRefColID=parseInt(e[t].ComponentID),s.DisplayMember="Earning"+e[t].SNo.toString(),s.ID="Earning"+e[t].SNo.toString(),s.DataType="FLOAT",s.DecimalPoints=l.a.SessionManager.Preferences.PayrollNoOfDecimals,s.ReadOnly=!0,s.ShowTotal=!0,s.IsCalculated=1,s.HeaderBackColor="GreenYellow",s.Width=80,"Monthly"==e[t].FieldType.toString()?s.ReadOnly=!1:s.ForeColor="Gray","-1"!=e[t].Visible.toString()&&(s.IsVisible="1"==e[t].Visible.toString()),"-1"!=e[t].Width.toString()&&(s.Width=parseInt(e[t].Width)),"-1"!=e[t].IndexValue.toString()&&(s.DisplayIndex=parseInt(e[t].IndexValue)),"-1"!=e[t].ReadOnly.toString()&&(s.ReadOnly="1"==e[t].ReadOnly.toString()),"-1"!=e[t].Mandatory.toString()&&(s.Mandatory="1"==e[t].Mandatory.toString()),this.dgvEmployees.Columns.push(s),this.dgvEmployees.TableColumns.push(s.DisplayMember));if(e=this.dsStructure.Tables[0].filter(e=>e.Type="Yes"==e.Applicable),e.SortBy(["SNo"]),null!=e&&e.length>0)for(let t=0;t<e.length;t++)s=new y.a,s.Header=this.GetResource(e[t].ComponentCode.toString(),50052),s.CrRefColID=parseInt(e[t].ComponentID),s.DisplayMember="Deduction"+e[t].SNo.toString(),s.ID="Deduction"+e[t].SNo.toString(),s.DataType="FLOAT",s.DecimalPoints=l.a.SessionManager.Preferences.PayrollNoOfDecimals,s.ReadOnly=!0,s.ShowTotal=!0,s.IsCalculated=1,s.HeaderBackColor="LightCoral",s.Width=80,"OverTime"==e[t].FieldType.toString()?(s.DisplayMember="DeductionOTHrs"+e[t].SNo.toString(),s.ID="DeductionOTHrs"+e[t].SNo.toString(),s.DecimalPoints="2",s.Width=60,s.ReadOnly=!1):"Monthly"==e[t].FieldType.toString()?s.ReadOnly=!1:s.ForeColor="Gray","-1"!=e[t].Visible.toString()&&(s.IsVisible="1"==e[t].Visible.toString()),"-1"!=e[t].Width.toString()&&(s.Width=parseInt(e[t].Width)),"-1"!=e[t].IndexValue.toString()&&(s.DisplayIndex=parseInt(e[t].IndexValue)),"-1"!=e[t].ReadOnly.toString()&&(s.ReadOnly="1"==e[t].ReadOnly.toString()),"-1"!=e[t].Mandatory.toString()&&(s.Mandatory="1"==e[t].Mandatory.toString()),this.dgvEmployees.Columns.push(s),this.dgvEmployees.TableColumns.push(s.DisplayMember),this.dgvEmployees.DataTypes.Double.push(s.DisplayMember),"OverTime"==e[t].FieldType.toString()&&(s=new y.a,s.Header=this.GetResource(e[t].ComponentCode.toString(),50052)+"_Amount",s.CrRefColID=parseInt(e[t].ComponentID),s.DisplayMember="DeductionOTAmt"+e[t].SNo.toString(),s.ID="DeductionOTAmt"+e[t].SNo.toString(),s.DataType="FLOAT",s.DecimalPoints=l.a.SessionManager.Preferences.PayrollNoOfDecimals,s.Width=80,s.ReadOnly=!0,s.ShowTotal=!0,s.IsCalculated=1,s.ForeColor="Gray",s.HeaderBackColor="LightCoral","-1"!=e[t].Visible.toString()&&(s.IsVisible="1"==e[t].Visible.toString()),"-1"!=e[t].Width.toString()&&(s.Width=parseInt(e[t].Width)),"-1"!=e[t].IndexValue.toString()&&(s.DisplayIndex=parseInt(e[t].IndexValue)),"-1"!=e[t].ReadOnly.toString()&&(s.ReadOnly="1"==e[t].ReadOnly.toString()),"-1"!=e[t].Mandatory.toString()&&(s.Mandatory="1"==e[t].Mandatory.toString()),this.dgvEmployees.Columns.push(s),this.dgvEmployees.TableColumns.push(s.DisplayMember),this.dgvEmployees.DataTypes.Double.push(s.DisplayMember));if(e=this.dsStructure.Tables[0].filter(e=>3==e.Type),e.SortBy(["SNo"]),null!=e&&e.length>0)for(let t=0;t<e.length;t++)s=new y.a,s.Header=this.GetResource(e[t].ComponentCode.toString(),50052),s.CrRefColID=parseInt(e[t].ComponentID),s.DisplayMember="Loan"+e[t].SNo.toString(),s.ID="Loan"+e[t].SNo.toString(),s.DataType="FLOAT",s.DecimalPoints=l.a.SessionManager.Preferences.PayrollNoOfDecimals,s.ReadOnly=!0,s.ShowTotal=!0,s.IsCalculated=1,s.ForeColor="Gray",s.HeaderBackColor="LightGoldenrodYellow",s.Width=80,"-1"!=e[t].Visible.toString()&&(s.IsVisible="1"==e[t].Visible.toString()),"-1"!=e[t].Width.toString()&&(s.Width=parseInt(e[t].Width)),"-1"!=e[t].IndexValue.toString()&&(s.DisplayIndex=parseInt(e[t].IndexValue)),"-1"!=e[t].ReadOnly.toString()&&(s.ReadOnly="1"==e[t].ReadOnly.toString()),"-1"!=e[t].Mandatory.toString()&&(s.Mandatory="1"==e[t].Mandatory.toString()),this.dgvEmployees.Columns.push(s),this.dgvEmployees.TableColumns.push(s.DisplayMember),this.dgvEmployees.DataTypes.Double.push(s.DisplayMember);if(s=new y.a,s.Header=this.GetResource("dcAlpha12",40054),s.DisplayMember="TotalDeductions",s.ID="TotalDeductions",s.CrRefColName="dcAlpha12",s.DataType="FLOAT",s.DecimalPoints=l.a.SessionManager.Preferences.PayrollNoOfDecimals,s.ReadOnly=!0,s.ShowTotal=!0,s.IsCalculated=1,s.HeaderBackColor="LightCoral",s.Width=90,this.dgvEmployees.Columns.push(s),this.dgvEmployees.TableColumns.push(s.DisplayMember),this.dgvEmployees.DataTypes.Double.push(s.DisplayMember),e=this.dsStructure.Tables[0].filter(e=>4==e.Type),e.SortBy(["SNo"]),null!=e&&e.length>0)for(let t=0;t<e.length;t++)s=new y.a,s.Header=this.GetResource(e[t].ComponentCode.toString(),50052),s.CrRefColID=parseInt(e[t].ComponentID),s.DisplayMember="Leave"+e[t].SNo.toString(),s.ID="Leave"+e[t].SNo.toString(),s.DataType="FLOAT",s.DecimalPoints="1",s.ReadOnly=!0,s.ShowTotal=!0,s.IsCalculated=1,s.ForeColor="Gray",s.HeaderBackColor="LightGreen",s.Width=60,"-1"!=e[t].Visible.toString()&&(s.IsVisible="1"==e[t].Visible.toString()),"-1"!=e[t].Width.toString()&&(s.Width=parseInt(e[t].Width)),"-1"!=e[t].IndexValue.toString()&&(s.DisplayIndex=parseInt(e[t].IndexValue)),"-1"!=e[t].ReadOnly.toString()&&(s.ReadOnly="1"==e[t].ReadOnly.toString()),"-1"!=e[t].Mandatory.toString()&&(s.Mandatory="1"==e[t].Mandatory.toString()),this.dgvEmployees.Columns.push(s),this.dgvEmployees.TableColumns.push(s.DisplayMember),this.dgvEmployees.DataTypes.Double.push(s.DisplayMember)}let i=this.dsDocDesig.Tables[0].filter(e=>1==e.IsColumnUserDefined&&(2==e.SectionID&&"H"==e.SectionName||3==e.SectionID));if(null!=i&&i.length>0)for(let l=0;l<i.length;l++){switch(s=new y.a,s.Header=this.GetResource(i[l].SysColumnName.toString(),40054),s.DisplayMember=i[l].SysColumnName.toString(),s.ID=i[l].SysColumnName.toString(),s.CrRefColName=i[l].SysColumnName.toString(),s.DataType=i[l].ColumnDataType.toString(),s.IsColumnUserDefined=Object(p.j)(i[l].IsColumnUserDefined),s.Mandatory=Object(p.j)(i[l].IsMandatory),s.DataType.toUpperCase()){case"LISTBOX":s.ValueMember=s.ID+"_Key",this.dgvEmployees.TableColumns.push(s.ID),this.dgvEmployees.TableColumns.push(s.ID+"_Key"),this.dgvEmployees.DataTypes.Int.push(s.ID+"_Key"),s.CostCenterID=parseInt(i[l].ColumnCostCenterID.toString()),s.TypeID=parseInt(i[l].ColumnCCListViewTypeID.toString()),d.e.IsEmpty(i[l].FetchMaxRows)?d.e.IsEmpty(i[l].UserProbableValues)||(s.FilterColumn=i[l].UserProbableValues.toString()):s.GridViewID=parseInt(i[l].FetchMaxRows.toString());break;case"TEXT":case"STRING":case"COMBOBOX":if(this.dgvEmployees.TableColumns.push(s.ID),s.IsColumnUserDefined)if("Date"==i[l].UserColumnType.toString()&&(s.DataType="DATE",this.dgvEmployees.TableColumns.push(s.ID+"_Key"),this.dgvEmployees.DataTypes.Date.push(s.ID+"_Key")),"DateTime"==i[l].UserColumnType.toString())s.DataType="DATETIME",this.dgvEmployees.TableColumns.push(s.ID+"_Key");else if("Time"==i[l].UserColumnType.toString())s.DataType="TIME",this.dgvEmployees.TableColumns.push(s.ID+"_Key");else if("Numeric"==i[l].UserColumnType.toString())s.DataType="FLOAT";else if("SELECTIONBOX"==i[l].UserColumnType.toString()||"editablecombobox"==i[l].UserColumnType.toString().toLowerCase())s.DataType="SELECTIONBOX",s.CostCenterID=this.CostCenterID;else if("combobox"==i[l].UserColumnType.toString().toLowerCase()){if(s.ValueBinding=s.ID,!d.e.IsEmpty(i[l].linkData)&&22803==parseInt(i[l].linkData.toString())||"@YEAR"==s.DefaultValue){s.DataType="PactComboBox";let e=[];for(let t=1980;t<2100;t++){let s={};s.Year=t.toString(),e.push(s)}s.DisplayMember="Year",s.ValueMember="Year",s.ComboData=e,"@YEAR"==s.DefaultValue&&(s.DefaultValue="")}else{s.DataType="ComboBox",s.DisplayMember="Name",s.ValueMember="Value";let e=[],t=i[l].UserProbableValues.toString().Trim();if(t.length>0){let s=t.split(";");for(let t=0;t<s.length;t++)e.push(M.d.ComboBoxItems_2(s[t],s[t]))}s.ComboData=e}this.dgvEmployees.TableColumns.push(s.ID+"_Key")}else if("LISTBOX"==i[l].UserColumnType.toString())if(44==parseInt(i[l].ColumnCostCenterID.toString())){s.ValueBinding=s.ID,s.DataType="ComboBox",s.DisplayMember="Name",s.ValueMember="Value";let e=F.GetLookupData(parseInt(i[l].ColumnCCListViewTypeID));if(null!=e){let t=[];for(let s=0;s<e.length;s++)t.push(M.d.ComboBoxItems_2(e[s].Name.toString(),e[s].NodeID.toString()));s.ComboData=t}this.dgvEmployees.TableColumns.push(s.ID+"_Key")}else s.DataType="LISTBOX",s.ValueMember=s.ID+"_Key",this.dgvEmployees.TableColumns.push(s.ID+"_Key"),s.CostCenterID=parseInt(i[l].ColumnCostCenterID.toString()),s.TypeID=parseInt(i[l].ColumnCCListViewTypeID.toString());else if("Attachment"==i[l].UserColumnType.toString())s.DataType="LINK",s.ReadOnly=!0,s.FilterCondition=i[l].BasedOnXml.toString(),s.Dependantinuse=!1;else if("Image"==i[l].UserColumnType.toString())s.DataType="LINK",s.ReadOnly=!0,s.Dependantinuse=!0;else if("LOOKUP"==i[l].UserColumnType.toString()){s.ValueBinding=s.ID,s.DataType="ComboBox",s.DisplayMember="Name",s.ValueMember="Value";let e=F.GetLookupData(parseInt(i[l].ColumnCCListViewTypeID));if(null!=e){let t=[];for(let s=0;s<e.length;s++)t.push(M.d.ComboBoxItems_2(e[s].Name.toString(),e[s].NodeID.toString()));s.ComboData=t}this.dgvEmployees.TableColumns.push(s.ID+"_Key")}break;case"DATE":s.DataType="DATE",this.dgvEmployees.TableColumns.push(s.ID),this.dgvEmployees.TableColumns.push(s.ID+"_Key"),this.dgvEmployees.DataTypes.Date.push(s.ID+"_Key")}s.Width=100,s.HeaderBackColor="LightGray",this.dgvEmployees.Columns.push(s),this.dgvEmployees.TableColumns.Contains(i[l].SysColumnName.toString())||this.dgvEmployees.TableColumns.push(i[l].SysColumnName.toString())}let a=l.a.common.GetDataTable("PAY059",l.a.SessionManager.RoleID);if(null!=a&&a.length>0){let e=new d.f;if(e.ReadXml(a[0].ValueXml.toString()),null!=e&&e.Tables.length>0&&e.Tables[0].length>0){let t,s=3;for(let i=0;i<this.dgvEmployees.Columns.length;i++)t=e.Tables[0].filter(e=>e.SysColumnName==this.dgvEmployees.Columns[i].CrRefColName),t.length>0?(this.dgvEmployees.Columns[i].DisplayIndex=parseInt(t[0].Index)+s,this.dgvEmployees.Columns[i].Width=parseInt(t[0].Width),this.dgvEmployees.Columns[i].ReadOnly=null!=t[0].ReadOnly&&null!=t[0].ReadOnly&&"1"==t[0].ReadOnly.toString(),this.dgvEmployees.Columns[i].Mandatory=null!=t[0].Mandatory&&null!=t[0].Mandatory&&"1"==t[0].Mandatory.toString(),this.dgvEmployees.Columns[i].IsVisible=null!=t[0].Visible&&null!=t[0].Visible&&"1"==t[0].Visible.toString()):(t=e.Tables[0].filter(e=>e.ID==this.dgvEmployees.Columns[i].CrRefColID),null!=t&&t.length>0?(this.dgvEmployees.Columns[i].DisplayIndex=parseInt(t[0].Index)+s,this.dgvEmployees.Columns[i].Width=parseInt(t[0].Width),this.dgvEmployees.Columns[i].ReadOnly=null!=t[0].ReadOnly&&null!=t[0].ReadOnly&&"1"==t[0].ReadOnly.toString(),this.dgvEmployees.Columns[i].Mandatory=null!=t[0].Mandatory&&null!=t[0].Mandatory&&"1"==t[0].Mandatory.toString(),this.dgvEmployees.Columns[i].IsVisible=null!=t[0].Visible&&null!=t[0].Visible&&"1"==t[0].Visible.toString()):(t=e.Tables[0].filter(e=>e.ID==-this.dgvEmployees.Columns[i].CrRefColID),null!=t&&t.length>0?(this.dgvEmployees.Columns[i].DisplayIndex=parseInt(t[0].Index)+s,this.dgvEmployees.Columns[i].Width=parseInt(t[0].Width),this.dgvEmployees.Columns[i].ReadOnly=null!=t[0].ReadOnly&&null!=t[0].ReadOnly&&"1"==t[0].ReadOnly.toString(),this.dgvEmployees.Columns[i].Mandatory=null!=t[0].Mandatory&&null!=t[0].Mandatory&&"1"==t[0].Mandatory.toString(),this.dgvEmployees.Columns[i].IsVisible=null!=t[0].Visible&&null!=t[0].Visible&&"1"==t[0].Visible.toString()):this.dgvEmployees.Columns[i].DisplayIndex=i))}this.dgvEmployees.Columns.SortBy([{name:"DisplayIndex",parser:parseInt}])}s=new y.a,s.Header=this.GetResource("Result",40054),s.DisplayMember="Result",s.ID="Result",s.DataType="TextBlock",s.Width=250,s.ReadOnly=!0,this.dgvEmployees.Columns.push(s),this.dgvEmployees.TableColumns.push("Result"),this.dgvEmployees.OnPreviewKeyDown.Subscribe(this,"OnPreviewKeyDown")}OnPreviewKeyDown(e,t,s){if("F5"==t.key){var i=this.dgvEmployees.Columns.find(e=>e.DisplayMember==s);if(null!=i){if(i.ReadOnly||"sno"==s.toLowerCase())return!0;if(!confirm("Do you want to override all.?"))return!0;for(let t=0;t<this.dgvEmployees.Table.length;t++)this.dgvEmployees.Table[t][s]=e[s].toString(),this.dgvEmployees.TableColumns.Contains(s+"_Key")&&(this.dgvEmployees.Table[t][s+"_Key"]=e[s+"_Key"].toString()),this.dgvEmployees.updateRow(this.dgvEmployees.Table[t]),this.dgvEmployees_EndEdit(this.dgvEmployees.Table[t],s,-1)}}else if(t.ctrlKey)if("F"==t.key)this.dgvEmployees.SearchVisible?this.dgvEmployees.SearchVisible=!1:(this.dgvEmployees.SearchVisible=!0,this.dgvEmployees.AddSearchCols()),t.Handled=!0;else if("E"==t.key){let e=this.GetRawExportHTML().toString();const s=new Blob([e],{type:"text/plain;charser=utf-8"});b.saveAs(s,this.ScreenName+"_XlsExport_"+(new Date).getTime()+".xls"),t.Handled=!0}return!1}static GetLookupData(e){let t=l.a.common.GetDataSet("PAY060",e.toString());return null!=t&&t.Tables.length>0&&t.Columns[0].Contains("NodeID")?t.Tables[0]:null}dgColSelect_CheckedChanged(e,t){t||1==this.SelectAll&&(this.SelectUnCheck=1,this.SelectAll=!1)}SelectUnselectAll(e){for(let t=0;t<this.dgvEmployees.Table.length;t++)0==this.SelectUnCheck&&(this.dgvEmployees.Table[t].Select=e);this.SelectUnCheck=0}Button_Click(e){if(Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering Button_Click()"),"Post"==e.toString()){if(!this.IsProcessed)return this.DisplayMessage="Data has been modified, Please Process the Payroll again, then Post...",void(this.MessageVisibility=!0);this.btnPost_Click()}else"Clear"==e.toString()?this.btnClear_Click():"UnPost"==e.toString()?this.btnUnPost_Click():"Filter"==e.toString()?this.btnFilter_Click():"Process"==e.toString()?this.btnProcess_Click():"Load"==e.toString()?this.btnLoad_Click():"Export"==e.toString()&&this.btnExport_Click();Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting Button_Click()")}btnExport_Click(){}btnLoad_Click(){try{Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering btnLoad_Click()"),this.objCMPLData=null;let e=[];e.push(this);let t=new S(e);l.a.page.ShowDialog(t,T.a,{Title:"Load Data"}).subscribe(()=>{if(t.DialogResult){if(!t.dtDataColumns.Contains("Employee Code"))return this.DisplayMessage="'Employee Code' Column not found.",void(this.MessageVisibility=!0);this.objCMPLData=t.dtData,this.sBGWorkType="LOAD",this.bgworker_DoWork(null,null),this.bgworker_RunWorkerCompleted(null,null)}Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting btnLoad_Click()")})}catch(e){Logger.ErrorLog("ConsolidatedMonthlyPayrollViewModel::EXCEPTION btnLoad_Click()",e)}}LoadXLData(e){Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering LoadXLData()"),this.InProgress="";let t=0;if(null!=e&&e.length>0){let s;t=e.length,this.ProgressVisibility=!0,this.ProgressValue=0,this.ProgressMax=t,this.ProgressMessage="Loading Excel Data, please wait ...";let i="",a=-1;for(let o=0;o<this.dgvEmployees.Table.length;o++)if(!d.e.IsEmpty(this.dgvEmployees.Table[o].EmpCode)&&(i="",s=e.filter(e=>e["Employee Code"]==this.dgvEmployees.Table[o].EmpCode.toString()),s.length>0)){for(let t=1;t<Object.keys(e[0]).length;t++){let n=Object.keys(e[0])[t];for(let e=0;e<this.dgvEmployees.TableColumns.length;e++)if(this.dgvEmployees.Columns[e].Header==n&&this.dgvEmployees.TableColumns.Contains(this.dgvEmployees.Columns[e].ID)){this.dgvEmployees.Table[o][this.dgvEmployees.Columns[e].ID]=s[0][t].toString();{let n=this.dgvEmployees.Table.indexOf(this.dgvEmployees.Table[o]);this.iEmpIndex=this.lstSelectedEmps.indexOf(n);let r=0,h=-1;this.dgvEmployees.Columns[e].ID.startsWith("EarningOTHrs")?(r=1,h=parseInt(this.dgvEmployees.Columns[e].ID.Replace("EarningOTHrs","")),i=this.dgvEmployees.Columns[e].ID,a=e):this.dgvEmployees.Columns[e].ID.startsWith("Earning")?(r=0,h=parseInt(this.dgvEmployees.Columns[e].ID.Replace("Earning","")),i=this.dgvEmployees.Columns[e].ID,a=e):this.dgvEmployees.Columns[e].ID.startsWith("DeductionOTHrs")?(r=3,h=parseInt(this.dgvEmployees.Columns[e].ID.Replace("DeductionOTHrs","")),i=this.dgvEmployees.Columns[e].ID,a=e):this.dgvEmployees.Columns[e].ID.startsWith("Deduction")&&(r=2,h=parseInt(this.dgvEmployees.Columns[e].ID.Replace("Deduction","")),i=this.dgvEmployees.Columns[e].ID,a=e);let d=this.oCMP.arrLstCPFields[this.iEmpIndex][r].find(e=>e.SNo==h);null!=d&&(d.dActual=parseFloat(s[0][t].toString()).ToString(l.a.SessionManager.sPayrollDecimals)),this.oCMP.othMPField=this.oCMP.arrLstOthMPFields[this.iEmpIndex],"DaysAttended"!=this.dgvEmployees.Columns[e].ID&&"LOPDays"!=this.dgvEmployees.Columns[e].ID||this.dgvEmployees_EndEdit(this.dgvEmployees.Table[o],this.dgvEmployees.Columns[e].ID,e)}break}}a>=0&&this.dgvEmployees_EndEdit(this.dgvEmployees.Table[o],i,a),this.ProgressValue=o+1,this.InProgress=o+1+" of "+t}this.DisplayMessage="Data Loaded Successfully",this.MessageVisibility=!0}Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting LoadXLData()")}btnProcess_Click(){this.AddArrearColumns(),this.sBGWorkType="PROCESS",this.bgworker_DoWork(null,null),this.bgworker_RunWorkerCompleted(null,null)}AddArrearColumns(){if(this.IsProcessWithArrears){let e=this.dsStructure.Tables[0].filter(e=>1==e.Type&&"Yes"==e.Applicable&&"OverTime"!=e.FieldType);e.sort((e,t)=>e.SNo-t.SNo),this.AddEarDedArrearColumns(e,"Earning"),e=this.dsStructure.Tables[0].filter(e=>2==e.Type&&"Yes"==e.Applicable&&"OverTime"!=e.FieldType),e.sort((e,t)=>e.SNo-t.SNo),this.AddEarDedArrearColumns(e,"Deduction")}else{let t=this.dsStructure.Tables[0].filter(e=>1==e.Type&&"Yes"==e.Applicable&&"OverTime"!=e.FieldType);if(t.sort((e,t)=>e.SNo-t.SNo),null!=t&&t.length>0)for(let s=0;s<t.length;s++)this.dgvEmployees.TableColumns.Contains("Earning"+t[s].SNo+"_Arr")&&(this.dgvEmployees.TableColumns.Remove("Earning"+t[s].SNo+"_Arr"),null!=(e=this.dgvEmployees.Columns.find(e=>e.DisplayMember=="Earning"+t[s].SNo+"_Arr"))&&this.dgvEmployees.Columns.Remove(e));if(t=this.dsStructure.Tables[0].filter(e=>2==e.Type&&"Yes"==e.Applicable&&"OverTime"!=e.FieldType),null!=t&&t.length>0)for(let s=0;s<t.length;s++){var e;this.dgvEmployees.TableColumns.Contains("Deduction"+t[s].SNo+"_Arr")&&(this.dgvEmployees.TableColumns.Remove("Deduction"+t[s].SNo+"_Arr"),null!=(e=this.dgvEmployees.Columns.find(e=>e.DisplayMember=="Deduction"+t[s].SNo+"_Arr"))&&this.dgvEmployees.Columns.Remove(e))}}let t=[];for(let s=0;s<this.dgvEmployees.Columns.length;s++)t.push(this.dgvEmployees.Columns[s]);this.dgvEmployees.Columns=t}AddEarDedArrearColumns(e,t){if(null!=e&&e.length>0){let s;for(let i=0;i<e.length;i++)if(this.dgvEmployees.TableColumns.Contains(t+e[i].SNo)){if(this.dgvEmployees.TableColumns.Contains(t+e[i].SNo+"_Arr"))break;if(!d.e.IsEmpty(e[i].Behaviour)&&("Accruals"==e[i].Behaviour.toString()||"Accruals-AccumulateForPreviousYears"==e[i].Behaviour.toString()))continue;s=new y.a,s.Header=this.GetResource(e[i].ComponentCode.toString(),50052)+"_Arr",s.DisplayMember=t+e[i].SNo.toString()+"_Arr",s.ID=t+e[i].SNo.toString()+"_Arr",s.DataType="FLOAT",s.DecimalPoints=l.a.SessionManager.Preferences.PayrollNoOfDecimals,s.ReadOnly=!0,s.ShowTotal=!0,s.IsCalculated=1,s.HeaderBackColor="Earning"==t?"LightBlue":"LightCoral",s.Width=80,"-1"!=d.e.String(e[i].Visible)&&(s.IsVisible="1"==d.e.String(e[i].Visible)),"-1"!=d.e.String(e[i].Width)&&(s.Width=parseInt(e[i].Width)),"-1"!=d.e.String(e[i].IndexValue)&&(s.DisplayIndex=parseInt(e[i].IndexValue)),"-1"!=d.e.String(e[i].Mandatory)&&(s.Mandatory="1"==d.e.String(e[i].Mandatory));let a=this.dgvEmployees.Columns.find(s=>s.DisplayMember==t+e[i].SNo.toString());null!=a&&(this.dgvEmployees.Columns.Insert(this.dgvEmployees.Columns.indexOf(a)+1,s),this.dgvEmployees.TableColumns.push(s.DisplayMember))}}}btnUnPost_Click(){this.sBGWorkType="UNPOST",this.bgworker_DoWork(null,null),this.bgworker_RunWorkerCompleted(null,null)}btnClear_Click(){this.oCMP=null,this.dgvEmployees.Clear(),this.dgvEmployees.UpdateTotals(),this.sPayrollMonth=" / ["+l.a.SessionManager.PayrollMonth.ToString("MMM-yyyy")+"]",this.lblPayrollMonth=l.a.SessionManager.PayrollMonth.ToString("MMM, yyyy"),this.lblPayrollMonthStart=l.a.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy"),this.lblPayrollMonthEnd=l.a.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy"),this.SelectAll=!1,this.FailedCount=0,this.Failed="",this.sBGWorkType="",this.lstSelectedEmps=new Array,this.IsProcessed=!1}btnPost_Click(){this.sBGWorkType="POST",this.bgworker_DoWork(null,null),this.bgworker_RunWorkerCompleted(null,null)}btnFilter_Click(){this.sFilter="",l.a.SessionManager.Preferences.ContainsKey("ConsolidatedPayrollFilter")&&parseInt(l.a.SessionManager.Preferences.ConsolidatedPayrollFilter)>0?null==this.objEmpFilter?this.objEmpFilter=new P.a("",0,3):(this.objEmpFilter.CostCenterFilters.length>0?this.objEmpFilter.CostCenters.SelectedValue=this.objEmpFilter.CostCenterFilters[0].CostCenterID.toString():(this.objEmpFilter.Filter=3,this.objEmpFilter.InitControls()),this.objEmpFilter.CostCenters.Enable=!0):null==this.objEmpFilter?this.objEmpFilter=new P.a("",0,0):(this.objEmpFilter.Filter=0,this.objEmpFilter.InitControls()),l.a.page.ShowDialog(this.objEmpFilter,L.a,{ShowCenter:!0,HideHeader:!0}).subscribe(()=>{if(this.DialogResult=this.objEmpFilter.IsCompleted,this.objEmpFilter.IsCompleted){if(this.objEmpFilter.CostCenterFilters.length>0){let e=1,t="",s="",i="";for(let a=0;a<this.objEmpFilter.CostCenterFilters.length;a++){let l=this.objEmpFilter.CostCenterFilters[a];if(l.CostCenterID>5e4&&(e=2,t="NodeID",s=50051==l.CostCenterID?"EmpSeqNo":"CCNID"+(l.CostCenterID-5e4)),l.SelectedNodes.length>0){if(1==l.SelectedNodes.length)i+=" AND ",i+=s+"="+l.SelectedNodes[0].Id;else if(!l.SelectedNodes.find(t=>t.Id==e&&t.IsGroup))if(i+=" AND ",D.IPrefetchFilter.IsGroupTree(l)){let e="";for(let t=0;t<l.SelectedNodes.length;t++)null!=l.SelectedNodes[t].Parent&&l.SelectedNodes[t].Parent.IsSelected||(e.length>0&&(e+=","),e+=l.SelectedNodes[t].Id);0==e.length&&(e+=-12912),i+=s+" IN ",i+=" (select T."+t+" GTID from "+u.b.GetTagTableName(l.CostCenterID)+" T with(nolock),"+u.b.GetTagTableName(l.CostCenterID)+" GTP with(nolock) where T.lft BETWEEN GTP.lft AND GTP.rgt AND GTP."+t+" IN ",i+=e.toString()+")  group by T."+t+")"}else{i+=s+" IN (";for(let e=0;e<l.SelectedNodes.length;e++)e>0&&(i+=","),i+=l.SelectedNodes[e].Id;i+=")"}}else l.DeleteButtonVisibility||(i+=" AND ",i+=s+"=-12912")}this.sFilter=i.toString()}if(this.objEmpFilter.Filter>0){this.sFilter+=" AND ( CONVERT(DATETIME,EMP.DOJ) <='"+l.a.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy")+"' AND CONVERT(DATETIME,EMP.DORelieve)  >='"+l.a.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"' ) ","True"==l.a.SessionManager.Preferences.NPDontAllowPayrollProcessing&&(this.sFilter+=" AND EmpSeqNo NOT IN ( Select NodeID From COM_CC50051 WITH(NOLOCK) \n                        Where ResignStatus='Posted' AND DateDiff(day,ISNULL(CONVERT(DATETIME,DORelieve),'01-Jan-9000'),'"+l.a.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"')<=0\n                        AND DateDiff(day,CONVERT(DATETIME,CONVERT(DATETIME,('01-'+CONVERT(NVARCHAR(3),DATENAME(MONTH,ISNULL(CONVERT(DATETIME,DOResign),'01-Jan-9000')))+'-'+CONVERT(NVARCHAR,YEAR(ISNULL(CONVERT(DATETIME,DOResign),'01-Jan-9000'))))) ),'"+l.a.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"')>=0 )"),"True"==l.a.SessionManager.Preferences.DontConsiderEmpsForPayroll&&parseInt(l.a.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)>0&&(this.sFilter+=" AND NOT ( MONTH(CONVERT(DATETIME,EMP.DOJ))="+l.a.SessionManager.PayrollMonth.iMonth()+" AND YEAR(CONVERT(DATETIME,EMP.DOJ))="+l.a.SessionManager.PayrollMonth.getFullYear()+" AND DAY(CONVERT(DATETIME,EMP.DOJ))>="+parseInt(l.a.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)+" ) "),l.a.SessionManager.LocationID>0&&l.a.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&l.a.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(this.sFilter+=" AND EmpSeqNo IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+l.a.SessionManager.LocationID+")"),d.e.IsEmpty(l.a.SessionManager.sWHEmpFilteredEmpSeqNos)||(this.sFilter+="  AND EmpSeqNo IN ("+l.a.SessionManager.sWHEmpFilteredEmpSeqNos+")"),"Processed"==this.objEmpFilter.StatusModes.SelectedValue?this.sFilter+=" AND EmpSeqNo IN (SELECT DISTINCT C51.NODEID FROM INV_DocDetails I\n                                                    JOIN COM_DocCCData CC ON CC.InvDocDetailsID=I.InvDocDetailsID\n                                                    JOIN COM_CC50051 C51 ON C51.NODEID=CC.DCCCNID51\n                                                    WHERE I.CostCenterID=40054  AND  CONVERT(DATETIME,I.DueDate)=CONVERT(DATETIME,'"+l.a.SessionManager.PayrollMonth.ToString("dd MMM yyyy")+"'))":"UnProcessed"==this.objEmpFilter.StatusModes.SelectedValue&&(this.sFilter+=" AND EmpSeqNo NOT IN (SELECT DISTINCT C51.NODEID FROM INV_DocDetails I\n                                                    JOIN COM_DocCCData CC ON CC.InvDocDetailsID=I.InvDocDetailsID\n                                                    JOIN COM_CC50051 C51 ON C51.NODEID=CC.DCCCNID51\n                                                    WHERE I.CostCenterID=40054  AND  CONVERT(DATETIME,I.DueDate)=CONVERT(DATETIME,'"+l.a.SessionManager.PayrollMonth.ToString("dd MMM yyyy")+"'))");let e=l.a.SessionManager.Preferences.ConsolidateMonthlyPayrollSort;""!=e.Trim()&&"None"!=e&&(this.sFilter+="TreeView"==e?" ORDER BY EMP.lft ":" ORDER BY EMP."+e);let t=[];t.push(l.a.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy")),t.push(this.sFilter),t.push(0),t.push(l.a.SessionManager.RoleID),t.push(l.a.SessionManager.UserID),t.push(l.a.SessionManager.LanguageID);let s=l.a.empService.GetData(t,"spPAY_GetEmpMasterCCDetails");if(this.btnClear_Click(),null!=s&&s.Tables.length>0&&s.Tables[0].length>0)for(let i=0;i<s.Tables[0].length;i++){let e,t=this.dgvEmployees.NewRow();t.EmpSeqNo=s.Tables[0][i].EmpSeqNo,t.EmpCode=s.Tables[0][i].EmpCode,t.EmpName=s.Tables[0][i].EmpName,t.SNo=(i+1).toString(),t.Select=!1;let a="";for(let s=0;s<this.dgvEmployees.TableColumns.length;s++)a=this.dgvEmployees.TableColumns[s],(a.startsWith("dcAlpha")||a.startsWith("dcCCNID"))&&(e=this.dsDocDesig.Tables[0].filter(e=>e.SysColumnName==a),null!=e&&e.length>0&&(d.e.IsEmpty(e[0].UserColumnType)||("LISTBOX"==e[0].UserColumnType.toString().toUpperCase()?d.e.IsEmpty(e[0].UserDefaultValue)||(t[a+"_Key"]=e[0].UserDefaultValue.toString()):"TEXT"==e[0].UserColumnType.toString().toUpperCase()||"COMBOBOX"==e[0].UserColumnType.toString().toUpperCase()?d.e.IsEmpty(e[0].UserDefaultValue)||(t[a]=e[0].UserDefaultValue.toString()):"DATE"==e[0].UserColumnType.toString().toUpperCase()&&(d.e.IsEmpty(e[0].UserDefaultValue)||"TODAY"==e[0].UserDefaultValue.toString().toUpperCase()&&(t[a]=(new Date).ToString(l.a.SessionManager.Preferences["Date Format"]),this.dgvEmployees.TableColumns.Contains(a+"_Key")&&(t[a+"_Key"]=new Date))))));this.dgvEmployees.addRow(t),this.dgvEmployees.RefreshGrid=!0}}}}),Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting Filter_Click()")}bgworker_DoWork(e,t){Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering bgworker_DoWork()"),"PROCESS"==this.sBGWorkType?this.ProcessPayrollData():"POST"==this.sBGWorkType?this.PostPayrollData():"UNPOST"==this.sBGWorkType?this.UnPostPayrollData():"LOAD"==this.sBGWorkType&&this.LoadXLData(this.objCMPLData),this.dgvEmployees.UpdateTotals(),Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting bgworker_DoWork()")}ProcessPayrollData(){Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering ProcessPayrollData()"),this.InProgress="";let e=0,t=0;if(null!=this.dgvEmployees.Table&&this.dgvEmployees.Table.length>0){this.lstSelectedEmps=new Array;let s="";for(let e=0;e<this.dgvEmployees.Table.length;e++)Object(p.j)(this.dgvEmployees.Table[e].Select)&&(s+=this.dgvEmployees.Table[e].EmpSeqNo.toString()+",",this.lstSelectedEmps.push(e),t++);if(s.length>0&&t>0){if(s=s.substr(0,s.length-1),e=t,this.FailedCount=0,this.Failed="",this.ProgressVisibility=!0,this.ProgressValue=0,this.ProgressMax=e,this.ProgressMessage="Payroll is processing, please wait ...",this.oCMP=new E.a,this.oCMP.oParent=this,this.oCMP.sSelectedEmpSeqNos=s,this.oCMP.PayrollMonth=l.a.SessionManager.PayrollMonth,this.oCMP.PayrollMonthStart=l.a.SessionManager.PayrollMonthStart,this.oCMP.PayrollMonthEnd=l.a.SessionManager.PayrollMonthEnd,this.oCMP.ProcessPayroll(),this.oCMP.IsCompleted){for(this.ProgressValue=0,this.ProgressMax=e,this.ProgressMessage="Filling data, please wait ...",this.iEmpIndex=0;this.iEmpIndex<this.oCMP.arrLstOthMPFields.length;this.iEmpIndex++)if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage.length>0){if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage.endsWith("NumFields"))return this.DisplayMessage=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage.Replace("NumFields",""),void(this.MessageVisibility=!0);this.strResult=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage,this.Failed+=this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpCode+",",this.FailedCount++,this.dgvEmployees.Table[this.lstSelectedEmps[this.iEmpIndex]].Result=this.strResult}else{this.strResult="",this.CalculateAccruals(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo);let t=null;if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].IsAlreadyProcessed){if(null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&(t=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[6].filter(e=>e.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&11==e.VoucherType)),this.IsProcessWithArrears){if(null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&null!=t&&t.length>0)if(d.e.IsEmpty(t[0].dcAlpha21)||""==d.e.String(t[0].dcAlpha21).Trim())this.CalculateArrears(parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo));else{null!=t[0].dcAlpha21&&null!=t[0].dcAlpha21&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths=t[0].dcAlpha21.toString()),null!=t[0].dcAlpha22&&null!=t[0].dcAlpha22&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrCalcMonthPaydays=t[0].dcAlpha22.toString());let e=l.a.common.GetDataTable("PAY099",new Date(l.a.SessionManager.PayrollMonth).ToString("dd MMM yyyy"));if(null!=e&&e.length>0){let t=l.a.common.GetDataTable("PAY100",this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo);for(let s=0;s<e.length;s++){let i=new Date(e[s].ArrearsCalcMonths);if(null!=t&&t.length>0){let e=t.filter(e=>e.ArrAdjMonth==i);if(null!=e&&e.length>0){for(let t=0;t<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;t++)null!=e[0]["Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][t].SNo]&&null!=e[0]["Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][t].SNo]&&""!=e[0]["Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][t].SNo].toString()&&(this.oCMP.arrLstCPFields[this.iEmpIndex][0][t].ArrData+=i.ToString("dd MMM yyyy")+","+parseFloat(e[0]["Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][t].SNo])+",");for(let t=0;t<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;t++)null!=e[0]["Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][t].SNo]&&null!=e[0]["Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][t].SNo]&&""!=e[0]["Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][t].SNo].toString()&&(this.oCMP.arrLstCPFields[this.iEmpIndex][2][t].ArrData+=i.ToString("dd MMM yyyy")+","+parseFloat(e[0]["Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][t].SNo])+",")}}}}}}else if(null!=t&&t.length>0){for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;e++)this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].dArrear="0";for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;e++)this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].dArrear="0";this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarArrears=0,this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedArrears=0,this.oCMP.iEmpIndex=this.iEmpIndex,this.oCMP.othMPField=this.oCMP.arrLstOthMPFields[this.iEmpIndex],this.oCMP.ExecuteAllFormulas(),this.oCMP.CalculateNet(),null!=t[0].dcAlpha21&&null!=t[0].dcAlpha21&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths=""),null!=t[0].dcAlpha22&&null!=t[0].dcAlpha22&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrCalcMonthPaydays="")}}else this.IsProcessWithArrears&&this.CalculateArrears(parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo));this.FillProcessedData(this.lstSelectedEmps[this.iEmpIndex]),this.ProgressValue=this.iEmpIndex+1,this.InProgress=this.iEmpIndex+1+" of "+e}this.MessageVisibility=!0,this.FailedCount>0&&this.Failed.length>1?(this.Failed=this.Failed.substr(0,this.Failed.length-1),this.DisplayMessage="Failed count : "+this.FailedCount+", Emp.Codes : ( "+this.Failed+" )"):null!=this.dgvEmployees&&null!=this.dgvEmployees.Table&&this.dgvEmployees.Table.length>0&&this.dgvEmployees.Table.filter(e=>Object(p.j)(e.Select)).length>0&&(this.DisplayMessage="Processed Successfully")}}else this.DisplayMessage="Select atleast one Employee."}else this.DisplayMessage="No Employees found to process payroll.";this.MessageVisibility=!0,this.CheckViewForUser(0),Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting ProcessPayrollData()")}CalculateArrears(e){try{Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering CalculateArrears()"),this.dtArrData=[];let t=new Array,s=l.a.common.GetDataSet3("PAY077",e.toString(),l.a.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy"),"");if(null!=s&&s.Tables[0].length>0){let e=new Date(s.Tables[0][0].DtApplyFrom.toString()),i=new Date(s.Tables[0][0].DtEffectFrom.toString()),a=s.Tables[1][0].ArrCalcMonths.toString();if(i>e&&l.a.SessionManager.PayrollMonth>=i){let s=e;for(;s<i;)a.Contains(s.ToString("dd/MMM/yyyy"))||t.push(s.ToString("dd/MMM/yyyy")),s=s.AddMonths(1)}}if(t.length>0){let s,i,a="";for(let e=0;e<t.length;e++)a.length>0&&(a+=";"),a+=t[e],s={},s.PayrollMonth=t[e],this.dtArrData.push(s);let o="'"+a.Replace(";","','")+"'",n=l.a.common.GetDataSet3("PAY079",e.toString(),o).Tables[0];if(null!=n&&n.length>0){i=n.filter(e=>11==e.VoucherType);for(let e=0;e<i.length;e++)this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrCalcMonthPaydays.length>0&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrCalcMonthPaydays+=";"),this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrCalcMonthPaydays=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrCalcMonthPaydays+d.e.String(i[e].PaidDays)}this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths=a;let r=a.split(";");if(r.length>0){for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;e++)this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].dArrear="0";for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;e++)this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].dArrear="0";this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarArrears=0,this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedArrears=0;let t,s,a=l.a.common.GetDataTable("PAY098",""),o=l.a.common.GetDataSet3("PAY101",e.toString(),l.a.SessionManager.PayrollMonth.ToString("dd MMM yyyy")),h=0;for(let C=0;C<r.length;C++)if(null!=r[C]&&""!=r[C]&&(i=n.filter(e=>e.PayrollMonth=="'"+r[C]+"'"),i.length>0)){let m=a.filter(e=>e.GradeID==i[0].dcCCNID53&&e.CPayrollDate<=r[C]).Compute("max","CPayrollDate"),p=a.filter(e=>e.GradeID==i[0].dcCCNID53&&e.CPayrollDate==m.toString()),c=new E.a;if(c.oParent=this,c.sSelectedEmpSeqNos=e.toString(),c.PayrollMonth=l.a.SessionManager.PayrollMonth,c.PayrollMonthStart=l.a.SessionManager.PayrollMonthStart,c.PayrollMonthEnd=l.a.SessionManager.PayrollMonthEnd,c.drcArrStructure=p,c.IsArrearclick=!0,c.ArrGradeID=parseInt(i[0].dcCCNID53),c.ProcessPayroll(),c.IsCompleted){c.arrLstOthMPFields[0].TotalDays=parseFloat(i[0].TotalDays),c.arrLstOthMPFields[0].MonthDays=parseFloat(i[0].TotalDays),c.arrLstOthMPFields[0].TotalLeaves=parseFloat(i[0].LeavesTaken),c.arrLstOthMPFields[0].WeeklyOffs=parseFloat(i[0].WOffs),c.arrLstOthMPFields[0].Holidays=parseFloat(i[0].Holidays);let e=parseFloat(i[0].TotalDays.toString())-parseFloat(i[0].LOPDays.toString())-parseFloat(i[0].LeavesTaken.toString())-parseFloat(i[0].UnpaidDays.toString());t=o.Tables[0].filter(e=>e.AdjMonth==new Date(r[C])),null!=t&&t.length>0&&(e+=parseFloat(t[0].Days)),s=o.Tables[1].filter(e=>2==e.DType&&e.ArrAdjMonth==new Date(r[C])),c.SetDaysAttended(0,"Days Attended",e);let a=0,m=-1,p=0;i=n.filter(e=>e.PayrollMonth=="'"+r[C]+"'"&&11==e.VoucherType);for(let t=0;t<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;t++)if(null==this.oCMP.arrLstCPFields[this.iEmpIndex][0][t].CalculateArrears||""==this.oCMP.arrLstCPFields[this.iEmpIndex][0][t].CalculateArrears||"No"!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][t].CalculateArrears)for(let e=0;e<c.arrLstCPFields[0][0].length;e++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][0][t].SNo==c.arrLstCPFields[0][0][e].SNo){p=0,h=0,m=this.oCMP.arrLstCPFields[this.iEmpIndex][0][t].SNo,d.e.IsEmpty(i[0]["dcCalcNum"+m])||(p=parseFloat(i[0]["dcCalcNum"+m])),null!=s&&s.length>0&&(d.e.IsEmpty(s[0]["Earning"+m])||(h=parseFloat(s[0]["Earning"+m]))),a=parseFloat(c.arrLstCPFields[0][0][e].dEarned)-p-h,this.oCMP.arrLstCPFields[this.iEmpIndex][0][t].ArrData+=r[C]+","+a+",",this.oCMP.arrLstCPFields[this.iEmpIndex][0][t].dArrear=(parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][0][t].dArrear)+a).ToString(l.a.SessionManager.sPayrollDecimals),this.oCMP.arrLstCPFields[this.iEmpIndex][0][t].isArrCalculated=!0,null==this.oCMP.arrLstCPFields[this.iEmpIndex][0][t].AddToNet||""==this.oCMP.arrLstCPFields[this.iEmpIndex][0][t].AddToNet||"Net"!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][t].AddToNet&&"NetAndTax"!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][t].AddToNet||(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarArrears+=a);break}i=n.filter(e=>e.PayrollMonth=="'"+r[C]+"'"&&12==e.VoucherType);for(let t=0;t<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;t++)if(null==this.oCMP.arrLstCPFields[this.iEmpIndex][2][t].CalculateArrears||""==this.oCMP.arrLstCPFields[this.iEmpIndex][2][t].CalculateArrears||"No"!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][t].CalculateArrears)for(let e=0;e<c.arrLstCPFields[0][2].length;e++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][2][t].SNo==c.arrLstCPFields[0][2][e].SNo){p=0,h=0,m=this.oCMP.arrLstCPFields[this.iEmpIndex][2][t].SNo,null!=i[0]["dcCalcNum"+m]&&null!=i[0]["dcCalcNum"+m]&&""!=i[0]["dcCalcNum"+m].toString()&&(p=parseFloat(i[0]["dcCalcNum"+m])),null!=s&&s.length>0&&null!=s[0]["Deduction"+m]&&null!=s[0]["Deduction"+m]&&""!=s[0]["Deduction"+m].toString()&&(h=parseFloat(s[0]["Deduction"+m])),a=parseFloat(c.arrLstCPFields[0][2][e].dEarned)-p-h,this.oCMP.arrLstCPFields[this.iEmpIndex][2][t].ArrData+=r[C]+","+a+",",this.oCMP.arrLstCPFields[this.iEmpIndex][2][t].dArrear=(parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][2][t].dArrear)+a).ToString(l.a.SessionManager.sPayrollDecimals),this.oCMP.arrLstCPFields[this.iEmpIndex][2][t].isArrCalculated=!0,null==this.oCMP.arrLstCPFields[this.iEmpIndex][2][t].AddToNet||""==this.oCMP.arrLstCPFields[this.iEmpIndex][2][t].AddToNet||"Net"!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][t].AddToNet&&"NetAndTax"!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][t].AddToNet||(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedArrears+=a);break}}c.IsArrearclick=!1}let m="",p="";m=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrCalcMonthPaydays,p=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths,this.oCMP.iEmpIndex=this.iEmpIndex,this.oCMP.othMPField=this.oCMP.arrLstOthMPFields[this.iEmpIndex],this.oCMP.ExecuteAllFormulas(),this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrCalcMonthPaydays=m,this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths=p,this.oCMP.CalculateNet(),this.FillProcessedData(this.lstSelectedEmps[this.iEmpIndex])}}Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting CalculateArrears()")}catch(t){Logger.ErrorLog("ConsolidatedMonthlyPayrollViewModel::EXCEPTION btnArrears_Click()\r\n"+t.Message+"\r\n"+t.stack)}}CalculateAccruals(e){let t=this.oCMP.arrLstOthMPFields[0].dsAllEmpsData.Tables[2];if(t=t.filter(t=>t.EmpSeqNo==e),t.length>0&&new Date(t[0].cEffectFrom).getFullYear()==l.a.SessionManager.PayrollMonth.getFullYear()&&new Date(t[0].cEffectFrom).iMonth()==l.a.SessionManager.PayrollMonth.iMonth()&&this.oCMP.lstAccrAccumulateSNos.length>0){let t="",s=0,i=0,a=0,o=0,n=0,r=0,h=0,d=0,m=0,p=-1;for(let e=0;e<this.oCMP.lstAccrAccumulateSNos.length;e++)t.length>0&&(t+=","),t+="ISNULL(dcCalcNum"+this.oCMP.lstAccrAccumulateSNos[e]+",0) as dcCalcNum"+this.oCMP.lstAccrAccumulateSNos[e]+",ISNULL(dcCalcNumFC"+this.oCMP.lstAccrAccumulateSNos[e]+",0) as dcCalcNumFC"+this.oCMP.lstAccrAccumulateSNos[e];let C=l.a.empService.GetQueryData(e,"CONS002",JSON.stringify(t),l.a.SessionManager.PayrollMonth.ToString("dd MMM yyyy"),"");if(null!=C&&C.length>0)for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;e++)if(i=0,a=0,this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].IsAccrualType&&"Accruals-AccumulateForPreviousYears"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].Behaviour){p=this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].SNo,s=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].dActual);for(let e=0;e<C.length;e++)n=parseFloat(C[e].TotalDays),o=parseFloat(C[e].DaysAttended)+parseFloat(C[e].PaidLeaves)+parseFloat(C[e].LOPDays),r=parseFloat(C[e]["dcCalcNum"+p]),h=parseFloat(C[e]["dcCalcNumFC"+p]),d=parseFloat((o/n*s).ToString(l.a.SessionManager.sPayrollDecimals)),m=parseFloat((d-r).ToString(l.a.SessionManager.sPayrollDecimals)),i+=parseFloat(m.ToString(l.a.SessionManager.sPayrollDecimals)),a+=h;this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].dAdjusted=(i-a).ToString(l.a.SessionManager.sPayrollDecimals)}}}FillProcessedData(e){if(Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering FillProcessedData()"),null!=this.oCMP&&this.oCMP.IsCompleted&&!(this.iEmpIndex>this.oCMP.arrLstOthMPFields.length-1)){if(this.oCMP.arrLstCPFields[this.iEmpIndex][0].length>0)for(let t=0;t<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;t++)this.dgvEmployees.TableColumns.Contains("Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][t].SNo)&&(this.dgvEmployees.Table[e]["Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][t].SNo]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][0][t].dEarned).ToString(l.a.SessionManager.sPayrollDecimals)),this.dgvEmployees.TableColumns.Contains("Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][t].SNo+"_Arr")&&(this.dgvEmployees.Table[e]["Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][t].SNo+"_Arr"]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][0][t].dArrear).ToString(l.a.SessionManager.sPayrollDecimals));if(this.oCMP.arrLstCPFields[this.iEmpIndex][1].length>0)for(let t=0;t<this.oCMP.arrLstCPFields[this.iEmpIndex][1].length;t++)this.dgvEmployees.TableColumns.Contains("EarningOTHrs"+this.oCMP.arrLstCPFields[this.iEmpIndex][1][t].SNo)&&(this.dgvEmployees.Table[e]["EarningOTHrs"+this.oCMP.arrLstCPFields[this.iEmpIndex][1][t].SNo]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][1][t].dActual).ToString(l.a.SessionManager.sPayrollDecimals2)),this.dgvEmployees.TableColumns.Contains("EarningOTAmt"+this.oCMP.arrLstCPFields[this.iEmpIndex][1][t].SNo)&&(this.dgvEmployees.Table[e]["EarningOTAmt"+this.oCMP.arrLstCPFields[this.iEmpIndex][1][t].SNo]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][1][t].dEarned).ToString(l.a.SessionManager.sPayrollDecimals));if(this.oCMP.arrLstCPFields[this.iEmpIndex][2].length>0)for(let t=0;t<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;t++)this.dgvEmployees.TableColumns.Contains("Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][t].SNo)&&(this.dgvEmployees.Table[e]["Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][t].SNo]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][2][t].dEarned).ToString(l.a.SessionManager.sPayrollDecimals)),this.dgvEmployees.TableColumns.Contains("Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][t].SNo+"_Arr")&&(this.dgvEmployees.Table[e]["Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][t].SNo+"_Arr"]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][2][t].dArrear).ToString(l.a.SessionManager.sPayrollDecimals));if(this.oCMP.arrLstCPFields[this.iEmpIndex][3].length>0)for(let t=0;t<this.oCMP.arrLstCPFields[this.iEmpIndex][3].length;t++)this.dgvEmployees.TableColumns.Contains("DeductionOTHrs"+this.oCMP.arrLstCPFields[this.iEmpIndex][3][t].SNo)&&(this.dgvEmployees.Table[e]["DeductionOTHrs"+this.oCMP.arrLstCPFields[this.iEmpIndex][3][t].SNo]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][3][t].dActual).ToString(l.a.SessionManager.sPayrollDecimals2)),this.dgvEmployees.TableColumns.Contains("DeductionOTAmt"+this.oCMP.arrLstCPFields[this.iEmpIndex][3][t].SNo)&&(this.dgvEmployees.Table[e]["DeductionOTAmt"+this.oCMP.arrLstCPFields[this.iEmpIndex][3][t].SNo]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][3][t].dEarned).ToString(l.a.SessionManager.sPayrollDecimals));if(this.oCMP.arrLstCPFields[this.iEmpIndex][4].length>0)for(let t=0;t<this.oCMP.arrLstCPFields[this.iEmpIndex][4].length;t++)this.dgvEmployees.TableColumns.Contains("Loan"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][t].SNo)&&null!=this.oCMP.arrLstCPFields[this.iEmpIndex][4][t].LoanInstAmt&&(this.dgvEmployees.Table[e]["Loan"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][t].SNo]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][4][t].LoanInstAmt).ToString(l.a.SessionManager.sPayrollDecimals));if(this.oCMP.arrLstCPFields[this.iEmpIndex][5].length>0)for(let t=0;t<this.oCMP.arrLstCPFields[this.iEmpIndex][5].length;t++)this.dgvEmployees.TableColumns.Contains("Leave"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][t].SNo)&&(this.dgvEmployees.Table[e]["Leave"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][t].SNo]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][5][t].LeaveTaken).ToString(l.a.SessionManager.sPayrollDecimals));if(this.oCMP.arrLstCPFields[this.iEmpIndex][6].length>0)for(let t=0;t<this.oCMP.arrLstCPFields[this.iEmpIndex][6].length;t++)if(this.dgvEmployees.TableColumns.Contains(this.oCMP.arrLstCPFields[this.iEmpIndex][6][t].ExtraFieldName))if("LISTBOX"==this.oCMP.arrLstCPFields[this.iEmpIndex][6][t].ExtraFieldDataType){if("EMPTY"!=this.oCMP.arrLstCPFields[this.iEmpIndex][6][t].ExtraFieldValue&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][6][t].ExtraFieldValue){let s=l.a.SessionManager.dtFeatures.filter(e=>e.FeatureID==parseInt(this.oCMP.arrLstCPFields[this.iEmpIndex][6][t].ExtraFieldName.Replace("dcCCNID",""))+5e4);if(null!=s&&s.length>0){let i=l.a.empService.GetQueryData(this.oCMP.arrLstCPFields[this.iEmpIndex][6][t].ExtraFieldValue,"CONS001",s[0].TableName.toString(),"","");null!=i&&i.length>0&&(this.dgvEmployees.Table[e][this.oCMP.arrLstCPFields[this.iEmpIndex][6][t].ExtraFieldName]=i[0].Name.toString(),this.dgvEmployees.Table[e][this.oCMP.arrLstCPFields[this.iEmpIndex][6][t].ExtraFieldName+"_Key"]=this.oCMP.arrLstCPFields[this.iEmpIndex][6][t].ExtraFieldValue)}}}else"DATE"==this.oCMP.arrLstCPFields[this.iEmpIndex][6][t].ExtraFieldUserColumnType?"EMPTY"!=this.oCMP.arrLstCPFields[this.iEmpIndex][6][t].ExtraFieldValue&&(d.e.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][6][t].ExtraFieldValue)||(this.dgvEmployees.Table[e][this.oCMP.arrLstCPFields[this.iEmpIndex][6][t].ExtraFieldName]=this.oCMP.arrLstCPFields[this.iEmpIndex][6][t].ExtraFieldValue,d.e.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][6][t].ExtraFieldValue)||(this.dgvEmployees.Table[e][this.oCMP.arrLstCPFields[this.iEmpIndex][6][t].ExtraFieldName+"_Key"]=new Date(this.oCMP.arrLstCPFields[this.iEmpIndex][6][t].ExtraFieldValue)))):"EMPTY"!=this.oCMP.arrLstCPFields[this.iEmpIndex][6][t].ExtraFieldValue&&(this.dgvEmployees.Table[e][this.oCMP.arrLstCPFields[this.iEmpIndex][6][t].ExtraFieldName]=this.oCMP.arrLstCPFields[this.iEmpIndex][6][t].ExtraFieldValue);this.dgvEmployees.TableColumns.Contains("MonthDays")&&(this.dgvEmployees.Table[e].MonthDays=this.oCMP.arrLstOthMPFields[this.iEmpIndex].TotalDays.ToString("0.0")),this.dgvEmployees.TableColumns.Contains("DaysAttended")&&(this.dgvEmployees.Table[e].DaysAttended=this.oCMP.arrLstOthMPFields[this.iEmpIndex].DaysAttended.ToString("0.0")),this.dgvEmployees.TableColumns.Contains("TotalLeaves")&&(this.dgvEmployees.Table[e].TotalLeaves=this.oCMP.arrLstOthMPFields[this.iEmpIndex].TotalLeaves.ToString("0.0")),this.dgvEmployees.TableColumns.Contains("PaidLeaves")&&(this.dgvEmployees.Table[e].PaidLeaves=this.oCMP.arrLstOthMPFields[this.iEmpIndex].PaidLeaves.ToString("0.0")),this.dgvEmployees.TableColumns.Contains("WeeklyOffs")&&(this.dgvEmployees.Table[e].WeeklyOffs=this.oCMP.arrLstOthMPFields[this.iEmpIndex].WeeklyOffs.ToString("0.0")),this.dgvEmployees.TableColumns.Contains("Holidays")&&(this.dgvEmployees.Table[e].Holidays=this.oCMP.arrLstOthMPFields[this.iEmpIndex].Holidays.ToString("0.0")),this.dgvEmployees.TableColumns.Contains("LOPDays")&&(this.dgvEmployees.Table[e].LOPDays=this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays.ToString("0.0")),this.dgvEmployees.TableColumns.Contains("UnpaidDays")&&(this.dgvEmployees.Table[e].UnpaidDays=this.oCMP.arrLstOthMPFields[this.iEmpIndex].UnpaidDays.ToString("0.0")),this.dgvEmployees.TableColumns.Contains("TotalDays")&&(this.dgvEmployees.Table[e].TotalDays=this.oCMP.arrLstOthMPFields[this.iEmpIndex].TotalDays.ToString("0.0")),this.dgvEmployees.TableColumns.Contains("Basic")&&(this.dgvEmployees.Table[e].Basic=this.oCMP.arrLstOthMPFields[this.iEmpIndex].BasicMonthly.ToString(l.a.SessionManager.sPayrollDecimals)),this.dgvEmployees.TableColumns.Contains("TotalEarnings")&&(this.dgvEmployees.Table[e].TotalEarnings=this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarnings.ToString(l.a.SessionManager.sPayrollDecimals)),this.dgvEmployees.TableColumns.Contains("TotalDeductions")&&(this.dgvEmployees.Table[e].TotalDeductions=(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDeductions+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totLoans).ToString(l.a.SessionManager.sPayrollDecimals)),this.dgvEmployees.TableColumns.Contains("NetSalary")&&(this.dgvEmployees.Table[e].NetSalary=this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary.ToString(l.a.SessionManager.sPayrollDecimals)),this.dgvEmployees.updateRow(this.dgvEmployees.Table[e]),this.dgvEmployees.UpdateTotals(),Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting FillProcessedData()")}}CheckViewForUser(e){if(null!=this.dsDocDesig&&this.dsDocDesig.Tables.length>6&&this.dsDocDesig.Tables[6].length>0)for(let t=0;t<this.dgvEmployees.Columns.length;t++)this.SetView(this.dgvEmployees.Columns[t])}SetView(e){let t=this.dsDocDesig.Tables[6],s=this.dsDocDesig.Tables[0];t=t.filter(e=>1==e.Mode||2==e.Mode||3==e.Mode||4==e.Mode),e instanceof y.a&&(t=e.CrRefColID>0?t.filter(t=>t.CostCenterColID==1e6+e.CrRefColID):null!=e.CrRefColName&&""!=e.CrRefColName&&e.CrRefColName.startsWith("dcAlpha")?t.filter(t=>t.SysColumnName==e.CrRefColName):[]),t.length>0?(e instanceof y.a&&(e.IsVisible=Object(p.j)(t[0].IsVisible.toString())),d.e.IsEmpty(t[0].IsMandatory)||e instanceof y.a&&(e.Mandatory=Object(p.j)(t[0].IsMandatory)),e instanceof y.a&&(e.ReadOnly=!Object(p.j)(t[0].IsEditable)),e instanceof y.a&&(e.Expression=d.e.String(t[0].Expression)),e instanceof y.a&&(e.Message=d.e.String(t[0].FailureMessage)),d.e.IsEmpty(t[0].ActionOptionID)?e instanceof y.a&&(e.Action=0):e instanceof y.a&&(e.Action=parseInt(t[0].ActionOptionID)),d.e.IsEmpty(t[0].NumFieldEditOptionID)?e instanceof y.a&&(e.EditOption=0):e instanceof y.a&&(e.EditOption=parseInt(t[0].NumFieldEditOptionID.toString()))):(e instanceof y.a&&(s="combobox"==e.DataType.toLowerCase()?s.filter(t=>t.SysColumnName==e.ValueBinding):s.filter(3==e.CostCenterID||2==e.CostCenterID?t=>t.CostcenterColid==e.ID:t=>t.SysColumnName==e.DisplayMember)),s.length>0&&(e instanceof y.a&&(l.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&"True"==l.a.SessionManager.Preferences.EnableDivisionWise.toString()&&50001==e.CostCenterID||l.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==l.a.SessionManager.Preferences.EnableLocationWise.toString()&&50002==e.CostCenterID||(e.ReadOnly=!Object(p.j)(s[0].IsEditable.toString()))),d.e.IsEmpty(s[0].IsMandatory)||e instanceof y.a&&(e.Mandatory=Object(p.j)(s[0].IsMandatory)),e instanceof y.a&&(e.IsVisible=Object(p.j)(s[0].IsVisible.toString()))),e instanceof y.a&&(e.EditOption=0),e instanceof y.a&&(e.Expression=""),e instanceof y.a&&(e.Message=""),e instanceof y.a&&(e.Action=0))}UnPostPayrollData(){Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering UnPostPayrollData()"),this.InProgress="";let e=0,t=0;if(null!=this.dgvEmployees.Table&&this.dgvEmployees.Table.length>0){this.lstSelectedEmps=new Array;let s="";for(let e=0;e<this.dgvEmployees.Table.length;e++)Object(p.j)(this.dgvEmployees.Table[e].Select)&&(s+=this.dgvEmployees.Table[e].EmpSeqNo.toString()+",",this.lstSelectedEmps.push(e),t++);if(s.length>0&&t>0){s=s.substr(0,s.length-1);let i,a=s.split(",");e=t,this.FailedCount=0,this.Failed="",this.ProgressVisibility=!0,this.ProgressValue=0,this.ProgressMax=e,this.ProgressMessage="Unposting Payroll, please wait ...";let o=l.a.common.GetDataSet3("PAY061",s,l.a.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")).Tables[0];for(let t=0;t<a.length;t++){if(this.strResult="",null!=a[t]&&""!=a[t]){if(i=o.filter(e=>e.EmpSeqNo==a[t]),null!=i&&i.length>0){let e=0,t=[];t.push(this.CostCenterID),t.push(parseInt(i[0].DocID)),t.push(1);let s=l.a.document.DeleteSelectedRows(t,e);this.strResult=s.Message,e=s.RetValue}else this.strResult="No Data exits to delete.",this.Failed+=this.dgvEmployees.Table[this.lstSelectedEmps[t]].EmpCode.toString()+",",this.FailedCount++;this.dgvEmployees.Table[this.lstSelectedEmps[t]].Result=this.strResult,this.dgvEmployees.updateRow(this.dgvEmployees.Table[this.lstSelectedEmps[t]])}this.ProgressValue=t+1,this.InProgress=t+1+" of "+e}this.FailedCount>0&&this.Failed.length>1?(this.Failed=this.Failed.substr(0,this.Failed.length-1),this.DisplayMessage="Failed count : "+this.FailedCount+", Emp.Codes : ( "+this.Failed+" )"):null!=this.dgvEmployees&&null!=this.dgvEmployees.Table&&this.dgvEmployees.Table.length>0&&this.dgvEmployees.Table.filter(e=>Object(p.j)(e.Select)).length>0&&(this.DisplayMessage="Unposted Successfully"),this.MessageVisibility=!0}else this.DisplayMessage="Select atleast one Employee."}else this.DisplayMessage="No Employees found to unpost payroll.";this.MessageVisibility=!0,Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting UnPostPayrollData()")}bgworker_RunWorkerCompleted(e,t){this.ProgressVisibility=!1,this.dgvEmployees.UpdateTotals(),this.dgvEmployees.RefreshGrid=!0,"PROCESS"==this.sBGWorkType?this.IsProcessed=!0:"POST"==this.sBGWorkType&&(this.IsProcessed=!1)}PostPayrollData(){Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering PostPayrollData()"),this.InProgress="";let e=0,t=0;if(null!=this.dgvEmployees.Table&&this.dgvEmployees.Table.length>0){for(let e=0;e<this.dgvEmployees.Table.length;e++)Object(p.j)(this.dgvEmployees.Table[e].Select)&&t++;if(t>0){e=t,this.FailedCount=0,this.Failed="",this.ProgressVisibility=!0,this.ProgressValue=0,this.ProgressMax=e,this.ProgressMessage="Posting data, please wait...";for(let t=0;t<this.dgvEmployees.Table.length;t++)if(Object(p.j)(this.dgvEmployees.Table[t].Select)){let s=this.oCMP.arrLstOthMPFields.find(e=>e.EmpSeqNo==this.dgvEmployees.Table[t].EmpSeqNo.toString());if(this.iEmpIndex=this.oCMP.arrLstOthMPFields.indexOf(s),this.iEmpIndex>=0){if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].IsAlreadyProcessed&&null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowID&&null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowID&&""!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowID.toString()&&parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowID)>0){let e=l.a.common.GetDataTable("PAY087",this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].INVDocDetailsID.toString()+",54,'"+l.a.SessionManager.UserName+"',40054,"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowID.toString()+","+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowLevel.toString()+","+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].StatusID.toString()+","+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].CreatedDate.toString()+","+l.a.SessionManager.UserID+","+l.a.SessionManager.RoleID);null!=e&&e.length>0&&(d.e.IsEmpty(e[0].CanApprove)||"TRUE"!=e[0].CanApprove.toString().toUpperCase())&&(369!=parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].StatusID)||l.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Posted Docs")?441!=parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].StatusID)||l.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Approved Docs")||(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage="Can't Edit Approved Document"):this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage="Can't Edit Posted Document")}this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage.length>0?(this.strResult=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage,this.Failed+=this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpCode+",",this.FailedCount++,this.dgvEmployees.Table[t].Result=this.strResult):(this.strResult="",this.SaveVoucher(),this.ProgressValue=this.iEmpIndex+1,this.InProgress=this.iEmpIndex+1+" of "+e)}this.IsProcessed=!1}this.MessageVisibility=!0,this.FailedCount>0&&this.Failed.length>1?(this.Failed=this.Failed.substr(0,this.Failed.length-1),this.DisplayMessage="Failed count : "+this.FailedCount+", Emp.Codes : ( "+this.Failed+" )"):null!=this.dgvEmployees&&null!=this.dgvEmployees.Table&&this.dgvEmployees.Table.length>0&&this.dgvEmployees.Table.filter(e=>Object(p.j)(e.Select)).length>0&&(this.DisplayMessage="Posted Successfully")}else this.DisplayMessage="Select atleast one Employee."}else this.DisplayMessage="No Employees found to post payroll.";this.MessageVisibility=!0,Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting PostPayrollData()")}ValidatePosting(){try{if(Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering IsValidated()"),null!=l.a.SessionManager.Preferences.PayrollProduct&&""!=l.a.SessionManager.Preferences.PayrollProduct&&(this.DefProdID=parseInt(l.a.SessionManager.Preferences.PayrollProduct)),0==this.DefProdID)return this.strResult+="Select any Default Payroll Product at Global Preferences",this.MessageVisibility=!0,!1;for(let e=0;e<this.dgvEmployees.Columns.length;e++)if(this.dgvEmployees.Columns[e].ID.startsWith("dcAlpha")&&!this.dgvEmployees.Columns[e].ID.endsWith("_Key")&&this.dgvEmployees.Columns[e].Mandatory&&"SELECTIONBOX"!=this.dgvEmployees.Columns[e].DataType&&""==d.e.String(this.dgvEmployees.Table[this.lstSelectedEmps[this.iEmpIndex]][this.dgvEmployees.Columns[e].ID]))return this.strResult+="Enter "+this.dgvEmployees.Columns[e].Header.toString(),this.MessageVisibility=!0,!1;return this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays<0?(this.strResult+="Days mismatch : Month days and Total days.",this.MessageVisibility=!0,!1):this.oCMP.arrLstOthMPFields[this.iEmpIndex].dblLeavesLOP>0&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays<this.oCMP.arrLstOthMPFields[this.iEmpIndex].dblLeavesLOP?(this.strResult+="Employee Should have atleast "+this.oCMP.arrLstOthMPFields[this.iEmpIndex].dblLeavesLOP+" LOP Days",this.MessageVisibility=!0,!1):this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary<0&&("False"==l.a.SessionManager.Preferences.CreateLoanIfNetSalLessThanZero||0==parseInt(l.a.SessionManager.Preferences.CreateLoanType))?(this.strResult+="Net Amount should be greater than or equal to zero.",this.MessageVisibility=!0,!1):(Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting IsValidated()"),!0)}catch(e){return Logger.ErrorLog("ConsolidatedMonthlyPayrollViewModel::EXCEPTION IsValidated()",e),!1}}SaveVoucher(){try{if(Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering btnPost_Click()"),this.ValidatePosting()){let e=0,t=[];t.push(this.CostCenterID),t.push(this.oCMP.arrLstOthMPFields[this.iEmpIndex].DocID),t.push(l.a.SessionManager.PayrollMonth.ToString("MMM'/'yyyy")+"-"),t.push(this.oCMP.arrLstOthMPFields[this.iEmpIndex].DocNo),t.push(Date.Today().ToString("dd/MMM/yyyy")),t.push(l.a.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")),t.push(""),t.push(this.GetDocumentXML()),t.push(""),t.push(""),t.push(""),t.push(this.GetActivityXML()),t.push("false"),l.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==l.a.SessionManager.Preferences.EnableLocationWise.toString()?t.push(l.a.SessionManager.LocationID>0?l.a.SessionManager.LocationID:1):t.push(0),l.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&"True"==l.a.SessionManager.Preferences.EnableDivisionWise.toString()?t.push(l.a.SessionManager.DivisionID>0?l.a.SessionManager.DivisionID:1):t.push(0),t.push(this.oCMP.arrLstOthMPFields[this.iEmpIndex].WID),t.push(l.a.SessionManager.RoleID),t.push(""),t.push(0),t.push(0),t.push(l.a.SessionManager.CompanyGUID),t.push(l.a.SessionManager.UserName),t.push(l.a.SessionManager.UserID),t.push(l.a.SessionManager.LanguageID),t.push(l.a.SessionManager.IsOffline);let s="",i="",a=l.a.document.SetTempInvDocumentPostPayroll(t);e=a.obj;let o=a;s=null!=o&&o.Tables.length>0&&o.Tables[o.Tables.length-1].length>0&&o.Columns[o.Tables.length-1].Contains("ErrorMessage")?o.Tables[o.Tables.length-1][0].ErrorMessage.toString():"Problem in processing your request,Please contact administrator.",e=a.obj,e>0?null!=o&&o.Tables.length>0&&o.Tables[o.Tables.length-1].length>0&&o.Columns[o.Tables.length-1].Contains("VoucherNo")&&(i=o.Tables[o.Tables.length-1][0].VoucherNo.toString()):null!=o&&o.Tables.length>0&&o.Tables[o.Tables.length-1].length>0&&o.Columns[o.Tables.length-1].Contains("ServerMessage")&&(this.Failed+=this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpCode+",",this.FailedCount++,e="-407"==o.Tables[o.Tables.length-1][0].ServerMessage.toString()?-407:-12345),this.strResult+=s,this.dgvEmployees.Table[this.lstSelectedEmps[this.iEmpIndex]].Result=this.strResult,this.dgvEmployees.updateRow(this.dgvEmployees.Table[this.lstSelectedEmps[this.iEmpIndex]])}else this.Failed+=this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpCode+",",this.FailedCount++;Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting btnPost_Click()")}catch(e){this.strResult+=e.message,Logger.ErrorLog("ConsolidatedMonthlyPayrollViewModel::EXCEPTION btnPost_Click()"+e.stack)}this.dgvEmployees.Table[this.lstSelectedEmps[this.iEmpIndex]].Result=this.strResult}GetDocumentXML(){let e,t="",s="",i="",a="",o="",n="",r=new Array,h=" dcAlpha1='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].BasicMonthly+"',dcAlpha3='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary+"',dcAlpha4='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].TotalDays+"',dcAlpha5='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].DaysAttended+"',dcAlpha6='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].TotalLeaves+"',dcAlpha7='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].WeeklyOffs+"',dcAlpha8='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].Holidays+"',dcAlpha9='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays+"',dcAlpha10='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].UnpaidDays+"',\n                    dcAlpha11='"+(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarnings+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totOTAmount)+"',dcAlpha12='"+(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDeductions+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totLoans)+"',dcAlpha13='0'";l.a.SessionManager.Preferences.ContainsKey("ShowPaymentModeselectionWhilePayrollProcessing")&&"True"==l.a.SessionManager.Preferences.ShowPaymentModeselectionWhilePayrollProcessing&&"Default"!=this.objEmpFilter.PaymentModes.SelectedValue?(h+=",dcAlpha14='"+this.objEmpFilter.PaymentModes.SelectedValue.toString()+"'",h+="Bank Transfer"==this.objEmpFilter.PaymentModes.SelectedValue?",dcAlpha15='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank.toString()+"',dcAlpha16='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].BankAccNo.toString()+"'":",dcAlpha15='',dcAlpha16=''"):(h+=",dcAlpha14='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].PaymentMode.toString()+"'","Bank Transfer"==this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].PaymentMode.toString()?h+=",dcAlpha15='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank.toString()+"',dcAlpha16='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].BankAccNo.toString()+"'":h+=",dcAlpha15='',dcAlpha16=''"),h+=",dcAlpha17='"+l.a.SessionManager.PayrollMonthStart.ToString("dd/MMM/yyyy")+"',dcAlpha18='"+l.a.SessionManager.PayrollMonthEnd.ToString("dd/MMM/yyyy")+"',\n                                dcAlpha19='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totOTHours+"',dcAlpha20='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totOTAmount+"',\n                                dcAlpha21='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths+"',dcAlpha22='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrCalcMonthPaydays+"' ",h+=",dcAlpha23='' ",h+=",dcAlpha24='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].PaidLeaves+"' ",h+=",dcAlpha25='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totActEarnings+"' ",h+=",dcAlpha26='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarArrears+"' ",h+=",dcAlpha27='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarAdjustments+"' ",h+=",dcAlpha28='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totActDeductions+"' ",h+=",dcAlpha29='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedArrears+"' ",h+=",dcAlpha30='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedAdjustments+"' ",h+=",dcAlpha31='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totLoans+"' ",l.a.SessionManager.Preferences.ContainsKey("ShowPaymentModeselectionWhilePayrollProcessing")&&"True"==l.a.SessionManager.Preferences.ShowPaymentModeselectionWhilePayrollProcessing&&"Default"!=this.objEmpFilter.PaymentModes.SelectedValue?h+="Bank Transfer"==this.objEmpFilter.PaymentModes.SelectedValue?",dcAlpha34='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].IBANNo.toString()+"'":",dcAlpha34=''":"Bank Transfer"==this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].PaymentMode.toString()?h+=",dcAlpha34='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].IBANNo.toString()+"'":h+=",dcAlpha34=''",i+='<Alpha Query="',i+=h;for(let l=0;l<this.dgvEmployees.TableColumns.length;l++)this.dgvEmployees.TableColumns[l].startsWith("dcAlpha")&&!this.dgvEmployees.TableColumns[l].endsWith("_Key")&&(o+=" "+this.dgvEmployees.TableColumns[l]+"='"+d.e.EncodeXML(this.dgvEmployees.Table[this.lstSelectedEmps[this.iEmpIndex]][this.dgvEmployees.TableColumns[l]].toString())+"',");o+=" ",o.length>0&&(i+=","+o),i+='" ></Alpha>',o="",a+='<CostCenters Query="',o+=" dcCCNID51="+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+",",o+=" dcCCNID53="+this.oCMP.arrLstOthMPFields[this.iEmpIndex].GradeID+",",null==this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank||"0"==this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank.toString()||null==this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank||"Cash"==this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].PaymentMode.toString()?o+=" dcCCNID68=1,":o+=" dcCCNID68="+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank.toString()+",",r.push("dcCCNID51"),r.push("dcCCNID53"),r.push("dcCCNID68");let m="",p="";if(null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAsOnDim&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAsOnDim.length>0)for(let l=0;l<Object.keys(this.oCMP.arrLstOthMPFields[0].dsAllEmpsData.Tables[24][0]).length;l++)m=Object.keys(this.oCMP.arrLstOthMPFields[0].dsAllEmpsData.Tables[24][0])[l].toString(),p=this.oCMP.arrLstOthMPFields[0].drcAsOnDim[0][m].toString(),m.Contains("CCNID")&&"CCNID51"!=m&&"CCNID53"!=m&&"CCNID68"!=m&&(o+=" dc"+m+"="+p+",",r.Contains("dc"+m)||r.push("dc"+m));for(let l=0;l<this.dgvEmployees.TableColumns.length;l++)this.dgvEmployees.TableColumns[l].startsWith("dcCCNID")&&(r.Contains(this.dgvEmployees.TableColumns[l])||this.dgvEmployees.TableColumns[l].endsWith("_Key")||(o+=" "+this.dgvEmployees.TableColumns[l]+"="+d.e.EncodeXML(this.dgvEmployees.Table[this.lstSelectedEmps[this.iEmpIndex]][this.dgvEmployees.TableColumns[l]+"_Key"].toString())+","));if(o.length>0&&(a+=o),a+='" ></CostCenters>',s+='" ProductID="'+this.DefProdID+'" Quantity="0" Unit="1" UOMConversion="1" UOMConvertedQty="0" Rate="0" Gross="0" IsQtyIgnored="1" AverageRate="0" StockValue="0" StockValueFC="0" RefNO="" BillDate="'+l.a.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+'" CurrencyID="'+this.oCMP.arrLstOthMPFields[this.iEmpIndex].CurrencyID+'" ExchangeRate="1" DebitAccount="'+this.sDrAccount+'" CreditAccount="'+this.sCrAccount+'" CommonNarration="'+d.e.EncodeXML("POSTED FROM CONSOLIDATED MONTHLY PAYROLL"),this.oCMP.arrLstCPFields[this.iEmpIndex][0].length>0){if(t+="\x11",t+="<Row>",t+="<AccountsXML></AccountsXML>",t+='<Transactions DocSeqNo="1" VoucherType="11" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Earning',n="",null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&(e=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[6].filter(e=>e.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&11==e.VoucherType),null!=e&&e.length>0&&(n=e[0].InvDocDetailsID.toString())),t+=n.length>0?'" DocDetailsID="'+n:'" DocDetailsID="',t+=s.toString()+'" ></Transactions>',o="",t+='<Numeric Query="',this.oCMP.arrLstCPFields[this.iEmpIndex][0].length>0)for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;e++)null==this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].SNo||d.e.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].SNo)||(o+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].dActual.Replace(",","")+",",o+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].dEarned.Replace(",","")+",",o+=" dcExchRT"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].dArrear.Replace(",","")+",",o+=" dcCalcNumFC"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].dAdjusted.Replace(",","")+",");if(this.oCMP.arrLstCPFields[this.iEmpIndex][1].length>0)for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][1].length;e++)d.e.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][1][e].SNo)||(o+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][1][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][1][e].dActual.Replace(",","")+",",o+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][1][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][1][e].dEarned.Replace(",","")+",");o.length>0&&(t+=o),t+='" ></Numeric>',t+=i.toString(),t+=a.toString(),t+="<EXTRAXML></EXTRAXML>",t+="</Row>"}if(this.oCMP.arrLstCPFields[this.iEmpIndex][2].length>0){if(t+="\x11",t+="<Row>",t+="<AccountsXML></AccountsXML>",t+='<Transactions DocSeqNo="2" VoucherType="12" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Deduction',n="",null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&(e=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[6].filter(e=>e.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&12==e.VoucherType),null!=e&&e.length>0&&(n=e[0].InvDocDetailsID.toString())),t+=n.length>0?'" DocDetailsID="'+n:'" DocDetailsID="',t+=s.toString()+'" ></Transactions>',o="",t+='<Numeric Query="',this.oCMP.arrLstCPFields[this.iEmpIndex][2].length>0)for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;e++)d.e.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].SNo)||(o+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].dActual.Replace(",","")+",",o+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].dEarned.Replace(",","")+",",o+=" dcExchRT"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].dArrear.Replace(",","")+",",o+=" dcCalcNumFC"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].dAdjusted.Replace(",","")+",");o.length>0&&(t+=o),t+='" ></Numeric>',t+=i.toString(),t+=a.toString(),t+="<EXTRAXML></EXTRAXML>",t+="</Row>"}if(this.oCMP.arrLstCPFields[this.iEmpIndex][4].length>0&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].iExtLoansCnt>0){if(t+="\x11",t+="<Row>",t+="<AccountsXML></AccountsXML>",t+='<Transactions DocSeqNo="3" VoucherType="13" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Loan',n="",null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&(e=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[6].filter(e=>e.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&13==e.VoucherType),null!=e&&e.length>0&&(n=e[0].InvDocDetailsID.toString())),t+=n.length>0?'" DocDetailsID="'+n:'" DocDetailsID="',t+=s.toString()+'" ></Transactions>',o="",t+='<Numeric Query="',this.oCMP.arrLstCPFields[this.iEmpIndex][4].length>0)for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][4].length;e++)d.e.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].SNo)||1!=this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].IsVisible||(o+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].LoanActInstAmt.Replace(",","")+",",o+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].LoanInstAmt.Replace(",","")+",",o+=" dcExchRT"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].LoanBalAmt.Replace(",","")+",",o+=" dcCalcNumFC"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].LoanPayStatus+",");o.length>0&&(t+=o),t+='" ></Numeric>',t+=i.toString(),t+=a.toString(),t+="<EXTRAXML></EXTRAXML>",t+="</Row>"}if(this.oCMP.arrLstCPFields[this.iEmpIndex][5].length>0){if(t+="\x11",t+="<Row>",t+="<AccountsXML></AccountsXML>",t+='<Transactions DocSeqNo="4" VoucherType="14" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Leaves',n="",null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&(e=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[6].filter(e=>e.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&14==e.VoucherType),null!=e&&e.length>0&&(n=e[0].InvDocDetailsID.toString())),t+=n.length>0?'" DocDetailsID="'+n:'" DocDetailsID="',t+=s.toString()+'" ></Transactions>',o="",t+='<Numeric Query="',this.oCMP.arrLstCPFields[this.iEmpIndex][5].length>0)for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][5].length;e++)d.e.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].SNo)||(o+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].LeaveTotOPBal.Replace(",","")+",",o+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].LeaveTaken.Replace(",","")+",",o+=" dcExchRT"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].LeaveMonOPBal.Replace(",","")+",",o+=" dcCalcNumFC"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].LeaveNetBal.Replace(",","")+",");o.length>0&&(t+=o),t+='" ></Numeric>',t+=i.toString(),t+=a.toString(),t+="<EXTRAXML></EXTRAXML>",t+="</Row>"}return t.toString()}GetActivityXML(){let e,t="",s="",i="";if(null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0)for(let l=0;l<this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length;l++)t+="~"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[l].InvDocDetailsID.toString();let a="";if(a+=this.oCMP.arrLstOthMPFields[this.iEmpIndex].IsAlreadyProcessed?t.length>0?'<XML DetailIds="'+t+'" AppRejDate="'+(new Date).ToString("dd/MMM/yyyy")+'" >':'<XML AppRejDate="'+(new Date).ToString("dd/MMM/yyyy")+'" >':t.length>0?'<XML DetailIds="'+t+'" >':"<XML>",this.oCMP.arrLstCPFields[this.iEmpIndex][4].length>0&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].iExtLoansCnt>0){let t,o,n,r,h,m,p="0";if(s=i="",null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay.length>0&&(p=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay[0].DocID.toString()),a+='<LoanRepaymentXML DocID="'+p+'" DocDetIDs="" WorkFlowID="0" >',a+="<DOCXML>",this.oCMP.arrLstCPFields[this.iEmpIndex][4].length>0){let p=0;null!=l.a.SessionManager.dtDocDefAccs&&(e=l.a.SessionManager.dtDocDefAccs.filter(e=>40057==e.CostCenterID&&"CreditAccount"==e.SysColumnName),null!=e&&e.length>0&&null!=e[0].UserDefaultValue&&""!=e[0].UserDefaultValue.toString().Trim()&&(s=e[0].UserDefaultValue.toString()),e=l.a.SessionManager.dtDocDefAccs.filter(e=>40057==e.CostCenterID&&"DebitAccount"==e.SysColumnName),null!=e&&e.length>0&&null!=e[0].UserDefaultValue&&""!=e[0].UserDefaultValue.toString().Trim()&&(i=e[0].UserDefaultValue.toString()));for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][4].length;e++)if(!d.e.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].SNo)&&1==this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].IsVisible&&!d.e.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].LoanInstAmt)){t=this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].LoanDocNo,n=this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].LoanActInstNo,h=3==parseInt(this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].LoanPayStatus)?this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].LoanActInstAmt.Replace(",",""):this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].LoanInstAmt.Replace(",","");let d=parseInt(n);this.oCMP.arrLstOthMPFields[this.iEmpIndex].IsAlreadyProcessed?(m=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[11].filter(e=>e.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&e.RefNo==t&&e.dcAlpha5==l.a.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")),null!=m&&m.length>0&&(d=parseInt(m[0].dcNum1))):(l.a.SessionManager.Preferences.ContainsKey("ShowLoanBalRespDedMonthWhilePayProc")&&"True"==l.a.SessionManager.Preferences.ShowLoanBalRespDedMonthWhilePayProc?(m=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[10].filter(e=>e.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&e.DocNo==t&&e.InstallmentNo==d),m.SortBy(["InstallmentNo"])):(m=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[10].filter(e=>e.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&e.DocNo==t&&e.InstBalance>0&&e.InstallmentNo<d),m.SortBy(["InstallmentNo"])),null!=m&&m.length>0&&(d=parseInt(m[0].InstallmentNo)));let C=parseFloat(h),c=0,g=0;do{p++,m=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[10].filter(e=>e.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&e.DocNo==t&&e.InstallmentNo==d),o=m[0].InvDocDetailsID.toString(),r=m[0].InstallmentAmt.toString().Replace(",",""),c=C>parseFloat(m[0].InstBalance)?parseFloat(m[0].InstBalance):C,a+="<RowHead/>",a+="<Row>",a+="<AccountsXML></AccountsXML>",a+='<Transactions DocSeqNo="'+p+'"  DocDetailsID="0" LinkedInvDocDetailsID="'+o+'" LinkedFieldName="dcNum3" LineNarration="" ProductID="'+this.DefProdID+'" IsScheme="" Quantity="1" Unit="1" UOMConversion="1" UOMConvertedQty="1" Rate="0" Gross="0" RefNO="'+t+'" LinkedFieldValue="'+c+'" IsQtyIgnored="1" AverageRate="0" StockValue="0" StockValueFC="0" CurrencyID="1" ExchangeRate="1"  DebitAccount="'+i+'"  CreditAccount="'+s+'"  ></Transactions>',a+='<Numeric Query="dcNum1='+d+", dcCalcNum1="+d+", dcNum2="+r.Replace(",","")+", dcCalcNum2="+r.Replace(",","")+", dcNum3="+c.toString().Replace(",","")+", dcCalcNum3="+c.toString().Replace(",","")+', " ></Numeric>',a+="<Alpha Query=\"dcAlpha1=N'"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].LoanApprovedAmt+"',dcAlpha2=N'"+(parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].LoanBalAmt)-g)+"', dcAlpha3=N'"+h+"', dcAlpha4=N'"+new Date(m[0].DeductionMonth).ToString("dd/MMM/yyyy")+"', dcAlpha5=N'"+l.a.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"',dcAlpha6=N'1',dcAlpha7=N'"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].LoanPayStatus+"', \" ></Alpha>",a+='<CostCenters Query="dcCCNID51='+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+", dcCCNID52="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].ComponentID+', " ></CostCenters>',a+="<EXTRAXML></EXTRAXML>",a+="</Row>",g+=c,C-=c,d++}while(C>0)}}a+="</DOCXML>",a+="<BillXML></BillXML></LoanRepaymentXML>"}if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths.length>0){let e=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths.split(";"),t=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrCalcMonthPaydays.split(";");if(e.length>0){a+="<ArrearsXML>",a+="<Rows>";for(let s=0;s<e.length;s++)a+='<Row PayrollMonth="'+l.a.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy"),a+='" EmpSeqNo="'+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo,a+='" ArrearsCalcMonths="'+new Date(e[s]).ToString("dd/MMM/yyyy"),a+='" ArrCalcMonthPayDays="'+t[s].toString(),a+='" ArrearsCalcDays="',a+='" />';a+="</Rows>",a+="</ArrearsXML>"}}if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanCrNetSalLessZero.length>0&&(a+='<DelLoanXML DocID="'+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanCrNetSalLessZero[0].DocID.toString()+'" > </DelLoanXML>'),this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary<0&&"True"==l.a.SessionManager.Preferences.CreateLoanIfNetSalLessThanZero&&parseInt(l.a.SessionManager.Preferences.CreateLoanType)>0&&(s=i="",null!=l.a.SessionManager.dtDocDefAccs&&(e=l.a.SessionManager.dtDocDefAccs.filter(e=>40056==e.CostCenterID&&"CreditAccount"==e.SysColumnName),null!=e&&e.length>0&&null!=e[0].UserDefaultValue&&""!=e[0].UserDefaultValue.toString().Trim()&&(s=e[0].UserDefaultValue.toString()),e=l.a.SessionManager.dtDocDefAccs.filter(e=>40056==e.CostCenterID&&"DebitAccount"==e.SysColumnName),null!=e&&e.length>0&&null!=e[0].UserDefaultValue&&""!=e[0].UserDefaultValue.toString().Trim()&&(i=e[0].UserDefaultValue.toString())),a+='<CreateLoanXML DocID="" DocDetIDs="" WorkFlowID="0" >',a+="<DOCXML>",a+="<RowHead/>",a+="<Row>",a+="<AccountsXML></AccountsXML>",a+='<Transactions DocSeqNo="1"  DocDetailsID="0" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="" CommonNarration="LOAN CREATED FROM MONTHLY PAYROLL WHEN NET SALARY LESS THAN 0" ProductID="'+this.DefProdID+'" IsScheme="" Quantity="1" Unit="1" UOMConversion="1" UOMConvertedQty="1" Rate="0" Gross="0" RefNO="0" IsQtyIgnored="1" AverageRate="0" StockValue="0" StockValueFC="0" CurrencyID="1" ExchangeRate="1"  DebitAccount="'+i+'"  CreditAccount="'+s+'"  ></Transactions>',a+='<Numeric Query="dcNum1=1, dcCalcNum1=1, dcNum2='+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+", dcCalcNum2="+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+', " ></Numeric>',a+="<Alpha Query=\"dcAlpha6=N'"+l.a.SessionManager.PayrollMonth.AddMonths(1).ToString("dd/MMM/yyyy")+"',dcAlpha1=N'"+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+"', dcAlpha2=N'"+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+"', dcAlpha4=N'1', dcAlpha3=N'"+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+"',dcAlpha5=N'"+l.a.SessionManager.PayrollMonth.AddMonths(1).ToString("dd/MMM/yyyy")+"',dcAlpha7=N'"+l.a.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"', \" ></Alpha>",a+='<CostCenters Query="dcCCNID51='+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+", dcCCNID52="+l.a.SessionManager.Preferences.CreateLoanType+', " ></CostCenters>',a+="<EXTRAXML></EXTRAXML>",a+="</Row>",a+="</DOCXML>",a+="<BillXML></BillXML></CreateLoanXML>"),this.oCMP.arrLstCPFields[this.iEmpIndex][0].length>0&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths.length>0){let e=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths.split(";");if(e.length>0){let t="";t+="    DELETE FROM PAY_EmpMonthlyArrAdjDetails WHERE EmpSeqNo="+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+" AND DType=1 AND PayrollMonth='"+l.a.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"'";for(let s=0;s<e.length;s++){let i="",a="";t+="  INSERT INTO PAY_EmpMonthlyArrAdjDetails(EmpSeqNo,PayrollMonth,ArrAdjMonth,DType",i+="VALUES("+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+",'"+l.a.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"','"+e[s].toString()+"',1";for(let t=0;t<this.oCMP.arrLstCPFields[0][0].length;t++){let l="";if(null!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][t].ArrData&&this.oCMP.arrLstCPFields[this.iEmpIndex][0][t].ArrData.length>0){let i=[];if(this.oCMP.arrLstCPFields[this.iEmpIndex][0][t].ArrData=this.oCMP.arrLstCPFields[this.iEmpIndex][0][t].ArrData.TrimEnd(","),i=this.oCMP.arrLstCPFields[this.iEmpIndex][0][t].ArrData.split(";"),null!=i&&i.length>0)for(let t=0;t<i.length;t+=2)new Date(i[t]).ToString("dd MMM yyyy")==new Date(e[s]).ToString("dd MMM yyyy")&&(l=i[t+1])}a+=",Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][t].SNo,i+=null!=l&&""!=l?","+l:",0"}for(let t=0;t<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;t++){let l="";if(null!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][t].ArrData&&this.oCMP.arrLstCPFields[this.iEmpIndex][2][t].ArrData.length>0){let i=[];if(this.oCMP.arrLstCPFields[this.iEmpIndex][2][t].ArrData=this.oCMP.arrLstCPFields[this.iEmpIndex][2][t].ArrData.TrimEnd(","),i=this.oCMP.arrLstCPFields[this.iEmpIndex][2][t].ArrData.split(";"),null!=i&&i.length>0)for(let t=0;t<i.length;t+=2)new Date(i[t]).ToString("dd MMM yyyy")==new Date(e[s]).ToString("dd MMM yyyy")&&(l=i[t+1])}a+=",Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][t].SNo,i+=null!=l&&""!=l?","+l:",0"}t+=a+")",t+=i+")"}a+='<ArrearsDetailXML Query="'+t+'"></ArrearsDetailXML>'}}return a+="</XML>",a.toString()}GetRawExportHTML(){let e="",t="";e+="<html><meta charset='utf-8' /><body style='color:blac;background-color:white;'>",t+=".hdr{text-align:cente; padding:5px; background-color:#4F81BD;color:white;font-family:Arial;font-size:11pt} ",t+=".grp{padding:2p; background-color:#87CEEB; color:#FFFCF7;font-family:arial; font-size:10pt;}",t+=".tot{background-color:whit; color:red;font-family:arial; font-weight:bold; font-size:8pt;}",t+=".alt{background-color:whitesmok; color:black; font-family:arial; font-size:9pt; align:right;}",t+=".null{background-color:#ECF9C;}",e+="<style>"+t.toString()+"</style>";let s=this.dgvEmployees.Table;e+="<table>",e+="<tr><td style='padding-top:10p;'><table border=1 style='border-collapse:collapse;  font-family:arial; font-size:9pt;' >",e+="<COLGROUP>";let i=null;for(let l=0;l<this.dgvEmployees.TableColumns.length;l++){var a=this.dgvEmployees.TableColumns[l];i=this.dgvEmployees.Columns.find(e=>e.DisplayMember.toUpperCase()==this.dgvEmployees.TableColumns[l][a].toUpperCase()),null!=i&&i.IsVisible&&(e+="<COL>")}e+="</COLGROUP>",e+="<tr style=''>";for(let l=0;l<this.dgvEmployees.Table.length;l++)a=this.dgvEmployees.Table[l],i=this.dgvEmployees.Columns.find(e=>e.DisplayMember.toUpperCase()==this.dgvEmployees.TableColumns[l][a].toUpperCase()),null!=i&&i.IsVisible&&(e+="<th class='hdr'>",e+=i.Header,e+="</th>");e+="</tr>";for(let l=0;l<s.length;l++){if(e+="<tr",l%2==1&&(e+=" class=alt"),e+=">",0==this.dgvEmployees.TableColumns.length)e+="<td colspan="+this.dgvEmployees.TableColumns.length+">DELETED ROW</td>";else for(let t=0;t<this.dgvEmployees.TableColumns.length;t++)a=this.dgvEmployees.TableColumns[l],i=this.dgvEmployees.Columns.find(e=>e.DisplayMember.toUpperCase()==this.dgvEmployees.TableColumns[t][a].toUpperCase()),null!=i&&i.IsVisible&&(null==s[l][t]?e+="<td class='null'>":(e+="<td>",e+=s[l][t].toString()),e+="</td>");e+="</tr>"}return e+="</table>",e+="</td></tr></table>",e+="</body><html>",e.toString()}}var N=s("EW98"),A=s("mrSG"),O=s("4HhE"),x=s("wlFP"),f=s("OPQN");class R extends c.b{constructor(e){super(),this.ButtonClick=new O.b,this.ProgressVisibility=!1,this.chkPostBasedOnDailyAttendance=new x.a,this.chkPostBasedOnAttDimWise=new x.a,this.chkIncludeOTHours=new x.a,this.EmployeesList=new C.a,this.PostVisiblility=!0,this.UnPostVisiblility=!0,this.dsDailyAttendanceData=null,this.sPayrollMonthMouseDoubleClickCommand=new O.b,this.btnCancelFlag=!1,this.sCrAccount="0",this.sDrAccount="0",this.SelectUnCheck=0,this.sFilter="",this.IsPosting=!1,this.iEmpIndex=0,this.strResult="",this.Failed="",this.FailedCount=0,this.DefProdID=0;try{Logger.InfoLog("PostPayrollViewModel::Entering PostPayrollViewModel()"),this.ClassName="PostPayrollViewModel",this.CostCenterID=40054,this.DisplayName=l.a.GetResource(e),this.Title=l.a.GetResource(e),this.DisplayMessage="",this.sPayrollMonth=" / ["+l.a.SessionManager.PayrollMonth.ToString("MMM-yyyy")+"]",this.ButtonClick.Subscribe(this,"Button_Click"),this.sPayrollMonthMouseDoubleClickCommand.Subscribe(this,"sPayrollMonth_MouseDoubleClick"),this.lblPayrollMonth=l.a.SessionManager.PayrollMonth.ToString("MMM, yyyy"),this.lblPayrollMonthStart=l.a.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy"),this.lblPayrollMonthEnd=l.a.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy"),this.PostVisiblility=l.a.SessionManager.IsActionAssigned(this.CostCenterID,"Create"),this.UnPostVisiblility=l.a.SessionManager.IsActionAssigned(this.CostCenterID,"Delete"),this.btnCancelFlag=!1,this.chkPostBasedOnDailyAttendance.Label=l.a.GetResource("PostbasedonDailyAttendance"),this.chkIncludeOTHours.Label=l.a.GetResource("IncludeOverTimeHours"),this.chkPostBasedOnAttDimWise.Label=l.a.GetResource("PostbasedonAttendanceDimensionwise"),this.LoadGrid(),this.btnFilter_Click(),"True"==l.a.SessionManager.Preferences.GetDailyAttendanceDataInMonthlyPayroll&&(this.chkPostBasedOnDailyAttendance.IsChecked=!0,this.chkIncludeOTHours.IsChecked=!0),Logger.InfoLog("PostPayrollViewModel::Exiting PostPayrollViewModel()")}catch(t){Logger.ErrorLog("PostPayrollViewModel::EXCEPTION PostPayrollViewModel()"+t.stack)}}get SelectAll(){return this._SelectAll}set SelectAll(e){e!=this._SelectAll&&(this._SelectAll=e,this.SelectUnselectAll(e))}sPayrollMonth_MouseDoubleClick(e){return Object(A.b)(this,void 0,void 0,(function*(){const{SetPayrollDateViewModel:e}=yield Promise.resolve().then(s.bind(null,"Saj9")),{SetPayrollDateComponent:t}=yield Promise.resolve().then(s.bind(null,"V+gx"));let i=new e;l.a.page.ShowDialog(i,t,{ShowCenter:!0,Title:l.a.GetResource("Pay_SetPayrollDate")}),i.DialogResult&&this.btnClear_Click()}))}LoadGrid(){let e,t=(new g.a).GetScreenInfo(this.CostCenterID);e=t.Tables[0].filter(e=>"CreditAccount"==e.SysColumnName),null!=e&&e.length>0&&!d.e.IsEmpty(e[0].UserDefaultValue)&&(this.sCrAccount=e[0].UserDefaultValue.toString()),e=t.Tables[0].filter(e=>"DebitAccount"==e.SysColumnName),null!=e&&e.length>0&&null!=e[0].UserDefaultValue&&""!=e[0].UserDefaultValue.toString().Trim()&&(this.sDrAccount=e[0].UserDefaultValue.toString()),this.EmployeesList=new C.a,this.EmployeesList.CanUserDeleteRows=!0,this.EmployeesList.Height=0,this.EmployeesList.Table=[],this.EmployeesList.SelectAll.Visible=!0,this.EmployeesList.TableColumns.push("Select"),this.EmployeesList.DataTypes.Bool.push("Select"),this.EmployeesList.TableColumns.push("SNo"),this.EmployeesList.TableColumns.push("EmpSeqNo"),this.EmployeesList.TableColumns.push("EmpCode"),this.EmployeesList.TableColumns.push("EmpName"),this.EmployeesList.TableColumns.push("Result");let s=new y.a;this.EmployeesList.Columns=[],s=new y.a,s.Header=l.a.GetResource("Pay_Select"),s.DisplayMember="Select",s.DataType="CheckBox",s.Width=50,s.CheckedChanged.Subscribe(this,"dgColSelect_CheckedChanged"),this.EmployeesList.Columns.push(s),s=new y.a,s.Header=l.a.GetResource("Payroll_EmpSNo"),s.DisplayMember="SNo",s.DataType="TextBlock",s.Width=50,s.ReadOnly=!0,this.EmployeesList.Columns.push(s),s=new y.a,s.Header=l.a.GetResource("EmployeeCode"),s.DisplayMember="EmpCode",s.DataType="TextBlock",s.Width=250,s.ReadOnly=!0,this.EmployeesList.Columns.push(s),s=new y.a,s.Header=l.a.GetResource("EmployeeName"),s.DisplayMember="EmpName",s.DataType="TextBlock",s.Width=250,s.ReadOnly=!0,this.EmployeesList.Columns.push(s),s=new y.a,s.Header=l.a.GetResource("Result"),s.DisplayMember="Result",s.DataType="TextBlock",s.Width=250,s.ReadOnly=!0,this.EmployeesList.Columns.push(s)}dgColSelect_CheckedChanged(e,t){t||1==this.SelectAll&&(this.SelectUnCheck=1,this.SelectAll=!1)}SelectUnselectAll(e){for(let t=0;t<this.EmployeesList.Table.length;t++)0==this.SelectUnCheck&&(this.EmployeesList.Table[t].Select=e);this.SelectUnCheck=0,this.EmployeesList.refreshDataView()}Button_Click(e){Logger.InfoLog("PostPayrollViewModel::Entering Button_Click()"),"Post"==e.toString()?this.btnPost_Click():"Clear"==e.toString()?this.btnClear_Click():"UnPost"==e.toString()?this.btnUnPost_Click():"Filter"==e.toString()&&this.btnFilter_Click(),Logger.InfoLog("PostPayrollViewModel::Exiting Button_Click()")}btnUnPost_Click(){this.IsPosting=!1,this.bgworker_DoWork(null,null),this.bgworker_RunWorkerCompleted(null,null)}btnClear_Click(){this.EmployeesList.Clear(),this.sPayrollMonth=" / ["+l.a.SessionManager.PayrollMonth.ToString("MMM-yyyy")+"]",this.lblPayrollMonth=l.a.SessionManager.PayrollMonth.ToString("MMM, yyyy"),this.lblPayrollMonthStart=l.a.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy"),this.lblPayrollMonthEnd=l.a.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy"),this.SelectAll=!1,this.chkIncludeOTHours.IsChecked=!1,this.chkPostBasedOnDailyAttendance.IsChecked=!1,this.chkPostBasedOnAttDimWise.IsChecked=!1,this.FailedCount=0,this.Failed="",this.InProgress="",this.IsPosting=!1,this.lstSelectedEmps=[],"True"==l.a.SessionManager.Preferences.GetDailyAttendanceDataInMonthlyPayroll&&(this.chkPostBasedOnDailyAttendance.IsChecked=!0,this.chkIncludeOTHours.IsChecked=!0)}btnPost_Click(){this.IsPosting||(this.IsPosting=!0,this.bgworker_DoWork(null,null),this.bgworker_RunWorkerCompleted(null,null))}btnFilter_Click(){Logger.InfoLog("PostPayrollViewModel::Entering Filter_Click()"),l.a.SessionManager.Preferences.ContainsKey("PostPayrollFilter")&&parseInt(l.a.SessionManager.Preferences.PostPayrollFilter)>0?null==this.objEmpFilter?this.objEmpFilter=new P.a("",0,2):this.objEmpFilter.CostCenterFilters.length>0?this.objEmpFilter.CostCenters.SelectedValue=this.objEmpFilter.CostCenterFilters[0].CostCenterID.toString():(this.objEmpFilter.Filter=2,this.objEmpFilter.InitControls()):null==this.objEmpFilter?this.objEmpFilter=new P.a("",0,0):(this.objEmpFilter.Filter=0,this.objEmpFilter.InitControls()),this.objEmpFilter.Filter>0&&l.a.page.ShowDialog(this.objEmpFilter,L.a,{ShowCenter:!0,HideHeader:!0}).subscribe(()=>{if(this.DialogResult=this.objEmpFilter.IsCompleted,this.objEmpFilter.IsCompleted)if(this.objEmpFilter.CostCenterFilters.length>0){let e=1,t="",s="",i="";for(let l=0;l<this.objEmpFilter.CostCenterFilters.length;l++){let a=this.objEmpFilter.CostCenterFilters[l];if(a.CostCenterID>5e4&&(e=2,t="NodeID",s=50051==a.CostCenterID?"EmpSeqNo":"CCNID"+(a.CostCenterID-5e4)),a.SelectedNodes.length>0){if(1==a.SelectedNodes.length)i+=" AND ",i+=s+"="+a.SelectedNodes[0].Id;else if(!a.SelectedNodes.find(t=>t.Id==e&&t.IsGroup))if(i+=" AND ",D.IPrefetchFilter.IsGroupTree(a)){let e="";for(let t=0;t<a.SelectedNodes.length;t++)null!=a.SelectedNodes[t].Parent&&a.SelectedNodes[t].Parent.IsSelected||(e.length>0&&(e+=","),e+=a.SelectedNodes[t].Id);0==e.length&&(e+=-12912),i+=s+" IN ",i+=" (select T."+t+" GTID from "+u.b.GetTagTableName(a.CostCenterID)+" T with(nolock),"+u.b.GetTagTableName(a.CostCenterID)+" GTP with(nolock) where T.lft BETWEEN GTP.lft AND GTP.rgt AND GTP."+t+" IN (",i+=e.toString()+")  group by T."+t+")"}else{i+=s+" IN (";for(let e=0;e<a.SelectedNodes.length;e++)e>0&&(i+=","),i+=a.SelectedNodes[e].Id;i+=")"}}else a.DeleteButtonVisibility||(i+=" AND ",i+=s+"=-12912")}this.sFilter=i.toString(),this.sFilter+=" AND ( CONVERT(DATETIME,EMP.DOJ) <='"+l.a.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy")+"' AND CONVERT(DATETIME,EMP.DORelieve)  >='"+l.a.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"' ) ","True"==l.a.SessionManager.Preferences.NPDontAllowPayrollProcessing&&(this.sFilter+=" AND EmpSeqNo NOT IN ( Select NodeID From COM_CC50051 WITH(NOLOCK) \n                                                            Where ResignStatus='Posted' AND DateDiff(day,ISNULL(CONVERT(DATETIME,DORelieve),'01-Jan-9000'),'"+l.a.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"')<=0\n                                                            AND DateDiff(day,CONVERT(DATETIME,CONVERT(DATETIME,('01-'+CONVERT(NVARCHAR(3),DATENAME(MONTH,ISNULL(CONVERT(DATETIME,DOResign),'01-Jan-9000')))+'-'+CONVERT(NVARCHAR,YEAR(ISNULL(CONVERT(DATETIME,DOResign),'01-Jan-9000'))))) ),'"+l.a.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"')>=0 )"),"True"==l.a.SessionManager.Preferences.DontConsiderEmpsForPayroll&&parseInt(l.a.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)>0&&(this.sFilter+=" AND NOT ( MONTH(CONVERT(DATETIME,EMP.DOJ))="+l.a.SessionManager.PayrollMonth.iMonth()+" AND YEAR(CONVERT(DATETIME,EMP.DOJ))="+l.a.SessionManager.PayrollMonth.getFullYear()+" AND DAY(CONVERT(DATETIME,EMP.DOJ))>="+parseInt(l.a.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)+" ) "),l.a.SessionManager.LocationID>0&&l.a.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&l.a.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(this.sFilter+=" AND EmpSeqNo IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+l.a.SessionManager.LocationID+")"),d.e.IsEmpty(l.a.SessionManager.sWHEmpFilteredEmpSeqNos)||(this.sFilter+="  AND EmpSeqNo IN ("+l.a.SessionManager.sWHEmpFilteredEmpSeqNos+")"),"Processed"==this.objEmpFilter.StatusModes.SelectedValue?this.sFilter+=" AND EmpSeqNo IN (SELECT DISTINCT C51.NODEID FROM INV_DocDetails I\n                                                                JOIN COM_DocCCData CC ON CC.InvDocDetailsID=I.InvDocDetailsID\n                                                                JOIN COM_CC50051 C51 ON C51.NODEID=CC.DCCCNID51\n                                                                WHERE I.CostCenterID=40054  AND  CONVERT(DATETIME,I.DueDate)=CONVERT(DATETIME,'"+l.a.SessionManager.PayrollMonth.ToString("dd MMM yyyy")+"'))":"UnProcessed"==this.objEmpFilter.StatusModes.SelectedValue&&(this.sFilter+=" AND EmpSeqNo NOT IN (SELECT DISTINCT C51.NODEID FROM INV_DocDetails I\n                                                                JOIN COM_DocCCData CC ON CC.InvDocDetailsID=I.InvDocDetailsID\n                                                                JOIN COM_CC50051 C51 ON C51.NODEID=CC.DCCCNID51\n                                                                WHERE I.CostCenterID=40054  AND  CONVERT(DATETIME,I.DueDate)=CONVERT(DATETIME,'"+l.a.SessionManager.PayrollMonth.ToString("dd MMM yyyy")+"'))");let a=l.a.SessionManager.Preferences.ConsolidateMonthlyPayrollSort;""!=a.Trim()&&"None"!=a&&(this.sFilter+="TreeView"==a?" ORDER BY EMP.lft ":" ORDER BY EMP."+a);let o=[];o.push(l.a.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy")),o.push(this.sFilter),o.push(0),o.push(l.a.SessionManager.RoleID),o.push(l.a.SessionManager.UserID),o.push(l.a.SessionManager.LanguageID);let n=l.a.empService.GetData(o,"spPAY_GetEmpMasterCCDetails");if(this.EmployeesList.Clear(),null!=n&&n.Tables.length>0&&n.Tables[0].length>0)for(let l=0;l<n.Tables[0].length;l++){let e=this.EmployeesList.NewRow();e.EmpSeqNo=n.Tables[0][l].EmpSeqNo,e.EmpCode=n.Tables[0][l].EmpCode,e.EmpName=n.Tables[0][l].EmpName,e.SNo=(l+1).toString(),e.Select=!1,this.EmployeesList.addRow(e)}}else this.objEmpFilter.Filter>0&&this.FilterEmployees()}),Logger.InfoLog("PostPayrollViewModel::Exiting Filter_Click()")}FilterEmployees(){try{Logger.InfoLog("PostPayrollViewModel::Entering FilterEmployees()"),this.sFilter=" AND ( CONVERT(DATETIME,EMP.DOJ) <='"+l.a.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy")+"' AND CONVERT(DATETIME,EMP.DORelieve) >='"+l.a.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"' ) ","True"==l.a.SessionManager.Preferences.NPDontAllowPayrollProcessing&&(this.sFilter+=" AND EmpSeqNo NOT IN ( Select NodeID From COM_CC50051 WITH(NOLOCK) \n\t\t\t                                        Where ResignStatus='Posted' AND DateDiff(day,ISNULL(CONVERT(DATETIME,DORelieve),'01-Jan-9000'),'"+l.a.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"')<=0\n\t\t\t                                        AND DateDiff(day,CONVERT(DATETIME,CONVERT(DATETIME,('01-'+CONVERT(NVARCHAR(3),DATENAME(MONTH,ISNULL(CONVERT(DATETIME,DOResign),'01-Jan-9000')))+'-'+CONVERT(NVARCHAR,YEAR(ISNULL(CONVERT(DATETIME,DOResign),'01-Jan-9000'))))) ),'"+l.a.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"')>=0 )"),"True"==l.a.SessionManager.Preferences.DontConsiderEmpsForPayroll&&parseInt(l.a.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)>0&&(this.sFilter+=" AND NOT ( MONTH(CONVERT(DATETIME,EMP.DOJ))="+l.a.SessionManager.PayrollMonth.iMonth()+" AND YEAR(CONVERT(DATETIME,EMP.DOJ))="+l.a.SessionManager.PayrollMonth.getFullYear()+" AND DAY(CONVERT(DATETIME,EMP.DOJ))>="+parseInt(l.a.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)+" ) "),l.a.SessionManager.LocationID>0&&l.a.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&l.a.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(this.sFilter+=" AND EmpSeqNo IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+l.a.SessionManager.LocationID+")"),d.e.IsEmpty(l.a.SessionManager.sWHEmpFilteredEmpSeqNos)||(this.sFilter+="  AND EmpSeqNo IN ("+l.a.SessionManager.sWHEmpFilteredEmpSeqNos+")"),"Processed"==this.objEmpFilter.StatusModes.SelectedValue?this.sFilter+=" AND EmpSeqNo IN (SELECT DISTINCT C51.NODEID FROM INV_DocDetails I\n                                                    JOIN COM_DocCCData CC ON CC.InvDocDetailsID=I.InvDocDetailsID\n                                                    JOIN COM_CC50051 C51 ON C51.NODEID=CC.DCCCNID51\n                                                    WHERE I.CostCenterID=40054  AND  CONVERT(DATETIME,I.DueDate)=CONVERT(DATETIME,'"+l.a.SessionManager.PayrollMonth.ToString("dd MMM yyyy")+"'))":"UnProcessed"==this.objEmpFilter.StatusModes.SelectedValue&&(this.sFilter+=" AND EmpSeqNo NOT IN (SELECT DISTINCT C51.NODEID FROM INV_DocDetails I\n                                                    JOIN COM_DocCCData CC ON CC.InvDocDetailsID=I.InvDocDetailsID\n                                                    JOIN COM_CC50051 C51 ON C51.NODEID=CC.DCCCNID51\n                                                    WHERE I.CostCenterID=40054  AND  CONVERT(DATETIME,I.DueDate)=CONVERT(DATETIME,'"+l.a.SessionManager.PayrollMonth.ToString("dd MMM yyyy")+"'))");let e=l.a.SessionManager.Preferences.ConsolidateMonthlyPayrollSort;""!=e.Trim()&&"None"!=e&&(this.sFilter+="TreeView"==e?" ORDER BY EMP.lft ":" ORDER BY EMP."+e);let t=[];t.push(l.a.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy")),t.push(this.sFilter),t.push(0),t.push(l.a.SessionManager.RoleID),t.push(l.a.SessionManager.UserID),t.push(l.a.SessionManager.LanguageID);let s=l.a.empService.GetData(t,"spPAY_GetEmpMasterCCDetails");if(this.EmployeesList.Clear(),null!=s&&s.Tables.length>0&&s.Tables[0].length>0)for(let i=0;i<s.Tables[0].length;i++){let e=this.EmployeesList.NewRow();e.EmpSeqNo=s.Tables[0][i].EmpSeqNo,e.EmpCode=s.Tables[0][i].EmpCode,e.EmpName=s.Tables[0][i].EmpName,e.SNo=(i+1).toString(),e.Select=!1,this.EmployeesList.addRow(e)}Logger.InfoLog("PostPayrollViewModel::Exiting FilterEmployees()")}catch(e){Logger.ErrorLog("PostPayrollViewModel::EXCEPTION FilterEmployees()"+e.stack)}}bgworker_DoWork(e,t){Logger.InfoLog("PostPayrollViewModel::Entering bgworker_DoWork()"),this.IsPosting?this.PostPayrollData():this.UnPostPayrollData(),Logger.InfoLog("PostPayrollViewModel::Exiting bgworker_DoWork()")}UnPostPayrollData(){Logger.InfoLog("PostPayrollViewModel::Entering UnPostPayrollData()"),this.InProgress="";let e=0,t=0;if(null!=this.EmployeesList.Table&&this.EmployeesList.Table.length>0){this.lstSelectedEmps=[];let s="";for(let e=0;e<this.EmployeesList.Table.length;e++)Object(p.j)(this.EmployeesList.Table[e].Select)&&(s+=this.EmployeesList.Table[e].EmpSeqNo.toString()+",",this.lstSelectedEmps.push(e),t++);if(s.length>0&&t>0){s=s.substr(0,s.length-1);let i,a=s.split(",");e=t,this.FailedCount=0,this.Failed="",this.ProgressVisibility=!0,this.ProgressValue=0,this.ProgressMax=e,this.ProgressMessage="Unposting Payroll, please wait ...",l.a.page.ShowDialog({progress:this.ProgressValue,total:this.ProgressMax,ProgressMessage:this.ProgressMessage},f.a,{HideHeader:!0,ShowCenter:!0,Title:"ProgressMessage"});let o=l.a.report.GetDataTable("PPVM01",s,l.a.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy"));for(let t=0;t<a.length;t++){if(this.strResult="",null!=a[t]&&""!=a[t]){if(i=o.filter(e=>e.EmpSeqNo==a[t]),null!=i&&i.length>0){let e=0,t=[];t.push(this.CostCenterID),t.push(parseInt(i[0].DocID)),t.push(1);let s=l.a.document.DeleteSelectedRows(t,e);this.strResult=s.Message,e=s.RetValue}else this.strResult="No Data exits to delete.",this.Failed+=this.EmployeesList.Table[this.lstSelectedEmps[t]].EmpCode.toString()+",",this.FailedCount++;this.EmployeesList.Table[this.lstSelectedEmps[t]].Result=this.strResult,this.EmployeesList.updateRow(this.EmployeesList.Table[this.lstSelectedEmps[t]])}this.ProgressValue=t+1,this.InProgress=t+1+" of "+e}this.FailedCount>0&&this.Failed.length>1?(this.Failed=this.Failed.substr(0,this.Failed.length-1),this.DisplayMessage="Failed count : "+this.FailedCount+", Emp.Codes : ( "+this.Failed+" )"):null!=this.EmployeesList&&null!=this.EmployeesList.Table&&this.EmployeesList.Table.length>0&&this.EmployeesList.Table.filter(e=>1==e.Select).length>0&&(this.DisplayMessage="Unposted Successfully"),this.MessageVisibility=!0}else this.DisplayMessage="Select atleast one Employee."}else this.DisplayMessage="No Employees found to unpost payroll.";this.MessageVisibility=!0,Logger.InfoLog("PostPayrollViewModel::Exiting UnPostPayrollData()")}bgworker_RunWorkerCompleted(e,t){Logger.InfoLog("PostPayrollViewModel::Entering worker_RunWorkerCompleted()"),this.ProgressVisibility=!1,this.IsPosting=!1,Logger.InfoLog("PostPayrollViewModel::Exiting worker_RunWorkerCompleted()")}PostPayrollData(){Logger.InfoLog("PostPayrollViewModel::Entering PostPayrollData()"),this.InProgress="";let e=0,t=0;if(this.iEmpIndex=0,null!=this.EmployeesList.Table&&this.EmployeesList.Table.length>0){this.lstSelectedEmps=[];let s="";for(let e=0;e<this.EmployeesList.Table.length;e++)Object(p.j)(this.EmployeesList.Table[e].Select)&&(s+=this.EmployeesList.Table[e].EmpSeqNo.toString()+",",this.lstSelectedEmps.push(e),t++);if(s.length>0&&t>0){if(s=s.substr(0,s.length-1),e=t,this.FailedCount=0,this.Failed="",this.ProgressVisibility=!0,this.ProgressValue=0,this.ProgressMax=e,this.ProgressMessage="Payroll is processing, please wait ...",l.a.page.ShowDialog({progress:this.ProgressValue,total:this.ProgressMax,ProgressMessage:this.ProgressMessage},f.a,{HideHeader:!0,ShowCenter:!0,Title:"ProgressMessage"}),this.chkPostBasedOnDailyAttendance.IsChecked&&l.a.SessionManager.Preferences.ContainsKey("CaputureDimensionData")&&"True"==l.a.SessionManager.Preferences.CaputureDimensionData.toString()){let e=[];e.push(s),e.push(l.a.SessionManager.PayrollMonthStart.ToString("dd/MMM/yyyy")),e.push(l.a.SessionManager.PayrollMonthEnd.ToString("dd/MMM/yyyy")),e.push(this.chkIncludeOTHours.IsChecked?1:0),e.push(d.e.IntTryParse(l.a.SessionManager.UserID)),e.push(l.a.SessionManager.LanguageID),this.dsDailyAttendanceData=l.a.empService.GetData(e,"spPAY_PostDailyAttendancetoPayroll")}if(this.oCMP=new E.a,this.oCMP.oParent=this,this.oCMP.sSelectedEmpSeqNos=s,this.oCMP.IsPostFullAttendance=!0,this.chkPostBasedOnDailyAttendance.IsChecked&&(this.oCMP.IsPostBasedOnDailyAttendance=!0),this.chkPostBasedOnAttDimWise.IsChecked&&(this.oCMP.IsPostBasedOnAttDimWise=!0),this.chkIncludeOTHours.IsChecked&&(this.oCMP.IncludeOTHours=!0),this.oCMP.PayrollMonth=l.a.SessionManager.PayrollMonth,this.oCMP.PayrollMonthStart=l.a.SessionManager.PayrollMonthStart,this.oCMP.PayrollMonthEnd=l.a.SessionManager.PayrollMonthEnd,this.oCMP.ProcessPayroll(),this.oCMP.IsCompleted){for(this.ProgressValue=0,this.ProgressMax=e,this.ProgressMessage="Saving data, please wait ...",this.iEmpIndex=0;this.iEmpIndex<this.oCMP.arrLstOthMPFields.length;this.iEmpIndex++){if(null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowID&&null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowID&&""!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowID.toString()&&parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowID)>0){let e=l.a.common.GetDataTable("PAY088",this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].INVDocDetailsID.toString()+",54,'"+l.a.SessionManager.UserName+"',40054,"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowID.toString()+","+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowLevel.toString()+","+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].StatusID.toString()+","+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].CreatedDate.toString()+","+l.a.SessionManager.UserID+","+l.a.SessionManager.RoleID);null!=e&&e.length>0&&(d.e.IsEmpty(e[0].CanApprove)||"TRUE"!=e[0].CanApprove.toString().toUpperCase())&&(369!=parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].StatusID)||l.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Posted Docs")?441!=parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].StatusID)||l.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Approved Docs")||(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage="Can't Edit Approved Document"):this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage="Can't Edit Posted Document")}if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage.length>0){if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage.endsWith("NumFields"))return this.DisplayMessage=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage.Replace("NumFields",""),void(this.MessageVisibility=!0);this.strResult=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage,this.Failed+=this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpCode+",",this.FailedCount++,this.EmployeesList.Table[this.lstSelectedEmps[this.iEmpIndex]].Result=this.strResult,this.EmployeesList.updateRow(this.EmployeesList.Table[this.lstSelectedEmps[this.iEmpIndex]])}else this.strResult="",this.CalculateAccruals(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo),this.SaveVoucher(),this.ProgressValue=this.iEmpIndex+1,this.InProgress=this.iEmpIndex+1+" of "+e}this.MessageVisibility=!0,this.FailedCount>0&&this.Failed.length>1?(this.Failed=this.Failed.substr(0,this.Failed.length-1),this.DisplayMessage="Failed count : "+this.FailedCount+", Emp.Codes : ( "+this.Failed+" )"):null!=this.EmployeesList&&null!=this.EmployeesList.Table&&this.EmployeesList.Table.length>0&&this.EmployeesList.Table.filter(e=>1==e.Select).length>0&&(this.DisplayMessage="Posted Successfully",this.SelectAll=!1,"True"==l.a.SessionManager.Preferences.GetDailyAttendanceDataInMonthlyPayroll?(this.chkPostBasedOnDailyAttendance.IsChecked=!0,this.chkIncludeOTHours.IsChecked=!0):(this.chkIncludeOTHours.IsChecked=!1,this.chkPostBasedOnDailyAttendance.IsChecked=!1))}}else this.DisplayMessage="Select atleast one Employee."}else this.DisplayMessage="No Employees found to post payroll.";this.MessageVisibility=!0,Logger.InfoLog("PostPayrollViewModel::Exiting PostPayrollData()")}CalculateAccruals(e){let t=this.oCMP.arrLstOthMPFields[0].dsAllEmpsData.Tables[2];if(t=t.filter(t=>t.EmpSeqNo==e),t.length>0&&new Date(t[0].cEffectFrom).getFullYear()==l.a.SessionManager.PayrollMonth.getFullYear()&&new Date(t[0].cEffectFrom).iMonth()==l.a.SessionManager.PayrollMonth.iMonth()&&this.oCMP.lstAccrAccumulateSNos.length>0){let t="",s=0,i=0,a=0,o=0,n=0,r=0,h=0,d=0,m=0,p=-1;for(let e=0;e<this.oCMP.lstAccrAccumulateSNos.length;e++)t.length>0&&(t+=","),t+="ISNULL(dcCalcNum"+this.oCMP.lstAccrAccumulateSNos[e]+",0) as dcCalcNum"+this.oCMP.lstAccrAccumulateSNos[e]+",ISNULL(dcCalcNumFC"+this.oCMP.lstAccrAccumulateSNos[e]+",0) as dcCalcNumFC"+this.oCMP.lstAccrAccumulateSNos[e];let C=l.a.empService.GetQueryData(e,"PostCalculateAccural",JSON.stringify(t),l.a.SessionManager.PayrollMonth.ToString("dd MMM yyyy"),"");if(null!=C&&C.length>0)for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;e++)if(i=0,a=0,this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].IsAccrualType&&"Accruals-AccumulateForPreviousYears"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].Behaviour){p=this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].SNo,s=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].dActual);for(let e=0;e<C.length;e++)n=parseFloat(C[e].TotalDays),o=parseFloat(C[e].DaysAttended)+parseFloat(C[e].PaidLeaves)+parseFloat(C[e].LOPDays),r=parseFloat(C[e]["dcCalcNum"+p]),h=parseFloat(C[e]["dcCalcNumFC"+p]),d=parseFloat((o/n*s).ToString(l.a.SessionManager.sPayrollDecimals)),m=parseFloat((d-r).ToString(l.a.SessionManager.sPayrollDecimals)),i+=parseFloat(m.ToString(l.a.SessionManager.sPayrollDecimals)),a+=h;this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].dAdjusted=(i-a).ToString(l.a.SessionManager.sPayrollDecimals)}}}ValidatePosting(){try{return Logger.InfoLog("PostPayrollViewModel::Entering IsValidated()"),null!=l.a.SessionManager.Preferences.PayrollProduct&&""!=l.a.SessionManager.Preferences.PayrollProduct&&(this.DefProdID=parseInt(l.a.SessionManager.Preferences.PayrollProduct)),0==this.DefProdID?(this.strResult+="Select any Default Payroll Product at Global Preferences",this.MessageVisibility=!0,!1):this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays<0?(this.strResult+="Days mismatch : Month days and Total days.",this.MessageVisibility=!0,!1):this.oCMP.arrLstOthMPFields[this.iEmpIndex].dblLeavesLOP>0&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays<this.oCMP.arrLstOthMPFields[this.iEmpIndex].dblLeavesLOP?(this.strResult+="Employee Should have atleast "+this.oCMP.arrLstOthMPFields[this.iEmpIndex].dblLeavesLOP+" LOP Days",this.MessageVisibility=!0,!1):this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary<0&&("False"==l.a.SessionManager.Preferences.CreateLoanIfNetSalLessThanZero||0==parseInt(l.a.SessionManager.Preferences.CreateLoanType))?(this.strResult+="Net Amount should be greater than or equal to zero.",this.MessageVisibility=!0,!1):(Logger.InfoLog("PostPayrollViewModel::Exiting IsValidated()"),!0)}catch(e){return Logger.ErrorLog("PostPayrollViewModel::EXCEPTION IsValidated()"+e.stack),!1}}SaveVoucher(){try{if(Logger.InfoLog("PostPayrollViewModel::Entering btnPost_Click()"),this.ValidatePosting()){let e=0,t=[];t.push(this.CostCenterID),t.push(this.oCMP.arrLstOthMPFields[this.iEmpIndex].DocID),t.push(l.a.SessionManager.PayrollMonth.ToString("MMM'/'yyyy")+"-"),t.push(this.oCMP.arrLstOthMPFields[this.iEmpIndex].DocNo),t.push(Date.Today().ToString("dd/MMM/yyyy")),t.push(l.a.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")),t.push(""),t.push(this.GetDocumentXML()),t.push(""),t.push(""),t.push(""),t.push(this.GetActivityXML()),t.push("false"),l.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==l.a.SessionManager.Preferences.EnableLocationWise.toString()?t.push(l.a.SessionManager.LocationID>0?l.a.SessionManager.LocationID:1):t.push(0),l.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&"True"==l.a.SessionManager.Preferences.EnableDivisionWise.toString()?t.push(l.a.SessionManager.DivisionID>0?l.a.SessionManager.DivisionID:1):t.push(0),t.push(this.oCMP.arrLstOthMPFields[this.iEmpIndex].WID),t.push(l.a.SessionManager.RoleID),t.push(""),t.push(0),t.push(0),t.push(l.a.SessionManager.CompanyGUID),t.push(l.a.SessionManager.UserName),t.push(l.a.SessionManager.UserID),t.push(l.a.SessionManager.LanguageID),t.push(l.a.SessionManager.IsOffline);let s="",i="",a=l.a.document.SetTempInvDocumentPostPayroll(t);e=a.obj;let o=a;s=null!=o&&o.Tables.length>0&&o.Tables[o.Tables.length-1].length>0&&o.Tables[o.Tables.length-1].some(e=>e.hasOwnProperty("ErrorMessage"))?o.Tables[o.Tables.length-1][0].ErrorMessage.toString():"Problem in processing your request,Please contact administrator.",e>0?null!=o&&o.Tables.length>0&&o.Tables[o.Tables.length-1].length>0&&o.Tables[o.Tables.length-1].some(e=>e.hasOwnProperty("VoucherNo"))&&(i=o.Tables[o.Tables.length-1][0].VoucherNo.toString()):null!=o&&o.Tables.length>0&&o.Tables[o.Tables.length-1].length>0&&o.Tables[o.Tables.length-1].some(e=>e.hasOwnProperty("ServerMessage"))&&(this.Failed+=this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpCode+",",this.FailedCount++,e="-407"==o.Tables[o.Tables.length-1][0].ServerMessage.toString()?-407:-12345),this.strResult+=s,this.EmployeesList.Table[this.lstSelectedEmps[this.iEmpIndex]].Result=this.strResult,this.EmployeesList.updateRow(this.EmployeesList.Table[this.lstSelectedEmps[this.iEmpIndex]])}else this.Failed+=this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpCode+",",this.FailedCount++;Logger.InfoLog("PostPayrollViewModel::Exiting btnPost_Click()")}catch(e){this.strResult+=e.message,Logger.ErrorLog("PostPayrollViewModel::EXCEPTION btnPost_Click()",e)}this.EmployeesList.Table[this.lstSelectedEmps[this.iEmpIndex]].Result=this.strResult,this.EmployeesList.updateRow(this.EmployeesList.Table[this.lstSelectedEmps[this.iEmpIndex]])}GetDocumentXML(){let e,t="",s="",i="",a="",o="",n="",r=[],h=" dcAlpha1='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].BasicMonthly+"',dcAlpha3='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary+"',dcAlpha4='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].TotalDays+"',dcAlpha5='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].DaysAttended+"',dcAlpha6='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].TotalLeaves+"',dcAlpha7='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].WeeklyOffs+"',dcAlpha8='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].Holidays+"',dcAlpha9='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays+"',dcAlpha10='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].UnpaidDays+"', dcAlpha11='"+(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarnings+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totOTAmount)+"',dcAlpha12='"+(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDeductions+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totLoans)+"',dcAlpha13='0'";l.a.SessionManager.Preferences.ContainsKey("ShowPaymentModeselectionWhilePayrollProcessing")&&"True"==l.a.SessionManager.Preferences.ShowPaymentModeselectionWhilePayrollProcessing&&"Default"!=this.objEmpFilter.PaymentModes.SelectedValue?(h+=",dcAlpha14='"+this.objEmpFilter.PaymentModes.SelectedValue.toString()+"'",h+="Bank Transfer"==this.objEmpFilter.PaymentModes.SelectedValue?",dcAlpha15='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank.toString()+"',dcAlpha16='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].BankAccNo.toString()+"'":",dcAlpha15='',dcAlpha16=''"):(h+=",dcAlpha14='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].PaymentMode.toString()+"'","Bank Transfer"==d.e.String(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].PaymentMode)?h+=",dcAlpha15='"+d.e.String(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank)+"',dcAlpha16='"+d.e.String(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].BankAccNo)+"'":h+=",dcAlpha15='',dcAlpha16=''"),h+=",dcAlpha17='"+l.a.SessionManager.PayrollMonthStart.ToString("dd/MMM/yyyy")+"',dcAlpha18='"+l.a.SessionManager.PayrollMonthEnd.ToString("dd/MMM/yyyy")+"', dcAlpha19='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totOTHours+"',dcAlpha20='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totOTAmount+"', dcAlpha21='',dcAlpha22=''",h+=",dcAlpha23='' ",h+=",dcAlpha24='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].PaidLeaves+"' ",h+=",dcAlpha25='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totActEarnings+"' ",h+=",dcAlpha26='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarArrears+"' ",h+=",dcAlpha27='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarAdjustments+"' ",h+=",dcAlpha28='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totActDeductions+"' ",h+=",dcAlpha29='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedArrears+"' ",h+=",dcAlpha30='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedAdjustments+"' ",h+=",dcAlpha31='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totLoans+"' ",l.a.SessionManager.Preferences.ContainsKey("ShowPaymentModeselectionWhilePayrollProcessing")&&"True"==l.a.SessionManager.Preferences.ShowPaymentModeselectionWhilePayrollProcessing&&"Default"!=this.objEmpFilter.PaymentModes.SelectedValue?h+="Bank Transfer"==this.objEmpFilter.PaymentModes.SelectedValue?",dcAlpha34='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].IBANNo.toString()+"'":",dcAlpha34=''":"Bank Transfer"==this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].PaymentMode.toString()?h+=",dcAlpha34='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].IBANNo.toString()+"'":h+=",dcAlpha34=''",i+='<Alpha Query="',i+=h,o+=" ",o.length>0&&(i+=","+o),i+='" ></Alpha>',o="",a+='<CostCenters Query="',o+=" dcCCNID51="+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+",",o+=" dcCCNID53="+this.oCMP.arrLstOthMPFields[this.iEmpIndex].GradeID+",",""==d.e.String(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank)||"0"==d.e.String(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank)||"Cash"==d.e.String(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].PaymentMode)?o+=" dcCCNID68=1,":o+=" dcCCNID68="+d.e.String(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank)+",",r.push("dcCCNID51"),r.push("dcCCNID53"),r.push("dcCCNID68");let m="",p="";if(null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAsOnDim&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAsOnDim.length>0)for(let l=0;l<Object.keys(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAsOnDim[0]).length;l++)m=Object.keys(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAsOnDim[0])[l],p=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAsOnDim[0][m],m.Contains("CCNID")&&"CCNID51"!=m&&"CCNID53"!=m&&"CCNID68"!=m&&(o+=" dc"+m+"="+p+",",r.Contains("dc"+m)||r.push("dc"+m));if(o.length>0&&(a+=o),a+='" ></CostCenters>',s+='" ProductID="'+this.DefProdID+'" Quantity="0',s+='" Unit="1" UOMConversion="1" UOMConvertedQty="0',s+='" Rate="0" Gross="0" IsQtyIgnored="1" AverageRate="0',s+='" StockValue="0" StockValueFC="0" RefNO="',s+='" BillDate="'+l.a.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy"),s+='" CurrencyID="'+this.oCMP.arrLstOthMPFields[this.iEmpIndex].CurrencyID+'" ExchangeRate="1',s+='" DebitAccount="'+this.sDrAccount+'" CreditAccount="'+this.sCrAccount,s+='" CommonNarration="'+d.e.EncodeXML("POSTED FROM POST PAYROLL"),this.oCMP.arrLstCPFields[this.iEmpIndex][0].length>0){if(t+="\x11",t+="<Row>",t+="<AccountsXML></AccountsXML>",t+='<Transactions DocSeqNo="1" VoucherType="11',t+='" LinkedInvDocDetailsID="0" LinkedFieldName="',t+='" LineNarration="Earning',n="",null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&(e=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.filter(e=>e.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&11==e.VoucherType),null!=e&&e.length>0&&(n=e[0].InvDocDetailsID.toString())),t+=n.length>0?'" DocDetailsID="'+n:'" DocDetailsID="',t+=s.toString()+'" ></Transactions>',o="",t+='<Numeric Query="',this.oCMP.arrLstCPFields[this.iEmpIndex][0].length>0)for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;e++)null!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].SNo&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].SNo.toString()&&(o+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].dActual.Replace(",","")+",",o+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].dEarned.Replace(",","")+",",o+=" dcExchRT"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].dArrear.Replace(",","")+",",o+=" dcCalcNumFC"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].dAdjusted.Replace(",","")+",");if(this.oCMP.arrLstCPFields[this.iEmpIndex][1].length>0)for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][1].length;e++)null!=this.oCMP.arrLstCPFields[this.iEmpIndex][1][e].SNo&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][1][e].SNo.toString()&&(o+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][1][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][1][e].dActual.Replace(",","")+",",o+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][1][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][1][e].dEarned.Replace(",","")+",");o.length>0&&(t+=o),t+='" ></Numeric>',t+=i.toString(),t+=a.toString(),t+="<EXTRAXML></EXTRAXML>",t+="</Row>"}if(this.oCMP.arrLstCPFields[this.iEmpIndex][2].length>0){if(t+="\x11",t+="<Row>",t+="<AccountsXML></AccountsXML>",t+='<Transactions DocSeqNo="2" VoucherType="12',t+='" LinkedInvDocDetailsID="0" LinkedFieldName="',t+='" LineNarration="Deduction',n="",null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&(e=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[6].filter(e=>e.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&12==e.VoucherType),null!=e&&e.length>0&&(n=e[0].InvDocDetailsID.toString())),t+=n.length>0?'" DocDetailsID="'+n:'" DocDetailsID="',t+=s.toString()+'" ></Transactions>',o="",t+='<Numeric Query="',this.oCMP.arrLstCPFields[this.iEmpIndex][2].length>0)for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;e++)null!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].SNo&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].SNo.toString()&&(o+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].dActual.Replace(",","")+",",o+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].dEarned.Replace(",","")+",",o+=" dcExchRT"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].dArrear.Replace(",","")+",",o+=" dcCalcNumFC"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].dAdjusted.Replace(",","")+",");o.length>0&&(t+=o),t+='" ></Numeric>',t+=i.toString(),t+=a.toString(),t+="<EXTRAXML></EXTRAXML>",t+="</Row>"}if(this.oCMP.arrLstCPFields[this.iEmpIndex][4].length>0&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].iExtLoansCnt>0){if(t+="\x11",t+="<Row>",t+="<AccountsXML></AccountsXML>",t+='<Transactions DocSeqNo="3" VoucherType="13',t+='" LinkedInvDocDetailsID="0" LinkedFieldName="',t+='" LineNarration="Loan',n="",null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&(e=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[6].filter(e=>e.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&13==e.VoucherType),null!=e&&e.length>0&&(n=e[0].InvDocDetailsID.toString())),t+=n.length>0?'" DocDetailsID="'+n:'" DocDetailsID="',t+=s.toString()+'" ></Transactions>',o="",t+='<Numeric Query="',this.oCMP.arrLstCPFields[this.iEmpIndex][4].length>0)for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][4].length;e++)null!=this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].SNo&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].SNo.toString()&&1==this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].IsVisible&&(o+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].LoanActInstAmt.Replace(",","")+",",o+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].LoanInstAmt.Replace(",","")+",",o+=" dcExchRT"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].LoanBalAmt.Replace(",","")+",",o+=" dcCalcNumFC"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].LoanPayStatus+",");o.length>0&&(t+=o),t+='" ></Numeric>',t+=i.toString(),t+=a.toString(),t+="<EXTRAXML></EXTRAXML>",t+="</Row>"}if(this.oCMP.arrLstCPFields[this.iEmpIndex][5].length>0){if(t+="\x11",t+="<Row>",t+="<AccountsXML></AccountsXML>",t+='<Transactions DocSeqNo="4" VoucherType="14',t+='" LinkedInvDocDetailsID="0" LinkedFieldName="',t+='" LineNarration="Leave',n="",null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&(e=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[6].filter(e=>e.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&14==e.VoucherType),null!=e&&e.length>0&&(n=e[0].InvDocDetailsID.toString())),t+=n.length>0?'" DocDetailsID="'+n:'" DocDetailsID="',t+=s.toString()+'" ></Transactions>',o="",t+='<Numeric Query="',this.oCMP.arrLstCPFields[this.iEmpIndex][5].length>0)for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][5].length;e++)null!=this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].SNo&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].SNo.toString()&&(o+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].LeaveTotOPBal.Replace(",","")+",",o+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].LeaveTaken.Replace(",","")+",",o+=" dcExchRT"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].LeaveMonOPBal.Replace(",","")+",",o+=" dcCalcNumFC"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].LeaveNetBal.Replace(",","")+",");o.length>0&&(t+=o),t+='" ></Numeric>',t+=i.toString(),t+=a.toString(),t+="<EXTRAXML></EXTRAXML>",t+="</Row>"}return t.toString()}GetActivityXML(){let e,t="",s="",i="";if(null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0)for(let l=0;l<this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length;l++)t+="~"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[l].InvDocDetailsID.toString();let a="";if(a+=null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0?t.length>0?'<XML DetailIds="'+t+'" AppRejDate="'+(new Date).ToString("dd/MMM/yyyy")+'" >':'<XML AppRejDate="'+(new Date).ToString("dd/MMM/yyyy")+'" >':t.length>0?'<XML DetailIds="'+t+'" >':"<XML>",this.oCMP.arrLstCPFields[this.iEmpIndex][4].length>0&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].iExtLoansCnt>0){let t,o,n,r,h,d,m="0";if(s=i="",null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay.length>0&&(m=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay[0].DocID.toString()),a+='<LoanRepaymentXML DocID="'+m+'" DocDetIDs="" WorkFlowID="0" >',a+="<DOCXML>",this.oCMP.arrLstCPFields[this.iEmpIndex][4].length>0){let m=0;null!=l.a.SessionManager.dtDocDefAccs&&(e=l.a.SessionManager.dtDocDefAccs.filter(e=>40057==e.CostCenterID&&"CreditAccount"==e.SysColumnName),null!=e&&e.length>0&&null!=e[0].UserDefaultValue&&""!=e[0].UserDefaultValue.toString().Trim()&&(s=e[0].UserDefaultValue.toString()),e=l.a.SessionManager.dtDocDefAccs.filter(e=>40057==e.CostCenterID&&"DebitAccount"==e.SysColumnName),null!=e&&e.length>0&&null!=e[0].UserDefaultValue&&""!=e[0].UserDefaultValue.toString().Trim()&&(i=e[0].UserDefaultValue.toString()));for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][4].length;e++)if(null!=this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].SNo&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].SNo.toString()&&1==this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].IsVisible&&null!=this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].LoanInstAmt&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].LoanInstAmt.toString()){t=this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].LoanDocNo,n=this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].LoanActInstNo,h=3==parseInt(this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].LoanPayStatus)?this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].LoanActInstAmt.Replace(",",""):this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].LoanInstAmt.Replace(",","");let p=parseInt(n);this.oCMP.arrLstOthMPFields[this.iEmpIndex].IsAlreadyProcessed?(d=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[11].filter(e=>e.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&e.RefNo==t&&new Date(e.dcAlpha5)==l.a.SessionManager.PayrollMonth),null!=d&&d.length>0&&(p=parseInt(d[0].dcNum1))):(l.a.SessionManager.Preferences.ContainsKey("ShowLoanBalRespDedMonthWhilePayProc")&&"True"==l.a.SessionManager.Preferences.ShowLoanBalRespDedMonthWhilePayProc?(d=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[10].filter(e=>e.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&e.RefNo==t&&e.InstallmentNo==p),d.SortBy([{name:"InstallmentNo",parser:parseInt}])):(d=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[10].filter(e=>e.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&e.DocNo==t&&e.InstBalance>0&&e.InstallmentNo<p),d.SortBy([{name:"InstallmentNo",parser:parseInt}])),null!=d&&d.length>0&&(p=parseInt(d[0].InstallmentNo)));let C=parseFloat(h),c=0,g=0;do{m++,d=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[10].filter(e=>e.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&e.DocNo==t&&e.InstallmentNo==p),d.length>0?(o=d[0].InvDocDetailsID.toString(),r=d[0].InstallmentAmt.toString().Replace(",",""),c=C>parseFloat(d[0].InstBalance)?parseFloat(d[0].InstBalance):C,a+="<RowHead/>",a+="<Row>",a+="<AccountsXML></AccountsXML>",a+='<Transactions DocSeqNo="'+m+'"  DocDetailsID="0" LinkedInvDocDetailsID="'+o+'" LinkedFieldName="dcNum3" LineNarration="',a+='" ProductID="'+this.DefProdID+'" IsScheme="" Quantity="1" Unit="1" UOMConversion="1" UOMConvertedQty="1',a+='" Rate="0" Gross="0" RefNO="'+t+'" LinkedFieldValue="'+c+'" IsQtyIgnored="1" AverageRate="0',a+='" StockValue="0" StockValueFC="0" CurrencyID="1" ExchangeRate="1"  DebitAccount="'+i+'"  CreditAccount="'+s+'"  ></Transaction>',a+='<Numeric Query="dcNum1='+p+", dcCalcNum1="+p+", dcNum2="+r.Replace(",","")+", dcCalcNum2="+r.Replace(",","")+", dcNum3="+c.toString().Replace(",","")+", dcCalcNum3="+c.toString().Replace(",","")+', " ></Numeric>',a+="<Alpha Query=\"dcAlpha1=N'"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].LoanApprovedAmt+"',dcAlpha2=N'"+(parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].LoanBalAmt)-g)+"', dcAlpha3=N'"+h+"', dcAlpha4=N'"+new Date(d[0].DeductionMonth).ToString("dd/MMM/yyyy")+"', dcAlpha5=N'"+l.a.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"',dcAlpha6=N'1',dcAlpha7=N'"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].LoanPayStatus+"', \" ></Alpha>",a+='<CostCenters Query="dcCCNID51='+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+", dcCCNID52="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].ComponentID+', " ></CostCenters>',a+="<EXTRAXML></EXTRAXML>",a+="</Row>",g+=c,C-=c,p++):C=0}while(C>0)}}a+="</DOCXML>",a+="<BillXML></BillXML></LoanRepaymentXML>"}if(this.chkPostBasedOnDailyAttendance.IsChecked&&l.a.SessionManager.Preferences.ContainsKey("CaputureDimensionData")&&"True"==l.a.SessionManager.Preferences.CaputureDimensionData.toString()){let t,s="",i="",o="",n="",r="";if(null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcADWData.length>0){o=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcADWData[0].DocID.toString();for(let e=0;e<this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcADWData.length;e++)n+="~"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcADWData[e].InvDocDetailsID.toString()}t=r="",null!=l.a.SessionManager.dtDocDefAccs&&(e=l.a.SessionManager.dtDocDefAccs.filter(e=>40079==e.CostCenterID&&"CreditAccount"==e.SysColumnName),null!=e&&e.length>0&&null!=e[0].UserDefaultValue&&""!=e[0].UserDefaultValue.toString().Trim()&&(t=e[0].UserDefaultValue.toString()),e=l.a.SessionManager.dtDocDefAccs.filter(e=>40079==e.CostCenterID&&"DebitAccount"==e.SysColumnName),null!=e&&e.length>0&&null!=e[0].UserDefaultValue&&""!=e[0].UserDefaultValue.toString().Trim()&&(r=e[0].UserDefaultValue.toString())),a+='<AttendanceDimensionwiseXML DocID="'+o+'" DocDetIDs="'+n+'" WorkFlowID="0" >',a+="<DOCXML>";let h=null;if(null!=this.dsDailyAttendanceData&&this.dsDailyAttendanceData.Tables.length>0&&(h=this.dsDailyAttendanceData.Tables[0].filter(e=>e.EMPNODE==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo)),null!=h&&h.length>0){let e,o,n,m,p=[],C=[];C.push("EMPNODE");for(let t=0;t<this.dsDailyAttendanceData.Tables[3].length;t++)C.push(this.dsDailyAttendanceData.Tables[3][t].Data.toString());C.push("OT1"),C.push("OT2"),C.push("OT3"),C.push("OT4"),C.push("OT5"),C.push("DAYSATTENDED"),C.push("ABSENTDAYS"),C.push("Leaves"),C.push("TOTALOTAMOUNT");for(let t=0;t<h.length;t++)if(o=this.ApplyFilter(p,h[t]),null!=o&&o.length>0)for(let e=0;e<C.length;e++)C[e].startsWith("OT")&&(o[0][C[e]]=d.e.SUMHoursAndMinutes(o[0][C[e]].toString(),h[t][C[e]].toString()));else{e={},e.EMPNODE=h[t].EMPNODE;for(let s=1;s<C.length;s++)e[s]=h[t][C[s]];if(n=this.ApplyFilter(this.dsDailyAttendanceData.Tables[1],h[t]),null!=n&&n.length>0){if(m=this.ApplyFilter(this.dsDailyAttendanceData.Tables[2],h[t]),e.ABSENTDAYS=null!=m&&m.length>0?m[0].ABSENTDAYS:"0",null==this.dsDailyAttendanceData.Tables[4]||this.dsDailyAttendanceData.Columns[4].Contains("NODATA"))e.Leaves="0";else{let s=this.ApplyFilter(this.dsDailyAttendanceData.Tables[4],h[t]),i=0;if(null!=s&&s.Table.length>0){let e,t;i=0;for(let a=0;a<s.length;a++)e=new Date(s[a].FromDate),t=new Date(s[a].ToDate),e>=l.a.SessionManager.PayrollMonthStart?t<=l.a.SessionManager.PayrollMonthEnd?i+=parseFloat(s[a].Leaves):e<=l.a.SessionManager.PayrollMonthEnd&&(i+=this.oCMP.GetNoOfDays(e,l.a.SessionManager.PayrollMonthEnd,parseInt(s[a].ComponentID))):t<=l.a.SessionManager.PayrollMonthEnd?t>=l.a.SessionManager.PayrollMonthStart&&(i+=this.oCMP.GetNoOfDays(l.a.SessionManager.PayrollMonthStart,t,parseInt(s[a].ComponentID))):i+=this.oCMP.GetNoOfDays(l.a.SessionManager.PayrollMonthStart,l.a.SessionManager.PayrollMonthEnd,parseInt(s[a].ComponentID))}e.Leaves=i>0?i:"0"}e.DAYSATTENDED=parseFloat(n[0].DAYSATTENDED)-parseFloat(e.ABSENTDAYS),e.TOTALOTAMOUNT=n[0].TOTALOTAMOUNT}p.push(e)}let c="0";for(let h=0;h<p.length;h++){if(c="0",null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay.length>h&&(c=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay[h].InvDocDetailsID.toString()),s="",a+="<RowHead/>",a+="<Row>",a+="<AccountsXML></AccountsXML>",a+='<Transactions DocSeqNo="'+h+'"  DocDetailsID="'+c+'" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="',a+='" ProductID="'+this.DefProdID+'" IsScheme="" Quantity="1" Unit="1" UOMConversion="1" UOMConvertedQty="1',a+='" Rate="0" Gross="0" RefNO="0" LinkedFieldValue="0" IsQtyIgnored="1" AverageRate="0',a+='" StockValue="0" StockValueFC="0" CurrencyID="1" ExchangeRate="1"  DebitAccount="'+r+'"  CreditAccount="'+t+'"  ></Transaction>',a+='<Numeric Query="dcNum1='+parseFloat(p[h].TOTALOTAMOUNT)+", dcCalcNum1="+parseFloat(p[h].TOTALOTAMOUNT)+", ",a+="dcNum5="+parseFloat(p[h].OT1)+", dcCalcNum5="+parseFloat(p[h].OT1)+", ",a+="dcNum7="+parseFloat(p[h].OT2)+", dcCalcNum7="+parseFloat(p[h].OT2)+", ",a+="dcNum9="+parseFloat(p[h].OT3)+", dcCalcNum9="+parseFloat(p[h].OT3)+", ",a+="dcNum11="+parseFloat(p[h].OT4)+", dcCalcNum11="+parseFloat(p[h].OT4)+", ",a+="dcNum13="+parseFloat(p[h].OT5)+", dcCalcNum13="+parseFloat(p[h].OT5)+", ",a+='" ></Num>',a+="<Alpha Query=\"dcAlpha1=N'"+l.a.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"',dcAlpha2=N'"+parseFloat(p[h].DAYSATTENDED)+"', dcAlpha3=N'"+parseFloat(p[h].ABSENTDAYS)+"', dcAlpha4=N'"+parseFloat(p[h].Leaves)+"', \" ></Alpha>",a+='<CostCenters Query="',s+=" dcCCNID51="+parseInt(p[h].EMPNODE)+",",this.dsDailyAttendanceData.Tables[3].length>0){i="";for(let e=0;e<this.dsDailyAttendanceData.Tables[3].length;e++)i=this.dsDailyAttendanceData.Tables[3][e].Data.toString(),s+=" "+i+"="+parseInt(p[h][i])+","}s.length>0&&(a+=s),a+='" ></CostCenters>',a+="<EXTRAXML></EXTRAXML>",a+="</Row>"}}a+="</DOCXML>",a+="</AttendanceDimensionwiseXML>"}return this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanCrNetSalLessZero.length>0&&(a+='<DelLoanXML DocID="'+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanCrNetSalLessZero[0].DocID.toString()+'" > </DelLoanXML>'),s=i="",this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary<0&&"True"==l.a.SessionManager.Preferences.CreateLoanIfNetSalLessThanZero&&parseInt(l.a.SessionManager.Preferences.CreateLoanType)>0&&(null!=l.a.SessionManager.dtDocDefAccs&&(e=l.a.SessionManager.dtDocDefAccs.filter(e=>40056==e.CostCenterID&&"CreditAccount"==e.SysColumnName),null!=e&&e.length>0&&null!=e[0].UserDefaultValue&&""!=e[0].UserDefaultValue.toString().Trim()&&(s=e[0].UserDefaultValue.toString()),e=l.a.SessionManager.dtDocDefAccs.filter(e=>40056==e.CostCenterID&&"DebitAccount"==e.SysColumnName),null!=e&&e.length>0&&null!=e[0].UserDefaultValue&&""!=e[0].UserDefaultValue.toString().Trim()&&(i=e[0].UserDefaultValue.toString())),a+='<CreateLoanXML DocID="" DocDetIDs="" WorkFlowID="0" >',a+="<DOCXML>",a+="<RowHead/>",a+="<Row>",a+="<AccountsXML></AccountsXML>",a+='<Transactions DocSeqNo="1"  DocDetailsID="0" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="" CommonNarration="LOAN CREATED FROM MONTHLY PAYROLL WHEN NET SALARY LESS THAN 0',a+='" Rate="0" Gross="0" RefNO="0" IsQtyIgnored="1" AverageRate="0',a+='" StockValue="0" StockValueFC="0" CurrencyID="1" ExchangeRate="1"  DebitAccount="'+i+'"  CreditAccount="'+s+'"  ></Transaction>',a+='<Numeric Query="dcNum1=1, dcCalcNum1=1, dcNum2='+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+", dcCalcNum2="+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+', " ></Numeric>',a+="<Alpha Query=\"dcAlpha6=N'"+l.a.SessionManager.PayrollMonth.AddMonths(1).ToString("dd/MMM/yyyy")+"',dcAlpha1=N'"+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+"', dcAlpha2=N'"+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+"', dcAlpha4=N'1', dcAlpha3=N'"+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+"',dcAlpha5=N'"+l.a.SessionManager.PayrollMonth.AddMonths(1).ToString("dd/MMM/yyyy")+"',dcAlpha7=N'"+l.a.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"', \" ></Alpha>",a+='<CostCenters Query="dcCCNID51='+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+", dcCCNID52="+l.a.SessionManager.Preferences.CreateLoanType+', " ></CostCenters>',a+="<EXTRAXML></EXTRAXML>",a+="</Row>",a+="</DOCXML>",a+="<BillXML></BillXML></CreateLoanXML>"),a+="</XML>",a.toString()}ApplyFilter(e,t){let s=e.filter(e=>e.EMPNODE==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo);for(let i=0;i<this.dsDailyAttendanceData.Tables[3].length;i++)s=s.filter(e=>e.this.dsDailyAttendanceData.Tables[3][i].Data.toString()==t[this.dsDailyAttendanceData.Tables[3][i].Data.toString()]);return s}}var v=s("c42x"),V=s("n56n"),w=s("Huqd"),k=s("CUWK"),G=s("MCKn");class _ extends c.b{constructor(e){super(),this.ProgressVisibility=!1,this.ProgressValue=0,this.ProgressMax=0,this.DialogResult=!1,this.PostVisiblility=!0,this._SelectAll=!1,this.ChkBtnPostOnlyFirstAndLastTrans=new x.a,this.PostOnlyFirstInLastOut=!1,this.PostOnlyFirstInLastOutVisibility=!0,this.btnCancelFlag=!1,this.SelectUnCheck=0,this.dsEmps=null,this.sEmpSeqNosOnGrid="",this.sFilter="",this.iPostDocType=0,this.iEmpIndex=0,this.strResult="",this.Failed="",this.FailedCount=0,this.DefProdID=0;try{this.DisplayName=e,this.Title=e,this.DisplayMessage="",this.btnCancelFlag=!1,this.LoadGrid(),this.btnFilter_Click()}catch(t){Logger.ErrorLog("PostAttTimeSheetToDailyAttViewModel::EXCEPTION PostAttTimeSheetToDailyAttViewModel()",t)}}get SelectAll(){return this._SelectAll}set SelectAll(e){e!=this._SelectAll&&(this._SelectAll=e,this.SelectUnselectAll(e))}set RefreshGrid(e){}LoadGrid(){this.dgv=new C.a,this.dgv.Height=0,this.dgv.SelectAll.Visible=!0,this.dgv.CanUserDeleteRows=!0,this.dgv.Table=[],this.dgv.TableColumns.push("Select"),this.dgv.TableColumns.push("SNo"),this.dgv.TableColumns.push("EmpSeqNo"),this.dgv.TableColumns.push("EmpCode"),this.dgv.TableColumns.push("EmpName"),this.dgv.TableColumns.push("VoucherNo"),this.dgv.TableColumns.push("CheckInDate"),this.dgv.TableColumns.push("CheckInTime"),this.dgv.TableColumns.push("CheckOutDate"),this.dgv.TableColumns.push("CheckOutTime"),this.dgv.TableColumns.push("TotalTime"),this.dgv.TableColumns.push("Result"),this.dgv.TableColumns.push("Row_Background"),this.dgv.TableColumns.push("InvDocDetailsID");let e,t=new y.a;if(this.dgv.Columns=new Array,t=new y.a,t.Header="Select",t.DisplayMember="Select",t.DataType="CheckBox",t.Width=50,t.CheckedChanged.Subscribe(this,"dgColSelect_CheckedChanged"),this.dgv.Columns.push(t),t=new y.a,t.Header="#",t.DisplayMember="SNo",t.DataType="TextBlock",t.Width=40,t.ReadOnly=!0,this.dgv.Columns.push(t),t=new y.a,t.Header="Employee Code",t.DisplayMember="EmpCode",t.DataType="TextBlock",t.Width=100,t.ReadOnly=!0,this.dgv.Columns.push(t),t=new y.a,t.Header="Employee Name",t.DisplayMember="EmpName",t.DataType="TextBlock",t.Width=220,t.ReadOnly=!0,this.dgv.Columns.push(t),t=new y.a,t.Header="Voucher No.",t.DisplayMember="VoucherNo",t.DataType="LINK_VOUCHER",t.Width=180,t.ReadOnly=!0,this.dgv.Columns.push(t),t=new y.a,t.Header="Check-in Date",t.DisplayMember="CheckInDate",t.DataType="TextBlock",t.Width=120,t.ReadOnly=!0,t.TextAlign="Center",this.dgv.Columns.push(t),t=new y.a,t.Header="Check-in Time",t.DisplayMember="CheckInTime",t.DataType="TextBlock",t.Width=120,t.ReadOnly=!0,t.TextAlign="Center",this.dgv.Columns.push(t),t=new y.a,t.Header="Check-out Date",t.DisplayMember="CheckOutDate",t.DataType="TextBlock",t.Width=120,t.ReadOnly=!0,t.TextAlign="Center",this.dgv.Columns.push(t),t=new y.a,t.Header="Check-out Time",t.DisplayMember="CheckOutTime",t.DataType="TextBlock",t.Width=120,t.ReadOnly=!0,t.TextAlign="Center",this.dgv.Columns.push(t),t=new y.a,t.Header="Total Time",t.DisplayMember="TotalTime",t.DataType="TextBlock",t.Width=100,t.ReadOnly=!0,t.TextAlign="Center",this.dgv.Columns.push(t),t=new y.a,t.Header="Result",t.DisplayMember="Result",t.DataType="TextBlock",t.Width=200,t.ReadOnly=!0,this.dgv.Columns.push(t),this.dsCols=l.a.common.GetDataSet("PAY062",""),null!=this.dsCols&&this.dsCols.Tables.length>0&&(e=this.dsCols.Tables[0].filter(e=>1==e.IsColumnInUse),null!=e&&e.length>0))for(let s=0;s<e.length;s++)t=new y.a,t.Header=e[s].USERCOLUMNNAME.toString(),t.DisplayMember=e[s].SysColumnName.toString(),t.ID=e[s].SysColumnName.toString(),t.DataType="LISTBOX",t.CostCenterID=parseInt(e[s].ColumnCostCenterID),t.TypeID=parseInt(e[s].ColumnCCListViewTypeID),t.ReadOnly=!0,t.Width=120,this.dgv.Columns.push(t),this.dgv.TableColumns.push(t.DisplayMember),t=new y.a,t.DisplayMember=e[s].SysColumnName.toString()+"_Key",t.IsVisible=!1,this.dgv.Columns.push(t),this.dgv.TableColumns.push(t.DisplayMember)}dgColSelect_CheckedChanged(e,t){t||1==this.SelectAll&&(this.SelectUnCheck=1,this.SelectAll=!1)}SelectUnselectAll(e){for(let t=0;t<this.dgv.Table.length;t++)0==this.SelectUnCheck&&(this.dgv.Table[t].Select=e);this.SelectUnCheck=0}Button_Click(e){"Post"==e.toString()?this.btnPost_Click():"Clear"==e.toString()?this.btnClear_Click():"Filter"==e.toString()?this.btnFilter_Click():"Export"==e.toString()&&this.Export_Click()}Export_Click(){}btnClear_Click(){this.dgv.Clear(),this.SelectAll=!1,this.FailedCount=0,this.Failed="",this.InProgress="",this.lstSelectedEmps=new Array}btnPost_Click(){if(this.ValidatePosting()){let e,t,s="",i=null;if(89==this.iPostDocType?l.a.SessionManager.Preferences.ContainsKey("PostAttendanceDataGroupBy")&&""!=l.a.SessionManager.Preferences.PostAttendanceDataGroupBy&&(i=l.a.SessionManager.Preferences.PostAttendanceDataGroupBy.toString().split(",")):l.a.SessionManager.Preferences.ContainsKey("PostTimeSheetDataGroupBy")&&""!=l.a.SessionManager.Preferences.PostTimeSheetDataGroupBy&&(i=l.a.SessionManager.Preferences.PostTimeSheetDataGroupBy.toString().split(",")),null!=i){let a=this.GetGroupByFilterEmployees();if(null!=a&&a.length>0){let o="";if(null!=i&&i.length>0){for(let e=0;e<i.length;e++)d.e.IsEmptySpace(i[e])||(o.length>0&&(o+=","),o+="-1"==i[e]?"RptManager":"-2"==i[e]?"EmpSeqNo":"CCNID"+(parseInt(i[e])-5e4));if(o.length>0){let i=a.ToTable(!0,o.split(","));if(null!=i&&i.length>0){this.dgv.TableColumns.Contains("Flag")&&this.dgv.TableColumns.Remove("Flag"),this.dgv.TableColumns.push("Flag");for(let o=0;o<i.length;o++){let o=a;for(let e=0;e<Object.keys(i[0]).length;e++){let t=Object.keys(i[0])[e],s=i[0][t];o=o.filter(e=>e[t]==d.e.String(s))}Object.keys(i[0]).length>0&&o.length>0&&k.RibbonExtViewModel.GetDocumentObject(40067,"",!1,"PostAttTimeSheet").then(i=>{i.ScreenObject.GridData.Clear();let a=-1;for(let s=0;s<this.dgv.Table.length;s++)if(Object(p.j)(this.dgv.Table[s].Select)&&(t=this.dtData.filter(e=>e.InvDocDetailsID==this.dgv.Table[0].InvDocDetailsID),null!=t&&t.length>0&&"1"!=d.e.String(this.dgv.Table[s].Flag)&&o.filter(e=>e.EmpCode==t[0].EmpCode.toString()).length>0)){if(this.dgv.Table[s].Flag="1",a++,e=i.ScreenObject.GridDataObj.NewRow(),i.ScreenObject.GridDataObj.addRow(e),i.ScreenObject.GridDataColumns.Contains("dcCCNID51Code")&&(i.ScreenObject.GridData[a].dcCCNID51Code=t[0].EmpCode),i.ScreenObject.GridData[a].dcCCNID51_key=t[0].EmpSeqNo,i.ScreenObject.GridData[a].dcCCNID51=t[0].EmpName,i.FillDefaultProd(i.ScreenObject.GridData[a],"dcCCNID51"),i.ScreenObject.GridDataColumns.Contains("RefNo")&&(i.ScreenObject.GridData[a].RefNo=t[0].InvDocDetailsID),i.ScreenObject.GridData[a].dcAlpha1=new Date(t[0].CheckInDate).ToString(l.a.SessionManager.Preferences["Date Format"]),i.ScreenObject.GridData[a].dcAlpha1_Key=new Date(t[0].CheckInDate),i.Celleditend(i.ScreenObject.GridData[a],"dcCCNID51",0),i.ScreenObject.GridData[a].dcAlpha2=new Date(t[0].CheckInTime).ToString("HH:mm"),i.ScreenObject.GridData[a].dcAlpha2_Key=new Date(t[0].CheckInTime),i.ScreenObject.GridData[a].dcAlpha3=new Date(t[0].CheckOutTime).ToString("HH:mm"),i.ScreenObject.GridData[a].dcAlpha3_Key=new Date(t[0].CheckOutTime),i.Celleditend(i.ScreenObject.GridData[a],"dcAlpha3",40067),i.ScreenObject._CCFields.length>0)for(let e=0;e<i.ScreenObject._CCFields.length;e++)"DCCCNID51"!=i.ScreenObject._CCFields[e].DBColumnName.toUpperCase()&&(i.ScreenObject.GridDataColumns.Contains(i.ScreenObject._CCFields[e].DBColumnName+"_key")?i.ScreenObject.GridData[a][i.ScreenObject._CCFields[e].DBColumnName+"_key"]=t[0][i.ScreenObject._CCFields[e].DBColumnName].toString():(i.ScreenObject._CCFields[e]instanceof V.b||i.ScreenObject._CCFields[e]instanceof w.a)&&(i.ScreenObject._CCFields[e].SelectedValue=parseInt(t[0][i.ScreenObject._CCFields[e].DBColumnName])));for(let e=0;e<i.ScreenObject.GridDataColumns.length;e++)!i.ScreenObject.GridDataColumns[e].startsWith("dcCCNID")||i.ScreenObject.GridDataColumns[e].endsWith("_Key")||i.ScreenObject.GridDataColumns[e].endsWith("Code")||"DCCCNID51"!=i.ScreenObject.GridDataColumns[e].toUpperCase()&&(i.ScreenObject.GridData[a][i.ScreenObject.GridDataColumns[e]+"_Key"]=t[0][i.ScreenObject.GridDataColumns[e]]);i.CalculateTotals(i.ScreenObject.GridData[a],!1),i.ScreenObject.GridDataObj.updateRow(i.ScreenObject.GridData[a]),i.ScreenObject.GridDataObj.RefreshGrid=!0}d.e.IsEmptySpace(s)||(i.DisplayMessage=s,i.MessageVisibility=!0),i.UpdateFooter=!0,i.RefreshGrid=!0,l.a.page.addNewTab({title:i.DisplayName,component:G.AddEditDocumentComponent,params:{obj:i}});var n=i.ScreenObject._StaticFields.find(e=>"CommonNarration"==e.DBColumnName);null!=n&&(n.SetFocus=!0)})}}}}}}else k.RibbonExtViewModel.GetDocumentObject(40067,"",!1,"PostAttTimeSheet").then(i=>{i.ScreenObject.GridData.Clear();let a=-1;for(let s=0;s<this.dgv.Table.length;s++)if(Object(p.j)(this.dgv.Table[s].Select)&&(t=this.dtData.filter(e=>e.InvDocDetailsID==this.dgv.Table[s].InvDocDetailsID.toString()),null!=t&&t.length>0)){if(a++,e=i.ScreenObject.GridDataObj.NewRow(),i.ScreenObject.GridDataObj.addRow(e),i.ScreenObject.GridDataColumns.Contains("dcCCNID51Code")&&(i.ScreenObject.GridData[a].dcCCNID51Code=t[0].EmpCode),i.ScreenObject.GridData[a].dcCCNID51_key=t[0].EmpSeqNo,i.ScreenObject.GridData[a].dcCCNID51=t[0].EmpName,i.FillDefaultProd(i.ScreenObject.GridData[a],"dcCCNID51"),i.ScreenObject.GridDataColumns.Contains("RefNo")&&(i.ScreenObject.GridData[a].RefNo=t[0].InvDocDetailsID),i.ScreenObject.GridData[a].dcAlpha1=new Date(t[0].CheckInDate).ToString(l.a.SessionManager.Preferences["Date Format"]),i.ScreenObject.GridData[a].dcAlpha1_Key=new Date(t[0].CheckInDate),i.Celleditend(i.ScreenObject.GridData[a],"dcCCNID51",0),i.ScreenObject.GridData[a].dcAlpha2=new Date(t[0].CheckInTime).ToString("HH:mm"),i.ScreenObject.GridData[a].dcAlpha2_Key=new Date(t[0].CheckInTime),i.ScreenObject.GridData[a].dcAlpha3=new Date(t[0].CheckOutTime).ToString("HH:mm"),i.ScreenObject.GridData[a].dcAlpha3_Key=new Date(t[0].CheckOutTime),i.Celleditend(i.ScreenObject.GridData[a],"dcAlpha3",40067),i.ScreenObject._CCFields.length>0)for(let e=0;e<i.ScreenObject._CCFields.length;e++)"DCCCNID51"!=i.ScreenObject._CCFields[e].DBColumnName.toUpperCase()&&(i.ScreenObject.GridDataColumns.Contains(i.ScreenObject._CCFields[e].DBColumnName+"_key")?i.ScreenObject.GridData[a][i.ScreenObject._CCFields[e].DBColumnName+"_key"]=t[0][i.ScreenObject._CCFields[e].DBColumnName].toString():(i.ScreenObject._CCFields[e]instanceof V.b||i.ScreenObject._CCFields[e]instanceof w.a)&&(i.ScreenObject._CCFields[e].SelectedValue=parseInt(t[0][i.ScreenObject._CCFields[e].DBColumnName])));for(let e=0;e<i.ScreenObject.GridDataColumns.length;e++)i.ScreenObject.GridDataColumns[e].startsWith("dcCCNID")&&!i.ScreenObject.GridDataColumns[e].endsWith("_Key")&&"DCCCNID51"!=i.ScreenObject.GridDataColumns[e].toUpperCase()&&(i.ScreenObject.GridData[a][i.ScreenObject.GridDataColumns[e]+"_Key"]=t[0][i.ScreenObject.GridDataColumns[e]]);i.CalculateTotals(i.ScreenObject.GridData[a],!1),i.ScreenObject.GridDataObj.updateRow(i.ScreenObject.GridData[a]),i.ScreenObject.GridDataObj.RefreshGrid=!0}d.e.IsEmptySpace(s)||(i.DisplayMessage=s,i.MessageVisibility=!0),i.UpdateFooter=!0,i.RefreshGrid=!0,l.a.page.addNewTab({title:i.DisplayName,component:G.AddEditDocumentComponent,params:{obj:i}});var o=i.ScreenObject._StaticFields.find(e=>"CommonNarration"==e.DBColumnName);o&&(o.SetFocus=!0)})}}GetGroupByFilterEmployees(){let e="  AND EmpSeqNo IN ("+this.sEmpSeqNosOnGrid+")",t=[];return t.push(Date.Today().ToString("dd MMM yyyy")),t.push(e),t.push(0),t.push(l.a.SessionManager.RoleID),t.push(l.a.SessionManager.UserID),t.push(l.a.SessionManager.LanguageID),l.a.empService.GetData(t,"spPAY_GetEmpMasterCCDetails").Tables[0]}ValidatePosting(){try{Logger.InfoLog("PostAttTimeSheetToDailyAttViewModel::Entering IsValidated()");{let e=0;for(let t=0;t<this.dgv.Table.length;t++)Object(p.j)(this.dgv.Table[t].Select)&&e++;if(0==e)return this.DisplayMessage="Select atleast one Document to post",!1;for(let t=0;t<this.dgv.Table.length;t++)if(Object(p.j)(this.dgv.Table[t].Select)&&(null==this.dgv.Table[t].CheckInTime||null==this.dgv.Table[t].CheckInTime||""==this.dgv.Table[t].CheckInTime.toString()||null==this.dgv.Table[t].CheckOutTime||null==this.dgv.Table[t].CheckOutTime||""==this.dgv.Table[t].CheckOutTime.toString()))return this.DisplayMessage="CheckInTime/CheckOutTime is empty at Row No. : "+(t+1).toString(),!1}return Logger.InfoLog("PostAttTimeSheetToDailyAttViewModel::Exiting IsValidated()"),!0}catch(e){return Logger.ErrorLog("PostAttTimeSheetToDailyAttViewModel::EXCEPTION IsValidated()"+e.stack),!1}}btnFilter_Click(){Logger.InfoLog("PostAttTimeSheetToDailyAttViewModel::Entering Filter_Click()"),null==this.objEmpFilter?this.objEmpFilter=new P.a("",0,10):(this.objEmpFilter.Filter=10,this.objEmpFilter.InitControls()),this.objEmpFilter.Filter>0?l.a.page.ShowDialog(this.objEmpFilter,L.a,{ShowCenter:!0,HideHeader:!0}).subscribe(()=>{this.btnFilter_Click_CallBack()}):this.btnFilter_Click_CallBack()}btnFilter_Click_CallBack(){if(this.DialogResult=this.objEmpFilter.IsCompleted,this.objEmpFilter.IsCompleted){if(this.sEmpSeqNosOnGrid="",this.objEmpFilter.CostCenterFilters.length>0){let e=1,t="",s="",i="";for(let a=0;a<this.objEmpFilter.CostCenterFilters.length;a++){let l=this.objEmpFilter.CostCenterFilters[a];if(l.CostCenterID>5e4&&(e=2,t="NodeID",s=50051==l.CostCenterID?"EmpSeqNo":"CCNID"+(l.CostCenterID-5e4)),l.SelectedNodes.length>0){if(1==l.SelectedNodes.length)i+=" AND ",i+=s+"="+l.SelectedNodes[0].Id;else if(!l.SelectedNodes.find(t=>t.Id==e&&t.IsGroup))if(i+=" AND ",D.IPrefetchFilter.IsGroupTree(l)){let e="";for(let t=0;t<l.SelectedNodes.length;t++)null!=l.SelectedNodes[t].Parent&&l.SelectedNodes[t].Parent.IsSelected||(e.length>0&&(e+=","),e+=l.SelectedNodes[t].Id);0==e.length&&(e+=-12912),i+=s+" IN ",i+=" (select T."+t+" GTID from "+u.b.GetTagTableName(l.CostCenterID)+" T with(nolock),"+u.b.GetTagTableName(l.CostCenterID)+" GTP with(nolock) where T.lft BETWEEN GTP.lft AND GTP.rgt AND GTP."+t+" IN (",i+=e.toString()+")  group by T."+t+")"}else{i+=s+" IN (";for(let e=0;e<l.SelectedNodes.length;e++)e>0&&(i+=","),i+=l.SelectedNodes[e].Id;i+=")"}}else l.DeleteButtonVisibility||(i+=" AND ",i+=s+"=-12912")}this.sFilter=i.toString()}this.FilterEmployees()}}FilterEmployees(){this.sEmpSeqNosOnGrid="",this.iPostDocType=this.objEmpFilter.rBtnPostAttDocs?89:90,this.ChkBtnPostOnlyFirstAndLastTrans.Visible=90==this.iPostDocType,this.ChkBtnPostOnlyFirstAndLastTrans.Visible=!1;try{l.a.SessionManager.LocationID>0&&l.a.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&l.a.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(this.sFilter+=" AND EmpSeqNo IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+l.a.SessionManager.LocationID+")"),d.e.IsEmpty(l.a.SessionManager.sWHEmpFilteredEmpSeqNos)||(this.sFilter+="  AND EmpSeqNo IN ("+l.a.SessionManager.sWHEmpFilteredEmpSeqNos+")"),Logger.InfoLog("PostAttTimeSheetToDailyAttViewModel::Entering FilterEmployees()");let e=[];e.push(Date.Today().ToString("dd MMM yyyy")),e.push(this.sFilter),e.push(0),e.push(l.a.SessionManager.RoleID),e.push(l.a.SessionManager.UserID),e.push(l.a.SessionManager.LanguageID);let t=l.a.empService.GetData(e,"spPAY_GetEmpMasterCCDetails"),s="";if(this.dgv.Clear(),null!=t&&t.Tables.length>0&&t.Tables[0].length>0){for(let i=0;i<t.Tables[0].length;i++)s.Trim().length>0&&(s+=","),s+=t.Tables[0][i].EmpSeqNo.toString();let e=l.a.common.GetDataSet3("PAY063",this.iPostDocType.toString(),s,this.objEmpFilter.FromDatePicker.Date.ToString("dd/MMM/yyyy")+"~"+this.objEmpFilter.ToDatePicker.Date.ToString("dd/MMM/yyyy"));if(this.dtData=e.Tables[0],!(null!=e&&e.Tables.length>0&&e.Tables[0].length>0))return void(this.DisplayMessage="No documents found for the selected Employees.");{let t;for(let s=0;s<e.Tables[0].length;s++){t=this.dgv.NewRow(),t.Select=!1,t.SNo=(s+1).toString(),this.sEmpSeqNosOnGrid.length>0&&(this.sEmpSeqNosOnGrid+=","),this.sEmpSeqNosOnGrid+=e.Tables[0][s].EmpSeqNo.toString(),t.EmpSeqNo=e.Tables[0][s].EmpSeqNo,t.EmpCode=e.Tables[0][s].EmpCode,t.EmpName=e.Tables[0][s].EmpName,t.InvDocDetailsID=e.Tables[0][s].InvDocDetailsID,t.VoucherNo=e.Tables[0][s].VoucherNo,t.CheckInDate=e.Tables[0][s].CheckInDate,d.e.IsEmptySpace(e.Tables[0][s].CheckInTime)||(t.CheckInTime=new Date(e.Tables[0][s].CheckInTime).ToString("HH:mm")),d.e.IsEmptySpace(e.Tables[0][s].CheckOutDate)?t.Row_Background="#F77B7E":t.CheckOutDate=e.Tables[0][s].CheckOutDate,d.e.IsEmptySpace(e.Tables[0][s].CheckOutTime)||(t.CheckOutTime=new Date(e.Tables[0][s].CheckOutTime).ToString("HH:mm")),t.TotalTime=d.e.IsEmptySpace(e.Tables[0][s].TotalTime)?"0.00":e.Tables[0][s].TotalTime,0==parseFloat(t.TotalTime.toString().Replace(":","."))&&(t.Row_Background="#F77B7E");for(let i=0;i<this.dgv.TableColumns.length;i++)this.dgv.TableColumns[i].startsWith("dcCCNID")&&!this.dgv.TableColumns[i].endsWith("_Key")&&(t[this.dgv.TableColumns[i]+"_Key"]=e.Tables[0][s][this.dgv.TableColumns[i]]);this.dgv.addRow(t)}this.dgv.refreshDataView()}}Logger.InfoLog("PostAttTimeSheetToDailyAttViewModel::Exiting FilterEmployees()")}catch(e){Logger.ErrorLog("PostAttTimeSheetToDailyAttViewModel::EXCEPTION FilterEmployees()"+e.stack)}}}var j=s("26AK"),W=s("fKF8"),B=s("Kz05"),U=s("EQd/"),H=s("JIg3"),X=s("OvA8"),q=s("xnJf"),Y=s("9WDa"),K=s("wnwj"),Q=s("7i9q");class J extends c.b{constructor(e,t=""){super(),this.ApproveVisibility=!1,this.PostVisiblility=!0,this.UnPostVisiblility=!0,this.WID=0,this.DocID=0,this.txtDocNo=new U.d(0),this.dtpDocDate=new H.a(0),this.EmployeeList=new w.a(0),this.dtpDateOfJoining=new H.a(0),this.dtpDateOfRelieving=new H.a(0),this.txtRemarks=new U.d(0),this.txtNetAmount=new U.d(0),this.DialogResult=!1,this.AttachmentVisibility=!1,this.CostCenterID=40095,this.CalculateClick=new O.b,this.EmpSelectionChanged=new O.b,this.strCustomEmpFilter="",this.sCmdParameter="",this.IsSaved=!1,this.sVNo="",this.dtRes1=null,this.drwRes=null,this.SelectedEmpID=0,this.StatusColor="#736F6F",this.StatusID=0,this.WFDocLevelList=new Array,this.ClassName="FinalSettlementViewModel";try{this.CostCenterID=40095,this.dtRes1=l.a.common.GetDataTable("CRM030",l.a.SessionManager.LangID),this.txtDocNo.Label=this.GetResource("VoucherNo",40095),this.dtpDocDate.Label=this.GetResource("DocDate",40095),this.EmployeeList.Label=this.GetResource("Employee",40095),this.dtpDateOfJoining.Label=this.GetResource("Date of Joining",40095),this.dtpDateOfRelieving.Label=this.GetResource("Date of Relieving",40095),this.txtNetAmount.Label=this.GetResource("Net Amount",40095),this.DisplayName=e,this.Title=e,this.sVNo=t,this.DisplayMessage="",this.DocStatus="[UnPosted]",this.ViewAttachments=new X.ViewAttachmentViewModel(this,l.a.SessionManager,l.a.admin),this.OnAddAttachment(),this.txtDocNo.LblWidth="",this.txtRemarks.Label=l.a.GetResource("Remarks"),this.txtNetAmount.IsReadOnly=!0,this.EmployeeList.Code.TypeID=4,this.EmployeeList.Name.TypeID=1,this.EmployeeList.Code.Visible=this.EmployeeList.Name.Visible=!1,this.EmployeeList.Code.Column=0,this.EmployeeList.Name.Column=1,this.EmployeeList.Code.Visible=!0,this.EmployeeList.Name.Visible=!0,this.EmployeeList.Code.CCID=this.EmployeeList.Name.CCID=50051,this.EmployeeList.Code.Visible&&(this.EmployeeList.Code.CCID=50051,this.EmployeeList.Code.TypeID=4),this.EmployeeList.Name.Visible&&(this.EmployeeList.Name.CCID=50051,this.EmployeeList.Name.TypeID=1),this.strCustomEmpFilter=this.FilterEmployees(),this.EmployeeList.Code.CustomWhere=this.EmployeeList.Name.CustomWhere=this.strCustomEmpFilter,this.EmployeeList.SelectionCallBack.Subscribe(this,"EmployeeList_SelectedValueChanged"),this.cmbResignType=new M.e(0),this.cmbResignType.Items.push(M.d.ComboBoxItems_2("Resigned","Resigned")),this.cmbResignType.Items.push(M.d.ComboBoxItems_2("Terminated","Terminated")),this.cmbResignType.Items.push(M.d.ComboBoxItems_2("Terminated With Cause","Terminated With Cause")),this.cmbResignType.Items.push(M.d.ComboBoxItems_2("Terminated Without Cause","Terminated Without Cause")),this.cmbResignType.Label=this.GetResource("Resign Type",40095),this.cmbSettlementType=new M.e(0),this.cmbSettlementType.Items.push(M.d.ComboBoxItems_2("Final","Final")),this.cmbSettlementType.Items.push(M.d.ComboBoxItems_2("Partial","Partial")),this.cmbSettlementType.Label=this.GetResource("Settlement Type",40095),this.PostVisiblility=l.a.SessionManager.IsActionAssigned(this.CostCenterID,"Create"),this.UnPostVisiblility=l.a.SessionManager.IsActionAssigned(this.CostCenterID,"Delete"),l.a.SessionManager.Preferences.ContainsKey("DisableDateOfRelievingFieldInFinalSettlement")&&"True"==l.a.SessionManager.Preferences.DisableDateOfRelievingFieldInFinalSettlement.toString()&&(this.dtpDateOfRelieving.Enable=!1),l.a.SessionManager.Preferences.ContainsKey("DisableResignTypeFieldInFinalSettlement")&&"True"==l.a.SessionManager.Preferences.DisableResignTypeFieldInFinalSettlement.toString()&&(this.cmbResignType.Enable=!1),Logger.InfoLog("FinalSettlementViewModel::Exiting FinalSettlementViewModel()")}catch(s){Logger.ErrorLog("FinalSettlementViewModel::EXCEPTION FinalSettlementViewModel()",s)}}EmployeeList_SelectedValueChanged(e){try{this.DisplayMessage="",this.SelectedEmpID=this.EmployeeList.Code.SelectedValue,this.SelectedEmpID>0&&this.EmpSelectionChanged.Call(this.SelectedEmpID)}catch(t){Logger.ErrorLog("FinalSettlementViewModel::EXCEPTION EmployeeList_SelectedValueChanged()",t)}}get DocStatus(){return this._DocStatus}set DocStatus(e){e!=this._DocStatus&&(this._DocStatus=e,this.setStatusColor())}setStatusColor(){this.StatusColor=this.DocStatus.startsWith("["+l.a.GetResource("Doc_Draft")+"]")||this.DocStatus.startsWith("[UnPosted]")?l.a.SessionManager.Preferences.DraftColor:this.DocStatus.startsWith("[Partial]")?l.a.SessionManager.Preferences.partialColor:369==this.StatusID?l.a.SessionManager.Preferences.PostedColor:370==this.StatusID?l.a.SessionManager.Preferences.PDCColor:371==this.StatusID?l.a.SessionManager.Preferences.UnApprovedColor:372==this.StatusID?l.a.SessionManager.Preferences.RejectedColor:376==this.StatusID?l.a.SessionManager.Preferences.CancelledColor:429==this.StatusID?l.a.SessionManager.Preferences.BouncedColor:441==this.StatusID?l.a.SessionManager.Preferences.ApprovedColor:"#FF736F6F",9==this.StatusColor.length&&(this.StatusColor.startsWith("#FF")||this.StatusColor.startsWith("#ff"))&&(this.StatusColor="#"+this.StatusColor.substr(3))}Button_Click(e){try{if("Clear"==e.toString())this.EmployeeList.SelectedValue=0,this.SelectedEmpID=0,this.CalculateClick.Call(e);else if("EMail"==e.toString()){if(!(this.DocID>0))return void(this.DisplayMessage="Load document in Edit Mode");l.a.page.ShowDialog(new K.SendEmailSMSViewModel(!0,50051,this.EmployeeList.SelectedValue,this),Q.SendEmailSMSComponent)}else"Attachments"==e.toString()?(this.AttachmentVisibility=!0,l.a.page.ShowDialog(this.Attachment,Y.a,{Title:this.Attachment.Title})):this.CalculateClick.Call(e)}catch(t){Logger.ErrorLog("FinalSettlementViewModel::EXCEPTION Button_Click()",t)}}SetDocStatus(e,t,s,i,a,o,n){let r=[];return r.push(e),r.push(null!=a?a:""),r.push(i.ToString("dd/MMM/yyyy")),r.push(!0),r.push(this.DocID),r.push(this.CostCenterID),r.push(t),r.push(s),r.push(o),r.push(n),r.push(l.a.SessionManager.CompanyGUID),r.push(l.a.SessionManager.UserName),r.push(l.a.SessionManager.UserID),r.push(l.a.SessionManager.RoleID),r.push(l.a.SessionManager.LanguageID),l.a.document.SetDocStatus(r)}FilterEmployees(){let e="";try{Logger.InfoLog("FinalSettlementViewModel::Entering FilterEmployees()"),l.a.SessionManager.LocationID>0&&l.a.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&l.a.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(e=e+" a.NodeID IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+l.a.SessionManager.LocationID+")"),Logger.InfoLog("FinalSettlementViewModel::Exiting FilterEmployees()")}catch(t){Logger.ErrorLog("FinalSettlementViewModel::EXCEPTION FilterEmployees()",t)}return e}SaveFinalSettlement(e){return l.a.document.SetTempInvDocument(e)}OnShowAttachment(){Logger.InfoLog("AddProductViewModel::Entering OnShowAttachment"),Logger.InfoLog("AddProductViewModel::Exiting OnShowAttachment")}OnAddAttachment(){Logger.InfoLog("AddProductViewModel::Entering AddAttachment");let e="";null!=this.Attachment&&(e=this.Attachment.ColID);let t=null;null!=this.Attachment&&(t=this.Attachment.RowID),this.Attachment=new q.AddAttachmentViewModel,this.Attachment.AddAttachmentViewModel_2(this),""==e?(this.Attachment.ColID="",this.Attachment.RowID=null):(this.Attachment.ColID=e,this.Attachment.RowID=t),Logger.InfoLog("AddProductViewModel::Entering AddAttachment")}GetResource(e,t){let s=e;return this.drwRes=this.dtRes1.filter(s=>s.CCID==t&&s.Code==e),null!=this.drwRes&&this.drwRes.length>0?1==l.a.SessionManager.LanguageID?this.drwRes[0].Name.toString():this.drwRes[0].AliasName.toString():s}PostApplyLeaves(e,t,s){return l.a.empService.ExecuteQuery_SP(t,s)}}class z{constructor(){this.EmpCode="",this.EmpName="",this.EmpAliasName="",this.Gender="",this.CodePrefix="",this.ParentName="",this.CCMapXML="",this.HistoryXML="",this.PayQuery="",this.CustomFieldsQuery="",this.CustomCostCenterFieldsQuery="",this.NotesXML="",this.ContactsXML="",this.AddressXML="",this.AttachmetsXML="",this.AccLinkXML="",this.PrimaryContactQuery="",this.StaticFieldsQuery="",this.CompanyGUID="",this.GUID="",this.UserName="",this.DocumentsXML="",this.EmpYear="",this.NodeID=0,this.CodeNumber=0,this.StatusID=0,this.EmpTypeID=0,this.ParentID=0,this.CurrencyID=0,this.SelectedNodeID=0,this.ProbationDays=0,this.RptManager=0,this.UserId=0,this.LanguageId=0,this.GroupSeqNoLength=0,this.WID=0,this.IsGroup=!1,this.IDHistoryXML="",this.PaymentModeXML=""}}var Z=s("Jnyl"),$=s("Agar");class ee extends c.b{constructor(){super(),this.CostCenterID=0,this.TypeID=0,this.AttachmentVisibility=!1,this.Employee=new w.a(0),this.PayrollTaxFields=new Array,this.dtPayrollTaxCmptsObj=new C.a,this.Savereturnvalue=-1,this.oRadio1=null,this.dsTaxComponents=null,this.CostCenterID=262,this.objEmp=new z,this.ViewAttachments=new X.ViewAttachmentViewModel(this),this.OnAddAttachment(),this.EmpYear=new M.e(0),this.EmpYear.LblWidth="60",this.EmpYear.Label=l.a.GetResource("Doc_Year"),this.EmpYear.SelectionChangedCommand.Subscribe(this,"OnYearSelected");for(let e=2e3;e<2100;e++){let t=M.d.ComboBoxItems_2(e.toString(),e.toString());this.EmpYear.Items.push(t)}this.EmpYear.SelectedValue=new Date(l.a.SessionManager.PayrollMonth).ToString("yyyy"),this.Employee.Visible=!0,this.Employee.Code.TypeID=4,this.Employee.Name.TypeID=1,this.Employee.Code.Visible=this.Employee.Name.Visible=!1,this.Employee.Code.Column=0,this.Employee.Name.Column=1,this.Employee.Code.Visible=!0,this.Employee.Name.Visible=!0,this.Employee.Code.CCID=this.Employee.Name.CCID=50051,this.Employee.LblWidth="80",this.Employee.Label=l.a.GetResource("Pay_Employee"),this.Employee.Code.Visible&&(this.Employee.Code.CCID=50051,this.Employee.Code.TypeID=4),this.Employee.Name.Visible&&(this.Employee.Name.CCID=50051,this.Employee.Name.TypeID=1),this.FilterEmployees(),this.Employee.SelectionCallBack.Subscribe(this,"Employee_SelectedValueChanged"),this.dtPayrollTaxCmptsObj.Table=[],this.dtPayrollTaxCmptsObj.Columns=new Array,this.dtPayrollTaxCmptsObj.Height=110,this.GenerateTaxComponentFields(0,0,this.PayrollTaxFields),this.BindHRAGridColumns()}get CCID(){return this.CostCenterID}set CCID(e){this.CostCenterID=e}get dtPayrollTaxCmpts(){return this.dtPayrollTaxCmptsObj.Table}get PayrollColumnSourceTaxComponents(){return this.dtPayrollTaxCmptsObj.Columns}BindHRAGridColumns(){this.PayrollColumnSourceTaxComponents.Clear(),this.dtPayrollTaxCmptsObj.Clear();let e=new y.a;e.Header="FromDate",e.DisplayMember="ITFromDate",e.ValueMember="ITFromDate_Key",e.DataType="DATE",e.ReadOnly=!1,e.Width=85,this.PayrollColumnSourceTaxComponents.push(e),e=new y.a,e.Header="ToDate",e.DisplayMember="ITToDate",e.ValueMember="ITToDate_Key",e.DataType="DATE",e.ReadOnly=!1,e.Width=85,this.PayrollColumnSourceTaxComponents.push(e),e=new y.a,e.Header="Amount",e.DisplayMember="Amount",e.DataType="TextBlock",e.ReadOnly=!1,e.Width=75,this.PayrollColumnSourceTaxComponents.push(e),e=new y.a,e.Header="Metro",e.ValueBinding="Metro",e.DataType="ComboBox",e.DisplayMember="Name",e.ValueMember="Value",e.Width=60;let t=[];t.push(M.d.ComboBoxItems_2("Yes","Yes")),t.push(M.d.ComboBoxItems_2("No","No")),e.ComboData=t,this.PayrollColumnSourceTaxComponents.push(e),e=new y.a,e.Header="HRAAddress",e.DisplayMember="HRAAddress",e.DataType="TextArea",e.ReadOnly=!1,e.Width=200,this.PayrollColumnSourceTaxComponents.push(e),e=new y.a,e.Header="Name of Landlord",e.DisplayMember="NameofLandlord",e.DataType="TextBlock",e.ReadOnly=!1,e.Width=153,this.PayrollColumnSourceTaxComponents.push(e),e=new y.a,e.Header="Pan of Landlord",e.DisplayMember="PanofLandlord",e.DataType="TextBlock",e.ReadOnly=!1,e.Width=150,this.PayrollColumnSourceTaxComponents.push(e),this.dtPayrollTaxCmptsObj.RefreshGridView()}Employee_SelectedValueChanged(e){""!=this.EmpYear.SelectedValue.toString()?(this.PayrollTaxFields.Clear(),this.dtPayrollTaxCmptsObj.Clear(),null!=this.ViewAttachments&&this.ViewAttachments.AttachmentsListObj.Clear(),this.ViewAttachments=new X.ViewAttachmentViewModel(this),this.OnAddAttachment(),this.GenerateTaxComponentFields(parseInt(this.EmpYear.SelectedValue),this.Employee.SelectedValue,this.PayrollTaxFields)):this.DisplayMessage="Please select the Year"}OnYearSelected(e){this.Employee.SelectedValue=0,this.FilterEmployees(),this.dtPayrollTaxCmptsObj.Columns.Clear(),this.PayrollTaxFields.Clear(),this.dtPayrollTaxCmptsObj.Clear(),this.Employee.SelectedValue>0?this.GenerateTaxComponentFields(parseInt(this.EmpYear.SelectedValue),this.Employee.SelectedValue,this.PayrollTaxFields):this.GenerateTaxComponentFields(0,0,this.PayrollTaxFields)}OnComponentSelection(e){let t="",s="";this.PayrollTaxFields.forEach(e=>{if(e instanceof Z.b){let i=e;if(s=i.Currency.SelectedValue,null!=s){let e=this.dsTaxComponents.Tables[0].filter(e=>"ComboTextValue"==e.ControlType&&e.NodeID==parseInt(s));for(let s=0;s<e.length;s++){let a=e[s];switch(t=d.e.String(a.ControlType),t){case"COMBOTEXTVALUE":i.Label=d.e.String(a.AmountLimit)}}}}})}GenerateTaxComponentFields(e,t,s){try{Logger.InfoLog("VoucherGenerator:: Inside GenerateCustomFields");let i,a,o=0,n=null,r=null;if(null===t&&(t=0),0!=e&&0!=t&&(n=l.a.common.GetDataSet3("PAY071",e.toString(),t.toString())),null!=n&&n.Tables.length>0&&n.Tables[0].length>0&&!d.e.IsEmpty(n.Tables[0][0].SEQNO)&&(r=l.a.common.GetDataSet("PAY072",n.Tables[0][0].SEQNO.toString())),this.dsTaxComponents=l.a.empService.GetIncomeTaxComponents(0,e,t),this.dsTaxComponents.Tables[0].length>0&&this.dsTaxComponents.Columns[0].Contains("ITComponentsValidationMessage")&&!d.e.IsEmpty(this.dsTaxComponents.Tables[0][0].ITComponentsValidationMessage))return void(this.DisplayMessage=this.dsTaxComponents.Tables[0][0].ITComponentsValidationMessage.toString());let h=this.dsTaxComponents.Tables[0];if(h.forEach(e=>{switch(i=d.e.String(e.CONTROLTYPE).toUpperCase(),i){case"LABEL":a=new $.a,a.Label=d.e.String(e.NAME),s.push(a),a.tabname="LABEL";break;case"TEXTBOX":this.LabelLimitAmount=d.e.String(e.AMOUNTLIMIT),this.oText=new U.d(parseInt(e.NODEID)),this.oText.Label=d.e.String(e.NAME),this.oText.KeyTip=this.LabelLimitAmount,this.oText.Text=e.AMOUNT.toString(),this.oText.LblWidth="400",this.oText.tabname="TEXTBOX",s.push(this.oText);break;case"COMBOTEXTVALUE":let i=h.filter(t=>"ComboTextValue"==t.CONTROLTYPE&&t.GROUPID==parseInt(e.GROUPID));var t=s.find(t=>t instanceof Z.b&&t.DBColumnID==parseInt(e.GROUPID));null==t?(this.oRadio1=new Z.b,this.oRadio1.DBColumnID=parseInt(e.GROUPID)):this.oRadio1=t,this.oRadio1.tabname="COMBOTEXTVALUE",this.oRadio1.LblWidth="1",0!=o&&o==parseInt(e.GROUPID)||i.length>0&&(i.forEach(e=>{this.oRadio1.Currency.Items.push(M.d.ComboBoxItems_2(d.e.String(e.NAME).TrimStart(" "),d.e.String(e.NODEID)))}),this.oRadio1.Currency.SelectedValue=this.oRadio1.Currency.Items[0].Value,this.oRadio1.Currency.SelectionChangedCommand.Subscribe(this,"OnComponentSelection"),s.push(this.oRadio1)),parseInt(e.SELECTEDNODE)>0?(this.oRadio1.Currency.SelectedValue=d.e.String(e.SELECTEDNODE),this.oRadio1.ExchangeRate.Text=e.AMOUNT.toString(),this.oRadio1.Label=e.SELECTEDAMTLIMIT.toString()):""==this.oRadio1.ExchangeRate.Text&&(this.oRadio1.ExchangeRate.Text=e.AMOUNT.toString()),null==this.oRadio1.Label&&(this.LabelLimitAmount=d.e.String(e.AMOUNTLIMIT),this.oRadio1.Label=this.LabelLimitAmount),(0==o||o!=parseInt(e.GROUPID))&&(o=parseInt(e.GROUPID))}}),null!=this.dsTaxComponents&&this.dsTaxComponents.Tables.length>1&&this.dsTaxComponents.Tables[1].length>0){let e;for(let t=0;t<this.dsTaxComponents.Tables[1].length;t++)e=this.dtPayrollTaxCmptsObj.NewRow(),e.ITFromDate=new Date(this.dsTaxComponents.Tables[1][t].FromDate).ToString("MMM/yyyy"),e.ITFromDate_Key=new Date(this.dsTaxComponents.Tables[1][t].FromDate).ToString("dd-MMM-yyyy"),e.ITToDate=new Date(this.dsTaxComponents.Tables[1][t].ToDate).ToString("MMM/yyyy"),e.ITToDate_Key=new Date(this.dsTaxComponents.Tables[1][t].ToDate).ToString("dd-MMM-yyyy"),e.Amount=this.dsTaxComponents.Tables[1][t].Amount.toString(),e.Metro=this.dsTaxComponents.Tables[1][t].Metro.toString().TrimEnd(),e.HRAAddress=this.dsTaxComponents.Tables[1][t].Address.toString(),e.NameofLandlord=this.dsTaxComponents.Tables[1][t].Landlord.toString(),e.PanofLandlord=this.dsTaxComponents.Tables[1][t].LandlordPAN.toString(),this.dtPayrollTaxCmptsObj.addRow(e)}if(null!=r&&r.Tables.length>0&&r.Tables[0].length>0){let e=r.Tables[0];if(null!=e&&e.length>0)for(let t=0;t<e.length;t++){let s=new q.AddAttachmentViewModel;s.AddAttachmentViewModel_2(this),s.AttachmentID=parseInt(e[t].FileID),s.ActualFileName=e[t].ActualFileName.toString(),s.FileExtension=e[t].FileExtension.toString(),s.FileDescription=e[t].FileDescription.toString(),s.FilePath=d.e.GetPath(e[t].GUID+"."+e[t].FileExtension),s.RelativeFileName=e[t].RelativeFileName.toString(),s.IsProductImage=!1,this.ViewAttachments.AttachmentsList.push(s)}}else this.BindEmptyRows(2)}catch(i){Logger.ErrorLog("Error : "+i),this.DisplayMessage=i.message}}OnSaveITDeclarations(e){try{Logger.InfoLog("ITDeclarationsViewModel::Entering OnSaveITDeclarations()");let t="";if(t=this.DataValid(),""!=t.toString())return void(this.DisplayMessage=t);this.SaveEmpIncomeTax(),this.OnClear(e)}catch(t){Logger.ErrorLog("ITDeclarationsViewModel::EXCEPTION OnSaveITDeclarations()"+t)}}DataValid(){let e,t,s="",i=0,a=0;0==this.Employee.SelectedValue&&(s+="Please select the Employee \r\n"),""==this.EmpYear.SelectedValue.toString()&&(s+="Please select the Year \r\n"),this.PayrollTaxFields.forEach(e=>{if(e instanceof U.d){let t=e;i=d.e.Double(t.KeyTip),a=d.e.Double(t.Text),i>0&&a>i&&(s=s+"Amount should be less than Limit Amount for '"+t.Label.toString().Trim()+"'\r\n")}if(e instanceof Z.b){let t=e;i=d.e.Double(t.Label),a=d.e.Double(t.ExchangeRate.Text),i>0&&a>i&&(s=s+"Amount should be less than Limit Amount for '"+t.Currency.Text.toString().Trim()+"'\r\n")}});for(let l=0;l<this.dtPayrollTaxCmpts.length;l++)d.e.IsEmpty(this.dtPayrollTaxCmpts[l].ITFromDate_Key)||(new Date(new Date(this.dtPayrollTaxCmpts[l].ITFromDate_Key).ToString("MMM/yyyy"))>new Date(new Date(this.dtPayrollTaxCmpts[l].ITToDate_Key).ToString("MMM/yyyy"))?s=s+"Fromdate should be less than todate at row no ('"+l.toString()+"')\r\n":new Date(new Date(this.dtPayrollTaxCmpts[l].ITToDate_Key).ToString("MMM/yyyy"))<new Date(new Date(this.dtPayrollTaxCmpts[l].ITFromDate_Key).ToString("MMM/yyyy"))&&(s=s+"Todate should be greater than fromdate at row no ('"+l.toString()+"')\r\n"));for(let l=0;l<this.dtPayrollTaxCmpts.length&&""!=d.e.String(this.dtPayrollTaxCmpts[l].ITFromDate_Key);l++){e=new Date(new Date(this.dtPayrollTaxCmpts[l].ITFromDate_Key).ToString("MMM/yyyy")),t=new Date(new Date(this.dtPayrollTaxCmpts[l].ITToDate_Key).ToString("MMM/yyyy"));for(let i=0;i<this.dtPayrollTaxCmpts.length;i++)if(l!=i){if(""==d.e.String(this.dtPayrollTaxCmpts[i].ITFromDate_Key))break;if(+e.Date>=+new Date(this.dtPayrollTaxCmpts[i].ITFromDate_Key).OnlyDate()&&+e.Date<=+new Date(this.dtPayrollTaxCmpts[i].ITToDate_Key).OnlyDate()||+t.Date>=+new Date(this.dtPayrollTaxCmpts[i].ITFromDate_Key).OnlyDate()&&+t.Date<=+new Date(this.dtPayrollTaxCmpts[i].ITToDate_Key).OnlyDate()||+e.Date>=+new Date(this.dtPayrollTaxCmpts[i].ITFromDate_Key).OnlyDate()&&+t.Date<=+new Date(this.dtPayrollTaxCmpts[i].ITToDate_Key).OnlyDate()||+new Date(this.dtPayrollTaxCmpts[i].ITFromDate_Key).OnlyDate()>=+e.Date&&+new Date(this.dtPayrollTaxCmpts[i].ITToDate_Key).OnlyDate()<=+t.Date){s=s+"Invalid dates entered at row no ('"+i.toString()+"')\r\n";break}}}return s}SaveEmpIncomeTax(){Logger.InfoLog("ITDeclarationsViewModel::Entering SaveEmpIncomeTax");try{let e="";this.objEmp.EmpYear=this.EmpYear.SelectedValue,this.objEmp.EmpCode=this.Employee.SelectedValue.toString(),e+="<Rows>",this.PayrollTaxFields.forEach(t=>{if(t instanceof U.d){let s=t;e+='<row ComponentID="'+s.DBColumnID,e+='" AmountLimit="'+s.KeyTip,e+=null!=s.Text?'" Amount="'+parseFloat(s.Text):'" Amount="0',e+='"/>'}else if(t instanceof Z.b){let s=t;e+='<row ComponentID="'+s.Currency.SelectedValue,e+='" AmountLimit="'+s.Label,e+=null!=s.ExchangeRate.Text?'" Amount="'+parseFloat(s.ExchangeRate.Text):'" Amount="0',e+='"/>'}}),e+="</Rows>";let t="";t+="<HRAINFO>";for(let i=0;i<this.dtPayrollTaxCmpts.length;i++)""==d.e.String(this.dtPayrollTaxCmpts[i].ITFromDate_Key)&&""==d.e.String(this.dtPayrollTaxCmpts[i].ITToDate_Key)||(t+='<row FromDt="'+new Date(this.dtPayrollTaxCmpts[i].ITFromDate_Key).ToString("dd-MMM-yyyy"),t+='" ToDt="'+new Date(this.dtPayrollTaxCmpts[i].ITToDate_Key).ToString("dd-MMM-yyyy"),""!=this.dtPayrollTaxCmpts[i].Amount.toString()?t+='" Amt="'+parseFloat(this.dtPayrollTaxCmpts[i].Amount):t+='" Amt="0',t+='" Metro="'+this.dtPayrollTaxCmpts[i].Metro,t+='" Address="'+this.dtPayrollTaxCmpts[i].HRAAddress,t+='" Landlord="'+this.dtPayrollTaxCmpts[i].NameofLandlord,t+='" LandlordPAN="'+this.dtPayrollTaxCmpts[i].PanofLandlord,t+='"/>');t+="</HRAINFO>";let s=this.ViewAttachments.GetXML();l.a.empService.SaveEmpTaxDeclarations(e.toString(),t.toString(),s.toString(),this.objEmp.EmpYear,this.objEmp.EmpCode).subscribe(e=>{this.DisplayMessage=e.Message,this.Savereturnvalue=e.RetValue})}catch(e){Logger.ErrorLog("ITDeclarationsViewModel:: SaveEmpIncomeTax"+e.stack)}}OnClear(e){try{this.Employee.SelectedValue=0,this.PayrollColumnSourceTaxComponents.Clear(),this.PayrollTaxFields.Clear(),this.BindHRAGridColumns(),this.GenerateTaxComponentFields(0,0,this.PayrollTaxFields),null!=this.ViewAttachments&&this.ViewAttachments.AttachmentsList.Clear(),this.ViewAttachments=new X.ViewAttachmentViewModel(this),this.OnAddAttachment()}catch(t){Logger.ErrorLog("Error : "+t),this.DisplayMessage=t.message}}BindEmptyRows(e){this.dtPayrollTaxCmptsObj.addEmptyRows(e)}FilterEmployees(){try{Logger.InfoLog("ITDeclarationsViewModel::Entering FilterEmployees()");let e,t,s="";e=new Date(parseInt(this.EmpYear.SelectedValue),l.a.SessionManager.AccountingFromMonth-1,1),t=new Date(l.a.SessionManager.AccountingFromMonth>1?parseInt(this.EmpYear.SelectedValue)+1:parseInt(this.EmpYear.SelectedValue),l.a.SessionManager.AccountingToMonth-1,1),t=t.AddMonths(1).AddDays(-1),s=" ( a.StatusID=250 AND (ISNULL(CONVERT(DATETIME,a.DORelieve),'01-Jan-9000')='01-Jan-9000') ",s=s+" or (Year(CONVERT(DATETIME,'"+t.ToString("dd/MMM/yyyy")+"'))<=Year(CONVERT(DATETIME,a.DORelieve)) and CONVERT(DATETIME,'"+e.ToString("dd/MMM/yyyy")+"')<=CONVERT(DATETIME,a.DORelieve)) ",s=s+" or ( CONVERT(DATETIME,'"+e.ToString("dd/MMM/yyyy")+"')<=CONVERT(DATETIME,a.DORelieve))) ",l.a.SessionManager.LocationID>0&&l.a.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&l.a.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(s=s+" AND a.NodeID IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+l.a.SessionManager.LocationID+")"),d.e.IsEmpty(l.a.SessionManager.sWHEmpFilteredEmpSeqNos)||(s+="  AND a.NodeID IN ("+l.a.SessionManager.sWHEmpFilteredEmpSeqNos+")"),this.Employee.Code.CustomWhere=this.Employee.Name.CustomWhere=s,Logger.InfoLog("ITDeclarationsViewModel::Exiting FilterEmployees()")}catch(e){Logger.ErrorLog("ITDeclarationsViewModel::EXCEPTION FilterEmployees()"+e.stack)}}OnAddAttachment(){Logger.InfoLog("AddProductViewModel::Entering AddAttachment");let e="";null!=this.Attachment&&(e=this.Attachment.ColID);let t=null;null!=this.Attachment&&(t=this.Attachment.RowID),this.Attachment=new q.AddAttachmentViewModel,this.Attachment.AddAttachmentViewModel_2(this),""==e?(this.Attachment.ColID="",this.Attachment.RowID=null):(this.Attachment.ColID=e,this.Attachment.RowID=t),Logger.InfoLog("AddProductViewModel::Entering AddAttachment")}OnClickAttachment(e){this.AttachmentVisibility=!0}}var te=s("Gc3p");class se extends c.b{constructor(){super(...arguments),this.CostCenterID=0,this.TypeID=0,this.Employee=new w.a(0),this.RepEmployee=new w.a(0),this.dtPayrollTaxCmptsObj=new C.a,this.Savereturnvalue=0,this.dsITComputation=null,this.sbComputationData="",this.sbValidation=""}get CCID(){return this.CostCenterID}set CCID(e){this.CostCenterID=e}get dtPayrollTaxCmpts(){return this.dtPayrollTaxCmptsObj.Table}get PayrollColumnSourceTaxComponents(){return this.dtPayrollTaxCmptsObj.Columns}IncomeTaxComputationViewModel(){Logger.InfoLog("ITComputationViewModel::Entering ITComputationViewModel"),this.objEmp=new z,this.EmpYear=new M.e(0),this.EmpYear.SelectionChangedCommand.Subscribe(this,"OnYearSelected");for(let e=2e3;e<2100;e++){let t=M.d.ComboBoxItems_2(e.toString(),e.toString());this.EmpYear.Items.push(t)}this.EmpYear.SelectedValue=new Date(l.a.SessionManager.PayrollMonth).ToString("yyyy"),this.Employee.Visible=!0,this.Employee.Code.TypeID=4,this.Employee.Name.TypeID=1,this.Employee.Code.Visible=this.Employee.Name.Visible=!1,this.Employee.Code.Column=0,this.Employee.Name.Column=1,this.Employee.Code.Visible=!0,this.Employee.Name.Visible=!0,this.Employee.Code.CCID=this.Employee.Name.CCID=50051,this.Employee.Code.Visible&&(this.Employee.Code.CCID=50051,this.Employee.Code.TypeID=4),this.Employee.Name.Visible&&(this.Employee.Name.CCID=50051,this.Employee.Name.TypeID=1),this.RepEmployee.Visible=!0,this.RepEmployee.Name.Visible=!0,this.RepEmployee.Name.CCID=50051,this.RepEmployee.Name.TypeID=1,this.FilterEmployees(),this.Employee.SelectionCallBack.Subscribe(this,"Employee_SelectedValueChanged"),this.dtPayrollTaxCmptsObj.Table=[],this.dtPayrollTaxCmptsObj.Columns=[],Logger.InfoLog("ITComputationViewModel::Exiting ITComputationViewModel")}Employee_SelectedValueChanged(e){this.dsITComputation=l.a.empService.GetIncomeTaxCalcDetails(parseInt(this.EmpYear.SelectedValue),this.Employee.SelectedValue,l.a.SessionManager.AccountingFromMonth)}lstResponsiblePerson_SelectedValueChanged(e){return l.a.common.GetDataSet("PAY070",this.RepEmployee.SelectedValue.toString())}OnYearSelected(e){this.FilterEmployees(),this.dsITComputation=l.a.empService.GetIncomeTaxCalcDetails(parseInt(this.EmpYear.SelectedValue),this.Employee.SelectedValue,l.a.SessionManager.AccountingFromMonth)}OnSaveITComputation(e){try{Logger.InfoLog("ITComputationViewModel::Entering OnSaveITComputation()"),this.sbValidation?this.DisplayMessage=this.sbValidation.toString():l.a.empService.SaveEmpTaxComputation(parseInt(this.EmpYear.SelectedValue),this.Employee.SelectedValue,this.sbComputationData.toString()).subscribe(e=>{this.DisplayMessage=e.Message,this.Savereturnvalue=e.RetValue})}catch(t){Logger.ErrorLog("ITComputationViewModel::EXCEPTION OnSaveITComputation()"+t.stack)}}OnDeleteITComputation(e){try{this.sbValidation?this.DisplayMessage=this.sbValidation.toString():l.a.empService.DeleteEmpTaxComputation(parseInt(this.EmpYear.SelectedValue),this.Employee.SelectedValue).subscribe(e=>{this.DisplayMessage=e.Message,this.Savereturnvalue=e.RetValue})}catch(t){Logger.ErrorLog("ITComputationViewModel::EXCEPTION OnDeleteITComputation()"+t.stack)}}FilterEmployees(){try{Logger.InfoLog("ITComputationViewModel::Entering FilterEmployees()");let e,t,s="";e=new Date(parseInt(this.EmpYear.SelectedValue),l.a.SessionManager.AccountingFromMonth-1,1),t=new Date(l.a.SessionManager.AccountingFromMonth>1?parseInt(this.EmpYear.SelectedValue)+1:parseInt(this.EmpYear.SelectedValue),l.a.SessionManager.AccountingToMonth-1,1),t=t.AddMonths(1).AddDays(-1),s=" ( a.StatusID=250 AND (ISNULL(CONVERT(DATETIME,a.DORelieve),'01-Jan-9000')='01-Jan-9000') ",s=s+" or (Year(CONVERT(DATETIME,'"+t.ToString("dd/MMM/yyyy")+"'))<=Year(CONVERT(DATETIME,a.DORelieve)) and CONVERT(DATETIME,'"+e.ToString("dd/MMM/yyyy")+"')<=CONVERT(DATETIME,a.DORelieve)) ",s=s+" or ( CONVERT(DATETIME,'"+e.ToString("dd/MMM/yyyy")+"')<=CONVERT(DATETIME,a.DORelieve))) ",l.a.SessionManager.LocationID>0&&l.a.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&l.a.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(s=s+" AND a.NodeID IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+l.a.SessionManager.LocationID+")"),d.e.IsEmpty(l.a.SessionManager.sWHEmpFilteredEmpSeqNos)||(s+="  AND a.NodeID IN ("+l.a.SessionManager.sWHEmpFilteredEmpSeqNos+")"),this.Employee.Code.CustomWhere=this.Employee.Name.CustomWhere=this.RepEmployee.Name.CustomWhere=s,Logger.InfoLog("ITComputationViewModel::Exiting FilterEmployees()")}catch(e){Logger.ErrorLog("ITComputationViewModel::EXCEPTION FilterEmployees()"+e.stack)}}}var ie=s("eBJM");class ae{static LoadPayrollScreen(e,t){if(50054==e.FeatureID);else if(256==e.FeatureID){let e=new a.SetPayrollDateViewModel;l.a.page.ShowDialog(e,o.SetPayrollDateComponent,{ShowCenter:!0,Title:l.a.GetResource("Pay_SetPayrollDate")})}else if(258==e.FeatureID){let s=l.a.page.tabs.find(e=>{var t;return(null===(t=e.params)||void 0===t?void 0:t.obj)instanceof R});if(s)l.a.page.SetActiveTab(s);else{let s=new R(t);s.DisplayName=t,l.a.page.addNewTab({title:e.ScreenName,component:N.a,params:{obj:s}})}}else if(260==e.FeatureID){let s=l.a.page.tabs.find(e=>{var t;return(null===(t=e.params)||void 0===t?void 0:t.obj)instanceof F});if(s)l.a.page.SetActiveTab(s);else{let s=new F(t);s.DisplayName=t,l.a.page.addNewTab({title:e.ScreenName,component:h.a,params:{obj:s}})}}else if(261==e.FeatureID){let s=l.a.page.tabs.find(e=>{var t;return(null===(t=e.params)||void 0===t?void 0:t.obj)instanceof j.a});if(s)l.a.page.SetActiveTab(s);else{let s=new j.a(t);s.DisplayName=t,l.a.page.addNewTab({title:e.ScreenName,component:W.a,params:{obj:s}})}}else if(262==e.FeatureID){let s=l.a.page.tabs.find(e=>{var t;return(null===(t=e.params)||void 0===t?void 0:t.obj)instanceof ee});if(s)l.a.page.SetActiveTab(s);else{let s=new ee;s.Title=s.DisplayName=t,l.a.page.addNewTab({title:e.ScreenName,component:te.a,params:{obj:s}})}}else if(263==e.FeatureID);else if(264==e.FeatureID){let s=l.a.page.tabs.find(e=>{var t;return(null===(t=e.params)||void 0===t?void 0:t.obj)instanceof se});if(s)l.a.page.SetActiveTab(s);else{let s=new se;s.Title=s.DisplayName=t,l.a.page.addNewTab({title:e.ScreenName,component:ie.a,params:{obj:s}})}}else if(40095==e.FeatureID){let s=l.a.page.tabs.find(e=>{var t;return(null===(t=e.params)||void 0===t?void 0:t.obj)instanceof J});if(s)l.a.page.SetActiveTab(s);else{let s=new J(t);s.DisplayName=t,l.a.page.addNewTab({title:e.ScreenName,component:B.a,params:{obj:s}})}}else if(141==e.FeatureID);else if(266==e.FeatureID){let s=l.a.page.tabs.find(e=>{var t;return(null===(t=e.params)||void 0===t?void 0:t.obj)instanceof _});if(s)l.a.page.SetActiveTab(s);else{let s=new _(t);s.DisplayName=t,l.a.page.addNewTab({title:e.ScreenName,component:v.a,params:{obj:s}})}}else if(267==e.FeatureID);else if(40054==e.FeatureID){let s=l.a.page.tabs.find(e=>{var t;return(null===(t=e.params)||void 0===t?void 0:t.obj)instanceof n.MonthlyPayrollViewModel});if(s)l.a.page.SetActiveTab(s);else{let s=new n.MonthlyPayrollViewModel(e.ScreenName,"");s.DisplayName=t,l.a.page.addNewTab({title:e.ScreenName,component:r.MonthlyPayrollComponent,params:{obj:s}})}}else if(40088==e.FeatureID);else switch(e.FeatureActionID.toString()){case"4101":return{component:i.TreeViewPageComponent,params:{ScreenName:e.ScreenName,FeatureActionID:e.FeatureActionID,CostCenterID:e.FeatureID,Call:"C3"},basedon:"CostCenterID"}}}static LoadMonthlyPayrolByVoucherNo(e,t){return new n.MonthlyPayrollViewModel(e,"",t)}static LoadFinalSettlementByVoucherNo(e,t){return new J(e,t)}}}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[63],{"0HHv":function(e,t,s){"use strict";s.d(t,"a",(function(){return c}));var i=s("fXoL"),n=s("ofXK"),l=s("q8k3"),h=s("t9wj"),o=s("sYmb");function a(e,t){if(1&e&&(i.Zb(0,"div",7),i.Wc(1,"\n                "),i.Vb(2,8),i.Wc(3,"\n            "),i.Yb()),2&e){const e=i.lc(2);i.Db(2),i.tc("obj",e.obj.BudgetField)("group",e.form)}}function d(e,t){if(1&e&&i.Ub(0,"app-pact-search-list-box",9),2&e){const e=i.lc(2);i.tc("obj",e.obj.DocumentsWithSearch)}}function r(e,t){if(1&e&&(i.Zb(0,"div"),i.Wc(1,"\n            "),i.Uc(2,a,4,2,"div",5),i.Wc(3,"\n            "),i.Uc(4,d,1,1,"app-pact-search-list-box",6),i.Wc(5,"\n        "),i.Yb()),2&e){const e=i.lc();i.Db(2),i.tc("ngIf",e.obj.BudgetField.Visible),i.Db(2),i.tc("ngIf",e.obj.DocumentsWithSearch.Visible)}}function u(e,t){if(1&e){const e=i.ac();i.Zb(0,"button",10),i.hc("click",(function(){return i.Ic(e),i.lc().obj.OnSave("OK")})),i.Wc(1),i.mc(2,"translate"),i.Yb()}2&e&&(i.Db(1),i.Xc(i.nc(2,1,"Com_OK")))}let c=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=i.Nb({type:e,selectors:[["app-document-list"]],decls:20,vars:5,consts:[[1,"PACTHeaderFields","row","form-row","dialogSubBody"],[4,"ngIf"],[1,"Pactdailogfooter"],["class","primary-btn-wicon",3,"click",4,"ngIf"],[1,"secondary-btn-wicon",3,"click"],["class","form-group col PACTControl",4,"ngIf"],[3,"obj",4,"ngIf"],[1,"form-group","col","PACTControl"],["FieldDirective","",3,"obj","group"],[3,"obj"],[1,"primary-btn-wicon",3,"click"]],template:function(e,t){1&e&&(i.Zb(0,"div"),i.Wc(1,"\n    "),i.Zb(2,"div",0),i.Wc(3,"\n        "),i.Uc(4,r,6,2,"div",1),i.Wc(5,"\n    "),i.Yb(),i.Wc(6,"\n    "),i.Zb(7,"div",2),i.Wc(8,"\n      "),i.Zb(9,"div"),i.Wc(10,"\n        "),i.Uc(11,u,3,3,"button",3),i.Wc(12,"\n        "),i.Zb(13,"button",4),i.hc("click",(function(){return t.obj.OnSave("Cancel")})),i.Wc(14),i.mc(15,"translate"),i.Yb(),i.Wc(16,"\n      "),i.Yb(),i.Wc(17,"\n    "),i.Yb(),i.Wc(18,"\n"),i.Yb(),i.Wc(19,"\n")),2&e&&(i.Db(4),i.tc("ngIf",t.obj.Documents.Visible),i.Db(7),i.tc("ngIf",t.obj.SaveVisible),i.Db(3),i.Xc(i.nc(15,3,"Com_Cancel")))},directives:[n.t,l.a,h.a],pipes:[o.d],encapsulation:2}),e})()},JNtG:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));var i=s("Do2H");class n{constructor(){this.CCID=0,this.Status=0,this.BudgetTypeID=0,this.BugetID=0,this.NumDimensions=0,this.QtyType=0,this.IsQtyBudget=0,this.isGroup=!1,this.ChkBudgetOnlyForDefnAccounts=!1,this.Budgetid=0,this.SelectedNodeID=0,this.SbXML=null,this.RelationsXML=null,this.BudgetName=null,this.BudgetType=null,this.CCList="",this.strNonAccountingDocs=null,this.NonAccDocsField=null,this.strInvAccountingDocs=null,this.InvAccDocsField=null,this.AccountTypes=null}GetBudgetScreenDetails(e,t,s=""){let n=[];return n.push(e),n.push(t),n.push(s),n.push(i.a.SessionManager.UserID),n.push(i.a.SessionManager.LanguageID),i.a.common.GetBudgetScreenDetails(n)}SaveBudgetScreenDetails(){let e=[];return e.push(this.SbXML),e.push(this.NumDimensions),e.push(this.CCList),e.push(this.RelationsXML),e.push(this.StartYear),e.push(this.BudgetName),e.push(this.BudgetTypeID),e.push(this.BudgetType),e.push(this.Status),e.push(this.IsQtyBudget),e.push(this.Budgetid),e.push(this.SelectedNodeID),e.push(this.isGroup),e.push(this.QtyType),e.push(this.ChkBudgetOnlyForDefnAccounts),e.push(this.strNonAccountingDocs),e.push(this.NonAccDocsField),e.push(this.strInvAccountingDocs),e.push(this.InvAccDocsField),e.push(this.AccountTypes),e.push(i.a.SessionManager.CompanyGUID),e.push(i.a.SessionManager.UserName),e.push(i.a.SessionManager.UserID),e.push(i.a.SessionManager.LanguageID),i.a.common.SaveBudgetScreenDetails(e)}}},pZbb:function(e,t,s){"use strict";s.r(t),s.d(t,"AddEditBudgetViewModel",(function(){return B}));var i=s("Do2H"),n=s("Lp6j"),l=s("eQJW"),h=s("ScVY"),o=s("0/4Q"),a=s("EQd/"),d=s("JIg3"),r=s("8B8H"),u=s("ockk"),c=s("PDNK"),m=s("NkMH"),g=s("MCLT"),C=s("0LKI"),p=s("JNtG"),D=s("wlFP");class b extends h.b{constructor(){super(),this.Visible=!0,this.IsPopup=!1,this.allItems=new Array,this.IgnoreSelectAllChecked=!1}get SearchText(){return this._SearchText}set SearchText(e){e!=this._SearchText&&(this._SearchText=e,this.Search(!0))}PactListBoxViewModel_1(e,t){this.IsPopup=!0,this.DisplayName=t,this.Source=e,e.forEach(e=>{this.allItems.push(o.c.CheckedListBoxItem_5(e.Name+(n.e.StringIsNullOrEmpty(e.Parent)?"":"~"+e.Parent),e.Value,e.IsChecked))}),this.ListBox=new o.b,this.Margin="10,5,10,10",this.Width="300",this.rdoFilter=new c.b,this.rdoFilter.Items.push(new c.a),this.rdoFilter.Items.push(new c.a),this.rdoFilter.Items.push(new c.a),this.rdoFilter.LblWidth="0",this.rdoFilter.Items[0].IsChecked=!0,this.rdoFilter.Items[0].Group=this.rdoFilter,this.rdoFilter.Items[1].Group=this.rdoFilter,this.rdoFilter.Items[2].Group=this.rdoFilter,this.rdoFilter.Items[0].Label="All",this.rdoFilter.Items[1].Label="Checked",this.rdoFilter.Items[2].Label="Un-Checked",this.rdoFilter.Items[0].CheckedChangedCommand.Subscribe(this,"OnFilterCheckedChanged"),this.rdoFilter.Items[1].CheckedChangedCommand.Subscribe(this,"OnFilterCheckedChanged"),this.rdoFilter.Items[2].CheckedChangedCommand.Subscribe(this,"OnFilterCheckedChanged"),this.OnFilterCheckedChanged(null),this.SelectAll=new D.a,this.SelectAll.CheckedChangedCommand.Subscribe(this,"SelectAllChecked"),this.SelectAll.DBColumnName="Select",this.SelectAll.Label="Select All",this.SelectAll.Visible=!1}PactListBoxViewModel_2(e){this.IsPopup=!1,this.ListBox=new o.b,this.allItems=e,this.Margin="0",this.Width="250",this.rdoFilter=new c.b,this.rdoFilter.Items.push(new c.a),this.rdoFilter.Items.push(new c.a),this.rdoFilter.Items.push(new c.a),this.rdoFilter.LblWidth="0",this.rdoFilter.Items[0].IsChecked=!0,this.rdoFilter.Items[0].Group=this.rdoFilter,this.rdoFilter.Items[1].Group=this.rdoFilter,this.rdoFilter.Items[2].Group=this.rdoFilter,this.rdoFilter.Items[0].Label="All",this.rdoFilter.Items[1].Label="Checked",this.rdoFilter.Items[2].Label="Un-Checked",this.rdoFilter.Items[0].CheckedChangedCommand.Subscribe(this,"OnFilterCheckedChanged"),this.rdoFilter.Items[1].CheckedChangedCommand.Subscribe(this,"OnFilterCheckedChanged"),this.rdoFilter.Items[2].CheckedChangedCommand.Subscribe(this,"OnFilterCheckedChanged"),this.OnFilterCheckedChanged(null),this.SelectAll=new D.a,this.SelectAll.CheckedChangedCommand.Subscribe(this,"SelectAllChecked"),this.SelectAll.DBColumnName="Select",this.SelectAll.Label="Select All",this.SelectAll.Visible=!1}OnButtonClick(e){if("OK"==e){for(let e=0;e<this.allItems.length;e++)this.Source[e].IsChecked=this.allItems[e].IsChecked;i.a.page.HideDialog()}else"Cancel"==e&&i.a.page.HideDialog()}OnFilterCheckedChanged(e){this.rdoFilter.Items[0].IsChecked?(this.ListBox.Items.Clear(),this.allItems.forEach(e=>{this.ListBox.Items.push(e)})):this.rdoFilter.Items[1].IsChecked?(this.ListBox.Items.Clear(),this.allItems.filter(e=>e.IsChecked).forEach(e=>{this.ListBox.Items.push(e)})):this.rdoFilter.Items[2].IsChecked&&(this.ListBox.Items.Clear(),this.allItems.filter(e=>!e.IsChecked).forEach(e=>{this.ListBox.Items.push(e)}))}SelectAllChecked(e){if(!this.IgnoreSelectAllChecked)for(let t=0;t<this.ListBox.Items.length;t++)this.ListBox.Items[t].IsChecked=this.SelectAll.IsChecked}filterText(){if(null!=this.SearchText&&""!=this.SearchText){let e=0;for(e=0;e<this.ListBox.Items.length;e++)this.ListBox.Items[e].Name.toLowerCase().Contains(this.SearchText.toLowerCase())||"All"==this.ListBox.Items[e].Name||(this.ListBox.Items.RemoveAt(e),e=0);this.ListBox.Items[0].Name.toLowerCase().Contains(this.SearchText.toLowerCase())||"All"==this.ListBox.Items[0].Name||this.ListBox.Items.RemoveAt(0)}else this.ListBox.Items.Clear(),this.allItems.forEach(e=>{this.ListBox.Items.push(e)})}Search(e){let t=0;if(null!=this.ListBox){this.ListBox.SetSelectedIndex(),this.ListBox.SelectedIndex>=0&&(t=this.ListBox.SelectedIndex),""==this.SearchText&&(this.ListBox.SelectedValue=this.ListBox.Items[0].Value,this.ListBox.SelectedIndex=0,this.ListBox.SelectedItem=this.ListBox.Items[0]),-1==t&&(t=0);for(let s=0;s<this.ListBox.Items.length;s++)if(e?t<this.ListBox.Items.length-1?t++:t=0:0==t?t=this.ListBox.Items.length-1:t--,null!=this.SearchText&&""!=this.SearchText&&this.ListBox.Items[t].Name.toLowerCase().Contains(this.SearchText.toLowerCase()))return void this.SelectSearchItem(t,this.ListBox)}}SelectSearchItem(e,t){t.SelectedValue=t.Items[e].Value,t.SelectedIndex=e,this.ListBox.SelectedItem=t.Items[e]}GetCheckedItems(){let e="";return this.allItems.forEach(t=>{t.IsChecked&&(e.length>0&&(e+=","),e+=t.Value.toString())}),e}}class I extends h.b{constructor(){super(...arguments),this.SaveVisible=!0,this.SelectedList=null,this.Dimensions=new o.b,this.CurrRow=null,this.IsLink=!1,this.linktype=0,this.CostCenterColID=0,this.CallType=null}DocumentListViewModel_1(e,t){this.linktype=t,this.parent=e,this.Dimensions.Visible=!1,this.BudgetField=new o.e,this.BudgetField.Visible=!1,this.BudgetField.Label="Numeric Field",this.BudgetField.LblWidth="120",this.Fields=new b,this.Fields.PactListBoxViewModel_2(new Array),this.Fields.Visible=!1,this.DocumentsWithTree=new o.b,this.DocumentsWithTree.Visible=!1,this.ReportsWithTree=new o.b,this.ReportsWithTree.Visible=!1,this.CopyWithLinking=new D.a,this.CopyWithLinking.Visible=!1,this.CopyLayout=new D.a,this.CopyLayout.Visible=!1,this.CopyActions=new D.a,this.CopyActions.Visible=!1,this.ExcludeUnApprovedQty=new D.a,this.ExcludeUnApprovedQty.Visible=!1}DocumentListViewModel_2(e,t,s,i=null,n=0,l=0){if(this.linktype=l,this.IsLink=s,this.parent=t,this.CallType=i,this.CostCenterColID=n,"MultipleCopy"!=i&&(this.Fields=new b,this.Fields.PactListBoxViewModel_2(new Array),this.Fields.Visible=!1),null==e||!e.Table.Columns.Contains("Link_Data")||"23821"!=e.Link_Data.toString()&&"50051"!=e.Link_Data.toString()&&"24062"!=e.Link_Data.toString()&&"23820"!=e.Link_Data.toString()&&"55479"!=e.Link_Data.toString())this.Dimensions.Visible=!1;else{this.Dimensions.Visible=!0;let t=e.VoucherXML.toString(),s=[];t.Contains("~")&&(t=t.substr(t.indexOf("~")+1),s=t.split(",")),this.parent.CostCenterDt.forEach(e=>{if(""!=e.Header.toString()){let t=new o.c;t.Name=e.Header.toString(),t.Value=e.ColumnCostCenterID.toString(),s.Contains(t.Value)&&(t.IsChecked=!0),this.Dimensions.Items.push(t)}})}this.BudgetField=new o.e,this.BudgetField.Visible=!1,this.BudgetField.Label="Numeric Field",this.BudgetField.LblWidth="120",this.CopyWithLinking=new D.a,this.CopyWithLinking.Visible=!1,this.CopyLayout=new D.a,this.CopyLayout.Visible=!1,this.CopyActions=new D.a,this.CopyActions.Visible=!1,this.ExcludeUnApprovedQty=new D.a,this.ExcludeUnApprovedQty.Visible=!1,this.CurrRow=e,10!=this.linktype&&this.LoadData()}LoadData(){let e="";this.IsLink&&null!=this.CurrRow&&this.CurrRow.Table.Columns.Contains("DocumentList")?e=this.CurrRow.DocumentList.toString():this.IsLink||null==this.CurrRow||!this.CurrRow.Table.Columns.Contains("VoucherXML")||this.CurrRow.VoucherXML.toString().Contains("XML")?null!=this.CurrRow&&this.CurrRow.Table.Columns.Contains("PaymentModes")&&!this.CurrRow.PaymentModes.toString().Contains("XML")&&(e=this.CurrRow.PaymentModes.toString()):(e=this.CurrRow.VoucherXML.toString(),this.Dimensions.Visible&&e.Contains("~")&&(e=e.substr(0,e.indexOf("~"))));let t,s=e.split(",");if(this.Documents=new o.b,null!=this.CurrRow&&this.CurrRow.Table.Columns.Contains("LinkCostCenterID")&&"2"==this.CurrRow.LinkCostCenterID.toString()&&"DocumentDesignerViewModel"==this.parent.ClassName)this.Documents.Label=" Documents List",this.Title=this.DisplayName=" Documents List",this.parent.CostCenterDt.forEach(e=>{""!=e.Header.toString()&&(t=new o.c,t.Name=e.Header.toString(),t.Value=e.ColumnCostCenterID.toString(),s.Contains(t.Value)&&(t.IsChecked=!0),this.Documents.Items.push(t))});else if(!this.IsLink&&null!=this.CurrRow&&this.CurrRow.Table.Columns.Contains("ColumnType")&&"-9"==this.CurrRow.ColumnType.toString()&&"DocumentDesignerViewModel"==this.parent.ClassName)this.Documents.Label=" Dimensions List",this.Title=this.DisplayName=" Dimensions List",t=new o.c,t.Name="Product",t.Value="3",s.Contains(t.Value)&&(t.IsChecked=!0),this.Documents.Items.push(t),this.parent.CostCenterDt.forEach(e=>{""!=e.Header.toString()&&(t=new o.c,t.Name=e.Header.toString(),t.Value=e.ColumnCostCenterID.toString(),s.Contains(t.Value)&&(t.IsChecked=!0),this.Documents.Items.push(t))});else if("AddEditBudgetViewModel"==this.parent.ClassName){let e=this.parent;if("ShowAccountTypes"==e.PopupCall){this.Documents.Label=" Account Types",this.Title=this.DisplayName=" Account Types";let n=i.a.common.GetDataSet("COM004","");s=e.AccountTypes.DefaultValue.split(","),n.Tables[0].forEach(e=>{t=new o.c,t.Name=e.AccountType.toString(),t.Value=e.AccountTypeID.toString(),s.Contains(t.Value)&&(t.IsChecked=!0),this.Documents.Items.push(t)})}else{this.Documents.Label=" Documents List",this.Title=this.DisplayName=" Documents List";let l="True";"ShowInvAccountingDocs"==e.PopupCall&&(l="False");let h=i.a.common.GetDataSet("COM005",l);this.BudgetField.Visible=!0,this.BudgetField.Items.push(o.d.ComboBoxItems_2("None","0"));for(let e=1;e<50;e++)this.BudgetField.Items.push(o.d.ComboBoxItems_2("Field "+e,e.toString()));"False"==l?(this.BudgetField.SelectedValue=this.parent.InvAccDocsField,s=this.parent.strInvAccountingDocs.split(",")):(this.BudgetField.SelectedValue=this.parent.NonAccDocsField,s=this.parent.strNonAccountingDocs.split(",")),n.e.IsEmpty(this.BudgetField.SelectedValue)&&(this.BudgetField.SelectedValue=this.BudgetField.Items[0].Value),h.Tables[0].forEach(e=>{t=new o.c,t.Name=e.DocumentName.toString(),t.Value=e.CostCenterID.toString(),s.Contains(t.Value)&&(t.IsChecked=!0),this.Documents.Items.push(t)})}}this.DocumentsWithSearch=new b,this.DocumentsWithSearch.PactListBoxViewModel_2(this.Documents.Items),this.DocumentsWithSearch.Label="Documents",this.ReportsWithTree=new o.b,this.DocumentsWithTree=new o.b,new Array,this.CostCenterColID>0||"MultipleCopy"==this.CallType?(this.Title=this.DisplayName="Copy Field",this.DocumentsWithSearch.Visible=!1,this.CopyWithLinking.Visible=!0,this.CopyActions.Visible=!0,this.CopyLayout.Visible=!0):(this.ReportsWithTree=new o.b,this.ReportsWithTree.Visible=!1,this.DocumentsWithTree.Visible=!1,"AssignRole"==this.CallType&&"RoleDataViewModel"==this.parent.ClassName&&(this.DocumentsWithSearch.Label=""))}OnSave(e){if("Cancel"==e)i.a.page.HideDialog();else if("OK"==e){let e="";for(let t=0;t<this.Documents.Items.length;t++)this.Documents.Items[t].IsChecked&&(e.length>0&&(e+=","),e+=this.Documents.Items[t].Value.toString());if("PreferencesViewModel"==this.parent.ClassName)if(4==this.linktype);else if(10==this.linktype){if(null!=this.CurrRow&&this.CurrRow.Table.Columns.Contains("DimFilter")){let e="";for(let t=0;t<this.Dimensions.Items.length;t++)this.Dimensions.Items[t].IsChecked&&(e.length>0&&(e+=","),e+=this.Dimensions.Items[t].Value.toString());this.CurrRow.DimFilter=e}}else null!=this.CurrRow&&this.CurrRow.Table.Columns.Contains("PaymentModes")&&(this.CurrRow.PaymentModes=e);else if("RoleDataViewModel"==this.parent.ClassName)if("AssignRole"==this.CallType){if(!this.parent.AssignToRoles(e))return}else this.parent.DimensionsList=e;else if("AddEditBudgetViewModel"==this.parent.ClassName){let t=this.parent;if("ShowAccountTypes"==t.PopupCall)t.AccountTypes.DefaultValue=e,t.AccountTypes.Mandatory=t.AccountTypes.DefaultValue.length>0;else{if(t.DisplayMessage="","ShowInvAccountingDocs"==t.PopupCall?t.strInvAccountingDocs=e:t.strNonAccountingDocs=e,e.length>0&&n.e.IsEmpty(this.BudgetField.SelectedValue)||t.ProductBasedOn.Items[0].IsChecked&&"0"==this.BudgetField.SelectedValue)return void(t.DisplayMessage="Please select field");"ShowInvAccountingDocs"==t.PopupCall?t.InvAccDocsField=this.BudgetField.SelectedValue:t.NonAccDocsField=this.BudgetField.SelectedValue}}i.a.page.HideDialog()}}}var y=s("0HHv");class B extends h.b{constructor(e,t,s,n){super(),this.BudgetDefID=0,this.GroupID=0,this.SelectedNodeID=0,this.PopupCall="",this.DataCollection=null,this.timespan=0,this.Label=null,this.Status=new o.e(0),this.QtyType=new o.e(0),this.BudgetName=new a.d(0),this.BudgetType=new o.e(0),this.Group=new o.e(0),this.LeftDimensions=new o.e(0),this.RightDimensions=new o.e(0),this.CodeListView=new o.e(0),this.StartYear=new d.a(0),this.lstBasicColumns=new Array,this.CCCount=0,this.PreviousBudgetType=" ",this.CurrentBudgetType=" ",this.IsForeignCurrency=!1,this.IsBudgetFromDocument=!1,this.ConfigVisible=!1,this.BudgetVisible=!1,this.strNonAccountingDocs="",this.NonAccDocsField="",this.strInvAccountingDocs="",this.InvAccDocsField="",this.ChkBudgetOnlyForDefnAccountsObj=new D.a,this.budgetInput=[],this.budgetTable=new Array,this.ClassName="AddEditBudgetViewModel",this.SelectedNodeID=t,this.GroupID=n,this.DataCollection=new p.a,this.BudgetDefID=e,this.DataCollection.isGroup=s,this.AccountTypes=new m.a,this.AccountTypes.DefaultValue="",this.StartYear.Label=i.a.GetResource("Appointment_Date"),this.BudgetType.Label=i.a.GetResource("Budget_BudgetType"),this.BudgetName.Label=i.a.GetResource("Budget_BudgetName"),this.Status.Label=i.a.GetResource("Budget_Status"),this.Group.Label=i.a.GetResource("Budget_Group"),this.ChkBudgetOnlyForDefnAccountsObj.Label="Check budget only for defined accounts",this.QtyType.Label="Type",this.QtyType.LblWidth="60",this.LeftDimensions.OptionsSize=10,this.RightDimensions.OptionsSize=8,this.RightDimensions.SelectionChangedCommand.Subscribe(this,"ListViewSelectionChange","Right"),this.BudgetType.SelectionChangedCommand.Subscribe(this,"OnSelectionChanged"),this.CodeListView.SelectionChangedCommand.Subscribe(this,"ListViewSelectionChange","CodeListViewChanged"),this.CodeListView.LblWidth="0",this.DecimalsinAmount="N"+i.a.SessionManager.Preferences.DecimalsinAmount,this.Status.Items.push(o.d.ComboBoxItems_2(i.a.GetResource("Budget_InActive"),"0")),this.Status.Items.push(o.d.ComboBoxItems_2(i.a.GetResource("Budget_Active"),"1")),this.Status.SelectedValue="1",this.QtyType.Items.push(o.d.ComboBoxItems_2("Both","0")),this.QtyType.Items.push(o.d.ComboBoxItems_2("Only free","1")),this.QtyType.Items.push(o.d.ComboBoxItems_2("Only qty","2")),this.QtyType.SelectedValue="0",this.BudgetType.Items.push(o.d.ComboBoxItems_2(i.a.GetResource("Budget_Annual"),"0")),this.BudgetType.Items.push(o.d.ComboBoxItems_2(i.a.GetResource("Budget_Halfyearely"),"1")),this.BudgetType.Items.push(o.d.ComboBoxItems_2(i.a.GetResource("Budget_Quarterly"),"2")),this.BudgetType.Items.push(o.d.ComboBoxItems_2(i.a.GetResource("Budget_Monthly"),"3")),this.BudgetType.SelectedValue="0",this.ProductBasedOn=new c.b(""),this.ProductBasedOn.IsHorizontalOrientation=!0,this.ProductBasedOn.Label="Based On",this.ProductBasedOn.Items.push(new c.a("Amount",0)),this.ProductBasedOn.Items[0].Label=i.a.GetResource("DocumentDesigner_Amount"),this.ProductBasedOn.Items[0].IsChecked=!0,this.ProductBasedOn.Items.push(new c.a("Qty",1)),this.ProductBasedOn.Items[1].Label=i.a.GetResource("Packages_Qty"),this.ProductBasedOn.Items.push(new c.a("Value",2)),this.ProductBasedOn.Items[2].Label=i.a.GetResource("Service_Value"),this.ProductBasedOn.Items[0].CheckedChangedCommand.Subscribe(this,"OnQtyCheckedChanged"),this.ProductBasedOn.Items[1].CheckedChangedCommand.Subscribe(this,"OnQtyCheckedChanged"),this.ProductBasedOn.Items[2].CheckedChangedCommand.Subscribe(this,"OnQtyCheckedChanged"),this.ProductBasedOn.Items[0].Group=this.ProductBasedOn,this.ProductBasedOn.Items[1].Group=this.ProductBasedOn,this.ProductBasedOn.Items[2].Group=this.ProductBasedOn,this.ds=this.DataCollection.GetBudgetScreenDetails(0,0),this.Title=i.a.GetResource(s?e>0?"Budget_EditGroup":"Budget_AddGroup":e>0?"Budget_EditBudget":"Budget_AddBudget");for(let i=0;i<=this.ds.Tables[0].length-1;i++)this.LeftDimensions.Items.push(o.d.ComboBoxItems_2(this.ds.Tables[0][i].NAME.toString(),this.ds.Tables[0][i].ID.toString()));if(this.ds.Tables.length>1&&this.ds.Tables[1].length>0){for(let e=0;e<this.ds.Tables[1].length;e++)this.Group.Items.push(o.d.ComboBoxItems_2(this.ds.Tables[1][e].BudgetName.toString(),this.ds.Tables[1][e].BudgetDefID.toString()));this.Group.SelectedValue="1"}this.PstBudgetGrid=new r.a,this.PstBudgetGrid.Height=0,this.PstBudgetGrid.SearchVisible=!0,this.PstBudgetGrid.IsReadOnly=!0,this.PstBudgetGrid.Width="",this.PstBudgetGrid.Table=[],this.PstBudgetGrid.OnLinkClick.Subscribe(this,"OnGridLinkClick"),this.EntryGrid=new r.a,this.EntryGrid.Height=80,this.EntryGrid.Width="",this.EntryGrid.Table=[],this.EntryGrid.OnCellEditEnding.Subscribe(this,"OnGridCellEditEnding"),this.EntryGrid.OnLinkClick.Subscribe(this,"OnEntryGridLinkClick"),this.EntryGrid.OnBeginEdit.Subscribe(this,"OnEntryGridBeginEdit"),this.EntryGrid.CanUserDeleteRows=!0,this.InitBasicGrid(),e>0?(this.BudgetVisible=!0,this.ConfigVisible=!1,this.LoadData()):(this.BudgetVisible=!1,this.ConfigVisible=!0)}get dt(){return this.PstBudgetGrid.Table}get dtColumns(){return this.PstBudgetGrid.TableColumns}LoadData(){this.budgetTable.Clear();let e=this.DataCollection.GetBudgetScreenDetails(0,this.BudgetDefID);this.StartYear.Date=new Date(e.Tables[0][0].StartYear),this.BudgetName.Text=n.e.String(e.Tables[0][0].BudgetName),this.BudgetType.SelectedValue=n.e.String(e.Tables[0][0].BudgetTypeID),this.QtyType.SelectedValue=n.e.String(e.Tables[0][0].QtyType),this.Status.SelectedValue=n.e.String(e.Tables[0][0].StatusID),this.strNonAccountingDocs=n.e.String(e.Tables[0][0].NonAccDocs),this.NonAccDocsField=n.e.String(e.Tables[0][0].NonAccDocsField),this.strInvAccountingDocs=n.e.String(e.Tables[0][0].InvAccDocs),this.InvAccDocsField=n.e.String(e.Tables[0][0].InvAccDocsField),this.AccountTypes.DefaultValue=n.e.String(e.Tables[0][0].AccountTypes),this.AccountTypes.Mandatory=this.AccountTypes.DefaultValue.length>0,this.ChkBudgetOnlyForDefnAccountsObj.IsChecked=Object(l.j)(e.Tables[0][0].ChkBudgetOnlyForDefnAccounts),0==parseInt(e.Tables[0][0].QtyBudget)?(this.ProductBasedOn.Items[0].IsChecked=!0,this.ProductBasedOn.Items[1].IsChecked=!1,this.ProductBasedOn.Items[2].IsChecked=!1):1==parseInt(e.Tables[0][0].QtyBudget)?(this.ProductBasedOn.Items[0].IsChecked=!1,this.ProductBasedOn.Items[1].IsChecked=!0,this.ProductBasedOn.Items[2].IsChecked=!1):(this.ProductBasedOn.Items[0].IsChecked=!1,this.ProductBasedOn.Items[1].IsChecked=!1,this.ProductBasedOn.Items[2].IsChecked=!0),this.Group.SelectedValue=this.GroupID.toString(),this.Group.Enable=!1;for(let t=0;t<e.Tables[2].length;t++)for(let s=0;s<this.LeftDimensions.Items.length;s++)n.e.String(e.Tables[2][t][e.Columns[2][1]])==this.LeftDimensions.Items[s].Value&&(this.RightDimensions.Items.push(this.LeftDimensions.Items[s]),this.LeftDimensions.Items.RemoveAt(s),e.Columns[2].Contains("CCCodeTypeID")&&(this.RightDimensions.Items[this.RightDimensions.Items.length-1].Aliasname=e.Tables[2][t].CCCodeTypeID.toString()));this.IsBudgetFromDocument=e.Tables[3].length>0,this.AddYearColumns(!1);for(let t=0;t<e.Tables[1].length;t++){this.PstBudgetGrid.Table.length-1<=t&&(this.PstBudgetGrid.Table.push(),this.PstBudgetGrid.Table.push(),this.PstBudgetGrid.Table.push());for(let s=0;s<this.RightDimensions.Items.length;s++)"2"==this.RightDimensions.Items[s].Value?this.PstBudgetGrid.Table[t].CC2_Key=e.Tables[1][t].AccountID.toString():"3"==this.RightDimensions.Items[s].Value?this.PstBudgetGrid.Table[t].CC3_Key=e.Tables[1][t].ProductID.toString():this.PstBudgetGrid.Table[t]["CC"+this.RightDimensions.Items[s].Value+"_Key"]=e.Tables[1][t]["CCNID"+(parseInt(this.RightDimensions.Items[s].Value)-5e4)].toString();this.PstBudgetGrid.Table[t].RowID=e.Tables[1][t].BudgetAllocID,this.PstBudgetGrid.Table[t].Action="Edit",this.PstBudgetGrid.Table[t].Delete="Delete",this.PstBudgetGrid.Table[t].CF=e.Tables[1][t].CF,this.PstBudgetGrid.Table[t].Budget=e.Tables[1][t].AnnualAmount,this.PstBudgetGrid.Table[t].Y0=e.Tables[1][t].AnnualAmount,this.PstBudgetGrid.Table[t].H0=e.Tables[1][t].YearH1Amount,this.PstBudgetGrid.Table[t].H1=e.Tables[1][t].YearH2Amount,this.PstBudgetGrid.Table[t].Q0=e.Tables[1][t].Qtr1Amount,this.PstBudgetGrid.Table[t].Q1=e.Tables[1][t].Qtr2Amount,this.PstBudgetGrid.Table[t].Q2=e.Tables[1][t].Qtr3Amount,this.PstBudgetGrid.Table[t].Q3=e.Tables[1][t].Qtr4Amount,this.PstBudgetGrid.Table[t].M0=e.Tables[1][t].Month1Amount,this.PstBudgetGrid.Table[t].M1=e.Tables[1][t].Month2Amount,this.PstBudgetGrid.Table[t].M2=e.Tables[1][t].Month3Amount,this.PstBudgetGrid.Table[t].M3=e.Tables[1][t].Month4Amount,this.PstBudgetGrid.Table[t].M4=e.Tables[1][t].Month5Amount,this.PstBudgetGrid.Table[t].M5=e.Tables[1][t].Month6Amount,this.PstBudgetGrid.Table[t].M6=e.Tables[1][t].Month7Amount,this.PstBudgetGrid.Table[t].M7=e.Tables[1][t].Month8Amount,this.PstBudgetGrid.Table[t].M8=e.Tables[1][t].Month9Amount,this.PstBudgetGrid.Table[t].M9=e.Tables[1][t].Month10Amount,this.PstBudgetGrid.Table[t].M10=e.Tables[1][t].Month11Amount,this.PstBudgetGrid.Table[t].M11=e.Tables[1][t].Month12Amount,this.PstBudgetGrid.Table[t].dcNumField1=e.Tables[1][t].dcNumField1,this.PstBudgetGrid.Table[t].dcNumField2=e.Tables[1][t].dcNumField2,this.PstBudgetGrid.Table[t].dcNumField3=e.Tables[1][t].dcNumField3,this.PstBudgetGrid.Table[t].dcNumField4=e.Tables[1][t].dcNumField4,this.PstBudgetGrid.Table[t].dcNumField5=e.Tables[1][t].dcNumField5,this.PstBudgetGrid.Table[t].Currency_Key=e.Tables[1][t].CurrencyID,this.PstBudgetGrid.Table[t].ExchangeRate=e.Tables[1][t].ExchangeRT,this.PstBudgetGrid.Table[t].Rate=e.Tables[1][t].Rate,this.ValidateBudgetRow_1(this.PstBudgetGrid.Table[t]),this.PstBudgetGrid.Table[t].Sno=this.budgetTable.length}this.PstBudgetGrid.refreshDataView(),console.log(this.PstBudgetGrid.Table),console.log(this.PstBudgetGrid.Columns)}InitBasicGrid(){let e;this.IsForeignCurrency=Object(l.j)(i.a.SessionManager.Preferences["Use Foreign Currency"]),this.dtColumns.push("Sno"),this.dtColumns.push("Action"),this.dtColumns.push("Delete"),this.dtColumns.push("RowID"),this.dtColumns.push("CF"),this.dtColumns.push("CF_Key"),this.dtColumns.push("Budget"),this.dtColumns.push("Utilized"),this.dtColumns.push("Balance"),this.dtColumns.push("Currency"),this.dtColumns.push("Currency_Key"),this.dtColumns.push("ExchangeRate"),this.dtColumns.push("Rate"),this.dtColumns.push("Y0"),this.dtColumns.push("H0"),this.dtColumns.push("H1"),this.dtColumns.push("Q0"),this.dtColumns.push("Q1"),this.dtColumns.push("Q2"),this.dtColumns.push("Q3"),this.dtColumns.push("M0"),this.dtColumns.push("M1"),this.dtColumns.push("M2"),this.dtColumns.push("M3"),this.dtColumns.push("M4"),this.dtColumns.push("M5"),this.dtColumns.push("M6"),this.dtColumns.push("M7"),this.dtColumns.push("M8"),this.dtColumns.push("M9"),this.dtColumns.push("M10"),this.dtColumns.push("M11"),this.dtColumns.push("dcNumField1"),this.dtColumns.push("dcNumField2"),this.dtColumns.push("dcNumField3"),this.dtColumns.push("dcNumField4"),this.dtColumns.push("dcNumField5"),e=new u.a,e.Header=i.a.GetResource("Row No"),e.DisplayMember="Sno",e.DataType="TextBlock",e.IsVisible=!0,e.ReadOnly=!0,e.IsFrozen=!0,e.Width=60,this.lstBasicColumns.push(e),e=new u.a,e.Header=i.a.GetResource("Service_Action"),e.DisplayMember="Action",e.DataType="LINK",e.ReadOnly=!0,e.IsFrozen=!0,e.Width=50,this.lstBasicColumns.push(e),e=new u.a,e.Header=i.a.GetResource("Delete"),e.DisplayMember="Delete",e.ID="Delete",e.DataType="LINK",e.IsVisible=!1,e.ReadOnly=!0,e.IsFrozen=!0,e.Width=50,this.lstBasicColumns.push(e),e=new u.a,e.ID="CF",e.Header="CarryForward",e.DataType="PactComboBox",e.ValueBinding="CF",e.DisplayMember="CF",e.ValueMember="CF_Key",e.Width=100;let t=[];t.push({CF:"",CF_Key:""}),t.push({CF:"Monthly",CF_Key:"M"}),e.ComboData=t,this.lstBasicColumns.push(e),e=new u.a,e.Header=i.a.GetResource("Budget_Budget"),e.DisplayMember="Budget",e.DataType="FLOAT",e.ReadOnly=!1,e.Width=100,e.DecimalPoints=i.a.SessionManager.Preferences.DecimalsinAmount,this.lstBasicColumns.push(e),e=new u.a,e.Header=i.a.GetResource("Budget_Utilized"),e.DisplayMember="Utilized",e.DataType="FLOAT",e.ReadOnly=!0,e.IsVisible=!1,e.Width=100,e.DecimalPoints=i.a.SessionManager.Preferences.DecimalsinAmount,this.lstBasicColumns.push(e),e=new u.a,e.Header=i.a.GetResource("Budget_Balance"),e.DisplayMember="Balance",e.DataType="FLOAT",e.ReadOnly=!0,e.IsVisible=!1,e.Width=100,e.DecimalPoints=i.a.SessionManager.Preferences.DecimalsinAmount,this.lstBasicColumns.push(e),e=new u.a,e.Header=i.a.GetResource("Budget_Currency"),e.DisplayMember="Currency",e.ValueMember="Currency_Key",e.DataType="LISTBOX",e.CostCenterID=12,e.TypeID=1,e.ReadOnly=!1,e.Width=90,e.IsVisible=this.IsForeignCurrency,this.lstBasicColumns.push(e),e=new u.a,e.Header=i.a.GetResource("Budget_ExchangeRate"),e.DisplayMember="ExchangeRate",e.DataType="FLOAT",e.ReadOnly=!1,e.Width=70,e.IsVisible=this.IsForeignCurrency,this.lstBasicColumns.push(e),e=new u.a,e.Header=i.a.GetResource("Inv_CCRate_Rate"),e.DisplayMember="Rate",e.DataType="FLOAT",e.ReadOnly=!1,e.IsVisible=!1,e.Width=70,e.IsVisible=this.IsForeignCurrency,this.lstBasicColumns.push(e);for(let s=1;s<=5;s++){e=new u.a,e.DisplayMember="dcNumField"+s,e.DataType="FLOAT",e.ReadOnly=!1,e.Width=70;let t=this.ds.Tables[2].filter(e=>e.SysColumnName=="dcNumField"+s);t.length>0?(e.Header=t[0].Caption.toString(),e.IsVisible=!0):e.IsVisible=!1,this.lstBasicColumns.push(e)}for(let s=0;s<45;s++)this.dt.push([])}AddYearColumns(e){let t,s,l=new Array;this.RightDimensions.Items.forEach(e=>{if(this.CCCount++,t=new u.a,t.Header=i.a.GetResource(e.Name),t.ValueMember="CC"+e.Value+"_Key",t.DisplayMember="CC"+e.Value,this.dtColumns.Contains(t.ValueMember)||(this.dtColumns.push(t.ValueMember),this.dtColumns.push(t.DisplayMember)),t.ReadOnly=!1,t.DataType="LISTBOX",t.CostCenterID=parseInt(e.Value),t.ShowRootDimension=!0,t.Width=120,t.IsFrozen=!0,t.TypeID="2"==e.Value?2:"3"==e.Value?10:1,l.push(t),t.CostCenterID>0&&!n.e.IsEmpty(e.Aliasname)&&parseInt(e.Aliasname)>0){let s=t.Clone();s.Header=s.Header+"Code",s.TypeID=parseInt(e.Aliasname),s.DisplayMember=s.DisplayMember+"Code",l.push(s),this.dtColumns.Contains(s.DisplayMember)||this.dtColumns.push(s.DisplayMember)}});for(let i=0;i<this.lstBasicColumns.length;i++)i<=2?l.Insert(i,this.lstBasicColumns[i]):l.push(this.lstBasicColumns[i]);"0"==this.BudgetType.SelectedValue?(this.CurrentBudgetType="Y",this.timespan=1):"1"==this.BudgetType.SelectedValue?(this.CurrentBudgetType="H",this.timespan=2):"2"==this.BudgetType.SelectedValue?(this.CurrentBudgetType="Q",this.timespan=4):"3"==this.BudgetType.SelectedValue&&(this.CurrentBudgetType="M",this.timespan=12);for(let n=0;n<this.timespan;n++){t=new u.a,s=new u.a,t.DisplayMember=this.CurrentBudgetType.toString()+n,s.DisplayMember="U"+t.DisplayMember,s.DisableTab=!0,s.ID="Util",s.IsVisible=!1,this.dtColumns.Contains(t.DisplayMember)||this.dtColumns.push(s.DisplayMember);let e="";"Y"==this.CurrentBudgetType?e=this.StartYear.Date.getFullYear().toString():"H"==this.CurrentBudgetType?e=n+1+"/"+this.StartYear.Date.getFullYear():"M"==this.CurrentBudgetType?e=this.StartYear.Date.AddMonths(n).ToString("MMM/yyyy"):"Q"==this.CurrentBudgetType&&(e=(n+1+"/"+this.StartYear.Date.getFullYear()).toString()),t.Header=e,s.Header=i.a.GetResource("Budget_Utilized"),t.DecimalPoints=s.DecimalPoints=i.a.SessionManager.Preferences.DecimalsinAmount,t.DataType=s.DataType="FLOAT",t.ReadOnly=s.ReadOnly=!1,t.Width=s.Width=90,l.push(t),"Y"!=this.CurrentBudgetType&&l.push(s)}e&&this.DistrbuteAmounts(),this.PreviousBudgetType=this.CurrentBudgetType;let h=new Array;l.forEach(e=>{let t=new u.a;t.ID=e.ID,t.Header=e.Header,t.DisplayMember=e.DisplayMember,t.ValueMember=e.ValueMember,t.ValueBinding=e.ValueBinding,t.ComboData=e.ComboData,t.ReadOnly=e.ReadOnly,t.DataType=e.DataType,t.CostCenterID=e.CostCenterID,t.Width=e.Width,t.DecimalPoints=e.DecimalPoints,t.TypeID=e.TypeID,t.ShowRootDimension=!0,t.IsVisible=e.IsVisible,t.IsFrozen=e.IsFrozen,h.push(t),t.ReadOnly||(t.ReadOnly=!0),"Delete"==t.ID?t.IsVisible=!0:"Rate"==t.DisplayMember&&(e.IsVisible=t.IsVisible=this.ProductBasedOn.Items[0].IsChecked)}),this.PstBudgetGrid.Columns=h,this.EntryGrid.Columns=l,this.EntryGrid.Table.Clear(),this.EntryGrid.TableColumns=this.dtColumns,this.IsBudgetFromDocument&&(this.EntryGrid.Columns[1].IsVisible=!1,this.PstBudgetGrid.Columns[1].IsVisible=!1,this.PstBudgetGrid.Columns[2].IsVisible=!1),this.ClearEntryGrid(),this.AccountTypes.Visible=!this.RightDimensions.Items.find(e=>"2"==e.Value)}DistrbuteAmounts(){let e=0,t=0,s=0,i=0;"Y"==this.PreviousBudgetType?e=1:"H"==this.PreviousBudgetType?e=2:"Q"==this.PreviousBudgetType?e=4:"M"==this.PreviousBudgetType&&(e=12),"Y"==this.CurrentBudgetType?t=1:"H"==this.CurrentBudgetType?t=2:"Q"==this.CurrentBudgetType?t=4:"M"==this.CurrentBudgetType&&(t=12);let l=0;if(t>e){l=t/e;for(let h=0;h<this.dt.length;h++){let o=this.dt[h];if(""==n.e.String(o.Budget))break;let a=0;for(let h=0;h<e;h++)for(i=n.e.Double(o[this.PreviousBudgetType.toString()+h]),s=i/l,s=parseFloat(s.ToString(this.DecimalsinAmount));a<t;)if(o[this.CurrentBudgetType.toString()+a]=s.ToString(this.DecimalsinAmount),a++,a%l==0){o[this.CurrentBudgetType.toString()+(a-1)]=(i-s*(l-1)).ToString(this.DecimalsinAmount);break}}}else{l=e/t;for(let i=0;i<this.dt.length;i++){let o=this.dt[i];if(""==n.e.String(o.Budget))break;let a=0;for(let i=0;i<t;i++){for(s=0;a<e;){try{s+=parseFloat(o[this.PreviousBudgetType.toString()+a])}catch(h){}if(a++,a%l==0)break}o[this.CurrentBudgetType.toString()+i]=s}}}}ListViewSelectionChange(e){if("Right"==e.toString()){if(this.RightDimensions.SetSelectedIndex(),-1!=this.RightDimensions.SelectedIndex&&this.RightDimensions.Items.length>0){if(this.CodeListView.Items.Clear(),this.CodeListView.Items.push(o.d.ComboBoxItems_2("","0")),this.ds.Tables.length>3&&this.ds.Tables[3].length>0){let e=this.ds.Tables[3].filter(e=>e.CostCenterID==this.RightDimensions.Items[this.RightDimensions.SelectedIndex].Value);if(null!=e&&e.length>0)for(let t=0;t<e.length;t++)this.CodeListView.Items.push(o.d.ComboBoxItems_2(e[t].ListViewName.toString(),e[t].ListViewTypeID.toString()))}this.CodeListView.SelectedValue=this.RightDimensions.Items[this.RightDimensions.SelectedIndex].Aliasname}}else"CodeListViewChanged"==e.toString()&&(this.RightDimensions.SetSelectedIndex(),-1!=this.RightDimensions.SelectedIndex&&this.RightDimensions.Items.length>0&&(this.RightDimensions.Items[this.RightDimensions.SelectedIndex].Aliasname=this.CodeListView.SelectedValue))}OnSelectionChanged(e){this.AddYearColumns(!0)}OnQtyCheckedChanged(e){this.AddYearColumns(!1)}OnSave(e){if(this.DisplayMessage="","ConfigureOK"==e.toString())this.DisplayMessage="",this.AddYearColumns(!1),this.BudgetVisible=!0,this.ConfigVisible=!1;else if("Configure"==e.toString())this.DisplayMessage="",this.budgetTable.length>0?this.DisplayMessage="Dimensions can not be configured after entering budget data.":(this.BudgetVisible=!1,this.ConfigVisible=!0);else if("Save"==e.toString())this.DataCollection.Budgetid=this.BudgetDefID,this.SaveMethod();else if("SaveAs"==e.toString())this.DataCollection.Budgetid=0,this.SaveMethod();else if("ShowNonAccountingDocs"==e.toString()){this.PopupCall="ShowNonAccountingDocs";let e=new I;e.DocumentListViewModel_2(null,this,!1),i.a.page.ShowDialog(e,y.a,{ShowCenter:!0,NoWidth:!0})}else if("ShowInvAccountingDocs"==e.toString()){this.PopupCall="ShowInvAccountingDocs";let e=new I;e.DocumentListViewModel_2(null,this,!1),i.a.page.ShowDialog(e,y.a,{ShowCenter:!0,NoWidth:!0})}else if("ShowAccountTypes"==e.toString()){this.PopupCall="ShowAccountTypes";let e=new I;e.DocumentListViewModel_2(null,this,!1),i.a.page.ShowDialog(e,y.a,{ShowCenter:!0,NoWidth:!0})}}SaveMethod(){if(this.DataCollection.NumDimensions=0,this.DataCollection.CCList="",n.e.IsEmptySpace(this.BudgetName.Text))return void(this.DisplayMessage="Enter Budget Name");this.DataCollection.BudgetName=this.BudgetName.Text.Trim(),this.RightDimensions.Items.forEach(e=>{this.DataCollection.NumDimensions++,this.DataCollection.CCList+='<Row CC="'+e.Value+'" CCCodeTypeID="'+(n.e.IsEmpty(e.Aliasname)?"0":e.Aliasname)+'" />'}),this.DataCollection.CCList.length>0&&(this.DataCollection.CCList="<XML>"+this.DataCollection.CCList+"</XML>");let e,t="";if(!this.IsBudgetFromDocument)for(let s=0;s<this.PstBudgetGrid.Table.length;s++)if(!n.e.IsEmpty(this.PstBudgetGrid.Table[s].Budget)){let i=0,l=0;if("0"==this.BudgetType.SelectedValue){if(parseFloat(this.dt[s].Budget)!=parseFloat(this.dt[s].Y0))return this.DisplayMessage="Budget not Matched in Row : "+(s+1),void(this.MessageVisibility=!0)}else if("1"==this.BudgetType.SelectedValue){if(parseFloat(this.dt[s].Budget)!=parseFloat(this.dt[s].H0)+parseFloat(this.dt[s].H1))return this.DisplayMessage="Budget not Matched in Row : "+(s+1),void(this.MessageVisibility=!0)}else if("2"==this.BudgetType.SelectedValue){for(let e=0;e<4;e++)i=parseFloat(this.dt[s]["Q"+e]),l+=i;if(parseInt(this.dt[s].Budget)!=l)return this.DisplayMessage="Budget not Matched in Row : "+(s+1),void(this.MessageVisibility=!0)}else if("3"==this.BudgetType.SelectedValue){for(let e=0;e<12;e++)i=parseFloat(this.dt[s]["M"+e]),l+=i;if(Math.abs(parseFloat(this.dt[s].Budget)-l)>.01)return this.DisplayMessage="Budget not Matched in Row : "+(s+1),void(this.MessageVisibility=!0)}t+='<Row Budget="'+this.dt[s].Budget.toString()+'" ',t+=' Sno="'+this.dt[s].Sno.toString()+'" ',t+=' CF="'+n.e.String(this.dt[s].CF)+'" ',t+=' Utilized="'+n.e.String(this.dt[s].Utilized)+'" ',t+=' Balance="'+n.e.String(this.dt[s].Balance)+'" ',t+=' Currency="'+n.e.String(this.dt[s].Currency_Key)+'" ',t+=' ExchangeRate="'+this.dt[s].ExchangeRate.toString()+'" ',t+=' Rate="'+n.e.String(this.dt[s].Rate)+'" ',t+="0"!=this.BudgetType.SelectedValue?' AnnualAmount="'+this.dt[s].Budget.toString()+'" ':' AnnualAmount="'+this.dt[s].Y0.toString()+'" ',t+=' YearH1Amount="'+this.dt[s].H0.toString()+'" ',t+=' YearH2Amount="'+this.dt[s].H1.toString()+'" ',t+=' Qtr1Amount="'+this.dt[s].Q0.toString()+'" ',t+=' Qtr2Amount="'+this.dt[s].Q1.toString()+'" ',t+=' Qtr3Amount="'+this.dt[s].Q2.toString()+'" ',t+=' Qtr4Amount="'+this.dt[s].Q3.toString()+'" ',t+=' Month1Amount="'+this.dt[s].M0.toString()+'" ',t+=' Month2Amount="'+this.dt[s].M1.toString()+'" ',t+=' Month3Amount="'+this.dt[s].M2.toString()+'" ',t+=' Month4Amount="'+this.dt[s].M3.toString()+'" ',t+=' Month5Amount="'+this.dt[s].M4.toString()+'" ',t+=' Month6Amount="'+this.dt[s].M5.toString()+'" ',t+=' Month7Amount="'+this.dt[s].M6.toString()+'" ',t+=' Month8Amount="'+this.dt[s].M7.toString()+'" ',t+=' Month9Amount="'+this.dt[s].M8.toString()+'" ',t+=' Month10Amount="'+this.dt[s].M9.toString()+'" ',t+=' Month11Amount="'+this.dt[s].M10.toString()+'" ',t+=' Month12Amount="'+this.dt[s].M11.toString()+'" ',t+=' dcNumField1="'+n.e.String(this.dt[s].dcNumField1)+'" ',t+=' dcNumField2="'+n.e.String(this.dt[s].dcNumField2)+'" ',t+=' dcNumField3="'+n.e.String(this.dt[s].dcNumField3)+'" ',t+=' dcNumField4="'+n.e.String(this.dt[s].dcNumField4)+'" ',t+=' dcNumField5="'+n.e.String(this.dt[s].dcNumField5)+'" ',this.RightDimensions.Items.forEach(i=>{t+="2"==i.Value?" AccountID":"3"==i.Value?" ProductID":" CC"+(parseInt(i.Value)-5e4),e=0,e=n.e.Int(this.PstBudgetGrid.Table[s]["CC"+i.Value+"_Key"]),0==e&&(e=1),t+='="'+e+'"'}),t+="/>"}if(t.length>0||this.IsBudgetFromDocument){this.IsBudgetFromDocument?this.DataCollection.SbXML=null:(t="<XML>"+t+"</XML>",this.DataCollection.SbXML=t.toString()),t="",this.IsBudgetFromDocument||(this.budgetTable.forEach(e=>{e.childSet.forEach(s=>{t+='<Row PID="'+e.rowID+'"',t+=' CID="'+s+'"/>'})}),t.length>0&&(t="<Relations>"+t+"</Relations>")),this.DataCollection.RelationsXML=t.toString(),this.DataCollection.StartYear=this.StartYear.Date,this.DataCollection.BudgetTypeID=parseInt(this.BudgetType.SelectedValue),this.DataCollection.BudgetType=this.BudgetType.Text,this.DataCollection.Status=parseInt(this.Status.SelectedValue),this.DataCollection.IsQtyBudget=this.ProductBasedOn.Items[1].IsChecked?1:this.ProductBasedOn.Items[2].IsChecked?2:0,this.DataCollection.QtyType=n.e.Int(this.QtyType.SelectedValue),this.DataCollection.ChkBudgetOnlyForDefnAccounts=this.ChkBudgetOnlyForDefnAccountsObj.IsChecked,this.DataCollection.strNonAccountingDocs=this.strNonAccountingDocs,this.DataCollection.NonAccDocsField=this.NonAccDocsField,this.DataCollection.strInvAccountingDocs=this.strInvAccountingDocs,this.DataCollection.InvAccDocsField=this.InvAccDocsField,this.DataCollection.AccountTypes=this.AccountTypes.Visible?this.AccountTypes.DefaultValue:"",this.DataCollection.SelectedNodeID=this.SelectedNodeID;let e=0,s=this.DataCollection.SaveBudgetScreenDetails();this.DisplayMessage=s.Message,e=s.RetValue,e>0&&(this.BudgetDefID=e)}}OnEntryGridBeginEdit(e,t,s){return!!(t.startsWith("CC")&&parseInt(e.Sno)>0)}OnEntryGridLinkClick(e,t,s){if(this.DisplayMessage="","Action"==t&&!n.e.IsEmpty(e.Budget)){this.RightDimensions.Items.forEach(t=>{let s=0;s=n.e.Int(e["CC"+t.Value+"_Key"]),0==s&&(e["CC"+t.Value+"_Key"]=1,this.EntryGrid.RefreshGrid=!0)});let t=0,s=0,l=0;if(s=parseFloat(e.Budget),"0"==this.BudgetType.SelectedValue)l=parseFloat(e.Y0);else if("1"==this.BudgetType.SelectedValue)l=parseFloat(e.H0)+parseFloat(e.H1);else if("2"==this.BudgetType.SelectedValue)for(let i=0;i<4;i++)t=parseFloat(e["Q"+i].toString()),l+=t;else if("3"==this.BudgetType.SelectedValue)for(let i=0;i<12;i++)t=parseFloat(e["M"+i].toString()),l+=t;if(l=parseFloat(l.ToString("N"+i.a.SessionManager.Preferences.DecimalsinAmount)),s!=l)return void(this.DisplayMessage="Budget not Matched.");this.DistrbuteAmounts_dr(e);let h=parseInt(this.EntryGrid.Table[0].Sno);if(this.ValidateBudgetRow_2(e,h),n.e.IsEmpty(this.DisplayMessage)){let t=null;if(0==h){for(let e=0;e<this.PstBudgetGrid.Table.length;e++)if(n.e.IsEmpty(this.PstBudgetGrid.Table[e].Sno)){t=this.PstBudgetGrid.Table[e];break}}else for(let i=0;i<this.PstBudgetGrid.Table.length;i++)if(n.e.String(this.PstBudgetGrid.Table[i].Sno)==n.e.String(e.Sno)){t=this.PstBudgetGrid.Table[i];break}null==t&&(t=this.PstBudgetGrid.NewRow(),this.PstBudgetGrid.addRow(t));let s=0;s=n.e.Int(e.Currency_Key),0==s&&(e.Currency_Key=1,e.ExchangeRate=1);for(let i=0;i<this.EntryGrid.TableColumns.length;i++)t[this.EntryGrid.TableColumns[i]]=e[this.EntryGrid.TableColumns[i]];0==h&&(t.Sno=this.budgetTable[this.budgetTable.length-1].rowID),t.Action="Edit",t.Delete="Delete",this.PstBudgetGrid.updateRow(t),this.ClearEntryGrid()}}}EntryGrid_RowDeleted(e,t){let s=this.EntryGrid.NewRow();s.Action="Submit",this.EntryGrid.addRow(s),this.EntryGrid.SelectedIndex=this.EntryGrid.Table.indexOf(s)}OnGridCellEditEnding(e,t,s){let i=0;if("Budget"==t){let t=0;if(i=n.e.Double(e.Budget),"0"==this.BudgetType.SelectedValue)e.Y0=i;else if("1"==this.BudgetType.SelectedValue)Object(g.isNullOrUndefined)(e.H0)||(t=parseFloat(e.H0)),Object(g.isNullOrUndefined)(e.H1)||(t+=parseFloat(e.H1)),i!=t&&this.DistributeWithDecimals(e,"H",i,2);else if("2"==this.BudgetType.SelectedValue)Object(g.isNullOrUndefined)(e.Q0)||(t=parseFloat(e.Q0)),Object(g.isNullOrUndefined)(e.Q1)||(t+=parseFloat(e.Q1)),Object(g.isNullOrUndefined)(e.Q2)||(t+=parseFloat(e.Q2)),Object(g.isNullOrUndefined)(e.Q3)||(t+=parseFloat(e.Q3)),i!=t&&this.DistributeWithDecimals(e,"Q",i,4);else{for(let s=0;s<12;s++)Object(g.isNullOrUndefined)(e["M"+s])||(t+=parseFloat(e["M"+s]));i!=t&&this.DistributeWithDecimals(e,"M",i,12)}this.EntryGrid.updateRow(e)}else if("Y0"==t)e.Budget=e.Y0,this.EntryGrid.updateRow(e);else if("1"==this.BudgetType.SelectedValue&&t.startsWith("H"))Object(g.isNullOrUndefined)(e.H0)||(i=parseFloat(e.H0)),Object(g.isNullOrUndefined)(e.H1)||(i+=parseFloat(e.H1)),e.Budget=i.ToString(this.DecimalsinAmount),this.EntryGrid.updateRow(e);else if("2"==this.BudgetType.SelectedValue&&t.startsWith("Q"))Object(g.isNullOrUndefined)(e.Q0)||(i=parseFloat(e.Q0)),Object(g.isNullOrUndefined)(e.Q1)||(i+=parseFloat(e.Q1)),Object(g.isNullOrUndefined)(e.Q2)||(i+=parseFloat(e.Q2)),Object(g.isNullOrUndefined)(e.Q3)||(i+=parseFloat(e.Q3)),e.Budget=i.ToString(this.DecimalsinAmount),this.EntryGrid.updateRow(e);else if("3"==this.BudgetType.SelectedValue&&t.startsWith("M")){for(let t=0;t<12;t++)Object(g.isNullOrUndefined)(e["M"+t])||(i+=parseFloat(e["M"+t]));e.Budget=i.ToString(this.DecimalsinAmount),this.EntryGrid.updateRow(e)}}DistributeWithDecimals(e,t,s,i){let n=0,l=s/i;l=parseFloat(l.ToString(this.DecimalsinAmount));for(let h=0;h<i-1;h++)n+=l,e[t+h]=l.ToString(this.DecimalsinAmount);e[t+(i-1)]=(s-n).ToString(this.DecimalsinAmount)}OnGridLinkClick(e,t,s){if(this.DisplayMessage="","Action"==t){for(let t=0;t<this.EntryGrid.TableColumns.length;t++)this.EntryGrid.Table[0][this.EntryGrid.TableColumns[t]]=e[this.EntryGrid.TableColumns[t]];this.EntryGrid.Table[0].Action="Submit",this.EntryGrid.updateRow(this.EntryGrid.Table[0])}else"Delete"==t&&confirm(i.a.GetResource("DeleteMessage"))&&this.OnDeleteCallBack()}ClearEntryGrid(){this.EntryGrid.Clear(),this.EntryGrid.addEmptyRow(),this.EntryGrid.Table[0].Sno="0",this.EntryGrid.Table[0].Action="Submit",this.EntryGrid.SelectedIndex=0,this.EntryGrid.updateRow(this.EntryGrid.Table[0])}OnDeleteCallBack(){let e=this.PstBudgetGrid.SelectedItem,t=(parseInt(e.Sno),"");try{this.inpRow=new C.c(0,""),this.RightDimensions.Items.forEach(t=>{e["CC"+t.Value+"_Key"].toString().length>0&&parseInt(e["CC"+t.Value+"_Key"])>1?this.inpRow.addDimValue(e["CC"+t.Value+"_Key"].toString()):this.inpRow.addDimValue("")}),this.budgetInput.Clear(),this.budgetInput.push(this.inpRow);let s=[];this.myBudget=new C.a(this.budgetTable,this.RightDimensions.Items.length),this.myBudget.deleteBudgetDimRow(this.inpRow,s,t)>0?this.DisplayMessage=t:(this.ClearEntryGrid(),this.PstBudgetGrid.removeRow(e),this.strTransLog="")}catch(s){throw s}}OnMoveItem(e){switch(e){case"Left":this.LeftDimensions.SetSelectedIndex(),-1!=this.LeftDimensions.SelectedIndex&&(this.RightDimensions.Items.push(this.LeftDimensions.Items[this.LeftDimensions.SelectedIndex]),this.LeftDimensions.Items.RemoveAt(this.LeftDimensions.SelectedIndex));break;case"Right":this.RightDimensions.SetSelectedIndex(),-1!=this.RightDimensions.SelectedIndex&&(this.LeftDimensions.Items.push(this.RightDimensions.Items[this.RightDimensions.SelectedIndex]),this.RightDimensions.Items.RemoveAt(this.RightDimensions.SelectedIndex))}}OnMoveDirection(e){let t=-1;switch(this.RightDimensions.SetSelectedIndex(),e){case"Up":if(0!=this.RightDimensions.SelectedIndex&&-1!=this.RightDimensions.SelectedIndex){t=this.RightDimensions.SelectedIndex;let e=this.RightDimensions.Items[this.RightDimensions.SelectedIndex];this.RightDimensions.Items.RemoveAt(this.RightDimensions.SelectedIndex),this.RightDimensions.Items.Insert(t-1,e),this.RightDimensions.SelectedValue=e.Value}break;case"Down":if(-1!=this.RightDimensions.SelectedIndex&&this.RightDimensions.SelectedIndex<this.RightDimensions.Items.length-1){let e=this.RightDimensions.Items[this.RightDimensions.SelectedIndex];this.RightDimensions.Items.Insert(this.RightDimensions.SelectedIndex+2,e),this.RightDimensions.Items.RemoveAt(this.RightDimensions.SelectedIndex),this.RightDimensions.SelectedValue=e.Value}}}DistrbuteAmounts_dr(e){let t=0,s=0,i=0,l=0,h=null;"Y"==this.CurrentBudgetType?(t=1,h=["M","H","Q"]):"H"==this.CurrentBudgetType?(t=2,h=["M","Y","Q"]):"Q"==this.CurrentBudgetType?(t=4,h=["M","H","Y"]):"M"==this.CurrentBudgetType&&(t=12,h=["Y","H","Q"]);for(let a=0;a<h.length;a++){let d=h[a];"Y"==d?s=1:"H"==d?s=2:"Q"==d?s=4:"M"==d&&(s=12);let r=0;if(s>t){if(r=s/t,""==n.e.String(e.Budget))return;let h=0;for(let o=0;o<t;o++)for(l=n.e.Double(e[this.CurrentBudgetType.toString()+o]),i=l/r,i=parseFloat(i.ToString(this.DecimalsinAmount));h<s;)if(e[d.toString()+h]=i.ToString(this.DecimalsinAmount),h++,h%r==0){e[d.toString()+(h-1)]=(l-i*(r-1)).ToString(this.DecimalsinAmount);break}}else{if(r=t/s,""==n.e.String(e.Budget))return;let l=0;for(let n=0;n<s;n++){for(i=0;l<t;){try{i+=parseFloat(e[this.CurrentBudgetType.toString()+l])}catch(o){}if(l++,l%r==0)break}e[d.toString()+n]=i}}}}ValidateBudgetRow_1(e){this.ValidateBudgetRow_2(e,0)}ValidateBudgetRow_2(e,t){this.DisplayMessage="";let s=null;t<=0?(s=new C.c(0,""),s.amount=parseFloat(e.Budget),this.RightDimensions.Items.forEach(t=>{e["CC"+t.Value+"_Key"].toString().length>0?s.addDimValue(e["CC"+t.Value+"_Key"].toString()):s.addDimValue("1")})):(s=new C.c,s.rowID=t,s.amount=parseFloat(e.Budget),this.RightDimensions.Items.forEach(t=>{e["CC"+t.Value+"_Key"].toString().length>0&&parseInt(e["CC"+t.Value+"_Key"])>1?s.addDimValue(e["CC"+t.Value+"_Key"].toString()):s.addDimValue("")})),this.inpRow=s,this.budgetInput.Clear(),this.budgetInput.push(this.inpRow);let i={errMsg:""};if(this.myBudget=new C.a(this.budgetTable,this.RightDimensions.Items.length),t<=0){let e=[],t=this.myBudget.checkAddBudgetConflicts(this.inpRow,e,i);if(0!=t)return this.DisplayMessage=i.errMsg,this.inpRow.linkedDimRows="",void(this.inpRow.tempLinkedDimRows=0);{let s=1;if(this.budgetTable.length>0&&(s=this.budgetTable[this.budgetTable.length-1].rowID+1),t=this.myBudget.updateDimsRowsWithNewRowId(this.inpRow,e,s),0==t){let t={strTransLog:this.strTransLog};this.myBudget.getTransactionLogSummary(e,t),this.strTransLog=t.strTransLog;let i=new C.c;i.DimensionRow_1(this.inpRow),i.rowID=s,this.budgetTable.push(i)}}}else{if(this.myBudget.checkEditBudgetConflicts(this.inpRow,i)>0)return void(this.DisplayMessage=i.errMsg);{let e={tmpRow:null};0==this.getDimensionRow(this.inpRow.rowID,e)&&(s=e.tmpRow,this.assignDimRowValues(this.inpRow,s))}}}getDimensionRow(e,t){for(let s=0;s<this.budgetTable.length;s++)if(t.tmpRow=this.budgetTable[s],t.tmpRow.rowID==e)return 0;return 1}assignDimRowValues(e,t){t.rowID=e.rowID,t.amount=e.amount,t.totalAmount=e.totalAmount,t.budgetUsed=e.budgetUsed,t.linkedDimRows=e.linkedDimRows,t.nAnys=e.nAnys,t.nAnysComputed=e.nAnysComputed,t.tempLinkedDimRows=e.tempLinkedDimRows,t.row.Clear();for(let s=0;s<e.row.length;s++)t.row.push(e.row[s])}GetDocsTotal(e,t){let s=0;return e.RowFilter=t,e.forEach(e=>{s+=parseFloat(e.Balance)}),s}}}}]);
function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var n,i=_getPrototypeOf(e);if(t){var o=_getPrototypeOf(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return _possibleConstructorReturn(this,n)}}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}(window.webpackJsonp=window.webpackJsonp||[]).push([[70],{FNqn:function(e,t,n){"use strict";n.r(t),n.d(t,"POSExitViewModel",(function(){return p}));var i=n("mrSG"),o=n("ScVY"),s=n("4HhE"),r=n("wlFP"),a=n("n56n"),l=n("JIg3"),u=n("8B8H"),c=n("/GLD"),h=n("Do2H"),g=n("ockk"),S=n("mvPR"),D=n("eQJW"),m=n("Lp6j"),b=n("3L/X"),d=n("lUlH"),C=n("ThYU"),p=function(e){_inherits(o,e);var t=_createSuper(o);function o(){var e;return _classCallCheck(this,o),(e=t.call(this)).ButtonClick=new s.b,e.DayClose=new r.a(0),e.HoldVisibility=!1,e.DraftVisibility=!1,e.ExitVisible=!1,e.OptionsVisible=!1,e.GridVisible=!1,e.PrintVisibility=!1,e.Shift=new a.b,e.PrintDate=new l.c(0),e.CancelVisible=!0,e.BackVisible=!1,e.ShowDenomHelp=!1,e.NumericPADView=null,e.TouchVisibility=!1,e.LoginVisi=!1,e.ReportVisibility=!1,e.DtExit=[],e.IsPayMode=!1,e.IsShiftClose=!1,e.IsDiff=!1,e.ManagerLoggedin=!1,e.oReport=null,e.Denom=null,e.DenomXML="",e.RegName="",e.CloseType=0,e.DtDiffPosting=new m.f,e.ClassName="POSExitViewModel",e}return _createClass(o,[{key:"POSExitViewModel_1",value:function(e,t,n,i){this.DayClose.Visible=!1,this._parent=e,this.OptionsVisible=t,this.HoldVisibility=n,this.DraftVisibility=i,this.DayClose.Label="Day Close",t||n||i||(this.ExitVisible=!0),this.OptionsVisible?(this.Title="Options",this.Options_CashIN=h.a.SessionManager.IsActionAssigned(this._parent.CostCenterID,"Options - Cash In"),this.Options_CashOut=h.a.SessionManager.IsActionAssigned(this._parent.CostCenterID,"Options - Cash Out"),this.Options_CashRegister=h.a.SessionManager.IsActionAssigned(this._parent.CostCenterID,"Options - Cash Register"),h.a.SessionManager.Preferences.ContainsKey("PosShifts")&&""!=h.a.SessionManager.Preferences.PosShifts.toString()&&parseInt(h.a.SessionManager.Preferences.PosShifts.toString())>5e4&&(this.Options_ShiftClose=!0),this.Options_ShiftClose&&(this.Shift.CCID=parseInt(h.a.SessionManager.Preferences.PosShifts.toString()),this.Shift.TypeID=1),this.Options_DayClose=!0):this.Title=this.HoldVisibility?h.a.GetResource("Com_SaveAsHold"):i?h.a.GetResource("Remarks"):"Exit",this.ButtonClick.Subscribe(this,"OnButtonClick"),this.ExitVisible&&this.InitGrid()}},{key:"InitGrid",value:function(){this.Exit_UserExit=h.a.SessionManager.IsActionAssigned(this._parent.CostCenterID,"User Exit"),this.Exit_UserClose=h.a.SessionManager.IsActionAssigned(this._parent.CostCenterID,"User Close"),this.Exit_ShiftClose=h.a.SessionManager.IsActionAssigned(this._parent.CostCenterID,"Shift Close"),this.Exit_DayClose=h.a.SessionManager.IsActionAssigned(this._parent.CostCenterID,"Day Close"),this.DTPayModesObj=new u.a,this.DTPayModesObj.Columns=[],this.DTPayModesObj.Table=[],this.DTPayModesObj.TableColumns.push("Name"),this.DTPayModesObj.TableColumns.push("NameWithKey"),this.DTPayModesObj.TableColumns.push("Amount"),this.DTPayModesObj.DataTypes.Double.push("Amount"),this.DTPayModesObj.TableColumns.push("Type"),this.DTPayModesObj.TableColumns.push("SysColumnName"),this.DTPayModesObj.TableColumns.push("DenomXML"),this.DtReportObj=new u.a,this.DtReportObj.Columns=[],this.DtReportObj.Table=[],this.DtReportObj.TableColumns.push("NameWithKey"),this.DtReportObj.TableColumns.push("Amount"),this.DtReportObj.TableColumns.push("AmountActual"),this.DtReportObj.DataTypes.Double.push("AmountActual"),this.DtReportObj.TableColumns.push("SysColumnName"),this.DtReportObj.TableColumns.push("Type"),this.DtReportObj.TableColumns.push("StyleIsBold"),this.DtReportObj.TableColumns.push("Row_Background"),this.Parent.ScreenObject.Preferences.ContainsKey("PosPostings")&&"true"==this.Parent.ScreenObject.Preferences.PosPostings.toLowerCase()&&this.DtReportObj.TableColumns.push("PostJV"),this.ExitGrid=new u.a,this.ExitGrid.Columns=[],this.ExitGrid.Table=[],this.ExitGrid.Width="",this.ExitGrid.Height=250,this.ExitGrid.RowHeight=this.Parent.GridRowHeight,this.ExitGrid.BeginEdit.Subscribe(this,"OnExitGridBeginEdit");var e=[],t=new g.a;t.Header="Name",t.DisplayMember="NameWithKey",t.DisableTab=!0,t.Width=220,t.ReadOnly=!0,t.DisableTab=!0,e.push(t),(t=new g.a).Header="Value",t.DisplayMember="Amount",t.DataType="FLOAT",t.DecimalPoints=h.a.SessionManager.Preferences.DecimalsinAmount,t.Width=180,e.push(t),this.ExitGrid.Columns=e}},{key:"OnButtonClick",value:function(e){return Object(i.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var i,o,s,r,a,l,u,c,g,S,b,p,f,P,y,T,R,A,O,I,w,M,N,V=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null==e){t.next=107;break}return!m.e.IsEmpty(this.ExitGrid)&&this.ExitGrid.gridObj&&null!=this.ExitGrid.gridObj.getActiveCellNode()&&this.ExitGrid.gridObj.getEditorLock().commitCurrentEdit(),t.next=4,Promise.resolve().then(n.bind(null,"GhW8"));case 4:return i=t.sent,o=i.LoginViewModel,t.next=8,Promise.resolve().then(n.bind(null,"kJpQ"));case 8:s=t.sent,r=s.LoginScreenComponent,t.t0=e.toString(),t.next="Login"===t.t0?13:"Cancel"===t.t0?23:"DayClose"===t.t0?25:"ShiftClose"===t.t0?30:"UserClose"===t.t0?32:"UserExit"===t.t0?34:"LockScreen"===t.t0?36:"CashOut"===t.t0?42:"CashIN"===t.t0?55:"CashRegister"===t.t0?68:"HoldDoc"===t.t0?80:"OK"===t.t0?86:"Previous"===t.t0?94:"Back"===t.t0?96:"PrintDayClose"===t.t0?98:"PrintShiftClose"===t.t0?100:"PrintOK"===t.t0?102:107;break;case 13:return t.next=15,new o(this.router);case 15:return(a=t.sent).IsPosMangr=!0,a.ShowRememberMe=!1,a.ShowDefaultCompany=!1,t.next=21,Promise.all([n.e(2),n.e(1),n.e(3),n.e(5),n.e(4),n.e(6),n.e(7),n.e(10),n.e(9),n.e(8),n.e(12),n.e(11),n.e(13),n.e(19),n.e(15),n.e(21),n.e(20),n.e(16),n.e(14),n.e(18),n.e(17),n.e(22),n.e(23),n.e(24),n.e(25),n.e(28),n.e(30),n.e(29),n.e(32),n.e(31),n.e(27),n.e(26),n.e(35),n.e(37),n.e(38),n.e(36),n.e(33),n.e(34),n.e(39),n.e(40),n.e(41),n.e(212)]).then(n.bind(null,"ThYU"));case 21:return h.a.page.ShowDialog(a,r).subscribe((function(){if(a.IsLoggedIn){V.BackVisible=!0,V.LoginVisi=!1;var e=new C.ReportViewModel;e.ReportViewModel_1(18),e.ShowHeaderButtons=!1,e.SearchVisibility=!1,V.Report=e,V.ReportVisibility=!0}})),t.abrupt("break",107);case 23:return h.a.page.HideDialog(),t.abrupt("break",107);case 25:if(!(h.a.SessionManager.Preferences.PosShifts.length>0&&parseInt(h.a.SessionManager.Preferences.PosShifts)>5e4&&this.Parent.ScreenObject.ShiftNodeID>0)){t.next=28;break}if(!(h.a.admin.POSLogin(this.Parent.ScreenObject.RegisterNodeID,this.Parent.ScreenObject.ShiftNodeID,this.Parent.DocumentDate,104,"","","").obj<0)){t.next=28;break}return t.abrupt("return",(this.DisplayMessage="Close all shifts before DayClose",void(this.MessageVisibility=!0)));case 28:return this.CloseType=1,h.a.SessionManager.Preferences.ContainsKey("DontShowPaymodeWhileDayClose")&&""!=h.a.SessionManager.Preferences.DontShowPaymodeWhileDayClose&&Object(D.j)(h.a.SessionManager.Preferences.DontShowPaymodeWhileDayClose)?(l={RetVal:0},d.a.POSLogin(this.Parent.ScreenObject.RegisterNodeID,this.Parent.ScreenObject.ShiftNodeID,this.Parent.DocumentDate,this.CloseType,"","","",l),l.RetVal,h.a.page.HideDialog(),h.a.page.removeActiveTab()):(this.ExitVisible=!1,this.GridVisible=!0,this.IsShiftClose=!1,this.Paymodes(null)),t.abrupt("break",107);case 30:return this.CloseType=2,h.a.SessionManager.Preferences.ContainsKey("DontShowPaymodeWhileShiftClose")&&""!=h.a.SessionManager.Preferences.DontShowPaymodeWhileShiftClose&&Object(D.j)(h.a.SessionManager.Preferences.DontShowPaymodeWhileShiftClose)?(u={RetVal:0},d.a.POSLogin(this.Parent.ScreenObject.RegisterNodeID,this.Parent.ScreenObject.ShiftNodeID,this.Parent.DocumentDate,this.CloseType,"","","",u),u.RetVal,h.a.page.HideDialog(),h.a.page.removeActiveTab()):(this.ExitVisible=!1,this.GridVisible=!0,this.IsShiftClose=!0,this.Paymodes(null)),t.abrupt("break",107);case 32:return this.CloseType=3,h.a.SessionManager.Preferences.ContainsKey("DontShowPaymodeWhileUserClose")&&""!=h.a.SessionManager.Preferences.DontShowPaymodeWhileUserClose&&Object(D.j)(h.a.SessionManager.Preferences.DontShowPaymodeWhileUserClose)?(h.a.admin.POSLogin(this.Parent.ScreenObject.RegisterNodeID,this.Parent.ScreenObject.ShiftNodeID,this.Parent.DocumentDate,this.CloseType,"","","").obj,h.a.page.HideDialog(),h.a.page.removeActiveTab()):(this.ExitVisible=!1,this.GridVisible=!0,this.IsShiftClose=!1,this.Paymodes(null)),t.abrupt("break",107);case 34:return(confirm("Do you really want to exit?")||h.a.SessionManager.IsWebApplication)&&(this.CloseType=0,this.CloseSession()),t.abrupt("break",107);case 36:if(!confirm("Do you really want to lock?")){t.next=41;break}return t.next=39,new o(this.router);case 39:(c=t.sent).IsUserLock=!0,c.CancelVisiblity=!1,c.ShowRememberMe=!1,c.ShowDefaultCompany=!1,c.Title="Un Lock",h.a.page.HideDialog(),h.a.page.ShowDialog(c,r);case 41:return t.abrupt("break",107);case 42:if(!h.a.SessionManager.Preferences.ContainsKey("CashOut")||""==h.a.SessionManager.Preferences.CashOut||"0"==h.a.SessionManager.Preferences.CashOut){t.next=54;break}return h.a.page.HideDialog(),t.next=46,Promise.resolve().then(n.bind(null,"9UOb"));case 46:return g=t.sent,S=g.PostVoucherSaveViewModel,t.next=50,Promise.resolve().then(n.bind(null,"xbaw"));case 50:b=t.sent,p=b.PostVoucherSaveComponent,f=new S(this.Parent,parseInt(h.a.SessionManager.Preferences.CashOut),0,0,1,1,!1,!1),h.a.page.ShowDialog(f,p,{ShowCenter:!0,NoWidth:!1});case 54:return t.abrupt("break",107);case 55:if(!h.a.SessionManager.Preferences.ContainsKey("CashIn")||""==h.a.SessionManager.Preferences.CashIn||"0"==h.a.SessionManager.Preferences.CashIn){t.next=67;break}return h.a.page.HideDialog(),t.next=59,Promise.resolve().then(n.bind(null,"9UOb"));case 59:return P=t.sent,y=P.PostVoucherSaveViewModel,t.next=63,Promise.resolve().then(n.bind(null,"xbaw"));case 63:T=t.sent,R=T.PostVoucherSaveComponent,A=new y(this.Parent,parseInt(h.a.SessionManager.Preferences.CashIn),0,0,1,1,!1,!1),h.a.page.ShowDialog(A,R,{ShowCenter:!0,NoWidth:!1});case 67:return t.abrupt("break",107);case 68:return h.a.page.HideDialog(),t.next=71,n.e(197).then(n.bind(null,"j1+j"));case 71:return O=t.sent,I=O.POSCashRegisterViewModel,t.next=75,n.e(0).then(n.bind(null,"oFEv"));case 75:return w=t.sent,M=w.POSCashRegisterComponent,N=new I(this.Parent),h.a.page.ShowDialog(N,M,{ShowCenter:!0,NoWidth:!1}),t.abrupt("break",107);case 80:if(0==this.Parent.DocID){t.next=82;break}return t.abrupt("return",(this.DisplayMessage=h.a.GetResource("Documentalreadysaved"),void(this.MessageVisibility=!0)));case 82:if(null!=this.Parent.HoldDocName&&""!=this.Parent.HoldDocName.Text.trim()){t.next=84;break}return t.abrupt("return",(this.DisplayMessage="Enter Name",void(this.MessageVisibility=!0)));case 84:return this.Parent.SaveDraft(!1,!1),h.a.page.HideDialog(),t.abrupt("break",107);case 86:if(!this.IsPayMode){t.next=90;break}2==this.CloseType&&(this.DayClose.IsChecked=!1,this.DayClose.Visible=!0),this.TouchVisibility=!1,this.FillGrid(!1),this.BackVisible=h.a.SessionManager.IsActionAssigned(this.Parent.CostCenterID,"CanEditPayMode"),this.IsDiff&&(this.LoginVisi=!0),t.next=93;break;case 90:if("1"==h.a.SessionManager.UserID||!this.IsDiff||!h.a.SessionManager.IsActionAssigned(this.Parent.CostCenterID,"DonotcloseifDiffinPayMode")){t.next=92;break}return t.abrupt("return",(this.DisplayMessage="Difference in PayModes",void(this.MessageVisibility=!0)));case 92:4==this.CloseType?(this.CallPrint(this.Parent.ScreenObject.ShiftNodeID),h.a.page.HideDialog()):this.CloseSession();case 93:return t.abrupt("break",107);case 94:return this.BackVisible=!1,this.CancelVisible=!0,this.ShowDenomHelp=!0,this.LoginVisi=!1,this.ReportVisibility=!1,this.IsPayMode=!0,this.IsDiff=!1,this.ExitGrid.Columns[1].ReadOnly=!1,this.ExitGrid.Height=250,this.ExitGrid.RefreshColumns(),this.ExitGrid.Table=this.DtExit,this.DtReport.Clear(),this.TouchVisibility=this.Parent.FooterTouchVisible,this.DayClose.Visible&&(this.DayClose.Visible=!1),t.abrupt("break",107);case 96:return h.a.page.HideDialog(),t.abrupt("break",107);case 98:return this.PrintVisibility=!0,this.OptionsVisible=!1,this.Shift.Visible=!1,this.PrintDate.Label=h.a.GetResource("Doc_Date"),t.abrupt("break",107);case 100:return this.PrintVisibility=!0,this.OptionsVisible=!1,this.Shift.Visible=!0,this.Shift.Label="Shift",this.PrintDate.Label=h.a.GetResource("Doc_Date"),t.abrupt("break",107);case 102:if(this.PrintDate.Date){t.next=104;break}return t.abrupt("return",(this.DisplayMessage="select Date",void(this.MessageVisibility=!0)));case 104:if(!this.Shift.Visible||0!=this.Shift.SelectedValue){t.next=106;break}return t.abrupt("return",(this.DisplayMessage="select shift",void(this.MessageVisibility=!0)));case 106:this.CloseType=this.Shift.Visible?5:4,this.InitGrid(),this.GridVisible=!0,this.PrintVisibility=!1,this.FillGrid(!0);case 107:case"end":return t.stop()}}),t,this)})))}},{key:"OnExitGridBeginEdit",value:function(e,t,n){return!(!this.IsPayMode||"Amount"!=t||"5"!=e.Type.toString()||0==e.DenomXML.toString().length)||(this.IsPayMode&&"Amount"==t&&null!=this.NumericPADView&&""!=e[t].toString()&&(this.NumericPADView.txt.Text=e[t].toString()),!1)}},{key:"Paymodes",value:function(e){var t=this;null==e?(this.ShowDenomHelp=!0,this.IsPayMode=!0):e.Tables.length>10&&e.Columns[10].Contains("DetailsXML")&&e.Tables[10].length>0&&""!=e.Tables[10][0].DetailsXML.toString()&&null.ReadXml(e.Tables[10][0].DetailsXML.toString()),this.DTPayModesObj.Clear();var n=this.Parent.ScreenObject.Data.Tables[0].filter((function(e){return e.SectionID>4&&11!=e.SectionID}),"SectionID");if(n.length>0)for(var i=2,o=function(e){var o=n[e];if(o.SysColumnName.toString().toLowerCase().Contains("currid")||o.SysColumnName.toString().toLowerCase().Contains("exchrt"))return"continue";var s={};s.Name=o.ResourceData.toString(),s.NameWithKey=i<=10?o.ResourceData.toString()+" (F"+i+")":o.ResourceData.toString(),s.SysColumnName=o.SysColumnName.toString(),s.Type=o.SectionID.toString(),!m.e.IsEmpty(null)&&null.Tables.length>0&&null.Columns[0].Contains("SysColName")&&(r=null.Tables[0].filter((function(e){return e.SysColName==o.SysColumnName.toString()}))).length>0&&!m.e.IsEmpty(r[0].Amount)&&(s.Amount=r[0].Amount.toString()),t.DTPayModes.push(s),i++},s=0;s<n.length;s++){var r;o(s)}null==e&&(this.ExitGrid.Table=this.DTPayModes),this.ExitGrid.ColumnNo=1,this.ExitGrid.LineNo=0,this.ExitGrid.SetFocusongrid=!0,this.TouchVisibility=this.Parent.FooterTouchVisible}},{key:"FillGrid",value:function(e){!e&&this.Parent.ScreenObject.Preferences.ContainsKey("POSDiffJVFields")&&""!=this.Parent.ScreenObject.Preferences.POSDiffJVFields&&this.DtDiffPosting.ReadXml(this.Parent.ScreenObject.Preferences.POSDiffJVFields);var t,n=window.innerHeight-320;n<400&&(n=400),this.ExitGrid.Columns[1].ReadOnly=!0,this.ExitGrid.Height=n,this.ExitGrid.RefreshColumns(),this.CancelVisible=!!(e||this.Parent.ScreenObject.Preferences.ContainsKey("Cancelinclose")&&"true"==this.Parent.ScreenObject.Preferences.Cancelinclose.toLowerCase()),this.ShowDenomHelp=!1,this.IsPayMode=!1;var i=0;if(e)t=this.PrintDate.Date,this.Shift.Visible&&(i=this.Shift.SelectedValue);else{this.IsShiftClose&&(i=this.Parent.ScreenObject.ShiftNodeID);var o=this.Parent.ScreenObject.HeaderFields.find((function(e){return e instanceof l.a&&"docdate"==e.DBColumnName.toLowerCase()}));t=null!=o&&""!=o.DefaultValue?new Date(o.DefaultValue):this.Parent.DocumentDate}var s=d.a.GetPOSDetails(this.Parent.PosSessionID,t,this.CloseType,this.Parent.ScreenObject.RegisterNodeID,i,"");if(s.Tables.length>1&&s.Columns[1].Contains("Prefix")&&e){if(s.Tables.length>10&&s.Columns[10].Contains("Isclose")&&s.Tables[10].length>0&&"Not close"==s.Tables[10][0].Isclose.toString())return this.DisplayMessage=4==this.CloseType?"Day not closed":"Shift not closed",this.MessageVisibility=!0,this.GridVisible=!1,void(this.PrintVisibility=!0);this.Paymodes(s)}this.DtExit=JSON.parse(JSON.stringify(this.ExitGrid.Table)),this.CloseData(s)}},{key:"CloseData",value:function(e){return Object(i.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var i,o,s,r=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null!=this.oReport){t.next=8;break}return t.next=3,Promise.all([n.e(2),n.e(1),n.e(3),n.e(5),n.e(4),n.e(6),n.e(7),n.e(10),n.e(9),n.e(8),n.e(12),n.e(11),n.e(13),n.e(19),n.e(15),n.e(21),n.e(20),n.e(16),n.e(14),n.e(18),n.e(17),n.e(22),n.e(23),n.e(24),n.e(25),n.e(28),n.e(30),n.e(29),n.e(32),n.e(31),n.e(27),n.e(26),n.e(35),n.e(37),n.e(38),n.e(36),n.e(33),n.e(34),n.e(39),n.e(40),n.e(41),n.e(212)]).then(n.bind(null,"ThYU"));case 3:i=t.sent,o=i.ReportViewModel,this.oReport=new o,this.oReport.ReportViewModel_1(190),t.next=9;break;case 8:this.oReport.Data.Clear();case 9:e.Tables.length>1&&e.Columns[1].Contains("Prefix")&&function(){e.Columns[e.Tables.length-1].Contains("Name")&&e.Tables[e.Tables.length-1].length>0&&(r.RegName=e.Tables[e.Tables.length-1][0].Name.toString());var t,n=r.Parent.ScreenObject.Preferences.POSFields.toString().split(","),i=null;r.Parent.ScreenObject.Preferences.ContainsKey("POSJVFields")&&(i=r.Parent.ScreenObject.Preferences.POSJVFields.toString().split(","));var o=0,a=null,l=null;e.Tables[1].length>0&&""!=e.Tables[1][0].orders.toString()&&(a=e.Tables[1][0].orders.toString().split(",")),e.Tables[1].length>0&&""!=e.Tables[1][0].GiftVSale.toString()&&(l=e.Tables[1][0].GiftVSale.toString().split(",")),t=r.AddRow("Sales(vouchers)","",!1,!0);for(var u=e.Tables[1].filter((function(e){return 38==e.documenttype})),c=0;c<u.length;c++)null!=a&&a.Contains(u[c].costcenterid.toString())||null!=l&&l.Contains(u[c].costcenterid.toString())||(r.AddRow(u[c].DocumentName.toString()+"-Starting No",u[c].Prefix.toString()+u[c].MinNumber.toString(),!1,!1),r.AddRow(u[c].DocumentName.toString()+"-Ending No",u[c].Prefix.toString()+u[c].MAXNumber.toString(),!1,!1),""!=u[c].cnt.toString()&&(o+=parseInt(u[c].cnt.toString())));t.Amount=o;for(var g=function(o){var s=r.Parent.ScreenObject.ColumnSource.find((function(e){return e.DisplayMember.toLowerCase()==n[o].toLowerCase()}));null!=s&&(t=r.AddRow(s.Header,e.Tables[0].length>0?e.Tables[0][0][o].toString():"FLOAT"==s.DataType?"0":"","FLOAT"==s.DataType,!1),r.DtReportObj.TableColumns.Contains("PostJV")&&null!=i&&i.Contains(n[o])&&(t.SysColumnName=n[o],t.PostJV=1))},S=0;S<n.length;S++)g(S);if(null!=a&&a.length>0){r.AddRow("","",!1,!0),o=0,t=r.AddRow("Orders(vouchers)","",!1,!0);for(var b=0;b<u.length;b++)a.Contains(u[b].costcenterid.toString())&&(r.AddRow(u[b].DocumentName.toString()+"-Starting No",u[b].Prefix.toString()+u[b].MinNumber.toString(),!1,!1),r.AddRow(u[b].DocumentName.toString()+"-Ending No",u[b].Prefix.toString()+u[b].MAXNumber.toString(),!1,!1),""!=u[b].cnt.toString()&&(o+=parseInt(u[b].cnt.toString())));if(t.Amount=o,e.Tables.length>8&&e.Tables[8].length>0)for(var d=function(i){var o=r.Parent.ScreenObject.ColumnSource.find((function(e){return e.DisplayMember.toLowerCase()==n[i].toLowerCase()}));null!=o&&(t=r.AddRow(o.Header,e.Tables[8][0][i].toString(),"FLOAT"==o.DataType,!1))},C=0;C<n.length;C++)d(C)}if(null!=l&&l.length>0){r.AddRow("","",!1,!0),o=0,t=r.AddRow("Gift (vouchers)","",!1,!0);for(var p=0;p<u.length;p++)l.Contains(u[p].costcenterid.toString())&&(r.AddRow(u[p].DocumentName.toString()+"-Starting No",u[p].Prefix.toString()+u[p].MinNumber.toString(),!1,!1),r.AddRow(u[p].DocumentName.toString()+"-Ending No",u[p].Prefix.toString()+u[p].MAXNumber.toString(),!1,!1),""!=u[p].cnt.toString()&&(o+=parseInt(u[p].cnt.toString())));if(t.Amount=o,e.Tables.length>9&&e.Tables[9].length>0)for(var f=function(i){var o=r.Parent.ScreenObject.ColumnSource.filter((function(e){return e.DisplayMember.toLowerCase()==n[i].toLowerCase()}));null!=o&&(t=r.AddRow(o.Header,e.Tables[9][0][i].toString(),"FLOAT"==o.DataType,!1))},P=0;P<n.length;P++)f(P)}r.AddRow("","",!1,!1),o=0,t=r.AddRow("Return(vouchers)","",!1,!0),u=e.Tables[1].filter((function(e){return 39==e.documenttype}));for(var y=0;y<u.length;y++)r.AddRow(u[y].DocumentName.toString()+"-Starting No",u[y].Prefix.toString()+u[y].MinNumber.toString(),!1,!1),r.AddRow(u[y].DocumentName.toString()+"-Ending No",u[y].Prefix.toString()+u[y].MAXNumber.toString(),!1,!1),""!=u[y].cnt.toString()&&(o+=parseInt(u[y].cnt.toString()));if(t.Amount=o,e.Tables.length>4&&e.Tables[4].length>0)for(var T=function(i){var o=r.Parent.ScreenObject.ColumnSource.find((function(e){return e.DisplayMember.toLowerCase()==n[i].toLowerCase()}));null!=o&&(t=r.AddRow(o.Header,e.Tables[4][0][i].toString(),"FLOAT"==o.DataType,!1))},R=0;R<n.length;R++)T(R);if(r.AddRow("","",!1,!1),r.Parent.ScreenObject.Preferences.ContainsKey("POSFields")&&""!=r.Parent.ScreenObject.Preferences.POSFields)for(var A=function(o){if(null==r.Parent.ScreenObject.ColumnSource.find((function(e){return e.DisplayMember.toLowerCase()==n[o].toLowerCase()}))){var a=r.DTPayModes.filter((function(e){return e.SysColumnName.toLowerCase()==n[o].toLowerCase()}));if(a.length>0){r.AddRow(a[0].Name.toString(),"",!1,!0),a[0].Name="  "+a[0].Name;var l,u=0;if("5"==a[0].Type.toString()){if(e.Tables.length>2&&e.Tables[2].length>0&&e.Columns[2].Contains("Amount"))for(var c=0;c<e.Tables[2].length;c++)(t="300"==e.Tables[2][c].RefCCID.toString()?r.AddRow("  Opening "+a[0].Name.toString(),e.Tables[2][c].Amount.toString(),!0,!1):r.AddRow(a[0].Name.toString()+" IN",e.Tables[2][c].Amount.toString(),!0,!1)).SysColumnName=a[0].SysColumnName.toString(),t.Type=a[0].Type.toString(),""==e.Tables[2][c].Amount.toString()||r.Parent.ScreenObject.Preferences.ContainsKey("DonotConsiderOpeningInPaymode")&&""!=r.Parent.ScreenObject.Preferences.DonotConsiderOpeningInPaymode&&Object(D.j)(r.Parent.ScreenObject.Preferences.DonotConsiderOpeningInPaymode)&&"300"==e.Tables[2][c].RefCCID.toString()||(u+=parseFloat(e.Tables[2][c].Amount.toString()));e.Tables.length>3&&e.Tables[3].length>0&&e.Columns[3].Contains("Amount")&&""!=e.Tables[3][0].Amount.toString()&&((t=r.AddRow(a[0].Name.toString()+" OUT",e.Tables[3][0].Amount.toString(),!0,!1)).SysColumnName=a[0].SysColumnName.toString(),t.Type=a[0].Type.toString(),""!=e.Tables[3][0].Amount.toString()&&(u-=parseFloat(e.Tables[3][0].Amount.toString())))}if("5"==a[0].Type.toString()?(l=0,e.Tables[0].length>0&&""!=e.Tables[0][0][e.Columns[0][o]].toString()&&(l+=parseFloat(e.Tables[0][0][e.Columns[0][o]].toString())),e.Tables.length>5&&e.Tables[5].length>0&&""!=e.Tables[5][0][e.Columns[0][0]].toString()&&(l-=parseFloat(e.Tables[5][0][e.Columns[0][0]].toString())),u+=l,t=r.AddRow(a[0].Name.toString()+" Sales",l.toString(),!0,!1),r.DtReportObj.TableColumns.Contains("PostJV")&&null!=i&&i.Contains(n[o])&&(t.SysColumnName=n[o],t.PostJV=1)):(t=r.AddRow(a[0].Name.toString(),e.Tables[0].length>0?e.Tables[0][0][e.Columns[0][o]].toString():"0",!0,!1),e.Tables[0].length>0&&""!=e.Tables[0][0][e.Columns[0][o]].toString()&&(u+=parseFloat(e.Tables[0][0][e.Columns[0][o]].toString())),r.DtReportObj.TableColumns.Contains("PostJV")&&null!=i&&i.Contains(n[o])&&(t.SysColumnName=n[o],t.PostJV=1)),t.SysColumnName=a[0].SysColumnName.toString(),t.Type=a[0].Type.toString(),e.Tables.length>7&&e.Tables[7].length>0&&""!=e.Tables[7][0][e.Columns[0][o]].toString()&&(t=r.AddRow(a[0].Name.toString()+" Reciept",e.Tables[7][0][e.Columns[0][o]].toString(),!0,!1),u+=parseFloat(e.Tables[7][0][e.Columns[0][o]].toString())),e.Tables.length>8&&e.Tables[8].length>0&&""!=e.Tables[8][0][e.Columns[0][o]].toString()&&(t=r.AddRow(a[0].Name.toString()+" Orders",e.Tables[8][0][e.Columns[0][o]].toString(),!0,!1),u+=parseFloat(e.Tables[8][0][e.Columns[0][o]].toString())),e.Tables.length>9&&e.Tables[9].length>0&&""!=e.Tables[9][0][e.Columns[0][o]].toString()&&(t=r.AddRow(a[0].Name.toString()+" Gift vouchers",e.Tables[9][0][e.Columns[0][o]].toString(),!0,!1),u+=parseFloat(e.Tables[9][0][e.Columns[0][o]].toString())),e.Tables.length>4&&e.Tables[4].length>0&&""!=e.Tables[4][0][e.Columns[0][o]].toString()&&("5"==a[0].Type.toString()?(l=0,""!=e.Tables[4][0][o].toString()&&(l+=parseFloat(e.Tables[4][0][e.Columns[0][o]].toString())),e.Tables.length>6&&e.Tables[6].length>0&&""!=e.Tables[6][0][e.Columns[0][0]].toString()&&(l-=parseFloat(e.Tables[6][0][e.Columns[0][0]].toString())),u-=l,null!=t&&r.DtReportObj.TableColumns.Contains("PostJV")&&"1"==t.PostJV.toString()&&""!=t.AmountActual.toString()&&l>0&&(t.AmountActual=parseFloat(t.AmountActual.toString())-l),t=r.AddRow("  Sales Return",l.toString(),!0,!1)):(null!=t&&r.DtReportObj.TableColumns.Contains("PostJV")&&"1"==t.PostJV.toString()&&""!=t.AmountActual.toString()&&""!=e.Tables[4][0][e.Columns[0][o]].toString()&&(t.AmountActual=parseFloat(t.AmountActual.toString())-parseFloat(e.Tables[4][0][e.Columns[0][o]].toString())),t=r.AddRow("  Sales Return",e.Tables[4][0][e.Columns[0][o]].toString(),!0,!1),u-=parseFloat(e.Tables[4][0][o].toString())),t.SysColumnName=a[0].SysColumnName.toString(),t.Type=a[0].Type.toString()),(t=r.AddRow(a[0].Name.toString()+" @Register",m.e.IsEmpty(a[0].Amount)?"0":a[0].Amount.toString(),!0,!1)).SysColumnName=a[0].SysColumnName.toString(),t.Type=a[0].Type.toString(),r.DtDiffPosting.Tables.length>0&&r.DtDiffPosting.Columns[0].Contains("Name")&&(s=r.DtDiffPosting.Tables[0].filter((function(e){return e.Name==-t.Type.toString()})),r.DtReportObj.TableColumns.Contains("PostJV")&&s.length>0&&(t.SysColumnName="RegPOs",t.PostJV=1)),u=m.e.IsEmpty(a[0].Amount)?-u:parseFloat(a[0].Amount.toString())-u,0==(u=parseFloat(u.ToString("N"+h.a.SessionManager.Preferences.DecimalsinAmount)))||r.IsDiff||(r.IsDiff=!0),(t=r.AddRow(a[0].Name.toString()+" Diff",u.toString(),!0,!1)).SysColumnName=a[0].SysColumnName.toString(),t.Type=a[0].Type.toString(),r.DtDiffPosting.Tables.length>0&&r.DtDiffPosting.Columns[0].Contains("Name")){var g=r.DtDiffPosting.Tables[0].filter((function(e){return e.Name==t.Type}));r.DtReportObj.TableColumns.Contains("PostJV")&&g.length>0&&(t.SysColumnName="DiffPOs",t.PostJV=1)}}else{var S=r.Parent.ScreenObject.Data.Tables[0].filter((function(e){return e.SysColumnName.toLowerCase()==n[o].toLowerCase()}));S.length>0&&(e.Tables[0].length>0&&(t=r.AddRow(S[0].ResourceData.toString(),e.Tables[0][0][e.Columns[0][o]].toString(),!1,!1)),r.DtReportObj.TableColumns.Contains("PostJV")&&null!=i&&i.Contains(n[o])&&(t.SysColumnName=n[o],t.PostJV=1))}}},O=0;O<n.length;O++)A(O);if(null!=r.Denom&&null!=r.Denom.GrdDenomination&&null!=r.Denom.GrdDenomination.Table&&r.Denom.GrdDenomination.Table.length>0&&r.Denom.GrdDenomination.TableColumns.Contains("Notes")&&r.Denom.GrdDenomination.TableColumns.Contains("NotesTender")){t=r.AddRow("Denominations","",!1,!0);for(var I=0;I<r.Denom.GrdDenomination.Table.length;I++)m.e.IsEmpty(r.Denom.GrdDenomination.Table[I].Notes.toString())||m.e.IsEmpty(r.Denom.GrdDenomination.Table[I].NotesTender.toString())||(t=r.AddRow(r.Denom.GrdDenomination.Table[I].Notes.toString()+" X "+r.Denom.GrdDenomination.Table[I].NotesTender.toString(),(parseFloat(r.Denom.GrdDenomination.Table[I].Notes.toString())*parseFloat(r.Denom.GrdDenomination.Table[I].NotesTender.toString())).toString(),!1,!1));r.AddRow("Total",r.Denom.GetTotal().toString(),!1,!1)}}(),this.ExitGrid.Table=this.DtReport,this.ExitGrid.refreshDatawithIDs();case 11:case"end":return t.stop()}}),t,this)})))}},{key:"AddRow",value:function(e,t,n,i){var o=new S.d(this.oReport.ReportColumns.length);i&&(o.Cells[0].IsNormal=!1,o.Cells[0].CellAppearance=this.oReport.ReportColumns[0].DataAppearance.Clone(),o.Cells[0].CellAppearance.IsBold=!0,o.Cells[0].IsNormal=!1,o.Cells[1].CellAppearance=this.oReport.ReportColumns[1].DataAppearance.Clone(),o.Cells[1].CellAppearance.IsBold=!0),o.Cells[0].Text=e;var s=0;n?(s=m.e.DoubleTryParse(t),this.oReport.SetCellValue(s,this.oReport.ReportColumns[1].DataFormat,"FLOAT",o.Cells[1])):o.Cells[1].Text=t,this.oReport.Data.push(o);var r=this.DtReportObj.NewRow();return r.NameWithKey=e,i&&(r.StyleIsBold="1"),n?(r.Amount=o.Cells[1].Text,r.AmountActual=s,e.Contains("Diff")&&(s>0&&(r.Row_Background="GREEN"),s<0&&(r.Row_Background="RED"))):r.Amount=t,this.DtReport.push(r),r}},{key:"GetJVXML",value:function(e,t){var n=this;if(t.IsValid=!0,!this.DtReportObj.TableColumns.Contains("PostJV"))return"";var i,o,s=this.Parent.ScreenObject.GenerateQueryfromList(this.Parent.ScreenObject._CCFields,!0,{message:""},!1,!1);h.a.SessionManager.RegisterCCID>0&&this.Parent.ScreenObject.RegisterNodeID>0&&!s.toString().Contains("dcCCNID"+(h.a.SessionManager.RegisterCCID-5e4).toString()+"=")&&(s+=" dcCCNID"+(h.a.SessionManager.RegisterCCID-5e4).toString()+"="+this.Parent.ScreenObject.RegisterNodeID.toString()+", "),this.Parent.ScreenObject.Preferences.ContainsKey("PosJVOn")&&"2"==this.Parent.ScreenObject.Preferences.PosJVOn&&h.a.SessionManager.Preferences.PosShifts.length>0&&parseInt(h.a.SessionManager.Preferences.PosShifts)>5e4&&this.Parent.ScreenObject.ShiftNodeID>0&&!s.toString().Contains("dcCCNID"+(parseInt(h.a.SessionManager.Preferences.PosShifts)-5e4).toString()+"=")&&(s+=" dcCCNID"+(parseInt(h.a.SessionManager.Preferences.PosShifts)-5e4).toString()+"="+this.Parent.ScreenObject.ShiftNodeID.toString()+", ");for(var r,l="",u=function(e){if("1"==m.e.StringValue(n.DtReport[e].PostJV)&&!m.e.IsEmpty(n.DtReport[e].AmountActual)&&(r="DiffPOs"==n.DtReport[e].SysColumnName.toString()?n.DtDiffPosting.Tables[0].filter((function(t){return t.Name==n.DtReport[e].Type.toString()})):"RegPOs"==n.DtReport[e].SysColumnName.toString()?n.DtDiffPosting.Tables[0].filter((function(t){return t.Name="-"+n.DtReport[e].Type.toString()})):n.Parent.ScreenObject.Data.Tables[0].filter((function(t){return t.SysColumnName==n.DtReport[e].SysColumnName.toString()}))).length>0){if(i=m.e.IntTryParse(r[0].DebitAccount.toString()),o=m.e.IntTryParse(r[0].CreditAccount.toString()),i<=0&&r[0].Table.Columns.Contains("DrRefColID")&&""!=r[0].DrRefColID.toString()&&parseInt(r[0].DrRefColID.toString())>0){var s=n.Parent.ScreenObject._CCFields.find((function(e){return e.DBColumnName.toLowerCase()==r[0].DRSysColumnName.toString().toLowerCase()}));null!=s&&s instanceof a.b&&s.SelectedValue>0&&(i=n.Parent.ScreenObject.GetAccountByRef(parseInt(r[0].DrRefID.toString()),parseInt(r[0].DrRefColID.toString()),s.SelectedValue))}if(o<=0&&r[0].Table.Columns.Contains("CrRefColID")&&""!=r[0].CrRefColID.toString()&&parseInt(r[0].CrRefColID.toString())>0){var u=n.Parent.ScreenObject._CCFields.find((function(e){return e.DBColumnName.toLowerCase()==r[0].CRSysColumnName.toString().toLowerCase()}));null!=u&&u instanceof a.b&&u.SelectedValue>0&&(o=n.Parent.ScreenObject.GetAccountByRef(parseInt(r[0].CrRefID.toString()),parseInt(r[0].CrRefColID.toString()),u.SelectedValue))}if(n.DtReportObj.TableColumns.Contains("DebitAccount")||n.DtReportObj.TableColumns.push("DebitAccount"),n.DtReportObj.TableColumns.Contains("CreditAccount")||n.DtReportObj.TableColumns.push("CreditAccount"),!(i>0))return{v:(t.IsValid=!1,n.DisplayMessage="DebitAccount not defined for "+n.DtReport[e].NameWithKey.toString(),n.MessageVisibility=!0,"")};if(n.DtReport[e].DebitAccount=i,!(o>0))return{v:(t.IsValid=!1,n.DisplayMessage="Credit not defined for "+n.DtReport[e].NameWithKey.toString(),n.MessageVisibility=!0,"")};n.DtReport[e].CreditAccount=o,l+=i+",",l+=o+","}},c=0;c<this.DtReport.length;c++){var g=u(c);if("object"==typeof g)return g.v}l.length>1&&(l=l.Remove(0,l.length));for(var S=this.Parent.ScreenObject.CheckIsBillWise(l),D=1,b="",d=function(e){"1"==m.e.StringValue(n.DtReport[e].PostJV)&&m.e.IsEmpty(n.DtReport[e].AmountActual)&&0!=parseFloat(n.DtReport[e].AmountActual.toString())&&(b+='<Row><Transactions   DocDetailsID="0"  DocSeqNo="'+D+'" Amount="'+n.DtReport[e].AmountActual.toString().Replace("-","")+'" ',b+=' AmtFc="'+n.DtReport[e].AmountActual.toString().Replace("-","")+'"  CurrencyID="1"  ExchangeRate="1" ',parseFloat(n.DtReport[e].AmountActual.toString())>0?b+='DebitAccount="'+n.DtReport[e].DebitAccount.toString()+'" CreditAccount="-99" ></Transactions> ':b+='CreditAccount="'+n.DtReport[e].DebitAccount.toString()+'" DebitAccount="-99" ></Transactions> ',b+=' <Numeric /> <Alpha /> <CostCenters  Query="'+s+'"  /> <EXTRAXML>',null!=S&&S.Tables.length>0&&S.Columns[0].Contains("AccountId")&&((r=S.Tables[0].filter((function(t){return t.AccountId==n.DtReport[e].DebitAccount.toString()}))).length>0&&"true"==r[0].IsBillwise.toString().toLowerCase()&&(b+='<BillWise> <Row DocSeqNo="'+D+'" AccountID="'+n.DtReport[e].DebitAccount.toString(),b+='" AmountFC="'+n.DtReport[e].AmountActual.toString()+'" AdjAmount="'+n.DtReport[e].AmountActual.toString()+'"',b+=' AdjCurrID="1" AdjExchRT="1" Narration=""  IsDocPDC="0" IsNewReference="1" ></Row></BillWise>')),b+="   </EXTRAXML>  </Row>",D++,b+='<Row><Transactions   DocDetailsID="0"  DocSeqNo="'+D+'" Amount="'+n.DtReport[e].AmountActual.toString().Replace("-","")+'" ',b+=' AmtFc="'+n.DtReport[e].AmountActual.toString().Replace("-","")+'"  CurrencyID="1"  ExchangeRate="1" ',parseFloat(n.DtReport[e].AmountActual.toString())>0?b+='DebitAccount="-99" CreditAccount="'+n.DtReport[e].CreditAccount.toString()+'" ></Transactions> ':b+='CreditAccount="-99" DebitAccount="'+n.DtReport[e].CreditAccount.toString()+'" ></Transactions> ',b+=' <Numeric /> <Alpha /> <CostCenters  Query="'+s+'"  /> <EXTRAXML>',null!=S&&S.Tables.length>0&&S.Columns[0].Contains("AccountId")&&((r=S.Tables[0].filter((function(t){return t.AccountId==n.DtReport[e].CreditAccount.toString()}))).length>0&&"true"==r[0].IsBillwise.toString().toLowerCase()&&(b+='<BillWise> <Row DocSeqNo="'+D+'" AccountID="'+n.DtReport[e].CreditAccount.toString(),b+='" AmountFC="-'+n.DtReport[e].AmountActual.toString()+'" AdjAmount="-'+n.DtReport[e].AmountActual.toString()+'"',b+=' AdjCurrID="1" AdjExchRT="1" Narration=""  IsDocPDC="0" IsNewReference="1" ></Row></BillWise>')),b+="   </EXTRAXML>  </Row>",D++)},C=0;C<this.DtReport.length;C++)d(C);return b.length>0&&(b="<DocumentXML>"+b+"</DocumentXML>"),b.toString()}},{key:"CloseSession",value:function(){var e,t=this,n="",i="";if(this.CloseType>0&&(i+="<XML>",this.DTPayModes.forEach((function(e){i+='<Row Type="'+m.e.String(e.Type),i+='" SysColName="'+m.e.String(e.SysColumnName),i+='" Name="'+m.e.String(e.Name),i+='" Amount="'+m.e.String(e.Amount)+'" />',"5"==e.Type.toString()&&0!=m.e.String(e.DenomXML).length&&(t.DenomXML=e.DenomXML.toString())})),i+="</XML>"),1==this.CloseType&&this.Parent.ScreenObject.Preferences.ContainsKey("PosJVOn")&&"1"==this.Parent.ScreenObject.Preferences.PosJVOn||2==this.CloseType&&this.Parent.ScreenObject.Preferences.ContainsKey("PosJVOn")&&"2"==this.Parent.ScreenObject.Preferences.PosJVOn){var o={IsValid:""};if(n=this.GetJVXML(!0,o),!o.IsValid)return this.Parent.DisplayMessage=this.DisplayMessage,this.Parent.MessageVisibility=!0,void h.a.page.HideDialog()}var s=this.Parent.ScreenObject.ShiftNodeID;5==this.CloseType&&this.Shift.Visible&&this.Shift.SelectedValue>0&&(s=this.Shift.SelectedValue),((e=h.a.admin.POSLogin(this.Parent.ScreenObject.RegisterNodeID,s,this.Parent.DocumentDate,this.CloseType,this.DenomXML,n,i.toString()).obj)>0||-100==e)&&(this.DayClose.IsChecked&&this.DayClose.Visible?e=h.a.admin.POSLogin(this.Parent.ScreenObject.RegisterNodeID,s,this.Parent.DocumentDate,1,"","","").obj:-100==e&&(confirm("All shifts are closed.Closing the Day.")||h.a.admin.POSLogin(this.Parent.ScreenObject.RegisterNodeID,s,this.Parent.DocumentDate,1,"","","")),this.CloseType>0&&(this.Parent.ScreenObject.Preferences.ContainsKey("DonotConsiderOpeningInPaymode")&&""!=this.Parent.ScreenObject.Preferences.DonotConsiderOpeningInPaymode&&Object(D.j)(this.Parent.ScreenObject.Preferences.DonotConsiderOpeningInPaymode)&&(this.ExitGrid.SelectedItem=null,this.Denom=new c.AddDenominationViewModel(this,null),h.a.page.ShowDialog(this.Denom,b.AddDenominationComponent)),this.CallPrint(s)),h.a.page.HideDialog(),h.a.page.removeActiveTab())}},{key:"AddDenom",value:function(){this.ExitGrid.SelectedItem.DenomXML=this.Denom.GetXML(),this.ExitGrid.SelectedItem.Amount=this.Denom.GetTotal(),h.a.page.HideDialog()}},{key:"CallPrint",value:function(e){this.NewPrintCode(e)}},{key:"ExportFile",value:function(e,t,n){var i=this;this.DisplayMessage="Print"==e?"Printing data please wait...":"Exporting data please wait...";var o={};t.InitPrintOrExport(o),o.Type=e,o.PrintDataOnSeperatePageBy=h.a.SessionManager.Preferences.ContainsKey("PrintDataOnSeperatePageBy")?h.a.SessionManager.Preferences.PrintDataOnSeperatePageBy:"",o.DimensionFiltersKeys.Clear(),o.DimensionFiltersValues.Clear(),o.DimensionFiltersKeys.push(h.a.SessionManager.RegisterCCID),o.DimensionFiltersValues.push(this.Parent.ScreenObject.RegisterNodeID.toString()),h.a.SessionManager.Preferences.PosShifts.length>0&&parseInt(h.a.SessionManager.Preferences.PosShifts)>5e4&&(o.DimensionFiltersKeys.push(h.a.SessionManager.Preferences.PosShifts),o.DimensionFiltersValues.push(n.toString())),h.a.SessionManager.DivisionID>0&&(o.DimensionFiltersKeys.push(50001),o.DimensionFiltersValues.push(h.a.SessionManager.DivisionID.toString())),h.a.SessionManager.LocationID>0&&(o.DimensionFiltersKeys.push(50002),o.DimensionFiltersValues.push(h.a.SessionManager.LocationID.toString())),"PDF"==e?o.lst=[]:"Print"==e?(o.lst=[],o.Type="PDF"):"Excel"!=e&&"OpenXML"!=e||(o.lst=[]),o.al="al",h.a.report.ExportReport(t.Data,t.ReportColumns,o,"POSEXIT").subscribe((function(t){"Print"==e?h.a.SessionManager.printTab(t.FileName):(h.a.SessionManager.Download(t.FileName,"khasim"),m.e.IsEmpty(t.Message)&&!m.e.IsEmpty(t.FileName)&&(i.DisplayMessage="Exported Successfully"))}),(function(e){console.log(e)}))}},{key:"NewPrintCode",value:function(e){var t="<XML><Row ColID='FROMDATE' Value='"+this.Parent.DocumentDate.ToString("dd MMM yyyy")+"'/>";t+="<Row ColID='TODATE' Value='"+this.Parent.DocumentDate.ToString("dd MMM yyyy")+"'/>",t+="<Row ColID='"+h.a.SessionManager.RegisterCCID+"' Value='"+this.Parent.ScreenObject.RegisterNodeID+"'/>",h.a.SessionManager.Preferences.PosShifts.length>0&&parseInt(h.a.SessionManager.Preferences.PosShifts)>5e4&&e>0&&(t+="<Row ColID='"+h.a.SessionManager.Preferences.PosShifts+"' Value='"+e+"'/>"),t+="</XML>";var n=new C.ReportViewModel;return n.RecordCount="",n.PostFilterData=[],n.ReportSummaryData=[],n.ReportSummaryDataColumns=[],n.ReportViewModel_Document(50,t,190,!0,this,null),this.ExportFile("Print",n,e),""}},{key:"GetReportDataTable",value:function(){var e=this,t=[];return this.ExitGrid.Table.forEach((function(n){var i={};i.RegID=e.Parent.ScreenObject.RegisterNodeID,i.RegName=e.Parent.ScreenObject.RegisterNodeID.toString(),i.Name=n.NameWithKey,i.StyleIsBold=n.StyleIsBold,i.Value=i[e.Parent.DocumentDate.ToString("ddMMMyyyy")]=n.Amount.toString(),t.push(i)})),t.length>0&&(t[0].CloseType=3==this.CloseType?"UserClose":2==this.CloseType?"ShiftClose":"DAY CLOSE"),t}},{key:"OnPreviewKeyDown",value:function(e){var t=this;if(this.IsPayMode)if(112==e.keyCode)this.IsPayMode&&(null!=this.ExitGrid.SelectedItem&&"5"==this.ExitGrid.SelectedItem.Type.toString()?(this.Denom=new c.AddDenominationViewModel(this,this.ExitGrid.SelectedItem.DenomXML.toString()),h.a.page.ShowDialog(this.Denom,b.AddDenominationComponent)):this.ExitGrid.Table.forEach((function(e){"5"==e.Type.toString()&&(t.ExitGrid.SelectedItem=e,t.Denom=new c.AddDenominationViewModel(t,t.ExitGrid.SelectedItem.DenomXML.toString()),h.a.page.ShowDialog(t.Denom,b.AddDenominationComponent))})));else if(e.keyCode>=91&&e.keyCode<=101){var n=e.keyCode-91;n<this.ExitGrid.Table.length&&(this.ExitGrid.ColumnNo=1,this.ExitGrid.LineNo=n+1,this.ExitGrid.SetFocusongrid=!0)}}},{key:"Parent",get:function(){return this._parent}},{key:"DTPayModes",get:function(){return this.DTPayModesObj.Table}},{key:"DtReport",get:function(){return this.DtReportObj.Table}}]),o}(o.b)}}]);
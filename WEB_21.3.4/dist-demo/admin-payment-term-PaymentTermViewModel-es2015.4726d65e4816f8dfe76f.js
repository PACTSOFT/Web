(window.webpackJsonp=window.webpackJsonp||[]).push([[93],{"wL+q":function(e,s,t){"use strict";t.r(s),t.d(s,"PaymentTermViewModel",(function(){return b}));var i=t("Do2H"),a=t("Lp6j"),o=t("eQJW"),n=t("ScVY"),m=t("EQd/"),l=t("0/4Q"),r=t("8B8H"),h=t("ockk"),d=t("jDOZ");class b extends n.b{constructor(){super(),this.ds=null,this.obj=new d.a,this.Name=new m.d(0),this.Profile=new l.e(0),this.Dimensions=new l.e(0),this.Name.Enable=!1,this.DisplayName=i.a.GetResource("Payment_Terms"),this.ProfileFill(),this.AddGridColumns(),this.FillingRows(),this.PaymentGrid.SearchVisible=!1,this.Name.Label="Name",this.Profile.Label="Profile",this.Dimensions.Label="Dimension",this.Profile.SelectionChangedCommand.Subscribe(this,"OnProfileSelection")}OnBeginEdit(e){"DataGridPactListBoxColumn"!=e.args.column.className||a.e.IsEmpty(this.Dimensions.SelectedValue)||"0"==this.Dimensions.SelectedValue||(e.args.Column.CostCenterID=parseInt(this.Dimensions.SelectedValue))}OnCellEditEnding(e){let s=e.item;"PactTextBoxEditor"==e.column.className&&"Percent"==e.column.field&&(""!=a.e.String(s.Percent).Trim()?(""==a.e.String(s.Period)&&(s.Period="1"),""==a.e.String(s.TypeID)&&(s.TypeID="0"),""==a.e.String(s.BasedOn)&&(s.BasedOn="1"),""==a.e.String(s.PostonDate)&&(s.PostonDate="0")):(""!=a.e.String(s.Period)&&(s.Period=null),""!=a.e.String(s.TypeID)&&(s.TypeID=null),""!=a.e.String(s.BasedOn)&&(s.BasedOn=null),""!=a.e.String(s.PostonDate)&&(s.PostonDate=null)),this.PaymentGrid.updateRow(s))}ProfileFill(){this.Profile.Items.Clear(),this.ds=this.obj.GetAndDeleteTerms(0,1),null!=this.ds&&this.ds.Tables.length>0&&this.ds.Tables[0].length>0?(this.Profile.Items.push(l.d.ComboBoxItems_2("New","-1")),this.ds.Tables[0].forEach(e=>{0==this.Profile.Items.filter(s=>s.Value==e.ProfileID.toString()).length&&this.Profile.Items.push(l.d.ComboBoxItems_2(e.ProfileName.toString(),e.ProfileID.toString()))})):(this.Profile.Items.push(l.d.ComboBoxItems_2("New","-1")),this.Dimensions.Visible=!1),null!=this.ds&&this.ds.Tables.length>1&&!a.e.IsEmpty(i.a.SessionManager.Preferences.EnableDimPayterm)&&Object(o.j)(i.a.SessionManager.Preferences.EnableDimPayterm)?(this.Dimensions.Label="Dimensions",this.Dimensions.Items.push(l.d.ComboBoxItems_2("","0")),this.ds.Tables[1].forEach(e=>{this.Dimensions.Items.push(l.d.ComboBoxItems_2(e.Name.toString(),e.FeatureID.toString()))}),this.Dimensions.Visible=!0):this.Dimensions.Visible=!1}FillingRows(){if(0==this.PaymentGrid.Table.length)for(let e=this.PaymentGrid.Table.length;e<10;e++){let s=this.PaymentGrid.NewRow();s.Sno=e+1,this.PaymentGrid.addRow(s)}}AddGridColumns(){this.PaymentGrid=new r.a,this.PaymentGrid.Columns=[],this.PaymentGrid.CellEditEnding.Subscribe(this,"OnCellEditEnding"),this.PaymentGrid.BeginEdit.Subscribe(this,"OnBeginEdit"),this.PaymentGrid.Table=[],this.PaymentGrid.CanUserAddRows=!0,this.PaymentGrid.CanUserDeleteRows=!0,this.PaymentGrid.Height=230,this.PaymentGrid.Width="1040",this.PaymentGrid.TableColumns.push("Sno"),this.PaymentGrid.TableColumns.push("Percent"),this.PaymentGrid.TableColumns.push("Days"),this.PaymentGrid.TableColumns.push("Period"),this.PaymentGrid.TableColumns.push("TypeID"),this.PaymentGrid.TableColumns.push("BasedOn"),this.PaymentGrid.TableColumns.push("Occurences"),this.PaymentGrid.TableColumns.push("PostonDate"),this.PaymentGrid.TableColumns.push("Remarks");let e=new h.a;e.Header=i.a.GetResource("Sno"),e.DisplayMember="Sno",e.ReadOnly=!0,e.Width=50,e.DataType="FLOAT",this.PaymentGrid.Columns.push(e),e=new h.a,e.Header=i.a.GetResource("Percentage"),e.DisplayMember="Percent",e.ReadOnly=!1,e.Width=135,e.DataType="FLOAT",this.PaymentGrid.Columns.push(e),e=new h.a,e.Header="Number",e.DisplayMember="Days",e.ReadOnly=!1,e.Width=100,e.DataType="INT",this.PaymentGrid.Columns.push(e),e=new h.a,e.Header="Period",e.ValueBinding="Period",e.DataType="ComboBox",e.DisplayMember="Name",e.ValueMember="Value",e.Width=100;let s=new Array;s.push(l.d.ComboBoxItems_2("Month(s)","2")),s.push(l.d.ComboBoxItems_2("Day(s)","1")),e.ComboData=s,this.PaymentGrid.Columns.push(e),e=new h.a,e.Header="Type",e.ValueBinding="TypeID",e.DataType="ComboBox",e.DisplayMember="Name",e.ValueMember="Value",e.Width=100,s=new Array,s.push(l.d.ComboBoxItems_2("None","0")),s.push(l.d.ComboBoxItems_2("Repeat","1")),s.push(l.d.ComboBoxItems_2("Divide","2")),e.ComboData=s,this.PaymentGrid.Columns.push(e),e=new h.a,e.Header="Based On",e.ValueBinding="BasedOn",e.DataType="ComboBox",e.DisplayMember="Name",e.ValueMember="Value",e.Width=100,s=new Array,s.push(l.d.ComboBoxItems_2("Voucher Date","1")),s.push(l.d.ComboBoxItems_2("Preference Date","2")),e.ComboData=s,this.PaymentGrid.Columns.push(e),e=new h.a,e.Header="Occurences",e.DisplayMember="Occurences",e.Width=100,e.DataType="INT",this.PaymentGrid.Columns.push(e),e=new h.a,e.Header="Remarks",e.DisplayMember="Remarks",e.Width=100,this.PaymentGrid.Columns.push(e),e=new h.a,e.Header="Post on Date",e.ValueBinding="PostonDate",e.DataType="ComboBox",e.DisplayMember="Name",e.ValueMember="Value",e.Width=100,s=new Array,s.push(l.d.ComboBoxItems_2("Same","0")),s.push(l.d.ComboBoxItems_2("1","1")),s.push(l.d.ComboBoxItems_2("2","2")),s.push(l.d.ComboBoxItems_2("3","3")),s.push(l.d.ComboBoxItems_2("4","4")),s.push(l.d.ComboBoxItems_2("5","5")),s.push(l.d.ComboBoxItems_2("6","6")),s.push(l.d.ComboBoxItems_2("7","7")),s.push(l.d.ComboBoxItems_2("8","8")),s.push(l.d.ComboBoxItems_2("9","9")),s.push(l.d.ComboBoxItems_2("10","10")),s.push(l.d.ComboBoxItems_2("11","11")),s.push(l.d.ComboBoxItems_2("12","12")),s.push(l.d.ComboBoxItems_2("13","13")),s.push(l.d.ComboBoxItems_2("14","14")),s.push(l.d.ComboBoxItems_2("15","15")),s.push(l.d.ComboBoxItems_2("16","16")),s.push(l.d.ComboBoxItems_2("17","17")),s.push(l.d.ComboBoxItems_2("18","18")),s.push(l.d.ComboBoxItems_2("19","19")),s.push(l.d.ComboBoxItems_2("20","20")),s.push(l.d.ComboBoxItems_2("21","21")),s.push(l.d.ComboBoxItems_2("22","22")),s.push(l.d.ComboBoxItems_2("23","23")),s.push(l.d.ComboBoxItems_2("24","24")),s.push(l.d.ComboBoxItems_2("25","25")),s.push(l.d.ComboBoxItems_2("26","26")),s.push(l.d.ComboBoxItems_2("27","27")),s.push(l.d.ComboBoxItems_2("28","28")),s.push(l.d.ComboBoxItems_2("29","29")),s.push(l.d.ComboBoxItems_2("30","30")),s.push(l.d.ComboBoxItems_2("LastDayofMonth","31")),e.ComboData=s,this.PaymentGrid.Columns.push(e),this.Dimensions.Visible&&(e=new h.a,e.Header="Dimension",e.DisplayMember="Dim",e.DataType="LISTBOX",e.Width=150,e.TypeID=1,this.PaymentGrid.Columns.push(e),this.PaymentGrid.TableColumns.push("Dim_Key"),this.PaymentGrid.TableColumns.push("Dim"))}OnButtonClick(e){var s,t;if("Save"==e){if(null==this.Name.Text||""==this.Name.Text)return this.DisplayMessage="Enter Profile Name",void(this.MessageVisibility=!0);(null===(s=this.PaymentGrid.angularGrid)||void 0===s?void 0:s.slickGrid)&&(null===(t=this.PaymentGrid.angularGrid)||void 0===t?void 0:t.slickGrid.getActiveCellNode())&&this.PaymentGrid.angularGrid.slickGrid.getEditorLock().commitCurrentEdit();let e="",i=0;for(let s=0;s<this.PaymentGrid.Table.length;s++)a.e.IsEmpty(this.PaymentGrid.Table[s].Percent)||a.e.IsEmpty(this.PaymentGrid.Table[s].Days)||(e+="<Row ",a.e.IsEmpty(this.PaymentGrid.Table[s].TypeID)||"1"!=this.PaymentGrid.Table[s].TypeID.toString()||a.e.IsEmpty(this.PaymentGrid.Table[s].Occurences)?i+=parseFloat(this.PaymentGrid.Table[s].Percent.toString()):i+=parseFloat(this.PaymentGrid.Table[s].Percent.toString())*parseFloat(this.PaymentGrid.Table[s].Occurences.toString()),e+='percentage="'+this.PaymentGrid.Table[s].Percent.toString()+'" ',a.e.IsEmpty(this.PaymentGrid.Table[s].Days)||(e+='Days="'+this.PaymentGrid.Table[s].Days.toString()+'" '),a.e.IsEmpty(this.PaymentGrid.Table[s].Period)||(e+='Period="'+this.PaymentGrid.Table[s].Period.toString()+'" '),a.e.IsEmpty(this.PaymentGrid.Table[s].TypeID)||(e+='TypeID="'+this.PaymentGrid.Table[s].TypeID.toString()+'" '),a.e.IsEmpty(this.PaymentGrid.Table[s].BasedOn)||(e+='BasedOn="'+this.PaymentGrid.Table[s].BasedOn.toString()+'" '),a.e.IsEmpty(this.PaymentGrid.Table[s].Occurences)||(e+='Occurences="'+this.PaymentGrid.Table[s].Occurences.toString()+'" '),a.e.IsEmpty(this.PaymentGrid.Table[s].PostonDate)||(e+='DateNo="'+this.PaymentGrid.Table[s].PostonDate.toString()+'" '),a.e.IsEmpty(this.PaymentGrid.Table[s].Remarks)||(e+='Remarks="'+this.PaymentGrid.Table[s].Remarks.toString()+'" '),this.Dimensions.Visible&&!a.e.IsEmpty(this.PaymentGrid.Table[s].Dim_Key)&&(e+='Dim="'+this.PaymentGrid.Table[s].Dim_Key.toString()+'" '),e+='Discount="" ',e+="/>");if(i>100)return this.DisplayMessage="Percentage can not be greater than 100.",void(this.MessageVisibility=!0);let o=0;d.a.SetPaymentDiscountTerm(this.Name.Text,this.Profile.SelectedValue,this.Dimensions.SelectedValue,e.toString()).subscribe(e=>{this.DisplayMessage=e.Message,o=e.RetValue,o>0?(this.Name.Text="",this.PaymentGrid.Clear(),this.FillingRows(),this.ProfileFill()):this.MessageVisibility=!0},e=>{console.log(e),this.DisplayMessage="Error in save"})}else"-1"==this.Profile.SelectedValue?this.DisplayMessage="Cannot Delete New":(this.ds=this.obj.GetAndDeleteTerms(parseInt(this.Profile.SelectedValue),3),null!=this.ds&&this.ds.Tables.length>0&&this.ds.Tables[0].length>0&&(this.DisplayMessage=this.ds.Tables[0][0].ErrorMessage.toString(),"Deleted Successfully"==this.DisplayMessage&&(this.Name.Text="",this.PaymentGrid.Clear(),this.FillingRows(),this.ProfileFill()))),this.MessageVisibility=!0}OnProfileSelection(e){if("-1"==this.Profile.SelectedValue)this.Name.Enable=!0,this.Name.Text="",this.PaymentGrid.Clear(),this.FillingRows();else if(null!=this.Profile.SelectedValue){this.Name.Enable=!1,this.ds=this.obj.GetAndDeleteTerms(parseInt(this.Profile.SelectedValue),0),this.Name.Text=this.Profile.GetText(),this.PaymentGrid.Clear();let e="";if(null!=this.ds&&this.ds.Tables.length>0){for(let s=0;s<this.ds.Tables[0].length;s++){let t=this.PaymentGrid.NewRow();t.Sno=s+1,t.Percent=this.ds.Tables[0][s].percentage,t.Days=this.ds.Tables[0][s].Days,a.e.IsEmpty(this.ds.Tables[0][s].Period)||(t.Period=this.ds.Tables[0][s].Period),a.e.IsEmpty(this.ds.Tables[0][s].TypeID)||(t.TypeID=this.ds.Tables[0][s].TypeID),a.e.IsEmpty(this.ds.Tables[0][s].BasedOn)||(t.BasedOn=this.ds.Tables[0][s].BasedOn),a.e.IsEmpty(this.ds.Tables[0][s].Occurences)||(t.Occurences=this.ds.Tables[0][s].Occurences),a.e.IsEmpty(this.ds.Tables[0][s].DateNo)||(t.PostonDate=this.ds.Tables[0][s].DateNo),this.ds.Columns[0].Contains("Remarks")&&!a.e.IsEmpty(this.ds.Tables[0][s].Remarks)&&(t.Remarks=this.ds.Tables[0][s].Remarks),this.PaymentGrid.TableColumns.Contains("Dim_Key")&&!a.e.IsEmpty(this.ds.Tables[0][s].DimNodeID)&&(t.Dim_Key=this.ds.Tables[0][s].DimNodeID,""!=e&&(e+=","),e+=this.ds.Tables[0][s].DimNodeID.toString()),this.PaymentGrid.addRow(t)}if(this.ds.Tables[0].length>0&&this.Dimensions.Visible)if(a.e.IsEmpty(this.ds.Tables[0][0].DimCCID))this.Dimensions.SelectedValue="0";else{this.Dimensions.SelectedValue=this.ds.Tables[0][0].DimCCID.toString();let s=this.obj.GetdimensionNames(this.Dimensions.SelectedValue,e);s.Tables.length>0&&!s.Columns[0].Contains("ErrorMessage")&&this.PaymentGrid.Table.forEach(e=>{if(!a.e.IsEmpty(e.Dim_Key.toString())){let t=s.Tables[0].filter(s=>s.NodeID==e.Dim_Key.toString());t.length>0&&(e.Dim=t[0][Object.keys(t[0])[1]].toString())}})}for(let e=this.ds.Tables[0].length;e<this.ds.Tables[0].length+10;e++){let s=this.PaymentGrid.NewRow();s.Sno=e+1,this.PaymentGrid.addRow(s)}}}}}}}]);
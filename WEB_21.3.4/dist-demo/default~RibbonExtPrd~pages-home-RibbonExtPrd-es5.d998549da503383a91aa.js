function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var i,s=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;i=Reflect.construct(s,arguments,n)}else i=s.apply(this,arguments);return _possibleConstructorReturn(this,i)}}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(window.webpackJsonp=window.webpackJsonp||[]).push([[57],{sBST:function(e,t,i){"use strict";i.r(t),i.d(t,"RibbonExtPrd",(function(){return N}));var s=i("Do2H"),n=i("V7Sd"),r=i("Lp6j"),a=i("eQJW"),o=i("VxiT"),l=i("ScVY"),u=i("NkMH"),d=i("0/4Q"),c=i("EQd/"),h=i("n56n"),p=i("JIg3"),I=i("8B8H"),b=function e(){_classCallCheck(this,e),this.ColumnSpan="4",this.BomGrid=new I.a},m=i("ockk"),g=function(){function e(t,i){var n;_classCallCheck(this,e),this.ColumnSpan="4",this.SNO=1,this.Bparent=t,this.Mparent=i,this.ProductionMethodGridDataObj=new I.a,this.ProductionMethodGridDataObj.TableColumns.push("Sno"),this.ProductionMethodGridDataObj.TableColumns.push("BOMID"),this.ProductionMethodGridDataObj.TableColumns.push("BOMName"),this.ProductionMethodGridDataObj.TableColumns.push("Particulars"),this.ProductionMethodGridDataObj.Columns=[],(n=new m.a).Header=s.a.GetResource("Sno"),n.DisplayMember="Sno",n.DataType="TEXTBOX",n.Width=50,n.IsVisible=!0,n.ReadOnly=!0,this.ProductionMethodGridDataObj.Columns.push(n),this.ProductionMethodGridDataObj.TableNewRow.Subscribe(this,"ProductionMethodGridData_TableNewRow"),null!=this.Mparent&&null==this.Bparent&&((n=new m.a).Header=s.a.GetResource("MO_BOMName"),n.DisplayMember="BOMName",n.DataType="TEXTBOX",n.Width=150,n.IsVisible=!0,n.ReadOnly=!0,this.ProductionMethodGridDataObj.Columns.push(n)),(n=new m.a).Header=s.a.GetResource("Deposits_Particulars"),n.DisplayMember="Particulars",n.DataType="TEXTBOX",n.Width=500,n.IsVisible=!0,this.ProductionMethodGridDataObj.Columns.push(n);for(var r=0;r<10;r++)this.ProductionMethodGridDataObj.addEmptyRow()}return _createClass(e,[{key:"ProductionMethodGridData_TableNewRow",value:function(e,t){this.UpdateSequence()}},{key:"UpdateSequence",value:function(){var e=this;this.SNO=1,this.ProductionMethodGridData.forEach((function(t){t.Sno=e.SNO++})),this.ProductionMethodGridDataObj.refreshDataView()}},{key:"GETXML",value:function(){var e="";e+="<XML>";for(var t=0;t<this.ProductionMethodGridData.length;t++)r.e.IsEmpty(this.ProductionMethodGridData[t].Particulars)||(e+="<Row ",e+=' SequenceNo="'+t+'1"',null!=this.Mparent&&null==this.Bparent&&(e+=' BOMID="'+this.ProductionMethodGridData[t].BOMID.toString()+'"'),e+=' Particulars="'+this.ProductionMethodGridData[t].Particulars.toString()+'"',e+="/>");return(e+="</XML>").toString()}},{key:"Load",value:function(e){var t=0;if(null!=this.Mparent&&null==this.Bparent)for(var i=0;i<this.ProductionMethodGridData.length;i++)"0"!=r.e.String(this.ProductionMethodGridData[i].BOMID)?(this.ProductionMethodGridDataObj.removeRowAt(i),i--):t++;if(null!=e&&e.length>0){for(var s=0;s<e.length;s++)this.ProductionMethodGridDataObj.addEmptyRow(),null!=this.Mparent&&null==this.Bparent&&(this.ProductionMethodGridData[t].BOMName=e[s].BOMName.toString(),this.ProductionMethodGridData[t].BOMID=e[s].BOMID.toString()),this.ProductionMethodGridData[t].Particulars=e[s].Particulars.toString(),t++;this.SequenceNo(),this.ProductionMethodGridDataObj.refreshDatawithIDs()}}},{key:"SequenceNo",value:function(){var e=1;if(this.ProductionMethodGridDataObj.TableColumns.Contains("Sno"))for(var t=0;t<this.ProductionMethodGridData.length;t++)this.ProductionMethodGridData[t].Sno=e.toString(),e++}},{key:"angularGrid",get:function(){return this.ProductionMethodGridDataObj.angularGrid}},{key:"ProductionMethodGridData",get:function(){return this.ProductionMethodGridDataObj.Table}},{key:"ProductionMethodColumnSource",get:function(){return this.ProductionMethodGridDataObj.Columns}}]),e}(),S=i("vTM8"),D=i("uMy8"),T=function(){function e(){_classCallCheck(this,e),this.Code="",this.Name="",this.Desc="",this.BOMProductXML="",this.BOMExpenseXML="",this.BOMResourceXML="",this.GUID="",this.CustomFieldsQuery="",this.CustomCCQuery="",this.ProductionMethod="",this.ProductionXML="",this.StageXML="",this.Packing="",this.ProductID=0,this.LocationID=0,this.DivisionID=0,this.StatusID=0,this.UOMID=0,this.WID=0,this.BOMID=0,this.selectednodeid=0,this.group=!1,this.FPQty=1}return _createClass(e,[{key:"GetAvgSales",value:function(e,t,i,n,r){Logger.InfoLog("BOM:: Inside GetBOMDetails");var a=[];a.push(e),a.push(t),a.push("1/"+n.ToString("MMM/yyyy")),a.push(r.DaysInMonth()+"/"+r.ToString("MMM/yyyy")),a.push(r.iMonth()-n.iMonth()+1),a.push(i),a.push(s.a.SessionManager.UserID),a.push(s.a.SessionManager.LanguageID);try{return s.a.inventory.GetAvgSales(a)}catch(o){return Logger.ErrorLog("BOM:: GetBOMDetails"+o.stack),null}}},{key:"GetProductionPlan",value:function(e,t,i,n){Logger.InfoLog("BOM:: Inside GetProductionPlan");var r=[];r.push(e),r.push("1/"+i.ToString("MMM/yyyy")),r.push(n.DaysInMonth()+"/"+n.ToString("MMM/yyyy")),r.push(i.iMonth()-n.iMonth()+1),r.push(t),r.push(s.a.SessionManager.UserID),r.push(s.a.SessionManager.LanguageID);try{return s.a.inventory.GetProductionPlan(r)}catch(a){return Logger.ErrorLog("BOM:: GetProductionPlan"+a.stack),null}}},{key:"GetAllProducts",value:function(e){Logger.InfoLog("BOM:: Inside GetAllProducts");var t=[];t.push(e),t.push(s.a.SessionManager.UserID),t.push(s.a.SessionManager.LanguageID);try{return s.a.inventory.GetAllProducts(t)}catch(i){return Logger.ErrorLog("BOM:: GetAllProducts"+i.stack),null}}},{key:"GetProductsExtraNumericFields",value:function(){Logger.InfoLog("BOM:: Inside GetProductsExtraNumericFields");var e=[];e.push(s.a.SessionManager.UserID),e.push(s.a.SessionManager.LanguageID);try{return s.a.inventory.GetProductsExtraNumericFields(e)}catch(t){return Logger.ErrorLog("BOM:: GetProductsExtraNumericFields"+t.stack),null}}},{key:"SearchProduct",value:function(e,t,i){Logger.InfoLog("BOM:: Inside SearchProduct");var n=[];n.push(e),n.push(t),n.push(i),n.push(s.a.SessionManager.UserID),n.push(s.a.SessionManager.LanguageID);try{return s.a.inventory.SearchProduct(n)}catch(r){return Logger.ErrorLog("BOM:: SearchProduct"+r.stack),null}}},{key:"GetBOMDetails",value:function(e){Logger.InfoLog("BOM:: Inside GetBOMDetails");var t=[];t.push(e),t.push(s.a.SessionManager.UserID),t.push(s.a.SessionManager.LanguageID),t.push(s.a.SessionManager.RoleID);try{var i=s.a.inventory.GetBOM(t);return i.Tables.length>0&&i.Tables[0].length>0&&(this.Code=i.Tables[0][0].BOMCode.toString(),this.Name=i.Tables[0][0].BOMName.toString(),this.StatusID=parseInt(i.Tables[0][0].StatusID.toString()),this.Desc=i.Tables[0][0].Description.toString(),this.GUID=i.Tables[0][0].GUID.toString(),this.ProductID=parseInt(i.Tables[0][0].ProductID.toString()),this.LocationID=parseInt(i.Tables[0][0].LocationID.toString()),this.DivisionID=parseInt(i.Tables[0][0].DivisionID.toString()),this.group=Object(a.j)(i.Tables[0][0].IsGroup.toString()),this.selectednodeid=parseInt(i.Tables[0][0].ParentID.toString()),this.ProductionMethod=r.e.String(i.Tables[0][0].ProductionMethod)),i}catch(n){return Logger.ErrorLog("BOM:: GetBOMDetails"+n.stack),null}}},{key:"AddBOM",value:function(e){Logger.InfoLog("SaveBOM:: Inside OnSave");try{var t=[];t.push(this.BOMID),t.push(this.Code),t.push(this.Name),t.push(this.ProductID),t.push(this.UOMID),t.push(this.FPQty),t.push(this.LocationID),t.push(this.DivisionID),t.push(this.Desc),t.push(this.StatusID),t.push(1),t.push("General"),t.push(this.group),t.push(this.selectednodeid),t.push(this.Date.ToString("dd/MMM/yyyy")),t.push(this.BOMProductXML),t.push(this.BOMExpenseXML),t.push(this.BOMResourceXML),t.push(this.CustomFieldsQuery),t.push(this.CustomCCQuery),t.push(this.ProductionXML),t.push(s.a.SessionManager.CompanyGUID),t.push(null!=this.GUID?this.GUID:""),t.push(s.a.SessionManager.UserName),t.push(this.WID),t.push(s.a.SessionManager.RoleID),t.push(s.a.SessionManager.UserID),t.push(s.a.SessionManager.LanguageID);return Logger.InfoLog("SaveBOM:: Success: DBH.OnSave "+(0).toString()),"not Implemented"}catch(i){return Logger.ErrorLog("SaveBOM:: OnSave"+i.stack),"ERROR"}}},{key:"AddMultiStageBOM",value:function(e){Logger.InfoLog("SaveBOM:: Inside OnSave");try{var t=[];t.push(this.BOMID),t.push(this.Code),t.push(this.Name),t.push(this.ProductID),t.push(this.UOMID),t.push(this.FPQty),t.push(this.LocationID),t.push(this.DivisionID),t.push(this.Desc),t.push(this.StatusID),t.push(2),t.push("Multi-Stage"),t.push(this.group),t.push(this.selectednodeid),t.push(this.Date.ToString("dd/MMM/yyyy")),t.push(this.Packing),t.push(this.StageXML),t.push(this.BOMProductXML),t.push(this.BOMExpenseXML),t.push(this.BOMResourceXML),t.push(this.CustomFieldsQuery),t.push(this.CustomCCQuery),t.push(this.ProductionXML),t.push(s.a.SessionManager.CompanyGUID),t.push(null!=this.GUID?this.GUID:""),t.push(s.a.SessionManager.UserName),t.push(this.WID),t.push(s.a.SessionManager.RoleID),t.push(s.a.SessionManager.UserID),t.push(s.a.SessionManager.LanguageID);return Logger.InfoLog("SaveBOM:: Success: DBH.OnSave "+(0).toString()),"not Implemented"}catch(i){return Logger.ErrorLog("SaveBOM:: OnSave"+i.stack),"ERROR"}}},{key:"DeleteBOM",value:function(e,t){var i=[];return i.push(e),i.push(s.a.SessionManager.UserID),i.push(s.a.SessionManager.LanguageID),Logger.InfoLog("DeleteBOM ::  DBH.DeleteBOM "+e.toString()),"Not Implemented"}},{key:"getMachineCostHr",value:function(e,t){var i,n,a=s.a.report.GetTableColumns(e);if(a.ColumnName,a.PrimaryKey,i=a.TableName,!r.e.IsEmpty(i)){n="select ccAlpha47 from "+i+" WITH(NOLOCK) where NodeID="+t;var o=[];o.push(n),o.push(s.a.SessionManager.UserID),o.push(s.a.SessionManager.LanguageID);var l=s.a.common.GetDataSet("BOM002",i+"~"+t);if(l.length>0&&!r.e.IsEmpty(l[0].ccAlpha47))try{return parseFloat(l[0].ccAlpha47.toString())}catch(u){}}return 0}},{key:"GetProductUnits",value:function(e){try{return s.a.common.GetDataSet("BOM001",e.toString())}catch(t){return Logger.ErrorLog("BOM:: GetProductUnits"+t.stack),null}}},{key:"MoveMultipleBOMs",value:function(e,t){try{var i="";if(!(e.length>1))return 1==e.length?this.MoveBOM(e[0],t):s.a.GetResource("Account_NoSelected");i+="<XML>",e.forEach((function(e){i+='<Row BOMID="'+e.toString()+'" ></Row>'})),i+="</XML>";var n=[];n.push(t),n.push(i.toString()),n.push(s.a.SessionManager.UserID),n.push(s.a.SessionManager.LanguageID);return Logger.InfoLog("CostCenter:: Success: DBH.MoveCostCenter "+(0).toString()),"Not Implemented"}catch(r){return Logger.ErrorLog("BOM:: MoveMultipleBOMs"+r.stack),null}}},{key:"MoveBOM",value:function(e,t){try{var i=[];i.push(e),i.push(t),i.push(s.a.SessionManager.UserID),i.push(s.a.SessionManager.LanguageID);return Logger.InfoLog("CostCenter:: Success: DBH.MoveCostCenter "+e.toString()),"Not Implemented"}catch(n){return Logger.ErrorLog("BOM:: MoveBOM"+n.stack),null}}}],[{key:"ReplaceBOMs",value:function(e,t,i,n,r){try{var a=[];return a.push(e),a.push(t),a.push(i),a.push(n),a.push(s.a.SessionManager.CompanyGUID),a.push(s.a.SessionManager.UserName),a.push(s.a.SessionManager.RoleID),a.push(s.a.SessionManager.UserID),a.push(s.a.SessionManager.LanguageID),"Not Implemented"}catch(o){return Logger.ErrorLog("SaveBOM:: OnSave"+o.stack),"ERROR"}}}]),e}(),C=function(e){_inherits(i,e);var t=_createSuper(i);function i(e,n){var r;_classCallCheck(this,i),(r=t.call(this)).BID=0,r.parentid=0,r.objBOM=new T,r._ScreenObject=new o.a,r.Title="",r.txtCode=new c.d(555025),r.txtName=new c.d(555026),r.txtCost=new c.d(0),r.txtUsage=new c.d(0),r.txtCapacity=new c.d(0),r.txtEffeciency=new c.d(0),r.Description=new c.d(23903),r.MStatus=new d.e(23898),r.Group=new d.e(23897),r.Location=new h.b(23900),r.Division=new h.b(23901),r.Product=new h.b(23899),r.UOM=new d.e(109),r.FPQty=new c.d(27269),r.Date=new p.a(23902),r.txtDesc=new c.d(23903),r.FilterCCID=0,r.MachineCCID=0,r.SNo=0,r.MachineID=0,Logger.InfoLog("AddEditBOMViewModel::Entering AddEditBOMViewModel "),r.ButtonSave=new u.a,r.parentid=n,r.BID=e,r.MessageVisibility=!1,r.InputGrid=new b,r.ExpenseGrid=new b,r.ResourcesGrid=new b,r.OutputGrid=new b,r.ProductionsMethod=new g(_assertThisInitialized(r),null),r._ScreenObject.LoadScreen_2(_assertThisInitialized(r),76),r.Product.SelectionChangedCommand.Subscribe(_assertThisInitialized(r),"OnProductChange"),0==e?s.a.SessionManager.HideUnathorizedAccess?r.ButtonSave.Visible=s.a.SessionManager.IsActionAssigned(76,"Create"):r.ButtonSave.Enable=s.a.SessionManager.IsActionAssigned(76,"Create"):(r.ScreenObject.IsEdit=!0,s.a.SessionManager.HideUnathorizedAccess?r.ButtonSave.Visible=s.a.SessionManager.IsActionAssigned(76,"Update"):r.ButtonSave.Enable=s.a.SessionManager.IsActionAssigned(76,"Update"));var l=r.ScreenObject.StaticFields.find((function(e){return 23899==e.DBColumnID}));null!=l?(r.Product.CCID=l.CCID,r.Product.TypeID=l.TypeID,0==r.Product.CCID&&(r.Product.CCID=3),0==r.Product.TypeID&&(r.Product.TypeID=10)):(r.Product.CCID=3,r.Product.TypeID=10),r.LoadData(),r.FPQty.Text="1",Logger.InfoLog("AddEditBOMViewModel::Exiting AddEditBOMViewModel "),r.loadtabs();var I=r.objBOM.GetBOMDetails(r.BID),m=r.ScreenObject.Data.Tables[4].filter((function(e){return"CapsLock"==e.Name}));if(m.length>0&&Object(a.j)(m[0].Value)&&(r.txtName.IsAllCaps=!0),(m=r.ScreenObject.Data.Tables[4].filter((function(e){return"CapsToFirstLetter"==e.Name}))).length>0&&Object(a.j)(m[0].Value)&&(r.txtName.IsFirstLetterCaps=!0),r.BID>0?(r.OnLoad(r.BID),r.OnProductChange(null),r.UOM.SelectedValue=I.Tables[0][0].UOMID.toString(),r.objBOM.GUID=I.Tables[0][0].GUID.toString(),r.Title=s.a.GetResource("BOM_EditBOM")):(r.Title=s.a.GetResource("BOM_AddBOM"),r.objBOM.GUID="GUID",r.AutoGenerateCode()),r.DisplayName=r.Title,I.Tables[4].length>0){for(var S=0;S<I.Tables[4].length;S++)r.Group.Items.push(d.d.ComboBoxItems_2(I.Tables[4][S].BOMName.toString(),I.Tables[4][S].BOMID.toString()));r.Group.SelectedValue=0==r.BID?I.Tables[4][0].BOMID.toString():r.parentid.toString()}return r.CheckViewForUser(),r.InputGrid.BomGrid.ColumnSpan=4,r.ExpenseGrid.BomGrid.ColumnSpan=4,r.ResourcesGrid.BomGrid.ColumnSpan=4,r.OutputGrid.BomGrid.ColumnSpan=4,r.ProductionsMethod.ProductionMethodGridDataObj.ColumnSpan=4,r}return _createClass(i,[{key:"CheckViewForUser",value:function(){var e=this;this.InputGrid.BomGrid.Columns.forEach((function(t){null!=t.ID&&e.ScreenObject.SetView(t,e.BID>0)})),this.ExpenseGrid.BomGrid.Columns.forEach((function(t){null!=t.ID&&e.ScreenObject.SetView(t,e.BID>0)})),this.ResourcesGrid.BomGrid.Columns.forEach((function(t){null!=t.ID&&e.ScreenObject.SetView(t,e.BID>0)})),this.OutputGrid.BomGrid.Columns.forEach((function(t){null!=t.ID&&e.ScreenObject.SetView(t,e.BID>0)}))}},{key:"loadtabs",value:function(){this.AssignRowColumns();for(var e=null,t=this._ScreenObject.CustomTab.Pages.length-1;t>=0;t--){var i=this._ScreenObject.CustomTab.Pages[t];switch(i.Name){case"Production Method":i.Fields.push(this.ProductionsMethod.ProductionMethodGridDataObj);break;case"Raw Materials":i.Fields.push(this.InputGrid.BomGrid);break;case"Stages":e=i;break;case"Expenses":i.Fields.push(this.ExpenseGrid.BomGrid);break;case"Machines":i.Fields.push(this.ResourcesGrid.BomGrid);break;case"Other Outputs":i.Fields.push(this.OutputGrid.BomGrid)}}this.ScreenObject.CustomTab.Pages.Remove(e),this.ScreenObject.CustomTab.SelectedTab=this.ScreenObject.CustomTab.Pages[0]}},{key:"AutoGenerateCode",value:function(){this.objBOM.GetBOMDetails(this.BID);var e=s.a.common.GetAutoSequence(76,"","76",s.a.SessionManager.CompanyIndex.toString()),t=this.ScreenObject.Data.Tables[4].filter((function(e){return"CodeAutoGen"==e.Name}));t.length>0&&(Object(a.j)(t[0].Value)?(this.txtCode.Enable=!1,this.txtCode.Mandatory=!1,0==this.BID&&(this.txtCode.Text=e)):this.txtCode.Enable=!0),(t=this.ScreenObject.Data.Tables[4].filter((function(e){return"CapsLock"==e.Name}))).length>0&&Object(a.j)(t[0].Value)&&(this.txtName.IsAllCaps=!0),(t=this.ScreenObject.Data.Tables[4].filter((function(e){return"CapsToFirstLetter"==e.Name}))).length>0&&Object(a.j)(t[0].Value)&&(this.txtName.IsFirstLetterCaps=!0)}},{key:"AssignRowColumns",value:function(){var e;e=this._ScreenObject.CustomFields.length;for(var t=0;t<e;t++)this._ScreenObject.CustomFields[t].Row=t/4,this._ScreenObject.CustomFields[t].Column=t%4}},{key:"LoadData",value:function(){var e,t,i=this;this.InputGrid.BomGrid.Table=[],this.InputGrid.BomGrid.Columns=[],this.InputGrid.BomGrid.CellEditEnding.Subscribe(this,"OnCellEditEnding"),this.InputGrid.BomGrid.BeginEdit.Subscribe(this,"onBeginEdit"),this.InputGrid.BomGrid.CanUserAddRows=!0,this.InputGrid.BomGrid.CanUserDeleteRows=!0,this.InputGrid.BomGrid.TableColumns.push("Sno"),this.InputGrid.BomGrid.TableColumns.push("ProductCode"),this.InputGrid.BomGrid.TableColumns.push("ProductCode_Key"),this.InputGrid.BomGrid.TableColumns.push("ProductName"),this.InputGrid.BomGrid.TableColumns.push("ProductName_Key"),this.InputGrid.BomGrid.TableColumns.push("Qty"),this.InputGrid.BomGrid.TableColumns.push("UOM"),this.InputGrid.BomGrid.TableColumns.push("UOM_Key"),this.InputGrid.BomGrid.TableColumns.push("UnitPrice"),this.InputGrid.BomGrid.TableColumns.push("Value"),this.InputGrid.BomGrid.TableColumns.push("Wastage"),this.InputGrid.BomGrid.TableColumns.push("BOMProductID"),(t=new m.a).Header="#",t.DisplayMember="Sno",t.DataType="TextBlock",t.Width=23,t.IsVisible=!0,t.ReadOnly=!0,this.InputGrid.BomGrid.Columns.push(t),this.ScreenObject.Data.Tables.length>4&&((e=this.ScreenObject.Data.Tables[4].filter((function(e){return"BomFilterDimension"==e.Name}))).length>0&&!r.e.IsEmpty(e[0].Value)&&r.e.Int(e[0].Value)>0&&parseInt(e[0].Value.toString())>0&&(this.FilterCCID=parseInt(e[0].Value.toString()),(t=new m.a).Header="FilterOn",t.DisplayMember="FilterOn",t.ValueMember="FilterOn_Key",t.DataType="LISTBOX",t.Width=230,t.CostCenterID=parseInt(e[0].Value.toString()),t.TypeID=3==parseInt(e[0].Value.toString())?12:1,t.IsVisible=!0,this.InputGrid.BomGrid.Columns.push(t),this.InputGrid.BomGrid.TableColumns.push("FilterOn"),this.InputGrid.BomGrid.TableColumns.push("FilterOn_Key"))),(t=new m.a).Header=s.a.GetResource("BOM_ProductCOde"),t.DisplayMember="ProductCode",t.ValueMember="ProductName_Key",t.DataType="LISTBOX",t.CostCenterID=3,t.TypeID=100,(e=this._ScreenObject.Data.Tables[0].filter((function(e){return"PRD_BOMProducts"==e.SysTableName&&"ProductCode"==e.SysColumnName&&1==e.LinkData}))).length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):150,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(a.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.InputGrid.BomGrid.Columns.push(t),(t=new m.a).Header=s.a.GetResource("BOM_ProductName"),t.DisplayMember="ProductName",t.ValueMember="ProductName_Key",t.DataType="LISTBOX",t.CostCenterID=3,t.TypeID=10,t.IsFrozen=!0,(e=this._ScreenObject.Data.Tables[0].filter((function(e){return"PRD_BOMProducts"==e.SysTableName&&"ProductID"==e.SysColumnName&&1==e.LinkData}))).length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):220,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(a.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.InputGrid.BomGrid.Columns.push(t),(t=new m.a).Header=s.a.GetResource("Quantity"),t.DisplayMember="Qty",t.DataType="INT",(e=this._ScreenObject.Data.Tables[0].filter((function(e){return"PRD_BOMProducts"==e.SysTableName&&"Quantity"==e.ysColumnName&&1==e.LinkData}))).length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):90,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(a.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),s.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=s.a.SessionManager.Preferences.DecimalsinQty&&(t.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinQty),this.InputGrid.BomGrid.Columns.push(t),(t=new m.a).Header=s.a.GetResource("UOM"),t.DisplayMember="UOM",t.ValueMember="UOM_Key",t.DataType="LISTBOX",t.CostCenterID=11,t.TypeID=1,(e=this._ScreenObject.Data.Tables[0].filter((function(e){return"PRD_BOMProducts"==e.SysTableName&&"UOMID"==e.SysColumnName&&1==e.LinkData}))).length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):100,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(a.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.InputGrid.BomGrid.Columns.push(t),(t=new m.a).Header=s.a.GetResource("UnitPrice"),t.DisplayMember="UnitPrice",t.DataType="FLOAT",(e=this._ScreenObject.Data.Tables[0].filter((function(e){return"PRD_BOMProducts"==e.SysTableName&&"UnitPrice"==e.SysColumnName&&1==e.LinkData}))).length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):100,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(a.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),s.a.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=s.a.SessionManager.Preferences.DecimalsinRate&&(t.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinRate),this.InputGrid.BomGrid.Columns.push(t),(t=new m.a).Header=s.a.GetResource("Value"),t.DisplayMember="Value",t.DataType="FLOAT",(e=this._ScreenObject.Data.Tables[0].filter((function(e){return"PRD_BOMProducts"==e.SysTableName&&"Value"==e.SysColumnName&&1==e.LinkData}))).length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):100,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(a.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),s.a.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=s.a.SessionManager.Preferences.DecimalsinRate&&(t.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinRate),this.InputGrid.BomGrid.Columns.push(t),(t=new m.a).Header=s.a.GetResource("Waistage"),t.DisplayMember="Wastage",t.DataType="FLOAT",(e=this._ScreenObject.Data.Tables[0].filter((function(e){return"PRD_BOMProducts"==e.SysTableName&&"Wastage"==e.SysColumnName&&1==e.LinkData}))).length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):100,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(a.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.InputGrid.BomGrid.Columns.push(t),this.ExpenseGrid.BomGrid.Table=[],this.ExpenseGrid.BomGrid.Columns=[],this.ExpenseGrid.BomGrid.CanUserAddRows=!0,this.ExpenseGrid.BomGrid.CanUserDeleteRows=!0,(t=new m.a).Header="#",t.DisplayMember="Sno",t.DataType="TextBlock",t.Width=23,t.IsVisible=!0,t.ReadOnly=!0,this.ExpenseGrid.BomGrid.Columns.push(t),(t=new m.a).Header="Name",t.DisplayMember="Name",t.DataType="TextBlock",(e=this._ScreenObject.Data.Tables[0].filter((function(e){return"PRD_Expenses"==e.SysTableName&&"Name"==e.SysColumnName}))).length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):200,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(a.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.ExpenseGrid.BomGrid.Columns.push(t),(t=new m.a).Header="Debit",t.DisplayMember="Expense",t.ValueMember="Expense_Key",t.DataType="LISTBOX",t.CostCenterID=2,e=this.ScreenObject.Data.Tables[4].filter((function(e){return"DrAccListview"==e.Name})),t.TypeID=null!=e&&e.length>0?parseInt(e[0].Value.toString()):2,(e=this._ScreenObject.Data.Tables[0].filter((function(e){return"PRD_Expenses"==e.SysTableName&&"DebitAccountID"==e.SysColumnName}))).length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):200,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(a.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.ExpenseGrid.BomGrid.Columns.push(t),(t=new m.a).Header="Credit",t.DisplayMember="AccountName",t.ValueMember="AccountName_Key",t.DataType="LISTBOX",t.CostCenterID=2,e=this.ScreenObject.Data.Tables[4].filter((function(e){return"CrAccListview"==e.Name})),t.TypeID=null!=e&&e.length>0?parseInt(e[0].Value.toString()):2,(e=this._ScreenObject.Data.Tables[0].filter((function(e){return"PRD_Expenses"==e.SysTableName&&"CreditAccountID"==e.SysColumnName}))).length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):200,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(a.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.ExpenseGrid.BomGrid.Columns.push(t),(t=new m.a).Header=s.a.GetResource("Value"),t.DisplayMember="Value",t.DataType="FLOAT",(e=this._ScreenObject.Data.Tables[0].filter((function(e){return"PRD_Expenses"==e.SysTableName&&"Value"==e.SysColumnName}))).length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):90,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(a.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),s.a.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=s.a.SessionManager.Preferences.DecimalsinRate&&(t.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinRate),this.ExpenseGrid.BomGrid.Columns.push(t),this.ExpenseGrid.BomGrid.TableColumns.push("Sno"),this.ExpenseGrid.BomGrid.TableColumns.push("Name"),this.ExpenseGrid.BomGrid.TableColumns.push("AccountName"),this.ExpenseGrid.BomGrid.TableColumns.push("AccountName_Key"),this.ExpenseGrid.BomGrid.TableColumns.push("Expense"),this.ExpenseGrid.BomGrid.TableColumns.push("Expense_Key"),this.ExpenseGrid.BomGrid.TableColumns.push("Value"),this.ExpenseGrid.BomGrid.TableColumns.push("ExpenseID"),this.ResourcesGrid.BomGrid.Table=[],this.ResourcesGrid.BomGrid.Columns=[],this.ResourcesGrid.BomGrid.CellEditEnding.Subscribe(this,"OnCellEditEnding"),this.ResourcesGrid.BomGrid.BeginEdit.Subscribe(this,"onBeginEdit"),this.ResourcesGrid.BomGrid.CanUserAddRows=!0,this.ResourcesGrid.BomGrid.CanUserDeleteRows=!0,(t=new m.a).Header="#",t.DisplayMember="Sno",t.DataType="TextBlock",t.Width=23,t.IsVisible=!0,t.ReadOnly=!0,t.IsFrozen=!0,this.ResourcesGrid.BomGrid.Columns.push(t),(t=new m.a).Header=s.a.GetResource("Machine"),t.DisplayMember="Machine",t.DataType="LISTBOX",(e=this.ScreenObject.Data.Tables[4].filter((function(e){return"MachineDimension"==e.Name}))).length>0&&e[0].Value.toString().length>0&&(this.MachineCCID=parseInt(e[0].Value),t.CostCenterID=parseInt(e[0].Value)),t.TypeID=3,(e=this._ScreenObject.Data.Tables[0].filter((function(e){return"PRD_BOMResources"==e.SysTableName&&"ResourceID"==e.SysColumnName}))).length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):200,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(a.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.ResourcesGrid.BomGrid.Columns.push(t),(t=new m.a).Header=s.a.GetResource("HRS"),t.DisplayMember="Hrs",t.DataType="FLOAT",t.IsFrozen=!0,(e=this._ScreenObject.Data.Tables[0].filter((function(e){return"PRD_BOMResources"==e.SysTableName&&"Hours"==e.SysColumnName}))).length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):100,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(a.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),(t=new m.a).Header="Cost/Hr",t.DisplayMember="Value",t.DataType="FLOAT",(e=this._ScreenObject.Data.Tables[0].filter((function(e){return"PRD_BOMResources"===e.SysTableName&&"Value"==e.SysColumnName}))).length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):100,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(a.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),s.a.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=s.a.SessionManager.Preferences.DecimalsinRate&&(t.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinRate),this.ResourcesGrid.BomGrid.Columns.push(t),this.ResourcesGrid.BomGrid.TableColumns.push("Sno"),this.ResourcesGrid.BomGrid.TableColumns.push("Machine"),this.ResourcesGrid.BomGrid.TableColumns.push("Machine_Key"),this.ResourcesGrid.BomGrid.TableColumns.push("Hrs"),this.ResourcesGrid.BomGrid.TableColumns.push("Value"),this.ResourcesGrid.BomGrid.TableColumns.push("BOMResourceID"),this.OutputGrid.BomGrid.Table=[],this.OutputGrid.BomGrid.Columns=[],this.OutputGrid.BomGrid.CellEditEnding.Subscribe(this,"OnCellEditEnding"),this.OutputGrid.BomGrid.CanUserAddRows=!0,this.OutputGrid.BomGrid.CanUserDeleteRows=!0,(t=new m.a).Header="#",t.DisplayMember="Sno",t.DataType="TextBlock",t.Width=23,t.IsVisible=!0,t.ReadOnly=!0,t.IsFrozen=!0,this.OutputGrid.BomGrid.Columns.push(t),(t=new m.a).Header=s.a.GetResource("BOM_ProductCOde"),t.DisplayMember="ProductCode",t.ValueMember="ProductName_Key",t.DataType="LISTBOX",t.CostCenterID=3,t.TypeID=100,(e=this._ScreenObject.Data.Tables[0].filter((function(e){return"PRD_BOMProducts"==e.SysTableName&&"ProductCode"==e.SysColumnName&&2==e.LinkData}))).length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):200,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(a.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.OutputGrid.BomGrid.Columns.push(t),(t=new m.a).Header=s.a.GetResource("BOM_ProductName"),t.DisplayMember="ProductName",t.ValueMember="ProductName_Key",t.DataType="LISTBOX",t.CostCenterID=3,t.TypeID=10,(e=this._ScreenObject.Data.Tables[0].filter((function(e){return"PRD_BOMProducts"==e.SysTableName&&"ProductID"==e.SysColumnName&&2==e.LinkData}))).length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):220,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(a.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.OutputGrid.BomGrid.Columns.push(t),(t=new m.a).Header="Qty",t.DisplayMember="Qty",t.DataType="INT",(e=this._ScreenObject.Data.Tables[0].filter((function(e){return"PRD_BOMProducts"==e.SysTableName&&"Quantity"==e.SysColumnName&&2==e.LinkData}))).length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):90,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(a.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),s.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=s.a.SessionManager.Preferences.DecimalsinQty&&(t.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinQty),this.OutputGrid.BomGrid.Columns.push(t),(t=new m.a).Header="UnitPrice",t.DisplayMember="UnitPrice",t.DataType="FLOAT",(e=this._ScreenObject.Data.Tables[0].filter((function(e){return"PRD_BOMProducts"==e.SysTableName&&"UnitPrice"==e.SysColumnName&&2==e.LinkData}))).length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):100,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(a.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),s.a.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=s.a.SessionManager.Preferences.DecimalsinRate&&(t.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinRate),this.OutputGrid.BomGrid.Columns.push(t),(t=new m.a).Header="Value",t.DisplayMember="Value",t.DataType="FLOAT",(e=this._ScreenObject.Data.Tables[0].filter((function(e){return"PRD_BOMProducts"==e.SysTableName&&"Value"==e.SysColumnName&&2==e.LinkData}))).length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):100,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(a.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),s.a.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=s.a.SessionManager.Preferences.DecimalsinRate&&(t.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinRate),this.OutputGrid.BomGrid.Columns.push(t),this.OutputGrid.BomGrid.TableColumns.push("Sno"),this.OutputGrid.BomGrid.TableColumns.push("ProductCode"),this.OutputGrid.BomGrid.TableColumns.push("ProductName"),this.OutputGrid.BomGrid.TableColumns.push("ProductName_Key"),this.OutputGrid.BomGrid.TableColumns.push("Qty"),this.OutputGrid.BomGrid.TableColumns.push("UnitPrice"),this.OutputGrid.BomGrid.TableColumns.push("Value"),this.OutputGrid.BomGrid.TableColumns.push("BOMProductID"),this.FillEmptyRows(),this._ScreenObject.Data.Tables[3].forEach((function(e){i.MStatus.Items.push(d.d.ComboBoxItems_2(e[Object.keys(e)[1]].toString(),e[Object.keys(e)[0]].toString()))})),"1"!=s.a.SessionManager.RoleID&&s.a.SessionManager.IsActionAssigned(76,"Save as UnApproved")&&(this.MStatus.SelectedValue="464",this.MStatus.Visible=!1)}},{key:"FillEmptyRows",value:function(){for(var e=0;e<8;e++)this.InputGrid.BomGrid.addEmptyRow();for(var t=0;t<5;t++)this.ExpenseGrid.BomGrid.addEmptyRow();for(var i=0;i<5;i++)this.ResourcesGrid.BomGrid.addEmptyRow();for(var s=0;s<5;s++)this.OutputGrid.BomGrid.addEmptyRow();this.UpdateSequence()}},{key:"BOMExpenseXML",value:function(e){Logger.InfoLog("AddEditBOMViewModel::Entering BOMExpenseXML ");var t="";t+="<BOMExpenseXML>";for(var i=0;i<this.ExpenseGrid.BomGrid.Table.length;i++)r.e.IsEmpty(this.ExpenseGrid.BomGrid.Table[i].AccountName_Key)||(t+="<Row ",null!=e&&(null==e||"SaveAs"==e.toString())||r.e.IsEmpty(this.ExpenseGrid.BomGrid.Table[i].ExpenseID)?t+=" ExpenseID='0'":t+=" ExpenseID='"+this.ExpenseGrid.BomGrid.Table[i].ExpenseID.toString()+"'",t+=" Name='"+this.ExpenseGrid.BomGrid.Table[i].Name+"'",t+=" ResourceID='1'",t+=" CreditAccountID='"+this.ExpenseGrid.BomGrid.Table[i].AccountName_Key+"'",r.e.IsEmpty(this.ExpenseGrid.BomGrid.Table[i].Expense_Key)||(t+=" DebitAccountID='"+this.ExpenseGrid.BomGrid.Table[i].Expense_Key+"'"),t+=" Action='New'",t+=" Value='"+this.ExpenseGrid.BomGrid.Table[i].Value+"'/>");return t+="</BOMExpenseXML>",Logger.InfoLog("AddEditBOMViewModel::Exiting BOMExpenseXML"),t.toString()}},{key:"BOMResourceXML",value:function(e){Logger.InfoLog("AddEditBOMViewModel::Entering BOMResourceXML ");var t="";t+="<BOMResourceXML>";for(var i=0;i<this.ResourcesGrid.BomGrid.Table.length;i++)r.e.IsEmpty(this.ResourcesGrid.BomGrid.Table[i].Machine_Key)||(t+="<Row ",null!=e&&(null==e||"SaveAs"==e.toString())||r.e.IsEmpty(this.ResourcesGrid.BomGrid.Table[i].BOMResourceID)?t+=" BOMResourceID='0'":t+=" BOMResourceID='"+this.ResourcesGrid.BomGrid.Table[i].BOMResourceID.toString()+"'",t+=" ResourceID='"+this.ResourcesGrid.BomGrid.Table[i].Machine_Key+"'",t+=" Hours='1' ",t+=" Action='New'",t+=" Value='"+this.ResourcesGrid.BomGrid.Table[i].Value+"'/>");return t+="</BOMResourceXML>",Logger.InfoLog("AddEditBOMViewModel::Exiting BOMResourceXML"),t.toString()}},{key:"BOMProductXML",value:function(e){Logger.InfoLog("AddEditBOMViewModel::Entering MachineXML ");var t="";t+="<BOMProductXML>";for(var i=0;i<this.InputGrid.BomGrid.Table.length;i++)r.e.IsEmpty(this.InputGrid.BomGrid.Table[i].ProductName_Key)||(t+="<Row ",null!=e&&(null==e||"SaveAs"==e.toString())||r.e.IsEmpty(this.InputGrid.BomGrid.Table[i].BOMProductID)?t+=" BOMProductID='0'":t+=" BOMProductID='"+this.InputGrid.BomGrid.Table[i].BOMProductID.toString()+"'",t+=" ProductID='"+this.InputGrid.BomGrid.Table[i].ProductName_Key+"'",t+=" Quantity='"+r.e.String(this.InputGrid.BomGrid.Table[i].Qty)+"'",t+=" UOMID='"+r.e.String(this.InputGrid.BomGrid.Table[i].UOM_Key)+"'",t+=" UnitPrice='"+r.e.String(this.InputGrid.BomGrid.Table[i].UnitPrice)+"'",this.InputGrid.BomGrid.TableColumns.Contains("FilterOn_Key")&&!r.e.IsEmpty(this.InputGrid.BomGrid.Table[i].FilterOn_Key)&&(t+=" FilterOn='"+this.InputGrid.BomGrid.Table[i].FilterOn_Key.toString()+"'"),t+=" ProductUse='1'",t+=" Action='New'",t+=" Wastage='"+this.InputGrid.BomGrid.Table[i].Wastage+"'",t+=" Value='"+this.InputGrid.BomGrid.Table[i].Value+"'/>");for(var s=0;s<this.OutputGrid.BomGrid.Table.length;s++)r.e.IsEmpty(this.OutputGrid.BomGrid.Table[s].ProductName_Key)||(t+="<Row ",null!=e&&(null==e||"SaveAs"==e.toString())||r.e.IsEmpty(this.OutputGrid.BomGrid.Table[s].BOMProductID)?t+=" BOMProductID='0'":t+=" BOMProductID='"+this.OutputGrid.BomGrid.Table[s].BOMProductID.toString()+"'",t+=" ProductID='"+this.OutputGrid.BomGrid.Table[s].ProductName_Key+"'",t+=" Quantity='"+r.e.String(this.OutputGrid.BomGrid.Table[s].Qty)+"'",t+=" UnitPrice='"+r.e.String(this.OutputGrid.BomGrid.Table[s].UnitPrice)+"'",t+=" ProductUse='2'",t+=" Action='New'",t+=" Value='"+this.OutputGrid.BomGrid.Table[s].Value+"'/>");return t+="</BOMProductXML>",Logger.InfoLog("AddEditBOMViewModel::Exiting MachineXML"),t.toString()}},{key:"ValidateGrids",value:function(){for(var e=0;e<this.ExpenseGrid.BomGrid.Table.length;e++)if(r.e.IsEmpty(this.ExpenseGrid.BomGrid.Table[e].AccountName_Key))if(r.e.IsEmpty(this.ExpenseGrid.BomGrid.Table[e].Expense_Key))if(r.e.IsEmpty(this.ExpenseGrid.BomGrid.Table[e].Value))if(r.e.IsEmpty(this.ExpenseGrid.BomGrid.Table[e].Name));else{if(r.e.IsEmpty(this.ExpenseGrid.BomGrid.Table[e].AccountName_Key))return"Incomplete Expenses Information at Row :"+(e+1).toString();if(r.e.IsEmpty(this.ExpenseGrid.BomGrid.Table[e].Expense_Key))return"Incomplete Expenses Information at Row :"+(e+1).toString();if(r.e.IsEmpty(this.ExpenseGrid.BomGrid.Table[e].Value))return"Incomplete Expenses Information at Row :"+(e+1).toString()}else{if(r.e.IsEmpty(this.ExpenseGrid.BomGrid.Table[e].AccountName_Key))return"Incomplete Expenses Information at Row :"+(e+1).toString();if(r.e.IsEmpty(this.ExpenseGrid.BomGrid.Table[e].Expense_Key))return"Incomplete Expenses Information at Row :"+(e+1).toString();if(r.e.IsEmpty(this.ExpenseGrid.BomGrid.Table[e].Name))return"Incomplete Expenses Information at Row :"+(e+1).toString()}else{if(r.e.IsEmpty(this.ExpenseGrid.BomGrid.Table[e].AccountName_Key))return"Incomplete Expenses Information at Row :"+(e+1).toString();if(r.e.IsEmpty(this.ExpenseGrid.BomGrid.Table[e].Value))return"Incomplete Expenses Information at Row :"+(e+1).toString();if(r.e.IsEmpty(this.ExpenseGrid.BomGrid.Table[e].Name))return"Incomplete Expenses Information at Row :"+(e+1).toString()}else{if(r.e.IsEmpty(this.ExpenseGrid.BomGrid.Table[e].Expense_Key))return"Incomplete Expenses Information at Row :"+(e+1).toString();if(r.e.IsEmpty(this.ExpenseGrid.BomGrid.Table[e].Value))return"Incomplete Expenses Information at Row :"+(e+1).toString();if(r.e.IsEmpty(this.ExpenseGrid.BomGrid.Table[e].Name))return"Incomplete Expenses Information at Row :"+(e+1).toString()}return""}},{key:"OnSaveBOM",value:function(e){var t=this;if(Logger.InfoLog("AddEditBOMViewModel::Entering OnSaveMachine "),"Save"==e.toString()||"SaveAs"==e.toString())try{var i=this._ScreenObject.ValidateData();if(!r.e.IsEmpty(i))return this.DisplayMessage=i,void(this.MessageVisibility=!0);if(i=this.ValidateGrids(),!r.e.IsEmpty(i))return this.DisplayMessage=i,void(this.MessageVisibility=!0);if(!this.ScreenObject.ValidateDataonSave())return;this.objBOM.BOMID=null!=e&&"SaveAs"==e.toString()?0:this.BID,this.objBOM.Code=this.txtCode.Text,this.objBOM.Name=this.txtName.Text,this.objBOM.Date=new Date,this.objBOM.ProductID=this.Product.SelectedValue,this.objBOM.UOMID=r.e.IsEmpty(this.UOM.SelectedValue)?0:parseInt(this.UOM.SelectedValue),this.objBOM.FPQty=r.e.Double(this.FPQty.Text),this.objBOM.FPQty<=0&&(this.objBOM.FPQty=1),this.objBOM.LocationID=this.Location.SelectedValue,this.objBOM.DivisionID=this.Division.SelectedValue,this.objBOM.group=!1,this.objBOM.selectednodeid=parseInt(this.Group.SelectedValue),this.objBOM.Desc=this.txtDesc.Text,this.objBOM.StatusID=parseInt(this.MStatus.SelectedValue),this.objBOM.BOMProductXML=this.BOMProductXML(e),this.objBOM.BOMExpenseXML=this.BOMExpenseXML(e),this.objBOM.BOMResourceXML=this.BOMResourceXML(e),this.objBOM.CustomFieldsQuery=this._ScreenObject.GetCustomFieldsQuery(),this.objBOM.CustomCCQuery=this._ScreenObject.GetCustomCostCenterFieldsQuery(),this.objBOM.ProductionXML=this.ProductionsMethod.GETXML(),this.objBOM.WID=464==this.objBOM.StatusID?0:this.ScreenObject.CheckWorkFlow(),s.a.inventory.SaveBOM(this.objBOM,"SaveBOM").subscribe((function(e){t.DisplayMessage=e.Message,t.MessageVisibility=!0,e.RetValue>0&&(t.txtCode.Text="",t.txtName.Text="",t.InputGrid.BomGrid.Table.Clear(),t.ExpenseGrid.BomGrid.Table.Clear(),t.OutputGrid.BomGrid.Table.Clear(),t.ResourcesGrid.BomGrid.Table.Clear(),t.FillEmptyRows(),t.Date.Date=new Date,t.Product.SelectedValue=0,t.Location.SelectedValue=0,t.Division.SelectedValue=0,t.txtDesc.Text="",t.FPQty.Text="1",t.BID=0,t.objBOM.BOMID=t.BID,t.AutoGenerateCode())}),(function(e){console.log(" BOM Save : "+JSON.stringify(e))}))}catch(i){Logger.ErrorLog("AddEditBOMViewModel:: OnSAVE"+i.stack)}else e.toString();Logger.InfoLog("AddEditBOMViewModel::Exiting OnSaveMachine ")}},{key:"UpdateSequence",value:function(){var e=this;this.SNo=1,this.InputGrid.BomGrid.Table.forEach((function(t){t.Sno=e.SNo++})),this.SNo=1,this.OutputGrid.BomGrid.Table.forEach((function(t){t.Sno=e.SNo++})),this.SNo=1,this.ExpenseGrid.BomGrid.Table.forEach((function(t){t.Sno=e.SNo++})),this.SNo=1,this.ResourcesGrid.BomGrid.Table.forEach((function(t){t.Sno=e.SNo++})),this.InputGrid.BomGrid.refreshDataView(),this.OutputGrid.BomGrid.refreshDataView(),this.ExpenseGrid.BomGrid.refreshDataView(),this.ResourcesGrid.BomGrid.refreshDataView()}},{key:"OnCellEditEnding",value:function(e){var t=e.item,i=e.column.field;if(Object.keys(t).Contains("Machine_Key")){if("Machine"==i&&""!=t.Machine_Key.toString()){if(this.MachineID==parseInt(t.Machine_Key.toString()))return;t.Value=this.objBOM.getMachineCostHr(this.MachineCCID,parseInt(t.Machine_Key.toString())),this.ResourcesGrid.BomGrid.updateRow(t)}}else{if("DataGridComboBoxColumn"==e.column.className)return;if(Object.keys(t).Contains("UOM")&&"ProductName"==i&&!r.e.IsEmpty(t.ProductName_Key)){var s=0;"UOM"!=i||r.e.IsEmpty(t.UOM_Key)||(s=parseInt(t.UOM_Key.toString()));var n=o.a.GetProductTypeDetails(parseInt(t.ProductName_Key.toString()),this.Date.Date,s,78,"",!1,!1,!1,!1,!1,!1,!1,!1,!1);n.Tables.length>0&&n.Columns[0].Contains("uomid")&&!r.e.IsEmpty(n.Tables[0][0].uomid)&&(t.UOM=n.Tables[0][0].UnitName.toString(),t.UOM_Key=n.Tables[0][0].uomid.toString(),n.Tables.length>3&&n.Tables[3].length>0&&n.Columns[3].Contains("SellingRate")&&""!=n.Tables[3][0].SellingRate.toString()?t.UnitPrice=n.Tables[3][0].SellingRate.toString():n.Tables.length>0&&n.Tables[0].length>0&&n.Columns[0].Contains("SellingRate")&&""!=n.Tables[0][0].SellingRate.toString()&&(t.UnitPrice=n.Tables[0][0].SellingRate.toString()))}this.CalculateTotals(t)}}},{key:"CalculateTotals",value:function(e){var t=new S.a,i=new D.c;i.setFieldDetails("RATE",1,1,"",1,!1,!1),t.push("RATE",i),(i=new D.c).setFieldDetails("QTY",4,1,"",1,!1,!1),t.push("QTY",i),r.e.IsEmpty(e.UnitPrice)?t.RATE.setFieldValue(0):t.RATE.setFieldValue(e.UnitPrice),r.e.IsEmpty(e.Qty)?t.QTY.setFieldValue(0):t.QTY.setFieldValue(e.Qty),e.Value=s.a.eval.EvaluateExpression("QTY*RATE",t).toString()}},{key:"onBeginEdit",value:function(e){var t=e.args.item,i=e.args.column,s=i.DgCol,n=(r.e.IsEmpty(s.ValueBinding),r.e.IsEmpty(s.ValueBinding)?s.ValueMember:s.ValueBinding);if(Object.keys(t).Contains("Machine_Key")||"Machine_Key"==n)this.MachineID=r.e.IsEmpty(t.Machine_Key)?0:parseInt(t.Machine_Key.toString());else{var a=e.args;if("DataGridPactListBoxColumn"==i.className){var o=a.model;if(11==o.CostCenterID){var l=" (BaseID IN ";l+=" (SELECT BaseID ",l=(l+=" FROM COM_UOM AS COM_UOM_1 with(nolock) ")+" WHERE      (UOMID ="+t.UOM_Key.toString()+" ))) ",""==t.UOM_Key.toString()&&(l=" (BaseID IN ",l+=" (SELECT BaseID ",l+=" FROM COM_UOM AS COM_UOM_1 with(nolock) ",l+=" WHERE (UOMID =-1 ))) "),o.FilterCondition=l}3==o.CostCenterID&&"ProductName_Key"==o.SelectedValueBinding&&this.FilterCCID>0&&Object.keys(t).Contains("FilterOn_Key")&&!r.e.IsEmpty(t.FilterOn_Key)&&parseInt(t.FilterOn_Key.toString())>0&&(3==this.FilterCCID?o.Where=" ParentID="+t.FilterOn_Key.toString()+" ":50006==this.FilterCCID?o.Where=" CategoryID="+t.FilterOn_Key.toString()+" ":50004==this.FilterCCID?o.Where=" DepartmentID="+t.FilterOn_Key.toString()+" ":this.FilterCCID>5e4&&(o.Where=" a.ProductID IN (select NodeID from COM_CCCCData with(nolock) where CostCenterID=3 and ",o.Where+=" CCNID"+this.FilterCCID.toString()+"="+t.FilterOn_Key.toString()+" )"))}}}},{key:"OnCustomizeExtraFields",value:function(e){}},{key:"OnProductChange",value:function(e){var t=this;if(this.UOM.Length!=this.Product.SelectedValue.toString()&&(this.UOM.Items.Clear(),this.UOM.Length=this.Product.SelectedValue.toString(),this.UOM.SelectedValue=null,this.Product.SelectedValue>0)){var i=this.objBOM.GetProductUnits(this.Product.SelectedValue);i.Tables[0].length>0&&(i.Tables[0].forEach((function(e){t.UOM.Items.push(d.d.ComboBoxItems_2(e.UnitName.toString(),e.UOMID.toString()))})),i.Columns[0].Contains("DefaultUOM")&&(this.UOM.SelectedValue=i.Tables[0][0].DefaultUOM.toString()))}}},{key:"OnLoad",value:function(e){var t=this.objBOM.GetBOMDetails(e);if(t.Tables.length>5){if(t.Tables[0].length>0&&(this.txtCode.Text=t.Tables[0][0].BOMCode.toString(),this.txtName.Text=t.Tables[0][0].BOMName.toString(),this.Group.SelectedValue=t.Tables[0][0].ParentID.toString(),this.MStatus.SelectedValue=t.Tables[0][0].StatusID.toString(),this.txtDesc.Text=t.Tables[0][0].Description.toString(),r.e.IsEmpty(t.Tables[0][0].ProductID)||(this.Product.SelectedValue=parseInt(t.Tables[0][0].ProductID.toString())),r.e.IsEmpty(t.Tables[0][0].LocationID)||(this.Location.SelectedValue=parseInt(t.Tables[0][0].LocationID.toString())),r.e.IsEmpty(t.Tables[0][0].DivisionID)||(this.Division.SelectedValue=parseInt(t.Tables[0][0].DivisionID.toString())),r.e.IsEmpty(t.Tables[0][0].Date)||(this.Date.Date=new Date(t.Tables[0][0].Date.toString())),this.FPQty.Text=t.Tables[0][0].FPQty.toString()),t.Tables.length>8&&t.Tables[8].length>0&&this.ProductionsMethod.Load(t.Tables[8]),this.ScreenObject.LoadCustomFieldsData(t.Tables[6]),this.ScreenObject.LoadCustomFieldsCCData(t.Tables[7]),this.ScreenObject.CanApprove(t.Tables[0][0],t.Tables[10][0],this.ButtonSave),this.InputGrid.BomGrid.Table.Clear(),this.ExpenseGrid.BomGrid.Table.Clear(),this.ResourcesGrid.BomGrid.Table.Clear(),this.OutputGrid.BomGrid.Table.Clear(),t.Tables[1].length>0)for(var i=0;i<t.Tables[1].length;i++){var s=this.InputGrid.BomGrid.NewRow();s.ProductCode=t.Tables[1][i].ProductCode.toString(),s.ProductName=t.Tables[1][i].ProductName.toString(),s.ProductName_Key=t.Tables[1][i].ProductID.toString(),s.Qty=t.Tables[1][i].Quantity.toString(),t.Columns[1].Contains("UOM")&&(s.UOM=t.Tables[1][i].UOM.toString()),s.UOM_Key=t.Tables[1][i].UOMID.toString(),s.UnitPrice=t.Tables[1][i].UnitPrice.toString(),s.Wastage=t.Tables[1][i].Wastage.toString(),s.Value=t.Tables[1][i].Value.toString(),s.BOMProductID=t.Tables[1][i].BOMProductID.toString(),this.InputGrid.BomGrid.TableColumns.Contains("FilterOn_Key")&&!r.e.IsEmpty(t.Tables[1][i].FilterOn)&&(s.FilterOn_Key=t.Tables[1][i].FilterOn.toString()),this.InputGrid.BomGrid.addRow(s)}if(t.Tables[2].length>0)for(var n=0;n<t.Tables[2].length;n++){var a=this.ExpenseGrid.BomGrid.NewRow();a.Name=t.Tables[2][n].Name.toString(),a.AccountName=t.Tables[2][n].CRAccountName.toString(),r.e.IsEmpty(t.Tables[2][n].CreditAccountID)||(a.AccountName_Key=t.Tables[2][n].CreditAccountID.toString()),a.Expense=t.Tables[2][n].DRAccountName.toString(),r.e.IsEmpty(t.Tables[2][n].DebitAccountID)||(a.Expense_Key=t.Tables[2][n].DebitAccountID.toString()),a.Value=t.Tables[2][n].Value.toString(),a.ExpenseID=t.Tables[2][n].ExpenseID.toString(),this.ExpenseGrid.BomGrid.addRow(a)}if(t.Tables[3].length>0)for(var o=0;o<t.Tables[3].length;o++){var l=this.ResourcesGrid.BomGrid.NewRow();l.Machine=t.Tables[3][o].ResourceName.toString(),l.Machine_Key=t.Tables[3][o].ResourceID.toString(),l.Hrs=t.Tables[3][o].Hours.toString(),l.Value=t.Tables[3][o].Value.toString(),l.BOMResourceID=t.Tables[3][o].BOMResourceID.toString(),this.ResourcesGrid.BomGrid.addRow(l)}if(t.Tables[5].length>0)for(var u=0;u<t.Tables[5].length;u++){var d=this.OutputGrid.BomGrid.NewRow();d.ProductCode=t.Tables[5][u].ProductCode.toString(),d.ProductName=t.Tables[5][u].ProductName.toString(),d.ProductName_Key=t.Tables[5][u].ProductID.toString(),d.Qty=t.Tables[5][u].Quantity.toString(),d.UnitPrice=t.Tables[5][u].UnitPrice.toString(),d.Value=t.Tables[5][u].Value.toString(),d.BOMProductID=t.Tables[5][u].BOMProductID.toString(),this.OutputGrid.BomGrid.addRow(d)}this.FillEmptyRows()}this.InputGrid.BomGrid.RefreshGrid=this.ExpenseGrid.BomGrid.RefreshGrid=this.ResourcesGrid.BomGrid.RefreshGrid=this.OutputGrid.BomGrid.RefreshGrid=!0}},{key:"OnShowContact",value:function(){Logger.InfoLog("AddEditAccountScreenViewModel::Entering OnShowContact"),Logger.InfoLog("AddEditAccountScreenViewModel::Exiting OnShowContact")}},{key:"OnShowAddress",value:function(){Logger.InfoLog("AddEditAccountScreenViewModel::Entering OnShowAddress"),Logger.InfoLog("AddEditAccountScreenViewModel::Exiting OnShowAddress")}},{key:"OnAddContact",value:function(){Logger.InfoLog("AddEditAccountScreenViewModel::Entering AddContact"),Logger.InfoLog("AddEditAccountScreenViewModel::Exiting AddContact")}},{key:"OnShowNote",value:function(){Logger.InfoLog("AddEditAccountScreenViewModel::Entering OnShowNote"),Logger.InfoLog("AddEditAccountScreenViewModel::Exiting OnShowNote")}},{key:"ScreenObject",get:function(){return this._ScreenObject}}]),i}(l.b),O=i("8LsI"),M=i("6z9j"),y=function e(){_classCallCheck(this,e),this.ColumnSpan="4",this.Tree=new M.a},G=i("FWvQ"),f=i("ZDA+"),B=i("PDNK"),P=function(e){_inherits(i,e);var t=_createSuper(i);function i(e,n,r,l){var u;_classCallCheck(this,i),(u=t.call(this)).StageID=0,u.parentid=0,u.FilterCCID=0,u.MachineCCID=0,u.MachineID=0,u.SNo=0,u.objBOM=new T,u._ScreenObject=new o.a,u.Title="",u.Stage=new h.b(0),u.Code="",u.Name="",u.StageNodeID=0,u.txtCost=new c.d(0),u.txtUsage=new c.d(0),u.txtDuration=new c.d(0),u.txtEffeciency=new c.d(0),u.Description=new c.d(0),u.MStatus=new d.e(23898),u.Group=new d.e(23897),u.Location=new h.b(23900),u.Division=new h.b(23901),u.UOM=new d.e(109),u.Date=new p.a(23902),u.txtDesc=new c.d(23903),u.Pickrate=new B.b("Pickrate"),u.CancelVisible=!1,u.TreeObject=null,u.Childrens=new Array,u.Parent=null,u.InputYes=!1,u.OutputYes=!1,u.ExpenseYes=!1,u.ResourceYes=!1,u.PrevValue="",u.parentid=n,u.Parent=r,u.StageID=e,u.TreeObject=l,u.MessageVisibility=!1,u.Pickrate.IsHorizontalOrientation=!0,u._ScreenObject.Data=l.ScreenObject.Data;var I=u.ScreenObject.Data.Tables[4].filter((function(e){return"StageDimension"==e.Name}));I.length>0&&I[0].Value.toString().length>0&&(u.Stage.CCID=parseInt(I[0].Value),u.Stage.TypeID=1),(I=u.ScreenObject.Data.Tables[4].filter((function(e){return"EnableDuration"==e.Name}))).length>0&&Object(a.j)(I[0].Value.toString())?(u.txtDuration.Visible=!0,u.txtDuration.Label="Duration"):u.txtDuration.Visible=!1,u.Pickrate.Label="Pick rate for issue products";var b=new B.a("Master",1);return b.Label="Product master",b.Group=u.Pickrate,(0==(I=u.ScreenObject.Data.Tables[4].filter((function(e){return"BomDefaultRate"==e.Name}))).length||I.length>0&&"0"==I[0].Value.toString())&&(b.IsChecked=!0),u.Pickrate.Items.push(b),(b=new B.a("Chart",1)).Label="Price chart",b.Group=u.Pickrate,I.length>0&&"1"==I[0].Value.toString()&&(b.IsChecked=!0),u.Pickrate.Items.push(b),(b=new B.a("AvgRate",1)).Label="Avg. Rate",b.Group=u.Pickrate,I.length>0&&"2"==I[0].Value.toString()&&(b.IsChecked=!0),u.Pickrate.Items.push(b),u.Pickrate.Enable=!s.a.SessionManager.IsActionAssigned(76,"Do not allow to change Pick Rate"),u.LoadData(),u.MStatus.SelectedValue="1",u.loadtabs(),e>0?u.Title="Edit Stage":(u.Title="Add Stage",u.objBOM.GUID="GUID"),u.DisplayName=u.Title,u.CheckViewForUser(),u.Stage.Label="Stage",u}return _createClass(i,[{key:"CheckViewForUser",value:function(){var e=this;this.InputGrid.Columns.forEach((function(t){null!=t.ID&&e.ScreenObject.SetView(t,e.TreeObject.BID>0)})),this.ExpenseGrid.Columns.forEach((function(t){null!=t.ID&&e.ScreenObject.SetView(t,e.TreeObject.BID>0)})),this.ResourcesGrid.Columns.forEach((function(t){null!=t.ID&&e.ScreenObject.SetView(t,e.TreeObject.BID>0)})),this.OutputGrid.Columns.forEach((function(t){null!=t.ID&&e.ScreenObject.SetView(t,e.TreeObject.BID>0)}))}},{key:"loadtabs",value:function(){this.AssignRowColumns();for(var e=this._ScreenObject.CustomTab.Pages.length-1;e>=0;e--){var t=this._ScreenObject.CustomTab.Pages[e];switch(t.Name){case"Production Method":t.Fields.push(g)}}}},{key:"AssignRowColumns",value:function(){var e;e=this._ScreenObject.CustomFields.length;for(var t=0;t<e;t++)this._ScreenObject.CustomFields[t].Row=t/4,this._ScreenObject.CustomFields[t].Column=t%4}},{key:"LoadData",value:function(){var e,t;this.InputGrid=new I.a,this.InputGrid.Table=[],this.InputGrid.Columns=[],this.InputGrid.CellEditEnding.Subscribe(this,"OnCellEditEnding"),this.InputGrid.BeginEdit.Subscribe(this,"onBeginEdit"),this.InputGrid.CanUserAddRows=!0,this.InputGrid.CanUserDeleteRows=!0,this.InputGrid.Height=230,this.InputGrid.Width="880",this.InputGrid.TableColumns.push("Sno"),this.InputGrid.TableColumns.push("ProductCode"),this.InputGrid.TableColumns.push("ProductName"),this.InputGrid.TableColumns.push("ProductName_Key"),this.InputGrid.TableColumns.push("Qty"),this.InputGrid.TableColumns.push("UOM"),this.InputGrid.TableColumns.push("UOM_Key"),this.InputGrid.TableColumns.push("UnitPrice"),this.InputGrid.TableColumns.push("Value"),this.InputGrid.TableColumns.push("Wastage"),this.InputGrid.TableColumns.push("BOMProductID"),this.InputGrid.TableColumns.push("IncludeinStage"),this.InputGrid.TableColumns.push("IncludeinFinal"),this.InputGrid.TableColumns.push("Stage"),this.InputGrid.TableColumns.push("Stage_Key"),this.InputGrid.TableColumns.push("Remarks"),(t=new m.a).Header="#",t.DisplayMember="Sno",t.DataType="TextBlock",t.Width=23,t.IsVisible=!0,t.ReadOnly=!0,this.InputGrid.Columns.push(t),this.ScreenObject.Data.Tables.length>4&&((e=this.ScreenObject.Data.Tables[4].filter((function(e){return"BomFilterDimension"==e.Name}))).length>0&&!r.e.IsEmpty(e[0].Value)&&r.e.Int(e[0].Value.toString())>0&&parseInt(e[0].Value.toString())>0&&(this.FilterCCID=parseInt(e[0].Value.toString()),(t=new m.a).Header="FilterOn",t.DisplayMember="FilterOn",t.ValueMember="FilterOn_Key",t.DataType="LISTBOX",t.Width=230,t.CostCenterID=parseInt(e[0].Value.toString()),t.TypeID=3==parseInt(e[0].Value.toString())?12:1,t.IsVisible=!0,this.InputGrid.Columns.push(t),this.InputGrid.TableColumns.push("FilterOn"),this.InputGrid.TableColumns.push("FilterOn_Key"))),(t=new m.a).Header=s.a.GetResource("BOM_ProductCOde"),t.DisplayMember="ProductCode",t.ValueMember="ProductName_Key",t.DataType="LISTBOX",t.CostCenterID=3,t.TypeID=100,(e=this._ScreenObject.Data.Tables[0].filter((function(e){return"PRD_BOMProducts"==e.SysTableName&&"ProductCode"==e.SysColumnName&&1==e.LinkData}))).length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):150,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(a.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.InputGrid.Columns.push(t),(t=new m.a).Header=s.a.GetResource("BOM_ProductName"),t.DisplayMember="ProductName",t.ValueMember="ProductName_Key",t.DataType="LISTBOX",t.CostCenterID=3,t.TypeID=10,(e=this._ScreenObject.Data.Tables[0].filter((function(e){return"PRD_BOMProducts"==e.SysTableName&&"ProductID"==e.SysColumnName&&1==e.LinkData}))).length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):220,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(a.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.InputGrid.Columns.push(t),(t=new m.a).Header=s.a.GetResource("Quantity"),t.DisplayMember="Qty",t.DataType="INT",(e=this._ScreenObject.Data.Tables[0].filter((function(e){return"PRD_BOMProducts"==e.SysTableName&&"Quantity"==e.SysColumnName&&1==e.LinkData}))).length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):90,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(a.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),s.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&!r.e.IsEmpty(s.a.SessionManager.Preferences.DecimalsinQty)&&(t.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinQty),this.InputGrid.Columns.push(t),(t=new m.a).Header=s.a.GetResource("UOM"),t.DisplayMember="UOM",t.ValueMember="UOM_Key",t.DataType="LISTBOX",t.CostCenterID=11,t.TypeID=1,(e=this._ScreenObject.Data.Tables[0].filter((function(e){return"PRD_BOMProducts"==e.SysTableName&&"UOMID"==e.SysColumnName&&1==e.LinkData}))).length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):100,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(a.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.InputGrid.Columns.push(t),(t=new m.a).Header=s.a.GetResource("UnitPrice"),t.DisplayMember="UnitPrice",t.DataType="FLOAT",(e=this._ScreenObject.Data.Tables[0].filter((function(e){return"PRD_BOMProducts"==e.SysTableName&&"UnitPrice"==e.SysColumnName&&1==e.LinkData}))).length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):100,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(a.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),s.a.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=s.a.SessionManager.Preferences.DecimalsinRate&&(t.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinRate),this.InputGrid.Columns.push(t),(t=new m.a).Header=s.a.GetResource("Value"),t.DisplayMember="Value",t.DataType="FLOAT",(e=this._ScreenObject.Data.Tables[0].filter((function(e){return"PRD_BOMProducts"==e.SysTableName&&"Value"==e.SysColumnName&&1==e.LinkData}))).length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):100,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(a.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),s.a.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=s.a.SessionManager.Preferences.DecimalsinRate&&(t.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinRate),this.InputGrid.Columns.push(t),(t=new m.a).Header=s.a.GetResource("Waistage"),t.DisplayMember="Wastage",t.DataType="FLOAT",(e=this._ScreenObject.Data.Tables[0].filter((function(e){return"PRD_BOMProducts"==e.SysTableName&&"Wastage"==e.SysColumnName&&1==e.LinkData}))).length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):100,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(a.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.InputGrid.Columns.push(t);var i,n=new Array;if(n.push(d.d.ComboBoxItems_2("No","0")),n.push(d.d.ComboBoxItems_2("Yes","1")),(t=new m.a).Header="Incl. in Final Cost",t.ValueBinding="IncludeinFinal",t.ValueMember="Value",t.DisplayMember="Name",t.DataType="ComboBox",t.ComboData=n,(e=this._ScreenObject.Data.Tables[0].filter((function(e){return"PRD_BOMProducts"==e.SysTableName&&"IncInFinalCost"==e.SysColumnName&&1==e.LinkData}))).length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):100,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(a.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.InputGrid.Columns.push(t),(t=new m.a).Header="Incl. in Stage Cost",t.ValueBinding="IncludeinStage",t.DataType="ComboBox",t.ValueMember="Value",t.DisplayMember="Name",(e=this._ScreenObject.Data.Tables[0].filter((function(e){return"PRD_BOMProducts"==e.SysTableName&&"IncInStageCost"==e.SysColumnName&&1==e.LinkData}))).length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):100,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(a.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),t.ComboData=n,this.InputGrid.Columns.push(t),s.a.SessionManager.Preferences.ContainsKey("AutoProduceDoc")&&""!=s.a.SessionManager.Preferences.AutoProduceDoc&&this.Stage.Visible&&this.Stage.CCID>5e4&&"0"!=s.a.SessionManager.Preferences.AutoProduceDoc&&parseInt(s.a.SessionManager.Preferences.AutoProduceDoc)>4e4&&((t=new m.a).Header="Auto Produce",t.DisplayMember="Stage",t.ValueMember="Stage_Key",t.DataType="LISTBOX",t.Width=150,t.CostCenterID=this.Stage.CCID,t.TypeID=this.Stage.TypeID,t.IsVisible=!0,this.InputGrid.Columns.push(t)),(t=new m.a).Header=s.a.GetResource("Remarks"),t.DisplayMember="Remarks",t.DataType="TextBlock",(e=this._ScreenObject.Data.Tables[0].filter((function(e){return"PRD_BOMProducts"==e.SysTableName&&"Remarks"==e.SysColumnName&&1==e.LinkData}))).length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):75,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(a.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.InputGrid.Columns.push(t),this.ExpenseGrid=new I.a,this.ExpenseGrid.Table=[],this.ExpenseGrid.Columns=[],this.ExpenseGrid.CellEditEnding.Subscribe(this,"OnCellEditEnding"),this.ExpenseGrid.CanUserAddRows=!0,this.ExpenseGrid.CanUserDeleteRows=!0,this.ExpenseGrid.Height=230,this.ExpenseGrid.Width="880",(t=new m.a).Header="#",t.DisplayMember="Sno",t.DataType="TextBlock",t.Width=23,t.IsVisible=!0,t.ReadOnly=!0,this.ExpenseGrid.Columns.push(t),(t=new m.a).Header="Name",t.DisplayMember="Name",t.DataType="TextBlock",(e=this._ScreenObject.Data.Tables[0].filter((function(e){return"PRD_Expenses"==e.SysTableName&&"Name"==e.SysColumnName}))).length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):200,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(a.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.ExpenseGrid.Columns.push(t),(t=new m.a).Header="Debit",t.DisplayMember="Expense",t.ValueMember="Expense_Key",t.DataType="LISTBOX",t.CostCenterID=2,e=this.ScreenObject.Data.Tables[4].filter((function(e){return"DrAccListview"==e.Name})),t.TypeID=null!=e&&e.length>0?parseInt(e[0].Value.toString()):2,(e=this._ScreenObject.Data.Tables[0].filter((function(e){return"PRD_Expenses"==e.SysTableName&&"DebitAccountID"==e.SysColumnName}))).length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):200,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(a.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.ExpenseGrid.Columns.push(t),(t=new m.a).Header="Credit",t.DisplayMember="AccountName",t.ValueMember="AccountName_Key",t.DataType="LISTBOX",t.CostCenterID=2,e=this.ScreenObject.Data.Tables[4].filter((function(e){return"CrAccListview"==e.Name})),t.TypeID=null!=e&&e.length>0?parseInt(e[0].Value.toString()):2,(e=this._ScreenObject.Data.Tables[0].filter((function(e){return"PRD_Expenses"==e.SysTableName&&"CreditAccountID"==e.SysColumnName}))).length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):200,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(a.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.ExpenseGrid.Columns.push(t),(t=new m.a).Header=s.a.GetResource("Value"),t.DisplayMember="Value",t.DataType="FLOAT",(e=this._ScreenObject.Data.Tables[0].filter((function(e){return"PRD_Expenses"==e.SysTableName&&"Value"==e.SysColumnName}))).length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):90,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(a.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),s.a.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=s.a.SessionManager.Preferences.DecimalsinRate&&(t.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinRate),this.ExpenseGrid.Columns.push(t),(t=new m.a).Header="Incl. in Final Cost",t.ValueBinding="IncludeinFinal",t.ValueMember="Value",t.DisplayMember="Name",t.DataType="ComboBox",t.ComboData=n,(e=this._ScreenObject.Data.Tables[0].filter((function(e){return"PRD_Expenses"==e.SysTableName&&"IncInFinalCost"==e.SysColumnName}))).length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):107,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(a.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.ExpenseGrid.Columns.push(t),(t=new m.a).Header="Incl. in Stage Cost",t.ValueBinding="IncludeinStage",t.DataType="ComboBox",t.ValueMember="Value",t.DisplayMember="Name",t.ComboData=n,(e=this._ScreenObject.Data.Tables[0].filter((function(e){return"PRD_Expenses"==e.SysTableName&&"IncInStageCost"==e.SysColumnName}))).length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):114,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(a.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.ExpenseGrid.Columns.push(t),this.ExpenseGrid.TableColumns.push("Sno"),this.ExpenseGrid.TableColumns.push("Name"),this.ExpenseGrid.TableColumns.push("AccountName"),this.ExpenseGrid.TableColumns.push("AccountName_Key"),this.ExpenseGrid.TableColumns.push("Expense"),this.ExpenseGrid.TableColumns.push("Expense_Key"),this.ExpenseGrid.TableColumns.push("Value"),this.ExpenseGrid.TableColumns.push("ExpenseID"),this.ExpenseGrid.TableColumns.push("IncludeinStage"),this.ExpenseGrid.TableColumns.push("IncludeinFinal"),this.ResourcesGrid=new I.a,this.ResourcesGrid.Table=[],this.ResourcesGrid.Columns=[],this.ResourcesGrid.CellEditEnding.Subscribe(this,"OnCellEditEnding"),this.ResourcesGrid.BeginEdit.Subscribe(this,"onBeginEdit"),this.ResourcesGrid.CanUserAddRows=!0,this.ResourcesGrid.CanUserDeleteRows=!0,this.ResourcesGrid.Height=230,this.ResourcesGrid.Width="880",(t=new m.a).Header="#",t.DisplayMember="Sno",t.DataType="TextBlock",t.Width=40,t.IsVisible=!0,t.ReadOnly=!0,this.ResourcesGrid.Columns.push(t),(e=this.ScreenObject.Data.Tables[4].filter((function(e){return"EnableMachineoptions"==e.Name}))).length>0&&e[0].Value.toString().length>0&&Object(a.j)(e[0].Value.toString())){(t=new m.a).Header="Options",t.DisplayMember="Sno",t.Width=80,t.ValueBinding="Options",t.ValueMember="Value",t.DisplayMember="Name",t.DataType="ComboBox";for(var o=new Array,l=1;l<10;l++)o.push(d.d.ComboBoxItems_2("Option "+l,l.toString()));t.ComboData=o,this.ResourcesGrid.Columns.push(t),this.ResourcesGrid.TableColumns.push("Options")}if((t=new m.a).Header=s.a.GetResource("Machine"),t.DisplayMember="Machine",t.DataType="LISTBOX",(e=this.ScreenObject.Data.Tables[4].filter((function(e){return"MachineDimension"==e.Name}))).length>0&&e[0].Value.toString().length>0&&(this.MachineCCID=parseInt(e[0].Value),t.CostCenterID=parseInt(e[0].Value)),t.TypeID=3,(e=this._ScreenObject.Data.Tables[0].filter((function(e){return"PRD_BOMResources"==e.SysTableName&&"ResourceID"==e.SysColumnName}))).length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):200,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(a.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.ResourcesGrid.Columns.push(t),(t=new m.a).Header=s.a.GetResource("HRS"),t.DisplayMember="Hrs",t.DataType="FLOAT",(e=this._ScreenObject.Data.Tables[0].filter((function(e){return"PRD_BOMResources"==e.SysTableName&&"Hours"==e.SysColumnName}))).length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):100,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(a.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.ResourcesGrid.Columns.push(t),(t=new m.a).Header="Cost/Hr",t.DisplayMember="Value",t.DataType="FLOAT",(e=this._ScreenObject.Data.Tables[0].filter((function(e){return"PRD_BOMResources"==e.SysTableName&&"Value"==e.SysColumnName}))).length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):100,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(a.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),s.a.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=s.a.SessionManager.Preferences.DecimalsinRate&&(t.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinRate),this.ResourcesGrid.Columns.push(t),(e=this._ScreenObject.Data.Tables[4].filter((function(e){return"MachineDim1"==e.Name}))).length>0&&!r.e.IsEmpty(e[0].Value)&&r.e.Int(e[0].Value.toString())>5e4){i=r.e.Int(e[0].Value.toString());var u=this._ScreenObject.GetfeatureNames(i.toString());(t=new m.a).Header=u.Tables[0][0].Name.toString(),t.DisplayMember="MachineDim1",t.DataType="LISTBOX",t.CostCenterID=i,t.TypeID=1,t.Width=200,this.ResourcesGrid.Columns.push(t),this.ResourcesGrid.TableColumns.push("MachineDim1"),this.ResourcesGrid.TableColumns.push("MachineDim1_Key")}if((e=this._ScreenObject.Data.Tables[4].filter((function(e){return"MachineDim2"==e.Name}))).length>0&&!r.e.IsEmpty(e[0].Value)&&r.e.Int(e[0].Value.toString())>5e4){i=r.e.Int(e[0].Value.toString());var c=this._ScreenObject.GetfeatureNames(i.toString());(t=new m.a).Header=c.Tables[0][0].Name.toString(),t.DisplayMember="MachineDim2",t.DataType="LISTBOX",t.CostCenterID=i,t.TypeID=1,t.Width=200,this.ResourcesGrid.Columns.push(t),this.ResourcesGrid.TableColumns.push("MachineDim2"),this.ResourcesGrid.TableColumns.push("MachineDim2_Key")}(t=new m.a).Header="Incl. in Final Cost",t.ValueBinding="IncludeinFinal",t.ValueMember="Value",t.DisplayMember="Name",t.DataType="ComboBox",t.ComboData=n,(e=this._ScreenObject.Data.Tables[0].filter((function(e){return"PRD_BOMResources"==e.SysTableName&&"IncInFinalCost"==e.SysColumnName}))).length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):107,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(a.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.ResourcesGrid.Columns.push(t),(t=new m.a).Header="Incl. in Stage Cost",t.ValueBinding="IncludeinStage",t.DataType="ComboBox",t.ValueMember="Value",t.DisplayMember="Name",t.ComboData=n,(e=this._ScreenObject.Data.Tables[0].filter((function(e){return"PRD_BOMResources"==e.SysTableName&&"IncInStageCost"==e.SysColumnName}))).length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):114,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(a.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.ResourcesGrid.Columns.push(t),this.ResourcesGrid.TableColumns.push("Sno"),this.ResourcesGrid.TableColumns.push("Machine"),this.ResourcesGrid.TableColumns.push("Machine_Key"),this.ResourcesGrid.TableColumns.push("Hrs"),this.ResourcesGrid.TableColumns.push("Value"),this.ResourcesGrid.TableColumns.push("BOMResourceID"),this.ResourcesGrid.TableColumns.push("IncludeinStage"),this.ResourcesGrid.TableColumns.push("IncludeinFinal"),this.OutputGrid=new I.a,this.OutputGrid.Table=[],this.OutputGrid.Columns=[],this.OutputGrid.CellEditEnding.Subscribe(this,"OnCellEditEnding"),this.OutputGrid.BeginEdit.Subscribe(this,"onBeginEdit"),this.OutputGrid.CanUserAddRows=!0,this.OutputGrid.CanUserDeleteRows=!0,this.OutputGrid.Height=230,this.OutputGrid.Width="880",(t=new m.a).Header="#",t.DisplayMember="Sno",t.DataType="TextBlock",t.Width=23,t.IsVisible=!0,t.ReadOnly=!0,this.OutputGrid.Columns.push(t),(t=new m.a).Header=s.a.GetResource("BOM_ProductCOde"),t.DisplayMember="ProductCode",t.ValueMember="ProductName_Key",t.DataType="LISTBOX",t.CostCenterID=3,t.TypeID=100,(e=this._ScreenObject.Data.Tables[0].filter((function(e){return"PRD_BOMProducts"==e.SysTableName&&"ProductCode"==e.SysColumnName&&2==e.LinkData}))).length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):200,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(a.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.OutputGrid.Columns.push(t),(t=new m.a).Header=s.a.GetResource("BOM_ProductName"),t.DisplayMember="ProductName",t.ValueMember="ProductName_Key",t.DataType="LISTBOX",t.CostCenterID=3,t.TypeID=10,(e=this._ScreenObject.Data.Tables[0].filter((function(e){return"PRD_BOMProducts"==e.SysTableName&&"ProductID"==e.SysColumnName&&2==e.LinkData}))).length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):220,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(a.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.OutputGrid.Columns.push(t),(t=new m.a).Header="Qty",t.DisplayMember="Qty",t.DataType="INT",(e=this._ScreenObject.Data.Tables[0].filter((function(e){return"PRD_BOMProducts"==e.SysTableName&&"Quantity"==e.SysColumnName&&2==e.LinkData}))).length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):90,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(a.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),s.a.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=s.a.SessionManager.Preferences.DecimalsinQty&&(t.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinQty),this.OutputGrid.Columns.push(t),(t=new m.a).Header=s.a.GetResource("UOM"),t.DisplayMember="UOM",t.ValueMember="UOM_Key",t.DataType="LISTBOX",t.CostCenterID=11,t.TypeID=1,(e=this._ScreenObject.Data.Tables[0].filter((function(e){return"PRD_BOMProducts"==e.SysTableName&&"UOMID"==e.SysColumnName&&2==e.LinkData}))).length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):100,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(a.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),this.OutputGrid.Columns.push(t),(t=new m.a).Header="UnitPrice",t.DisplayMember="UnitPrice",t.DataType="FLOAT",(e=this._ScreenObject.Data.Tables[0].filter((function(e){return"PRD_BOMProducts"==e.SysTableName&&"UnitPrice"==e.SysColumnName&&2==e.LinkData}))).length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):100,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(a.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),s.a.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=s.a.SessionManager.Preferences.DecimalsinRate&&(t.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinRate),this.OutputGrid.Columns.push(t),(t=new m.a).Header="Value",t.DisplayMember="Value",t.DataType="FLOAT",(e=this._ScreenObject.Data.Tables[0].filter((function(e){return"PRD_BOMProducts"==e.SysTableName&&"Value"==e.SysColumnName&&2==e.LinkData}))).length>0&&(t.Width=""!=r.e.String(e[0].UIWidth)?parseInt(e[0].UIWidth):100,t.IsVisible=""==r.e.String(e[0].IsVisible)||Object(a.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString()),s.a.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=s.a.SessionManager.Preferences.DecimalsinRate&&(t.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinRate),this.OutputGrid.Columns.push(t),this.OutputGrid.TableColumns.push("Sno"),this.OutputGrid.TableColumns.push("ProductCode"),this.OutputGrid.TableColumns.push("ProductName"),this.OutputGrid.TableColumns.push("ProductName_Key"),this.OutputGrid.TableColumns.push("Qty"),this.OutputGrid.TableColumns.push("UnitPrice"),this.OutputGrid.TableColumns.push("Value"),this.OutputGrid.TableColumns.push("BOMProductID"),this.OutputGrid.TableColumns.push("UOM_Key"),this.OutputGrid.TableColumns.push("UOM"),this.FillEmptyRows(),this.MStatus.Items.push(d.d.ComboBoxItems_2("Active","1")),this.MStatus.Items.push(d.d.ComboBoxItems_2("InActive","2"))}},{key:"FillEmptyRows",value:function(){for(var e=0;e<10;e++)this.InputGrid.addEmptyRow();for(var t=0;t<10;t++)this.ExpenseGrid.addEmptyRow();for(var i=0;i<10;i++)this.ResourcesGrid.addEmptyRow();for(var s=0;s<10;s++)this.OutputGrid.addEmptyRow();this.UpdateSequence()}},{key:"ValidateGrids",value:function(){var e=0,t=!0,i=this.ScreenObject.Data.Tables[4].filter((function(e){return"DontSaveIf_QtyIsZero"==e.Name}));i.length>0&&(t=r.e.DoubleBool(i[0].Value.toString()));for(var s=0;s<this.OutputGrid.Table.length;s++)if(!r.e.IsEmpty(this.OutputGrid.Table[s].ProductName_Key)&&parseInt(this.OutputGrid.Table[s].ProductName_Key.toString())>0){if(""==r.e.String(this.OutputGrid.Table[s].Qty)||0==parseFloat(r.e.String(this.OutputGrid.Table[s].Qty)))return"Enter Output product Qty at Row :"+(s+1).toString();e++}if(0==e&&!confirm("Output products not defined.\nDo you want to continue?"))return"Output products not defined.";for(var n=0;n<this.InputGrid.Table.length;n++)if(!r.e.IsEmpty(this.InputGrid.Table[n].ProductName_Key)&&parseInt(this.InputGrid.Table[n].ProductName_Key.toString())>0&&(""==r.e.String(this.InputGrid.Table[n].Qty)||0==parseFloat(r.e.String(this.InputGrid.Table[n].Qty))&&t))return"Enter Input product Qty at Row :"+(n+1).toString();for(var a=0;a<this.ExpenseGrid.Table.length;a++)if(r.e.IsEmpty(this.ExpenseGrid.Table[a].AccountName_Key))if(r.e.IsEmpty(this.ExpenseGrid.Table[a].Expense_Key))if(r.e.IsEmpty(this.ExpenseGrid.Table[a].Value))if(r.e.IsEmpty(this.ExpenseGrid.Table[a].Name));else{if(r.e.IsEmpty(this.ExpenseGrid.Table[a].AccountName_Key))return"Incomplete Expenses Information at Row :"+(a+1).toString();if(r.e.IsEmpty(this.ExpenseGrid.Table[a].Expense_Key))return"Incomplete Expenses Information at Row :"+(a+1).toString();if(r.e.IsEmpty(this.ExpenseGrid.Table[a].Value))return"Incomplete Expenses Information at Row :"+(a+1).toString()}else{if(r.e.IsEmpty(this.ExpenseGrid.Table[a].AccountName_Key))return"Incomplete Expenses Information at Row :"+(a+1).toString();if(r.e.IsEmpty(this.ExpenseGrid.Table[a].Expense_Key))return"Incomplete Expenses Information at Row :"+(a+1).toString();if(r.e.IsEmpty(this.ExpenseGrid.Table[a].Name))return"Incomplete Expenses Information at Row :"+(a+1).toString()}else{if(r.e.IsEmpty(this.ExpenseGrid.Table[a].AccountName_Key))return"Incomplete Expenses Information at Row :"+(a+1).toString();if(r.e.IsEmpty(this.ExpenseGrid.Table[a].Value))return"Incomplete Expenses Information at Row :"+(a+1).toString();if(r.e.IsEmpty(this.ExpenseGrid.Table[a].Name))return"Incomplete Expenses Information at Row :"+(a+1).toString()}else{if(r.e.IsEmpty(this.ExpenseGrid.Table[a].Expense_Key))return"Incomplete Expenses Information at Row :"+(a+1).toString();if(r.e.IsEmpty(this.ExpenseGrid.Table[a].Value))return"Incomplete Expenses Information at Row :"+(a+1).toString();if(r.e.IsEmpty(this.ExpenseGrid.Table[a].Name))return"Incomplete Expenses Information at Row :"+(a+1).toString()}return""}},{key:"OnSaveBOM",value:function(e){var t,i=this;if("Save"==e.toString())try{var n;if(this.DisplayMessage="",0==this.Stage.SelectedValue)return this.DisplayMessage="Please select stage",void(this.MessageVisibility=!0);if(this.TreeObject.BOMNodes.forEach((function(e){if(i.IsStageExists(i.Stage.SelectedValue,e))return i.DisplayMessage="Stage already exists",void(i.MessageVisibility=!0)})),this.StageNodeID!=this.Stage.SelectedValue){var o=s.a.common.GetCodeName(this.Stage.CCID,this.Stage.SelectedValue).Tables[0];null!=o&&o.length>0&&(this.Code=o[0].Code.toString(),this.Name=o[0].Name.toString())}if(n=this.ValidateGrids(),!r.e.IsEmpty(n))return this.DisplayMessage=n,void(this.MessageVisibility=!0);this.CancelVisible&&(null!=this.Parent?this.Parent.Childrens.push(this):this.TreeObject.BOMNodes.push(this)),this.TreeObject.RefreshBOMTree(),null==this.TreeObject.Tree.SelectedNode&&(this.TreeObject.Tree.SelectedNode=this.TreeObject.Tree[0]),(null===(t=this.TreeObject.Tree.treecomp)||void 0===t?void 0:t.angularGrid)&&(this.TreeObject.Tree.treecomp.gridObj.getData().setItems(this.TreeObject.Tree.Rows),this.TreeObject.Tree.treecomp.gridObj.getData().refresh(),this.TreeObject.Tree.treecomp.gridObj.invalidate()),s.a.page.HideDialog()}catch(n){Logger.ErrorLog("MultiBOMAddEditViewModel:: OnSAVE"+n.stack)}else if("Cancel"==e)s.a.page.HideDialog();else if("Pickrate"==e){if("AvgRate"==this.Pickrate.CheckedItem.DBColumnName){var l=new Array,u=0;s.a.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise AverageRate")&&r.e.Int(s.a.SessionManager.Preferences["Maintain Dimensionwise AverageRate"])>5e4&&(u=r.e.Int(s.a.SessionManager.Preferences["Maintain Dimensionwise AverageRate"]),l.push(u)),s.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&Object(a.j)(s.a.SessionManager.Preferences.EnableLocationWise)&&s.a.SessionManager.Preferences.ContainsKey("Location AverageRate")&&Object(a.j)(s.a.SessionManager.Preferences["Location AverageRate"])&&l.push(50002),s.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&Object(a.j)(s.a.SessionManager.Preferences.EnableDivisionWise)&&s.a.SessionManager.Preferences.ContainsKey("Division AverageRate")&&Object(a.j)(s.a.SessionManager.Preferences["Division AverageRate"])&&l.push(50001);var d="";d+="<PXML>";var c="";null!=this.TreeObject.Location&&this.TreeObject.Location.SelectedValue>0&&l.Contains(50002)&&(c+=" and dcCCNID2="+this.TreeObject.Location.SelectedValue.toString()+" "),null!=this.TreeObject.Division&&this.TreeObject.Division.SelectedValue>0&&l.Contains(50001)&&(c+=" and dcCCNID1="+this.TreeObject.Division.SelectedValue.toString()+" ");for(var h=0;h<this.InputGrid.Table.length;h++)if(!r.e.IsEmpty(this.InputGrid.Table[h].ProductName_Key)){var p=1;0==(p=r.e.Double(this.InputGrid.Table[h].Qty))&&(p=1),d+="<Row ",d+=' ProductID="'+this.InputGrid.Table[h].ProductName_Key.toString()+'" ',d+=' QTY="'+p+'" ',d+=' DETAILSID="0" ',d+=' avgwhere="'+c+'" ></Row> '}d+="</PXML>";var I=this.ScreenObject.GetReconcileAvgRate(d.toString(),new Date);if(null!=I&&I.Tables.length>0&&I.Columns[0].Contains("invid"))for(var b=function(e){if(!r.e.IsEmpty(i.InputGrid.Table[e].ProductName_Key)){var t=I.Tables[0].filter((function(t){return t.PID==i.InputGrid.Table[e].ProductName_Key.toString()}));t.length>0&&(i.InputGrid.Table[e].UnitPrice=r.e.IsEmpty(t[0].AvgRate)?0:r.e.String(t[0].AvgRate),i.CalculateTotals(i.InputGrid.Table[e]),i.InputGrid.updateRow(i.InputGrid.Table[e]))}},m=0;m<this.InputGrid.Table.length;m++)b(m)}else{var g="<XML>",S="";null!=this.TreeObject.Location&&this.TreeObject.Location.SelectedValue>0&&(g+='<Row CostCenterID="50002" NODEID="'+this.TreeObject.Location.SelectedValue.toString()+'" />'),null!=this.TreeObject.Division&&this.TreeObject.Division.SelectedValue>0&&(g+='<Row CostCenterID="50001" NODEID="'+this.TreeObject.Division.SelectedValue.toString()+'" />'),g+="</XML>";for(var D=0;D<this.InputGrid.Table.length;D++)r.e.IsEmpty(this.InputGrid.Table[D].ProductName_Key)||(S+=this.InputGrid.Table[D].ProductName_Key.toString()+",");S.length>1&&(S=S.substr(0,S.length-1));var T=this.ScreenObject.GetProductDetails(S,g);if(null!=T&&T.Tables.length>0&&T.Columns[0].Contains("ProductID"))for(var C=null,O=function(e){r.e.IsEmpty(i.InputGrid.Table[e].ProductName_Key)||(C=null,"Master"==i.Pickrate.CheckedItem.DBColumnName?T.Tables.length>0&&T.Tables[0].filter((function(t){return t.ProductID==i.InputGrid.Table[e].ProductName_Key.toString()})).length>0&&(C=T.Tables[0].filter((function(t){return t.ProductID==i.InputGrid.Table[e].ProductName_Key.toString()}))):"Chart"==i.Pickrate.CheckedItem.DBColumnName&&(T.Tables.length>1&&T.Tables[1].filter((function(t){return t.ProductID==i.InputGrid.Table[e].ProductName_Key.toString()})).length>0?C=T.Tables[1].filter((function(t){return t.ProductID==i.InputGrid.Table[e].ProductName_Key.toString()})):T.Tables.length>2&&T.Tables[2].filter((function(t){return t.ProductID==i.InputGrid.Table[e].ProductName_Key.toString()})).length>0&&(C=T.Tables[2].filter((function(t){return t.ProductID==i.InputGrid.Table[e].ProductName_Key.toString()})))),i.InputGrid.Table[e].UnitPrice=null!=C&&C.length>0&&!r.e.IsEmpty(C[0].PurchaseRate)?r.e.String(C[0].PurchaseRate):0,i.CalculateTotals(i.InputGrid.Table[e]),i.InputGrid.updateRow(i.InputGrid.Table[e]))},M=0;M<this.InputGrid.Table.length;M++)O(M)}if(this.TreeObject.CalcOutputProductRate)for(var y=0;y<this.OutputGrid.Table.length;y++)if(!r.e.IsEmpty(this.OutputGrid.Table[y].ProductName_Key)&&parseInt(this.OutputGrid.Table[y].ProductName_Key.toString())>0){this.OutputGrid.Table[y].Value=parseInt(this.OutputGrid.Table[y].ProductName_Key.toString())==this.TreeObject.Product.SelectedValue?this.CalcValue(!0):this.CalcValue(!1),this.CalculateTotals(this.OutputGrid.Table[y]),this.OutputGrid.updateRow(this.OutputGrid.Table[y]);break}}}},{key:"IsStageExists",value:function(e,t){if(t!=this&&t.Stage.SelectedValue==e)return!0;if(t.Childrens.length>0)for(var i=0;i<t.Childrens.length;i++)if(this.IsStageExists(e,t.Childrens[i]))return!0;return!1}},{key:"UpdateSequence",value:function(){var e=this;this.SNo=1,this.InputGrid.Table.forEach((function(t){t.Sno=e.SNo++})),this.SNo=1,this.OutputGrid.Table.forEach((function(t){t.Sno=e.SNo++})),this.SNo=1,this.ExpenseGrid.Table.forEach((function(t){t.Sno=e.SNo++})),this.SNo=1,this.ResourcesGrid.Table.forEach((function(t){t.Sno=e.SNo++})),this.InputGrid.refreshDataView(),this.OutputGrid.refreshDataView(),this.ExpenseGrid.refreshDataView(),this.ResourcesGrid.refreshDataView()}},{key:"CalculateFooter",value:function(e){var t,i=0,n=0,a="2";if(s.a.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&!r.e.IsEmpty(s.a.SessionManager.Preferences.DecimalsinRate)&&(a=s.a.SessionManager.Preferences.DecimalsinRate),this.ExpenseYes){for(var o=0;o<this.ExpenseGrid.Table.length;o++)r.e.IsEmpty(this.ExpenseGrid.Table[o].Value)||r.e.IsEmpty(this.ExpenseGrid.Table[o].AccountName_Key)||r.e.IsEmpty(this.ExpenseGrid.Table[o].Expense_Key)||(i+=parseFloat(this.ExpenseGrid.Table[o].Value.toString()));null!=(t=this.ExpenseGrid.Columns.find((function(e){return"Value"==e.DisplayMember})))&&(t.footer=i.ToString("N"+a))}else if(this.InputYes){for(var l=0;l<this.InputGrid.Table.length;l++)r.e.IsEmpty(this.InputGrid.Table[l].ProductName_Key)||(r.e.IsEmpty(this.InputGrid.Table[l].Qty)||(n+=parseFloat(this.InputGrid.Table[l].Qty.toString())),r.e.IsEmpty(this.InputGrid.Table[l].Value)||(i+=parseFloat(this.InputGrid.Table[l].Value.toString())));null!=(t=this.InputGrid.Columns.find((function(e){return"Value"==e.DisplayMember})))&&(t.footer=i.ToString("N"+a)),null!=(t=this.InputGrid.Columns.find((function(e){return"Qty"==e.DisplayMember})))&&(t.footer=n.ToString("N"+a))}else if(this.ResourceYes){for(var u=0;u<this.ResourcesGrid.Table.length;u++)r.e.IsEmpty(this.ResourcesGrid.Table[u].Value)||r.e.IsEmpty(this.ResourcesGrid.Table[u].Machine_Key)||(i+=parseFloat(this.ResourcesGrid.Table[u].Value.toString()));null!=(t=this.ResourcesGrid.Columns.find((function(e){return"Value"==e.DisplayMember})))&&(t.footer=i.ToString("N"+a))}else if(this.OutputYes){for(var d=0;d<this.OutputGrid.Table.length;d++)r.e.IsEmpty(this.OutputGrid.Table[d].ProductName_Key)||(r.e.IsEmpty(this.OutputGrid.Table[d].Qty)||(n+=parseFloat(this.OutputGrid.Table[d].Qty.toString())),r.e.IsEmpty(this.OutputGrid.Table[d].Value)||(i+=parseFloat(this.OutputGrid.Table[d].Value.toString())));null!=(t=this.OutputGrid.Columns.find((function(e){return"Value"==e.DisplayMember})))&&(t.footer=i.ToString("N"+a)),null!=(t=this.OutputGrid.Columns.find((function(e){return"Qty"==e.DisplayMember})))&&(t.footer=n.ToString("N"+a))}this.InputGrid.UpdateFooter(),this.ExpenseGrid.UpdateFooter(),this.ResourcesGrid.UpdateFooter(),this.OutputGrid.UpdateFooter()}},{key:"changeVal",value:function(){this.InputYes=!1,this.OutputYes=!1,this.ExpenseYes=!1,this.ResourceYes=!1}},{key:"FindRow",value:function(e){var t=this.InputGrid.Table.find((function(t){return t==e}));t?(this.changeVal(),this.InputYes=!0):(t=this.OutputGrid.Table.find((function(t){return t==e})))?(this.changeVal(),this.OutputYes=!0):(t=this.ExpenseGrid.Table.find((function(t){return t==e})))?(this.changeVal(),this.ExpenseYes=!0):(t=this.ResourcesGrid.Table.find((function(t){return t==e})))&&(this.changeVal(),this.ResourceYes=!0)}},{key:"OnCellEditEnding",value:function(e){if("DataGridComboBoxColumn"!=e.column.className){var t=e.item,i=e.column.field;if(this.FindRow(t),Object.keys(t).Contains("Machine_Key")){if("Machine"==i&&!r.e.IsEmpty(t.Machine_Key)){if(this.MachineID==parseInt(t.Machine_Key.toString()))return;if(t.Value=this.objBOM.getMachineCostHr(this.MachineCCID,parseInt(t.Machine_Key)),""==r.e.String(t.Options)){var s=this.ResourcesGrid.Table.indexOf(t);s>0&&!r.e.IsEmpty(this.ResourcesGrid.Table[s-1].Options)&&(t.Options=this.ResourcesGrid.Table[s-1].Options),this.ResourcesGrid.updateRow(t)}}}else if(this.InputYes||this.OutputYes){if(("ProductCode"==i||"ProductName"==i)&&!r.e.IsEmpty(t.ProductName_Key)&&t.ProductName_Key.toString()!=this.PrevValue){var n=0;Object.keys(t).Contains("UOM")&&"UOM"==i&&!r.e.IsEmpty(t.UOM_Key)&&(n=parseInt(t.UOM_Key.toString()));var a=!1;"AvgRate"!=this.Pickrate.CheckedItem.DBColumnName||this.OutputYes||(a=!0);var l=o.a.GetProductTypeDetails(parseInt(t.ProductName_Key.toString()),this.Date.Date,n,76,"",a,!1,!1,!1,!1,!1,!1,!1,!1);""==r.e.String(t.Qty)&&(t.Qty="1"),l.Tables.length>0&&l.Columns[0].Contains("uomid")&&!r.e.IsEmpty(l.Tables[0][0].uomid)&&(t.UOM=l.Tables[0][0].UnitName.toString(),t.UOM_Key=l.Tables[0][0].uomid.toString(),this.InputGrid.Table==t.Table&&("AvgRate"==this.Pickrate.CheckedItem.DBColumnName&&l.Columns[0].Contains("AvgRate")&&!r.e.IsEmpty(l.Tables[0][0].AvgRate)&&(t.UnitPrice=l.Tables[0][0].AvgRate.toString()),"Master"==this.Pickrate.CheckedItem.DBColumnName&&l.Tables.length>0&&l.Tables[0].length>0&&l.Columns[0].Contains("PurchaseRate")&&!r.e.IsEmpty(l.Tables[0][0].PurchaseRate)&&(t.UnitPrice=l.Tables[0][0].PurchaseRate.toString()),"Chart"==this.Pickrate.CheckedItem.DBColumnName&&l.Tables.length>3&&l.Tables[3].length>0&&l.Columns[3].Contains("PurchaseRate")&&!r.e.IsEmpty(l.Tables[3][0].PurchaseRate)&&(t.UnitPrice=l.Tables[3][0].PurchaseRate.toString())))}this.CalculateTotals(t),this.InputYes?this.InputGrid.updateRow(t):this.OutputYes&&this.OutputGrid.updateRow(t)}if(this.TreeObject.CalcOutputProductRate)for(var u=0;u<this.OutputGrid.Table.length;u++)if(!r.e.IsEmpty(this.OutputGrid.Table[u].ProductName_Key)&&parseInt(this.OutputGrid.Table[u].ProductName_Key.toString())>0){this.OutputGrid.Table[u].Value=parseInt(this.OutputGrid.Table[u].ProductName_Key.toString())==this.TreeObject.Product.SelectedValue?this.CalcValue(!0):this.CalcValue(!1),this.CalculateTotals(this.OutputGrid.Table[u]),this.OutputGrid.updateRow(this.OutputGrid.Table[u]);break}this.CalculateFooter(t.Table)}}},{key:"CalcValue",value:function(e){for(var t=0,i=0,s=0;s<this.InputGrid.Table.length;s++)!r.e.IsEmpty(this.InputGrid.Table[s].ProductName_Key)&&parseInt(this.InputGrid.Table[s].ProductName_Key.toString())>0&&!r.e.IsEmpty(this.InputGrid.Table[s].Value)&&("1"==r.e.String(this.InputGrid.Table[s].IncludeinFinal)&&(t+=parseFloat(this.InputGrid.Table[s].Value.toString())),"1"==r.e.String(this.InputGrid.Table[s].IncludeinStage)&&(i+=parseFloat(this.InputGrid.Table[s].Value.toString())));for(var n=0;n<this.ExpenseGrid.Table.length;n++)r.e.IsEmpty(this.ExpenseGrid.Table[n].AccountName_Key)||r.e.IsEmpty(this.ExpenseGrid.Table[n].Expense_Key)||r.e.IsEmpty(this.ExpenseGrid.Table[n].Value)||("1"==r.e.String(this.ExpenseGrid.Table[n].IncludeinFinal)&&(t+=parseFloat(this.ExpenseGrid.Table[n].Value.toString())),"1"==r.e.String(this.ExpenseGrid.Table[n].IncludeinStage)&&(i+=parseFloat(this.ExpenseGrid.Table[n].Value.toString())));for(var a=0;a<this.ResourcesGrid.Table.length;a++)r.e.IsEmpty(this.ResourcesGrid.Table[a].Machine_Key)||r.e.IsEmpty(this.ResourcesGrid.Table[a].Value)||r.e.IsEmpty(this.ResourcesGrid.Table[a].Hrs)||("1"==r.e.String(this.ResourcesGrid.Table[a].IncludeinFinal)&&(t+=parseFloat(this.ResourcesGrid.Table[a].Value.toString())*parseFloat(this.ResourcesGrid.Table[a].Hrs.toString())),"1"==r.e.String(this.ResourcesGrid.Table[a].IncludeinStage)&&(i+=parseFloat(this.ResourcesGrid.Table[a].Value.toString())*parseFloat(this.ResourcesGrid.Table[a].Hrs.toString())));if(e){for(var o=0;o<this.TreeObject.BOMNodes.length;o++){var l=this.TreeObject.BOMNodes[o];if(l!=this){for(var u=0;u<l.InputGrid.Table.length;u++)!r.e.IsEmpty(l.InputGrid.Table[u].ProductName_Key)&&parseInt(l.InputGrid.Table[u].ProductName_Key.toString())>0&&!r.e.IsEmpty(l.InputGrid.Table[u].Value)&&"1"==r.e.String(l.InputGrid.Table[u].IncludeinFinal)&&(t+=parseFloat(l.InputGrid.Table[u].Value.toString()));for(var d=0;d<l.ExpenseGrid.Table.length;d++)r.e.IsEmpty(l.ExpenseGrid.Table[d].AccountName_Key)||r.e.IsEmpty(l.ExpenseGrid.Table[d].Expense_Key)||r.e.IsEmpty(l.ExpenseGrid.Table[d].Value)||"1"==r.e.String(l.ExpenseGrid.Table[d].IncludeinFinal)&&(t+=parseFloat(l.ExpenseGrid.Table[d].Value.toString()));for(var c=0;c<l.ResourcesGrid.Table.length;c++)r.e.IsEmpty(l.ResourcesGrid.Table[c].Machine_Key)||r.e.IsEmpty(l.ResourcesGrid.Table[c].Value)||r.e.IsEmpty(l.ResourcesGrid.Table[c].Hrs)||"1"==r.e.String(l.ResourcesGrid.Table[c].IncludeinFinal)&&(t+=parseFloat(l.ResourcesGrid.Table[c].Value.toString())*parseFloat(l.ResourcesGrid.Table[c].Hrs.toString()))}}return t.toString()}return i.toString()}},{key:"CalculateTotals",value:function(e){var t=new S.a,i=new D.c;i.setFieldDetails("RATE",1,1,"",1,!1,!1),t.push("RATE",i),(i=new D.c).setFieldDetails("QTY",4,1,"",1,!1,!1),t.push("QTY",i),(i=new D.c).setFieldDetails("Value",4,1,"",1,!1,!1),t.push("Value",i),r.e.IsEmpty(e.UnitPrice)?t.RATE.setFieldValue(0):t.RATE.setFieldValue(e.UnitPrice),r.e.IsEmpty(e.Qty)?t.QTY.setFieldValue(0):t.QTY.setFieldValue(e.Qty),r.e.IsEmpty(e.Value)?t.Value.setFieldValue(0):t.Value.setFieldValue(e.Value);var n=t;this.OutputGrid.Table.find((function(t){return t==e}))&&this.TreeObject.CalcOutputProductRate?e.UnitPrice=s.a.eval.EvaluateExpression("Value/QTY",n).toString():e.Value=s.a.eval.EvaluateExpression("QTY*RATE",n).toString()}},{key:"onBeginEdit",value:function(e){var t=this,i=e.args.item,s=e.args.column,n=s.DgCol;if(r.e.IsEmpty(n.ValueBinding),r.e.IsEmpty(n.ValueBinding),Object.keys(i).Contains("Machine_Key"))this.MachineID=r.e.IsEmpty(i.Machine_Key)?0:parseInt(i.Machine_Key.toString());else{var a=e.args;if("DataGridPactListBoxColumn"==s.className){var o=a.model;if(11==o.CostCenterID){var l="";Object.keys(i).Contains("ProductName_Key")&&(l=i.ProductName_Key.toString());var u=" (BaseID IN ";u+=" (SELECT     BaseID ",u=(u+=" FROM          COM_UOM AS COM_UOM_1 with(nolock) ")+" WHERE      (UOMID =(select UOMID from inv_product with(nolock) where productid="+l+") ))) ",""==l&&(u=" (BaseID IN ",u+=" (SELECT BaseID ",u+=" FROM COM_UOM AS COM_UOM_1 with(nolock) ",u+=" WHERE (UOMID =-1 ))) "),o.FilterCondition=u}else o.CostCenterID==this.Stage.CCID&&(o.FilterCondition="a.NodeID in(-1",null!=this.Parent?this.Parent.Childrens.forEach((function(e){e!=t&&e.Stage.SelectedValue>0&&!r.e.IsEmpty(i.ProductName_Key)&&e.OutputGrid.Table.filter((function(e){return e.ProductName_Key==i.ProductName_Key.toString()})).length>0&&(o.FilterCondition+=","+e.Stage.SelectedValue)})):this.TreeObject.BOMNodes.forEach((function(e){e!=t&&e.Stage.SelectedValue>0&&!r.e.IsEmpty(i.ProductName_Key)&&e.OutputGrid.Table.filter((function(e){return e.ProductName_Key==i.ProductName_Key.toString()})).length>0&&(o.FilterCondition+=","+e.Stage.SelectedValue)})),o.FilterCondition+=")");3==o.CostCenterID&&"ProductName_Key"==o.SelectedValueBinding&&(this.PrevValue=r.e.String(i.ProductName_Key)),3==o.CostCenterID&&"ProductName_Key"==o.SelectedValueBinding&&this.FilterCCID>0&&Object.keys(i).Contains("FilterOn_Key")&&!r.e.IsEmpty(i.FilterOn_Key)&&parseInt(i.FilterOn_Key.toString())>0&&(3==this.FilterCCID?o.Where=" ParentID="+i.FilterOn_Key.toString()+" ":50006==this.FilterCCID?o.Where=" CategoryID="+i.FilterOn_Key.toString()+" ":50004==this.FilterCCID?o.Where=" DepartmentID="+i.FilterOn_Key.toString()+" ":this.FilterCCID>5e4&&(o.Where=" a.ProductID IN (select NodeID from COM_CCCCData with(nolock) where CostCenterID=3 and ",o.Where+=" CCNID"+this.FilterCCID.toString()+"="+i.FilterOn_Key.toString()+" )"))}}}},{key:"OnCustomizeExtraFields",value:function(e){}},{key:"LoadBOM",value:function(e){var t=this;this.InputGrid.Table.Clear(),this.ExpenseGrid.Table.Clear(),this.ResourcesGrid.Table.Clear(),this.OutputGrid.Table.Clear(),e.Tables[1].filter((function(e){return e.StageID==t.StageID})).forEach((function(e){var i=t.InputGrid.NewRow();i.ProductCode=e.ProductCOde.toString(),i.ProductName=e.ProductName.toString(),i.ProductName_Key=e.ProductID.toString(),i.Qty=e.Quantity.toString(),Object.keys(e).Contains("UOM")&&(i.UOM=e.UOM.toString()),i.UOM_Key=e.UOMID.toString(),i.UnitPrice=e.UnitPrice.toString(),i.Wastage=e.Wastage.toString(),i.Value=e.Value.toString(),i.BOMProductID=e.BOMProductID.toString(),i.IncludeinFinal=!r.e.IsEmpty(e.IncInFinalCost)&&Object(a.j)(e.IncInFinalCost.toString())?"1":"0",i.IncludeinStage=!r.e.IsEmpty(e.IncInStageCost)&&Object(a.j)(e.IncInStageCost.toString())?"1":"0",t.InputGrid.TableColumns.Contains("FilterOn_Key")&&!r.e.IsEmpty(e.FilterOn)&&(i.FilterOn_Key=e.FilterOn.toString()),t.InputGrid.TableColumns.Contains("Stage_Key")&&!r.e.IsEmpty(e.AutoStage)&&(i.Stage_Key=e.AutoStage.toString()),i.Remarks=e.Remarks.toString(),t.InputGrid.addRow(i)})),this.changeVal(),this.InputYes=!0,this.CalculateFooter(this.InputGrid.Table),e.Tables[2].filter((function(e){return e.StageID==t.StageID})).forEach((function(e){var i=t.ExpenseGrid.NewRow();i.Name=e.Name.toString(),i.AccountName=e.CRAccountName.toString(),r.e.IsEmpty(e.CreditAccountID)||(i.AccountName_Key=e.CreditAccountID.toString()),i.Expense=e.DRAccountName.toString(),r.e.IsEmpty(e.DebitAccountID)||(i.Expense_Key=e.DebitAccountID.toString()),i.Value=e.Value.toString(),i.ExpenseID=e.ExpenseID.toString(),i.IncludeinFinal=!r.e.IsEmpty(e.IncInFinalCost)&&Object(a.j)(e.IncInFinalCost.toString())?"1":"0",i.IncludeinStage=!r.e.IsEmpty(e.IncInStageCost)&&Object(a.j)(e.IncInStageCost.toString())?"1":"0",t.ExpenseGrid.addRow(i)})),this.changeVal(),this.ExpenseYes=!0,this.CalculateFooter(this.ExpenseGrid.Table),e.Tables[3].filter((function(e){return e.StageID==t.StageID})).forEach((function(e){var i=t.ResourcesGrid.NewRow();i.Machine=e.ResourceName.toString(),i.Machine_Key=e.ResourceID.toString(),i.Hrs=e.Hours.toString(),i.Value=e.Value.toString(),i.BOMResourceID=e.BOMResourceID.toString(),t.ResourcesGrid.TableColumns.Contains("MachineDim1_Key")&&!r.e.IsEmpty(e.MachineDim1)&&(i.MachineDim1_Key=e.MachineDim1.toString()),t.ResourcesGrid.TableColumns.Contains("MachineDim2_Key")&&!r.e.IsEmpty(e.MachineDim2)&&(i.MachineDim2_Key=e.MachineDim2.toString()),t.ResourcesGrid.TableColumns.Contains("Options")&&r.e.IsEmpty(e.Options)&&(i.Options=e.Options.toString()),i.IncludeinFinal=!r.e.IsEmpty(e.IncInFinalCost)&&Object(a.j)(e.IncInFinalCost.toString())?"1":"0",i.IncludeinStage=!r.e.IsEmpty(e.IncInStageCost)&&Object(a.j)(e.IncInStageCost.toString())?"1":"0",t.ResourcesGrid.addRow(i)})),this.changeVal(),this.ResourceYes=!0,this.CalculateFooter(this.ResourcesGrid.Table),e.Tables[5].filter((function(e){return e.StageID==t.StageID})).forEach((function(e){var i=t.OutputGrid.NewRow();i.ProductCode=e.ProductCode.toString(),i.ProductName=e.ProductName.toString(),i.ProductName_Key=e.ProductID.toString(),i.Qty=e.Quantity.toString(),i.UnitPrice=e.UnitPrice.toString(),i.Value=e.Value.toString(),Object.keys(e).Contains("UnitName")&&(i.UOM=r.e.String(e.UnitName)),r.e.IsEmpty(e.UOMID)||(i.UOM_Key=e.UOMID.toString()),i.BOMProductID=r.e.String(e.BOMProductID),t.OutputGrid.addRow(i)})),this.changeVal(),this.OutputYes=!0,this.CalculateFooter(this.OutputGrid.Table),this.FillEmptyRows(),this.InputGrid.RefreshGrid=this.ExpenseGrid.RefreshGrid=this.ResourcesGrid.RefreshGrid=this.OutputGrid.RefreshGrid=!0}},{key:"ScreenObject",get:function(){return this._ScreenObject}}]),i}(l.b),E=i("LI34"),R=function(e){_inherits(i,e);var t=_createSuper(i);function i(e,n){var l;_classCallCheck(this,i),(l=t.call(this)).BID=0,l.parentid=0,l.iCntBOM=-1,l.objBOM=new T,l._ScreenObject=new o.a,l.Title="",l.Packing=new c.d(27305),l.txtCode=new c.d(555025),l.txtName=new c.d(555026),l.txtCost=new c.d(0),l.txtUsage=new c.d(0),l.txtCapacity=new c.d(0),l.txtEffeciency=new c.d(0),l.Description=new c.d(23903),l.MStatus=new d.e(23898),l.Group=new d.e(23897),l.Location=new h.b(23900),l.Division=new h.b(23901),l.Product=new h.b(23899),l.UOM=new d.e(109),l.FPQty=new c.d(27269),l.Date=new p.a(23902),l.txtDesc=new c.d(23903),l.MoveSelectedBomStageVisibility=!1,l.brush="Red",l.TreeFlds=null,l.BOMNodes=new Array,l.CalcOutputProductRate=!1,l.IsMultiBom=!0,l.ButtonSave=new u.a,Logger.InfoLog("MultiBOMTreeViewModel::Entering MultiBOMTreeViewModel "),l.parentid=n,l.BID=e,l.MessageVisibility=!1,l._ScreenObject.LoadScreen_2(_assertThisInitialized(l),76),l.Product.SelectionChangedCommand.Subscribe(_assertThisInitialized(l),"OnProductChange"),0==e?s.a.SessionManager.HideUnathorizedAccess?l.ButtonSave.Visible=s.a.SessionManager.IsActionAssigned(76,"Create"):l.ButtonSave.Enable=s.a.SessionManager.IsActionAssigned(76,"Create"):(l.ScreenObject.IsEdit=!0,s.a.SessionManager.HideUnathorizedAccess?l.ButtonSave.Visible=s.a.SessionManager.IsActionAssigned(76,"Update"):l.ButtonSave.Enable=s.a.SessionManager.IsActionAssigned(76,"Update"));var I=l.ScreenObject.StaticFields.find((function(e){return 23899==e.DBColumnID}));null!=I?(l.Product.CCID=I.CCID,l.Product.TypeID=I.TypeID,0==l.Product.CCID&&(l.Product.CCID=3),0==l.Product.TypeID&&(l.Product.TypeID=10)):(l.Product.CCID=3,l.Product.TypeID=10),l._ScreenObject.Data.Tables[3].forEach((function(e){l.MStatus.Items.push(d.d.ComboBoxItems_2(e[Object.keys(e)[1]].toString(),e[Object.keys(e)[0]].toString()))})),"1"!=s.a.SessionManager.RoleID&&s.a.SessionManager.IsActionAssigned(76,"Save as UnApproved")&&(l.MStatus.SelectedValue="464",l.MStatus.Visible=!1),l.FPQty.Text="1";var b=l.ScreenObject.Data.Tables[4].filter((function(e){return"CapsLock"==e.Name}));return b.length>0&&Object(a.j)(b[0].Value)&&(l.txtName.IsAllCaps=!0),(b=l.ScreenObject.Data.Tables[4].filter((function(e){return"CapsToFirstLetter"==e.Name}))).length>0&&Object(a.j)(b[0].Value)&&(l.txtName.IsFirstLetterCaps=!0),(b=l.ScreenObject.Data.Tables[4].filter((function(e){return"CalcOutputProductRate"==e.Name}))).length>0&&Object(a.j)(b[0].Value)&&(l.CalcOutputProductRate=!0),(b=l.ScreenObject.Data.Tables[4].filter((function(e){return"BomTreeFields"==e.Name}))).length>0&&!r.e.IsEmpty(b[0].Value)&&(l.TreeFlds=b[0].Value.toString().split(",")),l.InitTree(),l.BOMTreeControl=new y,l.BOMTreeControl.Tree=l.Tree,l.BOMTreeControl.Parent=_assertThisInitialized(l),l.BOMTreeControl.Tree.ClassName="TreeViewModel",l.loadtabs(),l.BID>0?(l.OnLoad(l.BID),l.Title=s.a.GetResource("BOM_EditBOM")):(l.Title=s.a.GetResource("BOM_AddBOM"),l.objBOM.GUID="GUID",l.AutoGenerateCode()),l.DisplayName=l.Title,l.Group.SelectedValue=l.parentid.toString(),null==l.BOMTreeControl.Tree.SelectedNode&&(l.BOMTreeControl.Tree.SelectedNode=l.BOMTreeControl.Tree.Rows[0]),l}return _createClass(i,[{key:"OnNodeSelected",value:function(e){var t,i,n=this;null!=this.SelectedNodeObj&&(null===(t=this.BOMTreeControl.Tree.SelectedNode)||void 0===t?void 0:t.Tag)==this.SelectedNodeObj||(null!=this.SelectedNodeObj&&(null===(i=s.a.page.ActiveTab.grids)||void 0===i?void 0:i.length)>0&&(s.a.page.ActiveTab.grids.Remove(this.SelectedNodeObj.InputGrid),s.a.page.ActiveTab.grids.Remove(this.SelectedNodeObj.ExpenseGrid),s.a.page.ActiveTab.grids.Remove(this.SelectedNodeObj.ResourcesGrid),s.a.page.ActiveTab.grids.Remove(this.SelectedNodeObj.OutputGrid)),this.SelectedNodeObj=null,setTimeout((function(){var e;n.SelectedNodeObj=null===(e=n.BOMTreeControl.Tree.SelectedNode)||void 0===e?void 0:e.Tag}),5))}},{key:"AssignRowColumns",value:function(){var e;e=this._ScreenObject.CustomFields.length;for(var t=0;t<e;t++)this._ScreenObject.CustomFields[t].Row=t/4,this._ScreenObject.CustomFields[t].Column=t%4}},{key:"loadtabs",value:function(){this.AssignRowColumns();for(var e=null,t=null,i=null,s=null,n=null,r=this._ScreenObject.CustomTab.Pages.length-1;r>=0;r--){var a=this._ScreenObject.CustomTab.Pages[r];switch(a.Name){case"Production Method":n=a;break;case"Raw Materials":e=a;break;case"Expenses":t=a;break;case"Machines":i=a;break;case"Other Outputs":s=a;break;case"Stages":a.Fields.push(this.BOMTreeControl.Tree)}}this.ScreenObject.CustomTab.Pages.Remove(e),this.ScreenObject.CustomTab.Pages.Remove(n),this.ScreenObject.CustomTab.Pages.Remove(t),this.ScreenObject.CustomTab.Pages.Remove(i),this.ScreenObject.CustomTab.Pages.Remove(s)}},{key:"InitTree",value:function(){this.Tree=new M.a,this.Tree.ColumnsSource=new Array;var e="STRING";if(null!=this.TreeFlds){var t=1;if(this.TreeFlds.Contains("ProductCode")&&this.TreeFlds.Contains("ProductName")){var i=new G.a;i.DataType=e,i.HeaderText="Code-Name",i.DisplayMember="Text[0]",i.DisplayIndex="0",i.width="240",this.Tree.ColumnsSource.push(i)}else if(this.TreeFlds.Contains("ProductCode")){var s=new G.a;s.DataType=e,s.HeaderText="Code",s.DisplayMember="Text[0]",s.DisplayIndex="0",s.width="120",this.Tree.ColumnsSource.push(s)}else{var n=new G.a;n.DataType=e,n.HeaderText="Name",n.DisplayMember="Text[0]",n.DisplayIndex="0",n.width="120",this.Tree.ColumnsSource.push(n)}var r=0;if(this.TreeFlds.Contains("Qty")||this.TreeFlds.Contains("Hrs")){var a=new G.a;a.DataType=e,a.HeaderText="Qty/Hrs",r=t++,a.DisplayMember="Text["+r+"]",a.DisplayIndex=r.toString(),a.width="120",this.Tree.ColumnsSource.push(a)}if(this.TreeFlds.Contains("UOM")||this.TreeFlds.Contains("Debit")){var o=new G.a;o.DataType=e,o.HeaderText="UOM/Debit",r=t++,o.DisplayMember="Text["+r+"]",o.DisplayIndex=r.toString(),o.width="120",this.Tree.ColumnsSource.push(o)}if(this.TreeFlds.Contains("UnitPrice")||this.TreeFlds.Contains("Credit")){var l=new G.a;l.DataType=e,l.HeaderText="UnitPrice/Credit",r=t++,l.DisplayMember="Text["+r+"]",l.DisplayIndex=r.toString(),l.width="120",this.Tree.ColumnsSource.push(l)}if(this.TreeFlds.Contains("Value")){var u=new G.a;u.DataType=e,u.HeaderText="Value",r=t++,u.DisplayMember="Text["+r+"]",u.DisplayIndex=r.toString(),u.width="120",this.Tree.ColumnsSource.push(u)}if(this.TreeFlds.Contains("IncludeinFinal")){var d=new G.a;d.DataType=e,d.HeaderText="Incl. in Final Cost",r=t++,d.DisplayMember="Text["+r+"]",d.DisplayIndex=r.toString(),d.width="120",this.Tree.ColumnsSource.push(d)}if(this.TreeFlds.Contains("IncludeinStage")){var c=new G.a;c.DataType=e,c.HeaderText="Incl. in Stage Cost",r=t++,c.DisplayMember="Text["+r+"]",c.DisplayIndex=r.toString(),c.width="120",this.Tree.ColumnsSource.push(c)}}else{var h=new G.a;h.DataType=e,h.HeaderText="Code",h.DisplayMember="Text[0]",h.DisplayIndex="0",h.width="380",this.Tree.ColumnsSource.push(h),(h=new G.a).DataType=e,h.HeaderText="Name",h.DisplayMember="Text[0]",h.DisplayIndex="1",h.width="420",this.Tree.ColumnsSource.push(h)}this.Tree.Rows=[],this.Tree.AllNodes=new Array,this.Tree.Root=new f.a,this.Tree.Root.Tree=this.Tree,this.Tree.Root.Children=(new f.a.NodeCollection).NodeCollection_1(this.Tree.Root),this.Tree.Root.Nodes=this.Tree.Root.Children,this.Tree.lstParents=new Array;var p=new f.a;p.IsGroup=!0,p.LevelNo=0,p.Tree=this.Tree,p.Children=(new f.a.NodeCollection).NodeCollection_1(p),p.Nodes=p.Children,p.IsExpandedOnce=!0,p.AssignIsExpanded(!0),p.Text.push("All Stages"),p.Text.push(""),p.Id=1,p.id=1,p.CallPropertyChange(),this.Tree.Rows.push(p),this.Tree.Root.Children.push(p),this.Tree.BtnSelectionVisibility=!0}},{key:"AutoGenerateCode",value:function(){this.objBOM.GetBOMDetails(this.BID);var e=s.a.common.GetAutoSequence(76,"","76",s.a.SessionManager.CompanyIndex.toString()),t=this.ScreenObject.Data.Tables[4].filter((function(e){return"CodeAutoGen"==e.Name}));t.length>0&&(Object(a.j)(t[0].Value)?(this.txtCode.Enable=!1,this.txtCode.Mandatory=!1,0==this.BID&&(this.txtCode.Text=e)):this.txtCode.Enable=!0),(t=this.ScreenObject.Data.Tables[4].filter((function(e){return"CapsLock"==e.Name}))).length>0&&Object(a.j)(t[0].Value)&&(this.txtName.IsAllCaps=!0),(t=this.ScreenObject.Data.Tables[4].filter((function(e){return"CapsToFirstLetter"==e.Name}))).length>0&&Object(a.j)(t[0].Value)&&(this.txtName.IsFirstLetterCaps=!0)}},{key:"OnLoad",value:function(e){var t=this,i=this.objBOM.GetBOMDetails(e);i.Tables[0].length>0&&(this.txtCode.Text=r.e.String(i.Tables[0][0].BOMCode),this.txtName.Text=r.e.String(i.Tables[0][0].BOMName),this.Group.SelectedValue=r.e.String(i.Tables[0][0].ParentID),this.MStatus.SelectedValue=r.e.String(i.Tables[0][0].StatusID),this.txtDesc.Text=r.e.String(i.Tables[0][0].Description),r.e.IsEmpty(i.Tables[0][0].ProductID)||(this.Product.SelectedValue=parseInt(i.Tables[0][0].ProductID.toString())),r.e.IsEmpty(i.Tables[0][0].LocationID)||(this.Location.SelectedValue=parseInt(i.Tables[0][0].LocationID.toString())),r.e.IsEmpty(i.Tables[0][0].DivisionID)||(this.Division.SelectedValue=parseInt(i.Tables[0][0].DivisionID.toString())),r.e.IsEmpty(i.Tables[0][0].Date)||(this.Date.Date=new Date(i.Tables[0][0].Date.toString())),this.FPQty.Text=r.e.String(i.Tables[0][0].FPQty),this.OnProductChange(null),this.UOM.SelectedValue=r.e.String(i.Tables[0][0].UOMID),i.Columns[0].Contains("Packing")&&(this.Packing.Text=r.e.String(i.Tables[0][0].Packing)),this.objBOM.GUID=r.e.String(i.Tables[0][0].GUID)),this.ScreenObject.LoadCustomFieldsData(i.Tables[6]),this.ScreenObject.LoadCustomFieldsCCData(i.Tables[7]),this.ScreenObject.CanApprove(i.Tables[0][0],i.Tables[10][0],this.ButtonSave),i.Tables[9].forEach((function(e){var s=new P(parseInt(e.StageID),parseInt(e.ParentID),null,t);s.Code=r.e.String(e.Code),s.Name=r.e.String(e.Name),s.StageNodeID=parseInt(e.StageNodeID),s.Stage.SelectedValue=parseInt(e.StageNodeID),i.Columns[9].Contains("Duration")&&!r.e.IsEmpty(e.Duration)&&(s.txtDuration.Text=e.Duration.toString()),s.LoadBOM(i),1!=s.parentid?(s.Parent=t.GetParent(t.BOMNodes,s.parentid),s.Parent.Childrens.push(s)):t.BOMNodes.push(s)})),this.RefreshBOMTree()}},{key:"GetParent",value:function(e,t){var i=this,s=e.find((function(e){return e.StageID==t}));return null!=s&&null!=s?s:(e.forEach((function(e){if(e.Childrens.length>0)return i.GetParent(e.Childrens,t)})),null)}},{key:"OnSaveBOM",value:function(e){var t=this;if("AddStage"==e){var i=1,n=null;null!=this.BOMTreeControl.Tree.SelectedNode&&null!=this.BOMTreeControl.Tree.SelectedNode.Tag?1!=(i=this.BOMTreeControl.Tree.SelectedNode.Parent.Id)&&(n=this.BOMTreeControl.Tree.SelectedNode.Parent.Tag):null!=this.BOMTreeControl.Tree.SelectedNode&&null!=this.BOMTreeControl.Tree.SelectedNode.Parent&&null!=this.BOMTreeControl.Tree.SelectedNode.Parent.Tag&&(i=this.BOMTreeControl.Tree.SelectedNode.Parent.Id,n=this.BOMTreeControl.Tree.SelectedNode.Parent.Tag);var a=new P(--this.iCntBOM,i,n,this);a.CancelVisible=!0,s.a.page.ShowDialog(a,E.a,{HideClose:!1,HideHeader:!0,ShowCenter:!0})}else if("EditStage"==e)null!=this.BOMTreeControl.Tree.SelectedNode&&null!=this.BOMTreeControl.Tree.SelectedNode.Tag?(this.BOMTreeControl.Tree.SelectedNode.Tag.CancelVisible=!1,s.a.page.ShowDialog(this.BOMTreeControl.Tree.SelectedNode.Tag,E.a,{HideClose:!1,HideHeader:!0,ShowCenter:!0})):this.DisplayMessage="Please Select Stage";else if("DeleteStage"==e)if(this.DisplayMessage="",null!=this.BOMTreeControl.Tree.SelectedNode&&null!=this.BOMTreeControl.Tree.SelectedNode.Tag){var o=this.BOMTreeControl.Tree.SelectedNode.Tag;null!=o.Parent?o.Parent.Childrens.Remove(o):this.BOMNodes.Remove(o),this.RefreshBOMTree()}else this.DisplayMessage="Please Select Stage";else if("Save"==e||"SaveAs"==e)try{var l,u=this._ScreenObject.ValidateData();if(!r.e.IsEmpty(u))return this.DisplayMessage=u,void(this.MessageVisibility=!0);if(!r.e.IsEmpty(u))return this.DisplayMessage=u,void(this.MessageVisibility=!0);if(!this.ScreenObject.ValidateDataonSave())return;this.objBOM.BOMID=null!=e&&"SaveAs"==e.toString()?0:this.BID,this.objBOM.Code=this.txtCode.Text,this.objBOM.Name=this.txtName.Text,this.objBOM.Date=this.Date.Date,this.objBOM.ProductID=this.Product.SelectedValue,this.objBOM.Packing=r.e.IsEmpty(this.Packing.Text)?"":this.Packing.Text,this.objBOM.UOMID=r.e.IsEmpty(this.UOM.SelectedValue)?0:parseInt(this.UOM.SelectedValue),this.objBOM.FPQty=r.e.Double(this.FPQty.Text),this.objBOM.FPQty<=0&&(this.objBOM.FPQty=1),this.objBOM.LocationID=this.Location.SelectedValue,this.objBOM.DivisionID=this.Division.SelectedValue,this.objBOM.group=!1,this.objBOM.selectednodeid=parseInt(this.Group.SelectedValue),this.objBOM.Desc=this.txtDesc.Text,this.objBOM.StatusID=parseInt(this.MStatus.SelectedValue);var d="";d+="<Stages>";var c=1,h=new Array;this.BOMTreeControl.Tree.AllNodes.forEach((function(i){if(null!=i.Tag){var s=i.Tag;"SaveAs"==e.toString()&&(s.StageID=--t.iCntBOM),d+='<Stage ID="'+s.StageID,d+='" StageNodeID="'+s.Stage.SelectedValue,r.e.IsEmpty(s.txtDuration.Text)||""!=s.txtDuration.ValidateData()?d+='" Duration="0':d+='" Duration="'+s.txtDuration.Text,d+='" Parent="'+i.Parent.Id,d+='" lft="'+c,d+='" Depth="'+i.LevelNo+'" />',h.push(s),c++}})),d+="</Stages>",this.objBOM.StageXML=d.toString(),this.objBOM.BOMProductXML=this.BOMProductXML(h,e),this.objBOM.BOMExpenseXML=this.BOMExpenseXML(h,e),this.objBOM.BOMResourceXML=this.BOMResourceXML(h,e),this.objBOM.CustomFieldsQuery=this._ScreenObject.GetCustomFieldsQuery(),this.objBOM.CustomCCQuery=this._ScreenObject.GetCustomCostCenterFieldsQuery(),this.objBOM.WID=464==this.objBOM.StatusID?0:this.ScreenObject.CheckWorkFlow(),s.a.inventory.AddMultiStageBOM(this.objBOM,"AddMultiStageBOM").subscribe((function(e){t.DisplayMessage=e.Message,t.MessageVisibility=!0,(l=e.RetValue)>0&&(t.BID=l,t.objBOM.BOMID=l)}),(function(e){console.log(" BOM Save : "+JSON.stringify(e))}))}catch(u){Logger.ErrorLog("MultiBOMTreeViewModel:: OnSAVE"+u.stack)}else e.toString()}},{key:"BOMProductXML",value:function(e,t){Logger.InfoLog("MultiBOMAddEditViewModel::Entering MachineXML ");var i="";return i+="<BOMProductXML>",e.forEach((function(e){for(var s=0;s<e.InputGrid.Table.length;s++)r.e.IsEmpty(e.InputGrid.Table[s].ProductName_Key)||(i+="<Row ",null!=t&&(null==t||"SaveAs"==t.toString())||r.e.IsEmpty(e.InputGrid.Table[s].BOMProductID)?i+=" BOMProductID='0'":i+=" BOMProductID='"+e.InputGrid.Table[s].BOMProductID.toString()+"'",i+=' StageID="'+e.StageID+'"',i+=" ProductID='"+e.InputGrid.Table[s].ProductName_Key+"'",i+=" Quantity='"+r.e.String(e.InputGrid.Table[s].Qty)+"'",i+=" UOMID='"+r.e.String(e.InputGrid.Table[s].UOM_Key)+"'",i+=" UnitPrice='"+r.e.String(e.InputGrid.Table[s].UnitPrice)+"'",e.InputGrid.TableColumns.Contains("FilterOn_Key")&&!r.e.IsEmpty(e.InputGrid.Table[s].FilterOn_Key)&&(i+=" FilterOn='"+e.InputGrid.Table[s].FilterOn_Key.toString()+"'"),i+=" ProductUse='1'",i+=" Wastage='"+r.e.String(e.InputGrid.Table[s].Wastage)+"'",i+=" IncInStageCost='"+r.e.String(e.InputGrid.Table[s].IncludeinStage)+"'",i+=" IncInFinalCost='"+r.e.String(e.InputGrid.Table[s].IncludeinFinal)+"'",r.e.IsEmpty(e.InputGrid.Table[s].Stage_Key)||(i+=" AutoStage='"+e.InputGrid.Table[s].Stage_Key+"'"),i+=" Value='"+r.e.String(e.InputGrid.Table[s].Value)+"'",i+=" Remarks='"+r.e.String(e.InputGrid.Table[s].Remarks).Replace("&","&am;").Replace("<","&lt;").Replace(">","&gt;").Replace('"',"&quot;")+"'/>");for(var n=0;n<e.OutputGrid.Table.length;n++)r.e.IsEmpty(e.OutputGrid.Table[n].ProductName_Key)||(i+="<Row ",null!=t&&(null==t||"SaveAs"==t.toString())||r.e.IsEmpty(e.OutputGrid.Table[n].BOMProductID)?i+=" BOMProductID='0'":i+=" BOMProductID='"+e.OutputGrid.Table[n].BOMProductID.toString()+"'",i+=' StageID="'+e.StageID+'"',i+=" ProductID='"+e.OutputGrid.Table[n].ProductName_Key+"'",i+=" Quantity='"+r.e.String(e.OutputGrid.Table[n].Qty)+"'",i+=" UnitPrice='"+r.e.String(e.OutputGrid.Table[n].UnitPrice)+"'",i+=" UOMID='"+r.e.String(e.OutputGrid.Table[n].UOM_Key)+"'",i+=" ProductUse='2'",i+=" Value='"+r.e.String(e.OutputGrid.Table[n].Value)+"'/>")})),i+="</BOMProductXML>",Logger.InfoLog("MultiBOMAddEditViewModel::Exiting MachineXML"),i.toString()}},{key:"BOMExpenseXML",value:function(e,t){var i="";return i+="<BOMExpenseXML>",e.forEach((function(e){for(var s=0;s<e.ExpenseGrid.Table.length;s++)r.e.IsEmpty(e.ExpenseGrid.Table[s].AccountName_Key)||(i+="<Row ",null!=t&&(null==t||"SaveAs"==t.toString())||r.e.IsEmpty(e.ExpenseGrid.Table[s].ExpenseID)?i+=" ExpenseID='0'":i+=" ExpenseID='"+e.ExpenseGrid.Table[s].ExpenseID.toString()+"'",i+=' StageID="'+e.StageID+'"',i+=" Name='"+r.e.String(e.ExpenseGrid.Table[s].Name)+"'",i+=" ResourceID='1'",i+=" CreditAccountID='"+e.ExpenseGrid.Table[s].AccountName_Key+"'",r.e.IsEmpty(e.ExpenseGrid.Table[s].Expense_Key)||(i+=" DebitAccountID='"+e.ExpenseGrid.Table[s].Expense_Key+"'"),i+=" IncInStageCost='"+r.e.String(e.ExpenseGrid.Table[s].IncludeinStage)+"'",i+=" IncInFinalCost='"+r.e.String(e.ExpenseGrid.Table[s].IncludeinFinal)+"'",i+=" Value='"+r.e.String(e.ExpenseGrid.Table[s].Value)+"'/>")})),(i+="</BOMExpenseXML>").toString()}},{key:"BOMResourceXML",value:function(e,t){var i="";return i+="<BOMResourceXML>",e.forEach((function(e){for(var s=0;s<e.ResourcesGrid.Table.length;s++)r.e.IsEmpty(e.ResourcesGrid.Table[s].Machine_Key)||(i+="<Row ",null!=t&&(null==t||"SaveAs"==t.toString())||r.e.IsEmpty(e.ResourcesGrid.Table[s].BOMResourceID)?i+=" BOMResourceID='0'":i+=" BOMResourceID='"+e.ResourcesGrid.Table[s].BOMResourceID.toString()+"'",i+=' StageID="'+e.StageID+'"',i+=" ResourceID='"+e.ResourcesGrid.Table[s].Machine_Key+"'",e.ResourcesGrid.TableColumns.Contains("MachineDim1_Key")&&!r.e.IsEmpty(e.ResourcesGrid.Table[s].MachineDim1_Key)&&(i+=" MachineDim1='"+e.ResourcesGrid.Table[s].MachineDim1_Key+"'"),e.ResourcesGrid.TableColumns.Contains("MachineDim2_Key")&&!r.e.IsEmpty(e.ResourcesGrid.Table[s].MachineDim2_Key)&&(i+=" MachineDim2='"+e.ResourcesGrid.Table[s].MachineDim2_Key+"'"),e.ResourcesGrid.TableColumns.Contains("Options")&&!r.e.IsEmpty(e.ResourcesGrid.Table[s].Options)&&(i+=" Options='"+e.ResourcesGrid.Table[s].Options+"'"),r.e.IsEmpty(e.ResourcesGrid.Table[s].hrs)?i+=" Hours='1' ":i+=" Hours='"+e.ResourcesGrid.Table[s].hrs.toString()+"'",i+=" IncInStageCost='"+r.e.String(e.ResourcesGrid.Table[s].IncludeinStage)+"'",i+=" IncInFinalCost='"+r.e.String(e.ResourcesGrid.Table[s].IncludeinFinal)+"'",i+=" Value='"+r.e.String(e.ResourcesGrid.Table[s].Value)+"'/>")})),(i+="</BOMResourceXML>").toString()}},{key:"DeleteNode",value:function(e){var t=this;e.Children.forEach((function(e){t.DeleteNode(e)})),this.BOMTreeControl.Tree.Rows.Remove(e),this.BOMTreeControl.Tree.AllNodes.Remove(e),this.BOMTreeControl.Tree.Root.Children[0].Children.Contains(e)&&this.BOMTreeControl.Tree.Root.Children[0].Children.Remove(e)}},{key:"OnProductChange",value:function(e){var t=this;if(this.UOM.Length!=this.Product.SelectedValue.toString()&&(this.UOM.Items.Clear(),this.UOM.Length=this.Product.SelectedValue.toString(),this.UOM.SelectedValue=null,this.Product.SelectedValue>0)){var i=this.objBOM.GetProductUnits(this.Product.SelectedValue);null!=i&&i.Tables.length>0&&i.Tables[0].length>0&&(i.Tables[0].forEach((function(e){t.UOM.Items.push(d.d.ComboBoxItems_2(e.UnitName.toString(),e.UOMID.toString()))})),i.Columns[0].Contains("DefaultUOM")&&(this.UOM.SelectedValue=r.e.String(i.Tables[0][0].DefaultUOM))),null!=i&&i.Tables.length>1&&i.Columns[1].Contains("Packing")&&i.Tables[1].length>0&&(this.Packing.Text=r.e.String(i.Tables[1][0].Packing))}}},{key:"OnAddEditSatge",value:function(e){var t,i=this.BOMTreeControl.Tree.SelectedNode,s=null,n=null;if(null!=i&&i.Tag==e){for(;i.Children.length>0&&null==i.Children[0].Tag;)this.BOMTreeControl.Tree.Rows.Remove(i.Children[0]),this.BOMTreeControl.Tree.AllNodes.Remove(i.Children[0]),i.Children.Remove(i.Children[0]);(t=i).Text.Clear(),t.Text.push(e.Code),t.Text.push(e.Name),t.CallPropertyChange()}else{if((t=new f.a).IsGroup=!0,t.LevelNo=1,t.Tree=this.BOMTreeControl.Tree,t.Children=(new f.a.NodeCollection).NodeCollection_1(t),t.Nodes=t.Children,t.Text.push(e.Code),t.Text.push(e.Name),t.IsExpandedOnce=!0,t.AssignIsExpanded(!0),t.CallPropertyChange(),null!=i&&null!=i.Tag){n=(s=i).Parent,t.LevelNo=s.Level;var r=this.BOMTreeControl.Tree.Rows.indexOf(i);this.BOMTreeControl.Tree.Rows.Insert(r,t),r=this.BOMTreeControl.Tree.AllNodes.indexOf(i),this.BOMTreeControl.Tree.AllNodes.Insert(r-1,t),n.Children.Insert(n.Children.indexOf(s),t)}else if(null!=i&&null!=i.Parent&&null!=i.Parent.Tag){if(s=i.Parent,t.LevelNo=s.Level+1,null!=s.NextNode){var a=this.BOMTreeControl.Tree.Rows.indexOf(s.NextNode);this.BOMTreeControl.Tree.Rows.Insert(a,t),this.BOMTreeControl.Tree.AllNodes.Insert(a-1,t)}else this.BOMTreeControl.Tree.Rows.push(t),this.BOMTreeControl.Tree.AllNodes.push(t);s.Children.push(t)}else this.BOMTreeControl.Tree.Rows.push(t),this.BOMTreeControl.Tree.AllNodes.push(t),this.BOMTreeControl.Tree.Root.Children[0].Children.push(t);t.Tag=e}t.Id=e.StageID,t.id=e.StageID,this.BOMTreeControl.Tree.Rows.indexOf(t)}},{key:"RefreshBOMTree",value:function(){for(var e=this,t=this.BOMTreeControl.Tree.Rows.length-1;t>0;t--)this.BOMTreeControl.Tree.Rows.RemoveAt(t);this.BOMTreeControl.Tree.AllNodes.Clear(),this.BOMTreeControl.Tree.Root.Children[0].Children.Clear(),this.BOMNodes.forEach((function(t){e.RecursuveAdd(t)}))}},{key:"RecursuveAdd",value:function(e){var t=this;1!=e.parentid?(this.BOMTreeControl.Tree.SelectedNode=this.BOMTreeControl.Tree.AllNodes.find((function(t){return t.Id==e.parentid})),null!=this.BOMTreeControl.Tree.SelectedNode&&this.BOMTreeControl.Tree.SelectedNode.Children.length>0&&(this.BOMTreeControl.Tree.SelectedNode=this.BOMTreeControl.Tree.SelectedNode.Children[0])):this.BOMTreeControl.Tree.SelectedNode=null,this.OnAddEditSatge(e),e.Childrens.forEach((function(e){t.RecursuveAdd(e)}))}},{key:"OnCustomizeExtraFields",value:function(e){}},{key:"ScreenObject",get:function(){return this._ScreenObject}}]),i}(l.b),V=i("1X8t"),N=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"AddPage",value:function(e,t,i,n,r,a){var o=e.obj;if(76==o.CostCenterID)if(s.a.page.ShowLoading=!0,null==o.SelectedNode&&null==o.SelectedNode||1!=o.SelectedNode.TypeID||-999!=n)if(null==o.SelectedNode&&null==o.SelectedNode||2!=o.SelectedNode.TypeID){var l=new C(n,r);s.a.page.addNewTab({component:O.a,params:{obj:l}})}else{var u=new R(n,r);s.a.page.addNewTab({component:V.a,params:{obj:u}})}else{var d=new R(0,r);s.a.page.addNewTab({component:V.a,params:{obj:d}})}}},{key:"LoadPRDScreen",value:function(e,t){switch(e.FeatureActionID.toString()){case"6334":case"6327":case"6354":break;case"6389":return{component:n.TreeViewPageComponent,params:{ScreenName:e.ScreenName,FeatureActionID:e.FeatureActionID,CostCenterID:e.FeatureID,Call:"C3"},basedon:"CostCenterID"}}}}]),e}()}}]);
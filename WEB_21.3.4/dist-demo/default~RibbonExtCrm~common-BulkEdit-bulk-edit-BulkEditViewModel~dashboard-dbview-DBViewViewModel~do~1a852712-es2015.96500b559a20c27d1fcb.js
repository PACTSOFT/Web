(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{P6ee:function(t,e,a){"use strict";a.r(e),a.d(e,"AddEditRenContractViewModel",(function(){return Z})),a.d(e,"PromptIsOpening",(function(){return $}));var i=a("mrSG"),s=a("Do2H"),n=a("Lp6j"),r=a("eQJW"),o=a("4HhE"),l=a("n56n"),c=a("0/4Q"),h=a("8B8H"),D=a("ockk"),u=a("VxiT"),C=a("Jnyl"),m=a("EQd/"),S=a("NkMH"),b=a("JIg3"),d=a("sDFv"),T=a("vTM8"),g=a("xnJf"),y=a("RJs6"),I=a("c6C+"),p=a("OvA8"),A=a("ScVY"),P=a("DKUf"),N=a("CQvG"),V=a("MCLT"),R=a("CUWK");class f extends A.b{constructor(t){if(super(),this.DisplayName="",this.Width="600",this.MessageVisibility=!1,this.PostingDate=new b.a(0),this.CheqStartDate=new b.a(0),this.Amount=new m.d(0),this.AmountinGenChq=new m.d(0),this.ChequeBankName=new m.d(0),this.NoofCheques=new m.d(0),this.FirstChequeNo=new m.d(0),this.InstallmentPeriod=new m.d(0),this.PayeeBank=new c.e(0),this.InstallmentYear=new c.e(0),this.Particulars=new c.b(0),this.SelectedValueChanged=!1,this.DebitAcc=new l.b(0),this.PrevVal="",this.oparent=t,this.ChequeBankName.Visible=!1,this.Amount.Visible=!1,this.DebitAcc.Label="Bank Account",this.DebitAcc.CCID=2,this.DebitAcc.TypeID=100,this.DebitAcc.IsPartiralData=!0,this.InstallmentPeriod.Text="0",this.Particulars.Visible=!1,this.Particulars.LblWidth="2",this.AmountinGenChq.Visible=!1,"AddEditRenContractViewModel"==t.ClassName){var e=t.ContractPayTerms.find(t=>"DebitAccountID"==t.DisplayMember);if(null!=e&&null!=e&&(this.DebitAcc.TypeID=e.TypeID),null!=t.ScreenObject.Data&&t.ScreenObject.Data.Tables.length>8)for(let e=0;e<t.ScreenObject.Data.Tables[8].length;e++)this.PayeeBank.Items.push(c.d.ComboBoxItems_2(t.ScreenObject.Data.Tables[8][e].PayNodeID.toString(),t.ScreenObject.Data.Tables[8][e].PayeeBank.toString()));if(null!=t.ScreenObject.Data&&t.ScreenObject.Data.Tables.length>5){let e=t.ScreenObject.Data.Tables[5].filter(t=>"ShowInstallmentPeriod"==t.Name);e.length>0&&(this.InstallmentPeriod.Visible=Object(r.j)(e[0].Value))}if("AddEditRenContractViewModel"==t.ClassName&&this.oparent.ShowAmountinGenChq&&(this.AmountinGenChq.Visible=!0,this.AmountinGenChq.Label="Amount"),this.InstallmentYear.Visible=!1,this.InstallmentYear.SelectionChangedCommand.Subscribe(this,"onselection"),this.FillValues(),t.GenChqOthPart){this.Particulars.Visible=!0,this.Width="760";for(let t=0;t<this.oparent.DataTable.length;t++){let e="";if(n.e.IsEmpty(this.oparent.DataTable[t].Particulars)&&!n.e.IsEmpty(this.oparent.DataTable[t].NodeID)){var a=this.oparent.ContractParticular.find(t=>!n.e.IsEmpty(t.ValueBinding)&&"NodeID"==t.ValueBinding);if(null!=a&&null!=a){let i=a.ComboData.filter(e=>e.NodeID==this.oparent.DataTable[t].NodeID.toString());i.length>0&&(e=i[0].Particulars.toString())}}else e=n.e.String(this.oparent.DataTable[t].Particulars);0==t?(this.Particulars.Items.push(c.c.CheckedListBoxItem_4(e,this.oparent.DataTable[t].NodeID.toString(),n.e.String(this.DebitAcc.SelectedValue))),"Inclusive"!=n.e.String(this.oparent.DataTable[t].VatType)&&!n.e.IsEmpty(this.oparent.DataTable[t].VatAmount)&&parseFloat(this.oparent.DataTable[t].VatAmount)>0&&this.Particulars.Items.push(c.c.CheckedListBoxItem_3(e+" vat","-"+this.oparent.DataTable[t].NodeID.toString()))):(""!=e&&""==n.e.String(this.oparent.DataTable[t].DebitAccountID_Key)||"0"==n.e.String(this.oparent.DataTable[t].DebitAccountID_Key))&&(null!=this.oparent.DataTable[t].Amount&&""!=this.oparent.DataTable[t].Amount.toString()&&parseFloat(this.oparent.DataTable[t].Amount)>0&&this.Particulars.Items.push(c.c.CheckedListBoxItem_4(e,this.oparent.DataTable[t].NodeID.toString(),n.e.String(this.oparent.DataTable[t].BankAccountID))),"Inclusive"!=n.e.String(this.oparent.DataTable[t].VatType)&&null!=this.oparent.DataTable[t].VatAmount&&""!=this.oparent.DataTable[t].VatAmount.toString()&&parseFloat(this.oparent.DataTable[t].VatAmount)>0&&this.Particulars.Items.push(c.c.CheckedListBoxItem_3(e+" vat","-"+this.oparent.DataTable[t].NodeID.toString())))}}this.FillInstallments(),this.NoofCheques.Label=s.a.GetResource("Ren_CntrctNoCheque"),this.FirstChequeNo.Label=s.a.GetResource("Ren_CntrctFirstChequeNo"),this.CheqStartDate.Label=s.a.GetResource("Ren_CntrctCheStartD"),this.PayeeBank.Label=s.a.GetResource("Ren_CntrctPayee"),this.ChequeBankName.Label="Bank Name",this.InstallmentPeriod.Label=s.a.GetResource("Ren_CntrctInstallmentPeriod"),this.Amount.Label="Amount",this.PostingDate.Label="Posting Date",this.DisplayName=s.a.GetResource("Ren_CntrctCheqNo")}else"AddEditDocumentViewModel"==this.oparent.ClassName&&(this.PayeeBank.Visible=!1,this.ChequeBankName.Visible=!0,this.Amount.Visible=!0,this.Amount.DataType="FLOAT",this.NoofCheques.DataType="FLOAT",this.InstallmentPeriod.Visible=!1,this.DebitAcc.Label="Account Name",this.DisplayName=s.a.GetResource("Ren_CntrctCheqNo"))}get SelectedValue(){return this._selectedvalue}set SelectedValue(t){this._selectedvalue!=t&&(this._selectedvalue=t,this.SelectedValueChanged=!this.SelectedValueChanged)}onselection(t){this.InstallmentYear.SelectedValue!=this.PrevVal&&(this.PrevVal=this.InstallmentYear.SelectedValue,this.InstallmentYear.Expression=this.oparent.GenChqOthPart?this.GetTotAmount().ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()):this.InstallmentYear.SelectedItem.Aliasname)}oncheckedchanged(t){this.InstallmentYear.Expression=this.GetTotAmount().ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()),this.AmountinGenChq.Text=this.InstallmentYear.Expression=this.GetTotAmount().ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()),this.ValidateParticulars()?this.AmountinGenChq.Text=this.InstallmentYear.Expression=this.GetTotAmount().ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()):t instanceof c.c&&(t.IsChecked=!1,this.DisplayMessage="Can not select different banks.",this.MessageVisibility=!0)}ValidateParticulars(){let t=0;return this.Particulars.Items.forEach(e=>{if(e.IsChecked&&!n.e.IsEmpty(e.Parent)&&parseInt(e.Parent)>0){if(t>0&&t!=parseInt(e.Parent))return!1;t=parseInt(e.Parent)}}),t>0&&(this.DebitAcc.SelectedValue=t),!0}FillInstallments(){if(!n.e.IsEmpty(this.oparent.DataTable[0].Xml)){let a=new n.f;a.LoadXml(this.oparent.DataTable[0].Xml.toString());let i=-1;if(a.DocumentElement.children.length>0&&!n.e.IsEmpty(a.DocumentElement.children[0].attributes)&&!n.e.IsEmpty(a.DocumentElement.children[0].attributes.Filter)&&!n.e.IsEmpty(a.DocumentElement.children[0].attributes.Filter.value)&&(i=parseInt(a.DocumentElement.children[0].attributes.Filter.value)),2==i||-1==i){this.InstallmentYear.Visible=!0,this.InstallmentYear.Enable=!1;let t=new Date,e=new Date;a.DocumentElement.children[0].childNodes.forEach(a=>{n.e.isValidDate(a.attributes.FromDate.value)&&(t=new Date(a.attributes.FromDate.value)),n.e.isValidDate(a.attributes.ToDate.value)&&(e=new Date(a.attributes.ToDate.value))})}else if(0==i){this.InstallmentYear.Visible=!0,this.InstallmentYear.Enable=!1;var t=a.SelectNodes("XML/UnitsRow/Row");let e=new Date,i=new Date;t.forEach(t=>{n.e.isValidDate(t.attributes.FromDate.value)&&(e=new Date(t.attributes.FromDate.value)),n.e.isValidDate(t.attributes.ToDate.value)&&(i=new Date(t.attributes.ToDate.value));var a=this.InstallmentYear.Items.find(t=>!n.e.IsEmpty(t.Value)&&!n.e.IsEmpty(t.Parent)&&new Date(t.Value)==e&&new Date(t.Parent)==i);null!=a&&(a.Aliasname=(parseFloat(a.Aliasname)+this.GetVatInclAmt(0,t.attributes.Amount.Value)).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()))})}for(let r=1;r<this.oparent.DataTable.length;r++)if(((null==n.e.String(this.oparent.DataTable[r].DebitAccountID_Key)||""==n.e.String(this.oparent.DataTable[r].DebitAccountID_Key)||"0"==n.e.String(this.oparent.DataTable[r].DebitAccountID_Key))&&!this.oparent.CheckNumbersForRent||"0"!=n.e.String(this.oparent.DataTable[r].InclChkGen))&&!n.e.IsEmpty(this.oparent.DataTable[r].Amount)&&parseFloat(this.oparent.DataTable[r].Amount)>0)if(n.e.IsEmpty(this.oparent.DataTable[r].Xml)){var e=this.InstallmentYear.Items.find(t=>new Date(t.Value));null!=e&&null!=e&&(e.Aliasname=(parseFloat(e.Aliasname)+this.GetVatInclAmt(r,this.oparent.DataTable[r].Amount.toString())).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()))}else if(a.LoadXml(this.oparent.DataTable[r].Xml.toString()),i=-1,a.DocumentElement.children.length>0&&!n.e.IsEmpty(a.DocumentElement.children[0].attributes)&&!n.e.IsEmpty(a.DocumentElement.children[0].attributes.Filter)&&!n.e.IsEmpty(a.DocumentElement.children[0].attributes.Filter.value)&&(i=parseInt(a.DocumentElement.children[0].attributes.Filter.value)),2==i||-1==i){this.InstallmentYear.Visible=!0,this.InstallmentYear.Enable=!1;let t=new Date,e=new Date;a.DocumentElement.children[0].childNodes.forEach(a=>{n.e.isValidDate(a.attributes.FromDate.value)&&(t=new Date(a.attributes.FromDate.value)),n.e.isValidDate(a.attributes.ToDate.value)&&(e=new Date(a.attributes.ToDate.value));var i=this.InstallmentYear.Items.find(a=>!n.e.IsEmpty(a.Value)&&!n.e.IsEmpty(a.Parent)&&new Date(a.Value)==t&&new Date(a.Parent)==e);null!=i&&null!=i&&(i.Aliasname=(parseFloat(i.Aliasname)+this.GetVatInclAmt(r,a.attributes.Amount.value)).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()))})}else if(0==i){this.InstallmentYear.Visible=!0,this.InstallmentYear.Enable=!1,t=a.SelectNodes("XML/UnitsRow/Row");let e=new Date,i=new Date;t.forEach(t=>{n.e.isValidDate(t.attributes.FromDate.value)&&(e=new Date(t.attributes.FromDate.value)),n.e.isValidDate(t.attributes.ToDate.value)&&(i=new Date(t.attributes.ToDate.value));var a=this.InstallmentYear.Items.find(t=>!n.e.IsEmpty(t.Value)&&!n.e.IsEmpty(t.Parent)&&new Date(t.Value)==e&&new Date(t.Parent)==i);null!=a&&null!=a&&(a.Aliasname=(parseFloat(a.Aliasname)+this.GetVatInclAmt(r,t.attributes.Amount.value)).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()))})}}}GetVatInclAmt(t,e){if("2"==this.oparent.DataTable[t].InclChkGen.toString()){if("Inclusive"!=n.e.String(this.oparent.DataTable[t].VatType)&&!n.e.IsEmpty(this.oparent.DataTable[t].VatPer))return parseFloat(e)+parseFloat(e)*parseFloat(this.oparent.DataTable[t].VatPer)/100}else if("1"==n.e.String(this.oparent.DataTable[t].InclChkGen)&&"Inclusive"==n.e.String(this.oparent.DataTable[t].VatType)&&!n.e.IsEmpty(this.oparent.DataTable[t].VatPer))return 100*parseFloat(e)/(parseFloat(this.oparent.DataTable[t].VatPer)+100);return parseFloat(e)}FillValues(){"AddEditRenContractViewModel"==this.oparent.ClassName&&(this.PostingDate.Visible=this.oparent.InclPostingDate,null!=this.oparent.stDate&&(this.CheqStartDate.Date=this.oparent.stDate),null!=this.oparent.PayeeBnk&&(this.PayeeBank.SelectedValue=this.oparent.PayeeBnk),this.NoofCheques.Text=this.oparent.NoofCheques.toString(),null!=this.oparent.FirstNumber&&(this.FirstChequeNo.Text=this.oparent.FirstNumber.toString()),this.DebitAcc.SelectedValue=0!=this.oparent.DebitAcc?this.oparent.DebitAcc:this.oparent.GenDebitAcc,this.InstallmentPeriod.Text=this.InstallmentPeriod.Visible?this.oparent.InstPeriod.toString():"0")}GetTotAmount(){let t=0,e=new n.f,a=0;for(let o=0;o<this.Particulars.Items.length;o++){const l=this.Particulars.Items[o];if(!l.Value.startsWith("-")){var i=this.Particulars.Items.find(t=>t.Value=="-"+l.Value),s=this.oparent.DataTable.filter(t=>t.NodeID==l.Value.replace("-",""));if(s.length>0)if(this.InstallmentYear.Visible&&this.InstallmentYear.Enable){if(!n.e.IsEmpty(this.InstallmentYear.SelectedValue))if(""!=s[0].Xml.toString()){if(e.LoadXml(s[0].Xml.toString()),a=-1,e.DocumentElement.children.length>0&&!n.e.IsEmpty(e.DocumentElement.children[0].attributes)&&!n.e.IsEmpty(e.DocumentElement.children[0].attributes.Filter)&&!n.e.IsEmpty(e.DocumentElement.children[0].attributes.Filter.value)&&(a=parseInt(e.DocumentElement.children[0].attributes.Filter.value)),2==a||-1==a){let a=new Date,r=new Date;e.DocumentElement.children[0].childNodes.forEach(e=>{n.e.isValidDate(e.attributes.FromDate.value)&&(a=new Date(e.attributes.FromDate.value)),n.e.isValidDate(e.attributes.ToDate.value)&&(r=new Date(e.attributes.ToDate.value)),new Date(this.InstallmentYear.SelectedItem.Value)==a&&new Date(this.InstallmentYear.SelectedItem.Parent)==r&&(l.IsChecked&&(t+=parseFloat(e.attributes.Amount.value)),null!=i&&i.IsChecked&&""!=s[0].VatPer.toString()&&(t+=parseFloat(e.attributes.Amount.value)*parseFloat(s[0].VatPer)/100))})}else if(0==a){var r=e.SelectNodes("XML/UnitsRow/Row");let a=new Date,o=new Date;r.forEach(e=>{n.e.isValidDate(e.attributes.FromDate.value)&&(a=new Date(e.attributes.FromDate.value)),n.e.isValidDate(e.attributes.ToDate.value)&&(o=new Date(e.attributes.ToDate.value)),new Date(this.InstallmentYear.SelectedItem.Value)==a&&new Date(this.InstallmentYear.SelectedItem.Parent)==o&&(l.IsChecked&&(t+=parseFloat(e.attributes.Amount.value)),null!=i&&i.IsChecked&&""!=s[0].VatPer.toString()&&(t+=parseFloat(e.attributes.Amount.value)*parseFloat(s[0].VatPer)/100))})}}else 0==this.InstallmentYear.SelectedIndex&&(l.IsChecked&&null!=s[0].Amount&&""!=s[0].Amount.toString()&&parseFloat(s[0].Amount)>0&&(t+=parseFloat(s[0].Amount)),null!=i&&i.IsChecked&&""!=s[0].VatPer.toString()&&null!=s[0].Amount&&""!=s[0].Amount.toString()&&parseFloat(s[0].Amount)>0&&(t+=parseFloat(s[0].Amount)*parseFloat(s[0].VatPer)/100))}else l.IsChecked&&null!=s[0].Amount&&""!=s[0].Amount.toString()&&parseFloat(s[0].Amount)>0&&(t+=parseFloat(s[0].Amount)),null!=i&&i.IsChecked&&""!=s[0].VatPer.toString()&&null!=s[0].Amount&&""!=s[0].Amount.toString()&&parseFloat(s[0].Amount)>0&&(t+=parseFloat(s[0].Amount)*parseFloat(s[0].VatPer)/100)}}return t}OnSave(t){if("Cancel"==t)s.a.page.HideDialog();else if("OK"==t){if(null==this.NoofCheques.Text||""==this.NoofCheques.Text.Trim())return this.DisplayMessage="Please enter No of Cheques",void(this.MessageVisibility=!0);if(!n.e.ValidateInt(this.NoofCheques.Text))return this.DisplayMessage="Invalid No of Cheques",void(this.MessageVisibility=!0);if(null!=this.NoofCheques.Text&&parseInt(this.NoofCheques.Text)<=0)return this.DisplayMessage="Please enter No of Cheques greater than zero",void(this.MessageVisibility=!0);if(null!=this.InstallmentPeriod.Text&&""!=this.InstallmentPeriod.Text.Trim()||(this.InstallmentPeriod.Text="0"),!n.e.ValidateInt(this.InstallmentPeriod.Text))return this.DisplayMessage="Invalid No of Instalments",void(this.MessageVisibility=!0);if(null==this.FirstChequeNo.Text||""==this.FirstChequeNo.Text.Trim())return this.DisplayMessage="Please enter First Cheque No",void(this.MessageVisibility=!0);if(!n.e.ValidateInt(this.FirstChequeNo.Text))return this.DisplayMessage="Invalid First Cheque No",void(this.MessageVisibility=!0);if(null!=this.FirstChequeNo.Text&&parseInt(this.FirstChequeNo.Text)<=0)return this.DisplayMessage="Please enter First Cheque No greater than zero",void(this.MessageVisibility=!0);if(!this.ValidateCheque()&&"AddEditDocumentViewModel"!=this.oparent.ClassName)return this.DisplayMessage="No of Cheques exceeds Total Days",void(this.MessageVisibility=!0);if(this.InstallmentYear.Visible&&this.InstallmentYear.Enable&&n.e.IsEmpty(this.InstallmentYear.SelectedValue))return this.DisplayMessage="Select InstallmentYear",void(this.MessageVisibility=!0);if(this.Particulars.Visible){this.Particulars.Enable=!1;for(let t=0;t<this.Particulars.Items.length;t++)if(this.Particulars.Items[t].IsChecked){this.Particulars.Enable=!0;break}if(!this.Particulars.Enable)return this.DisplayMessage="Select any particular to generate cheques.",void(this.MessageVisibility=!0)}if("AddEditRenContractViewModel"==this.oparent.ClassName){let t="";if(this.PostingDate.Visible&&(t=this.PostingDate.Date.ToString("dd/MMM/yyyy")),this.Particulars.Visible){let e,a=0,i=0,s="";this.Particulars.Items.forEach(t=>{t.IsChecked&&(s=s+t.Name+",",parseInt(t.Value)>0?a=parseInt(t.Value):parseInt(t.Value)<0&&(a=parseInt(t.Value.Replace("-",""))),i++)}),e=this.AmountinGenChq.Visible&&!n.e.IsEmpty(this.AmountinGenChq.Text)&&n.e.DoubleTryParse(this.AmountinGenChq.Text)?n.e.DoubleTryParse(this.AmountinGenChq.Text):this.GetTotAmount(),this.InstallmentYear.Visible&&this.InstallmentYear.Enable?this.oparent.GenerateChequeNos(parseInt(this.NoofCheques.Text),this.FirstChequeNo.Text,this.CheqStartDate.Date,this.PayeeBank.SelectedValue,this.DebitAcc.SelectedValue,this.DebitAcc.Text,parseInt(this.InstallmentPeriod.Text),this.InstallmentYear.GetselectedItem().Value,this.InstallmentYear.GetselectedItem().Parent,e.toString(),t,this.InstallmentYear.GetselectedItem().CurrID,s.TrimEnd(","),a):this.oparent.GenerateChequeNos(parseInt(this.NoofCheques.Text),this.FirstChequeNo.Text,this.CheqStartDate.Date,this.PayeeBank.SelectedValue,this.DebitAcc.SelectedValue,this.DebitAcc.Text,parseInt(this.InstallmentPeriod.Text),"","",e.toString(),t,0,s.TrimEnd(","),a)}else this.InstallmentYear.Visible&&this.InstallmentYear.Enable?this.oparent.GenerateChequeNos(parseInt(this.NoofCheques.Text),this.FirstChequeNo.Text,this.CheqStartDate.Date,this.PayeeBank.SelectedValue,this.DebitAcc.SelectedValue,this.DebitAcc.Text,parseInt(this.InstallmentPeriod.Text),this.InstallmentYear.GetselectedItem().Value,this.InstallmentYear.GetselectedItem().Parent,this.InstallmentYear.GetselectedItem().Aliasname,t,this.InstallmentYear.GetselectedItem().CurrID,"",0):this.oparent.GenerateChequeNos(parseInt(this.NoofCheques.Text),this.FirstChequeNo.Text,this.CheqStartDate.Date,this.PayeeBank.SelectedValue,this.DebitAcc.SelectedValue,this.DebitAcc.Text,parseInt(this.InstallmentPeriod.Text),"","","",t,0,"",0)}s.a.page.HideDialog()}}ValidateCheque(){let t=0,e=0;null!=this.NoofCheques.Text&&""!=this.NoofCheques.Text&&(t=parseInt(this.NoofCheques.Text)),"AddEditRenContractViewModel"==this.oparent.ClassName&&null!=this.oparent.TotalDays.Text&&""!=this.oparent.TotalDays.Text&&(e=parseInt(this.oparent.TotalDays.Text)/30);let a=0;return t>e&&"AddEditRenContractViewModel"==this.oparent.ClassName?(a=parseInt(this.oparent.TotalDays.Text)/t,this.oparent.IsMonth=!1,!0):(a=e/t,0!=a&&("AddEditRenContractViewModel"==this.oparent.ClassName&&(this.oparent.IsMonth=!0),!0))}}var M=a("G3ee");class E extends A.b{constructor(t,e,a,i){super(),this.objContract={},this.ContractID=0,this.TerminationDate=new b.c(0),this.TerminationPostDate=new b.c(0),this.PaymentVisible=!0,this.PaymentOption=new c.e(0),this.BankAccount=new l.b(0),this.ChequeNo=new m.d(0),this.ChequeDate=new b.a(0),this.Remarks=new m.d(0),this.Title="",this.ContractNumber="",this.ContractNumberText=new m.d(0),this.DeleteVisible=!1,this.Reason=new l.b(0),this.Action=0,this.parent=t,this.Action=i,this.ContractID=e,this.ContractNumber=a,this.ContractNumberText.Label=s.a.GetResource("Ren_SelContract"),this.ContractNumberText.Text=a,this.MessageVisibility=!1,this.DeleteVisible=!0,this.Reason.Label="Reason",this.BankAccount.Label="Payment Mode",this.BankAccount.CCID=2,this.BankAccount.TypeID=100,this.ChequeDate.Label="Cheque Date",this.Remarks.Label="Remarks",this.ChequeNo.Label="Cheque No",this.PaymentOption.Visible=!1,this.PaymentVisible=!0,this.TerminationPostDate.Visible=!1,1==i?(this.TerminationDate.Label=s.a.GetResource("Ren_CntrctTerDate"),this.parent.TermPosting&&(this.TerminationPostDate.Visible=!0),this.TerminationPostDate.Label="Posting Date",this.Title=s.a.GetResource("REN_CntrctTerminatePref"),this.Validation()):2==i?(this.TerminationDate.Label="Vacancy Date",this.parent.TermPosting&&(this.TerminationPostDate.Visible=!0),this.Title="Close Contract",this.Reason.Visible=!1):3==i||5==i?(this.TerminationDate.Label="Refund Date*",this.TerminationDate.Date=null,this.Title="Refund",this.Reason.Visible=!1,5==i?this.PaymentOption.Visible=this.PaymentVisible=!1:this.parent.TermPosting&&(this.TerminationPostDate.Visible=!0)):4==i&&(this.TerminationDate.Label="Date*",this.TerminationDate.Date=null,this.Title="Suspend",this.Reason.Visible=!1,this.TerminationDate.Date=new Date,this.PaymentOption.Label="Payment",this.PaymentOption.Items.push(c.d.ComboBoxItems_2("None","0")),this.PaymentOption.Items.push(c.d.ComboBoxItems_2("Cancel Payment","1")),this.PaymentOption.Items.push(c.d.ComboBoxItems_2("Return Payment","2")),this.PaymentOption.SelectedValue="0",this.PaymentOption.SelectionChangedCommand.Subscribe(this,"OnSelectionChanged"),this.PaymentOption.Visible=!0,this.PaymentVisible=!1)}OnSelectionChanged(t){this.PaymentVisible=!n.e.IsEmpty(this.PaymentOption.SelectedValue)&&"2"==this.PaymentOption.SelectedValue}Validation(){s.a.SessionManager.Preferences.ContainsKey("TerminationReason")&&""!=s.a.SessionManager.Preferences.TerminationReason?(this.Reason.CCID=parseInt(s.a.SessionManager.Preferences.TerminationReason),this.Reason.TypeID=1):(this.DisplayMessage="Please set Reason Dimension",this.MessageVisibility=!0)}OnDelete(t){if(this.MessageVisibility=!1,"Cancel"==t)this.parent.DeleteVisibility=!1,s.a.page.HideDialog();else try{if(4==this.Action)return this.TerminationDate.Date?void this.parent.OnCustomizeExtraFields("SuspendReservation"):(this.DisplayMessage="select date.",void(this.MessageVisibility=!0));if(5==this.Action)return this.TerminationDate.Date?void this.parent.ProcessFullRefund(this.TerminationDate.Date):(this.DisplayMessage="select date.",void(this.MessageVisibility=!0));if(1==this.Action){if(null!=this.parent.StartDate&&this.parent.StartDate.Date&&this.TerminationDate.Date<this.parent.StartDate.Date)return this.DisplayMessage="Termination date should be higher than contract start date",void(this.MessageVisibility=!0);if(null!=this.parent.EndDate&&this.parent.EndDate.Date&&this.TerminationDate.Date>=this.parent.EndDate.Date)return this.DisplayMessage="Termination date should be lower than contract end date",void(this.MessageVisibility=!0);if(this.parent.TermPosting){if(!this.TerminationPostDate.Date)return this.DisplayMessage="Select Posting date",void(this.MessageVisibility=!0);if(this.TerminationPostDate.Date<this.TerminationDate.Date)return this.DisplayMessage="Termination date should be lower than Posting date",void(this.MessageVisibility=!0)}}else if(2==this.Action){if(null!=this.parent.EndDate&&this.parent.EndDate.Date&&this.TerminationDate.Date<this.parent.EndDate.Date)return this.DisplayMessage="VacancyDate should be higher than contract end date",void(this.MessageVisibility=!0)}else if(3==this.Action){if(null==this.TerminationDate.Date)return this.DisplayMessage="Select RefundDate",void(this.MessageVisibility=!0);if(null!=this.parent.EndDate&&this.parent.EndDate.Date&&this.TerminationDate.Date<=this.parent.EndDate.Date)return this.DisplayMessage="RefundDate should be higher than contract end date",void(this.MessageVisibility=!0);if(this.parent.TermPosting){if(!this.TerminationPostDate.Date)return this.DisplayMessage="Select Posting date",void(this.MessageVisibility=!0);if(this.TerminationPostDate.Date<this.TerminationDate.Date)return this.DisplayMessage="RefundDate should be lower than Posting date",void(this.MessageVisibility=!0)}}this.parent.TerminateContract(this.ContractID,this.Reason.SelectedValue,this.TerminationDate.Date,this.Action,!1)}catch(e){Logger.ErrorLog("TerminateRenContractViewModel:: OnDelete"+e.stack)}}}var O=a("QVxu");class w extends A.b{constructor(t,e,a,i,r,o,l,c,u,C){let m;super(),this.DisplayName="",this.OTherExpVisi=!1,this.RefreshGrid=!1,this.Header=[],this.UpdateFooter=!1,this.DtExpensesObj=new h.a,this.PaymentDetails=[],this.DtChequesObj=new h.a,this.result=!1,this.BalanceAmt=0,this.Totpen=0,this.pdcAndBounced=0,this.tot=0,this.oParent=null,this.oParent=t,this.BalanceAmt=r,this.tot=e+a-i-o,this.Header=[],this.PaymentDetails=[],this.OTherExpVisi=!1,this.ColmnSrc=[],m=new D.a,m.Header="Type",m.DisplayMember="Type",m.Width=50,this.ColmnSrc.push(m),m=new D.a,m.Header="Cheque No",m.DisplayMember="ChequeNo",m.Width=100,this.ColmnSrc.push(m),m=new D.a,m.Header="Cheque Date",m.DisplayMember="ChequeDate",m.Width=100,this.ColmnSrc.push(m),m=new D.a,m.Header="Amount",m.DisplayMember="Amount",m.DataType="FLOAT",m.Width=80,m.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinAmount.toString(),this.ColmnSrc.push(m),m=new D.a,m.Header="Pending",m.DisplayMember="PendingAmount",m.DataType="FLOAT",m.Width=80,m.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinAmount.toString(),this.ColmnSrc.push(m),1==c?this.DisplayName="Contract Termination ":2==c?this.DisplayName="Contract Close":3==c&&(this.DisplayName="Contract Refund"),this.DtChequesObj.Clear(),this.DtChequesObj.TableColumns.push("Type"),this.DtChequesObj.TableColumns.push("ChequeNo"),this.DtChequesObj.TableColumns.push("ChequeDate"),this.DtChequesObj.TableColumns.push("Amount"),this.DtChequesObj.TableColumns.push("PendingAmount"),this.ExpColmnSrc=[];let S=["ChequeNo","CntrlDate","PayNodeID","Sqft","Rate","ActAmount","Discount","TasjeelAmount","InclChkGen","RecurInvoice","Status","DocumentNo","TempCCID"];for(let s=0;s<t.ContractParticular.length;s++)if(!S.Contains(t.ContractParticular[s].DisplayMember)){if(!n.e.IsEmpty(t.ContractParticular[s].ValueBinding)&&S.Contains(t.ContractParticular[s].ValueBinding))continue;"Amount"==t.ContractParticular[s].DisplayMember?(m=t.ContractParticular[s].Clone(),m.Header="Amount",null!=m.footer&&""!=m.footer&&(m.ShowTotal=!0),m.footer="",this.ExpColmnSrc.push(m)):(this.ExpColmnSrc.push(t.ContractParticular[s]),null!=this.ExpColmnSrc[this.ExpColmnSrc.length-1].footer&&""!=this.ExpColmnSrc[this.ExpColmnSrc.length-1].footer&&(this.ExpColmnSrc[this.ExpColmnSrc.length-1].ShowTotal=!0),this.ExpColmnSrc[this.ExpColmnSrc.length-1].footer="")}if(this.DtExpensesObj.Table=[],this.Header.push(this.GetTextBox(t.SlNO.Label,t.SlNO.Text)),""!=t.ContractDate.Text||n.e.IsEmpty(t.ContractDate.Date)||(t.ContractDate.Text=t.ContractDate.Date.ToString(t.ContractDate.CustomFormat)),this.Header.push(this.GetTextBox(t.ContractDate.Label,t.ContractDate.Text.toString())),""!=t.StartDate.Text||n.e.IsEmpty(t.StartDate.Date)||(t.StartDate.Text=t.StartDate.Date.ToString(t.StartDate.CustomFormat)),this.Header.push(this.GetTextBox("Start Date",t.StartDate.Text.toString())),""!=t.EndDate.Text||n.e.IsEmpty(t.EndDate.Date)||(t.EndDate.Text=t.EndDate.Date.ToString(t.EndDate.CustomFormat)),this.Header.push(this.GetTextBox("End Date",t.EndDate.Text.toString())),this.Header.push(this.GetTextBox(t.Property.Label,t.Property.Text.toString())),this.Header.push(this.GetTextBox(t.Unit.Label,null==t.Unit.Text?"":t.Unit.Text.toString())),this.Header.push(this.GetTextBox(t.Tenant.Label,null==t.Tenant.Text?"":t.Tenant.Text.toString())),this.Header.push(this.GetTextBox("Termination Date",t.TerminateContracts.TerminationDate.Date.ToString(t.TerminateContracts.TerminationDate.CustomFormat))),this.Header.push(this.GetTextBox(t.Purpose.Label,t.Purpose.Text.toString())),this.Header.push(this.GetTextBox("Total Days",(n.e.GetDateDifference(t.EndDate.Date,t.StartDate.Date)+1).toString(),!0)),1!=c&&2!=c||this.Header.push(this.GetTextBox("Occupied Days",(n.e.GetDateDifference(t.TerminateContracts.TerminationDate.Date.OnlyDate(),t.StartDate.Date)+1).toString(),!0)),1==c?this.Header.push(this.GetTextBox("Unoccupied Days",n.e.GetDateDifference(t.EndDate.Date,t.TerminateContracts.TerminationDate.Date).toString(),!0)):2==c&&this.Header.push(this.GetTextBox("Extra Days",t.TerminateContracts.TerminationDate.Date.Date>u.Date?n.e.GetDateDifference(t.TerminateContracts.TerminationDate.Date.OnlyDate(),u).toString():"0",!0)),t.DataTable.length>0&&!n.e.IsEmpty(t.DataTable[0].Amount)&&(this.PaymentDetails.push(this.GetTextBox("Total Amount",parseFloat(t.DataTable[0].Amount.toString()).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()),!0)),this.PaymentDetails.push(this.GetTextBox("Occupied Rent",(parseFloat(t.DataTable[0].Amount.toString())-e).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()),!0))),this.PaymentDetails.push(this.GetTextBox("UnOccupied Rent",e.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()),!0)),t.dtTerm.length>0)for(let h=0;h<t.dtTerm.length;h++)if(n.e.IsEmpty(t.dtTerm[h].IsAdv)||"1"!=t.dtTerm[h].IsAdv.toString()){let e=t.ScreenObject.Data.Tables[10].filter(e=>e.NodeID==t.dtTerm[h].NodeID.toString());e.length>0&&this.PaymentDetails.push(this.GetTextBox(e[0].Particulars.toString(),parseFloat(t.dtTerm[h].Amt).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()),!0))}else r-=parseFloat(t.dtTerm[h].Amt.toString()),this.BalanceAmt-=parseFloat(t.dtTerm[h].Amt.toString()),this.tot-=parseFloat(t.dtTerm[h].Amt.toString());else this.PaymentDetails.push(this.GetTextBox("Security Deposit",a.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()),!0));(C.Tables.length>3&&C.Tables[3].length>0||C.Tables.length>4&&C.Tables[4].length>0)&&(this.OTherExpVisi=!0,this.FillTermParticulars(C.Tables.length>3&&C.Tables[3].length>0?C.Tables[3]:C.Tables[4],t,c)),this.PaymentDetails.push(this.GetTextBox("Penalty & Others",this.Totpen.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()),!0));let b=0;if(C.Tables.length>5&&C.Tables[5].length>0){for(let t=0;t<C.Tables[5].length;t++)if(!n.e.IsEmpty(C.Tables[5][t].PendingAmount)&&parseFloat(C.Tables[5][t].PendingAmount.toString())>0){b+=parseFloat(C.Tables[5][t].PendingAmount.toString());let e=this.DtChequesObj.NewRow();e.Type="Bounced",e.ChequeNo=C.Tables[5][t].ChequeNumber.toString(),n.e.IsEmpty(C.Tables[5][t].ChequeDate)||(e.ChequeDate=new Date(C.Tables[5][t].ChequeDate.toString()).ToString(s.a.SessionManager.Preferences["Date Format"])),e.Amount=C.Tables[5][t].Amount.toString(),e.PendingAmount=C.Tables[5][t].PendingAmount.toString(),this.DtChequesObj.addRow(e)}if(C.Tables.length>6&&C.Tables[6].length>0)for(let t=0;t<C.Tables[6].length;t++)if(!n.e.IsEmpty(C.Tables[6][t].Amount)&&parseFloat(C.Tables[6][t].Amount.toString())>0){b+=parseFloat(C.Tables[6][t].Amount.toString());let e=this.DtChequesObj.NewRow();e.Type="PDC",e.ChequeNo=C.Tables[6][t].ChequeNumber.toString(),n.e.IsEmpty(C.Tables[6][t].ChequeDate)||(e.ChequeDate=new Date(C.Tables[6][t].ChequeDate.toString()).ToString(s.a.SessionManager.Preferences["Date Format"])),e.Amount=C.Tables[6][t].Amount.toString(),this.DtChequesObj.addRow(e)}this.tot-=b,r-=b,this.BalanceAmt-=b}this.pdcAndBounced=i+b,this.PaymentDetails.push(this.GetTextBox("Total Refundable",(this.BalanceAmt+this.pdcAndBounced).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()),!0)),this.PaymentDetails.push(this.GetTextBox("Pending PDC's + Bounced Cheques",this.pdcAndBounced.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()),!0)),2==c&&this.PaymentDetails.push(this.GetTextBox("Extra Rent",o.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()),!0)),this.PaymentDetails.push(this.GetTextBox("Net Balance",r.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()),!0)),s.a.SessionManager.Preferences.ContainsKey("VATVersion")&&(this.PaymentDetails.push(this.GetTextBox("VAT Amount",l.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()),!0)),this.PaymentDetails.push(this.GetTextBox("Net Total",(r+l).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()),!0))),this.GetTotal();for(let s=0;s<this.PaymentDetails.length;s++)this.PaymentDetails[s].Row=s/4,this.PaymentDetails[s].Column=s%4;for(let s=0;s<this.Header.length;s++)this.Header[s].Row=s/4,this.Header[s].Column=s%4;for(let h=0;h<t.PayTermsDataTableObj.Table.length;h++)if(!n.e.IsEmpty(t.PayTermsDataTableObj.Table[h].DebitAccountID_Key)&&(t.BankAccounts.ContainsKey(t.PayTermsDataTableObj.Table[h].DebitAccountID_Key.toString())||t.PDPAccounts.ContainsKey(t.PayTermsDataTableObj.Table[h].DebitAccountID_Key.toString()))&&"370"==t.PayTermsDataTableObj.Table[h].DocStatusID.toString()){let e=this.DtChequesObj.NewRow();e.Type="PDC",e.ChequeNo=t.PayTermsDataTableObj.Table[h].ChequeNo.toString(),n.e.IsEmpty(t.PayTermsDataTableObj.Table[h].CntrlDate_Key)||(e.ChequeDate=new Date(t.PayTermsDataTableObj.Table[h].CntrlDate_Key.toString()).ToString(s.a.SessionManager.Preferences["Date Format"])),e.Amount=t.PayTermsDataTableObj.Table[h].Amount.toString(),this.DtChequesObj.addRow(e)}0==this.DtCheques.length&&this.DtChequesObj.addEmptyRow(),this.CalculateFooter(),this.DtChequesObj.Height=150,this.DtExpensesObj.Height=150}get angularGrid(){return this.DtExpensesObj.angularGrid}get DtExpenses(){return this.DtExpensesObj.Table}get ExpColmnSrc(){return this.DtExpensesObj.Columns}set ExpColmnSrc(t){this.DtExpensesObj.Columns=t}get DtExpensesColumns(){return this.DtExpensesObj.TableColumns}get angularGrid1(){return this.DtChequesObj.angularGrid}get DtCheques(){return this.DtChequesObj.Table}get ColmnSrc(){return this.DtChequesObj.Columns}set ColmnSrc(t){this.DtChequesObj.Columns=t}get DtChequesColumns(){return this.DtChequesObj.TableColumns}FillTermParticulars(t,e,a){let i=0,r=0;e.DataTable.length>0&&null!=e.DataTable[0].Amount&&null!=e.DataTable[0].Amount&&(r=parseFloat(e.DataTable[0].Amount));let o,l=e.CalculateMonths();o=l>1?n.e.Round(r/l,e.Mdeci):r;for(let c=0;c<t.length;c++){if(1==a&&"6"==t[c].TypeID.toString())continue;if(1!=a&&"5"==t[c].TypeID.toString())continue;let l=this.DtExpensesObj.NewRow();if(l.SNO=c+1,l.NodeID=t[c].ParticularID.toString(),i=0,!n.e.IsEmpty(t[c].DiscountAmount)&&parseFloat(t[c].DiscountAmount)>0?i=parseFloat(t[c].DiscountAmount):!n.e.IsEmpty(t[c].DiscountPercentage)&&parseFloat(t[c].DiscountPercentage)>0?i="2"==t[c].PercType.toString()?parseFloat(t[c].DiscountPercentage)*e.SRTAmount/100:parseFloat(t[c].DiscountPercentage)*r/100:!n.e.IsEmpty(t[c].Months)&&parseFloat(t[c].Months)>0&&(i=parseFloat(o)*parseFloat(t[c].Months)),l.Amount=i,n.e.IsEmpty(t[c].CreditAccountID)||(l.CreditAccountID_Key=t[c].CreditAccountID.toString(),l.CreditAccountID=n.e.String(t[c].CrAccName)),n.e.IsEmpty(t[c].CreditAccountID)||(l.DebitAccountID_Key=t[c].DebitAccountID.toString(),l.DebitAccountID=n.e.StringValue(t[c].DrAccName)),t.Contains("VAT")&&""!=t[c].VAT.toString()&&parseFloat(t[c].VAT.toString())>0&&(l.VatPer=parseFloat(t[c].VAT.toString())),t.Contains("TaxCategoryID")&&""!=t[c].TaxCategoryID.toString()&&(l.TaxCategory_Key=t[c].TaxCategoryID.toString(),l.TaxCategory=t[c].TaxCategory.toString()),this.DtExpensesObj.TableColumns.Contains("SPType_Key")&&t.Contains("SPType")&&""!=t[c].SPType.toString()&&(l.SPType_Key=t[c].SPType.toString(),l.SPType=t[c].SPTypeName.toString()),this.DtExpensesObj.TableColumns.Contains("Dim_Key")&&t.Contains("Dimname")&&""!=t[c].Dimname.toString()&&(l.Dim_Key=t[c].DimNodeID.toString(),l.Dim=t[c].Dimname.toString()),this.DtExpensesObj.TableColumns.Contains("Location_Key")&&e.LocationContract.SelectedValue>0&&(l.Location_Key=e.LocationContract.SelectedValue),l.VatType=n.e.String(t[c].VatType),""==n.e.String(l.VatType)){let t=0,a=e.ScreenObject.Data.Tables[5].filter(t=>"PenaltyVATType"==t.Name);a.length>0?(t=n.e.IntTryParse(a[0].Value),l.VatType=1==t?"Exclusive":"Inclusive"):l.VatType="Exclusive"}n.e.IsEmpty(l.VatPer)||("Inclusive"==t[c].VatType.toString()?(l.TaxableAmt=(100*i/(parseFloat(l.VatPer)+100)).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()),l.VatAmount=(i-parseFloat(l.TaxableAmt)).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString())):(l.TaxableAmt=i,l.VatAmount=(i*parseFloat(l.VatPer)/100).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString())));for(let e=0;e<this.ExpColmnSrc.length;e++)this.ExpColmnSrc[e].DisplayMember.startsWith("CCNID")&&t.Contains(this.ExpColmnSrc[e].DisplayMember)&&this.DtExpensesObj.TableColumns.Contains(this.ExpColmnSrc[e].ValueMember)&&""!=t[c][this.ExpColmnSrc[e].DisplayMember].toString()&&(l[this.ExpColmnSrc[e].ValueMember]=t[c][this.ExpColmnSrc[e].DisplayMember].toString());this.DtExpensesObj.addRow(l)}}GetTextBox(t,e,a=!1){let i=new m.d(0);return i.Label=t,i.Text=e,a&&(i.Align="Right"),i.IsReadOnly=!0,i}CalculateFooter(){let t=this.DtExpenses.Compute("sum","Amount");null!=t&&null!=t||(t=0);var e=this.ExpColmnSrc.find(t=>"Amount"==t.DisplayMember);null!=e&&(e.footer=parseFloat(t).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString())),95==this.oParent.CostCenterID||104==this.oParent.CostCenterID?(e=this.ExpColmnSrc.find(t=>"Amount"==t.DisplayMember),t=this.DtExpenses.Compute("sum","Amount"),null!=t&&null!=t||(t=0),null!=e&&(e.footer=parseFloat(t).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()))):(e=this.ExpColmnSrc.find(t=>"ActAmount"==t.DisplayMember),t=this.DtExpenses.Compute("sum","ActAmount"),null!=t&&null!=t||(t=0),null!=e&&(e.footer=parseFloat(t).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()))),e=this.ExpColmnSrc.find(t=>"TaxableAmt"==t.DisplayMember),t=this.DtExpenses.Compute("sum","TaxableAmt"),null!=t&&null!=t||(t=0),null!=e&&(e.footer=parseFloat(t).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString())),e=this.ExpColmnSrc.find(t=>"VatAmount"==t.DisplayMember),t=this.DtExpenses.Compute("sum","VatAmount"),null!=t&&null!=t||(t=0),null!=e&&(e.footer=parseFloat(t).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString())),this.UpdateFooter=!0}GetTotal(){let t=this.DtExpenses.filter(t=>t.NodeID>0).Compute("sum","Amount");null!=t&&null!=t||(t=0),this.BalanceAmt=this.tot-parseFloat(t);var e=this.PaymentDetails.find(t=>!n.e.IsEmpty(t.Label)&&"Net Balance"==t.Label);null!=e&&e instanceof m.d&&(e.Text=this.BalanceAmt.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount)),null!=(e=this.PaymentDetails.find(t=>!n.e.IsEmpty(t.Label)&&"Total Refundable"==t.Label))&&e instanceof m.d&&(e.Text=(this.BalanceAmt+this.pdcAndBounced).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount)),this.Totpen=parseFloat(t),null!=(e=this.PaymentDetails.find(t=>!n.e.IsEmpty(t.Label)&&"Penalty & Others"==t.Label))&&e instanceof m.d&&(e.Text=this.Totpen.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount))}OnSave(t){if("Cancel"==t)this.result=!1,s.a.page.HideDialog();else if("EditEnd"!=t&&n.e.IsEmpty(t.column))"OK"==t&&(this.GetTotal(),this.result=!0,s.a.page.HideDialog());else{if(null!=this.SelectedRow&&""!=this.SelectedRow.VatPer.toString()){let t=parseFloat(this.SelectedRow.Amount);"Inclusive"==this.SelectedRow.VatType.toString()?(this.SelectedRow.TaxableAmt=(100*t/(parseFloat(this.SelectedRow.VatPer)+100)).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()),this.SelectedRow.VatAmount=(t-parseFloat(this.SelectedRow.TaxableAmt)).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString())):(this.SelectedRow.TaxableAmt=t,this.SelectedRow.VatAmount=(parseFloat(this.SelectedRow.TaxableAmt)*parseFloat(this.SelectedRow.VatPer)/100).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()))}this.CalculateFooter(),this.GetTotal(),this.result=!0}}}var L=a("OOpy"),j=a("qgom"),x=a("1UMc"),v=a("jgdN"),F=a("dQvv"),B=a("lvkM"),_=a("7i9q"),U=a("wnwj"),K=a("GEJP"),G=a("OQq8"),q=a("QanX"),X=a("8Gov"),k=a("Huqd"),W=a("bwbx"),Q=a("ybar"),H=a("MC0n"),Y=a("uMy8"),z=a("pcVU"),J=a("lUlH");class Z extends A.b{constructor(){super(),this.TotAmt=new m.d(0),this.VatAmount=new m.d(0),this._AttachmentVisibility=!1,this.DocumentsGrid=new h.a,this.PayTermsDataTableObj=new h.a,this.DocumentContGrid=new h.a,this.DataTableObj=new h.a,this._CntStatus="",this._ReportInfoVisibility=!0,this.ReportsList=[],this._UnitStatus=new c.e(0),this._RefundVisiblity=!1,this._IsRecurPosted=!1,this.PropertyID=0,this.SelectedNodeID=0,this.strRenew="Save",this.PropID=0,this.UnitTempID=0,this.draftid=0,this.TenantTempID=0,this.cntrct={},this._RefreshGrid=!1,this._DeleteVisibility=!1,this.CurrCostCenterID=0,this._RightRegionVisibility=!0,this.ContractPayTerms=[],this.ScreenObject=new u.a,this.ContractNumber=new C.a(0),this.TermsConditions=new m.c(0),this.ButtonTerminate=new S.a,this.ButtonCancelTerminate=new S.a,this.ButtonRenew=new S.a,this.BtnApprove=new S.a,this._SaveapproveVisiblity=!1,this._RejectVisiblity=!1,this.ShowOnlyAvailable=!1,this.JVRecieptonPaymentDate=!1,this.DontpostSIV=!1,this.DontsavenoPayment=!0,this.SingleInvoice=!1,this.SinglePDC=!1,this.DistribtueInvoice=!1,this.GenChqOthPart=!1,this.allowafterenddate=!0,this.DontAllowmorePayment=!0,this.VatAccountID=0,this.InvCCID=0,this.DummyCCID=0,this.FilterTenantBasedOnUnit=!1,this.CalculateRentAmountInDays=!1,this.LineWiseSalesman=!1,this.PickRRfromTenant=!1,this.PromptOpening=!1,this.IsOpening=!1,this.SelectedUnits="",this.MultiNode=null,this.ContractDate=new b.a(0),this.IsExtended=new c.e(54208),this.BasedOn=new c.e(0),this.RentAmt=new m.d(0),this.NoOfUnits=new m.d(0),this.StatusID=new c.e(0),this.Property=new l.b(0),this.Unit=new l.b(0),this.Tenant=new l.b(0),this.RentRecAc=new l.b(0),this.IncomeAc=new l.b(0),this.SlNO=new m.d(0),this.LocationContract=new l.b(0),this.DivisionContract=new l.b(0),this.CurrencyContract=new l.b(0),this.Salesman=new l.b(0),this.Accountant=new l.b(0),this.Landlord=new l.b(0),this.Months=new m.d(0),this.RefNo=new m.d(0),this.RecurDuration=new m.d(0),this.TotalDays=new m.d(0),this.TotalYears=new m.d(0),this.Purpose=new m.d(0),this.Narration=new m.d(0),this.TotalAmount=new m.d(0),this.NonRecAmount=new m.d(0),this.AgeOfRenewal=new m.d(0),this.StartDate=new b.c(0),this.EndDate=new b.c(0),this.VacancyDate=new b.c(0),this.VacantVisiblity=!1,this.StatusVisiblity=!1,this.ExtndTill=new b.c(0),this.ExpectedEndDate=new b.c(0),this.GracePeriod=new m.d(0),this.TerminateDate=new b.c(0),this.ContractParticular=[],this.ParticularsBodyReadOnly=!1,this.ParticularsBodyVisible=!0,this.PayTermsBodyReadOnly=!1,this.PayTermsBodyVisible=!0,this.IncomeOnContDate=!1,this.RenewRefID=0,this.LinkedQuotationID=0,this.ParentContractID=0,this.ContractExists=!1,this.dtParticulars=null,this.WFDocLevelList=[],this.ButtonsLeft=[],this.ButtonsPopup=[],this.IsPropLandBased=!1,this.LocAccountant=!1,this.LocLandLord=!1,this.DiscountPosting=!1,this.LocSalesman=!1,this.EnableParticular=!0,this.DonotpostDocs=!1,this.DonotCopyPayterms=!1,this.MandatoryLinking=!1,this.PickCC=1,this.PickACC=1,this.dDeci=0,this.Mdeci=0,this.ValidTill=0,this.QuotLink=0,this.DimCCID=0,this.DimWiseFields=0,this.RentBasedContract=!1,this.InclStartDate=!1,this.InclEndDate=!1,this.CancelOnTerminate=!1,this.VATExtraRent=!1,this.nomonthlyincome=!1,this.PostBankRct=!1,this.EnableGracePeriod=!1,this.TaxCatFromUnit=!1,this.CancelIncomeonTerminate=!1,this.TempCCID=0,this.DocStNodeID=0,this.VatNode=0,this.Vattype=0,this.DocStName="",this.DaysCount="",this.NegateIncomeFld="",this.PDCAccounts=new T.a,this.CashAccounts=new T.a,this.PDPAccounts=new T.a,this.BankAccounts=new T.a,this.CheckNumbersForRent=!1,this.InclPostingDate=!1,this.ShowAmountinGenChq=!1,this.TermPosting=!1,this.isFrmBlkEdit=!1,this.vatwef=new Date(2018,0,1),this.id2=0,this.NoofCheques=0,this.FirstNoLen=0,this.InstPeriod=0,this.FirstNumber="",this.stDate=new Date,this.DebitAcc=0,this.DebitName="",this.UnitCheckStatus=new G.a(0),this.MultiUnits=new G.a(0),this.ErrorMessage="Missing Report Parameter ' ",this.FlagPrefixChange=!1,this.GenDebitAcc=0,this.GenAdvanceRentAcc=0,this.GenAdvanceRentAccName="",this.OriginalRent=0,this.iSGenerate=!1,this.yr=!0,this.mn=!0,this.Obj={},this.SaveAndPrintContactID=0,this.SaveAndPrintStatusID=0,this.CheVal=0,this.ZeroValue="",this.months=0,this.IsMonth=!1,this.strCount=0,this.IsSavePrintClick=!1,this.dtTerm=null,this.DonotUpdateAccounts=!1,this.PropertyCCID=0,this.UnitCCID=0,this.TenantCCID=0,this.UnitNodeID=0,this.dsprof=null,this.costDims=null,this.UnitStatusVal="",this.strContractNo="",this.VType="",this.ProductID=0,this.SNO=1,this.PSNO=1,this.objProduct=new z.a,this.strType=!0,this.ValueUsed=0,this.Invoiced=0,this.strCCQry="",this.TotalMonths=0,this.DiscReturn=0,this.SRTAmount=0,this.RefundAmt=0,this.PDCRefund=0,this.VatAmt=0,this.ActVisibility=!1,this.SuspendVisiblity=!1,this.CloseVisiblity=!1,this.Mode=new c.e(26637),this.CopiedRow=null,this.IsRef=!1,this.ClassName="AddEditRenContractViewModel"}get AttachmentVisibility(){return this._AttachmentVisibility}set AttachmentVisibility(t){t!=this._AttachmentVisibility&&(this._AttachmentVisibility=t)}get PayTermsDataTable(){return this.PayTermsDataTableObj.Table}get PayTermsDataTableColumns(){return this.PayTermsDataTableObj.TableColumns}get DataTable(){return this.DataTableObj.Table}get DataTableColumns(){return this.DataTableObj.TableColumns}get CntStatus(){return this._CntStatus}set CntStatus(t){t!=this._CntStatus&&(this._CntStatus=t)}get ReportInfoVisibility(){return this._ReportInfoVisibility}set ReportInfoVisibility(t){t!=this._ReportInfoVisibility&&(this._ReportInfoVisibility=t)}get UnitStatus(){return this._UnitStatus}set UnitStatus(t){t!=this._UnitStatus&&(this._UnitStatus=t)}get RefundVisiblity(){return this._RefundVisiblity}set RefundVisiblity(t){t!=this._RefundVisiblity&&(this._RefundVisiblity=t)}get RefundDate(){return this._RefundDate}set RefundDate(t){t!=this._RefundDate&&(this._RefundDate=t)}get IsRecurPosted(){return this._IsRecurPosted}set IsRecurPosted(t){t!=this._IsRecurPosted&&(this._IsRecurPosted=t)}get RefreshGrid(){return this._RefreshGrid}set RefreshGrid(t){t!=this._RefreshGrid&&(this._RefreshGrid=t)}get DeleteVisibility(){return this._DeleteVisibility}set DeleteVisibility(t){this._DeleteVisibility!=t&&(this._DeleteVisibility=t)}get RightRegionVisibility(){return this._RightRegionVisibility}set RightRegionVisibility(t){t!=this._RightRegionVisibility&&(this._RightRegionVisibility=t)}get SelectedVoucher(){return this._SelectedVoucher}set SelectedVoucher(t){t!=this._SelectedVoucher&&(this._SelectedVoucher=t)}get SelectedRow(){return this._SelectedRow}set SelectedRow(t){t!=this._SelectedRow&&(this._SelectedRow=t)}get SaveapproveVisiblity(){return this._SaveapproveVisiblity}set SaveapproveVisiblity(t){t!=this._SaveapproveVisiblity&&(this._SaveapproveVisiblity=t)}get RejectVisiblity(){return this._RejectVisiblity}set RejectVisiblity(t){t!=this._RejectVisiblity&&(this._RejectVisiblity=t)}get RejectRemarks(){return this._RejectRemarks}set RejectRemarks(t){t!=this._RejectRemarks&&(this._RejectRemarks=t)}get DisplayName(){return this._DisplayName}set DisplayName(t){t!=this._DisplayName&&(this._DisplayName=t)}get Title(){return this._Title}set Title(t){t!=this._Title&&(this._Title=t)}get DoNotPrintUnApprovedContracts(){let t=this.ScreenObject.Data.Tables[5].find(t=>"DoNotPrintUnApprovedContracts"==t.Name);return t.length>0&&"True"==t[0].Value.toString()}get SelectedGridRowIndex(){return this.DataTableObj.SelectedIndex}AddEditRenContractViewModel_1(t,e,h,D,u,C="",d=null,T=!1){return Object(i.b)(this,void 0,void 0,(function*(){this.DialogResult=!0,Logger.InfoLog("AddEditRenContractViewModel ::Entering AddEditRenContractViewModel"),this.CurrCostCenterID=t,this.CostCenterID=t,this.ContractID=e,this.parentid=D,this.selectedNode=u,this.group=h,this.strRenew="Save",this.Property.CCID=92,this.Property.TypeID=2,this.Unit.CCID=93,this.Unit.Label="UnitID",this.Unit.DBColumnName="UnitID",this.Unit.DBColumnID=0,this.Unit.TypeID=2,this.Tenant.CCID=94,this.Tenant.TypeID=3,this.RentRecAc.CCID=2,this.RentRecAc.TypeID=2,this.IncomeAc.CCID=2,this.IncomeAc.TypeID=5,this.isFrmBlkEdit=T,this.CntStatus="[New]",this.Title=C,this.GracePeriod.Text="0",s.a.SessionManager.Preferences.ContainsKey("DepositLinkDimension")&&""!=s.a.SessionManager.Preferences.DepositLinkDimension&&parseInt(s.a.SessionManager.Preferences.DepositLinkDimension)>0&&(this.id2=s.a.rental.GetCostCenterNodeID("Rent",s.a.SessionManager.Preferences.DepositLinkDimension,this.id2)),this.ScreenObject.Data=this.ScreenObject.GetScreenInfo(t),null!=this.ScreenObject.Data&&this.ScreenObject.Data.Tables.length>0&&this.onFieldsLoad(t),null==this.ScreenObject.StaticFields&&(this.ScreenObject.StaticFields=[]),this.ScreenObject.oParent=this;for(const t in this.ScreenObject.oParent){let e=this.ScreenObject.oParent[t];if(e instanceof o.c||e instanceof l.b||e instanceof b.a){let t=e;if(t instanceof S.a||t==this.UnitStatus||t==this.Mode)continue;if(null==t)continue;null!=t&&(this.ScreenObject.StaticFields.push(t),this.ScreenObject.SetProperties_Static(t))}}this.ScreenObject.StaticFields.sort((t,e)=>t.Row>e.Row||t.Row==e.Row&&t.Column>e.Column?1:-1),this.ScreenObject.BuiltControls(t),this.TotalAmount=new m.d(0),this.TotalAmount.DBColumnName=s.a.GetResource("Ren_CntrctTAmnt"),this.TotalAmount.Label=s.a.GetResource("Ren_CntrctTAmnt"),this.TotalAmount.Text="",this.TotalAmount.IsReadOnly=!0,this.NonRecAmount=new m.d(0),this.NonRecAmount.DBColumnName=s.a.GetResource("Ren_CntrctNRAmt"),this.NonRecAmount.Label=s.a.GetResource("Ren_CntrctNRAmt"),this.NonRecAmount.Text="",this.NonRecAmount.IsReadOnly=!0,this.RecAmount=new m.d(0),this.RecAmount.DBColumnName=s.a.GetResource("Ren_CntrctRAmt"),this.RecAmount.Label=s.a.GetResource("Ren_CntrctRAmt"),this.RecAmount.Text="",this.RecAmount.IsReadOnly=!0,this.AddUnit(),this.ScreenObject.HeaderFields.sort((t,e)=>t.Row>e.Row||t.Row==e.Row&&t.Column>e.Column?1:-1),this.ScreenObject.CustomTab.OnTabChange.Subscribe(this,"OnTabSelectionChanged"),this.RefundDate=new b.a(0),this.ScreenObject.Data.Tables.length>6&&this.ScreenObject.Data.Tables[6].length>0&&!this.ScreenObject.Data.Columns[6].Contains("ErrorMessage")&&(this.SlNO.Enable=!1,this.DocStName=this.ScreenObject.Data.Tables[6][0].Name.toString());let i=s.a.rental.GetNextContractNo(t,this.ParentContractID);if(this.SlNO.Text=i,this.ButtonApprove=new S.a,this.ButtonConvert=new S.a,this.ButtonSave=new S.a,this.ButtonSaveAndPrint=new S.a,this.ButtonSuspend=new S.a,this.ButtonRefund=new S.a,this.BtnFullRefund=new S.a,this.ButtonVacant=new S.a,this.ButtonGenChq=new S.a,this.LoadPreferences(),this.LoadButtons(),this.ButtonCancelTerminate.Visible=!1,this.ButtonVacant.Visible=!1,this.ButtonSuspend.Visible=!1,this.ButtonRefund.Visible=!1,this.SetButtonVisibility("CancelTerminate",!1),this.SetButtonVisibility("VacantVisiblity",!1),this.SetButtonVisibility("Suspend",!1),this.SetButtonVisibility("RejectVisiblity",!1),this.SetButtonVisibility("Fullrefund",!1),this.cntrct.ContractID=this.ContractID,0==this.ContractID?s.a.SessionManager.HideUnathorizedAccess?this.ButtonSave.Visible=s.a.SessionManager.IsActionAssigned(this.CurrCostCenterID,"Create"):this.ButtonSave.Enable=s.a.SessionManager.IsActionAssigned(this.CurrCostCenterID,"Create"):(this.ScreenObject.IsEdit=!0,s.a.SessionManager.HideUnathorizedAccess?this.ButtonSave.Visible=s.a.SessionManager.IsActionAssigned(this.CurrCostCenterID,"Update"):this.ButtonSave.Enable=s.a.SessionManager.IsActionAssigned(this.CurrCostCenterID,"Update"),s.a.SessionManager.HideUnathorizedAccess?this.ButtonApprove.Visible=s.a.SessionManager.IsActionAssigned(this.CurrCostCenterID,"Approved"):this.ButtonApprove.Enable=s.a.SessionManager.IsActionAssigned(this.CurrCostCenterID,"Approved"),s.a.SessionManager.HideUnathorizedAccess?this.ButtonTerminate.Visible=s.a.SessionManager.IsActionAssigned(this.CurrCostCenterID,"Terminate"):this.ButtonTerminate.Enable=s.a.SessionManager.IsActionAssigned(this.CurrCostCenterID,"Terminate"),s.a.SessionManager.HideUnathorizedAccess?this.ButtonConvert.Visible=s.a.SessionManager.IsActionAssigned(this.CurrCostCenterID,"Convert"):this.ButtonConvert.Enable=s.a.SessionManager.IsActionAssigned(this.CurrCostCenterID,"Convert")),this.ButtonSaveAndPrint.Enable=this.ButtonSave.Enable,this.ButtonSaveAndPrint.Visible=this.ButtonSave.Visible,this.SetButtonVisibility("SaveAndPrint",this.ButtonSave.Visible),this.SetButtonEnable("SaveAndPrint",this.ButtonSave.Enable),this.PromptOpening&&95==t&&0==this.ContractID){let t=new $;if(t.PromptIsOpening(this),s.a.page.ShowDialog(t,X.a,{HideClose:!0,ShowCenter:!0,Title:"IsOpening"}),"1"==t.IsOpening.SelectedValue&&(this.IsOpening=!0),!this.DialogResult)return}if(this.ScreenObject.Data.Tables.length>7&&this.ScreenObject.Data.Tables[7].length>0&&this.ScreenObject.Data.Columns[7].Contains("isdefault")){for(let t=0;t<this.ScreenObject.Data.Tables[7].length;t++)this.UnitStatus.Items.push(c.d.ComboBoxItems_2(this.ScreenObject.Data.Tables[7][t].Name.toString(),this.ScreenObject.Data.Tables[7][t].NodeID.toString())),this.ScreenObject.Data.Columns[7].Contains("isdefault")&&Object(r.j)(this.ScreenObject.Data.Tables[7][t].isdefault.toString())&&(this.UnitStatus.SelectedValue=this.ScreenObject.Data.Tables[7][t].NodeID.toString());this.UnitStatus.Label="Unit status",this.UnitStatus.Visible=!0,this.UnitStatus.Enable=!0}this.IsPropLandBased&&this.Landlord.OnPactListBoxValueChanged.Subscribe(this,"onListSelectedChanged"),this.LocationContract.OnPactListBoxValueChanged.Subscribe(this,"onListSelectedChanged"),this.ViewNotes=new y.a(this,s.a.SessionManager,s.a.admin),this.TotAmt.Label=s.a.GetResource("Ren_CntrctTAmnt"),this.VatAmount.Label=s.a.GetResource("VatAmount"),this.TotalAmount.Label=s.a.GetResource("NetAmount"),this.EndDate.SelectedDateChanged.Subscribe(this,"OnselectionChange"),this.StartDate.SelectedDateChanged.Subscribe(this,"OnselectionChange"),this.ExpectedEndDate.SelectedDateChanged.Subscribe(this,"OnselectionChange"),this.UnitCheckStatus.ClickCommand.Subscribe(this,"CheckUnits"),this.MultiUnits.ClickCommand.Subscribe(this,"OnCustomizeExtraFields"),129==t&&this.ValidTill>0&&(this.ContractDate.SelectedDateChanged.Subscribe(this,"OnContractDateChanged"),0==e&&(this.ExtndTill.Date=(new Date).AddDays(this.ValidTill))),this.Months.LostFocusCommand.Subscribe(this,"OnMonthChange"),this.GracePeriod.LostFocusCommand.Subscribe(this,"OnGracePeriodChange"),this.TotalYears.LostFocusCommand.Subscribe(this,"OnYearChange"),this.Property.OnPactListBoxValueChanged.Subscribe(this,"onListSelectedChanged"),this.Unit.OnPactListBoxValueChanged.Subscribe(this,"onListSelectedChanged"),this.Tenant.OnPactListBoxValueChanged.Subscribe(this,"onListSelectedChanged"),this.ContractNumber.ComboBox.SelectionChangedCommand.Subscribe(this,"OnContractPrefixChanged"),this.DataTableObj.CellEditEnding.Subscribe(this,"OnCellEditEnding"),this.DataTableObj.BeginEdit.Subscribe(this,"OnBeginEdit"),this.DataTableObj.OnPreviewKeyDown.Subscribe(this,"OnKeyDown"),this.PayTermsDataTableObj.CellEditEnding.Subscribe(this,"OnCellEditEnding"),this.PayTermsDataTableObj.OnPreviewKeyDown.Subscribe(this,"OnKeyDown_Payment"),this.PayTermsDataTableObj.BeginEdit.Subscribe(this,"PaytermBeforeRowDeletingEvent"),this.ContractNumber.onGetData.Subscribe(this,"GetData"),this.ViewAttachments=new p.ViewAttachmentViewModel(this);var g=this.ScreenObject.GetExtrFieldByName("ccnid70");null!=g&&g instanceof l.b&&g.OnPactListBoxValueChanged.Subscribe(this,"OnVatTypeChanged"),this.OnLoad(this.ContractID),this.LoadTabs(),this.BuildGridData(),this.BuildPayTermsGridData(),this.DataTableObj.TableNewRow.Subscribe(this,"onAddRow"),this.ButtonRenew.Enable=!1,this.ButtonTerminate.Enable=!1,this.BtnApprove.Visible=!1,this.SetButtonVisibility("Renew",!1),this.SetButtonVisibility("Terminate",!1),this.SetButtonVisibility("RejectVisiblity",!1),this.PayTermsDataTableObj.TableNewRow.Subscribe(this,"onAddRowPay");for(let t=0;t<6;t++){let t=this.DataTableObj.NewRow();t.Recurr=!1,this.DataTableObj.addRow(t);let e=this.PayTermsDataTableObj.NewRow();this.PayTermsDataTableObj.addRow(e)}if(this.PayTermsDataTableObj.UpdateTotals(),this.DataTableObj.UpdateTotals(),this.UpdateSequencePay(),this.BtnApprove.Label=s.a.GetResource("Approve"),this.LocationContract.SelectedValue=s.a.SessionManager.LocationID,this.DivisionContract.SelectedValue=s.a.SessionManager.DivisionID,0==this.ContractID?(this.cntrct.GUID="GUID",this.Property.SelectedValue>0&&this.onListSelectedChanged(this.Property),this.Unit.SelectedValue>0&&this.onListSelectedChanged(this.Unit)):this.ContractID>0&&(this.LoadEditData(d),this.CalculateFooter(),this.PropID=this.Property.SelectedValue,this.UnitTempID=this.Unit.SelectedValue),this.RefershTitle(),this.DimWiseFields>0){var I=this.ScreenObject.GetCustomField("CCNID"+(this.DimWiseFields-5e4).toString());if(0==this.ContractID){const{DocumentNumberComponent:t}=yield Promise.resolve().then(a.bind(null,"lvkM")),{DocumentNumberViewModel:e}=yield Promise.resolve().then(a.bind(null,"dQvv"));let i=new e(this,this.ScreenObject.Data.Tables[8],!0,null);return i.DocumentNumberViewModel_1(this),void s.a.page.ShowDialog(i,t,{HideClose:!0,ShowCenter:!0,Title:s.a.GetResource("DocumentNumberTitle")}).subscribe(()=>{this.DialogResult&&(null!=I?(I.SelectedValue=this.DimWiseFieldsID,n.e.StringIsNullOrEmpty(I.LocalRefXML)||this.ScreenObject.FillLocalReferenceData(I)):null!=I&&I instanceof l.b&&(this.DimWiseFieldsID=I.SelectedValue),null!=I&&(I.Enable=!1),this.AddEditRenContractViewModel_Complete())})}}else if(s.a.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"true"==s.a.SessionManager.Preferences.EnableLocationWise.toString().toLowerCase()&&s.a.SessionManager.Preferences.ContainsKey("LW Contracts")&&"true"==s.a.SessionManager.Preferences["LW Contracts"].toString().toLowerCase()){let t=this.GetButton("ChangeLocation");null!=t&&(t.Visible=!1),this.SetButtonVisibility("ChangeLocation",!1),this.LocationContract.Enable=!1,0==e&&(this.LocationContract.SelectedValue>0?this.ChangeLocation(s.a.SessionManager.LocationID):0==this.ContractID&&R.RibbonExtViewModel.ShowDocumentNumberViewModelRental(this)),s.a.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&"true"==s.a.SessionManager.Preferences.EnableDivisionWise.toString().toLowerCase()&&s.a.SessionManager.Preferences.ContainsKey("DW Contracts")&&"true"==s.a.SessionManager.Preferences["DW Contracts"].toString().toLowerCase()&&(this.DivisionContract.Enable=!1,0==this.DivisionContract.SelectedValue&&0==this.ContractID&&R.RibbonExtViewModel.ShowDocumentNumberViewModelRental(this))}this.AddEditRenContractViewModel_Complete()}))}AddEditRenContractViewModel_Complete(){if(95!=this.CurrCostCenterID){104!=this.CurrCostCenterID&&(this.ButtonRenew.Visible=!1,this.ButtonTerminate.Visible=!1,this.ButtonCancelTerminate.Visible=!1,this.ButtonVacant.Visible=!1,this.SetButtonVisibility("Renew",!1),this.SetButtonVisibility("Terminate",!1),this.SetButtonVisibility("CancelTerminate",!1),this.SetButtonVisibility("VacantVisiblity",!1)),this.ButtonRefund.Visible=!1,this.SetButtonVisibility("RefundVisiblity",!1),this.ContractID>0&&129==this.CurrCostCenterID&&(this.ContractExists||"467"!=this.StatusID.SelectedValue?"471"==this.StatusID.SelectedValue&&(s.a.SessionManager.HideUnathorizedAccess?this.ButtonCancelTerminate.Visible=s.a.SessionManager.IsActionAssigned(this.CurrCostCenterID,"Close"):this.ButtonCancelTerminate.Enable=s.a.SessionManager.IsActionAssigned(this.CurrCostCenterID,"Close")):s.a.SessionManager.HideUnathorizedAccess?this.ButtonVacant.Visible=s.a.SessionManager.IsActionAssigned(this.CurrCostCenterID,"Close"):this.ButtonVacant.Enable=s.a.SessionManager.IsActionAssigned(this.CurrCostCenterID,"Close"));let t=this.GetButton("Generate");(this.ContractExists||"471"==this.StatusID.SelectedValue)&&(null!=t&&(t.Visible=!1),this.ButtonSuspend.Visible=!1,this.SetButtonVisibility("Suspend",!1),this.SetButtonVisibility("GenerateLink",!1)),"469"==this.StatusID.SelectedValue&&(null!=t&&(t.Visible=!1),this.ButtonSuspend.Visible=!1,this.SetButtonVisibility("Suspend",!1),s.a.SessionManager.IsActionAssigned(129,"Resave cancelled Reservation")||(this.SetButtonVisibility("Save",!1),this.SetButtonVisibility("SaveAndPrint",!1)))}this.CheckViewForUser(this.cntrct.ContractID),this.ReportView(),this.DataTable.length>0&&(this.DataTableObj.Height=252),this.PayTermsDataTable.length>0&&(this.PayTermsDataTableObj.Height=252),Logger.InfoLog("AddEditRenContractViewModel ::Exiting AddEditRenContractViewModel")}AddUnit(){this.ScreenObject.HeaderFields.Remove(this.Unit);let t=new l.f;t.SectionSeqNo=this.Unit.SectionSeqNo,t.Row=this.Unit.Row,t.Column=this.Unit.Column,t.ColumnSpan=this.Unit.ColumnSpan,t.Unit=this.Unit,t.UnitCheckStatus=this.UnitCheckStatus,t.MultiUnits=this.MultiUnits,t.MultipleUnits.Text=this.StrMultiple,t.MultipleUnits.DBColumnName="MultipleUnits",t.IsMultiunit=this.IsMultiunit,t.multiVisi=this.multiVisi,this.ScreenObject.HeaderFields.push(t),this.TerminateDate.Visible=!1,95==this.CurrCostCenterID&&(this.VacancyDate.Visible=!1)}OnVatTypeChanged(t){if(t instanceof l.b){let e=t;50070==e.CCID&&(this.Vattype=e.SelectedValue,this.VatCalcOnRenew(!1))}}LoadPreferences(){if(this.ScreenObject.Data.Tables.length>4&&this.ScreenObject.Data.Tables[4].length>0){let t=[]=this.ScreenObject.Data.Tables[4].filter(t=>"Salesman"==t.Name);t.length>0&&parseInt(t[0].Value)>0&&(this.Salesman.CCID=parseInt(t[0].Value)),t=this.ScreenObject.Data.Tables[4].filter(t=>"Accountant"==t.Name),t.length>0&&parseInt(t[0].Value)>0&&(this.Accountant.CCID=parseInt(t[0].Value)),t=this.ScreenObject.Data.Tables[4].filter(t=>"Landlord"==t.Name),t.length>0&&parseInt(t[0].Value)>0&&(this.Landlord.CCID=parseInt(t[0].Value)),t=this.ScreenObject.Data.Tables[4].filter(t=>"LocAccountant"==t.Name),t.length>0&&(this.LocAccountant=Object(r.j)(t[0].Value)),t=this.ScreenObject.Data.Tables[4].filter(t=>"LocLandLord"==t.Name),t.length>0&&(this.LocLandLord=Object(r.j)(t[0].Value)),t=this.ScreenObject.Data.Tables[4].filter(t=>"LocSalesman"==t.Name),t.length>0&&(this.LocSalesman=Object(r.j)(t[0].Value)),t=this.ScreenObject.Data.Tables[4].filter(t=>"ValidTill"==t.Name),t.length>0&&!n.e.IsEmpty(t[0].Value)&&(this.ValidTill=parseInt(t[0].Value)),t=this.ScreenObject.Data.Tables[4].filter(t=>"DonotpostDocs"==t.Name),t.length>0&&!n.e.IsEmpty(t[0].Value)&&(this.DonotpostDocs=Object(r.j)(t[0].Value)),this.Accountant.TypeID=1,this.Landlord.TypeID=1,this.Salesman.TypeID=1}if(this.ScreenObject.Data.Tables.length>5&&this.ScreenObject.Data.Tables[5].length>0){let t=[]=this.ScreenObject.Data.Tables[5].filter(t=>"LandLordPref"==t.Name);if(t.length>0&&(this.IsPropLandBased=Object(r.j)(t[0].Value)),t=this.ScreenObject.Data.Tables[5].filter(t=>"EnableParticulars"==t.Name),t.length>0&&(this.EnableParticular=Object(r.j)(t[0].Value)),t=this.ScreenObject.Data.Tables[5].filter(t=>"PickCC"==t.Name),t.length>0&&(this.PickCC=parseInt(t[0].Value)),t=this.ScreenObject.Data.Tables[5].filter(t=>"PickACC"==t.Name),t.length>0&&(this.PickACC=parseInt(t[0].Value)),t=this.ScreenObject.Data.Tables[5].filter(t=>"QuotLink"==t.Name),t.length>0&&(this.QuotLink=parseInt(t[0].Value)),t=this.ScreenObject.Data.Tables[5].filter(t=>"PostDocStatus"==t.Name),t.length>0&&parseInt(t[0].Value)>0&&(this.TempCCID=parseInt(t[0].Value)),t=this.ScreenObject.Data.Tables[5].filter(t=>"VatNode"==t.Name),t.length>0&&parseInt(t[0].Value)>0&&(this.VatNode=parseInt(t[0].Value)),t=this.ScreenObject.Data.Tables[5].filter(t=>"VATExtraRent"==t.Name),t.length>0&&(this.VATExtraRent=Object(r.j)(t[0].Value)),t=this.ScreenObject.Data.Tables[5].filter(t=>"ShowAmountinGenChq"==t.Name),t.length>0&&Object(r.j)(t[0].Value.toString())&&(this.ShowAmountinGenChq=Object(r.j)(t[0].Value)),t=this.ScreenObject.Data.Tables[5].filter(t=>"nomonthlyincome"==t.Name),t.length>0&&(this.nomonthlyincome=Object(r.j)(t[0].Value)),t=this.ScreenObject.Data.Tables[5].filter(t=>"TaxCatFromUnit"==t.Name),t.length>0&&(this.TaxCatFromUnit=Object(r.j)(t[0].Value)),t=this.ScreenObject.Data.Tables[5].filter(t=>"EnableGracePeriod"==t.Name),t.length>0&&(this.EnableGracePeriod=Object(r.j)(t[0].Value)),t=this.ScreenObject.Data.Tables[5].filter(t=>"PostBankReciept"==t.Name),t.length>0&&95==this.CostCenterID&&(this.PostBankRct=Object(r.j)(t[0].Value)),t=this.ScreenObject.Data.Tables[5].filter(t=>"VatWEF"==t.Name),t.length>0&&n.e.isValidDate(t[0].Value.toString())&&(this.vatwef=t[0].Value.toString()),t=this.ScreenObject.Data.Tables[5].filter(t=>"VatonRent"==t.Name),t.length>0&&parseFloat(t[0].Value)>0&&(this.VatonRent=parseFloat(t[0].Value)),t=this.ScreenObject.Data.Tables[5].filter(t=>"Allowmultiunits"==t.Name),this.IsMultiunit=t.length>0&&Object(r.j)(t[0].Value),t=this.ScreenObject.Data.Tables[5].filter(t=>"InclPostingDate"==t.Name),this.InclPostingDate=t.length>0&&Object(r.j)(t[0].Value),t=this.ScreenObject.Data.Tables[5].filter(t=>"DiscountPosting"==t.Name),this.DiscountPosting=t.length>0&&Object(r.j)(t[0].Value),t=this.ScreenObject.Data.Tables[5].filter(t=>"DiscountAccount"==t.Name),t.length>0&&(this.DiscountAccount=parseInt(t[0].Value)),t=this.ScreenObject.Data.Tables[5].filter(t=>"Discountfield"==t.Name),t.length>0&&""!=t[0].Value.toString()&&(this.Discountfield=t[0].Value.toString()),t=this.ScreenObject.Data.Tables[5].filter(t=>"TermPosting"==t.Name),this.TermPosting=t.length>0&&Object(r.j)(t[0].Value),t=this.ScreenObject.Data.Tables[5].filter(t=>"ShowOnlyAvailable"==t.Name),this.ShowOnlyAvailable=t.length>0&&Object(r.j)(t[0].Value),t=this.ScreenObject.Data.Tables[5].filter(t=>"GenChqOthPart"==t.Name),this.GenChqOthPart=t.length>0&&Object(r.j)(t[0].Value),t=this.ScreenObject.Data.Tables[5].filter(t=>"JVRecieptonPaymentDate"==t.Name),this.JVRecieptonPaymentDate=t.length>0&&Object(r.j)(t[0].Value),t=this.ScreenObject.Data.Tables[5].filter(t=>"DontAllowmorePayment"==t.Name),this.DontAllowmorePayment=!(t.Length>0)||Object(r.j)(t[0].Value),t=this.ScreenObject.Data.Tables[5].filter(t=>"DontsavenoPayment"==t.Name),this.DontsavenoPayment=!(t.length>0)||Object(r.j)(t[0].Value),t=this.ScreenObject.Data.Tables[5].filter(t=>"SingleInvoice"==t.Name),this.SingleInvoice=t.length>0&&Object(r.j)(t[0].Value),t=this.ScreenObject.Data.Tables[5].filter(t=>"DistributeonRent"==t.Name),this.DistributePopuponRent=!!(t.length>0&&Object(r.j)(t[0].Value.toString()))&&Object(r.j)(t[0].Value),t=this.ScreenObject.Data.Tables[5].filter(t=>"SinglePDC"==t.Name),this.SinglePDC=t.length>0&&Object(r.j)(t[0].Value),t=this.ScreenObject.Data.Tables[5].filter(t=>"DistributeInvoice"==t.Name),this.DistribtueInvoice=t.length>0&&Object(r.j)(t[0].Value),t=this.ScreenObject.Data.Tables[5].filter(t=>"ShowMonthAmountInDistribute"==t.Name),this.ShowMonthAmountInDistribute=t.length>0&&Object(r.j)(t[0].Value),t=this.ScreenObject.Data.Tables[5].filter(t=>"allowafterenddate"==t.Name),this.allowafterenddate=!(t.length>0)||Object(r.j)(t[0].Value),104==this.CostCenterID?(t=this.ScreenObject.Data.Tables[5].filter(t=>"PurchasePInvoice"==t.Name),this.InvCCID=t.length>0?parseInt(t[0].Value):0,t=this.ScreenObject.Data.Tables[5].filter(t=>"ContractDummyPurchase"==t.Name),this.DummyCCID=t.length>0?parseInt(t[0].Value):0,t=this.ScreenObject.Data.Tables[5].filter(t=>"PurchaseVatAccountID"==t.Name),this.VatAccountID=t.length>0?parseInt(t[0].Value):0):(t=this.ScreenObject.Data.Tables[5].filter(t=>"VatAccountID"==t.Name),this.VatAccountID=t.length>0?parseInt(t[0].Value):0,t=this.ScreenObject.Data.Tables[5].filter(t=>"ContractSalesInvoice"==t.Name),this.InvCCID=t.length>0?parseInt(t[0].Value):0,t=this.ScreenObject.Data.Tables[5].filter(t=>"ContractDummySales"==t.Name),this.DummyCCID=t.length>0?parseInt(t[0].Value):0,t=this.ScreenObject.Data.Tables[5].filter(t=>"DontpostSIV"==t.Name),this.DontpostSIV=t.length>0&&Object(r.j)(t[0].Value)),t=this.ScreenObject.Data.Tables[5].filter(t=>"DefaultContractDocStatus"==t.Name),t.length>0&&!n.e.IsEmpty(t[0].Value)&&parseInt(t[0].Value)>0&&(this.DocStNodeID=parseInt(t[0].Value)),t=this.ScreenObject.Data.Tables[5].filter(t=>"CancelonTermiate"==t.Name),this.CancelOnTerminate=t.length>0&&!n.e.IsEmpty(t[0].Value)&&Object(r.j)(t[0].Value),t=this.ScreenObject.Data.Tables[5].filter(t=>"CancelIncomeonTerminate"==t.Name),this.CancelIncomeonTerminate=!!(t.length>0&&!n.e.IsEmpty(t[0].Value)&&Object(r.j)(t[0].Value))&&Object(r.j)(t[0].Value),t=this.ScreenObject.Data.Tables[5].filter(t=>"NormalDays"==t.Name),this.DaysCount=t.length>0&&!n.e.IsEmpty(t[0].Value)&&Object(r.j)(t[0].Value)?"":"30",t=this.ScreenObject.Data.Tables[5].filter(t=>"CheckNumbersForRent"==t.Name),t.length>0&&!n.e.IsEmpty(t[0].Value)&&(this.CheckNumbersForRent=Object(r.j)(t[0].Value)),t=this.ScreenObject.Data.Tables[5].filter(t=>"LineWiseSalesman"==t.Name),t.length>0&&""!=t[0].Value.toString()&&(this.LineWiseSalesman=Object(r.j)(t[0].Value)),t=this.ScreenObject.Data.Tables[5].filter(t=>"IncomeOnContDate"==t.Name),t.length>0&&""!=t[0].Value.toString()&&(this.IncomeOnContDate=Object(r.j)(t[0].Value)),t=this.ScreenObject.Data.Tables[5].filter(t=>"PickRRfromTenant"==t.Name),t.length>0&&""!=t[0].Value.toString()&&(this.PickRRfromTenant=Object(r.j)(t[0].Value)),t=this.ScreenObject.Data.Tables[5].filter(t=>"PromptOpening"==t.Name),t.length>0&&""!=t[0].Value.toString()&&(this.PromptOpening=Object(r.j)(t[0].Value)),t=this.ScreenObject.Data.Tables[5].filter(t=>"RentBasedContract"==t.Name),t.length>0&&!n.e.IsEmpty(t[0].Value)&&(this.RentBasedContract=Object(r.j)(t[0].Value)),t=this.ScreenObject.Data.Tables[5].filter(t=>"InclStartDate"==t.Name),t.length>0&&!n.e.IsEmpty(t[0].Value)&&(this.InclStartDate=Object(r.j)(t[0].Value)),t=this.ScreenObject.Data.Tables[5].filter(t=>"FilterTenantBasedOnUnit"==t.Name),this.FilterTenantBasedOnUnit=t.length>0&&Object(r.j)(t[0].Value),t=this.ScreenObject.Data.Tables[5].filter(t=>"InclEndDate"==t.Name),t.length>0&&!n.e.IsEmpty(t[0].Value)&&(this.InclEndDate=Object(r.j)(t[0].Value)),t=this.ScreenObject.Data.Tables[5].filter(t=>"DailyRentDecimals"==t.Name),t.length>0&&!n.e.IsEmpty(t[0].Value)&&(this.dDeci=parseInt(t[0].Value)),t=this.ScreenObject.Data.Tables[5].filter(t=>"MonthlyRentDecimals"==t.Name),t.length>0&&!n.e.IsEmpty(t[0].Value)&&(this.Mdeci=parseInt(t[0].Value)),t=this.ScreenObject.Data.Tables[5].filter(t=>"NegateIncome"==t.Name),t.length>0&&!n.e.IsEmpty(t[0].Value)&&(this.NegateIncomeFld=t[0].Value.toString()),t=this.ScreenObject.Data.Tables[5].filter(t=>"PDCAccounts"==t.Name),t.length>0&&!n.e.IsEmpty(t[0].Value)){let e=[]=t[0].Value.split(",");for(let t=0;t<e.length;t++)this.PDCAccounts.push(e[t],e[t].toString())}if(t=this.ScreenObject.Data.Tables[5].filter(t=>"PDPAccounts"==t.Name),t.length>0&&!n.e.IsEmpty(t[0].Value)){let e=t[0].Value.toString().split(",");for(let t=0;t<e.length;t++)this.PDPAccounts.push(e[t],e[t].toString())}t=this.ScreenObject.Data.Tables[5].filter(t=>"EnableActivities"==t.Name),t.length>0&&!n.e.IsEmpty(t[0].Value)&&Object(r.j)(t[0].Value.toString())&&(this.Activities=new P.a(this,!1),this.ViewActivities=new N.b(this),this.ViewActivities.Activities=this.Activities),t=this.ScreenObject.Data.Tables[5].filter(t=>"CalculateRentAmountInDays"==t.Name),this.CalculateRentAmountInDays=t.length>0&&Object(r.j)(t[0].Value),t=this.ScreenObject.Data.Tables[5].filter(t=>"DoNotCopyPayTermsonReservation"==t.Name),t.length>0&&!n.e.IsEmpty(t[0].Value)&&(this.DonotCopyPayterms=Object(r.j)(t[0].Value)),t=this.ScreenObject.Data.Tables[5].filter(t=>"MandatoryLinking"==t.Name),t.length>0&&!n.e.IsEmpty(t[0].Value)&&(this.MandatoryLinking=Object(r.j)(t[0].Value))}}LoadButtons(){let t="",e="";t="Quotation,Subcontract,Draft,LoadDraft,UnitStatus,GeneralLedger,Generate,Email,Save,SaveAndPrint,Print,PrintPreview,Renew,Terminate,CancelTerminate,Reject,Approve",e="ViewHistory,Export,Refund,Vacant,Suspend,ChangeLocation,Customize,Report,Fullrefund,History";let a=[]=this.ScreenObject.Data.Tables[5].filter(t=>"RightButtons"==t.Name);a.length>0&&!n.e.IsEmpty(a[0].Value)&&(e=a[0].Value.toString()),a=this.ScreenObject.Data.Tables[5].filter(t=>"LeftButtons"==t.Name),a.length>0&&!n.e.IsEmpty(a[0].Value)&&(t=a[0].Value.toString()),this.ButtonsLeft.Clear(),this.ButtonsPopup.Clear();let i=[],s=["Customize"];var r=t.split(",");for(let n=0;n<r.length;n++)i.Contains(r[n])||this.AddButton(r[n],this.ButtonsLeft,40,40);r=e.split(",");for(let n=0;n<r.length;n++)s.Contains(r[n])||this.AddButton(r[n],this.ButtonsPopup,40,40);this.ButtonsPopup.sort((t,e)=>t.Label>e.Label?1:-1)}AddButton(t,e=[],a,i){let n=new S.a;switch(n.DBColumnName=t,t){case"":return;case"Quotation":n.ImgData="btn_Quotation",n.Label="Quotation",n.ComParam="ViewQuotation",n.Visible=!1;break;case"Subcontract":n.ImgData="btn_Subcontract",n.Label=s.a.GetResource("Subcontract"),n.ComParam="AddContract",n.Icon="fa-light fa-file-chart-pie",n.Visible=!1;break;case"History":n.ImgData="btn_history",n.Icon="fa-light fa-history",n.Label="Contract History",n.ComParam="History";break;case"Draft":n.ImgData="btn_saveasDraft",n.Icon="fa-light fa-clipboard",n.Label=s.a.GetResource("Com_SaveAsDraft"),n.ComParam="SaveDraft";break;case"LoadDraft":n.ImgData="btn_loaddrafts",n.Icon="fa-light fa-file-upload",n.Label=s.a.GetResource("Com_LoadDraft"),n.ComParam="LoadDraft";break;case"UnitStatus":if(95!=this.CurrCostCenterID||!s.a.SessionManager.IsActionAssigned(this.CurrCostCenterID,"Change Unit Status"))return;n.ImgData="btn_UnitStatus",n.Icon="fa-light fa-file-medical-alt",n.Label=s.a.GetResource("Rentals_UnitsStatus"),n.ComParam="UnitStatus";break;case"GeneralLedger":if(95!=this.CurrCostCenterID&&104!=this.CurrCostCenterID&&129!=this.CurrCostCenterID||!s.a.SessionManager.IsActionAssigned(this.CurrCostCenterID,"Ledger"))return;n.ImgData="btn_GeneraLledger",n.Icon="fa-light fa-file-chart-line",n.Label=s.a.GetResource("Ren_CntrLedger"),n.ComParam="GeneralLedger";break;case"Generate":n.ImgData="btn_GenerateLink",n.ImgData="btn_Generate",n.Icon="fa-light fa-link",n.Label="Generate",n.ComParam="GenerateLink",n.Visible=!1;break;case"Email":if(!s.a.SessionManager.IsActionAssigned(this.CurrCostCenterID,"Email"))return;n.ImgData="btn_email",n.Icon="fa-light fa-envelope",n.Label=s.a.GetResource("SMTP_Email"),n.ComParam="Email";break;case"Save":this.ButtonSave=n,n.ImgData="btn_save",n.Icon="fa-light fa-save",n.Label=s.a.GetResource("Save"),n.ComParam="Save";break;case"SaveAndPrint":this.ButtonSaveAndPrint=n,n.ImgData="btn_saveprint",n.Icon="fas fa-print",n.Label=s.a.GetResource("SaveAndPrint"),n.ComParam="SaveAndPrint";break;case"Print":n.ImgData="btn_print",n.Icon="fa-light fa-print",n.Label=s.a.GetResource("Print"),n.ComParam="Print";break;case"PrintPreview":n.ImgData="btn_printpreview",n.Icon="fa-light fa-eye",n.Label=s.a.GetResource("VPDesigner_PrintPreview"),n.ComParam="PrintPreview";break;case"Export":n.ImgData="M18.217578,23.672803 L15.928203,25.875225 19.586218,29.677662 21.9492,27.404427 z M31.943426,14.111772 L22.376395,14.422588 24.927307,17.217916 19.793628,22.156612 23.52525,25.888237 28.639176,20.968543 31.31366,23.748616 z M15.055823,9.4929999 L28.683851,9.4929999 C28.683851,9.493 34.933001,15.898838 34.933001,15.898838 L34.933001,33.38019 C34.933001,33.677767 34.691761,33.919001 34.394176,33.919001 L15.055823,33.919001 C14.75824,33.919001 14.517,33.677767 14.517001,33.38019 L14.517001,10.031809 C14.517,9.7342329 14.75824,9.493 15.055823,9.4929999 z M24,2.9882507 C12.40202,2.9882507 3,12.353446 3,23.906 3,35.458553 12.40202,44.82375 24,44.82375 35.59798,44.82375 45,35.458553 45,23.906 45,12.353446 35.59798,2.9882507 24,2.9882507 z M24,0 C37.254833,9.5367432E-07 48.000002,10.70308 48.000002,23.906 48.000002,37.108917 37.254833,47.812 24,47.812 10.745166,47.812 0,37.108917 0,23.906 0,10.70308 10.745166,9.5367432E-07 24,0 z",n.Icon="fa-light fa-file-export",n.Label=s.a.GetResource("Export"),n.ComParam="Export",s.a.SessionManager.IsActionAssigned(this.CurrCostCenterID,"Export")||(n.Visible=!1);break;case"Renew":this.ButtonRenew=n,n.ImgData="btn_Renew",n.Icon="fa-light fa-file-alt",n.Label=s.a.GetResource("REN_CntrlRenew"),n.ComParam="Renew";break;case"Clone":this.ButtonRenew=n,n.ImgData="btn_Renew",n.Icon="fa-light fa-file-alt",n.Label="Clone",n.ComParam="Clone";break;case"Terminate":this.ButtonTerminate=n,n.ImgData="btn_Terminate",n.Icon="fa-light fa-file-times",n.Label=s.a.GetResource("REN_CntrctTerminate"),n.ComParam="Terminate";break;case"CancelTerminate":this.ButtonCancelTerminate=n,n.ImgData="btn_CancelTerminate",n.Icon="fa-light fa-file-check",n.Label="CancelTerminate",n.ComParam="CancelTerminate",n.Visible=!1;break;case"Reject":return;case"Approve":this.BtnApprove=n,n.ImgData="M12.245309,14.964942 L12.245309,17.617507 13.129513,17.617507 13.129513,14.964942 z M10.034798,14.511355 L10.034798,17.617507 11.803206,17.617507 11.803206,14.522849 13.571616,14.522849 13.571616,17.617507 13.828919,17.617507 14.95849,17.617507 15.340024,17.617507 15.340024,14.511355 z M12.815179,11.434381 L8.926029,14.52285 9.8751993,14.52285 15.523056,14.52285 16.430559,14.52285 z M14.036604,4.9942643 C14.460727,4.9853422 14.789422,5.2053321 14.789422,5.2053322 14.789422,5.2053321 14.811798,7.8219571 14.904227,8.1933987 14.997631,8.5638661 17.010658,12.479566 17.010658,12.479566 17.010658,12.686678 18.257969,12.893793 18.256999,13.101876 18.243375,14.902691 18.256999,16.44291 18.256999,18.307898 16.919199,17.958822 16.204084,19.008 13.345568,19.008 12.412514,19.008 11.244978,18.855338 10.262306,18.692954 L7.6898389,18.431391 C7.2442299,18.385689 6.9299684,17.883949 6.9873728,17.310259 7.0331005,16.86783 7.2899575,16.517784 7.6100566,16.400127 L7.2860667,16.367066 C6.7762434,16.314558 6.4094426,15.808932 6.4687919,15.235239 6.5193845,14.743223 6.8696451,14.382476 7.2880112,14.315384 L7.1566638,14.302744 C6.5826265,14.243429 6.1642606,13.730996 6.2236097,13.157302 6.2819864,12.584582 6.7937559,12.166466 7.3677931,12.224808 L8.9225607,12.383303 8.9283984,12.337602 7.6956764,12.212166 C7.1936352,12.161605 6.8336461,11.655003 6.892997,11.08131 6.9513738,10.507619 7.4047645,10.084642 7.9068058,10.136178 L12.034036,10.556237 12.619752,10.564988 C12.619752,10.564988 11.772316,10.180906 12.423219,7.1179664 12.788253,5.3956107 13.491306,5.0057365 14.036604,4.9942643 z M12.5,1.5624998 C6.4593853,1.5625002 1.562499,6.4593856 1.562499,12.5 1.562499,18.540611 6.4593853,23.4375 12.5,23.4375 18.540612,23.4375 23.437498,18.540611 23.437498,12.5 23.437498,6.4593856 18.540612,1.5625002 12.5,1.5624998 z M12.5,0 C19.403557,0 25,5.5964406 25,12.5 25,19.403559 19.403557,25 12.5,25 5.5964398,25 0,19.403559 0,12.5 0,5.5964406 5.5964398,0 12.5,0 z",n.Label="Approve",n.Icon="fa-light fa-user-check",n.ComParam="RejectVisiblity";break;case"ViewHistory":n.ImgData="M12.185519,12.386564 C12.193278,12.386564 12.201297,12.386965 12.20951,12.387747 12.217725,12.388529 12.226134,12.389692 12.234677,12.391215 12.24322,12.392739 12.251897,12.394622 12.260643,12.396845 12.269391,12.399069 12.278208,12.401632 12.287034,12.404515 12.295859,12.407397 12.304693,12.410599 12.313472,12.4141 12.322251,12.417602 12.330975,12.421402 12.339582,12.42548 12.348189,12.429558 12.356679,12.433916 12.364989,12.43853 12.373299,12.443145 12.381429,12.44801812.389317,12.453129 12.397204,12.45824 12.40485,12.463587 12.412189,12.469152 12.419529,12.474718 12.426565,12.4805 12.433232,12.486479 12.439899,12.492457 12.446198,12.498633 12.452067,12.504985 12.455002,12.508161 12.457829,12.511381 12.460541,12.514642 12.463252,12.517904 12.465848,12.521206 12.468321,12.524549 12.470794,12.52789 12.473144,12.531271 12.475362,12.534688 12.477581,12.538105 12.479668,12.541558 12.481617,12.545045 12.483565,12.54853212.485375,12.552054 12.487038,12.555606 12.488701,12.559158 12.490217,12.562742 12.491579,12.566354 12.492941,12.569966 12.494148,12.573608 12.495192,12.577274 12.496237,12.580942 12.49712,12.584635 12.497831,12.588352 12.498544,12.592069 12.499086,12.595809 12.49945,12.59957 12.499814,12.603332 12.499999,12.607114 12.499999,12.610915 L12.499999,13.7604 13.462979,13.7604 C13.467548,13.7604 13.472087,13.760566 13.476593,13.760892 13.481099,13.761219 13.485572,13.761706 13.490011,13.762346 13.494449,13.762988 13.498852,13.763783 13.503217,13.764726 13.507582,13.76567 13.511909,13.766762 13.516195,13.767996 13.520482,13.769231 13.524728,13.770608 13.528931,13.772122 13.533135,13.773635 13.537294,13.775285 13.541409,13.777066 13.545524,13.778847 13.549592,13.780758 13.553613,13.782794 13.557634,13.784831 13.561606,13.78699113.565528,13.789271 13.573371,13.79383 13.581011,13.798864 13.588428,13.804326 13.595844,13.809788 13.603037,13.815678 13.609986,13.821948 13.616934,13.828218 13.623638,13.834868 13.630077,13.841852 13.636517,13.848835 13.642691,13.856151 13.64858,13.863753 13.654468,13.871354 13.660071,13.879242 13.665368,13.887368 13.670665,13.895493 13.675656,13.903857 13.68032,13.912411 13.684984,13.920966 13.689321,13.929711 13.69331,13.9386 13.6973,13.94748813.700942,13.956521 13.704216,13.965649 13.707491,13.974777 13.710397,13.984001 13.712914,13.993273 13.715432,14.002546 13.71756,14.011867 13.71928,14.02119 13.721,14.030512 13.722311,14.039836 13.72319,14.049113 13.724071,14.058391 13.724522,14.067622 13.724522,14.076761 13.724522,14.085781 13.724071,14.094898 13.72319,14.104068 13.722311,14.113237 13.721,14.122457 13.71928,14.13168 13.71756,14.140903 13.715432,14.150131 13.712914,14.15931413.710397,14.168496 13.707491,14.177635 13.704216,14.186682 13.700942,14.195728 13.6973,14.204683 13.69331,14.213499 13.689321,14.222315 13.684984,14.230991 13.68032,14.239481 13.675656,14.247972 13.670665,14.256274 13.665368,14.264343 13.660071,14.272411 13.654468,14.280246 13.64858,14.287799 13.642691,14.295351 13.636517,14.302622 13.630077,14.309563 13.623638,14.316504 13.616934,14.323116 13.609986,14.329351 13.603037,14.335587 13.595844,14.34144413.588428,14.346877 13.581011,14.352311 13.573371,14.35732 13.565528,14.361856 13.561606,14.364125 13.557634,14.366276 13.553613,14.368302 13.549592,14.370329 13.545524,14.372231 13.541409,14.374004 13.537294,14.375776 13.533135,14.377419 13.528931,14.378926 13.524728,14.380433 13.520482,14.381804 13.516195,14.383034 13.511909,14.384263 13.507582,14.38535 13.503217,14.386291 13.498852,14.387231 13.494449,14.388022 13.490011,14.38866 13.485572,14.38929913.481099,14.389784 13.476593,14.390109 13.472087,14.390434 13.467548,14.390599 13.462979,14.390599 L12.36072,14.390599 C12.358357,14.390599 12.355709,14.390801 12.352807,14.39118 12.349904,14.391559 12.346749,14.392114 12.343375,14.39282 12.339999,14.393527 12.336404,14.394384 12.332621,14.395369 12.328838,14.396353 12.324867,14.397463 12.320741,14.398674 12.316615,14.399885 12.312334,14.401197 12.30793,14.402586 12.303527,14.403974 12.299,14.405437 12.294384,14.406951 12.285152,14.409979 12.275561,14.413208 12.265872,14.416438 12.256183,14.419668 12.246394,14.42289712.236769,14.425925 12.227143,14.428953 12.21768,14.43178 12.20864,14.434202 12.204121,14.435413 12.199706,14.436523 12.195431,14.437508 12.191155,14.438492 12.187018,14.43935 12.183052,14.440056 12.179086,14.440763 12.175292,14.441318 12.1717,14.441696 12.168109,14.442075 12.164721,14.442277 12.16157,14.442277 12.146051,14.442277 12.129852,14.440839 12.113387,14.438081 12.105154,14.436701 12.096854,14.434993 12.08854,14.432967 12.080224,14.43094312.071894,14.428602 12.063601,14.425961 12.055306,14.423319 12.047049,14.420377 12.038879,14.417148 12.03071,14.413919 12.022628,14.410404 12.014685,14.406618 12.006743,14.402831 11.99894,14.398772 11.991328,14.394456 11.983716,14.390141 11.976295,14.385569 11.969116,14.380754 11.961937,14.375938 11.955001,14.370881 11.948359,14.365595 11.941717,14.36031 11.935369,14.354796 11.929367,14.34907 11.923364,14.343343 11.917707,14.337403 11.912447,14.33126411.907187,14.325127 11.902325,14.318789 11.897911,14.312268 11.895704,14.309008 11.893609,14.305701 11.891633,14.30235 11.889657,14.298999 11.887799,14.295605 11.886067,14.292168 11.884334,14.288731 11.882726,14.285251 11.88125,14.281731 11.879775,14.278211 11.87843,14.27465 11.877223,14.27105 11.876016,14.26745 11.874948,14.263813 11.874023,14.260139 11.873099,14.256463 11.872319,14.252751 11.871691,14.249004 11.871061,14.245258 11.870583,14.24147611.870262,14.23766 11.869941,14.233846 11.869777,14.229998 11.869777,14.226118 L11.869777,12.610915 C11.869777,12.607114 11.869965,12.603332 11.870331,12.59957 11.870697,12.595809 11.871243,12.592069 11.871959,12.588352 11.872676,12.584635 11.873564,12.580942 11.874615,12.577274 11.875667,12.573608 11.876882,12.569966 11.878252,12.566354 11.879622,12.562742 11.881148,12.559158 11.882822,12.555606 11.884495,12.552054 11.886316,12.548532 11.888277,12.545045 11.890237,12.541558 11.892337,12.538105 11.894569,12.534688 11.896801,12.531271 11.899166,12.5278911.901653,12.524549 11.904141,12.521206 11.906752,12.517904 11.90948,12.514642 11.912207,12.511381 11.915051,12.508161 11.918002,12.504985 11.923905,12.498633 11.93024,12.492457 11.936944,12.486479 11.943648,12.4805 11.950722,12.474718 11.9581,12.469152 11.965479,12.463587 11.973163,12.45824 11.98109,12.453129 11.989017,12.448018 11.997187,12.443145 12.005536,12.43853 12.013885,12.433916 12.022413,12.429558 12.031056,12.42548 12.039701,12.42140212.04846,12.417602 12.057273,12.4141 12.066086,12.410599 12.074952,12.407397 12.083807,12.404515 12.092662,12.401632 12.101507,12.399069 12.110278,12.396845 12.119049,12.394622 12.127746,12.392739 12.136306,12.391215 12.144866,12.389692 12.15329,12.388529 12.161513,12.387747 12.169736,12.386965 12.177759,12.386564 12.185519,12.386564 z M12.304631,12.023569 C11.271066,12.023569 10.43098,12.863626 10.43098,13.898413 10.43098,13.930672 10.431801,13.962743 10.433422,13.994606 10.435043,14.026469 10.437464,14.058125 10.440667,14.089553 10.44387,14.120981 10.447853,14.152183 10.452598,14.183137 10.462088,14.245046 10.474622,14.305966 10.490043,14.36574 10.497754,14.395627 10.506186,14.425227 10.515321,14.454521 10.524455,14.483816 10.534292,14.512803 10.544811,14.541466 10.576366,14.627451 10.614063,14.71050110.657366,14.790082 10.70067,14.869663 10.749582,14.945776 10.803568,15.017887 10.857554,15.089997 10.916615,15.158105 10.980219,15.221676 11.00142,15.242867 11.023126,15.263553 11.045316,15.283715 11.089697,15.32404 11.136019,15.36227 11.184122,15.398248 11.232225,15.434224 11.28211,15.467948 11.333619,15.499259 11.385128,15.530571 11.438261,15.559471 11.492859,15.585801 11.547459,15.612131 11.603524,15.635892 11.660897,15.656925 11.746958,15.68847511.835961,15.713886 11.927376,15.732625 12.018792,15.751366 12.112617,15.763433 12.208321,15.768296 12.240222,15.769917 12.272332,15.770738 12.304631,15.770738 12.33691,15.770738 12.369001,15.769917 12.400884,15.768296 12.496532,15.763433 12.590308,15.751366 12.681678,15.732625 12.712134,15.726378 12.742323,15.719391 12.772225,15.711681 12.832029,15.696262 12.890685,15.677958 12.948035,15.656925 12.97671,15.646409 13.005058,15.63521 13.03306,15.6233513.061061,15.611489 13.088717,15.598967 13.116006,15.585801 13.143296,15.572637 13.170218,15.558828 13.196756,15.544398 13.223293,15.529967 13.249445,15.514915 13.275191,15.499259 13.300937,15.483603 13.326278,15.467344 13.351192,15.450502 13.376108,15.433661 13.400597,15.416236 13.424642,15.398248 13.448686,15.38026 13.472286,15.361708 13.49542,15.342612 13.518555,15.323517 13.541224,15.303878 13.56341,15.283715 13.585595,15.263553 13.607296,15.24286713.628491,15.221676 13.649688,15.200485 13.670379,15.178791 13.690547,15.156612 13.730882,15.112255 13.769121,15.06596 13.805106,15.017887 13.823098,14.99385 13.840526,14.969369 13.857372,14.944462 13.891062,14.89465 13.922419,14.843137 13.951284,14.790082 13.965717,14.763555 13.979527,14.736643 13.992694,14.709364 14.032196,14.627529 14.065914,14.542404 14.093315,14.454521 14.148118,14.278757 14.177652,14.091964 14.177652,13.898413 14.177652,13.8337414.17437,13.769826 14.167965,13.706831 14.164762,13.675333 14.160779,13.644065 14.156034,13.613046 14.151289,13.582026 14.145783,13.551257 14.139536,13.520757 14.127042,13.459755 14.111582,13.399829 14.093315,13.341137 14.084181,13.311791 14.074346,13.282753 14.063828,13.254044 14.05331,13.225333 14.04211,13.196951 14.030248,13.168918 14.006524,13.11285 13.98015,13.058172 13.951284,13.005044 13.936852,12.978479 13.921796,12.952302 13.906137,12.92653113.890479,12.900761 13.874217,12.875397 13.857372,12.85046 13.823681,12.800585 13.787658,12.752417 13.749458,12.706112 13.730359,12.68296 13.710715,12.660274 13.690547,12.638072 13.650212,12.59367 13.60778,12.55121 13.56341,12.51085 13.541224,12.49067 13.518555,12.471015 13.49542,12.451905 13.449151,12.413684 13.401022,12.377643 13.351192,12.343936 13.301363,12.310231 13.249831,12.278862 13.196756,12.249986 13.143682,12.221109 13.089063,12.19472613.03306,12.170996 12.977056,12.147265 12.919667,12.126185 12.861051,12.107914 12.773126,12.080508 12.68244,12.059422 12.589525,12.045187 12.496611,12.030952 12.401468,12.023569 12.304631,12.023569 z M12.304631,11.497982 C12.842546,11.497982 13.339167,11.675211 13.73927,11.974613 13.770047,11.997644 13.800253,12.021398 13.829863,12.045849 13.859472,12.070301 13.888486,12.095451 13.916878,12.121273 13.94527,12.147095 13.973041,12.173591 14.000165,12.200734 14.027289,12.227876 14.053767,12.255667 14.079573,12.284081 14.105379,12.312494 14.130513,12.341529 14.154951,12.371163 14.179388,12.400797 14.203129,12.431028 14.226148,12.461832 14.249166,12.492636 14.271463,12.52401214.293013,12.555936 14.314563,12.58786 14.335365,12.620332 14.355396,12.653325 14.375426,12.686319 14.394684,12.719835 14.413145,12.753849 14.431606,12.787863 14.449269,12.822373 14.46611,12.857357 14.482952,12.89234 14.49897,12.927796 14.514141,12.963699 14.529312,12.999602 14.543635,13.035953 14.557086,13.072725 14.570536,13.109497 14.583114,13.146691 14.594793,13.184283 14.606473,13.221875 14.617255,13.259864 14.627114,13.298225 14.636972,13.33658614.645909,13.375319 14.653896,13.414399 14.661884,13.453479 14.668923,13.492907 14.674989,13.532655 14.681056,13.572404 14.686148,13.612475 14.690243,13.652844 14.698431,13.73358 14.702626,13.815503 14.702626,13.898413 14.702626,14.1051 14.676408,14.305693 14.627114,14.497051 14.617255,14.535323 14.606473,14.573225 14.594793,14.610732 14.571434,14.685748 14.544482,14.759186 14.514141,14.830844 14.49897,14.866673 14.482952,14.902058 14.46611,14.93697214.449269,14.971887 14.431606,15.00633 14.413145,15.040279 14.394684,15.074229 14.375426,15.107683 14.355396,15.140617 14.335365,15.173552 14.314563,15.205965 14.293013,15.237834 14.271463,15.269703 14.249166,15.301025 14.226148,15.331779 14.203129,15.362531 14.179388,15.392713 14.154951,15.422299 14.130513,15.451886 14.105379,15.480877 14.079573,15.509247 14.053767,15.537617 14.027289,15.565367 14.000165,15.59247 13.973041,15.619574 13.94527,15.64603113.916878,15.671818 13.888486,15.697604 13.859472,15.72272 13.829863,15.74714 13.444936,16.064592 12.959241,16.264392 12.428007,16.291315 12.387143,16.293386 12.346009,16.294435 12.304631,16.294435 12.263253,16.294435 12.222119,16.293386 12.181255,16.291315 11.609156,16.262321 11.089873,16.03283 10.692384,15.671818 10.663992,15.646031 10.636221,15.619574 10.609097,15.59247 10.581973,15.565367 10.555495,15.537617 10.529689,15.509247 10.503883,15.48087710.478749,15.451886 10.454311,15.422299 10.429874,15.392713 10.406133,15.362531 10.383114,15.331779 10.337077,15.270272 10.293927,15.206486 10.253866,15.140617 10.213805,15.074749 10.176834,15.006801 10.143152,14.936972 10.109469,14.867143 10.079077,14.795435 10.052176,14.722047 10.038726,14.685354 10.026148,14.648241 10.014468,14.610732 9.9911087,14.535717 9.9713407,14.459124 9.9553657,14.381153 9.9473777,14.342168 9.9403386,14.302838 9.9342723,14.2631899.9282062,14.22354 9.9231133,14.183573 9.919019,14.143311 9.9149244,14.103049 9.9118288,14.062494 9.9097564,14.021669 9.9076841,13.980844 9.9066353,13.939751 9.9066355,13.898413 9.9066353,12.571843 10.980534,11.497982 12.304631,11.497982 z M14.390666,7.9833566 L14.390666,9.9791999 16.191841,9.9791999 z M8.0884445,7.4583998 L8.0884445,17.5416 16.911555,17.5416 16.911555,10.6094 13.760444,10.6094 13.760444,7.4583998 z M6.8279999,6.1979999 L14.561457,6.1979999 18.172,9.711365 18.172,18.802 6.8279999,18.802 z M12.5,1.5625005 C6.4593852,1.5625005 1.5624995,6.4593857 1.5624995,12.499999 1.5624995,18.540612 6.4593852,23.4375 12.5,23.4375 18.540613,23.4375 23.437501,18.540612 23.437501,12.499999 23.437501,6.4593857 18.540613,1.5625005 12.5,1.5625005 z M12.5,0 C19.403559,0 25.000001,5.5964408 25.000001,12.499999 25.000001,19.403556 19.403559,25 12.5,25 5.5964397,25 0,19.403556 0,12.499999 0,5.5964408 5.5964397,0 12.5,0 z",n.Icon="fa-light fa-history",n.Label=s.a.GetResource("History"),n.ComParam="ViewHistory",n.Visible=!1;break;case"Refund":this.ButtonRefund=n,n.ImgData="btn_Refund",n.Icon="fa-light fa-undo",n.Label="Refund",n.ComParam="RefundVisiblity";break;case"Fullrefund":this.BtnFullRefund=n,n.ImgData="btn_Fullrefund",n.Icon="fa fa-undo",n.Label="Full refund",n.ComParam="Fullrefund";break;case"Vacant":this.ButtonVacant=n,n.ImgData="",n.Icon="fa-light fa-times-circle",n.Label="Close",n.ComParam="VacantVisiblity";break;case"Suspend":this.ButtonSuspend=n,n.ImgData="btn_Suspend",n.Icon="fa-light fa-ban",n.Label="Suspend",n.ComParam="Suspend";break;case"ChangeLocation":n.ImgData="btn_ChangeLocation",n.Icon="fa-light fa-map-marker",n.Label=s.a.GetResource("DocChangeLocation"),n.ComParam="ChangeLocation";break;case"Customize":if(!s.a.SessionManager.IsActionAssigned(this.CurrCostCenterID,"Customize"))return;n.ImgData="M19.110601,18.563202 L18.265291,18.738087 17.987889,19.499944 18.564974,20.21662 19.416821,19.991161 19.640322,19.248151 z M11.293121,8.0873224 C11.392489,8.0890351 11.492839,8.0962141 11.593825,8.1091189 13.030063,8.2926578 14.050814,9.564903 13.873734,10.950758 13.840532,11.210605 13.767576,11.455998 13.661474,11.682009 L13.651067,11.702786 15.0279,13.228183 18.824523,9.3943181 C18.824523,9.394318 19.140872,9.2239439 19.470628,9.4361365 19.470628,9.4361366 20.359267,9.7847023 20.807165,10.825176 20.807165,10.825177 20.942139,10.88601 20.678352,11.320988 20.665603,11.342013 20.65192,11.363912 20.637248,11.386719 20.353802,11.827299 17.500436,14.61448 16.879653,15.218904 L16.850421,15.247358 18.77279,17.377155 18.853621,17.376846 C18.918926,17.378299 18.984755,17.383181 19.05092,17.391635 20.109579,17.526922 20.854148,18.525988 20.713963,19.623109 20.573775,20.720232 19.60192,21.499954 18.543262,21.364665 17.484603,21.229379 16.740033,20.230313 16.880219,19.13319 16.897742,18.996051 16.928261,18.86387 16.970319,18.737816 L17.003294,18.646406 15.074982,16.506892 15.06202,16.525836 C15.003895,16.617702 14.963834,16.711501 14.948184,16.805911 14.948184,16.805911 14.932747,17.339283 14.533682,17.313454 14.533682,17.313454 14.347342,17.244139 13.801846,16.827139 13.801846,16.827139 10.852632,19.565254 10.744088,19.768157 10.744088,19.768157 10.555843,20.023161 10.401911,20.337636 L9.3724868,21.206152 8.8539903,20.666849 9.7250609,19.663158 C9.7250612,19.663158 9.9756771,19.474508 10.329479,19.255787 L13.40929,16.405718 C13.40929,16.405718 12.865702,15.664404 12.865702,15.664404 12.865702,15.664404 12.8296,15.337628 13.228665,15.363457 13.228665,15.363457 13.445908,15.294698 13.724107,15.096941 L13.772371,15.061612 11.972145,13.06421 11.866173,13.089745 C11.574775,13.15262 11.266742,13.167893 10.952565,13.127744 9.5612088,12.949941 8.559778,11.750412 8.6595386,10.415667 8.6627567,10.372611 8.6671208,10.329414 8.6726546,10.286106 8.6975562,10.091219 8.7448197,9.9044652 8.811657,9.7279192 L8.8126342,9.725435 10.075197,11.113952 11.614002,10.744784 12.058911,9.3259526 10.976887,8.1005636 10.998316,8.0983235 C11.095369,8.0893632 11.193753,8.0856096 11.293121,8.0873224 z M15,1.875 C7.7512631,1.875 1.8750005,7.7512622 1.8750005,15 1.8750005,22.248737 7.7512631,28.124999 15,28.124999 22.248737,28.124999 28.125,22.248737 28.125,15 28.125,7.7512622 22.248737,1.875 15,1.875 z M15,0 C23.28427,0 30,6.7157291 30,15 30,23.284271 23.28427,29.999999 15,29.999999 6.7157292,29.999999 0,23.284271 0,15 0,6.7157291 6.7157292,0 15,0 z",n.Label=s.a.GetResource("Customize"),n.ComParam="Customize";break;case"Report":if(!s.a.SessionManager.IsActionAssigned(this.CurrCostCenterID,"Query"))return;n.ImgData="M9.6875,15.1455 L11.1625,15.1455 11.1625,16.620501 9.6875,16.620501 z M11.9,13.6705 L13.375,13.6705 13.375,16.620501 11.9,16.620501 z M14.1125,11.4455 L15.5875,11.4455 15.5875,16.620501 14.1125,16.620501 z M14.85,7.2476875 L14.85,9.2205 16.796262,9.2205 z M8.2124999,7.0080001 L8.2124999,17.358 17.0625,17.358 17.0625,9.9580002 14.1125,9.9580002 14.1125,7.0080001 z M7.4749997,5.5330001 L14.547625,5.5330001 17.8,8.8488002 17.8,18.833 7.4749997,18.833 z M12.499999,1.5625 C6.4593848,1.5625005 1.562499,6.4593862 1.562499,12.5 1.562499,18.540611 6.4593848,23.437499 12.499999,23.437499 18.540611,23.437499 23.4375,18.540611 23.4375,12.5 23.4375,6.4593862 18.540611,1.5625005 12.499999,1.5625 z M12.499999,0 C19.403557,0 25,5.596441 25,12.5 25,19.403559 19.403557,24.999999 12.499999,24.999999 5.5964394,24.999999 0,19.403559 0,12.5 0,5.596441 5.5964394,0 12.499999,0 z",n.Icon="fa-light fa-file-chart-line",n.Label=s.a.GetResource("Report"),n.ComParam="Report"}n.Width=a.toString(),n.SectionID=i.toString(),e.push(n)}GetButton(t){let e=this.ButtonsLeft.filter(e=>e.DBColumnName.toUpperCase()==t.toUpperCase());return null==e&&(e=this.ButtonsPopup.filter(e=>e.DBColumnName.toUpperCase()==t.toUpperCase())),e}SetButtonVisibility(t,e){let a=this.ButtonsLeft.filter(e=>e.ComParam.toUpperCase()==t.toUpperCase());!n.e.IsEmpty(a)&&a.length>0?a[0].Visible=e:(a=this.ButtonsPopup.filter(e=>e.ComParam.toUpperCase()==t.toUpperCase()),!n.e.IsEmpty(a)&&a.length>0&&(a[0].Visible=e))}CheckViewForUser(t){if(this.ScreenObject.CheckViewForUser(t>0),this.ContractParticular.forEach(e=>{null!=e.ID&&this.ScreenObject.SetView(e,t>0)}),this.ContractPayTerms.forEach(e=>{null!=e.ID&&this.ScreenObject.SetView(e,t>0)}),null!=this.ScreenObject.Data&&this.ScreenObject.Data.Tables.length>3&&this.ScreenObject.Data.Tables[this.ScreenObject.Data.Tables.length-2].length>0){let e=[];e=this.ScreenObject.Data.Tables[this.ScreenObject.Data.Tables.length-2].filter(0==t?t=>-1==t.CostCenterColID&&(1==t.Mode||3==t.Mode):t=>-1==t.CostCenterColID&&(2==t.Mode||3==t.Mode)),e.length>0?(this.ParticularsBodyVisible=Object(r.j)(e[0].IsVisible.toString()),this.ParticularsBodyReadOnly=!Object(r.j)(e[0].IsEditable.toString())):(this.ParticularsBodyVisible=!0,this.ParticularsBodyReadOnly=!1),t>0&&this.IsRecurPosted&&(this.ParticularsBodyReadOnly=!0),e=this.ScreenObject.Data.Tables[this.ScreenObject.Data.Tables.length-2].filter(0==t?t=>-2==t.CostCenterColID&&(1==t.Mode||3==t.Mode):t=>-2==t.CostCenterColID&&(2==t.Mode||3==t.Mode)),e.length>0?(this.PayTermsBodyVisible=Object(r.j)(e[0].IsVisible.toString()),this.PayTermsBodyReadOnly=!Object(r.j)(e[0].IsEditable.toString())):(this.PayTermsBodyVisible=!0,this.PayTermsBodyReadOnly=!1),e=this.ScreenObject.Data.Tables[this.ScreenObject.Data.Tables.length-2].filter(0==t?t=>-3==t.CostCenterColID&&(1==t.Mode||3==t.Mode):t=>t.CostCenterColID=1==t.Mode||3==t.Mode),e.length>0?(this.ButtonGenChq.Visible=Object(r.j)(e[0].IsVisible.toString()),this.ButtonGenChq.Enable=Object(r.j)(e[0].IsEditable.toString())):(this.ButtonGenChq.Visible=!0,this.ButtonGenChq.Enable=!0)}this.TotalDays.Enable=!1,this.StatusID.Enable=!1,this.CheckTabViewForUser(""),104!=this.CostCenterID&&this.DimWiseFields>5e4&&(this.SetViewByType(),this.SetFieldsposition())}SetViewByType(){let t,e=null,a=null,i=this.ScreenObject.Data.Tables[16].filter(t=>0==t.IsTab&&t.TypeID==this.DimWiseFieldsID);for(let n=0;n<i.length;n++){let a=i[n];if(null!=this.ScreenObject.HeaderFields&&(e=this.ScreenObject.HeaderFields.find(t=>t instanceof o.c&&t.DBColumnID==parseInt(a.CostCenterColID))),null==e)for(let t=0;t<this.ScreenObject.CustomTab.Pages.length&&(e=this.ScreenObject.CustomTab.Pages[t].Fields.find(t=>t instanceof o.c&&t.DBColumnID==parseInt(a.CostCenterColID)),null==e);t++);if(null!=e)t=parseInt(a.Hide),1!=t&&2!=t||(e.Visible=!1),t=parseInt(a.Mandatory),1!=t&&2!=t||(e.Mandatory=!0);else{var s=this.ContractParticular.find(t=>t.ID==a.CostCenterColID.toString());null==s&&(s=this.ContractPayTerms.find(t=>t.ID==a.CostCenterColID.toString())),null!=e&&(t=parseInt(a.Hide),1!=t&&2!=t||(s.IsVisible=!1))}}i=this.ScreenObject.Data.Tables[16].filter(t=>1==t.IsTab&&t.TypeID==this.DimWiseFieldsID);for(let n=0;n<i.length;n++){let e=i[n];a=this.ScreenObject.CustomTab.Pages.find(t=>t.DBColumnID==parseInt(e.CostCenterColID)),null!=a&&(t=parseInt(e.Hide),1!=t&&2!=t||(a.Visible=!1),t=parseInt(e.Mandatory),1!=t&&2!=t||(a.IsReadOnly=!0))}for(let n=0;n<this.ScreenObject.CustomTab.Pages.length;n++){let e=this.ScreenObject.CustomTab.Pages[n];i=this.ScreenObject.Data.Tables[16].filter(t=>1==t.IsTab&&t.TypeID==this.DimWiseFieldsID&&t.CostCenterColID==e.DBColumnID),i.length>0?(t=parseInt(i[0].Hide),1!=t&&2!=t||(e.Visible=!1),t=parseInt(i[0].Mandatory),1!=t&&2!=t||(e.IsReadOnly=!0)):(i=this.ScreenObject.Data.Tables[this.ScreenObject.Data.Tables.length-1].filter(t=>t.CCTabID==e.DBColumnID),i.length>0&&(e.IsReadOnly=!1,e.Visible=Object(r.j)(i[0].IsVisible)))}for(let n=0;n<this.ScreenObject.CustomTab.Pages.length;n++){let t=this.ScreenObject.CustomTab.Pages[n];if(t.Visible){this.ScreenObject.CustomTab.SelectedTab=t;break}}}CheckTabViewForUser(t){let e=this.ScreenObject.Data.Tables[this.ScreenObject.Data.Tables.length-2];this.ScreenObject.CustomTab.Pages.forEach(a=>{null!=e&&e.length>0&&e.some(t=>t.hasOwnProperty("CostCenterColID"))&&(e=e.filter(e=>0==e.CostCenterColID&&e.Tabid>0+t)),null!=e&&e.length>0&&e.some(t=>t.hasOwnProperty("CostCenterColID"))&&(e=e.filter(t=>t.Tabid==a.DBColumnID),e.length>0&&(a.IsReadOnly=!(n.e.IsEmpty(e[0].IsReadOnly)||!Object(r.j)(e[0].IsReadOnly)),a.Visible=!(n.e.IsEmpty(e[0].IsVisible)||!Object(r.j)(e[0].IsVisible))))})}SetFieldsposition(){let t=[]=this.ScreenObject.HeaderFields.filter(t=>t instanceof o.c&&1==t.Visible);t.sort((t,e)=>t.SectionSeqNo-e.SectionSeqNo),this.Setposition(t),this.ScreenObject.CustomTab.Pages.forEach(t=>{let e=t.Fields.filter(t=>t instanceof o.c&&1==t.Visible);e.sort((t,e)=>t.SectionSeqNo-e.SectionSeqNo),e.length>0&&this.Setposition(e)})}Setposition(t=[]){let e=0,a=0,i=1;for(let s=0;s<t.length;s++){let r=t[s];null!=r&&r.Visible&&(i=1,i=n.e.IntTryParse(r.ColumnSpan),i<1&&(i=1),a+i>4&&(e++,a=0),r.Row=e,r.Column=a,a+=i)}}RefershTitle(){this.DisplayName=0==this.ContractID?s.a.GetResource("Add")+" ":s.a.GetResource("Edit")+" ",""!=this.Title?this.DisplayName=this.DisplayName+n.e.StringValue(this.Title):95==this.CurrCostCenterID?this.DisplayName=this.DisplayName+"Contract":103==this.CurrCostCenterID?this.DisplayName=this.DisplayName+"Quotation":104==this.CurrCostCenterID?this.DisplayName=this.DisplayName+"Purchase Contract":129==this.CurrCostCenterID&&(this.DisplayName=this.DisplayName+"Reservation")}ReportView(){this.ReportDimension=new l.b(0),this.ReportDimension.CCID=this.CostCenterID,this.ReportDimension.TypeID=1,this.ReportDimension.SelectedValue=this.cntrct.ContractID,this.ReportDimension.OnPactListBoxValueChanged.Subscribe(this,"OnReportsLinkClick");let t=[];null!=this.ScreenObject.Data&&this.ScreenObject.Data.Tables.length>15&&this.ScreenObject.Data.Tables[15].forEach(e=>{let a=new S.a;a.DBColumnID=parseInt(e.ReportID),a.Label=e.ReportName.toString(),this.ScreenObject.Data.Columns[15].Contains("Shortcut")&&(a.KeyTip=e.Shortcut.toString()),this.ScreenObject.Data.Columns[15].Contains("DisplayAsPopup")&&""!=e.DisplayAsPopup.toString()&&(a.Dependantinuse=Object(r.j)(e.DisplayAsPopup.toString())),this.ScreenObject.Data.Columns[15].Contains("Width")&&""!=e.Width.toString()&&(a.Width=e.Width.toString()),this.ScreenObject.Data.Columns[15].Contains("Height")&&""!=e.Height.toString()&&(a.Length=e.Height.toString()),this.ScreenObject.Data.Columns[15].Contains("DocumentField")&&""!=e.DocumentField.toString()&&(a.Formula=e.DocumentField.toString()),this.ScreenObject.Data.Columns[15].Contains("mapxml")&&""!=e.mapxml.toString()&&(a.ToolTipDescription=e.mapxml.toString()),t.Contains(parseInt(e.ReportID))||(t.push(parseInt(e.ReportID)),this.ReportsList.push(a))})}OnReportsLinkClick(t){return Object(i.b)(this,void 0,void 0,(function*(){const{ReportViewModel:e}=yield Promise.all([a.e(2),a.e(1),a.e(3),a.e(5),a.e(4),a.e(6),a.e(7),a.e(10),a.e(9),a.e(8),a.e(12),a.e(11),a.e(13),a.e(19),a.e(15),a.e(21),a.e(20),a.e(16),a.e(14),a.e(18),a.e(17),a.e(22),a.e(23),a.e(24),a.e(25),a.e(28),a.e(30),a.e(29),a.e(32),a.e(31),a.e(27),a.e(26),a.e(35),a.e(37),a.e(38),a.e(36),a.e(33),a.e(34),a.e(39),a.e(40),a.e(41),a.e(212)]).then(a.bind(null,"ThYU")),{ReportViewComponent:i}=yield Promise.all([a.e(32),a.e(37)]).then(a.bind(null,"YU11"));let r,o=new e;this.ReportDimension.SelectedValue=this.cntrct.ContractID;let l={strXML:""};if(this.DisplayMessage=this.GetReportFilterXML(t,l),r=l.strXML,0==this.DisplayMessage.length){let a=this.ReportsList.find(e=>e.DBColumnID==parseInt(t));if(null!=a&&a.Dependantinuse)o.ReportViewModel_Document(this.CostCenterID,r,parseInt(t),!0,null,null),!n.e.IsEmpty(a.Width)&&parseFloat(a.Width)>0&&(o.RptWidth=parseFloat(a.Width)),!n.e.IsEmpty(a.length)&&parseFloat(a.length)>0&&(o.RptHeight=parseFloat(a.length)),o.DocumentObject=this,s.a.page.HideDialog(),s.a.page.ShowDialog(o,i,{Title:"",HideClose:!0,ShowCenter:!0});else{let a=new e;a.ReportViewModel_Document(this.CostCenterID,r,parseInt(t),!1,null,null),a.DocumentObject=this,s.a.page.HideDialog(),s.a.page.addNewTab({component:i,params:{obj:a}})}}}))}GetReportFilterXML(t,e){let a="";e.strXML="";let i=this.ScreenObject.Data.Tables[15];i.filter(e=>e.ReportID==t);let s,n=!1;i.forEach(t=>{Object(r.j)(t.GroupLevel)&&(n=!0)}),a+="<XML",n&&(a+=' GroupLevel="1"'),a+=" >";for(let r=0;r<i.length;r++){s=i[r].ReportField.toString(),a+="<Row ",a+='ColID ="'+s+'" ';for(let t=0;t<this.ScreenObject.StaticFields.length;t++)if(this.ScreenObject.StaticFields[t].DBColumnID==parseInt(i[r].DocumentField.toString()))if(this.ScreenObject.StaticFields[t]instanceof m.d){if(""==this.ScreenObject.StaticFields[t].Text)return alert(this.ErrorMessage+this.ScreenObject.StaticFields[t].Label+" '"),"Empty Value";"SNO"==i[r].SysColumnName.toString()?a+='Value ="'+this.ReportDimension.SelectedValue+'" ':a+='Value ="'+this.ScreenObject.StaticFields[t].Text+'" '}else if(this.ScreenObject.StaticFields[t]instanceof C.a){if(""==this.ScreenObject.StaticFields[t].TextBox.Text||""==this.ScreenObject.StaticFields[t].ComboBox.SelectedValue)return alert(this.ErrorMessage+this.ScreenObject.StaticFields[t].Label+" '"),"Empty Value";a+='Value ="'+this.ScreenObject.StaticFields[t].ComboBox.SelectedValue+'" '}else if(this.ScreenObject.StaticFields[t]instanceof m.c){if(""==this.ScreenObject.StaticFields[t].Text)return alert(this.ErrorMessage+this.ScreenObject.StaticFields[t].Label+" '"),"Empty Value";a+='Value ="'+this.ScreenObject.StaticFields[t].Text+'" '}else if(this.ScreenObject.StaticFields[t]instanceof b.a||this.ScreenObject.StaticFields[t]instanceof b.d||this.ScreenObject.StaticFields[t]instanceof b.c){if(this.ScreenObject.StaticFields[t]instanceof b.a||this.ScreenObject.StaticFields[t]instanceof b.d){if(""==this.ScreenObject.StaticFields[t].Text)return alert(this.ErrorMessage+this.ScreenObject.StaticFields[t].Label+" '"),"Empty Value";a+='Value ="'+this.ScreenObject.StaticFields[t].Date.ToString("dd/MMM/yyyy")+'" '}else if(this.ScreenObject.StaticFields[t]instanceof b.c){if(!this.ScreenObject.StaticFields[t].Date)return alert(this.ErrorMessage+this.ScreenObject.StaticFields[t].Label+" '"),"Empty Value";a+='Value ="'+this.ScreenObject.StaticFields[t].Date.ToString("dd/MMM/yyyy")+'" '}}else if(this.ScreenObject.StaticFields[t]instanceof l.b){if(""==this.ScreenObject.StaticFields[t].Text)return alert(this.ErrorMessage+this.ScreenObject.StaticFields[t].Label+" '"),"Empty Value";a+='Value ="'+this.ScreenObject.StaticFields[t].SelectedValue+'" '}else if(this.ScreenObject.StaticFields[t]instanceof k.a){if(""==this.ScreenObject.StaticFields[t].Text)return alert(this.ErrorMessage+this.ScreenObject.StaticFields[t].Label+" '"),"Empty Value";a+='Value ="'+this.ScreenObject.StaticFields[t].SelectedValue+'" '}this.ScreenObject.CustomTab.Pages.forEach(t=>{t.Fields.forEach(t=>{if(null!=t&&(t instanceof m.d||t instanceof C.a||t instanceof m.c||t instanceof b.a||t instanceof b.d||t instanceof b.c||t instanceof l.b||t instanceof k.a)&&t.DBColumnID==parseInt(i[r].DocumentField.toString()))if(t instanceof m.d){if(""==t.Text)return alert(this.ErrorMessage+t.Label+" '"),"Empty Value";a+='Value ="'+t.Text+'" '}else if(t instanceof C.a){if(""==t.TextBox.Text||""==t.ComboBox.SelectedValue)return alert(this.ErrorMessage+t.Label+" '"),"Empty Value";a+='Value ="'+t.TextBox.Text+'" '}else if(t instanceof m.c){if(""==t.Text)return alert(this.ErrorMessage+t.Label+" '"),"Empty Value";a+='Value ="'+t.Text+'" '}else if(t instanceof b.a||t instanceof b.d||t instanceof b.c){if(t||t){if(""==t.Text)return alert(this.ErrorMessage+t.Label+" '"),"Empty Value";a+='Value ="'+t.Date.ToString("dd/MMM/yyyy")+'" '}else if(t instanceof b.c){if(!t.Date)return alert(this.ErrorMessage+t.Label+" '"),"Empty Value";a+='Value ="'+t.Date.ToString("dd/MMM/yyyy")+'" '}}else if(t instanceof l.b){if(""==t.Text&&0==t.SelectedValue)return alert(this.ErrorMessage+t.Label+" '"),"Empty Value";a+='Value ="'+t.SelectedValue+'" '}else if(t instanceof k.a){if(""==t.Text)return alert(this.ErrorMessage+t.Label+" '"),"Empty Value";a+='Value ="'+t.SelectedValue+'" '}})}),a+=" />"}return a+="</XML>",e.strXML=a.toString(),""}BeforeRowDeletingEvent(t){!s.a.SessionManager.Preferences.ContainsKey("VATVersion")&&this.VatNode>0&&null!=this.SelectedRow&&Object.keys(this.SelectedRow).Contains("NodeID")&&this.SelectedRow.NodeID.toString()==this.VatNode.toString()&&(alert("Can't Delete Vat row."),t.CanExecute=!1)}ChangeLocation(t){this.LocationContract.SelectedValue=t,this.Property.CustomWhere="a.LocationID = "+t,this.AddUnitWhere(3),this.Landlord.LocationID=t,this.Accountant.LocationID=t,this.DataTableObj.Clear();for(let e=0;e<this.PayTermsDataTable.length;e++)"1"!=n.e.StringValue(this.PayTermsDataTable[e].IsFromRes)&&(this.PayTermsDataTableObj.removeRow(this.PayTermsDataTable[e]),e--);this.CalculateFooter();for(let e=0;e<6;e++){let t=this.DataTableObj.NewRow();t.Recurr=!1,this.DataTableObj.addRow(t);let e=this.PayTermsDataTableObj.NewRow();this.PayTermsDataTableObj.addRow(e)}this.TotalAmount.Text="0.00",this.NonRecAmount.Text="0.00",this.RecAmount.Text="0.00",this.Unit.SelectedValue=0,this.Property.SelectedValue=0,this.Property.Enable=!0,this.multiVisi=!1,this.StrMultiple="",this.SelectedUnits=""}onTabSelectionChanged(t){null!=this.ScreenObject.CustomTab.SelectedTab&&("Attachments"==this.ScreenObject.CustomTab.SelectedTab.Name?(this.ViewAttachments.OnShowNewAttachment(null),this.SetVisibilityFalse(),this.AttachmentVisibility=!0):"Activities"==this.ScreenObject.CustomTab.SelectedTab.Name&&null!=this.Activities?(this.ScreenObject.CustomTab.ColumnSpan=4,this.Activities.CRMCustomer.Text=this.Tenant.Text,this.Activities.Location.Text=s.a.SessionManager.LocationName,this.Activities.Location.Enable=!1,this.Activities.CRMCustomer.Enable=!1,this.SetVisibilityFalse(),this.ActVisibility=!0):"Notes"==this.ScreenObject.CustomTab.SelectedTab.Name?(this.ViewNotes.OnShowNewNotes(null),this.SetVisibilityFalse(),this.NoteVisibility=!0):(this.AttachmentVisibility=!1,this.NoteVisibility=!1,this.ActVisibility=!1))}onFieldsLoad(t){let e=[];95==t||104==t?(e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Contract"==t.SysTableName&&"PropertyID"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.Property.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Contract"==t.SysTableName&&"UnitID"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.Unit.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Contract"==t.SysTableName&&"TenantID"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.Tenant.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Contract"==t.SysTableName&&"RentAccID"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.RentRecAc.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Contract"==t.SysTableName&&"IncomeAccID"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.IncomeAc.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Contract"==t.SysTableName&&"RefNo"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.RefNo.DBColumnID=parseInt(e[0].CostCenterColID),this.RefNo.Visible=!1),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Contract"==t.SysTableName&&"SNO"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.SlNO.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Contract"==t.SysTableName&&"LocationID"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.LocationContract.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Contract"==t.SysTableName&&"DivisionID"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.DivisionContract.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Contract"==t.SysTableName&&"CurrencyID"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.CurrencyContract.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Contract"==t.SysTableName&&"SalesmanID"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.Salesman.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Contract"==t.SysTableName&&"AccountantID"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.Accountant.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Contract"==t.SysTableName&&"LandlordID"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.Landlord.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Contract"==t.SysTableName&&"Months"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.Months.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Contract"==t.SysTableName&&"TotalDays"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.TotalDays.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Contract"==t.SysTableName&&"RecurDuration"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.RecurDuration.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Contract"==t.SysTableName&&"TotalYears"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.TotalYears.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Contract"==t.SysTableName&&"Purpose"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.Purpose.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Contract"==t.SysTableName&&"Narration"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.Narration.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Contract"==t.SysTableName&&"StartDate"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.StartDate.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Contract"==t.SysTableName&&"EndDate"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.EndDate.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Contract"==t.SysTableName&&"VacancyDate"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.VacancyDate.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].find(t=>"REN_Contract"==t.SysTableName&&"ExtendTill"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.ExtndTill.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Contract"==t.SysTableName&&"TerminationDate"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.TerminateDate.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Contract"==t.SysTableName&&"ContractDate"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.ContractDate.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Contract"==t.SysTableName&&"StatusID"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.StatusID.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Contract"==t.SysTableName&&"ContractNumber"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.ContractNumber.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Contract"==t.SysTableName&&"TermsConditions"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.TermsConditions.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Contract"==t.SysTableName&&"BasedOn"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.BasedOn.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Contract"==t.SysTableName&&"RentAmt"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.RentAmt.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Contract"==t.SysTableName&&"NoOfUnits"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.NoOfUnits.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Contract"==t.SysTableName&&"AgeOfRenewal"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.AgeOfRenewal.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Contract"==t.SysTableName&&"ExpectedEndDate"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.ExpectedEndDate.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Contract"==t.SysTableName&&"GracePeriod"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.GracePeriod.DBColumnID=parseInt(e[0].CostCenterColID))):(e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Quotation"==t.SysTableName&&"PropertyID"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.Property.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Quotation"==t.SysTableName&&"UnitID"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.Unit.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Quotation"==t.SysTableName&&"TenantID"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.Tenant.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Quotation"==t.SysTableName&&"Narration"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.Narration.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Quotation"==t.SysTableName&&"StatusID"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.StatusID.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Quotation"==t.SysTableName&&"Date"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.ContractDate.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Quotation"==t.SysTableName&&"RentAccID"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.RentRecAc.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Quotation"==t.SysTableName&&"IncomeAccID"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.IncomeAc.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Quotation"==t.SysTableName&&"Purpose"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.Purpose.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Quotation"==t.SysTableName&&"StartDate"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.StartDate.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Quotation"==t.SysTableName&&"EndDate"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.EndDate.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Quotation"==t.SysTableName&&"SNO"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.SlNO.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Quotation"==t.SysTableName&&"LocationID"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.LocationContract.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Quotation"==t.SysTableName&&"DivisionID"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.DivisionContract.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Quotation"==t.SysTableName&&"CurrencyID"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.CurrencyContract.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Quotation"==t.SysTableName&&"SalesmanID"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.Salesman.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Quotation"==t.SysTableName&&"AccountantID"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.Accountant.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Quotation"==t.SysTableName&&"LandlordID"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.Landlord.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Quotation"==t.SysTableName&&"Months"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.Months.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Quotation"==t.SysTableName&&"TotalDays"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.TotalDays.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Quotation"==t.SysTableName&&"RecurDuration"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.RecurDuration.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Quotation"==t.SysTableName&&"TotalYears"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.TotalYears.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Quotation"==t.SysTableName&&"Number"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.ContractNumber.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Quotation"==t.SysTableName&&"TermsConditions"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.TermsConditions.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Quotation"==t.SysTableName&&"ExtendTill"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.ExtndTill.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Quotation"==t.SysTableName&&"NoOfUnits"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.NoOfUnits.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Quotation"==t.SysTableName&&"ExpectedEndDate"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.ExpectedEndDate.DBColumnID=parseInt(e[0].CostCenterColID)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Quotation"==t.SysTableName&&"GracePeriod"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.GracePeriod.DBColumnID=parseInt(e[0].CostCenterColID)),129==t&&(e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Quotation"==t.SysTableName&&"VacancyDate"==t.SysColumnName),e.length>0&&parseInt(e[0].CostCenterColID)>0&&(this.VacancyDate.DBColumnID=parseInt(e[0].CostCenterColID)),this.IsExtended.Visible=!1,this.BasedOn.Visible=!1,this.RentAmt.Visible=!1,this.RefNo.Visible=!1,this.RecurDuration.Visible=!1,this.TerminateDate.Visible=!1),this.ExpectedEndDate.Visible=!1,this.GracePeriod.Visible=!1)}ContractPrefix(t){if(Logger.InfoLog("AddEditRenContractViewModel ::Entering ContractPrefix"),null!=t&&"lostFocus"==t.toString()){if(this.cntrct.ContractPrefix=this.ContractNumber.ComboBox.SelectedValue,""!=this.ContractNumber.TextBox.Text&&(this.cntrct.ContractNumber=parseInt(this.ContractNumber.TextBox.Text)),this.ContractID=0,95!=this.CurrCostCenterID&&104!=this.CurrCostCenterID){let t=s.a.rental.GetQuotationID(this.cntrct.ContractPrefix,this.cntrct.ContractNumber);if(null!=t&&t.Tables.length>0&&t.Tables[0].length>0&&t.Columns[0].Contains("QuotationID")&&!n.e.IsEmpty(t.Tables[0][0].QuotationID)&&(this.ContractID=parseInt(t.Tables[0][0].QuotationID.toString())),this.ContractID>0)this.LoadEditData(null),this.CheckViewForUser(this.cntrct.ContractID);else{this.SaveAndPrintContactID=0,this.RenewRefID=0,this.DataTableObj.Clear(),this.PayTermsDataTableObj.Clear(),this.CalculateFooter(),this.TotalYears.Text="",this.Months.Text="",this.NonRecAmount.Text="0.00",this.RecAmount.Text="0.00",this.TotalAmount.Text="0.00",this.StartDate.Date=null,this.EndDate.Date=null,this.ViewNotes.NotesListObj.Clear(),this.ViewNotes.DeletedNotes.Clear(),this.ViewAttachments.AttachmentsListObj.Clear(),this.ViewAttachments.OnShowNewAttachment(null),this.ViewAttachments.DeletedAttachments.Clear(),null!=this.ViewActivities&&this.ViewActivities.ActivityGridData.Clear(),this.ClearData();for(let t=0;t<6;t++){let t=this.DataTableObj.NewRow();t.Recurr=!1,this.DataTableObj.addRow(t);let e=this.PayTermsDataTableObj.NewRow();this.PayTermsDataTableObj.addRow(e)}this.PayTermsDataTableObj.UpdateTotals(),this.DataTableObj.UpdateTotals(),Logger.InfoLog("AddEditRenContractViewModel :: Exiting OnSaveContract")}}else this.LoadEditData(null),this.CheckViewForUser(this.cntrct.ContractID);this.PropID=this.Property.SelectedValue,this.UnitTempID=this.Unit.SelectedValue,this.FlagPrefixChange=!0}Logger.InfoLog("AddEditRenContractViewModel ::Exiting ContractPrefix")}OnContractPrefixChanged(t){if(Logger.InfoLog("AddEditRenContractViewModel ::Entering OnContractPrefixChanged"),!this.FlagPrefixChange)if(this.ScreenObject.Data.Tables.length>13&&this.ScreenObject.Data.Tables[13].length>0){let e;0!=this.Property.SelectedValue?e=this.ScreenObject.Data.Tables[13].find(t=>t.CONTRACTPREFIX==this.Property.SelectedValue.toString()):null==t||n.e.IsEmpty(t)||"lostFocus"==t.toString()||(e=this.ScreenObject.Data.Tables[13].find(e=>e.CONTRACTPREFIX==t.ComboBox.GetselectedItem().Value)),null!=t&&(this.ContractNumber.TextBox.Text=Object(V.isNullOrUndefined)(e)||null==e.ContractNumber||n.e.IsEmpty(e.ContractNumber)?"1":e.ContractNumber.toString())}else null!=t&&(this.ContractNumber.TextBox.Text="1");Logger.InfoLog("AddEditRenContractViewModel ::Exiting OnContractPrefixChanged")}GetData(t){if(Logger.InfoLog("AddEditRenContractViewModel ::Entering GetData"),""!=this.ContractNumber.TextBox.Text){let e=0;if(null!=this.ContractNumber.ComboBox.SelectedItem&&""!=this.ContractNumber.ComboBox.SelectedItem.Aliasname&&(e=parseInt(this.ContractNumber.ComboBox.SelectedItem.Aliasname)),"NEXT"==t.toString().toUpperCase()){let t=(parseInt(this.ContractNumber.TextBox.Text)+1).toString();for(;t.length<e;)t="0"+t;this.ContractNumber.TextBox.Text=t,this.ContractPrefix("lostFocus")}else if(parseInt(this.ContractNumber.TextBox.Text)>1){let t=(parseInt(this.ContractNumber.TextBox.Text)-1).toString();for(;t.length<e;)t="0"+t;this.ContractNumber.TextBox.Text=t,this.ContractPrefix("lostFocus")}}Logger.InfoLog("AddEditRenContractViewModel ::Extiing GetData")}OnBeginEdit(t){try{let e=t.args.item;if(n.e.IsEmpty(t.args.item.IsFreezed)||"1"!=e.IsFreezed.toString()&&"True"!=e.IsFreezed.toString()||(t.Cancel=!0),22==t.args.cell)n.e.IsEmpty(t.args.item.DocumentType)||"369"!=e.DocStatusID.toString()&&"429"!=e.DocStatusID.toString()||(104==this.CurrCostCenterID&&"14"==e.DocumentType.toString()?t.Cancel=!0:"19"!=e.DocumentType.toString()&&"16"!=e.DocumentType.toString()||(t.Cancel=!0));else if(!n.e.IsEmpty(t.args.item.Amount)&&104!=this.CurrCostCenterID&&0==this.Unit.SelectedValue&&""==this.SelectedUnits)return void alert(s.a.GetResource("PleaseselectUnit"))}catch(e){Logger.ErrorLog("AddEditRenContractViewModel::OnBeginEdit Error message"+e)}}ClearData(){this.Vattype=0;let t=this.GetButton("ViewHistory");null!=t&&(t.Visible=!1),this.SetButtonVisibility("ViewHistory",!1),this.WFDocLevelList.Clear(),this.cntrct.Wid=0,this.cntrct.ContractID=0,this.Property.SelectedValue=0,this.Property.SelectedValueText="",this.Unit.SelectedValue=0,this.AddUnitWhere(4),this.Tenant.SelectedValue=0,this.FilterTenantBasedOnUnit&&(this.Tenant.CustomWhere=""),this.NoofCheques=0,this.FirstNumber="0",this.InstPeriod=0,this.PayeeBnk="",this.DebitAcc=0,this.TotalDays.Text="",this.TotalAmount.Text="",this.NonRecAmount.Text="",this.GracePeriod.Text="",this.RecAmount.Text="",this.Property.Enable=!0,this.multiVisi=!1,this.StrMultiple="",this.SelectedUnits="",this.cntrct.multiName="",this.cntrct.MultiIDS="",this.ScreenObject.CustomTab.Pages.forEach(t=>{t.Fields.forEach(t=>{t instanceof o.c&&this.ScreenObject.SetProperty_DefaultValue(t)})}),this.IncomeAc.SelectedValue=0,this.IncomeAc.SelectedValueText="",this.RentRecAc.SelectedValue=0,this.RentRecAc.SelectedValueText="",this.Landlord.SelectedValueText="",this.Landlord.SelectedValue=0,this.Salesman.SelectedValueText="",this.Salesman.SelectedValue=0,this.Unit.SelectedValueText="",this.Unit.SelectedValue=0,this.Accountant.SelectedValueText="",this.Accountant.SelectedValue=0,this.CntStatus="[New]",this.RefershTitle(),this.CheckViewForUser(this.cntrct.ContractID),this.DataTableObj.Clear(),this.PayTermsDataTableObj.Clear(),this.DataTableObj.UpdateTotals(),this.PayTermsDataTableObj.UpdateTotals()}DraftVisible(t){let e=this.GetButton("Draft");null!=e&&(e.Visible=t),this.SetButtonVisibility("SaveDraft",t),e=this.GetButton("LoadDraft"),null!=e&&(e.Visible=t),this.SetButtonVisibility("LoadDraft",t)}LoadEditData(t){Logger.InfoLog("AddEditRenContractViewModel ::Entering GetData");try{let e=!1;this.draftid=0,this.ClearData(),this.DraftVisible(!1),this.strRenew="Edit";let a=t;if(null==a&&(a=95==this.CurrCostCenterID||104==this.CurrCostCenterID?s.a.rental.GetContractDetails(this.ContractID,this.CurrCostCenterID,n.e.StringValue(this.cntrct.ContractPrefix),this.cntrct.ContractNumber):s.a.rental.GetQuotationDetails(this.ContractID)),a.Tables.length>0&&a.Tables[0].length>0){a.Columns[0].Contains("Status")&&(this.CntStatus=n.e.StringValue(a.Tables[0][0].Status)),a.Columns[0].Contains("RenewRefID")&&!n.e.IsEmpty(a.Tables[0][0].RenewRefID)&&parseInt(a.Tables[0][0].RenewRefID.toString())>0&&(this.RenewRefID=parseInt(a.Tables[0][0].RenewRefID.toString())),a.Columns[0].Contains("IsOpening")&&!n.e.IsEmpty(a.Tables[0][0].IsOpening)&&(this.IsOpening=Object(r.j)(a.Tables[0][0].IsOpening.toString())),a.Columns[0].Contains("ParentContractID")&&!n.e.IsEmpty(a.Tables[0][0].ParentContractID)&&parseInt(a.Tables[0][0].ParentContractID.toString())>0?this.ParentContractID=parseInt(a.Tables[0][0].ParentContractID.toString()):(this.ParentContractID=0,this.RefNo.Visible=!1),a.Columns[0].Contains("Refno")&&!n.e.IsEmpty(a.Tables[0][0].Refno)&&(this.RefNo.Text=a.Tables[0][0].Refno.toString()),this.RefNo.Enable=!1;let t=this.GetButton("Subcontract");if(null!=t&&(t.Visible=!(this.ParentContractID>0)&&s.a.SessionManager.IsActionAssigned(this.CurrCostCenterID,"SubContract"),this.SetButtonVisibility("AddContract",t.Visible)),a.Columns[0].Contains("isContractRenewed")&&!n.e.IsEmpty(a.Tables[0][0].isContractRenewed)&&Object(r.j)(a.Tables[0][0].isContractRenewed.toString())&&(e=Object(r.j)(a.Tables[0][0].isContractRenewed.toString())),a.Columns[0].Contains("IsRecurPosted")&&!n.e.IsEmpty(a.Tables[0][0].IsRecurPosted)&&Object(r.j)(a.Tables[0][0].IsRecurPosted.toString())&&(this.IsRecurPosted=Object(r.j)(a.Tables[0][0].IsRecurPosted.toString())),this.IsRecurPosted&&(this.ParticularsBodyReadOnly=this.IsRecurPosted),a.Columns[0].Contains("QuotationID")&&!n.e.IsEmpty(a.Tables[0][0].QuotationID)?(this.LinkedQuotationID=parseInt(a.Tables[0][0].QuotationID.toString()),this.LinkedQuotationID>0&&(t=this.GetButton("Quotation"),null!=t&&(a.Columns[0].Contains("QuotationCCID")&&!n.e.IsEmpty(a.Tables[0][0].QuotationCCID.toString())&&("103"==a.Tables[0][0].QuotationCCID.toString()?t.Label="Quotation":"129"==a.Tables[0][0].QuotationCCID.toString()&&(t.Label="Reservation")),t.Visible=!0,this.SetButtonVisibility("ViewQuotation",!0)))):this.LinkedQuotationID=0,this.ContractExists=!(129!=this.CurrCostCenterID&&103!=this.CurrCostCenterID||!a.Columns[0].Contains("ContractExists")||n.e.IsEmpty(a.Tables[0][0].ContractExists))&&Object(r.j)(a.Tables[0][0].ContractExists.toString()),this.cntrct.GUID=n.e.StringValue(a.Tables[0][0].GUID),n.e.IsEmpty(a.Tables[0][0].ContractID)?(this.cntrct.ContractID=0,this.ContractID=0):(this.cntrct.ContractID=parseInt(a.Tables[0][0].ContractID),this.ContractID=parseInt(a.Tables[0][0].ContractID)),t=this.GetButton("Generate"),null!=t&&this.ContractID>0&&(103==this.CurrCostCenterID||129==this.CurrCostCenterID)&&!this.ContractExists&&(t.Visible=!0),this.SetButtonVisibility("GenerateLink",t.Visible),this.ContractNumber.ComboBox.SelectedValue=n.e.StringValue(a.Tables[0][0].ContractPrefix),this.ContractNumber.TextBox.Text=n.e.StringValue(a.Tables[0][0].ContractNumber),this.ContractDate.Date=new Date(a.Tables[0][0].ContractDate),this.ContractNumber.ComboBox.Enable=!1,this.ContractNumber.TextBox.Enable=!1,this.ContractNumber.Enable=!1,this.ContractNumber.Enable=!1,this.StatusID.SelectedValue=n.e.StringValue(a.Tables[0][0].StatusID),this.BasedOn.SelectedValue=n.e.StringValue(a.Tables[0][0].BasedOn),a.Columns[0].Contains("RentAmt")&&(this.RentAmt.Text=n.e.StringValue(a.Tables[0][0].RentAmt)),a.Columns[0].Contains("RecurDuration")&&!n.e.IsEmpty(a.Tables[0][0].RecurDuration)&&(this.RecurDuration.Text=a.Tables[0][0].RecurDuration.toString()),a.Columns[0].Contains("SNO")&&(this.SlNO.Text=n.e.StringValue(a.Tables[0][0].SNO)),this.RefershTitle(),this.ContractID>0&&(this.ButtonRenew.Enable=!0,this.ButtonTerminate.Enable=!0,this.SetButtonVisibility("Renew",!0),this.SetButtonVisibility("Terminat",!0),"428"==this.StatusID.SelectedValue||"465"==this.StatusID.SelectedValue||"477"==this.StatusID.SelectedValue||"478"==this.StatusID.SelectedValue||"479"==this.StatusID.SelectedValue||"481"==this.StatusID.SelectedValue?(this.ButtonSave.Enable=!1,this.ButtonSaveAndPrint.Enable=!1,this.ButtonRenew.Enable=!1,this.ButtonTerminate.Enable=!1,this.BtnApprove.Visible=!1,this.ButtonCancelTerminate.Visible=!0,this.ButtonRefund.Visible=!1,this.ButtonVacant.Visible=!1,this.ButtonSuspend.Visible=!0,this.BtnFullRefund.Visible=!1,this.SetButtonEnable("Save",!1),this.SetButtonEnable("SaveAndPrint",!1),this.SetButtonEnable("Renew",!1),this.SetButtonEnable("Terminat",!1),this.SetButtonVisibility("RejectVisiblity",!1),this.SetButtonVisibility("Terminat",!0),this.SetButtonVisibility("CancelTerminate",!0),this.SetButtonVisibility("RefundVisiblity",!1),this.SetButtonVisibility("Vacant",!1),this.SetButtonVisibility("Suspend",!0),this.SetButtonVisibility("Fullrefund",!1),s.a.SessionManager.HideUnathorizedAccess?this.ButtonSuspend.Visible=s.a.SessionManager.IsActionAssigned(this.CurrCostCenterID,"Suspend"):this.ButtonSuspend.Enable=s.a.SessionManager.IsActionAssigned(this.CurrCostCenterID,"Suspend"),s.a.SessionManager.HideUnathorizedAccess?this.ButtonCancelTerminate.Visible=s.a.SessionManager.IsActionAssigned(this.CurrCostCenterID,"CancelTerminate"):(this.ButtonCancelTerminate.Enable=s.a.SessionManager.IsActionAssigned(this.CurrCostCenterID,"CancelTerminate"),this.TerminateDate.Visible=!0),"465"!=this.StatusID.SelectedValue||""!=a.Tables[0][0].WorkFlowID.toString()&&parseInt(a.Tables[0][0].WorkFlowID.toString())>0&&"1"==a.Tables[0][0].wfaction.toString()||(this.BtnApprove.Visible=!s.a.SessionManager.IsActionAssigned(this.CurrCostCenterID,"UnApproveOnTerminate"),this.BtnApprove.Label="Approve Termination"),this.ButtonCancelTerminate.Label="477"==this.StatusID.SelectedValue?"Cancel Full Refund":"CancelTerminate"):"451"==this.StatusID.SelectedValue?(s.a.SessionManager.IsActionAssigned(this.CurrCostCenterID,"Resave cancelled contract")?(this.ButtonSave.Visible=this.ButtonSave.Enable=!0,this.ButtonSave.Visible=this.ButtonSaveAndPrint.Enable=!0,this.SetButtonVisibility("Save",!0),this.SetButtonVisibility("SaveAndPrint",!0)):(this.ButtonSave.Enable=!1,this.ButtonSaveAndPrint.Enable=!1,this.SetButtonEnable("Save",!1),this.SetButtonEnable("SaveAndPrint",!1)),this.ButtonRenew.Enable=!1,this.ButtonTerminate.Enable=!1,this.BtnApprove.Visible=!1,this.ButtonCancelTerminate.Visible=!1,this.ButtonRefund.Visible=!1,this.BtnFullRefund.Visible=!1,this.ButtonVacant.Visible=!1,this.ButtonSuspend.Visible=!1,this.SetButtonVisibility("Renew",!1),this.SetButtonVisibility("Terminate",!1),this.SetButtonVisibility("RejectVisiblity",!1),this.SetButtonVisibility("CancelTerminate",!1),this.SetButtonVisibility("RefundVisiblity",!1),this.SetButtonVisibility("Vacant",!1),this.SetButtonVisibility("Suspend",!1),this.SetButtonVisibility("Fullrefund",!1)):"450"==this.StatusID.SelectedValue||"480"==this.StatusID.SelectedValue?(this.ButtonSave.Enable=!1,this.ButtonSaveAndPrint.Enable=!1,this.ButtonRenew.Enable=!1,this.ButtonTerminate.Enable=!1,this.BtnApprove.Visible=!1,this.ButtonRefund.Visible=!1,this.ButtonVacant.Visible=!1,this.ButtonSuspend.Visible=!1,this.ButtonCancelTerminate.Visible=!0,this.ButtonCancelTerminate.Label="480"==this.StatusID.SelectedValue?"Cancel Close":"Cancel Refund",this.VacancyDate.Visible=!0,this.BtnFullRefund.Visible=!1,this.SetButtonVisibility("RejectVisiblity",!1),this.SetButtonVisibility("RefundVisiblity",!1),this.SetButtonVisibility("Terminate",!1),this.SetButtonVisibility("Vacant",!1),this.SetButtonVisibility("Suspend.",!1),this.SetButtonVisibility("CancelTerminate",!0),this.SetButtonVisibility("Fullrefund.",!1)):"471"==this.StatusID.SelectedValue?(this.ButtonSave.Enable=!1,this.ButtonSaveAndPrint.Enable=!1,this.BtnApprove.Visible=!1,this.ButtonVacant.Visible=!1,this.ButtonSuspend.Visible=!1,this.ButtonCancelTerminate.Visible=!0,this.ButtonCancelTerminate.Label="Cancel Close",this.SetButtonVisibility("RejectVisiblity",!1),this.SetButtonVisibility("Vacant",!1),this.SetButtonVisibility("Suspend.",!1),this.SetButtonVisibility("CancelTerminate",!0)):(this.ButtonSave.Enable=!0,this.ButtonSaveAndPrint.Enable=!0,this.ButtonTerminate.Enable=!0,this.BtnApprove.Visible=!1,this.BtnFullRefund.Visible=!0,this.ButtonRefund.Visible=!0,this.ButtonVacant.Visible=!0,this.ButtonSuspend.Visible=!0,this.SetButtonVisibility("RejectVisiblity",!1),this.SetButtonVisibility("Terminate",!0),this.SetButtonVisibility("RefundVisiblity",!0),this.SetButtonVisibility("Vacant",!0),this.SetButtonVisibility("Suspend.",!0),s.a.SessionManager.HideUnathorizedAccess?this.ButtonRenew.Visible=s.a.SessionManager.IsActionAssigned(this.CurrCostCenterID,"Renew"):this.ButtonRenew.Enable=s.a.SessionManager.IsActionAssigned(this.CurrCostCenterID,"Renew"),s.a.SessionManager.HideUnathorizedAccess?this.ButtonRefund.Visible=s.a.SessionManager.IsActionAssigned(this.CurrCostCenterID,"Refund"):this.ButtonRefund.Enable=s.a.SessionManager.IsActionAssigned(this.CurrCostCenterID,"Refund"),s.a.SessionManager.HideUnathorizedAccess?this.BtnFullRefund.Visible=s.a.SessionManager.IsActionAssigned(this.CurrCostCenterID,"Full Refund"):this.BtnFullRefund.Enable=s.a.SessionManager.IsActionAssigned(this.CurrCostCenterID,"Full Refund"),s.a.SessionManager.HideUnathorizedAccess?this.ButtonVacant.Visible=s.a.SessionManager.IsActionAssigned(this.CurrCostCenterID,"Close"):this.ButtonVacant.Enable=s.a.SessionManager.IsActionAssigned(this.CurrCostCenterID,"Close"),s.a.SessionManager.HideUnathorizedAccess?this.ButtonSuspend.Visible=s.a.SessionManager.IsActionAssigned(this.CurrCostCenterID,"Suspend"):this.ButtonSuspend.Enable=s.a.SessionManager.IsActionAssigned(this.CurrCostCenterID,"Suspend")),e&&(this.ButtonSuspend.Enable=!1,this.ButtonRefund.Enable=!1,this.ButtonVacant.Enable=!1,this.ButtonRenew.Enable=!1,this.ButtonTerminate.Enable=!1,this.BtnFullRefund.Enable=!1,this.SetButtonVisibility("Terminate",!1),this.SetButtonVisibility("Renew",!1),this.SetButtonVisibility("RefundVisiblity",!1),this.SetButtonVisibility("Vacant",!1),this.SetButtonVisibility("Suspend.",!1),this.SetButtonVisibility("Fullrefund.",!1))),this.IsExtended.Enable&&95==this.CurrCostCenterID&&"427"==this.StatusID.SelectedValue&&a.Columns[0].Contains("IsExtended")?(this.IsExtended.Visible=!0,this.IsExtended.SelectedValue=!n.e.IsEmpty(a.Tables[0][0].IsExtended)&&"true"==a.Tables[0][0].IsExtended.toString().toLowerCase()||"1"==a.Tables[0][0].IsExtended.toString()?"True":"false"):this.IsExtended.Visible=!1,this.LocationContract.SelectedValue=a.Columns[0].Contains("LocationID")&&!n.e.IsEmpty(a.Tables[0][0].LocationID)&&null!=a.Tables[0][0].LocationID?parseInt(a.Tables[0][0].LocationID):0,this.DivisionContract.SelectedValue=a.Columns[0].Contains("DivisionID")&&!n.e.IsEmpty(a.Tables[0][0].DivisionID)&&null!=a.Tables[0][0].DivisionID?parseInt(a.Tables[0][0].DivisionID):0,this.CurrencyContract.SelectedValue=a.Columns[0].Contains("CurrencyID")&&!n.e.IsEmpty(a.Tables[0][0].CurrencyID)&&null!=a.Tables[0][0].CurrencyID?parseInt(a.Tables[0][0].CurrencyID):0,this.Property.SelectedValue=this.Property.PreviousSelectedValue=this.PropID=n.e.IsEmpty(a.Tables[0][0].PropertyID)||null==a.Tables[0][0].PropertyID?0:parseInt(a.Tables[0][0].PropertyID),this.Unit.SelectedValue=this.Unit.PreviousSelectedValue=this.UnitTempID=n.e.IsEmpty(a.Tables[0][0].UnitID)||null==a.Tables[0][0].UnitID?0:parseInt(a.Tables[0][0].UnitID),this.AddUnitWhere(5),this.Tenant.SelectedValue=this.Tenant.PreviousSelectedValue=this.TenantTempID=n.e.IsEmpty(a.Tables[0][0].TenantID)||null==a.Tables[0][0].TenantID?0:parseInt(a.Tables[0][0].TenantID),this.RentRecAc.SelectedValue=n.e.IsEmpty(a.Tables[0][0].RentAccID)||null==a.Tables[0][0].RentAccID?0:parseInt(a.Tables[0][0].RentAccID),this.IncomeAc.SelectedValue=n.e.IsEmpty(a.Tables[0][0].IncomeAccID)||null==a.Tables[0][0].IncomeAccID?0:parseInt(a.Tables[0][0].IncomeAccID),n.e.IsEmpty(a.Tables[0][0].StartDate)||(this.StartDate.Date=new Date(a.Tables[0][0].StartDate)),n.e.IsEmpty(a.Tables[0][0].EndDate)||(this.EndDate.Date=new Date(a.Tables[0][0].EndDate)),a.Columns[0].Contains("VacancyDate")&&!n.e.IsEmpty(a.Tables[0][0].VacancyDate)&&(this.VacancyDate.Date=new Date(a.Tables[0][0].VacancyDate)),!a.Columns[0].Contains("ExtndTill")||n.e.IsEmpty(a.Tables[0][0].ExtndTill)||n.e.IsEmpty(a.Tables[0][0].ExtndTill)||(this.ExtndTill.Date=new Date(a.Tables[0][0].ExtndTill)),a.Columns[0].Contains("TerminationDate")&&""!=n.e.StringValue(a.Tables[0][0].TerminationDate)&&(this.TerminateDate.Date=new Date(a.Tables[0][0].TerminationDate)),a.Columns[0].Contains("ExpectedEndDate")&&""!=n.e.StringValue(a.Tables[0][0].ExpectedEndDate)&&(this.EnableGracePeriod?(this.EndDate.Date=new Date(a.Tables[0][0].ExpectedEndDate),this.ExpectedEndDate.Date=new Date(a.Tables[0][0].EndDate)):this.ExpectedEndDate.Date=new Date(a.Tables[0][0].ExpectedEndDate)),this.Purpose.Text=n.e.StringValue(a.Tables[0][0].Purpose),this.Narration.Text=n.e.StringValue(a.Tables[0][0].Narration),this.TotalAmount.Text=n.e.IsEmpty(a.Tables[0][0].TotalAmount)||n.e.IsEmpty(a.Tables[0][0].TotalAmount)?"0.00":parseFloat(a.Tables[0][0].TotalAmount).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()),this.GracePeriod.Text=a.Columns[0].Contains("GracePeriod")?n.e.StringValue(a.Tables[0][0].GracePeriod):"0",this.NonRecAmount.Text=null==a.Tables[0][0].NonRecurAmount||n.e.IsEmpty(a.Tables[0][0].NonRecurAmount)?"0.00":parseFloat(a.Tables[0][0].NonRecurAmount).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()),this.RecAmount.Text=null==a.Tables[0][0].RecurAmount||n.e.IsEmpty(a.Tables[0][0].RecurAmount)?"0.00":parseFloat(a.Tables[0][0].RecurAmount).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()),this.TotalDays.Text=this.StartDate.Date?(this.EndDate.Date.Subtract(this.StartDate.Date).Days+1).toString():(this.EndDate.Date.Subtract(new Date).Days+1).toString(),""!=this.TotalDays.Text&&this.CalcMonthandYear(),null==a.Tables[0][0].TermsConditions||n.e.IsEmpty(a.Tables[0][0].TermsConditions)||(this.TermsConditions.Text=a.Tables[0][0].TermsConditions.toString()),!a.Columns[0].Contains("SalesmanID")||n.e.IsEmpty(a.Tables[0][0].SalesmanID)||n.e.IsEmpty(a.Tables[0][0].SalesmanID)||(this.Salesman.SelectedValue=parseInt(a.Tables[0][0].SalesmanID)),a.Columns[0].Contains("AccountantID")&&!n.e.IsEmpty(a.Tables[0][0].AccountantID)&&null!=a.Tables[0][0].AccountantID&&(this.Accountant.SelectedValue=parseInt(a.Tables[0][0].AccountantID)),a.Columns[0].Contains("LandlordID")&&!n.e.IsEmpty(a.Tables[0][0].LandlordID)&&null!=a.Tables[0][0].LandlordID&&(this.Landlord.SelectedValue=parseInt(a.Tables[0][0].LandlordID)),a.Columns[0].Contains("NoOfUnits")&&!n.e.IsEmpty(a.Tables[0][0].NoOfUnits)&&null!=a.Tables[0][0].NoOfUnits&&(this.NoOfUnits.Text=a.Tables[0][0].NoOfUnits.toString()),a.Columns[0].Contains("AgeOfRenewal")&&!n.e.IsEmpty(a.Tables[0][0].AgeOfRenewal)&&null!=a.Tables[0][0].AgeOfRenewal&&(this.AgeOfRenewal.Text=a.Tables[0][0].AgeOfRenewal.toString()),a.Tables.length>1&&a.Tables[1].length>0){a.Columns[4].Contains("ccnid70")&&!n.e.IsEmpty(a.Tables[4][0].ccnid70)&&parseInt(a.Tables[4][0].ccnid70.toString())&&(this.Vattype=parseInt(a.Tables[4][0].ccnid70.toString()));let t=!1;for(let e=0;e<a.Tables[1].length;e++){let i=this.DataTableObj.NewRow();i.Recurr=!1,a.Tables[1][e].CCNodeID.toString()==this.id2.toString()&&e>0&&!t?this.DataTableObj.insertRowAt(i,0):this.DataTableObj.updateRow(i),a.Tables[1][e].CCNodeID.toString()==this.id2.toString()&&(t=!0),i.Recurr=!(!a.Columns[1].Contains("IsRecurr")||n.e.IsEmpty(a.Tables[1][e].IsRecurr))&&Object(r.j)(a.Tables[1][e].IsRecurr),i.NodeID=n.e.StringValue(a.Tables[1][e].CCNodeID);let o=[]=this.ScreenObject.Data.Tables[10].filter(t=>t.NodeID==a.Tables[1][e].CCNodeID.toString());o.length>0&&(i.Particulars=n.e.StringValue(o[0].Particulars)),i.CreditAccountID=n.e.StringValue(a.Tables[1][e].CREDITNAME);let l=0;l=parseInt(n.e.StringValue(a.Tables[1][e].PayeeBank)),l>=0&&(i.PayeeBank=l.toString()),n.e.IsEmpty(a.Tables[1][e].CreditAccID)||(i.CreditAccountID_Key=a.Tables[1][e].CreditAccID.toString()),i.DebitAccountID=n.e.StringValue(a.Tables[1][e].DEBITNAME),n.e.IsEmpty(a.Tables[1][e].DebitAccID)||(i.DebitAccountID_Key=n.e.StringValue(a.Tables[1][e].DebitAccID)),a.Columns[1].Contains("AdvanceAccountID")&&!n.e.IsEmpty(a.Tables[1][e].AdvanceAccountID)&&parseInt(a.Tables[1][e].AdvanceAccountID.toString())>0&&(i.AdvanceAcc=n.e.StringValue(a.Tables[1][e].AdvanceAccountID)),a.Columns[1].Contains("BankAccountID")&&!n.e.IsEmpty(a.Tables[1][e].BankAccountID)&&parseInt(a.Tables[1][e].BankAccountID.toString())>0&&(i.BankAccountID=a.Tables[1][e].BankAccountID.toString()),a.Columns[1].Contains("VatPer")&&!n.e.IsEmpty(a.Tables[1][e].VatPer)&&parseFloat(a.Tables[1][e].VatPer.toString())>0&&(i.VatPer=n.e.StringValue(a.Tables[1][e].VatPer)),a.Columns[1].Contains("VatAmount")&&!n.e.IsEmpty(a.Tables[1][e].VatAmount)&&parseFloat(a.Tables[1][e].VatAmount.toString())>0&&(i.VatAmount=n.e.StringValue(a.Tables[1][e].VatAmount)),a.Columns[1].Contains("TaxCategoryID")&&!n.e.IsEmpty(a.Tables[1][e].TaxCategoryID)&&(i.TaxCategory_Key=n.e.StringValue(a.Tables[1][e].TaxCategoryID),a.Columns[1].Contains("TaxCategory")&&(i.TaxCategory=n.e.StringValue(a.Tables[1][e].TaxCategory))),this.DataTableColumns.Contains("SPType_Key")&&a.Columns[1].Contains("SPType")&&!n.e.IsEmpty(a.Tables[1][e].SPType)&&(i.SPType_Key=n.e.StringValue(a.Tables[1][e].SPType),a.Columns[1].Contains("SPTypeName")&&(i.SPType=n.e.StringValue(a.Tables[1][e].SPTypeName))),this.DataTableColumns.Contains("Dim_Key")&&a.Columns[1].Contains("Dimname")&&!n.e.IsEmpty(a.Tables[1][e].DimNodeID)&&(i.Dim_Key=n.e.StringValue(a.Tables[1][e].DimNodeID),i.Dim=n.e.StringValue(a.Tables[1][e].Dimname)),this.DataTableColumns.Contains("SalesMan_Key")&&a.Columns[1].Contains("SalesManname")&&!n.e.IsEmpty(a.Tables[1][e].SalesManID)&&(i.SalesMan_Key=a.Tables[1][e].SalesManID.toString(),i.SalesMan=a.Tables[1][e].SalesManname.toString()),a.Columns[1].Contains("LocationID")&&!n.e.IsEmpty(a.Tables[1][e].LocationID)&&this.DataTableColumns.Contains("Location")&&(i.Location_Key=n.e.StringValue(a.Tables[1][e].LocationID),i.Location=n.e.StringValue(a.Tables[1][e].locname)),i.VatType=n.e.StringValue(a.Tables[1][e].VatType),a.Columns[1].Contains("TaxableAmt")&&!n.e.IsEmpty(a.Tables[1][e].TaxableAmt)&&parseFloat(a.Tables[1][e].TaxableAmt.toString())>0&&(i.TaxableAmt=n.e.StringValue(a.Tables[1][e].TaxableAmt)),a.Columns[1].Contains("RecurInvoice")&&(i.RecurInvoice=n.e.StringValue(a.Tables[1][e].RecurInvoice)),a.Columns[1].Contains("PostDebit")&&(i.PostDebit=n.e.StringValue(a.Tables[1][e].PostDebit)),a.Columns[1].Contains("TasjeelAmount")&&!n.e.IsEmpty(a.Tables[1][e].TasjeelAmount)&&(i.TasjeelAmount=n.e.StringValue(a.Tables[1][e].TasjeelAmount)),a.Columns[1].Contains("InclChkGen")&&!n.e.IsEmpty(a.Tables[1][e].InclChkGen)&&(i.InclChkGen=n.e.StringValue(a.Tables[1][e].InclChkGen)),a.Columns[1].Contains("Detailsxml")&&!n.e.IsEmpty(a.Tables[1][e].Detailsxml)&&(i.Xml=a.Tables[1][e].Detailsxml.toString()),i.Narration=n.e.StringValue(a.Tables[1][e].Narration),i.Refund=a.Columns[1].Contains("Refund")&&!n.e.IsEmpty(a.Tables[1][e].Refund)&&"0"!=a.Tables[1][e].Refund.toString()?a.Tables[1][e].Refund.toString():a.Columns[1].Contains("UnitRefund")&&!n.e.IsEmpty(a.Tables[1][e].UnitRefund)?a.Tables[1][e].UnitRefund.toString():"0",i.Display=a.Columns[1].Contains("unitDisplay")&&!n.e.IsEmpty(a.Tables[1][e].unitDisplay)?a.Tables[1][e].unitDisplay.toString():a.Columns[1].Contains("Display")&&!n.e.IsEmpty(a.Tables[1][e].Display)?a.Tables[1][e].Display.toString():"1","0"==i.Display.toString()&&(i.StyleHeightZero=1);for(let t=0;t<this.ContractParticular.length;t++)this.ContractParticular[t].DisplayMember.startsWith("CCNID")&&a.Columns[1].Contains(this.ContractParticular[t].DisplayMember)&&!n.e.IsEmpty(a.Tables[1][e][this.ContractParticular[t].DisplayMember])&&(i[this.ContractParticular[t].ValueMember]=a.Tables[1][e][this.ContractParticular[t].DisplayMember].toString());if(a.Columns[1].Contains("DocID")&&(95==this.CurrCostCenterID||104==this.CurrCostCenterID)){if(i.Status=n.e.StringValue(a.Tables[1][e].StatusID),i.DocPrefix=n.e.StringValue(a.Tables[1][e].DocPrefix),i.DocNumber=n.e.StringValue(a.Tables[1][e].DocNumber),i.CostCenterID=n.e.StringValue(a.Tables[1][e].CostCenterID),i.DocumentNo=n.e.String(a.Tables[1][e].VoucherNo),i.DocID=n.e.StringValue(a.Tables[1][e].DocID),a.Tables.length>9&&a.Columns[9].Contains("DOCID")&&""!=n.e.StringValue(a.Tables[1][e].DocID)){let t=[]=a.Tables[9].filter(t=>t.DOCID==a.Tables[1][e].DocID.toString());t.length>0&&(i.TempCCID_Key=n.e.StringValue(t[0].ID),i.TempCCID=n.e.StringValue(t[0].Name))}else i.TempCCID_Key=n.e.StringValue(this.DocStNodeID),i.TempCCID=this.DocStName;a.Columns[1].Contains("DocumentName")&&(i.DocumentName=n.e.StringValue(a.Tables[1][e].DocumentName))}a.Tables[1][e].CCNodeID.toString()==this.id2.toString()?(n.e.IsEmpty(a.Tables[1][0].Sqft)||null==a.Tables[1][0].Sqft||(i.Sqft=parseFloat(a.Tables[1][0].Sqft).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString())),n.e.IsEmpty(a.Tables[1][0].Rate)||null==a.Tables[1][0].Rate||(i.Rate=parseFloat(a.Tables[1][0].Rate).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString())),n.e.IsEmpty(a.Tables[1][0].RentAmount)||null==a.Tables[1][0].RentAmount||(i.ActAmount=parseFloat(a.Tables[1][0].RentAmount).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString())),n.e.IsEmpty(a.Tables[1][0].DiscountAmount)||null==a.Tables[1][0].DiscountAmount||(i.Discount=parseFloat(a.Tables[1][0].DiscountAmount).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()))):(!n.e.IsEmpty(a.Tables[1][e].ChequeNo)&&!n.e.IsEmpty(a.Tables[1][e].ChequeNo)&&parseInt(a.Tables[1][e].ChequeNo)>0&&(i.ChequeNo=a.Tables[1][e].ChequeNo.toString()),n.e.IsEmpty(a.Tables[1][e].ChequeDate)||null==a.Tables[1][e].ChequeDate||new Date(a.Tables[1][e].ChequeDate).toString().Contains("1900")||(i.CntrlDate=new Date(a.Tables[1][e].ChequeDate).ToString(s.a.SessionManager.Preferences["Date Format"]),i.CntrlDate_Key=n.e.StringValue(a.Tables[1][e].ChequeDate))),n.e.IsEmpty(a.Tables[1][e].Amount)||(i.Amount=parseFloat(a.Tables[1][e].Amount).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString())),null==a.Tables[1][0].RentAmount||n.e.IsEmpty(a.Tables[1][e].RentAmount)||(i.ActAmount=parseFloat(a.Tables[1][e].RentAmount).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString())),n.e.IsEmpty(a.Tables[1][e].DiscountAmount)||(i.Discount=parseFloat(a.Tables[1][e].DiscountAmount).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString())),a.Columns[1].Contains("UnitMonths")&&!n.e.IsEmpty(a.Tables[1][e].UnitMonths)?i.Months=a.Tables[1][e].UnitMonths.toString():a.Columns[1].Contains("Months")&&!n.e.IsEmpty(a.Tables[1][e].Months)&&(i.Months=a.Tables[1][e].Months.toString()),a.Columns[1].Contains("UnitDiscountPercentage")&&!n.e.IsEmpty(a.Tables[1][e].UnitDiscountPercentage)?i.DiscountPercentage=a.Tables[1][e].UnitDiscountPercentage.toString():a.Columns[1].Contains("DiscountPercentage")&&!n.e.IsEmpty(a.Tables[1][e].DiscountPercentage)&&(i.DiscountPercentage=a.Tables[1][e].DiscountPercentage.toString()),a.Tables[1][e].CCNodeID.toString()==this.id2.toString()&&null!=a.Tables[1][e].Amount&&null!=a.Tables[1][e].Amount&&(this.OriginalRent=parseFloat(a.Tables[1][e].Amount)),this.DataTableObj.addRow(i)}}if(a.Tables.length>2&&a.Tables[2].length>0){this.LinkedQuotationID>0&&a.Columns[2].Contains("IsRes")&&"1"==a.Tables[2][0].IsRes.toString()&&a.Tables[2].length>1?(this.NoofCheques=a.Tables[2].length-1,""!=n.e.StringValue(a.Tables[2][1].ChequeNo)&&(this.FirstNumber=a.Tables[2][1].ChequeNo.toString()),""!=n.e.StringValue(a.Tables[2][1].ChequeDate)&&(this.stDate=new Date(a.Tables[2][1].ChequeDate.toString())),this.PayeeBnk=a.Tables[2][1].CustomerBank.toString(),""!=n.e.StringValue(a.Tables[2][1].DebitAccID)&&(this.DebitAcc=parseInt(a.Tables[2][1].DebitAccID)),this.InstPeriod=a.Tables[2].length>2?n.e.GetDateDifference(new Date(a.Tables[2][2].ChequeDate),new Date(a.Tables[2][1].ChequeDate)):0):(this.NoofCheques=a.Tables[2].length,""!=n.e.StringValue(a.Tables[2][0].ChequeNo)&&(this.FirstNumber=a.Tables[2][0].ChequeNo.toString()),""!=n.e.StringValue(a.Tables[2][0].ChequeDate)&&(this.stDate=new Date(a.Tables[2][0].ChequeDate)),this.PayeeBnk=a.Tables[2][0].CustomerBank.toString(),""!=n.e.StringValue(a.Tables[2][0].DebitAccID)&&(this.DebitAcc=parseInt(a.Tables[2][0].DebitAccID)),this.InstPeriod=a.Tables[2].length>1?n.e.GetDateDifference(new Date(a.Tables[2][1].ChequeDate),new Date(a.Tables[2][0].ChequeDate)):0),this.PayTermsDataTableObj.Clear();for(let t=0;t<a.Tables[2].length;t++){let e=this.PayTermsDataTableObj.NewRow();e.ChequeNo=n.e.StringValue(a.Tables[2][t].ChequeNo),this.InclPostingDate&&a.Columns[2].Contains("PostingDate")&&!n.e.IsEmpty(a.Tables[2][t].PostingDate)&&""!=n.e.StringValue(a.Tables[2][t].PostingDate)&&(e.PostingDate=new Date(a.Tables[2][t].PostingDate).ToString(s.a.SessionManager.Preferences["Date Format"]),e.PostingDate_Key=new Date(a.Tables[2][t].PostingDate)),a.Columns[2].Contains("TillDate")&&""!=n.e.StringValue(a.Tables[2][t].TillDate)&&(e.TillDate=new Date(a.Tables[2][t].TillDate).ToString(s.a.SessionManager.Preferences["Date Format"]),e.TillDate_Key=new Date(a.Tables[2][t].TillDate)),a.Columns[2].Contains("AccDocDetailsid")&&(this.PayTermsDataTableColumns.Contains("AccDocDetailsid")||this.PayTermsDataTableColumns.push("AccDocDetailsid"),this.PayTermsDataTable[t].AccDocDetailsid=a.Tables[2][t].AccDocDetailsid.toString()),a.Columns[2].Contains("IsFreezed")&&(this.PayTermsDataTableColumns.Contains("IsFreezed")||this.PayTermsDataTableColumns.push("IsFreezed"),this.PayTermsDataTable[t].IsFreezed=a.Tables[2][t].IsFreezed.toString()),n.e.IsEmpty(a.Tables[2][t].ChequeDate)||(e.CntrlDate=new Date(a.Tables[2][t].ChequeDate).ToString(s.a.SessionManager.Preferences["Date Format"])),e.CntrlDate_Key=a.Tables[2][t].ChequeDate.toString();let i=0;if(i=parseInt(n.e.StringValue(a.Tables[2][t].CustomerBank)),i>=0&&(e.PayeeBank=i.toString()),e.Narration="",e.DebitAccountID_Key=n.e.StringValue(a.Tables[2][t].DebitAccID),e.Narration=n.e.StringValue(a.Tables[2][t].Narration),e.DebitAccountID=n.e.StringValue(a.Tables[2][t].DebitAccName),e.DocID=n.e.StringValue(a.Tables[2][t].DocID),e.Period=n.e.StringValue(a.Tables[2][t].Period),n.e.IsEmpty(a.Tables[2][t].Amount)||null==a.Tables[2][t].Amount||(e.Amount=parseFloat(a.Tables[2][t].Amount).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString())),a.Columns[2].Contains("RentAmount")&&""!=n.e.StringValue(a.Tables[2][t].RentAmount)&&(e.RentAmount=parseFloat(a.Tables[2][t].RentAmount).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString())),a.Columns[2].Contains("LocationID")&&""!=n.e.StringValue(a.Tables[2][t].LocationID)&&this.PayTermsDataTableColumns.Contains("Location")&&(e.Location_Key=n.e.StringValue(a.Tables[2][t].LocationID),e.Location=n.e.StringValue(a.Tables[2][t].locname)),this.PayTermsDataTableColumns.Contains("Dim_Key")&&a.Columns[2].Contains("DimNodeID")&&""!=n.e.StringValue(a.Tables[2][t].DimNodeID)){e.Dim_Key=n.e.StringValue(a.Tables[2][t].DimNodeID);let i=a.Tables[10].filter(e=>e.DimNodeID==n.e.StringValue(a.Tables[2][t].DimNodeID));i.length>0&&(e.Dim=n.e.StringValue(i[0].Dimname))}if(this.PayTermsDataTableColumns.Contains("SalesMan_Key")&&a.Columns[2].Contains("SalesManID")&&""!=a.Tables[2][t].SalesManID.toString()){this.PayTermsDataTable[t].SalesMan_Key=a.Tables[2][t].SalesManID.toString();let e=a.Tables[10].filter(e=>e.SalesManID==a.Tables[2][t].SalesManID.toString());e.length>0&&(this.PayTermsDataTable[t].SalesMan=e[0].SalesManname.toString())}if(a.Columns[2].Contains("Particular")&&!n.e.IsEmpty(a.Tables[2][t].Particular)&&this.PayTermsDataTableColumns.Contains("Particulars_Key")){e.Particulars_Key=n.e.StringValue(a.Tables[2][t].Particular);let i=[]=this.ScreenObject.Data.Tables[10].filter(e=>e.NodeID==a.Tables[2][t].Particular.toString());i.length>0&&(e.Particulars=n.e.StringValue(i[0].Particulars))}for(let s=0;s<this.ContractPayTerms.length;s++)this.ContractPayTerms[s].DisplayMember.startsWith("CCNID")&&a.Columns[2].Contains(this.ContractPayTerms[s].DisplayMember)&&""!=a.Tables[2][t][this.ContractPayTerms[s].DisplayMember].toString()&&(this.PayTermsDataTable[t][this.ContractPayTerms[s].ValueMember]=a.Tables[2][t][this.ContractPayTerms[s].DisplayMember].toString());if(103!=this.CurrCostCenterID&&a.Columns[2].Contains("DocStatusID")){if(e.Status=n.e.StringValue(a.Tables[2][t].StatusID),e.DocPrefix=n.e.StringValue(a.Tables[2][t].DocPrefix),e.DocNumber=n.e.StringValue(a.Tables[2][t].DocNumber),e.CostCenterID=n.e.StringValue(a.Tables[2][t].CostCenterID),e.DocumentNo=n.e.StringValue(a.Tables[2][t].VoucherNo),e.DocStatusID=n.e.StringValue(a.Tables[2][t].DocStatusID),e.DocumentType=n.e.StringValue(a.Tables[2][t].DocumentType),a.Columns[2].Contains("OpPdcStatus")&&!n.e.IsEmpty(a.Tables[2][t].OpPdcStatus)&&(this.PayTermsDataTable[t].OpPdcStatus=n.e.StringValue(a.Tables[2][t].OpPdcStatus)),e.OpPdcStatus=n.e.StringValue(a.Tables[2][t].OpPdcStatus),a.Tables.length>9&&a.Columns[9].Contains("DOCID")&&!n.e.IsEmpty(a.Tables[2][t].DocID)){let i=[]=a.Tables[9].filter(e=>e.DOCID==n.e.StringValue(a.Tables[2][t].DocID));i.length>0&&(e.TempCCID_Key=n.e.StringValue(i[0].ID),e.TempCCID=n.e.StringValue(i[0].Name))}else e.TempCCID_Key=n.e.StringValue(this.DocStNodeID),e.TempCCID=this.DocStName;"429"==n.e.StringValue(a.Tables[2][t].DocStatusID)&&("1"==n.e.StringValue(a.Tables[2][t].BillNo)?e.Status=s.a.GetResource("Replaced"):"2"==n.e.StringValue(a.Tables[2][t].BillNo)&&(e.Status=s.a.GetResource("ReplacedPartial")))}a.Columns[2].Contains("DocumentName")&&(e.DocumentName=n.e.StringValue(a.Tables[2][t].DocumentName)),this.PayTermsDataTableObj.addRow(e)}}this.onListSelectedChanged("LandLord")}for(let t=0;t<2;t++){let t=this.DataTableObj.NewRow();t.Recurr=!1,this.DataTableObj.addRow(t);let e=this.PayTermsDataTableObj.NewRow();this.PayTermsDataTableObj.addRow(e)}if(this.DataTableObj.UpdateTotals(),this.PayTermsDataTableObj.UpdateTotals(),this.UpdateSequencePay(),null!=a&&a.Tables.length>3&&this.ScreenObject.LoadCustomFieldsData(a.Tables[3]),null!=a&&a.Tables.length>4&&this.ScreenObject.LoadCustomFieldsCCData(a.Tables[4]),null!=a&&a.Tables.length>5&&this.ViewAttachments.LoadAttachments(a.Tables[5]),a.Columns[0].Contains("WorkFlowID")&&a.Tables[0].length>0&&""!=a.Tables[0][0].WorkFlowID.toString()&&parseInt(a.Tables[0][0].WorkFlowID.toString())>0){let t=this.GetButton("ViewHistory");if(null!=t&&(t.Visible=!0),this.SetButtonVisibility("ViewHistory",!0),""!=a.Tables[0][0].canApprove.toString()&&Object(r.j)(a.Tables[0][0].canApprove.toString())?(t=this.GetButton("Reject"),null!=t&&(t.Visible=!0),this.SetButtonVisibility("RejectVisiblity",t.Visible),this.BtnApprove.Visible=!0,this.SetButtonVisibility("RejectVisiblity",!0),this.ButtonSave.Enable=!1,this.ButtonSaveAndPrint.Enable=!1):""==a.Tables[0][0].canEdit.toString()||Object(r.j)(a.Tables[0][0].canEdit.toString())?("466"==this.StatusID.SelectedValue||"440"==this.StatusID.SelectedValue&&a.Tables[0][0].WorkFlowLevel.toString()!=a.Tables[0][0].userlevel.toString())&&(this.ButtonSave.Enable=!1,this.ButtonSaveAndPrint.Enable=!1,this.BtnApprove.Visible=!1,this.SetButtonVisibility("RejectVisiblity",!1)):this.ButtonSave.Enable=this.ButtonSaveAndPrint.Enable=!!s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Approved Contracts"),"466"!=this.StatusID.SelectedValue&&"440"!=this.StatusID.SelectedValue&&"470"!=this.StatusID.SelectedValue||(t=this.GetButton("Generate"),null!=t&&(t.Visible=!1),this.SetButtonVisibility("GenerateLink",!1),this.ButtonRenew.Enable=!1,this.ButtonTerminate.Enable=!1,this.ButtonRefund.Visible=!1,this.ButtonVacant.Visible=!1,this.SetButtonVisibility("RefundVisiblity",!1),this.SetButtonVisibility("VacantVisiblity",!1)),95==this.CostCenterID&&a.Tables.length>11&&a.Columns[11].Contains("WorkFlowLevel")||(103==this.CostCenterID||129==this.CostCenterID)&&a.Tables.length>10&&a.Columns[10].Contains("WorkFlowLevel")){let t=a.Tables[12],e=a.Tables[11];103==this.CostCenterID||129==this.CostCenterID?(t=a.Tables[11],e=a.Tables[10]):(t=a.Tables[12],e=a.Tables[11]);let i,r=0;n.e.IsEmpty(a.Tables[0][0].WorkFlowLevel)||(r=parseInt(a.Tables[0][0].WorkFlowLevel.toString())),e.length>0&&(i=parseInt(e[e.length-1].StatusID));let o=e.length>0?parseInt(e[0].WorkFlowLevel)-1:0;for(let a=0;a<t.length;a++){let e=new d.a(parseInt(t[0].WID),parseInt(t[a].LevelID),t[a].LevelName.toString(),this.CostCenterID,this.CostCenterID,this.ContractDate.Date);a==o&&(e.IsPending=!0,e.Label="C"),0==a&&(e.LeftLineBrush="#FFFFFFFF"),a==t.length-1&&(e.RightLineBrush="#FFFFFFFF"),this.WFDocLevelList.push(e)}for(let a=e.length-1;a>=0;a--){let t=parseInt(e[a].WorkFlowLevel);if(t<=r&&t<=this.WFDocLevelList.length&&!this.WFDocLevelList[t-1].IsSet){this.WFDocLevelList[t-1].IsSet=!0,this.WFDocLevelList[t-1].ModifiedBy=e[a].Status.toString()+" By "+e[a].CreatedBy.toString(),e[a].FirstName.toString().length>0&&(this.WFDocLevelList[t-1].ModifiedBy+="("+e[a].FirstName.toString()+")");let i=new Date(e[a].Date);this.WFDocLevelList[t-1].ModifiedBy+=" On "+i.ToString(s.a.SessionManager.Preferences["Date Format"]);let n=parseInt(e[a].StatusID);470==n?this.WFDocLevelList[t-1].IsRejected=!0:466==n?this.WFDocLevelList[t-1].IsApproved=!0:426!=n&&427!=n||(this.WFDocLevelList[t-1].IsPending=!0,this.WFDocLevelList[t-1].Label=" P")}}}}else a.Columns[0].Contains("IsApprove")&&a.Tables[0].length>0&&""!=a.Tables[0][0].IsApprove.toString()&&("465"!=this.StatusID.SelectedValue||""!=a.Tables[0][0].WorkFlowID.toString()&&parseInt(a.Tables[0][0].WorkFlowID.toString())>0&&"1"==a.Tables[0][0].wfaction.toString())&&(this.BtnApprove.Visible=Object(r.j)(a.Tables[0][0].IsApprove.toString()));if(null!=a&&a.Tables.length>7&&a.Tables[7].length>0&&null!=this.ViewActivities&&this.ViewActivities.LoadActivityData(a.Tables[7]),null!=a&&a.Tables.length>6&&this.ViewNotes.LoadNotes(a.Tables[6]),null!=a&&a.Tables.length>8&&a.Tables[8].length>0){this.StrMultiple="",this.SelectedUnits="";for(let t=0;t<a.Tables[8].length;t++)this.SelectedUnits+=a.Tables[8][t].UnitID.toString()+",";this.StrMultiple=a.Tables[8][0].uname.toString(),this.SelectedUnits.length>1&&(this.SelectedUnits=this.SelectedUnits.slice(0,-1)),this.ScreenObject.HeaderFields.forEach(t=>{t instanceof l.f&&(t.MultipleUnits.Text=this.StrMultiple),t.multiVisi=!0}),this.Property.Enable=!1,this.multiVisi=!0}this.CalculateFooter(),this.IsRecurPosted&&(this.TotalYears.IsReadOnly=this.Months.IsReadOnly=this.RecurDuration.IsReadOnly=this.ContractDate.IsReadOnly=this.StartDate.IsReadOnly=this.EndDate.IsReadOnly=!0),Logger.InfoLog("AddEditRenContractViewModel ::Exiting LoadEditData")}catch(e){Logger.ErrorLog("AddEditRenContractViewModel :: LoadEditData"+e.stack)}if(this.ButtonsPopup.length>0)for(let a=0;a<this.ButtonsPopup.length;a++){const t=this.ButtonsPopup[a];t.Visible&&(t.Enable||(t.Visible=!1))}if(this.ButtonsLeft.length>0)for(let a=0;a<this.ButtonsLeft.length;a++){const t=this.ButtonsLeft[a];t.Visible&&(t.Enable||(t.Visible=!1))}}FillNullValue_to_Row(t,e){for(let a=0;a<t.length;a++)e[t[a]]=null;return e}AddUnitWhere(t){let e=" ISGROUP = 0 ",a=[]=this.ScreenObject.Data.Tables[5].filter(t=>"ServiceUnitTypes"==t.Name);a.length>0&&""==a[0].Value.toString().Trim()&&(e+=this.ParentContractID>0?" and Unittype <>999":" and Unittype =999"),e+=" and (UnitStatus = "+this.UnitStatusVal+" or UnitStatus is null or   UnitStatus =  0 or a.UnitID = "+this.Unit.SelectedValue+")";let i="";s.a.SessionManager.Preferences["Dimension List"].split(",").Contains("92")&&null!=this.ScreenObject.Data&&this.ScreenObject.Data.Tables.length>6&&this.ScreenObject.Data.Columns[6].Contains("Properties")&&this.ScreenObject.Data.Tables[6].length>0&&""!=this.ScreenObject.Data.Tables[6][0].Properties.toString()&&parseInt(s.a.SessionManager.UserID)>1&&(i=this.ScreenObject.Data.Tables[6][0].Properties.toString(),i.length>0&&(i=i.substr(0,i.length-1))),this.Property.SelectedValue>0?e+=" and PropertyID = "+this.Property.SelectedValue:i.length>0&&(e+=" and PropertyID in ( "+i+" )"),this.ShowOnlyAvailable&&(e+="  and a.UnitID not in (select unitid from ren_contract with(nolock) where unitid is not null and (statusid=426 or statusid=427)",e+="   AND ContractID NOT IN (SELECT DISTINCT RenewRefID FROM ren_contract WITH(NOLOCK) WHERE RenewRefID IS NOT NULL AND RenewRefID >0 ) ",e+="   AND RefContractID NOT IN (SELECT DISTINCT RenewRefID FROM ren_contract WITH(NOLOCK) WHERE RenewRefID IS NOT NULL AND RenewRefID >0 ))"),3==t&&(e+=" and a.LocationID ="+this.LocationContract.SelectedValue),this.Unit.CustomWhere=e}OnMouseClick(){Logger.InfoLog("AddEditRenContractViewModel ::Entering OnMouseDoubleClick"),null!=this.SelectedVoucher&&(event.preventDefault(),R.RibbonExtViewModel.LoadDocument(this.SelectedVoucher)),Logger.InfoLog("AddEditRenContractViewModel ::Exiting OnMouseDoubleClick")}OnMouseClickContract(){Logger.InfoLog("AddEditRenContractViewModel ::Entering OnMouseDoubleClick"),null!=this.SelectedRow&&(event.preventDefault(),R.RibbonExtViewModel.LoadDocument(this.SelectedRow)),Logger.InfoLog("AddEditRenContractViewModel ::Exiting OnMouseDoubleClick")}PaytermBeforeRowDeletingEvent(t){!this.PayTermsDataTableColumns.Contains("IsFreezed")||null==this.SelectedVoucher||"1"!=this.SelectedVoucher.IsFreezed.toString()&&"True"!=this.SelectedVoucher.IsFreezed.toString()||(this.DisplayMessage="Voucher Freezed.",t.CanExecute=!1)}OnCellEditEnding(t){return Object(i.b)(this,void 0,void 0,(function*(){Logger.InfoLog("AddEditRenContractViewModel ::Entering OnCellEditEnding");try{let i=t.item;if("DataGridPactComboBoxColumn"==t.column.className){if("NodeID"==t.column.field&&!n.e.IsEmpty(i.NodeID)){if(null==this.dtParticulars||!this.dtParticulars.some(t=>t.hasOwnProperty("NodeID")))if(this.dsPart=this.StartDate.Date&&this.EndDate.Date?s.a.rental.GetParticularsDetails(this.RenewRefID,this.Unit.SelectedValue,0,this.StartDate.Date,this.EndDate.Date,1,this.ContractID,this.SelectedUnits):this.StartDate.Date?s.a.rental.GetParticularsDetails(this.RenewRefID,this.Unit.SelectedValue,0,this.StartDate.Date,new Date,1,this.ContractID,this.SelectedUnits):s.a.rental.GetParticularsDetails(this.RenewRefID,this.Unit.SelectedValue,0,new Date,this.EndDate.Date?this.EndDate.Date:new Date,1,this.ContractID,this.SelectedUnits),null!=this.dsPart&&this.dsPart.Tables.length>0&&this.dsPart.Tables[0].length>0)this.dtParticulars=this.dsPart.Tables[0].filter(t=>1==t.Type||3==t.Type);else if(null!=this.dsPart&&this.dsPart.Tables.length>1&&this.dsPart.Tables[1].length>0){let t=this.dsPart.Tables[1];t=this.dsPart.Tables[1].filter(t=>1==t.Type||3==t.Type),this.dsPart.Columns[1].Contains("UnitID")&&(t=this.dsPart.Tables[1].filter(t=>1==t.Type||3==t.Type&&(0==t.UnitID||t.UnitID==this.Unit.SelectedValue))),this.dtParticulars=t}if(0!=this.DataTable.find(t=>t.NodeID==i.NodeID.toString()).length&&this.DataTable.filter(t=>t.NodeID==i.NodeID.toString())[0]!=i)return this.DisplayMessage="Particular Already Selected",void(this.MessageVisibility=!0);if(null!=this.dtParticulars&&this.dtParticulars.some(t=>t.hasOwnProperty("NodeID"))){let t=this.dtParticulars.filter(t=>t.NodeID==i.NodeID.toString());if(t.length>0){let e=0,a=0;a=this.OriginalRent;let s,r=this.CalculateMonths();if(s=r>1?n.e.Round(n.e.Double(a)/r,this.Mdeci):n.e.DoubleTryParse(a),i.Recurr=!1,i.Particulars=t[0].Particulars.toString(),n.e.IsEmpty(t[0].CreditID)||(i.CreditAccountID_Key=t[0].CreditID.toString()),n.e.IsEmpty(t[0].DebitID)||(i.DebitAccountID_Key=t[0].DebitID.toString()),this.dtParticulars.some(t=>t.hasOwnProperty("AdvanceAcc"))&&!n.e.IsEmpty(t[0].AdvanceAcc)&&parseInt(t[0].AdvanceAcc.toString())>0&&(i.AdvanceAcc=t[0].AdvanceAcc.toString()),""!=this.SelectedUnits){for(let r=0;r<t.length;r++)!n.e.IsEmpty(t[r].DiscountAmount)&&parseFloat(t[r].DiscountAmount)>0?e+=parseFloat(t[r].DiscountAmount):!n.e.IsEmpty(t[r].DiscountPercentage)&&parseFloat(t[r].DiscountPercentage)>0?e+=parseFloat(t[r].DiscountPercentage)*a/100:!n.e.IsEmpty(t[r].Months)&&parseFloat(t[r].Months)>0&&(e+=parseFloat(t[r].Months)*parseFloat(s.toString())),this.dtParticulars.some(t=>t.hasOwnProperty("VAT"))&&!n.e.IsEmpty(t[r].VAT)&&parseFloat(t[r].VAT.toString())>0&&(i.VatPer=parseFloat(t[r].VAT.toString()));i.Amount=e}else!n.e.IsEmpty(t[0].DiscountAmount)&&parseFloat(t[0].DiscountAmount)>0?e=parseFloat(t[0].DiscountAmount):!n.e.IsEmpty(t[0].DiscountPercentage)&&parseFloat(t[0].DiscountPercentage)>0?e=parseFloat(t[0].DiscountPercentage)*a/100:!n.e.IsEmpty(t[0].Months)&&parseFloat(t[0].Months)>0&&(e=parseFloat(t[0].Months)*parseFloat(s.toString())),i.Amount=e,this.dtParticulars.Contains("VAT")&&!n.e.IsEmpty(t[0].VAT)&&parseFloat(t[0].VAT.toString())>0&&(i.VatPer=parseFloat(t[0].VAT.toString()));n.e.IsEmpty(t[0].CreditName)||(i.CreditAccountID=t[0].CreditName.toString()),n.e.IsEmpty(t[0].DebitName)||(i.DebitAccountID=t[0].DebitName.toString()),n.e.IsEmpty(t[0].DiscountPercentage)||(i.DiscountPercentage=t[0].DiscountPercentage.toString()),n.e.IsEmpty(t[0].Months)||(i.Months=t[0].Months.toString()),this.DataTableColumns.Contains("Dim_Key")&&Object.keys(t[0]).Contains("Dimname")&&!n.e.IsEmpty(t[0].Dimname)&&(i.Dim_Key=t[0].DimNodeID.toString(),i.Dim=t[0].Dimname.toString()),this.DataTableColumns.Contains("SalesManID")&&Object.keys(t[0]).Contains("SalesManIDname")&&!n.e.IsEmpty(t[0].SalesManname)&&(i.SalesMan_Key=t[0].SalesManID.toString(),i.SalesMan=t[0].SalesManname.toString()),this.DataTableColumns.Contains("Location_Key")&&this.LocationContract.SelectedValue>0&&(i.Location_Key=this.LocationContract.SelectedValue),i.VatType=n.e.String(t[0].VatType),i.RecurInvoice=n.e.String(t[0].RecurInvoice).toLowerCase(),i.PostDebit=n.e.String(t[0].PostDebit),this.DataTableObj.updateRow(i),this.CalculateNRec()}else{let t=this.ContractParticular.filter(t=>!n.e.IsEmpty(t.ValueBinding)&&"NodeID"==t.ValueBinding);if(null!=t){var e=t.ComboData.filter(t=>t.NodeID==i.NodeID.toString());e.length>0&&(i.Particulars=e[0].Particulars.toString())}i.InclChkGen="0",this.DataTableObj.updateRow(i)}}else i.InclChkGen="0",this.DataTableObj.updateRow(i);!n.e.IsEmpty(t.item.Location_Key)&&this.LocationContract.SelectedValue>0&&(i.Location_Key=this.LocationContract.SelectedValue,this.DataTableObj.updateRow(i))}}else{if("ChequeNo"!=t.column.field||n.e.IsEmpty(i.ChequeNo)||""!=n.e.String(i.TempCCID_Key)||(i.TempCCID_Key=this.DocStNodeID.toString(),i.TempCCID=this.DocStName),this.PayTermsDataTableColumns.Contains("Period")&&this.PayTermsDataTableColumns.Contains("Dim_Key")&&this.DefaultDiminPayterms>0&&""==n.e.String(i.Dim_Key)){i.Dim_Key=this.DefaultDiminPayterms;let t=this.DataTable.filter(t=>t.Dim_Key==this.DefaultDiminPayterms);t.length>0&&!n.e.IsEmpty(t[0].Dim)&&(i.Dim=t[0].Dim)}if(""!=this.SelectedUnits&&n.e.isValidDate(this.StartDate.Date)&&n.e.isValidDate(this.EndDate.Date)&&this.DataTable[0]==i&&this.DistributePopuponRent&&("Amount"==t.column.field||"ActAmount"==t.column.field)){const{UpdatePayTermsViewModel:t}=yield a.e(68).then(a.bind(null,"Rr92")),{UpdatepaytermsComponent:e}=yield a.e(0).then(a.bind(null,"++ql"));let n=new t("AddEditRenContractViewModel");n.UpdatePayTermsViewModel_1(this,i,null),s.a.page.ShowDialog(n,e,{Title:"Distribute",HideClose:!0,ShowCenter:!0})}if("ActAmount"!=t.column.field&&"Discount"!=t.column.field&&"Sqft"!=t.column.field&&"Rate"!=t.column.field||((this.DataTable[0]==i&&"Sqft"==t.column.field||"Rate"==t.column.field)&&(n.e.IsEmpty(this.DataTable[0].Sqft)||n.e.IsEmpty(this.DataTable[0].Rate)||(this.DataTable[0].ActAmount=n.e.DoubleTryParse(this.DataTable[0].Sqft)*n.e.DoubleTryParse(this.DataTable[0].Rate))),n.e.IsEmpty(i.ActAmount)||n.e.IsEmpty(i.Discount)?null==i.Discount||n.e.IsEmpty(i.Discount)?n.e.IsEmpty(i.ActAmount)||(i.Amount=n.e.DoubleTryParse(i.ActAmount)):i.Amount=0:i.Amount=n.e.DoubleTryParse(i.ActAmount)-n.e.DoubleTryParse(i.Discount),this.RefreshGrid=!this.RefreshGrid),0==this.Unit.SelectedValue&&""==this.SelectedUnits&&104!=this.CurrCostCenterID)return void(i.Amount=null);"DebitAccountID"==t.column.field&&""==n.e.String(i.DebitAccountID)&&(i.DebitAccountID_Key="0"),t.grid.getData().getItems()!=this.DataTable||!this.DataTableColumns.Contains("Amount")||"Amount"!=t.column.field&&n.e.IsEmpty(i.Amount)||0==this.SelectedGridRowIndex&&(this.Reevaluate(),n.e.IsEmpty(i.Discount)?(i.ActAmount=i.Amount,i.Discount=0):i.ActAmount=n.e.DoubleTryParse(i.Amount)+n.e.DoubleTryParse(i.Discount))}Logger.InfoLog("AddEditRenContractViewModel ::Exiting OnCellEditEnding"),this.CalculateNRec(),this.CalculateFooter(),this.DataTableObj.UpdateTotals(),this.DataTableObj.updateRow(i),this.PayTermsDataTableObj.updateRow(i),this.PayTermsDataTableObj.UpdateTotals()}catch(i){Logger.ErrorLog("AddEditRenContractViewModel :: OnCellEditEnding"+i.stack)}}))}Reevaluate(){let t=0;n.e.IsEmpty(this.DataTable[0].Amount)||(t=parseFloat(this.DataTable[0].Amount));let e,a=this.CalculateMonths();e=a>1?n.e.Round(parseFloat(t.toString())/a,this.Mdeci):parseFloat(t.toString());for(let i=1;i<this.DataTable.length;i++)!n.e.IsEmpty(this.DataTable[i].DiscountPercentage)&&n.e.DoubleTryParse(this.DataTable[i].DiscountPercentage)>0?this.DataTable[i].Amount=n.e.DoubleTryParse(this.DataTable[i].DiscountPercentage)*t/100:n.e.IsEmpty(this.DataTable[i].Months)&&n.e.DoubleTryParse(this.DataTable[i].Months)>0&&(this.DataTable[i].Amount=n.e.DoubleTryParse(this.DataTable[i].Months)*n.e.DoubleTryParse(e)),this.DataTable[i].ActAmount=this.DataTable[i].Amount,this.DataTable[i].Discount=0}CalculateFooter(){let t=this.PayTermsDataTable.Compute("sum","Amount");null!=t&&null!=t||(t=0);let e=this.ContractPayTerms.find(t=>"Amount"==t.DisplayMember);null!=e?e.footer=parseFloat(t).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()):this.ContractPayTerms[5].footer=parseFloat(t).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()),95==this.CurrCostCenterID||104==this.CurrCostCenterID?(e=this.ContractParticular.find(t=>"Amount"==t.DisplayMember),t=this.DataTable.filter(t=>null==t.Display||0!=t.Display).Compute("sum","Amount"),null!=t&&null!=t||(t=0),null!=e?e.footer=parseFloat(t).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()):this.ContractParticular[11].footer=parseFloat(t).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString())):(e=this.ContractParticular.find(t=>"ActAmount"==t.DisplayMember),t=this.DataTable.Compute("sum","ActAmount"),null!=t&&null!=t||(t=0),null!=e?e.footer=parseFloat(t).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()):this.ContractParticular[9].footer=parseFloat(t).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString())),e=this.ContractParticular.find(t=>"TaxableAmt"==t.DisplayMember),t=this.DataTable.filter(t=>null==t.Display||0!=t.Display).Compute("sum","TaxableAmt"),null!=t&&null!=t||(t=0),null!=e&&(e.footer=parseFloat(t).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString())),this.TotAmt.Text=parseFloat(t).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()),e=this.ContractParticular.find(t=>"VatAmount"==t.DisplayMember),t=this.DataTable.filter(t=>null==t.Display||0!=t.Display).Compute("sum","VatAmount"),null!=t&&null!=t||(t=0),this.VatAmount.Text=parseFloat(t).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()),null!=e&&(e.footer=parseFloat(t).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString())),this.UpdateFooter=!0}GetDays(){return this.EndDate.Date.Subtract(this.StartDate.Date).Days+1}GetDays_1(t,e){return e.Subtract(t).Days+1}CalculateRent(){if(this.StartDate.Date&&this.EndDate.Date){let t=0,e=0;t=this.EndDate.Date.Subtract(this.StartDate.Date).Days-1,this.RentBasedContract&&(e=t,this.InclStartDate&&(e+=1),this.InclEndDate&&(e+=1),this.CalculateRentBaedOnDays(e,!1))}}FillPropDetails(t){let e=s.a.rental.GetProperty(parseInt(this.Property.SelectedValue.toString()),1);if(null!=e&&e.Tables.length>2&&e.Tables[2].length>0&&(null!=e.Tables[2][0].TermsConditions.toString()&&""!=e.Tables[2][0].TermsConditions.toString()&&(this.TermsConditions.Text=e.Tables[2][0].TermsConditions.toString()),null!=e.Tables[2][0].BankAccount&&""!=e.Tables[2][0].BankAccount.toString()&&(this.GenDebitAcc=parseInt(e.Tables[2][0].BankAccount)),104==this.CurrCostCenterID?null!=e.Tables[2][0].RentalAccount&&""!=e.Tables[2][0].RentalAccount.toString()&&(this.IncomeAc.SelectedValue=parseInt(e.Tables[2][0].RentalAccount)):1==this.PickACC&&(this.ParentContractID>0?null!=e.Tables[2][0].ParkingIncomeAccountID&&""!=e.Tables[2][0].ParkingIncomeAccountID.toString()&&(this.IncomeAc.SelectedValue=parseInt(e.Tables[2][0].ParkingIncomeAccountID)):null!=e.Tables[2][0].RentalIncomeAccountID&&""!=e.Tables[2][0].RentalIncomeAccountID.toString()&&(this.IncomeAc.SelectedValue=parseInt(e.Tables[2][0].RentalIncomeAccountID))),129==this.CurrCostCenterID?e.Columns[2].Contains("AdvanceReceivableAccountID")&&null!=e.Tables[2][0].AdvanceReceivableAccountID&&""!=e.Tables[2][0].AdvanceReceivableAccountID.toString()&&(this.RentRecAc.SelectedValue=parseInt(e.Tables[2][0].AdvanceReceivableAccountID)):104==this.CurrCostCenterID?null!=e.Tables[2][0].RentPayableAccount&&""!=e.Tables[2][0].RentPayableAccount.toString()&&(this.RentRecAc.SelectedValue=parseInt(e.Tables[2][0].RentPayableAccount)):1!=this.PickACC||this.PickRRfromTenant||null!=e.Tables[2][0].RentalReceivableAccountID&&""!=e.Tables[2][0].RentalReceivableAccountID.toString()&&(this.RentRecAc.SelectedValue=parseInt(e.Tables[2][0].RentalReceivableAccountID)),104==this.CurrCostCenterID?null!=e.Tables[2][0].AdvanceRentPaid&&""!=e.Tables[2][0].AdvanceRentPaid.toString()&&(this.GenAdvanceRentAcc=parseInt(e.Tables[2][0].AdvanceRentPaid)):1==this.PickACC&&(this.ParentContractID>0?null!=e.Tables[2][0].ParkingAdvanceRentAccountID&&""!=e.Tables[2][0].ParkingAdvanceRentAccountID.toString()&&(this.IncomeAc.SelectedValue=parseInt(e.Tables[2][0].ParkingAdvanceRentAccountID)):null!=e.Tables[2][0].AdvanceRentAccountID&&""!=e.Tables[2][0].AdvanceRentAccountID.toString()&&(this.GenAdvanceRentAcc=parseInt(e.Tables[2][0].AdvanceRentAccountID))),1==this.PickCC&&(null!=e.Tables[2][0].SalesmanID&&""!=e.Tables[2][0].SalesmanID.toString()&&(this.Salesman.SelectedValue=parseInt(e.Tables[2][0].SalesmanID.toString())),null!=e.Tables[2][0].AccountantID&&""!=e.Tables[2][0].AccountantID.toString()&&(this.Accountant.SelectedValue=parseInt(e.Tables[2][0].AccountantID.toString())),null!=e.Tables[2][0].LandlordID&&""!=e.Tables[2][0].LandlordID.toString()&&(this.Landlord.SelectedValue=parseInt(e.Tables[2][0].LandlordID.toString())),null!=e.Tables[2][0].LocationID&&""!=e.Tables[2][0].LocationID.toString()&&(this.LocationContract.SelectedValue=parseInt(e.Tables[2][0].LocationID.toString())))),this.ContractNumber.ComboBox.SelectedValue=this.Property.SelectedValue.toString(),this.OnContractPrefixChanged(this.ContractNumber.ComboBox.SelectedValue),t||this.DataTableObj.Clear(),104==this.CurrCostCenterID){let t,i,n="",r=this.DataTableObj.NewRow();if(r.Recurr=!1,this.DataTableObj.addRow(r),this.DataTable[0].Recurr=!0,this.GenAdvanceRentAcc>0){let t=s.a.rental.GetAccountName(this.GenAdvanceRentAcc);null!=t&&t.Tables.length>0&&t.Tables[0].length>0&&null!=t.Tables[0][0].ACCOUNTNAME&&""!=t.Tables[0][0].ACCOUNTNAME.toString()&&(this.GenAdvanceRentAccName=t.Tables[0][0].ACCOUNTNAME.toString()),this.DataTable[0].CreditAccountID_Key=this.GenAdvanceRentAcc,this.DataTable[0].CreditAccountID=this.GenAdvanceRentAccName}if(this.DataTableObj.updateRow(this.DataTable[0]),this.dsPart=this.StartDate.Date&&this.EndDate.Date?s.a.rental.GetParticularsDetails(this.RenewRefID,0,this.Property.SelectedValue,this.StartDate.Date,this.EndDate.Date,2,this.ContractID,""):this.StartDate.Date?s.a.rental.GetParticularsDetails(this.RenewRefID,0,this.Property.SelectedValue,this.StartDate.Date,new Date,2,this.ContractID,""):s.a.rental.GetParticularsDetails(this.RenewRefID,0,this.Property.SelectedValue,new Date,this.EndDate.Date?this.EndDate.Date:new Date,2,this.ContractID,""),n=null!=this.dsPart&&this.dsPart.Tables.length>3&&this.dsPart.Tables[3].length>0?this.dsPart.Tables[3][0][0].toString():"0",null!=n&&""!=n&&parseInt(n)>0&&s.a.rental.GetCostCenterNodeID("Rent",n,this.id2),this.DataTable[0].Particulars="Rent",this.DataTable[0].NodeID=this.id2.toString(),this.DataTableObj.updateRow(this.DataTable[0]),null!=this.dsPart&&this.dsPart.Tables.length>0&&this.dsPart.Tables[0].length>0)t=this.dsPart.Tables[0].filter(t=>1==t.Type||3==t.Type);else if(null!=this.dsPart&&this.dsPart.Tables.length>1&&this.dsPart.Tables[1].length>0){let e=this.dsPart.Tables[1];t=e.ToTable(),t=e.filter(t=>1==t.Type||3==t.Type)}var a;i=this.dsPart.Tables[6],null!=i&&i.length>0&&(i.Columns.Contains("BasedOn")&&""!=i[0].BasedOn.toString()&&(this.BasedOn.SelectedValue=i[0].BasedOn.toString()),0==this.PickCC&&(null!=i[0].SalesmanID&&""!=i[0].SalesmanID.toString()&&(this.Salesman.SelectedValue=parseInt(i[0].SalesmanID.toString())),null!=i[0].AccountantID&&""!=i[0].AccountantID.toString()&&(this.Accountant.SelectedValue=parseInt(i[0].AccountantID.toString())),null!=i[0].LandlordID&&""!=i[0].LandlordID.toString()&&(this.Landlord.SelectedValue=parseInt(i[0].LandlordID.toString())),null!=i[0].LocationID&&""!=i[0].LocationID.toString()&&(this.LocationContract.SelectedValue=parseInt(i[0].LocationID.toString())))),e.Tables.length>15&&e.Columns[15].Contains("ccnid70")&&parseInt(e.Tables[15][0].ccnid70.toString())&&(this.Vattype=parseInt(e.Tables[15][0].ccnid70.toString())),null!=e.Tables[15][0].ccnid58&&""!=e.Tables[15][0].ccnid58.toString()&&null!=(a=this.ScreenObject.GetExtrFieldByName("ccnid58"))&&a instanceof l.b&&(a.SelectedValue=parseInt(e.Tables[15][0].ccnid58.toString())),null!=e.Tables[15][0].ccnid70&&""!=e.Tables[15][0].ccnid70.toString()&&null!=(a=this.ScreenObject.GetExtrFieldByName("ccnid70"))&&a instanceof l.b&&(a.SelectedValue=parseInt(e.Tables[15][0].ccnid70.toString())),null!=e.Tables[15][0].ccnid59&&""!=e.Tables[15][0].ccnid59.toString()&&null!=(a=this.ScreenObject.GetExtrFieldByName("ccnid59"))&&a instanceof l.b&&(a.SelectedValue=parseInt(e.Tables[15][0].ccnid59.toString())),null!=e.Tables[15][0].ccnid61&&""!=e.Tables[15][0].ccnid61.toString()&&null!=(a=this.ScreenObject.GetExtrFieldByName("ccnid61"))&&a instanceof l.b&&(a.SelectedValue=parseInt(e.Tables[15][0].ccnid61.toString())),null!=e.Tables[15][0].ccnid62&&""!=e.Tables[15][0].ccnid62.toString()&&null!=(a=this.ScreenObject.GetExtrFieldByName("ccnid62"))&&a instanceof l.b&&(a.SelectedValue=parseInt(e.Tables[15][0].ccnid62.toString())),r=this.FillUnitDetails(r,t,this.dsPart),this.CalculateRent()}else if(!t){this.AddUnitWhere(1);for(let t=0;t<6;t++){let t=this.DataTableObj.NewRow();t.Recurr=!1,this.DataTableObj.addRow(t)}}}onListSelectedChanged(t){if(1==this.iSGenerate)return;let e;Logger.InfoLog("AddEditRenContractViewModel ::Entering onListSelectedChanged");try{if(null!=t){if(("Property"==t.toString()||t instanceof l.b&&92==t.CCID)&&this.PropID!=this.Property.SelectedValue)this.PropID=this.Property.SelectedValue,this.Property.SelectedValue>0&&(this.Unit.SelectedValue>0&&(this.Unit.SelectedValue=0),this.FillPropDetails(!1));else if(("Unit"==t.toString()||t instanceof l.b&&93==t.CCID)&&"Save"==this.strRenew&&this.UnitTempID!=this.Unit.SelectedValue){if(this.UnitTempID=this.Unit.SelectedValue,this.NoOfUnits.Text="0",this.Unit.SelectedValue>0){this.NoOfUnits.Text="1",this.FilterTenantBasedOnUnit&&0==this.ParentContractID&&(this.Tenant.CustomWhere=" a.TenantID IN (SELECT CC.NodeID FROM REN_Units U with(nolock)  LEFT JOIN COM_CCCCData CC with(nolock) ON CC.CCNID10=U.CCNodeID  WHERE CC.CostCenterID=94 AND U.UnitID="+this.Unit.SelectedValue+")"),this.DataTableObj.Clear();let t,a,i=this.DataTableObj.NewRow();if(i.Recurr=!1,this.DataTableObj.addRow(i),this.DataTable[0].Recurr=!0,0==this.PickACC&&(e=s.a.rental.GetUnitDetails(this.Unit.SelectedValue),n.e.IsEmpty(e.Tables[0][0].RentalIncomeAccountID)||""==e.Tables[0][0].RentalIncomeAccountID.toString()||(this.IncomeAc.SelectedValue=parseInt(e.Tables[0][0].RentalIncomeAccountID)),129==this.CurrCostCenterID?n.e.IsEmpty(e.Tables[0][0].AdvanceReceivableAccountID)||(this.RentRecAc.SelectedValue=parseInt(e.Tables[0][0].AdvanceReceivableAccountID)):this.PickRRfromTenant||n.e.IsEmpty(e.Tables[0][0].RentalReceivableAccountID)||""==e.Tables[0][0].RentalReceivableAccountID.toString()||(this.RentRecAc.SelectedValue=parseInt(e.Tables[0][0].RentalReceivableAccountID)),n.e.IsEmpty(e.Tables[0][0].AdvanceRentAccountID)||""==e.Tables[0][0].AdvanceRentAccountID.toString()||(this.GenAdvanceRentAcc=parseInt(e.Tables[0][0].AdvanceRentAccountID))),this.GenAdvanceRentAcc>0){let t=s.a.rental.GetAccountName(this.GenAdvanceRentAcc);null!=t&&t.Tables.length>0&&t.Tables[0].length>0&&null!=t.Tables[0][0].ACCOUNTNAME&&""!=t.Tables[0][0].ACCOUNTNAME.toString()&&(this.GenAdvanceRentAccName=t.Tables[0][0].ACCOUNTNAME.toString()),this.DataTable[0].CreditAccountID_Key=this.GenAdvanceRentAcc,this.DataTable[0].CreditAccountID=this.GenAdvanceRentAccName}if(this.DataTableObj.updateRow(this.DataTable[0]),this.dsPart=this.StartDate.Date&&this.EndDate.Date?s.a.rental.GetParticularsDetails(this.RenewRefID,this.Unit.SelectedValue,0,this.StartDate.Date,this.EndDate.Date,1,this.ContractID,this.SelectedUnits):this.StartDate.Date?s.a.rental.GetParticularsDetails(this.RenewRefID,this.Unit.SelectedValue,0,this.StartDate.Date,new Date,1,this.ContractID,this.SelectedUnits):s.a.rental.GetParticularsDetails(this.RenewRefID,this.Unit.SelectedValue,0,new Date,this.EndDate.Date?this.EndDate.Date:new Date,1,this.ContractID,this.SelectedUnits),this.DataTable[0].Particulars="Rent",this.DataTable[0].NodeID=this.id2.toString(),null!=this.dsPart&&this.dsPart.Tables.length>5&&this.dsPart.Tables[5].length>0&&(this.DataTable[0].Sqft=this.dsPart.Tables[5][0].RentableArea),this.DataTableObj.updateRow(this.DataTable[0]),null!=this.dsPart&&this.dsPart.Tables.length>0&&this.dsPart.Tables[0].length>0){let e=this.dsPart.Tables[0];e.RowFilter=" Type in (1,3) ",t=e.filter(t=>1==t.Type||3==t.Type)}else if(null!=this.dsPart&&this.dsPart.Tables.length>1&&this.dsPart.Tables[1].length>0){let e=this.dsPart.Tables[1];e=e.filter(t=>1==t.Type||3==t.Type),this.dsPart.Tables[1].Contains("UnitID")&&(e=e.filter(t=>1==t.Type||3==t.Type&&(0==t.UnitID||t.UnitID==this.Unit.SelectedValue))),t=e}if(a=this.dsPart.Tables[6],null!=a&&a.length>0){if(a.Contains("BasedOn")&&!n.e.IsEmpty(a[0].BasedOn)&&(this.BasedOn.SelectedValue=a[0].BasedOn.toString()),n.e.IsEmpty(a.some(t=>t.hasOwnProperty("ccnid70")))||n.e.IsEmpty(a[0].ccnid70.toString())||(this.Vattype=parseInt(a[0].ccnid70.toString())),0==this.PickCC&&(n.e.IsEmpty(a[0].SalesmanID)||""==a[0].SalesmanID.toString()||(this.Salesman.SelectedValue=parseInt(a[0].SalesmanID.toString())),n.e.IsEmpty(a[0].AccountantID)||""==a[0].AccountantID.toString()||(this.Accountant.SelectedValue=parseInt(a[0].AccountantID.toString())),n.e.IsEmpty(a[0].LandlordID)||""==a[0].LandlordID.toString()||(this.Landlord.SelectedValue=parseInt(a[0].LandlordID.toString())),n.e.IsEmpty(a[0].LocationID)||""==a[0].LocationID.toString()||(this.LocationContract.SelectedValue=parseInt(a[0].LocationID.toString()))),!n.e.IsEmpty(a[0].ccnid58)&&""!=a[0].ccnid58.toString()){let t=this.ScreenObject.GetExtrFieldByName("ccnid58");null!=t&&t instanceof l.b&&(t.SelectedValue=parseInt(a[0].ccnid58.toString()))}if(!n.e.IsEmpty(a[0].ccnid70)&&""!=a[0].ccnid70.toString()){let t=this.ScreenObject.GetExtrFieldByName("ccnid70");null!=t&&t instanceof l.b&&(t.SelectedValue=parseInt(a[0].ccnid70.toString()))}if(!n.e.IsEmpty(a[0].ccnid59)&&""!=a[0].ccnid59.toString()){let t=this.ScreenObject.GetExtrFieldByName("ccnid59");null!=t&&t instanceof l.b&&(t.SelectedValue=parseInt(a[0].ccnid59.toString()))}if(!n.e.IsEmpty(a[0].ccnid61)&&""!=a[0].ccnid61.toString()){let t=this.ScreenObject.GetExtrFieldByName("ccnid61");null!=t&&t instanceof l.b&&(t.SelectedValue=parseInt(a[0].ccnid61.toString()))}if(!n.e.IsEmpty(a[0].ccnid62)&&""!=a[0].ccnid62.toString()){let t=this.ScreenObject.GetExtrFieldByName("ccnid62");null!=t&&t instanceof l.b&&(t.SelectedValue=parseInt(a[0].ccnid62.toString()))}}i=this.FillUnitDetails(i,t,this.dsPart),this.CalculateRent()}}else("Tenant"==t.toString()||t instanceof l.b&&94==t.CCID&&this.TenantTempID!=this.Tenant.SelectedValue)&&(this.TenantTempID=this.Tenant.SelectedValue,this.PickRRfromTenant&&this.Tenant.SelectedValue>0&&(this.RentRecAc.SelectedValue=s.a.rental.GetTenantAccount(this.Tenant.SelectedValue)));t instanceof l.b&&(92==t.CCID||93==t.CCID||94==t.CCID)&&this.ScreenObject.OnGetReference(t)}this.RefreshGrid=!this.RefreshGrid,Logger.InfoLog("AddEditRenContractViewModel ::Exiting onListSelectedChanged")}catch(a){console.log("property change"),console.log(a.StackTrace)}}FillUnitDetails(t,e=[],a){let i=a.Tables[5],r=0,o=0;if(this.dtParticulars=e,null!=e){if(0==this.Property.SelectedValue&&e.length>0&&(null!=e[0].ActualPropertyID&&""!=e[0].ActualPropertyID.toString()&&(this.Property.PreviousSelectedValue=parseInt(e[0].ActualPropertyID),this.Property.SelectedValue=parseInt(e[0].ActualPropertyID)),this.FillPropDetails(!0),this.GenAdvanceRentAcc>0)){let t=s.a.rental.GetAccountName(this.GenAdvanceRentAcc);null!=t&&t.Tables.length>0&&t.Tables[0].length>0&&null!=t.Tables[0][0].ACCOUNTNAME&&""!=t.Tables[0][0].ACCOUNTNAME.toString()&&(this.GenAdvanceRentAccName=t.Tables[0][0].ACCOUNTNAME.toString()),this.DataTable[0].CreditAccountID_Key=this.GenAdvanceRentAcc,this.DataTable[0].CreditAccountID=this.GenAdvanceRentAccName}if(i.length>0)if(""!=this.SelectedUnits){let t=0,e=0,a=this.SelectedUnits.split(",");for(let i=0;i<a.length;i++)if(!n.e.StringIsNullOrEmpty(a[i])){let s=this.GetRent(a[i],this.dsPart,r,o);r=s.Rent,o=s.Disc,t+=r,e+=o}this.DataTable[0].Amount=t.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()),this.DataTable[0].ActAmount=(t+e).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()),this.DataTable[0].Discount=e.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString())}else{let t=this.GetRent("",a,r,o);r=t.Rent,o=t.Disc,this.DataTable[0].Amount=r.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()),this.DataTable[0].Discount=o.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()),this.DataTable[0].ActAmount=(r+o).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString())}this.DataTable[0].InclChkGen="1",3==this.Vattype&&this.VatonRent>0?(this.DataTable[0].VatPer=this.VatonRent,this.ScreenObject.Data.Tables.length>6&&this.ScreenObject.Data.Columns[6].Contains("TCVat")&&this.ScreenObject.Data.Tables[6].length>0&&""!=this.ScreenObject.Data.Tables[6][0].TCVat.toString()&&(this.DataTable[0].TaxCategory=this.ScreenObject.Data.Tables[6][0].TCVat.toString()),this.DataTable[0].TaxCategory_Key=3,this.DataTable[0].VatType="Exclusive"):this.ScreenObject.Data.Tables.length>6&&this.ScreenObject.Data.Columns[6].Contains("TcExcemt")&&this.ScreenObject.Data.Tables[6].length>0&&""!=this.ScreenObject.Data.Tables[6][0].TcExcemt.toString()&&(this.DataTable[0].TaxCategory=this.ScreenObject.Data.Tables[6][0].TcExcemt.toString(),this.DataTable[0].TaxCategory_Key=1),this.TaxCatFromUnit&&null!=a&&a.Columns[6].Contains("TcExcemt")&&a.Tables[6].length>0&&""!=a.Tables[6][0].ccnid60.toString()&&(this.DataTable[0].TaxCategory_Key=a.Tables[6][0].ccnid60.toString(),this.DataTable[0].TaxCategory=a.Tables[6][0].TcExcemt.toString()),this.DataTableColumns.Contains("SPType_Key")&&null!=a&&a.Columns[6].Contains("SPTypeName")&&a.Tables[6].length>0&&""!=a.Tables[6][0].ccnid61.toString()&&(this.DataTable[0].SPType_Key=a.Tables[6][0].ccnid61.toString(),this.DataTable[0].SPType=a.Tables[6][0].SPTypeName.toString()),this.DataTableColumns.Contains("Dim_Key")&&null!=a&&a.Columns[6].Contains("Dimname")&&a.Tables[6].length>0&&"0"!=a.Tables[6][0].DimNodeID.toString()&&(this.DataTable[0].Dim_Key=a.Tables[6][0].DimNodeID.toString(),this.DataTable[0].Dim=a.Tables[6][0].Dimname.toString()),50002==this.DimCCID&&this.DataTableColumns.Contains("Dim_Key")&&this.LocationContract.SelectedValue>0&&(this.DataTable[0].Dim_Key=this.LocationContract.SelectedValue,this.DataTable[0].Dim=this.LocationContract.Text),this.DataTableColumns.Contains("Location_Key")&&this.LocationContract.SelectedValue>0&&(this.DataTable[0].Location_Key=this.LocationContract.SelectedValue),this.DistribtueInvoice&&(this.DataTable[0].RecurInvoice="true");let t,l,c=0,h=0;null!=this.DataTable[0].Amount&&null!=this.DataTable[0].Amount&&(h=parseFloat(this.DataTable[0].Amount),this.OriginalRent=h),t=this.CalculateMonths(),l=t>1?n.e.Round(parseFloat(h.toString())/t,this.Mdeci):parseFloat(h.toString()),e.length>0&&null!=e[0].TermsConditions.toString()&&""!=e[0].TermsConditions.toString()&&(this.TermsConditions.Text=e[0].TermsConditions.toString());for(let a=1;a<=e.length;a++){c=0;let t=this.DataTableObj.NewRow();if(t.Recurr=!1,t.NodeID=e[a-1].NodeID.toString(),t.Particulars=e[a-1].Particulars.toString(),n.e.IsEmpty(e[a-1].CreditID)||(t.CreditAccountID_Key=e[a-1].CreditID.toString()),n.e.IsEmpty(e[a-1].DebitID)||(t.DebitAccountID_Key=e[a-1].DebitID.toString()),n.e.IsEmpty(e[a-1].BankAccountID)||(t.BankAccountID=e[a-1].BankAccountID.toString()),null!=e[a-1].AdvanceAcc&&!n.e.IsEmpty(e[a-1].AdvanceAcc)&&parseInt(e[a-1].AdvanceAcc.toString())>0&&(t.AdvanceAcc=e[a-1].AdvanceAcc.toString()),this.DataTableObj.addRow(t),""!=this.SelectedUnits){if(1!=this.DataTable.filter(t=>t.NodeID==e[a-1].NodeID.toString()).length)continue;{let i=[]=e.filter(t=>t.NodeID==e[a-1].NodeID.toString());for(let t=0;t<i.length;t++)!n.e.IsEmpty(i[t].DiscountAmount)&&parseFloat(i[t].DiscountAmount)>0?c+=parseFloat(i[t].DiscountAmount):!n.e.IsEmpty(i[t].DiscountPercentage)&&parseFloat(i[t].DiscountPercentage)>0?c+=parseFloat(i[t].DiscountPercentage)*h/100:!n.e.IsEmpty(i[t].Months)&&parseFloat(i[t].Months)>0&&(c+=l*parseFloat(i[t].Months));t.Amount=c,!n.e.IsEmpty(e[a-1].VAT)&&parseFloat(e[a-1].VAT.toString())>0&&(t.VatPer=parseFloat(e[a-1].VAT.toString()))}}else!n.e.IsEmpty(e[a-1].DiscountAmount)&&parseFloat(e[a-1].DiscountAmount)>0?c=parseFloat(e[a-1].DiscountAmount):!n.e.IsEmpty(e[a-1].DiscountPercentage)&&parseFloat(e[a-1].DiscountPercentage)>0?c=parseFloat(e[a-1].DiscountPercentage)*h/100:!n.e.IsEmpty(e[a-1].Months)&&parseFloat(e[a-1].Months)>0&&(c=l*parseFloat(e[a-1].Months)),t.Amount=c;t.Discount=0,t.ActAmount=t.Amount,!n.e.IsEmpty(e[a-1].VAT)&&""!=n.e.StringValue(e[a-1].VAT)&&parseFloat(e[a-1].VAT.toString())>0&&(t.VatPer=parseFloat(e[a-1].VAT.toString())),""!=n.e.StringValue(e[a-1].InclChkGen)&&(t.InclChkGen=e[a-1].InclChkGen.toString()),n.e.IsEmpty(e[a-1].TaxCategoryID)||""==n.e.StringValue(e[a-1].TaxCategoryID)||(t.TaxCategory_Key=e[a-1].TaxCategoryID.toString(),t.TaxCategory=e[a-1].TaxCategory.toString()),n.e.IsEmpty(e[a-1].Display)||""==e[a-1].Display.toString()||(t.Display=e[a-1].Display.toString(),"0"==t.Display.toString()&&(t.StyleHeightZero=1)),this.DataTableColumns.Contains("SPType_Key")&&!n.e.IsEmpty(e[a-1].SPType)&&""!=n.e.StringValue(e[a-1].SPType)&&(t.SPType_Key=e[a-1].SPType.toString(),t.SPType=e[a-1].SPTypeName.toString()),this.DataTableColumns.Contains("Dim_Key")&&!n.e.IsEmpty(e[a-1].Dimname)&&""!=n.e.StringValue(e[a-1].Dimname)&&(t.Dim_Key=e[a-1].DimNodeID.toString(),t.Dim=e[a-1].Dimname.toString()),this.DataTableColumns.Contains("Location_Key")&&this.LocationContract.SelectedValue>0&&(t.Location_Key=this.LocationContract.SelectedValue),t.VatType=n.e.StringValue(e[a-1].VatType),t.RecurInvoice=n.e.StringValue(e[a-1].RecurInvoice).toLowerCase(),t.PostDebit=n.e.StringValue(e[a-1].PostDebit),""!=n.e.StringValue(e[a-1].CreditName)&&(t.CreditAccountID=e[a-1].CreditName.toString()),""!=n.e.StringValue(e[a-1].DebitName)&&(t.DebitAccountID=n.e.StringValue(e[a-1].DebitName)),""!=n.e.StringValue(e[a-1].DiscountPercentage)&&(t.DiscountPercentage=n.e.StringValue(e[a-1].DiscountPercentage)),""!=n.e.StringValue(e[a-1].Months)&&(t.Months=n.e.StringValue(e[a-1].Months));for(let i=0;i<this.ContractParticular.length;i++)this.ContractParticular[i].DisplayMember.startsWith("CCNID")&&e.Columns.Contains(this.ContractParticular[i].DisplayMember)&&e.Columns.Contains(this.ContractParticular[i].ValueMember)&&""!=e[a-1][this.ContractParticular[i].DisplayMember].toString()&&(t[this.ContractParticular[i].ValueMember]=e[a-1][this.ContractParticular[i].DisplayMember].toString());this.DataTableObj.updateRow(t)}this.CalculateNRec()}else{if(this.DataTableObj.Clear(),this.NonRecAmount.Text="0.00",this.TotalAmount.Text="0.00",this.RecAmount.Text="0.00",0==this.DataTableObj.Table.length)for(let t=0;t<6;t++){let t=this.DataTableObj.NewRow();t.Recurr=!1,this.DataTableObj.addRow(t)}if(this.DataTable[0].Particulars="Rent",this.DataTable[0].NodeID=this.id2.toString(),this.GenAdvanceRentAcc>0&&(this.DataTable[0].CreditAccountID=this.GenAdvanceRentAccName,this.DataTable[0].CreditAccountID_Key=this.GenAdvanceRentAcc),a.Tables.length>2&&a.Tables[2].length>0){null!=a.Tables[2][0].PropertyID&&""!=a.Tables[2][0].PropertyID.toString()&&(this.Property.PreviousSelectedValue=parseInt(a.Tables[2][0].PropertyID),this.Property.SelectedValue=parseInt(a.Tables[2][0].PropertyID));let t=this.GetRent("",a,r,o);r=t.Rent,o=t.Disc,this.DataTable[0].Amount=r.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()),this.DataTable[0].Discount=o.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()),this.DataTable[0].ActAmount=(r+o).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString())}this.DataTableObj.updateRow(this.DataTable[0])}this.OriginalRent=parseFloat(this.DataTable[0].Amount),this.RentAmt.Text=n.e.StringValue(this.DataTable[0].Amount);for(let s=0;s<6;s++){let t=this.DataTableObj.NewRow();t.Recurr=!1,this.DataTableObj.addRow(t)}return this.UpdateSequence(),t}GetRent(t,e,a,i){a=0,i=0;let s=null;return this.StartDate.Date&&(s=n.e.StringIsNullOrEmpty(t)?e.Tables[7].filter(t=>t.WEF<=this.StartDate.Date,"WEF desc"):e.Tables[7].filter(e=>e.UNITID==t&&e.WEF<=this.StartDate.Date,"WEF desc")),null!=s&&s.length>0?(n.e.IsEmpty(s[0].RENT)||(a=parseFloat(s[0].RENT.toString())),n.e.IsEmpty(s[0].DICOUNT)||(i=parseFloat(s[0].DICOUNT.toString()))):e.Tables[5].length>0&&(n.e.StringIsNullOrEmpty(t)?(n.e.IsEmpty(e.Tables[5][0].RENT)||(a=parseFloat(e.Tables[5][0].RENT)),n.e.IsEmpty(e.Tables[5][0].DICOUNT)||(i=parseFloat(e.Tables[5][0].DICOUNT))):(s=e.Tables[5].filter(e=>e.UnitID==t),s.length>0&&(n.e.IsEmpty(s[0].RENT)||(a=parseFloat(s[0].RENT.toString())),n.e.IsEmpty(s[0].DICOUNT)||(i=parseFloat(s[0].DICOUNT.toString()))))),{Rent:a,Disc:i}}CalculateNRec(){let t=0,e=0,a=0,i=0;for(let r=0;r<this.DataTable.length;r++)if(""!=n.e.StringValue(this.DataTable[r].Amount)&&"0"!=n.e.StringValue(this.DataTable[r].Display))if(""!=n.e.StringValue(this.DataTable[r].DebitAccountID_Key)&&parseInt(this.DataTable[r].DebitAccountID_Key)>0?e+=parseFloat(this.DataTable[r].Amount):t+=parseFloat(this.DataTable[r].Amount),""!=n.e.StringValue(this.DataTable[r].VatPer)){let i=0;if(""!=n.e.StringValue(this.DataTable[r].Xml)&&this.StartDate.Date&&this.StartDate.Date<this.vatwef){let t=new n.f;if(t.LoadXml(this.DataTable[r].Xml.toString()),t.DocumentElement.children.length>0){let e;e=null!=t.DocumentElement.children[0].attributes.Filter&&0==parseInt(t.DocumentElement.children[0].attributes.Filter.value)?t.SelectNodes("XML/UnitsRow/Row"):t.SelectNodes("XML/Row"),e.forEach(t=>{let e;e=n.e.isValidDate(t.attributes.FromDate.value),e>=this.vatwef&&(i+=parseFloat(t.attributes.Amount.value))})}}else i=parseFloat(this.DataTable[r].Amount);"Inclusive"==n.e.StringValue(this.DataTable[r].VatType)?(this.DataTable[r].TaxableAmt=(100*i/(parseFloat(this.DataTable[r].VatPer)+100)).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()),this.DataTable[r].VatAmount=(i-parseFloat(this.DataTable[r].TaxableAmt)).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString())):(this.DataTable[r].TaxableAmt=i,this.DataTable[r].VatAmount=(parseFloat(this.DataTable[r].TaxableAmt)*parseFloat(this.DataTable[r].VatPer)/100).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString())),this.DataTable[r].VatAmount=(parseFloat(this.DataTable[r].TaxableAmt)*parseFloat(this.DataTable[r].VatPer)/100).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()),a+=parseFloat(this.DataTable[r].VatAmount),"Inclusive"!=n.e.StringValue(this.DataTable[r].VatType)&&(!n.e.StringIsNullOrEmpty(this.DataTable[r].DebitAccountID_Key)&&""!=n.e.StringValue(this.DataTable[r].DebitAccountID_Key)&&parseInt(this.DataTable[r].DebitAccountID_Key)>0?e+=parseFloat(this.DataTable[r].VatAmount):t+=parseFloat(this.DataTable[r].VatAmount))}else this.DataTable[r].TaxableAmt=this.DataTable[r].Amount,this.DataTable[r].VatAmount="0";else 0==i&&(i=r);if(a>0&&!s.a.SessionManager.Preferences.ContainsKey("VATVersion"))if(this.VatNode>0){let t,e=this.DataTable.filter(t=>t.NodeID==this.VatNode);e.length>0?t=e[0]:(t=this.DataTableObj.NewRow(),t.NodeID=this.VatNode,t.Particulars="vat",0==i?this.DataTableObj.addRow(t):this.DataTableObj.insertRowAt(t,i)),t.Amount=a,this.DataTableObj.addRow(t)}else this.DisplayMessage="Define Vat Node.",this.MessageVisibility=!0;this.RecAmount.Text=t.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()),this.NonRecAmount.Text=e.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()),this.TotalAmount.Text=(e+t).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString())}OnYearChange(t){this.yr&&(this.mn=!1,""!=this.TotalYears.Text&&n.e.ValidateInt(this.TotalYears.Text)?(parseInt(this.TotalYears.Text)>0&&(this.EndDate.Date="30"==this.DaysCount&&this.StartDate.Date?this.StartDate.Date.AddYears(parseInt(this.TotalYears.Text)):"30"==this.DaysCount?(new Date).AddYears(n.e.IntTryParse(this.TotalYears.Text)):"30"!=this.DaysCount&&this.StartDate.Date?this.StartDate.Date.AddYears(n.e.IntTryParse(this.TotalYears.Text)).AddDays(-1):(new Date).AddYears(n.e.IntTryParse(this.TotalYears.Text)).AddDays(-1)),this.MessageVisibility=!1):n.e.StringIsNullOrEmpty(this.TotalYears.Text)||(this.DisplayMessage=s.a.GetResource("InvalidFormat"),this.MessageVisibility=!0),this.mn=!0)}OnGracePeriodChange(t){let e=0;e=parseInt(this.GracePeriod.Text),this.EndDate.Date&&(this.ExpectedEndDate.Date=this.EndDate.Date.AddDays(e))}OnMonthChange(t){this.mn&&(this.yr=!1,""!=this.Months.Text&&n.e.ValidateInt(this.Months.Text)&&this.StartDate.Date?parseInt(this.Months.Text)>0&&(this.EndDate.Date=this.StartDate.Date.AddMonths(parseInt(this.Months.Text)).AddDays(-1)):""!=this.Months.Text&&n.e.ValidateInt(this.Months.Text)?parseInt(this.Months.Text)>0&&(this.EndDate.Date=(new Date).AddMonths(n.e.IntTryParse(this.Months.Text)).AddDays(-1)):(this.DisplayMessage=s.a.GetResource("InvalidFormat"),this.MessageVisibility=!0),this.yr=!0),this.CalculateRent()}OnContractDateChanged(t){this.ExtndTill.Date=this.ContractDate.Date.AddDays(this.ValidTill)}OnselectionChange(t){if(Logger.InfoLog("AddEditRenContractViewModel ::Entering OnselectionChange"),this.StartDate.Date){if(null!=this.EndDate.Date&&this.StartDate.Date>this.EndDate.Date)return this.DisplayMessage="End Date cannot be less than Start Date",this.TotalDays.Text="",void(this.MessageVisibility=!0);null!=this.EndDate.Date&&this.StartDate.Date<=this.EndDate.Date?(this.MessageVisibility=!1,""==this.DaysCount||""==this.Months.Text||"0"==this.Months.Text?this.StartDate.Date&&(this.TotalDays.Text=Math.round(this.EndDate.Date.Subtract(this.StartDate.Date).Days+1).toString(),this.CalcMonthandYear()):""!=this.Months.Text&&(this.TotalDays.Text=Math.round(30*parseInt(this.Months.Text)).toString()),this.CalculateRentBaedOnDays(0,!this.CalculateRentAmountInDays)):(this.CalculateRentBaedOnDays(0,!0),this.TotalDays.Text="0",this.Months.Text="0",this.TotalYears.Text="0")}else if(0==this.SaveAndPrintContactID)return this.DisplayMessage=s.a.GetResource("PleaseSelectStartDate"),this.TotalDays.Text="",void(this.MessageVisibility=!0);""==n.e.StringValue(this.GracePeriod.Text)&&(this.GracePeriod.Text="0");let e=0;t==this.EndDate&&this.EndDate.Date?(e=parseInt(this.GracePeriod.Text),this.ExpectedEndDate.Date=this.EndDate.Date.AddDays(e)):t==this.ExpectedEndDate&&this.EndDate.Date&&this.ExpectedEndDate.Date&&(this.GracePeriod.Text=this.ExpectedEndDate.Date.Subtract(this.EndDate.Date).Days.toString()),this.CalculateRent(),Logger.InfoLog("AddEditRenContractViewModel ::Exiting OnselectionChange")}CalcMonthandYear(){let t=new T.a,e=new Y.c;e.setFieldDetails("StartDate",1,1,"",1,!1,!1),t.push("StartDate",e),e=new Y.c,e.setFieldDetails("EndDate",4,1,"",1,!1,!1),t.push("EndDate",e),t.StartDate.setFieldValue(this.StartDate.Date.Date()),t.EndDate.setFieldValue(this.EndDate.Date.Date());let a=t;this.Months.Text=s.a.eval.EvaluateExpression('DATEDIFF("m",EndDate,StartDate)',a).toString(),this.TotalYears.Text=s.a.eval.EvaluateExpression('DATEDIFF("y",EndDate,StartDate)',a).toString()}CalculateRentBaedOnDays(t,e){if((this.CalculateRentAmountInDays||e&&null!=this.dsPart&&this.dsPart.Tables.length>5&&this.dsPart.Tables[5].length>0)&&null!=this.dsPart&&this.dsPart.Tables.length>4&&this.dsPart.Tables[5].length>0){0==t&&(t=parseFloat(this.TotalDays.Text));let i=0,r=0;if(""!=this.SelectedUnits){let o=0,l=0;var a=this.SelectedUnits.split(",");for(let t=0;t<a.length;t++)if(!n.e.StringIsNullOrEmpty(a[t])){let e=this.GetRent(a[t],this.dsPart,i,r);i=e.Rent,r=e.Disc,o+=i,l+=r}e||(o=o/365*t,l=l/365*t),this.DataTable[0].Amount=o.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()),this.DataTable[0].ActAmount=(o+l).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()),this.DataTable[0].Discount=l.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString())}else{let a=this.GetRent("",this.dsPart,i,r);i=a.Rent,r=a.Disc,e||(i=i/365*t,r=r/365*t),this.DataTable[0].Amount=i.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()),this.DataTable[0].Discount=r.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()),this.DataTable[0].ActAmount=(i+r).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString())}this.OriginalRent=parseFloat(this.DataTable[0].Amount),this.RentAmt.Text=this.DataTable[0].Amount.toString(),this.CalculateNRec(),this.CalculateFooter()}}FilterXML(){let t="",e=new Date;return t+="<XML>",t+="<Row ",t+=' ColID="FROMDATE"',t+=this.StartDate.Date>this.ContractDate.Date?' Value="'+this.ContractDate.Date.ToString("dd MMM yyyy")+'"':this.StartDate.Date?' Value="'+this.StartDate.Date.ToString("dd MMM yyyy")+'"':' Value="'+e.ToString("dd MMM yyyy")+'"',t+=" />",t+="<Row ",t+=' ColID="TODATE"',t+=this.EndDate.Date?' Value="'+this.EndDate.Date.ToString("dd MMM yyyy")+'"':' Value="'+e.ToString("dd MMM yyyy")+'"',t+=" />","True"==s.a.SessionManager.Preferences.EnableLocationWise.toString()&&"True"==s.a.SessionManager.Preferences["LW Reports"]&&"True"==s.a.SessionManager.Preferences.LWAccPeriod&&this.LocationContract.SelectedValue>0&&(t+="<Row ",t+=' ColID="50002"',t+=' Value="'+this.LocationContract.SelectedValue.toString()+'"',t+=" />"),t+="<Row ",t+=' ColID="CONTRACTNODEID"',t+=' Value="'+this.ContractID+'"',t+=" />",t+="<Row ",t+=' ColID="CONTRACTRefCCID"',t+=' Value="'+this.CurrCostCenterID+'"',t+=" />",t+="</XML>",t.toString()}OnSave(t,e=null){return Object(i.b)(this,void 0,void 0,(function*(){Logger.InfoLog("AddEditRenContractViewModel ::Entering OnSave");let i=0;if(this.ButtonsPopUp=!1,"GeneralLedger"==t){let t;const{ReportViewModel:e}=yield Promise.all([a.e(2),a.e(1),a.e(3),a.e(5),a.e(4),a.e(6),a.e(7),a.e(10),a.e(9),a.e(8),a.e(12),a.e(11),a.e(13),a.e(19),a.e(15),a.e(21),a.e(20),a.e(16),a.e(14),a.e(18),a.e(17),a.e(22),a.e(23),a.e(24),a.e(25),a.e(28),a.e(30),a.e(29),a.e(32),a.e(31),a.e(27),a.e(26),a.e(35),a.e(37),a.e(38),a.e(36),a.e(33),a.e(34),a.e(39),a.e(40),a.e(41),a.e(212)]).then(a.bind(null,"ThYU")),{ReportViewComponent:i}=yield Promise.all([a.e(32),a.e(37)]).then(a.bind(null,"YU11"));s.a.page.ShowLoading=!0,t=this.FilterXML(),setTimeout(()=>{if(s.a.page.ShowLoading=!1,104==this.CurrCostCenterID){let a=new e;a.ReportViewModel_Document(104,t,2,!1,null,null),a.DocumentObject=this,a.TransferData=this,s.a.page.addNewTab({component:i,params:{obj:a}})}else{let a=this.ScreenObject.Data.Tables[5].filter(t=>"RenGeneralLedger"==t.Name);if(a.length>0){let r;if(r=n.e.IntTryParse(a[0].Value.toString()),r>0){let a=new e;a.ReportViewModel_Document(95,t,r,!1,null,null),s.a.page.addNewTab({component:i,params:{obj:a}})}}}},1e3)}else if("GenerateLink"==t){let t=new Array;if(this.DataTable.length>0&&!n.e.IsEmpty(this.DataTable[0].Xml)){let e=new n.f;e.LoadXml(this.DataTable[0].Xml.toString());let a=-1;if(e.ChildNodes.length>0&&null!=e.ChildNodes[0].Attributes&&null!=e.ChildNodes[0].attributes.Filter&&!n.e.StringIsNullOrEmpty(e.ChildNodes[0].attributes.Filter.value)&&(a=parseInt(e.ChildNodes[0].attributes.Filter.value)),2==a||-1==a){let a=new Date,i=new Date;e.ChildNodes[0].ChildNodes.forEach(e=>{n.e.isValidDate(e.attributes.FromDate.value)&&(a=new Date(e.attributes.FromDate.value)),n.e.isValidDate(e.attributes.ToDate.value)&&(i=new Date(e.attributes.ToDate.value)),null==e.attributes.Period||n.e.StringIsNullOrEmpty(e.attributes.Period.value)?t.push(c.d.ComboBoxItems_4(a.ToString(s.a.SessionManager.Preferences["Date Format"])+" - "+i.ToString(s.a.SessionManager.Preferences["Date Format"]),a.ToString("dd/MMM/yyyy"),i.ToString("dd/MMM/yyyy"),e.attributes.Amount.value)):t.push(c.d.ComboBoxItems_7(a.ToString(s.a.SessionManager.Preferences["Date Format"])+" - "+i.ToString(s.a.SessionManager.Preferences["Date Format"]),a.ToString("dd/MMM/yyyy"),i.ToString("dd/MMM/yyyy"),e.attributes.Amount.value,parseInt(e.attributes.Period.value)))})}else if(0==a){var o=e.SelectNodes("XML/UnitsRow/Row");let a=new Date,i=new Date;o.forEach(e=>{n.e.isValidDate(e.attributes.FromDate.value)&&(a=new Date(e.attributes.FromDate.value)),n.e.isValidDate(e.attributes.ToDate.value)&&(i=new Date(e.attributes.ToDate.value));var r=t.find(t=>!n.e.StringIsNullOrEmpty(t.Value)&&!n.e.StringIsNullOrEmpty(t.Parent)&&new Date(t.Value)==a&&new Date(t.Parent)==i);null!=r&&null!=r?r.Aliasname=(parseFloat(r.Aliasname)+parseFloat(e.attributes.Amount.value)).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()):null==e.attributes.Period||n.e.StringIsNullOrEmpty(e.attributes.Period.value)?t.push(c.d.ComboBoxItems_4(a.ToString(s.a.SessionManager.Preferences["Date Format"])+" - "+i.ToString(s.a.SessionManager.Preferences["Date Format"]),a.ToString("dd/MMM/yyyy"),i.ToString("dd/MMM/yyyy"),e.attributes.Amount.value)):t.push(c.d.ComboBoxItems_7(a.ToString(s.a.SessionManager.Preferences["Date Format"])+" - "+i.ToString(s.a.SessionManager.Preferences["Date Format"]),a.ToString("dd/MMM/yyyy"),i.ToString("dd/MMM/yyyy"),e.attributes.Amount.value,parseInt(e.attributes.Period.value)))})}}if(t.length>0&&(103!=this.CurrCostCenterID||2!=this.QuotLink)){const{UpdatePayTermsViewModel:e}=yield a.e(68).then(a.bind(null,"Rr92")),{UpdatepaytermsComponent:i}=yield a.e(0).then(a.bind(null,"++ql"));let n=new e("AddEditRenContractViewModel");n.UpdatePayTermsViewModel_1(this,null,t),s.a.page.ShowDialog(n,i,{Title:"Distribute",HideClose:!0,ShowCenter:!0})}else this.GenerateContract();setTimeout(()=>{this.iSGenerate=!1},500)}else if("Email"==t){let t=s.a.common.GetDataTable("AERC001",this.Tenant.SelectedValue.toString());null!=t&&t.length>0&&(this.Email=n.e.StringValue(t[0].Email)),this.ContractID>0&&s.a.page.ShowDialog(new U.SendEmailSMSViewModel(!0,this.CostCenterID,this.ContractID,this),_.SendEmailSMSComponent)}else if("Cheque"==t){if(event.preventDefault(),0==this.Unit.SelectedValue&&(!this.IsMultiunit||""==this.SelectedUnits)&&104!=this.CurrCostCenterID)return this.DisplayMessage=s.a.GetResource("PleaseselectUnit"),void(this.MessageVisibility=!0);if(null==this.DataTable[0].Amount||null!=this.DataTable[0].Amount&&""!=this.DataTable[0].Amount.toString()&&0==parseInt(this.DataTable[0].Amount))return this.DisplayMessage="Please enter Amount",void(this.MessageVisibility=!0);if(""==this.TotalDays.Text||""!=this.TotalDays.Text&&0==parseInt(this.TotalDays.Text))return this.DisplayMessage="Total Days should be greater than 0",void(this.MessageVisibility=!0);{let t=new f(this);t.oparent=this,s.a.page.ShowDialog(t,M.a,{HideClose:!0,ShowCenter:!0,Title:t.DisplayName})}}else if("LoadDraft"==t)this.DocumentDraftsPopup(1);else if("Save"==t||"AutoSave"==t||"SaveDraft"==t){if(s.a.page.ShowLoading=!0,setTimeout(()=>{s.a.page.ShowLoading=!1},500),103==this.CurrCostCenterID&&this.ContractID>0){let t=s.a.rental.GetQuotationDetails(this.ContractID);null!=t&&t.Tables.length>0&&t.Tables[0].length>0&&(this.ContractExists=Object(r.j)(t.Tables[0][0].ContractExists.toString()))}try{if(this.ContractExists&&(129==this.CurrCostCenterID||103==this.CurrCostCenterID))return this.DisplayMessage=129==this.CurrCostCenterID?"Contract prepared for this reservation,Can not update data":"Reservation prepared for this quotation,Can not update data",void(this.MessageVisibility=!0);if(95==this.CostCenterID&&0==this.ContractID&&this.MandatoryLinking&&"426"==this.StatusID.SelectedValue&&0==this.LinkedQuotationID)return this.DisplayMessage="Mandatory Linking,Can not create contract directly",void(this.MessageVisibility=!0);if(this.SaveAndPrintContactID=0,this.SaveAndPrintStatusID=0,"AutoSave"==t||!this.validate(t)){if(this.cntrct.ContractID=this.ContractID,this.cntrct.ContractPrefix=this.ContractNumber.ComboBox.SelectedValue,null==this.ContractNumber.TextBox.Text)return this.DisplayMessage="Please enter Contract Number",void(this.MessageVisibility=!0);if(this.cntrct.ContractNumber=parseInt(this.ContractNumber.TextBox.Text),this.cntrct.ContractDate=new Date(this.ContractDate.Date).ToString("dd-MMM-yyyy"),"451"==this.StatusID.SelectedValue&&(this.StatusID.SelectedValue=this.RenewRefID>0?"427":"426"),this.cntrct.StatusID=""!=this.StatusID.SelectedValue?parseInt(this.StatusID.SelectedValue):426,this.SaveAndPrintStatusID=this.cntrct.StatusID,this.cntrct.BasedOn=n.e.StringIsNullOrEmpty(this.BasedOn.SelectedValue)?"Monthly":this.BasedOn.SelectedValue,this.cntrct.RentAmt=this.RentAmt.Visible&&!n.e.StringIsNullOrEmpty(this.RentAmt.Text)?parseFloat(this.RentAmt.Text):0,this.cntrct.IsExtended=!(!this.IsExtended.Visible||n.e.StringIsNullOrEmpty(this.IsExtended.SelectedValue))&&Object(r.j)(this.IsExtended.SelectedValue),!(this.Property.SelectedValue>0))return this.DisplayMessage="Please select property",void(this.MessageVisibility=!0);if(this.cntrct.PropertyID=this.Property.SelectedValue,104!=this.CurrCostCenterID)if(this.IsMultiunit&&""!=this.SelectedUnits)this.cntrct.MultiIDS=this.SelectedUnits,this.cntrct.multiName=this.StrMultiple;else{if(!(this.Unit.SelectedValue>0))return this.DisplayMessage=s.a.GetResource("PleaseselectUnit"),void(this.MessageVisibility=!0);this.cntrct.UnitID=this.Unit.SelectedValue}if(!(this.Tenant.SelectedValue>0))return this.DisplayMessage="Please select Tenant",void(this.MessageVisibility=!0);if(this.cntrct.TenantID=this.Tenant.SelectedValue,this.RentRecAc.SelectedValue>0)this.cntrct.RentRecID=this.RentRecAc.SelectedValue;else if(95==this.CurrCostCenterID||104==this.CurrCostCenterID)return 95==this.CurrCostCenterID?this.DisplayMessage="Please select Rent Recievable A/c":104==this.CurrCostCenterID&&(this.DisplayMessage="Please select Rent Payable A/c"),void(this.MessageVisibility=!0);if(this.IncomeAc.SelectedValue>0)this.cntrct.IncomeID=this.IncomeAc.SelectedValue;else if(95==this.CurrCostCenterID||104==this.CurrCostCenterID)return 95==this.CurrCostCenterID?this.DisplayMessage="Please select Income A/c":104==this.CurrCostCenterID&&(this.DisplayMessage="Please select Expense A/c"),void(this.MessageVisibility=!0);if(this.Salesman.SelectedValue>0)this.cntrct.SalesmanID=this.Salesman.SelectedValue;else if(95==this.CurrCostCenterID||104==this.CurrCostCenterID)return this.DisplayMessage="Please select Salesman",void(this.MessageVisibility=!0);if(this.Accountant.SelectedValue>0)this.cntrct.AccountantID=this.Accountant.SelectedValue;else if(95==this.CurrCostCenterID||104==this.CurrCostCenterID)return this.DisplayMessage="Please select Accountant",void(this.MessageVisibility=!0);if(this.Landlord.SelectedValue>0)this.cntrct.LandlordID=this.Landlord.SelectedValue;else if(95==this.CurrCostCenterID||104==this.CurrCostCenterID)return this.DisplayMessage="Please select Landlord",void(this.MessageVisibility=!0);if(n.e.StringIsNullOrEmpty(this.TotalDays.Text)||!n.e.StringIsNullOrEmpty(this.TotalDays.Text)&&0==parseInt(this.TotalDays.Text))return this.DisplayMessage="Please select dates",void(this.MessageVisibility=!0);if(this.cntrct.Purpose=this.Purpose.Text,this.cntrct.Narration=this.Narration.Text,this.LocationContract.SelectedValue>0)this.cntrct.LocationID=this.LocationContract.SelectedValue;else if(this.LocationContract.Visible){if(95==this.CurrCostCenterID||104==this.CurrCostCenterID)return this.DisplayMessage="Please select Location ",void(this.MessageVisibility=!0)}else this.cntrct.LocationID=1;if(this.DivisionContract.SelectedValue>0&&this.DivisionContract.Visible)this.cntrct.DivisionID=this.DivisionContract.SelectedValue;else if(this.DivisionContract.Visible){if(95==this.CurrCostCenterID||104==this.CurrCostCenterID)return this.DisplayMessage="Please select Division ",void(this.MessageVisibility=!0)}else this.cntrct.DivisionID=1;if(this.CurrencyContract.SelectedValue>0&&this.CurrencyContract.Visible)this.cntrct.CurrencyID=this.CurrencyContract.SelectedValue;else if(this.CurrencyContract.Visible){if(95==this.CurrCostCenterID||104==this.CurrCostCenterID)return this.DisplayMessage="Please select Currency ",void(this.MessageVisibility=!0)}else this.cntrct.CurrencyID=1;if(null!=this.TotalAmount.Text&&""!=this.TotalAmount.Text)this.cntrct.TotalAmount=parseFloat(this.TotalAmount.Text);else if(95==this.CurrCostCenterID||104==this.CurrCostCenterID)return this.DisplayMessage="Please enter Amount",void(this.MessageVisibility=!0);if(this.cntrct.NonRecurAmount=null!=this.NonRecAmount.Text&&""!=this.NonRecAmount.Text?parseFloat(this.NonRecAmount.Text):0,this.cntrct.RecurAmount=null!=this.RecAmount.Text&&""!=this.RecAmount.Text?parseFloat(this.RecAmount.Text):0,this.cntrct.TermsConditions=null!=this.TermsConditions.Text&&""!=this.TermsConditions.Text?this.TermsConditions.Text:"",this.cntrct.ContractXMLQuery=this.GetContractDetailsXML(),this.cntrct.PayTermXMLQuery=this.GetPayTermsXML(),this.cntrct.GracePeriod=this.EnableGracePeriod&&!n.e.StringIsNullOrEmpty(this.GracePeriod.Text)&&parseInt(this.GracePeriod.Text)>0?parseInt(this.GracePeriod.Text):0,this.cntrct.StartDate=this.StartDate.Date?new Date(this.StartDate.Date).ToString("dd-MMM-yyyy"):new Date,this.EnableGracePeriod&&this.ExpectedEndDate.Date?(this.EndDate.Date&&(this.cntrct.ExpectedEndDate=new Date(this.EndDate.Date).ToString("dd-MMM-yyyy")),this.cntrct.EndDate=new Date(this.ExpectedEndDate.Date).ToString("dd-MMM-yyyy")):(this.cntrct.ExpectedEndDate=new Date("1/JAN/1900"),this.EndDate.Date&&(this.cntrct.EndDate=new Date(this.EndDate.Date).ToString("dd-MMM-yyyy"))),this.cntrct.ExtndTill=this.ExtndTill.Date?new Date(this.ExtndTill.Date).ToString("dd-MMM-yyyy"):new Date(this.EndDate.Date).ToString("dd-MMM-yyyy"),this.cntrct.SelectedNodeID=0==this.SelectedNodeID?1:this.SelectedNodeID,104==this.CurrCostCenterID&&n.e.StringValue(""==this.cntrct.UnitID)&&(this.cntrct.UnitID=0),"SaveDraft"==t||95!=this.CurrCostCenterID&&104!=this.CurrCostCenterID)if(129!=this.CurrCostCenterID||this.DonotpostDocs)this.cntrct.PostPDRecieptXML="";else{let t,e=this.GetReceipts(0,t);if(this.cntrct.PostPDRecieptXML=e.sbIssue,t=e.Count,t>1)return this.DisplayMessage="Payment terms can not be more than one in reservation.",void(this.MessageVisibility=!0)}else{let t=s.a.rental.GetPostingDetails(this.cntrct,0,this.CurrCostCenterID,0,0,0,this.cntrct.PropertyID,this.cntrct.UnitID,this.cntrct.TenantID,this.cntrct.RentRecID);if(null!=t&&t.Tables.length>0){this.ProductID=parseInt(t.Tables[0][0].PRODUCTID.toString()),this.GetCCData(t.Tables[0]);let e=!1;n.e.IsEmpty(t.Tables[0][0].IsBillwise)||(e=Object(r.j)(t.Tables[0][0].IsBillwise.toString())),this.IsOpening?(this.cntrct.PostSalesInvXML=this.GetOpeningSales(),this.cntrct.PostPDRecieptXML=this.GetOpeningPayXML()):(this.dsprof=null,this.cntrct.PostSalesInvXML=this.GetSalesInvXML(e,t.Tables[0]),this.cntrct.PostRecieptXML=104==this.CurrCostCenterID?"":this.GetReceiptXML(e),this.cntrct.PostPDRecieptXML=this.GetPDReceiptXML(e),this.cntrct.PostPartRecXML=this.GetPartReceiptXML(e)),this.cntrct.PostRentRecXML=!this.nomonthlyincome||!t.Columns[0].Contains("PostIncome")||n.e.IsEmpty(t.Tables[0][0].PostIncome)||"false"!=t.Tables[0][0].PostIncome.toString().toLowerCase()&&"0"!=t.Tables[0][0].PostIncome.toString().toLowerCase()?this.GetRentReceiptXML(!0):this.GetRentReceiptXML(!1)}104==this.CurrCostCenterID&&(this.cntrct.UnitID=-1),this.cntrct.WONO=this.strContractNo,this.cntrct.ActivityXML=null!=this.ViewActivities?this.ViewActivities.ActivitiesXML():""}let a="";if("SaveDraft"!=t&&(a=this.ScreenObject.ValidateData()),a.length>0)return this.MessageVisibility=!0,void(this.DisplayMessage=a);if(this.cntrct.CustomFieldsQuery=this.ScreenObject.GetCustomFieldsQuery(),"SaveDraft"!=t&&(103==this.CurrCostCenterID||129==this.CurrCostCenterID)){let t=s.a.rental.GetPostingDetails(this.cntrct,0,this.CurrCostCenterID,0,0,0,this.cntrct.PropertyID,this.cntrct.UnitID,this.cntrct.TenantID,this.cntrct.RentRecID);null!=t&&t.Tables.length>0&&this.GetCCData(t.Tables[0])}let o="";this.LocationContract.Visible&&this.LocationContract.SelectedValue>0&&(o+=" CCNID2="+this.LocationContract.SelectedValue+","),this.cntrct.CustomCostCenterFieldsQuery=this.strCCQry.toString().split("dcCCNID").join("CCNID"),this.cntrct.CostCenterID=this.CurrCostCenterID;try{let t=[]=this.ScreenObject.Data.Tables[5].filter(t=>"MandatoryAttachments"==t.Name);if(t.length>0&&!n.e.IsEmpty(t[0].Value)&&Object(r.j)(t[0].Value)&&(null==this.ViewAttachments||0==this.ViewAttachments.AttachmentsList.length))return this.DisplayMessage="No Attachments added.",void(this.MessageVisibility=!0);this.cntrct.AttachmetsXML=this.ViewAttachments.GetXML()}catch(l){return this.DisplayMessage=s.a.GetResource("Upload_Path_notExists"),void(this.MessageVisibility=!0)}if(this.cntrct.NotesXML=this.ViewNotes.GetXML(),this.cntrct.Wid=129!=this.CurrCostCenterID&&103!=this.CurrCostCenterID||!this.ContractExists?this.ScreenObject.CheckWorkFlow():0,this.cntrct.RecurDuration=this.DistribtueInvoice&&!n.e.StringIsNullOrEmpty(this.RecurDuration.Text)&&parseInt(this.RecurDuration.Text.toString())>0?parseInt(this.RecurDuration.Text):0,this.ParentContractID>0?(this.cntrct.parContractID=this.ParentContractID,n.e.StringIsNullOrEmpty(this.RefNo.Text)||(this.cntrct.Refno=parseInt(this.RefNo.Text))):this.cntrct.Refno=this.cntrct.parContractID=0,!this.ScreenObject.ValidateDataonSave())return;this.cntrct.IsOpening=this.IsOpening,"SaveDraft"==t||95!=this.CurrCostCenterID&&104!=this.CurrCostCenterID?("SaveDraft"==t?(this.cntrct.StatusID=430,this.cntrct.ContractID=this.draftid):103!=this.CurrCostCenterID&&129!=this.CurrCostCenterID||430!=this.cntrct.StatusID?"469"==this.StatusID.SelectedValue&&(this.cntrct.StatusID=426):(this.cntrct.StatusID=426,this.cntrct.ContractID=this.draftid),s.a.rental.SaveQuotation(this.cntrct,this.cntrct.ExtndTill,this.LinkedQuotationID).subscribe(e=>{this.DisplayMessage=e.Message,i=e.RetValue,i>0&&this.ClearCallBack(i,t)},t=>{alert(JSON.stringify(t)),console.log("SaveQuotation : "+JSON.stringify(t))})):(430==this.cntrct.StatusID&&(this.cntrct.StatusID=426),s.a.rental.SaveContract(this.cntrct,this.RenewRefID,this.LinkedQuotationID).subscribe(a=>{this.DisplayMessage=a.Message,i=a.RetValue,e.RetValue=i,i>0&&this.ClearCallBack(i,t)},t=>{alert(JSON.stringify(t)),console.log("SaveContract : "+JSON.stringify(t))})),this.MessageVisibility=!0,Logger.InfoLog("AddEditRenContractViewModel :: Entering OnSaveContract ")}}catch(h){Logger.ErrorLog("AddEditRenContractViewModel :: OnSaveContract"+h.stack)}}else if("SaveAndPrint"==t)this.IsSavePrintClick=!0,this.OnSave("Save","");else if("PrintPreview"==t||"Print"==t||"Export"==t){if("466"==this.StatusID.SelectedValue&&!s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Print/Export Approved")||"440"==this.StatusID.SelectedValue&&!s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Print/Export Un-Approved")||"470"==this.StatusID.SelectedValue&&!s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Print/Export Rejected"))return this.DisplayMessage="print restricted.",void(this.MessageVisibility=!0);"Export"==t?this.Export("Export"):"Print"!=t&&"PrintPreview"!=t||this.Export("Print")}else this.OnCustomizeExtraFields(t)}))}RenewSubContracts(t,e){return Object(i.b)(this,void 0,void 0,(function*(){1==t?t=4:2==t?t=6:3==t?t=5:10==t&&(t=3);const{UpdatePayTermsViewModel:e}=yield a.e(68).then(a.bind(null,"Rr92")),{UpdatepaytermsComponent:i}=yield a.e(0).then(a.bind(null,"++ql"));let n=s.a.rental.GetSubContracts(this.RenewRefID);if(null!=n&&n.Tables.length>0&&n.Tables[0].length>0){let a=new e("AddEditRenContractViewModel");a.UpdatePayTermsViewModel_1(this,null,null,t),a.PstDocGrid.Columns=[],a.PstDocGrid.SelectAll.Visible=!0;let r=new D.a;r.Header="select",r.DisplayMember="Select",r.DataType="CheckBox",r.ReadOnly=!0,r.Width=80,a.PstDocGrid.Columns.push(r),r=new D.a,r.Header="Tracking No.",r.DisplayMember="Sno",r.ReadOnly=!0,r.DisableTab=!0,r.Width=120,a.PstDocGrid.Columns.push(r),r=new D.a,r.Header="Unit",r.DisplayMember="Unit",r.ReadOnly=!0,r.DisableTab=!0,r.Width=120,a.PstDocGrid.Columns.push(r),a.PstDocGrid.Width="450",a.PstDocGrid.Table=[],a.PstDocGrid.TableColumns.push("Select"),a.PstDocGrid.TableColumns.push("Sno"),a.PstDocGrid.TableColumns.push("Unit"),a.PstDocGrid.TableColumns.push("ContractID");for(let t=0;t<n.Tables[0].length;t++){let e=a.PstDocGrid.NewRow();e.ContractID=n.Tables[0][t].ContractID.toString(),e.sno=n.Tables[0][t].sno.toString(),e.Unit=n.Tables[0][t].Name.toString(),e.Select=!1,a.PstDocGrid.addRow(e)}s.a.page.ShowDialog(a,i,{Title:a.DisplayName,HideClose:!0,ShowCenter:!0})}}))}GenerateContract(t=null,e=null,a=0){let i,r=new Z;i=r.AddEditRenContractViewModel_1(103==this.CurrCostCenterID&&2==this.QuotLink?129:95,0,!1,0,0,""),i=r,i.PropID=this.Property.SelectedValue,i.Property.SelectedValue=this.Property.SelectedValue,i.ContractNumber.ComboBox.SelectedValue=this.Property.SelectedValue.toString(),i.OnContractPrefixChanged(i.ContractNumber.ComboBox.SelectedValue),this.multiVisi&&""!=this.SelectedUnits?(i.StrMultiple=this.StrMultiple,i.SelectedUnits=this.SelectedUnits,i.Property.Enable=!1,i.multiVisi=!0):(i.UnitTempID=this.Unit.SelectedValue,i.Unit.SelectedValue=this.Unit.SelectedValue),i.Vattype=this.Vattype,i.iSGenerate=!0,i.RentRecAc.SelectedValue=this.RentRecAc.SelectedValue,i.Tenant.SelectedValue=this.Tenant.SelectedValue,i.IncomeAc.SelectedValue=this.IncomeAc.SelectedValue,i.LocationContract.SelectedValue=this.LocationContract.SelectedValue,i.DivisionContract.SelectedValue=this.DivisionContract.SelectedValue,i.Salesman.SelectedValue=this.Salesman.SelectedValue,i.Landlord.SelectedValue=this.Landlord.SelectedValue,i.Accountant.SelectedValue=this.Accountant.SelectedValue,i.TermsConditions.Text=this.TermsConditions.Text,i.Purpose.Text=this.Purpose.Text,i.Narration.Text=this.Narration.Text,i.TotalAmount.Text=this.TotalAmount.Text,i.NonRecAmount.Text=this.NonRecAmount.Text,i.RecAmount.Text=this.RecAmount.Text,i.TotalYears.Text=this.TotalYears.Text,i.Months.Text=this.Months.Text,i.TotalDays.Text=this.TotalDays.Text,i.RecurDuration.Text=this.RecurDuration.Text,i.StartDate.Date=null!=t&&t?t:this.StartDate.Date,null!=e&&e?(i.EndDate.Date=e,i.OnselectionChange(null)):i.EndDate.Date=this.EndDate.Date,i.BasedOn.SelectedValue=this.BasedOn.SelectedValue,i.LinkedQuotationID=this.ContractID,i.DataTableObj.Clear();for(let C=0;C<this.DataTable.length;C++)if(!n.e.IsEmpty(this.DataTable[C].NodeID)){let a=i.DataTableObj.NewRow();if(a.NodeID=this.DataTable[C].NodeID.toString(),n.e.IsEmpty(this.DataTable[C].Recurr)||(a.Recurr=this.DataTable[C].Recurr),n.e.IsEmpty(this.DataTable[C].Particulars)||(a.Particulars=this.DataTable[C].Particulars.toString()),n.e.IsEmpty(this.DataTable[C].CreditAccountID)||(a.CreditAccountID=this.DataTable[C].CreditAccountID.toString()),n.e.IsEmpty(this.DataTable[C].CreditAccountID_Key)||(a.CreditAccountID_Key=this.DataTable[C].CreditAccountID_Key),n.e.IsEmpty(this.DataTable[C].PayeeBank)||(a.PayeeBank=this.DataTable[C].PayeeBank.toString()),n.e.IsEmpty(this.DataTable[C].DebitAccountID)||(a.DebitAccountID=this.DataTable[C].DebitAccountID.toString()),n.e.IsEmpty(this.DataTable[C].DebitAccountID_Key)||(a.DebitAccountID_Key=this.DataTable[C].DebitAccountID_Key),n.e.IsEmpty(this.DataTable[C].TaxCategory_Key)||(a.TaxCategory_Key=this.DataTable[C].TaxCategory_Key,a.TaxCategory=this.DataTable[C].TaxCategory),this.DataTableColumns.Contains("SPType_Key")&&!n.e.IsEmpty(this.DataTable[C].SPType_Key)&&(a.SPType_Key=this.DataTable[C].SPType_Key,a.SPType=this.DataTable[C].SPType),i.DataTableColumns.Contains("Location_Key")&&(this.DataTableColumns.Contains("Location_Key")&&!n.e.IsEmpty(this.DataTable[C].Location_Key)?(a.Location_Key=this.DataTable[C].Location_Key.toString(),a.Location=this.DataTable[C].Location.toString()):this.LocationContract.SelectedValue>0&&(a.Location_Key=this.LocationContract.SelectedValue,a.Location=this.LocationContract.Text)),this.DataTableColumns.Contains("Dim_Key")&&!n.e.IsEmpty(this.DataTable[C].Dim_Key)&&(a.Dim_Key=this.DataTable[C].Dim_Key,a.Dim=this.DataTable[C].Dim),this.DataTableColumns.Contains("VatType")&&!n.e.IsEmpty(this.DataTable[C].VatType)&&(a.VatType=this.DataTable[C].VatType),n.e.IsEmpty(this.DataTable[C].Refund)||(a.Refund=this.DataTable[C].Refund.toString()),a.TempCCID_Key=this.DocStNodeID.toString(),a.TempCCID=this.DocStName,n.e.IsEmpty(this.DataTable[C].RecurInvoice)||(a.RecurInvoice=this.DataTable[C].RecurInvoice.toString().toLowerCase()),n.e.IsEmpty(this.DataTable[C].PostDebit)||(a.PostDebit=this.DataTable[C].PostDebit.toString()),n.e.IsEmpty(this.DataTable[C].ChequeNo)||(a.ChequeNo=this.DataTable[C].ChequeNo.toString()),n.e.IsEmpty(this.DataTable[C].CntrlDate)||(a.CntrlDate=this.DataTable[C].CntrlDate),n.e.IsEmpty(this.DataTable[C].CntrlDate_Key)||(a.CntrlDate_Key=this.DataTable[C].CntrlDate_Key),n.e.IsEmpty(this.DataTable[C].VatPer)||(a.VatPer=this.DataTable[C].VatPer),n.e.IsEmpty(this.DataTable[C].Sqft)||(a.Sqft=this.DataTable[C].Sqft),n.e.IsEmpty(this.DataTable[C].Rate)||(a.Rate=this.DataTable[C].Rate),n.e.IsEmpty(this.DataTable[C].ActAmount)||(a.ActAmount=this.DataTable[C].ActAmount.toString()),n.e.IsEmpty(this.DataTable[C].Discount)||(a.Discount=this.DataTable[C].Discount),n.e.IsEmpty(this.DataTable[C].Amount)||(a.Amount=this.DataTable[C].Amount),!n.e.IsEmpty(this.DataTable[C].Xml))if(null!=e&&e&&null!=t&&t){let e=new Date,i=new n.f;if(i.LoadXml(this.DataTable[C].Xml.toString()),null!=i)if(this.multiVisi&&!n.e.IsEmpty(this.SelectedUnits)&&i.ChildNodes.length>0&&null!=i.ChildNodes[0].Attributes&&null!=i.ChildNodes[0].attributes.Filter&&!n.e.StringIsNullOrEmpty(i.ChildNodes[0].attributes.Filter.value)&&"0"==i.ChildNodes[0].attributes.Filter.value){var o=i.SelectNodes("XML/UnitsRow/Row");let r=0,l=0,c="";c+='<XML Filter="1" >',o.forEach(a=>{n.e.isValidDate(a.attributes.FromDate.value)&&(e=new Date(a.attributes.FromDate.value)),null==a.attributes.FromDate||n.e.StringIsNullOrEmpty(a.attributes.FromDate.value)||e!=t||(r+=parseFloat(a.attributes.Amount.value),null==a.attributes.Discount||n.e.StringIsNullOrEmpty(a.attributes.Discount.value)||(l+=parseFloat(a.attributes.Discount.value)),c+="<Row ",c+='Unit="'+a.attributes.Unit.value+'" ',null==a.attributes.Period||n.e.StringIsNullOrEmpty(a.attributes.Period.value)||(c+='Period="'+a.attributes.Period.value+'" '),null==a.attributes.Rate||n.e.StringIsNullOrEmpty(a.attributes.Rate.value)||(c+='Rate="'+a.attributes.Rate.value+'" '),null==a.attributes.Distribute||n.e.StringIsNullOrEmpty(a.attributes.Distribute.value)||(c+='Distribute="'+a.attributes.Distribute.value+'" '),null==a.attributes.Discount||n.e.StringIsNullOrEmpty(a.attributes.Discount.value)||(c+='Discount="'+a.attributes.Discount.value+'" '),null==a.attributes.ActAmount||n.e.StringIsNullOrEmpty(a.attributes.ActAmount.value)||(c+='ActAmount="'+a.attributes.ActAmount.value+'" '),c+='Amount="'+a.attributes.Amount.value+'"/>')}),c+="</XML>",a.Amount=r.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()),this.DataTable[C].NodeID.toString()==this.id2.toString()&&(a.Discount=l.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()),a.ActAmount=(r+l).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString())),a.Xml=c.toString()}else(o=i.SelectNodes("XML/Row")).forEach(i=>{n.e.isValidDate(i.attributes.FromDate.value)&&(e=new Date(i.attributes.FromDate.value)),n.e.StringIsNullOrEmpty(i.attributes.FromDate.value)||e!=t||(a.Amount=parseFloat(i.attributes.Amount.value),this.DataTable[C].NodeID.toString()==this.id2.toString()&&(n.e.StringIsNullOrEmpty(i.attributes.Discount.value)?(a.Discount=0,a.ActAmount=parseFloat(i.attributes.Amount.value)):(a.Discount=i.attributes.Discount.value,a.ActAmount=parseFloat(a.Discount)+parseFloat(a.Amount))))})}else a.Xml=this.DataTable[C].Xml;i.DataTableObj.addRow(a)}let l=s.a.rental.GetParticularsDetails(this.RenewRefID,this.Unit.SelectedValue,0,this.StartDate.Date,this.EndDate.Date,1,0,"");null!=l&&l.Tables.length>2&&l.Tables[2].length>0&&(0==this.PickACC&&l.Columns[2].Contains("RentalReceivableAccountID")&&!n.e.IsEmpty(l.Tables[2][0].RentalReceivableAccountID)?i.RentRecAc.SelectedValue=parseInt(l.Tables[2][0].RentalReceivableAccountID.toString()):1==this.PickACC&&l.Columns[2].Contains("PropRentRecAccID")&&!n.e.IsEmpty(l.Tables[2][0].PropRentRecAccID)&&(i.RentRecAc.SelectedValue=parseInt(l.Tables[2][0].PropRentRecAccID.toString())));let c=0,h=0;i.DataTable.length>0&&!n.e.IsEmpty(i.DataTable[0].Amount)&&(h=parseFloat(i.DataTable[0].Amount),this.OriginalRent=h);let D,u=null;if(null!=l&&l.Tables.length>0&&l.Tables[0].length>0?u=l.Tables[0].filter(t=>1==t.Type||3==t.Type):null!=l&&l.Tables.length>1&&l.Tables[1].length>0&&(u=l.Tables[1].filter(t=>1==t.Type||3==t.Type)),null!=u&&u.length>0){n.e.IsEmpty(u[0].DebitAccID)||(i.GenDebitAcc=parseInt(u[0].DebitAccID));for(let t=0;t<u.length;t++)if(0==i.DataTable.filter(e=>e.NodeID==u[t].NodeID.toString()).length){c=0;let e=i.DataTableObj.NewRow();e.Recurr=!1,n.e.IsEmpty(u[t].NodeID)||(e.NodeID=u[t].NodeID.toString()),n.e.IsEmpty(u[t].Particulars)||(e.Particulars=u[t].Particulars.toString()),n.e.IsEmpty(u[t].CreditID)||(e.CreditAccountID_Key=u[t].CreditID.toString()),n.e.IsEmpty(u[t].DebitID)||(e.DebitAccountID_Key=u[t].DebitID.toString()),!n.e.IsEmpty(u[t].DiscountAmount)&&parseFloat(u[t].DiscountAmount)>0?c=parseFloat(u[t].DiscountAmount):!n.e.IsEmpty(u[t].DiscountPercentage)&&parseFloat(u[t].DiscountPercentage)>0&&(c=parseFloat(u[t].DiscountPercentage)*h/100),e.Amount=c,n.e.IsEmpty(u[t].CreditName)||(e.CreditAccountID=u[t].CreditName.toString()),n.e.IsEmpty(u[t].DebitName)||(e.DebitAccountID=u[t].DebitName.toString()),n.e.IsEmpty(u[t].DiscountPercentage)||(e.DiscountPercentage=u[t].DiscountPercentage.toString()),""!=u[t].InclChkGen.toString()&&(e.InclChkGen=u[t].InclChkGen.toString()),n.e.IsEmpty(u[t].TaxCategoryID)||(e.TaxCategory_Key=u[t].TaxCategoryID.toString(),e.TaxCategory=u[t].TaxCategory.toString()),n.e.IsEmpty(u[t].Display)||(e.Display=u[t].Display.toString(),"0"==e.Display.toString()&&(e.StyleHeightZero=1)),this.DataTableColumns.Contains("SPType_Key")&&!n.e.IsEmpty(u[t].SPType)&&(e.SPType_Key=u[t].SPType.toString(),e.SPType=u[t].SPTypeName.toString()),this.DataTableColumns.Contains("Dim_Key")&&!n.e.IsEmpty(u[t].Dimname)&&(e.Dim_Key=u[t].DimNodeID.toString(),e.Dim=u[t].Dimname.toString()),this.DataTableColumns.Contains("Location_Key")&&this.LocationContract.SelectedValue>0&&(e.Location_Key=this.LocationContract.SelectedValue),e.VatType=n.e.StringValue(u[t].VatType),e.RecurInvoice=n.e.StringValue(u[t].RecurInvoice.toLowerCase()),e.PostDebit=n.e.StringValue(u[t].PostDebit),""!=n.e.StringValue(u[t].CreditName)&&(e.CreditAccountID=n.e.StringValue(u[t].CreditName)),""!=n.e.StringValue(u[t].DebitName)&&(e.DebitAccountID=n.e.StringValue(u[t].DebitName)),""!=n.e.StringValue(u[t].DiscountPercentage)&&(e.DiscountPercentage=n.e.StringValue(u[t].DiscountPercentage)),""!=n.e.StringValue(u[t].Months)&&(e.Months=n.e.StringValue(u[t].Months)),i.DataTableObj.addRow(e)}}if(n.e.IsEmpty(i.DataTable[0].Amount)||(i.RentAmt.Text=i.DataTable[0].Amount.toString()),i.CalculateNRec(),(129!=i.CurrCostCenterID||!this.DonotCopyPayterms)&&this.PayTermsDataTable.length>0){i.stDate=i.StartDate.Date,i.PayTermsDataTableObj.Clear();for(let s=0;s<this.PayTermsDataTable.length;s++)if(!n.e.IsEmpty(this.PayTermsDataTable[s].DebitAccountID_Key)){if(a>0&&!n.e.IsEmpty(this.PayTermsDataTable[s].Period)&&parseInt(this.PayTermsDataTable[s].Period.toString())!=a)continue;if(null!=e&&e&&null!=t&&t&&!n.e.IsEmpty(this.PayTermsDataTable[s].CntrlDate_Key)&&(new Date(this.PayTermsDataTable[s].CntrlDate_Key.toString())>e||new Date(this.PayTermsDataTable[s].CntrlDate_Key.toString())<t))continue;let r=i.PayTermsDataTableObj.NewRow();r.ChequeNo=this.PayTermsDataTable[s].ChequeNo.toString(),n.e.IsEmpty(this.PayTermsDataTable[s].CntrlDate_Key)||(r.CntrlDate=this.PayTermsDataTable[s].CntrlDate,r.CntrlDate_Key=this.PayTermsDataTable[s].CntrlDate_Key),n.e.IsEmpty(this.PayTermsDataTable[s].PayeeBank)||(r.PayeeBank=this.PayTermsDataTable[s].PayeeBank.toString()),103==this.CostCenterID?(r.DebitAccountID_Key=this.PayTermsDataTable[s].DebitAccountID_Key,r.DebitAccountID=this.PayTermsDataTable[s].DebitAccountID):(r.DebitAccountID_Key=this.RentRecAc.SelectedValue,r.DebitAccountID=this.RentRecAc.Text),n.e.IsEmpty(this.PayTermsDataTable[s].Period)||(r.Period=this.PayTermsDataTable[s].Period.toString()),n.e.IsEmpty(this.PayTermsDataTable[s].Narration)||(r.Narration=this.PayTermsDataTable[s].Narration.toString()),i.PayTermsDataTableColumns.Contains("Location_Key")&&(this.PayTermsDataTableColumns.Contains("Location_Key")&&!n.e.IsEmpty(this.PayTermsDataTable[s].Location_Key)?(r.Location_Key=this.PayTermsDataTable[s].Location_Key.toString(),r.Location=this.PayTermsDataTable[s].Location.toString()):this.LocationContract.SelectedValue>0&&(r.Location_Key=this.LocationContract.SelectedValue,r.Location=this.LocationContract.Text)),n.e.IsEmpty(this.PayTermsDataTable[s].Amount)||(r.Amount=this.PayTermsDataTable[s].Amount),r.TempCCID_Key=this.DocStNodeID.toString(),r.TempCCID=this.DocStName,129!=this.CurrCostCenterID||this.DonotpostDocs||(r.IsFromRes="1"),i.PayTermsDataTableObj.addRow(r)}}this.CalculateFooter();for(let s=0;s<6;s++){let t=i.DataTableObj.NewRow();t.Recurr=!1,i.DataTableObj.addRow(t);let e=i.PayTermsDataTableObj.NewRow();i.PayTermsDataTableObj.addRow(e)}this.FillExtraFields(i),D={obj:i},s.a.page.addNewTab({title:this.ScreenName,component:K.AddEditRentalContractComponent,params:D})}validateUnit(t=!0){if(this.dsPart=this.StartDate.Date&&this.EndDate.Date?s.a.rental.GetParticularsDetails(this.RenewRefID,this.Unit.SelectedValue,0,this.StartDate.Date,this.EndDate.Date,1,this.ContractID,this.SelectedUnits):this.StartDate.Date?s.a.rental.GetParticularsDetails(this.RenewRefID,this.Unit.SelectedValue,0,this.StartDate.Date,new Date,1,this.ContractID,this.SelectedUnits):s.a.rental.GetParticularsDetails(this.RenewRefID,this.Unit.SelectedValue,0,new Date,this.EndDate.Date?this.EndDate.Date:new Date,1,this.ContractID,this.SelectedUnits),t&&null!=this.dsPart&&this.dsPart.Tables.length>4&&this.dsPart.Tables[4].length>0)return this.DisplayMessage="This Unit is already in use from "+new Date(this.dsPart.Tables[4][0].StartDate).ToString("dd-MMM-yyyy")+", To "+new Date(this.dsPart.Tables[4][0].EndDate).ToString("dd-MMM-yyyy"),this.MessageVisibility=!0,!0;let e=s.a.common.GetDataSet3("AER001",this.Unit.SelectedValue.toString(),this.StartDate.Date.ToString("dd/MMM/yyyy"),this.EndDate.Date.ToString("dd/MMM/yyyy"));return null!=e&&e.Tables.length>0&&e.Tables[0].length>0&&(this.DisplayMessage="This Unit is Reserved from "+new Date(e.Tables[0][0].StartDate).ToString("dd-MMM-yyyy")+", To "+new Date(e.Tables[0][0].EndDate).ToString("dd-MMM-yyyy"),this.MessageVisibility=!0,!0)}validate(t){if("SaveDraft"==t)return!1;Logger.InfoLog("AddEditRenContractViewModel ::Entering validate");let e=0;if(103==this.CurrCostCenterID||129==this.CurrCostCenterID){for(let t=0;t<this.DataTable.length;t++)!n.e.IsEmpty(this.DataTable[t].Particulars)&&!n.e.IsEmpty(this.DataTable[t].CreditAccountID)&&!n.e.IsEmpty(this.DataTable[t].Amount)&&parseFloat(this.DataTable[t].Amount)>0&&e++;return 0==e&&(this.DisplayMessage="Enter atleast one particular",this.MessageVisibility=!0,!0)}if(this.DistribtueInvoice&&(this.DisplayMessage=this.RecurDuration.ValidateData(),""!=this.DisplayMessage))return this.MessageVisibility=!0,!0;if(!this.allowafterenddate&&this.EndDate.Date<this.ContractDate.Date)return this.DisplayMessage="EndDate should be higher than ContractDate",this.MessageVisibility=!0,!0;let a=0,i=0;if(this.DataTable.length>0){let t=!1;var o=this.ScreenObject.Data.Tables[5].find(t=>"SaveZeroValue"==t.Name);t=!!(o.length>0&&Object(r.j)(o[0].Value.toString()))&&Object(r.j)(o[0].Value);for(let i=0;i<this.DataTable.length;i++){if(n.e.IsEmpty(this.DataTable[i].Particulars)||""==this.DataTable[i].Particulars.toString()||n.e.IsEmpty(this.DataTable[i].CreditAccountID)||!(t||!n.e.IsEmpty(this.DataTable[i].Amount)&&parseFloat(this.DataTable[i].Amount)>0)||e++,!n.e.IsEmpty(this.DataTable[i].Amount)&&""!=this.DataTable[i].Amount.toString()&&parseFloat(this.DataTable[i].Amount)>0&&(n.e.IsEmpty(this.DataTable[i].NodeID)||""==this.DataTable[i].NodeID.toString()))return this.DisplayMessage="Enter Particulars at row no : "+(i+1).toString(),this.MessageVisibility=!0,!0;if(this.DataTableColumns.Contains("Dim_Key")&&!n.e.IsEmpty(this.DataTable[i].Particulars)&&!n.e.IsEmpty(this.DataTable[i].Amount)&&(n.e.IsEmpty(this.DataTable[i].Dim_Key)||parseInt(this.DataTable[i].Dim_Key.toString())<1)){var l=this.ContractParticular.find(t=>!n.e.StringIsNullOrEmpty(t.ValueMember)&&"Dim_Key"==t.ValueMember);return this.DisplayMessage="select "+l.Header+" at row no : "+(i+1).toString(),this.MessageVisibility=!0,!0}if(!n.e.IsEmpty(this.DataTable[i].VatAmount)&&parseFloat(this.DataTable[i].VatAmount.toString())>0&&this.VatAccountID<1)return this.DisplayMessage="Define Vat posting account.",this.MessageVisibility=!0,!0;if(0==i){if(n.e.IsEmpty(this.DataTable[i].Particulars)&&""==n.e.StringValue(this.DataTable[i].Particulars))return this.DisplayMessage="Enter Particulars at Row : 1",this.MessageVisibility=!0,!0;if((n.e.IsEmpty(this.DataTable[i].CreditAccountID_Key)||""==n.e.StringValue(this.DataTable[i].CreditAccountID_Key))&&0==this.ParentContractID)return this.DisplayMessage=104==this.CurrCostCenterID?"Enter Debit A/c at row no :  1":"Enter Credit A/c at row no :  1",this.MessageVisibility=!0,!0;if(!t&&(n.e.IsEmpty(this.DataTable[i].Amount)||""==n.e.StringValue(this.DataTable[i].Amount)||parseFloat(n.e.StringValue(this.DataTable[i].Amount))<1)&&0==this.ParentContractID)return this.DisplayMessage="Enter Amount at Row : 1",this.MessageVisibility=!0,!0}else if(!n.e.IsEmpty(this.DataTable[i].Particulars)&&""!=n.e.StringValue(this.DataTable[i].Particulars)){if(n.e.IsEmpty(this.DataTable[i].CreditAccountID)||""==n.e.StringValue(this.DataTable[i].CreditAccountID))return this.DisplayMessage=104==this.CurrCostCenterID?"Enter Debit A/c at row no :  "+(i+1).toString():"Enter Credit A/c at row no : "+(i+1).toString(),this.MessageVisibility=!0,!0;if(!n.e.IsEmpty(this.DataTable[i].NodeID)&&""!=n.e.StringValue(this.DataTable[i].NodeID)&&!n.e.IsEmpty(this.DataTable[i].DebitAccountID_Key)&&""!=n.e.StringValue(this.DataTable[i].DebitAccountID_Key)&&parseInt(this.DataTable[i].DebitAccountID_Key.toString())>0){if(this.BankAccounts.ContainsKey(this.DataTable[i].DebitAccountID_Key.toString())&&(null==this.DataTable[i].CntrlDate_Key||null==this.DataTable[i].CntrlDate_Key||""==this.DataTable[i].CntrlDate_Key.toString()))return this.DisplayMessage="please enter date at Row No :"+(i+1).toString(),this.MessageVisibility=!0,!0;if(this.BankAccounts.ContainsKey(n.e.StringValue(this.DataTable[i].DebitAccountID_Key))&&(n.e.IsEmpty(this.DataTable[i].ChequeNo)||n.e.IsEmpty(this.DataTable[i].ChequeNo)||""==n.e.StringValue(this.DataTable[i].ChequeNo)||"0"==n.e.StringValue(this.DataTable[i].ChequeNo)))return this.DisplayMessage="please enter Cheque No at Row No :"+(i+1).toString(),this.MessageVisibility=!0,!0}}if(null!=this.DataTable[i].Particulars&&""!=this.DataTable[i].Particulars.toString())for(let t=0;t<this.ContractParticular.length;t++)if(this.ContractParticular[t].Mandatory&&this.ContractParticular[t].DisplayMember.startsWith("CCNID")&&this.DataTableColumns.Contains(this.ContractParticular[t].ValueMember)&&""==this.DataTable[i][this.ContractParticular[t].ValueMember].toString())return this.DisplayMessage=n.e.Format(s.a.GetResource("Doc_Select"),this.ContractParticular[t].Header)+" "+(i+1).toString(),this.MessageVisibility=!0,!0;if(a=0,""!=n.e.StringValue(this.DataTable[i].Xml)){let t=new n.f;t.LoadXml(this.DataTable[i].Xml.toString());let e,s=-1;t.DocumentElement.children.length>0&&null!=t.DocumentElement.children[0].attributes&&null!=t.DocumentElement.children[0].attributes.Filter&&!n.e.StringIsNullOrEmpty(t.DocumentElement.children[0].attributes.Filter.value)&&(s=parseInt(t.DocumentElement.children[0].attributes.Filter.value));let r=null,o=null,l=[];if(-1==s||2==s){for(let i=0;i<t.DocumentElement.children.length;i++){let s=t.DocumentElement.children[i];null==r&&null!=s.attributes.FromDate&&!n.e.StringIsNullOrEmpty(s.attributes.FromDate.value)&&n.e.isValidDate(s.attributes.FromDate.value)&&(r=new Date(s.attributes.FromDate.value)),e=s.attributes.FromDate,null!=s.attributes.ToDate&&!n.e.StringIsNullOrEmpty(s.attributes.ToDate.value)&&n.e.isValidDate(s.attributes.ToDate.value)&&(o=new Date(s.attributes.ToDate.value)),e=s.attributes.ToDate,null==s.attributes.Amount||n.e.StringIsNullOrEmpty(s.attributes.Amount.value)||(a+=parseFloat(s.attributes.Amount.value))}if(null==r||r.toDateString()!=this.StartDate.Date.toDateString())return this.DisplayMessage="Contract start date and first date does not match at row no:"+(i+1),this.MessageVisibility=!0,!0;if(null==o||o.toDateString()!=this.EndDate.Date.toDateString())return this.DisplayMessage="Contract end date and last date does not match at row no:"+(i+1),this.MessageVisibility=!0,!0}else if(1==s){for(let e=0;e<t.DocumentElement.children.length;e++){let i=t.DocumentElement.children[e];null==i.attributes.Unit||n.e.StringIsNullOrEmpty(i.attributes.Unit.value)||l.push(parseInt(i.attributes.Unit.value)),null==i.attributes.Amount||n.e.StringIsNullOrEmpty(i.attributes.Amount.value)||(a+=parseFloat(i.attributes.Amount.value))}if(l.length!=this.SelectedUnits.split(",").length)return this.DisplayMessage="Distribution not defined for some units.",this.MessageVisibility=!0,!0}else if(0==s&&(t.DocumentElement.childNodes.forEach(t=>{r=null,o=null;for(let e=0;e<t.childNodes.length;e++){let i=t.childNodes.item[e];null==r&&null!=i.attributes.FromDate&&!n.e.StringIsNullOrEmpty(i.attributes.FromDate.Value)&&n.e.isValidDate(i.attributes.FromDate.value)&&(r=new Date(i.attributes.FromDate.value)),null!=i.attributes.ToDate&&!n.e.StringIsNullOrEmpty(i.attributes.ToDate.value)&&n.e.isValidDate(i.attributes.ToDate.value)&&(o=new Date(i.attributes.ToDate.value)),null==i.attributes.Amount||n.e.StringIsNullOrEmpty(i.attributes.Amount.value)||(a+=parseFloat(i.attributes.Amount.value)),null==i.attributes.Unit||n.e.StringIsNullOrEmpty(i.attributes.Unit.value)||l.Contains(parseInt(i.attributes.Unit.value))||l.push(parseInt(i.attributes.Unit.value))}return null==r||r!=this.StartDate.Date?(this.DisplayMessage="Contract start date and first date does not match for some units.",this.MessageVisibility=!0,!0):null==o||o!=this.EndDate.Date?(this.DisplayMessage="Contract end date and last date does not match for some units.",this.MessageVisibility=!0,!0):void 0}),l.length!=this.SelectedUnits.split(",").length))return this.DisplayMessage="Distribution not defined for some units.",this.MessageVisibility=!0,!0;if(parseFloat(this.DataTable[i].Amount.toString()).ToString("N"+this.Mdeci)!=a.ToString("N"+this.Mdeci))return this.DisplayMessage="Amount does not match at row no:"+(i+1),this.MessageVisibility=!0,!0}}}else if(0==this.ParentContractID)return this.DisplayMessage="Enter atleast one detail",this.MessageVisibility=!0,!0;if(0==e&&0==this.ParentContractID)return this.DisplayMessage="Enter atleast one particular",this.MessageVisibility=!0,!0;if(e=0,this.PayTermsDataTable.length>0){let t=0,a=[]=this.ScreenObject.Data.Tables[5].filter(t=>"ValidateChequeBasedOnEnddate"==t.Name);a.length>0&&(t=parseInt(a[0].Value.toString()));let i=this.ContractPayTerms.find(t=>"Particulars"==t.DisplayMember);for(let r=0;r<this.PayTermsDataTable.length;r++){if(n.e.IsEmpty(this.PayTermsDataTable[r].ChequeNo)||""==this.PayTermsDataTable[r].ChequeNo.toString()||n.e.IsEmpty(this.PayTermsDataTable[r].CntrlDate_Key)||""==this.PayTermsDataTable[r].CntrlDate_Key.toString()||n.e.IsEmpty(this.PayTermsDataTable[r].DebitAccountID)||""==this.PayTermsDataTable[r].DebitAccountID.toString()||n.e.IsEmpty(this.PayTermsDataTable[r].Amount)||""==this.PayTermsDataTable[r].Amount.toString()||!(parseFloat(this.PayTermsDataTable[r].Amount)>0)||e++,!n.e.IsEmpty(this.PayTermsDataTable[r].Amount)&&""!=this.PayTermsDataTable[r].Amount.toString()){if(n.e.IsEmpty(this.PayTermsDataTable[r].CntrlDate_Key)||null==this.PayTermsDataTable[r].CntrlDate_Key||""==this.PayTermsDataTable[r].CntrlDate_Key.toString())return this.DisplayMessage="Enter Cheque Date at row no : "+(r+1).toString(),this.MessageVisibility=!0,!0;if(n.e.IsEmpty(this.PayTermsDataTable[r].DebitAccountID)||""==this.PayTermsDataTable[r].DebitAccountID.toString())return this.DisplayMessage=104==this.CurrCostCenterID?"Enter Credit A/c at row no : "+(r+1).toString():"Enter Debit A/c at row no : "+(r+1).toString(),this.MessageVisibility=!0,!0;if(n.e.IsEmpty(this.PayTermsDataTable[r].PayeeBank)||""==this.PayTermsDataTable[r].PayeeBank.toString())return this.DisplayMessage="Enter Payee Bank row no : "+(r+1).toString(),this.MessageVisibility=!0,!0;if(null!=i&&i.Mandatory&&""==this.PayTermsDataTable[r].Particulars_Key.toString())return this.DisplayMessage="select  "+i.Header+"row no : "+(r+1).toString(),this.MessageVisibility=!0,!0;for(let t=0;t<this.ContractPayTerms.length;t++)if(("Dim"==this.ContractPayTerms[t].DisplayMember||this.ContractPayTerms[t].DisplayMember.startsWith("CCNID"))&&this.ContractPayTerms[t].Mandatory&&this.PayTermsDataTableColumns.Contains(this.ContractPayTerms[t].ValueMember)&&""==this.PayTermsDataTable[r][this.ContractPayTerms[t].ValueMember].toString())return this.DisplayMessage=n.e.Format(s.a.GetResource("Doc_Select"),this.ContractPayTerms[t].Header)+" "+(r+1).toString(),this.MessageVisibility=!0,!0}if(t>0&&!n.e.IsEmpty(this.PayTermsDataTable[r].CntrlDate_Key)&&new Date(this.PayTermsDataTable[r].CntrlDate_Key).AddDays(t)>this.EndDate.Date)return this.DisplayMessage="Cheque date should be ["+t+"] Days prior to Contract End date at row no : "+(r+1).toString(),this.MessageVisibility=!0,!0}if(0==e&&0==this.ParentContractID){if(this.DontsavenoPayment)return this.DisplayMessage="Enter atleast one Payment Terms",this.MessageVisibility=!0,!0;if(this.PayTermsBodyVisible&&!this.isFrmBlkEdit&&!confirm(s.a.GetResource("PaymentTermsnotdefined")))return!0}}a=i=0;let c=this.PayTermsDataTable.filter(t=>t.DebitAccountID_Key>0).Compute("sum","Amount");if(i=parseFloat(c.toString()),!n.e.IsEmpty(this.DataTable[0].Amount)&&""!=this.DataTable[0].Amount.toString().Trim()){a=parseFloat(this.DataTable[0].Amount.toString()),"Inclusive"!=n.e.StringValue(this.DataTable[0].VatType)&&!n.e.IsEmpty(this.DataTable[0].VatAmount)&&parseFloat(this.DataTable[0].VatAmount.toString())>0&&(a+=parseFloat(this.DataTable[0].VatAmount));for(let t=1;t<this.DataTable.length;t++)(n.e.IsEmpty(this.DataTable[t].DebitAccountID_Key)||""==this.DataTable[t].DebitAccountID_Key.toString()||"0"==this.DataTable[t].DebitAccountID_Key.toString())&&(!n.e.IsEmpty(this.DataTable[t].Amount)&&""!=this.DataTable[t].Amount.toString()&&parseFloat(this.DataTable[t].Amount)>0&&(a+=parseFloat(this.DataTable[t].Amount.toString())),"Inclusive"!=n.e.StringValue(this.DataTable[t].VatType)&&""!=n.e.StringValue(this.DataTable[t].VatAmount)&&parseFloat(this.DataTable[t].VatAmount.toString())>0&&(a+=parseFloat(this.DataTable[t].VatAmount)))}if(a=parseFloat(a.toString()),i.ToString("N2")!=a.ToString("N2")){if(this.DontAllowmorePayment&&i>a)return this.DisplayMessage="Payment is more than Total Amount, difference : "+Math.abs(a-i).toString(),this.MessageVisibility=!0,!0;if(this.DontsavenoPayment&&0==this.ParentContractID)return this.DisplayMessage=" Total Amount and Payment terms does not match, difference : "+Math.abs(a-i).toString(),this.MessageVisibility=!0,!0;if(e>0&&this.PayTermsBodyVisible&&!this.isFrmBlkEdit&&!confirm("Total Amount and Payment terms does not match:.\nDo you want to proceed?"))return!0}return Logger.InfoLog("AddEditRenContractViewModel ::EXITING validate"),this.MessageVisibility=!1,!1}LoadTabs(){this.ScreenObject.CustomTab.Pages.forEach(t=>{switch(t.Name){case"Attachments":t.Fields.push(this.ViewAttachments);break;case"Activities":null!=this.ViewActivities&&t.Fields.push(this.ViewActivities);break;case"Notes":t.Fields.push(this.ViewNotes)}t.Fields.forEach(t=>{t instanceof m.c&&"TermsConditions"==t.DBColumnName&&(this.TermsConditions=t)})})}GenerateChequeNos(t,e,a,i,r,o,l,c,h,D,u,C,m,S){let b=0,d=0;if(this.NoofCheques=t,this.FirstNumber=e,this.InstPeriod=l,this.FirstNoLen=e.length,this.stDate=a,this.PayeeBnk=i,this.DebitAcc=r,this.DebitName=o,""!=c&&""!=h&&""!=D){let t=new Date,e=new Date;if(b=n.e.DoubleTryParse(D),n.e.isValidDate(c)&&(t=new Date(c)),n.e.isValidDate(h)&&(e=new Date(h)),d=n.e.GetDateDifference(e,t)+1,this.GenChqOthPart)for(let a=0;a<this.PayTermsDataTable.length;a++)(!this.PayTermsDataTableColumns.Contains("IsFreezed")||"1"!=this.PayTermsDataTable[a].IsFreezed.toString()&&"True"!=this.PayTermsDataTable[a].IsFreezed.toString())&&n.e.IsEmpty(this.PayTermsDataTable[a].Amount)&&n.e.IsEmpty(this.PayTermsDataTable[a].DebitAccountID_Key)&&(this.PayTermsDataTable.Remove(this.PayTermsDataTable[a]),a--);else for(let a=0;a<this.PayTermsDataTable.length;a++)(!this.PayTermsDataTableColumns.Contains("IsFreezed")||"1"!=this.PayTermsDataTable[a].IsFreezed.toString()&&"True"!=this.PayTermsDataTable[a].IsFreezed.toString())&&(n.e.IsEmpty(this.PayTermsDataTable[a].CntrlDate_Key)||new Date(this.PayTermsDataTable[a].CntrlDate_Key.toString())>=t&&new Date(this.PayTermsDataTable[a].CntrlDate_Key.toString())<=e)&&(this.PayTermsDataTable.Remove(this.PayTermsDataTable[a]),a--)}else if(null!=this.TotalDays.Text&&""!=this.TotalDays.Text&&(d=parseInt(this.TotalDays.Text)),this.GenChqOthPart){b=n.e.DoubleTryParse(D);for(let t=0;t<this.PayTermsDataTable.length;t++)(!this.PayTermsDataTableColumns.Contains("IsFreezed")||"1"!=this.PayTermsDataTable[t].IsFreezed.toString()&&"True"!=this.PayTermsDataTable[t].IsFreezed.toString())&&n.e.IsEmpty(this.PayTermsDataTable[t].Amount)&&n.e.IsEmpty(this.PayTermsDataTable[t].DebitAccountID_Key)&&(this.PayTermsDataTable.Remove(this.PayTermsDataTable[t]),t--)}else{if(null!=this.DataTable[0].Amount&&""!=this.DataTable[0].Amount.toString().Trim()){s.a.SessionManager.Preferences.ContainsKey("VATVersion")&&""!=this.DataTable[0].VatPer.toString()&&"0"!=this.DataTable[0].VatPer.toString()?"2"==this.DataTable[0].InclChkGen.toString()?(b=parseFloat(this.DataTable[0].Amount),"Inclusive"==this.DataTable[0].VatType.toString()||n.e.IsEmpty(this.DataTable[0].VatAmount)||(b+=parseFloat(this.DataTable[0].VatAmount))):null!=this.DataTable[0].TaxableAmt&&""!=this.DataTable[0].TaxableAmt.toString()&&parseFloat(this.DataTable[0].TaxableAmt)>0&&(b+=parseFloat(this.DataTable[0].TaxableAmt)):b+=parseFloat(this.DataTable[0].Amount);for(let t=1;t<this.DataTable.length;t++)(null!=this.DataTable[t].DebitAccountID_Key.toString()&&""!=this.DataTable[t].DebitAccountID_Key.toString()&&"0"!=this.DataTable[t].DebitAccountID_Key.toString()||this.CheckNumbersForRent)&&"0"==this.DataTable[t].InclChkGen.toString()||(null!=this.DataTable[t].Amount&&""!=this.DataTable[t].Amount.toString()&&parseFloat(this.DataTable[t].Amount)>0&&(!s.a.SessionManager.Preferences.ContainsKey("VATVersion")||""==this.DataTable[t].VatPer.toString()||"0"==this.DataTable[t].VatPer.toString())?b+=parseFloat(this.DataTable[t].Amount):"1"==this.DataTable[t].InclChkGen.toString()?null!=this.DataTable[t].TaxableAmt&&""!=this.DataTable[t].TaxableAmt.toString()&&parseFloat(this.DataTable[t].TaxableAmt)>0&&(b+=parseFloat(this.DataTable[t].TaxableAmt)):(null!=this.DataTable[t].Amount&&""!=this.DataTable[t].Amount.toString()&&parseFloat(this.DataTable[t].Amount)>0&&(b+=parseFloat(this.DataTable[t].Amount)),"Inclusive"!=this.DataTable[t].VatType.toString()&&""!=this.DataTable[t].VatAmount.toString()&&(b+=parseFloat(this.DataTable[t].VatAmount))))}for(let t=0;t<this.PayTermsDataTable.length;t++)(!this.PayTermsDataTableColumns.Contains("IsFreezed")||"1"!=this.PayTermsDataTable[t].IsFreezed.toString()&&"True"!=this.PayTermsDataTable[t].IsFreezed.toString())&&("1"!=this.PayTermsDataTable[t].IsFromRes.toString()||""==this.PayTermsDataTable[t].Amount.toString()&&""==this.PayTermsDataTable[t].DebitAccountID_Key.toString())&&(this.PayTermsDataTable.Remove(this.PayTermsDataTable[t]),t--)}this.FillGridValues(b,d,u,C,c,m,S);for(let s=0;s<10;s++){let t=this.PayTermsDataTableObj.NewRow();this.PayTermsDataTableObj.addRow(t)}this.UpdateSequencePay(),this.CalculateFooter(),this.PayTermsDataTableObj.UpdateTotals()}FillGridValues(t,e,a,i,r,o,l){Logger.InfoLog("AddEditRenContractViewModel ::Entering FillGridValues");let c=new Date;n.e.isValidDate(a)&&(c=new Date(a));let h=new Date,D=0;h=""!=r&&n.e.isValidDate(r)?new Date(r):this.stDate,this.months=e/30;let u=t/this.NoofCheques;this.IsMonth?this.NoofCheques>0&&(D=this.months/this.NoofCheques):this.NoofCheques>0&&(D=e/this.NoofCheques),this.InstPeriod>0&&(D=this.IsMonth?this.InstPeriod/30:this.InstPeriod),this.CheVal=0;let C="",m=this.PayTermsDataTable.length;for(let s=0;s<this.PayTermsDataTable.length;s++)n.e.IsEmpty(this.PayTermsDataTable[s].Amount)&&n.e.IsEmpty(this.PayTermsDataTable[s].DebitAccountID_Key)&&(m=s);for(let b=0;b<this.NoofCheques;b++){let e=this.PayTermsDataTableObj.NewRow();if(this.InclPostingDate&&(e.PostingDate=c.ToString(s.a.SessionManager.Preferences["Date Format"]),e.PostingDate_Key=c),e.Period=i,e.CntrlDate=h.ToString(s.a.SessionManager.Preferences["Date Format"]),e.CntrlDate_Key=h,e.TempCCID_Key=this.DocStNodeID.toString(),e.TempCCID=this.DocStName,D=Math.round(D),console.log(D),console.log("ChequeDuration"),h=this.IsMonth?new Date(e.CntrlDate_Key.ToString("dd/MMM/yyyy")).AddMonths(D):new Date(e.CntrlDate_Key.ToString("dd/MMM/yyyy")).AddDays(D),b==this.NoofCheques-1){let a=0;null!=s.a.SessionManager.Preferences.DecimalsinAmount&&s.a.SessionManager.Preferences.DecimalsinAmount.toString(),a=n.e.DoubleTryParse(t-this.CheVal),this.CheVal+=n.e.DoubleTryParse(e.Amount=a.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()))}else this.CheVal+=n.e.DoubleTryParse(e.Amount=u.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()));if(C=(parseInt(this.FirstNumber)+b).toString(),this.FirstNoLen-C.length>0){let t=this.FirstNoLen-C.length,e="";for(let a=0;a<t;a++)e+="0";C=e+C}if(e.ChequeNo=C,n.e.StringIsNullOrEmpty(this.PayeeBnk)||(e.PayeeBank=this.PayeeBnk),this.DebitAcc>0&&(e.DebitAccountID_Key=this.DebitAcc,e.DebitAccountID=this.DebitName),this.ShowAmountinGenChq&&this.PayTermsDataTableColumns.Contains("RentAmount")&&(e.RentAmount=e.Amount),n.e.StringIsNullOrEmpty(o)||(e.Narration=o,"RENT"==o.toUpperCase()&&(e.Narration=0==b?o+" - 1st Installment":1==b?o+" - 2nd Installment":2==b?o+" - 3rd Installment":o+" - "+(b+1)+"th Installment")),l>0){if(e.Particulars_Key=l,e.Particulars=o,null!=e.Location&&null!=this.DataTable[0].Location){let t=this.DataTable.filter(t=>t.NodeID==l);t.length>0&&!n.e.IsEmpty(t[0].Location_Key)&&(e.Location_Key=t[0].Location_Key,e.Location=t[0].Location)}if(null!=e.Dim_Key&&null!=this.DataTable[0].Dim_Key)if(this.DefaultDiminPayterms>0){e.Dim_Key=this.DefaultDiminPayterms;var S=this.DataTable.filter(t=>t.Dim_Key==this.DefaultDiminPayterms);S.length>0&&!n.e.IsEmpty(S[0].Dim)&&(e.Dim=S[0].Dim)}else{let t=this.DataTable.filter(t=>t.NodeID==l);t.length>0&&!n.e.IsEmpty(t[0].Dim_Key)&&(e.Dim_Key=t[0].Dim_Key,e.Dim=t[0].Dim)}}this.PayTermsDataTableObj.addRow(e)}Logger.InfoLog("AddEditRenContractViewModel ::Exiting FillGridValues")}GetChequValue(t){Logger.InfoLog("AddEditRenContractViewModel ::Entering GetChequValue");let e=t.length,a="";this.strCount=t.length;for(let i=0;i<this.strCount;i++){if("0"!=t[i].toString()){a+=t[i].toString();for(let e=i+1;e<this.strCount;e++)a+=t[e].toString();i++;break}e--}return this.ZeroValue=t.substr(0,t.length-e).toString(),t=t.substr(0,t.length-e)+a,Logger.InfoLog("AddEditRenContractViewModel ::Exiting GetChequValue"),t}GetINvXML(t,e,a,i,r,o,l,c,h,D,u=null){let C="";C+="<RowHead/><Row><Transactions  ",C+='DocDetailsID="0"  BillDate="'+this.ContractDate.Date.ToString("dd/MMM/yyyy")+'"  DocSeqNo="1"  LinkedInvDocDetailsID= ""  LinkedFieldName= "" ProductID="'+this.ProductID+'" ',C+=this.CurrencyContract.SelectedValue>0?'CurrencyID="'+this.CurrencyContract.SelectedValue+'" ':'CurrencyID="1" ',C+='ExchangeRate="1" Unit="1" UOMConversion="1" ',C+='CreditAccount="'+i+'" DebitAccount="'+a+'" ',C+=' Quantity="1" CommonNarration="'+m.d.GetValidXml(h)+'"  ',C+=' Rate="'+r.replace(",","")+'"  Gross="'+r.replace(",","")+'" ',!n.e.IsEmpty(t)&&Object.keys(t).Contains("Narration")&&""!=n.e.String(t.Narration)?C+=' LineNarration="'+m.d.GetValidXml(t.Narration.toString())+'" ':C+=' LineNarration="'+m.d.GetValidXml(this.Narration.Text)+'" ',C+="></Transactions> ";let S="";null!=t?(S=this.AddRowCC(t,null,0,0,u),S+=this.GetSalemanXml(t)):this.LocationContract.Visible&&this.LocationContract.SelectedValue>0&&(S+=" dcCCNID2="+this.LocationContract.SelectedValue+","),C+=' <Numeric Query="';let b="";return n.e.StringIsNullOrEmpty(o)||"0"==o?C+='" /> <Alpha />':(b="Inclusive"==c?(100*parseFloat(r)/(parseFloat(l)+100)).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()):r,C+=" dcNum51="+b.replace(",","")+",dcCalcNum51="+b.replace(",",""),C+=",dcNum52="+l.replace(",","")+",dcCalcNum52="+l.replace(",",""),C+=",dcNum60="+l.replace(",","")+",dcCalcNum60="+l.replace(",",""),C+=",dcNum53="+o.replace(",","")+",dcCalcNum53="+o.replace(",",""),C+=",dcNum61="+o.replace(",","")+",dcCalcNum61="+o.replace(",","")+",",C+='" /> <Alpha  Query="',C+="dcAlpha153='"+c+"',",C+="dcAlpha152='Service',",C+='" />'),C+=' <CostCenters   Query="'+this.strCCQry.toString()+S+'"  /> <EXTRAXML/> ',D||(C+="<AccountsXML><Accounts ",r.Contains("-")?(C+='CreditAccount="'+a+'"  DebitAccount="'+i+'" ',C+='Amount="'+r.replace(",","").replace("-","")+'" AmtFc="'+r.replace(",","").replace("-","")+'"  '):(C+='CreditAccount="'+i+'"  DebitAccount="'+a+'" ',C+='Amount="'+r.replace(",","")+'" AmtFc="'+r.replace(",","")+'"  '),C+=this.CurrencyContract.SelectedValue>0?'CurrencyID="'+this.CurrencyContract.SelectedValue+'" ':'CurrencyID="1" ',C+='ExchangeRate="1"  ></Accounts>',n.e.StringIsNullOrEmpty(o)||"0"==o||(C+="<Accounts ",C+='CreditAccount="'+this.VatAccountID+'"  DebitAccount="'+a+'" ',C+='Amount="'+o.replace(",","")+'" AmtFc="'+o.replace(",","")+'"  ',C+=this.CurrencyContract.SelectedValue>0?'CurrencyID="'+this.CurrencyContract.SelectedValue+'" ':'CurrencyID="1" ',C+='ExchangeRate="1"  ></Accounts>'),C+="</AccountsXML>"),C+=" </Row>",C.toString()}GetPenaltyXML(t,e,a){if(null==e&&(e=""),null==a&&(a=""),0==t.length)return"";let i=!1,r={_DonotUpdateAccounts:i},o=s.a.rental.GetVacancyDocumentType(this.CurrCostCenterID,"TerminatePenaltyJV",r);i=r._DonotUpdateAccounts;let l="",c="";for(let h=0;h<t.length;h++){let r=1;if(!n.e.IsEmpty(t[h].Amount)&&0!=parseFloat(t[h].Amount.toString())&&95==this.CurrCostCenterID&&!n.e.IsEmpty(t[h].Vatper)&&parseFloat(t[h].Vatper.toString())>0&&new Date(this.cntrct.TerminationDate)>=new Date(2018,0,1)){let D=0;if(D=n.e.IntTryParse(e),0==D&&0==this.VatAccountID)return this.DisplayMessage="Define Vat Account",this.MessageVisibility=!0,"";if(0==D&&(e=this.VatAccountID.toString()),!t.Columns.Contains("VatType")||""==t[h].VatType.toString()){let e=this.ScreenObject.Data.Tables[5].filter(t=>"PenaltyVATType"==t.Name);if(e.length>0)if(r=n.e.IntTryParse(e[0].Value),1==r){let e=parseFloat(t[h].Amount.toString())*parseFloat(t[h].Vatper.toString())/100;t[h].VatAmount=e.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount).replace(",","")}else{let e=parseFloat(t[h].Amount.toString())*parseFloat(t[h].Vatper.toString())/(100+parseFloat(t[h].Vatper.toString()));t[h].VatAmount=e.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount).replace(",",""),t[h].Amount=parseFloat(t[h].Amount.toString())-parseFloat(t[h].VatAmount.toString())}}let u="",C="";if(C=!n.e.IsEmpty(t[h].DebitAccountID_Key)&&parseInt(t[h].DebitAccountID_Key.toString())>0?t[h].DebitAccountID_Key.toString():this.RentRecAc.SelectedValue.toString(),!n.e.IsEmpty(t[h].CreditAccountID_Key)&&parseInt(t[h].CreditAccountID_Key.toString())>0)u=t[h].CreditAccountID_Key.toString();else{if("0"==a)return this.DisplayMessage="Define Penalty Account.",this.MessageVisibility=!0,"";u=a}11==o?l+=this.GetINvXML(t[h],e,C,u,t[h].Amount.toString(),t[h].VatAmount.toString(),t[h].Vatper.toString(),1==r?"Exclusive":"Inclusive","",i,t):(l+='<Row><Transactions  CONTRACTSNO="1"  ',l+=' DocDetailsID="0"  DocSeqNo="1"   CreditAccount="'+u,l+='" DebitAccount="-99" Amount="'+t[h].Amount.toString()+'" AmtFc="'+t[h].Amount.toString()+'"',l+="></Transactions> ",c=this.AddRowCC(t[h],null,0,0,t),c+=this.GetSalemanXml(t[h]),l+=' <Numeric /> <Alpha /> <CostCenters   Query="'+this.strCCQry.toString()+c+'"  />  ',l+="<EXTRAXML> ",l+="</EXTRAXML> ",l+=" </Row>",l+='<Row><Transactions  CONTRACTSNO="1"  ',l+=' DocDetailsID="0"  DocSeqNo="2"   CreditAccount="-99" DebitAccount="'+C,l+='" Amount="'+t[h].Amount.toString()+'" AmtFc="'+t[h].Amount.toString()+'"',l+="></Transactions> ",l+=' <Numeric /> <Alpha /> <CostCenters   Query="'+this.strCCQry.toString()+c+'"  />  ',l+="<EXTRAXML> ",l+="</EXTRAXML> ",l+=" </Row>",!n.e.IsEmpty(t[h].VatAmount)&&parseFloat(t[h].VatAmount.toString())>0&&(l+='<Row><Transactions  CONTRACTSNO="1" ',l+='DocDetailsID="0"  DocSeqNo="3" ',l+='CreditAccount="-99" DebitAccount="'+this.RentRecAc.SelectedValue.toString()+'" ',l+='Amount="'+t[h].VatAmount.toString()+'" AmtFc="'+t[h].VatAmount.toString()+'"',l+="></Transactions> ",l+=' <Numeric /> <Alpha /> <CostCenters   Query="'+this.strCCQry.toString()+c+'"  />  ',l+="<EXTRAXML> </EXTRAXML> </Row>",l+='<Row><Transactions  CONTRACTSNO="1" ',l+='DocDetailsID="0"  DocSeqNo="4" ',l+='CreditAccount="'+e+'" DebitAccount="-99" ',l+='Amount="'+t[h].VatAmount.toString()+'" AmtFc="'+t[h].VatAmount.toString()+'"',l+="></Transactions> ",l+=' <Numeric /> <Alpha /> <CostCenters   Query="'+this.strCCQry.toString()+c+'"  />  ',l+="<EXTRAXML> ",l+="</EXTRAXML> ",l+=" </Row>"))}return l.length>0&&(l="<DocumentXML>"+l,l+="</DocumentXML>"),l.toString()}}GetPenaltyParticulars(t,e){if(null==e&&(e=""),0==t.length)return"";let a="";for(let i=0;i<t.length;i++)n.e.IsEmpty(t[i].Amount)||0==parseFloat(t[i].Amount.toString())||(a+='<Row CreditAccID="',!n.e.IsEmpty(t[i].CreditAccountID_Key)&&parseInt(t[i].CreditAccountID_Key.toString())>0?a+=t[i].CreditAccountID_Key.toString():"0"!=e&&(a+=e),a+='"  DebitAccID="',!n.e.IsEmpty(t[i].DebitAccountID_Key)&&parseInt(t[i].DebitAccountID_Key.toString())>0?a+=t[i].DebitAccountID_Key.toString():a+=this.RentRecAc.SelectedValue.toString(),n.e.IsEmpty(t[i].Vatper)||(a+='" VatPer="'+t[i].Vatper.toString()),n.e.IsEmpty(t[i].VatAmount)||(a+='" VatAmount="'+t[i].VatAmount.toString()),a+='" Amount="'+t[i].Amount.toString()+'" CCNodeID="'+t[i].NodeID.toString()+'" />');return a.length>0&&(a="<XML>"+a,a+="</XML>"),a.toString()}GetVacancyXml(t,e,a,i,o){let l=!1,c=s.a.rental.IsBillWiseAccount(this.RentRecAc.SelectedValue);null!=c&&c.Tables.length>0&&c.Tables[0].length>0&&!n.e.IsEmpty(c.Tables[0][0].IsBillwise)&&(l=Object(r.j)(c.Tables[0][0].IsBillwise));let h="";o.ActualRentofmnt=0;let D=0;if(this.TotalMonths=this.getTotalMonths(),"Daily"==this.BasedOn.SelectedValue||this.TotalMonths<1){let t=n.e.Round(parseFloat(this.DataTable[0].Amount)/this.GetDays(),this.dDeci);o.ActualRentofmnt=n.e.Round(t*n.e.GetDateDifference(this.TerminateContracts.TerminationDate.Date,a),this.Mdeci)}else this.DataTable.length>0&&null!=this.DataTable[0].Amount&&""!=this.DataTable[0].Amount.toString()&&(D=parseFloat(this.DataTable[0].Amount)/this.TotalMonths),o.ActualRentofmnt=D/this.TerminateContracts.TerminationDate.Date.DaysInMonth()*n.e.GetDateDifference(this.TerminateContracts.TerminationDate.Date,a);if(o.ActualRentofmnt>0){let a="";if(3==this.Vattype&&this.VATExtraRent&&95==this.CurrCostCenterID&&this.VatonRent>0){let t=0;if(t=n.e.IntTryParse(e),0==t&&0==this.VatAccountID)return this.DisplayMessage="Define Vat Account",this.MessageVisibility=!0,"";0==t&&(e=this.VatAccountID.toString()),a=(parseFloat(o.ActualRentofmnt)*(this.VatonRent/100)).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount).replace(",","")}if(h+=" <DocumentXML>",2==t)h+=this.GetINvXML(null,e,this.RentRecAc.SelectedValue.toString(),this.IncomeAc.SelectedValue.toString(),o.ActualRentofmnt.toString(),a,this.VatonRent.toString(),"Exclusive","",i);else if(0==t){h+='<Row><Transactions  CONTRACTSNO="1" ',h+='DocDetailsID="0"  DocSeqNo="1" ',h+=104==this.CurrCostCenterID?'CreditAccount="'+this.RentRecAc.SelectedValue.toString()+'" DebitAccount="'+this.IncomeAc.SelectedValue+'" ':'CreditAccount="'+this.IncomeAc.SelectedValue+'" DebitAccount="'+this.RentRecAc.SelectedValue.toString()+'" ',h+='Amount="'+o.ActualRentofmnt.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount).replace(",","")+'" AmtFc="'+o.ActualRentofmnt.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount).replace(",","")+'"',h+="></Transactions> ";let t=this.AddRowCC(this.DataTable[0],null,0,0,this.DataTable);if(t+=this.GetSalemanXml(this.DataTable[0]),h+=' <Numeric /> <Alpha /> <CostCenters   Query="'+this.strCCQry.toString()+t+'"  /> ',h+="<EXTRAXML> ",s.a.SessionManager.Preferences.ContainsKey("On")&&"True"==s.a.SessionManager.Preferences.On&&l&&(h+="<BillWise> ",h+=' <Row DocSeqNo="1" AccountID="'+this.RentRecAc.SelectedValue.toString(),h+=104==this.CurrCostCenterID?'" AmountFC="-'+o.ActualRentofmnt.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount).replace(",","")+'" AdjAmount="-'+o.ActualRentofmnt.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount).replace(",","")+'"':'" AmountFC="'+o.ActualRentofmnt.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount).replace(",","")+'" AdjAmount="'+o.ActualRentofmnt.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount).replace(",","")+'"',h+=' AdjCurrID="1" ',h+='AdjExchRT="1" ',h+='IsNewReference="1" ',h+='Narration="" ',h+='IsDocPDC="0" ',h+=" ></Row>",h+=" </BillWise>"),h+="</EXTRAXML> ",h+=" </Row>",3==this.Vattype&&this.VATExtraRent&&95==this.CurrCostCenterID&&this.VatonRent>0){let a=0;if(a=n.e.IntTryParse(e),0==a)return this.DisplayMessage="Define Vat Account",this.MessageVisibility=!0,"";h+='<Row><Transactions  CONTRACTSNO="1" ',h+='DocDetailsID="0"  DocSeqNo="2" ',h+='CreditAccount="'+e+'" DebitAccount="'+this.RentRecAc.SelectedValue.toString()+'" ',h+='Amount="'+(parseFloat(o.ActualRentofmnt)*(this.VatonRent/100)).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount).replace(",","")+'" AmtFc="'+(parseFloat(o.ActualRentofmnt)*(this.VatonRent/100)).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount).replace(",","")+'"',h+="></Transactions> ",h+=' <Numeric /> <Alpha /> <CostCenters   Query="'+this.strCCQry.toString()+t+'"  /> ',h+="<EXTRAXML> ",h+="</EXTRAXML> ",h+=" </Row>"}}else{h+='<Row><Transactions  CONTRACTSNO="1" ',h+='DocDetailsID="0"  DocSeqNo="1" ',h+=104==this.CurrCostCenterID?'CreditAccount="-99" DebitAccount="'+this.IncomeAc.SelectedValue+'" ':'CreditAccount="'+this.IncomeAc.SelectedValue+'" DebitAccount="-99" ',h+='Amount="'+o.ActualRentofmnt.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount).replace(",","")+'" AmtFc="'+o.ActualRentofmnt.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount).replace(",","")+'"',h+="></Transactions> ";let t=this.AddRowCC(this.DataTable[0],null,0,0,this.DataTable);if(t+=this.GetSalemanXml(this.DataTable[0]),h+=' <Numeric /> <Alpha /> <CostCenters   Query="'+this.strCCQry.toString()+t+'"  />  ',h+="<EXTRAXML> ",s.a.SessionManager.Preferences.ContainsKey("On")&&"True"==s.a.SessionManager.Preferences.On){let t=!1;c=s.a.rental.IsBillWiseAccount(this.IncomeAc.SelectedValue),null!=c&&c.Tables.length>0&&c.Tables[0].length>0&&!n.e.IsEmpty(c.Tables[0][0].IsBillwise)&&(t=Object(r.j)(c.Tables[0][0].IsBillwise)),t&&(h+="<BillWise> ",h+=' <Row DocSeqNo="1" AccountID="'+this.IncomeAc.SelectedValue,h+=104==this.CurrCostCenterID?'" AmountFC="'+o.ActualRentofmnt.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount).replace(",","")+'" AdjAmount="'+o.ActualRentofmnt.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount).replace(",","")+'"':'" AmountFC="-'+o.ActualRentofmnt.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount).replace(",","")+'" AdjAmount="-'+o.ActualRentofmnt.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount).replace(",","")+'"',h+=' AdjCurrID="1" ',h+='AdjExchRT="1" ',h+='IsNewReference="1" ',h+='Narration="" ',h+='IsDocPDC="0" ',h+=" ></Row>",h+=" </BillWise>")}if(h+="</EXTRAXML> ",h+=" </Row>",h+='<Row><Transactions  CONTRACTSNO="1" ',h+='DocDetailsID="0"  DocSeqNo="2" ',h+=104==this.CurrCostCenterID?'CreditAccount="'+this.RentRecAc.SelectedValue.toString()+'" DebitAccount="-99" ':'CreditAccount="-99" DebitAccount="'+this.RentRecAc.SelectedValue.toString()+'" ',h+='Amount="'+o.ActualRentofmnt.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount).replace(",","")+'" AmtFc="'+o.ActualRentofmnt.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount).replace(",","")+'"',h+="></Transactions> ",h+=' <Numeric /> <Alpha /> <CostCenters   Query="'+this.strCCQry.toString()+t+'"  />  ',h+="<EXTRAXML> ",s.a.SessionManager.Preferences.ContainsKey("On")&&"True"==s.a.SessionManager.Preferences.On&&l&&(h+="<BillWise> ",h+=' <Row DocSeqNo="2" AccountID="'+this.RentRecAc.SelectedValue.toString(),h+=104==this.CurrCostCenterID?'" AmountFC="-'+o.ActualRentofmnt.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount).replace(",","")+'" AdjAmount="-'+o.ActualRentofmnt.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount).replace(",","")+'"':'" AmountFC="'+o.ActualRentofmnt.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount).replace(",","")+'" AdjAmount="'+o.ActualRentofmnt.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount).replace(",","")+'"',h+=' AdjCurrID="1" ',h+='AdjExchRT="1" ',h+='IsNewReference="1" ',h+='Narration="" ',h+='IsDocPDC="0" ',h+=" ></Row>",h+=" </BillWise>"),h+="</EXTRAXML> ",h+=" </Row>",3==this.Vattype&&this.VATExtraRent&&95==this.CurrCostCenterID&&this.VatonRent>0){let a=0;if(a=n.e.IntTryParse(e),0==a)return this.DisplayMessage="Define Vat Account",this.MessageVisibility=!0,"";h+='<Row><Transactions  CONTRACTSNO="1" ',h+='DocDetailsID="0"  DocSeqNo="3" ',h+='CreditAccount="-99" DebitAccount="'+this.RentRecAc.SelectedValue.toString()+'" ',h+='Amount="'+(parseFloat(o.ActualRentofmnt)*(this.VatonRent/100)).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount).replace(",","")+'" AmtFc="'+(parseFloat(o.ActualRentofmnt)*(this.VatonRent/100)).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount).replace(",","")+'"',h+="></Transactions> ",h+=' <Numeric /> <Alpha /> <CostCenters   Query="'+this.strCCQry.toString()+t+'"  />  ',h+="<EXTRAXML> ",s.a.SessionManager.Preferences.ContainsKey("On")&&"True"==s.a.SessionManager.Preferences.On&&l&&(h+="<BillWise> ",h+=' <Row DocSeqNo="3" AccountID="'+this.RentRecAc.SelectedValue.toString(),h+='" AmountFC="'+(parseFloat(o.ActualRentofmnt)*(this.VatonRent/100)).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount).replace(",","")+'" AdjAmount="'+o.ActualRentofmnt.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount).replace(",","")+'"',h+=' AdjCurrID="1" ',h+='AdjExchRT="1" ',h+='IsNewReference="1" ',h+='Narration="" ',h+='IsDocPDC="0" ',h+=" ></Row>",h+=" </BillWise>"),h+="</EXTRAXML> ",h+=" </Row>",h+='<Row><Transactions  CONTRACTSNO="1" ',h+='DocDetailsID="0"  DocSeqNo="4" ',h+='CreditAccount="'+e+'" DebitAccount="-99" ',h+='Amount="'+(parseFloat(o.ActualRentofmnt)*(this.VatonRent/100)).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount).replace(",","")+'" AmtFc="'+(parseFloat(o.ActualRentofmnt)*(this.VatonRent/100)).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount).replace(",","")+'"',h+="></Transactions> ",h+=' <Numeric /> <Alpha /> <CostCenters   Query="'+this.strCCQry.toString()+t+'"  />  ',h+="<EXTRAXML> ",h+="</EXTRAXML> ",h+=" </Row>"}}h+="</DocumentXML>"}return h.toString()}ParentCallBack(t){this.StrMultiple="",this.SelectedUnits="",this.NoOfUnits.Text=t.SelectedNodes.length.toString(),t.SelectedNodes.length>1?(t.SelectedNodes.forEach(t=>{t.IsGroup||(this.StrMultiple+=t.Text[1]+",",this.SelectedUnits+=t.Id+",")}),this.StrMultiple.length>1&&(this.StrMultiple=this.StrMultiple.substring(0,this.StrMultiple.length-1)),n.e.StringIsNullOrEmpty(this.SlNO.Text)||(this.StrMultiple=this.StrMultiple+" :"+this.SlNO.Text),this.SelectedUnits.length>1&&(this.SelectedUnits=this.SelectedUnits.slice(0,-1)),this.ScreenObject.HeaderFields.forEach(t=>{t instanceof l.f&&(t.MultipleUnits.Text=this.StrMultiple),t.multiVisi=!0}),this.Property.Enable=!1,this.multiVisi=!0,this.FillUnitDetails_1()):1==t.SelectedNodes.length?(this.Property.Enable=!0,this.multiVisi=!1,this.Unit.SelectedValue=t.SelectedNodes[0].Id):(this.Property.Enable=!0,this.multiVisi=!1),this.FilterTenantBasedOnUnit&&0==this.ParentContractID&&(this.Tenant.CustomWhere=" a.TenantID IN (SELECT CC.NodeID FROM REN_Units U with(nolock) LEFT JOIN COM_CCCCData CC with(nolock) ON CC.CCNID10=U.CCNodeID  WHERE CC.CostCenterID=94 AND U.UnitID IN("+this.SelectedUnits+") )")}FillUnitDetails_1(){this.DataTableObj.Clear();let t,e,a=this.DataTableObj.NewRow();var i;if(this.DataTableObj.addRow(a),a.Recurr=!1,this.DataTable[0].Recurr=!0,a.Recurr=!1,this.dsPart=this.StartDate.Date&&this.EndDate.Date?s.a.rental.GetParticularsDetails(this.RenewRefID,this.Unit.SelectedValue,0,this.StartDate.Date,this.EndDate.Date,1,this.ContractID,this.SelectedUnits):this.StartDate.Date?s.a.rental.GetParticularsDetails(this.RenewRefID,this.Unit.SelectedValue,0,this.StartDate.Date,new Date,1,this.ContractID,this.SelectedUnits):s.a.rental.GetParticularsDetails(this.RenewRefID,this.Unit.SelectedValue,0,new Date,this.EndDate.Date?this.EndDate.Date:new Date,1,this.ContractID,this.SelectedUnits),this.DataTable[0].Particulars="Rent",this.DataTable[0].NodeID=this.id2.toString(),null!=this.dsPart&&this.dsPart.Tables.length>5&&this.dsPart.Tables[5].length>0&&this.dsPart.Columns[5].Contains("RentableArea")&&(this.DataTable[0].Sqft=this.dsPart.Tables[5].Compute("sum","RentableArea")),null!=this.dsPart&&this.dsPart.Tables.length>0&&this.dsPart.Tables[0].length>0?t=this.dsPart.Tables[0].filter(t=>1==t.Type||3==t.Type):null!=this.dsPart&&this.dsPart.Tables.length>1&&this.dsPart.Tables[1].length>0&&(t=this.dsPart.Tables[1].filter(t=>1==t.Type||3==t.Type),this.dsPart.Columns[1].Contains("UnitID")&&(t=t.filter(t=>0==t.UnitID||t.UnitID in this.SelectedUnits))),e=this.dsPart.Tables[6],null!=e&&e.length>0&&(this.DataTableColumns.Contains("BasedOn")&&!n.e.IsEmpty(e[0].BasedOn)&&(this.BasedOn.SelectedValue=e[0].BasedOn.toString()),this.DataTableColumns.Contains("ccnid70")&&parseInt(e[0].ccnid70.toString())&&(this.Vattype=parseInt(e[0].ccnid70.toString())),0==this.PickCC&&(null==e[0].SalesmanID||n.e.IsEmpty(e[0].SalesmanID)||(this.Salesman.SelectedValue=parseInt(e[0].SalesmanID.toString())),null==e[0].AccountantID||n.e.IsEmpty(e[0].AccountantID)||(this.Accountant.SelectedValue=parseInt(e[0].AccountantID.toString())),null==e[0].LandlordID||n.e.IsEmpty(e[0].LandlordID)||(this.Landlord.SelectedValue=parseInt(e[0].LandlordID.toString())),null==e[0].LocationID||n.e.IsEmpty(e[0].LocationID)||(this.LocationContract.SelectedValue=parseInt(e[0].LocationID.toString()))),null==e[0].ccnid58||n.e.IsEmpty(e[0].ccnid58)||null!=(i=this.ScreenObject.GetExtrFieldByName("ccnid58"))&&i instanceof l.b&&(i.SelectedValue=parseInt(e[0].ccnid58.toString())),null==e[0].ccnid70||n.e.IsEmpty(e[0].ccnid70)||null!=(i=this.ScreenObject.GetExtrFieldByName("ccnid70"))&&i instanceof l.b&&(i.SelectedValue=parseInt(e[0].ccnid70.toString())),null==e[0].ccnid59||n.e.IsEmpty(e[0].ccnid59)||null!=(i=this.ScreenObject.GetExtrFieldByName("ccnid59"))&&i instanceof l.b&&(i.SelectedValue=parseInt(e[0].ccnid59.toString())),null==e[0].ccnid61||n.e.IsEmpty(e[0].ccnid61)||null!=(i=this.ScreenObject.GetExtrFieldByName("ccnid61"))&&i instanceof l.b&&(i.SelectedValue=parseInt(e[0].ccnid61.toString())),null==e[0].ccnid62||n.e.IsEmpty(e[0].ccnid62)||null!=(i=this.ScreenObject.GetExtrFieldByName("ccnid62"))&&i instanceof l.b&&(i.SelectedValue=parseInt(e[0].ccnid62.toString()))),0==this.PickACC&&this.dsPart.Tables.length>2&&(null==this.dsPart.Tables[2][0].RentalIncomeAccountID||n.e.IsEmpty(this.dsPart.Tables[2][0].RentalIncomeAccountID)||(this.IncomeAc.SelectedValue=parseInt(this.dsPart.Tables[2][0].RentalIncomeAccountID)),null==this.dsPart.Tables[2][0].RentalReceivableAccountID||n.e.IsEmpty(this.dsPart.Tables[2][0].RentalReceivableAccountID)||(this.RentRecAc.SelectedValue=parseInt(this.dsPart.Tables[2][0].RentalReceivableAccountID)),null==this.dsPart.Tables[2][0].AdvanceRentAccountID||n.e.IsEmpty(this.dsPart.Tables[2][0].AdvanceRentAccountID)||(this.GenAdvanceRentAcc=parseInt(this.dsPart.Tables[2][0].AdvanceRentAccountID))),this.GenAdvanceRentAcc>0){let t=s.a.rental.GetAccountName(this.GenAdvanceRentAcc);null!=t&&t.Tables.Count>0&&t.Tables[0].length>0&&!n.e.IsEmpty(t.Tables[0][0].ACCOUNTNAME)&&""!=t.Tables[0][0].ACCOUNTNAME.toString()&&(this.GenAdvanceRentAccName=t.Tables[0][0].ACCOUNTNAME.toString()),this.DataTable[0].CreditAccountID_Key=this.GenAdvanceRentAcc,this.DataTable[0].CreditAccountID=this.GenAdvanceRentAccName}a=this.FillUnitDetails(a,t,this.dsPart),this.CalculateRent()}VatCalcOnRenew(t){this.DataTable.length>0&&(t&&(this.DataTable[0].InclChkGen="1"),3==this.Vattype&&this.VatonRent>0?(this.DataTable[0].VatPer=this.VatonRent,this.ScreenObject.Data.Tables.length>6&&this.ScreenObject.Data.Columns[6].Contains("TCVat")&&this.ScreenObject.Data.Tables[6].length>0&&""!=this.ScreenObject.Data.Tables[6][0].TCVat.toString()&&(this.DataTable[0].TaxCategory=this.ScreenObject.Data.Tables[6][0].TCVat.toString()),this.DataTable[0].TaxCategory_Key=3,t&&(this.DataTable[0].VatType="Exclusive")):4==this.Vattype&&this.VatonRent>0&&(this.DataTable[0].VatPer=0,this.ScreenObject.Data.Tables.length>6&&this.ScreenObject.Data.Columns[6].Contains("TcExcemt")&&this.ScreenObject.Data.Tables[6].length>0&&""!=this.ScreenObject.Data.Tables[6][0].TcExcemt.toString()&&(this.DataTable[0].TaxCategory=this.ScreenObject.Data.Tables[6][0].TcExcemt.toString()),this.DataTable[0].TaxCategory_Key=1),this.DistribtueInvoice&&t&&(this.DataTable[0].RecurInvoice="true"),this.CalculateNRec())}ProcessFullRefund(t){this.cntrct.TerminationPostDate=this.cntrct.TerminationDate=t,this.cntrct.TerminationPostDate=this.TerminateContracts.TerminationPostDate.Date,this.cntrct.UnitID=this.Unit.SelectedValue,this.cntrct.TenantID=this.Tenant.SelectedValue,this.cntrct.PropertyID=this.Property.SelectedValue,this.cntrct.ContractID=this.ContractID,this.cntrct.RentRecID=this.RentRecAc.SelectedValue,this.cntrct.WONO=this.strContractNo;let e=s.a.rental.GetPostingDetails(this.cntrct,this.ContractID,this.CurrCostCenterID,5,this.VatNode,this.InvCCID,this.cntrct.PropertyID,this.cntrct.UnitID,this.cntrct.TenantID,this.cntrct.RentRecID);if(null!=e&&e.Tables.length>0){this.ProductID=parseInt(e.Tables[0][0].PRODUCTID.toString()),this.GetCCData(e.Tables[0]),this.RefundAmt=0,this.SRTAmount=0,this.PDCRefund=0,this.VatAmt=0,this.DiscReturn=0,this.cntrct.Wid=this.ScreenObject.CheckWorkFlow_1(8);let a=0,i=!1;""!=e.Tables[0][0].IsBillwise.toString()&&(i=Object(r.j)(e.Tables[0][0].IsBillwise.toString())),this.IncomeAc.SelectedValue>0&&(this.cntrct.IncomeID=this.IncomeAc.SelectedValue),this.cntrct.StatusID=477,this.cntrct.PostPaymentXML=this.GetPaymentXML(i),this.cntrct.PostPDPaymentXML=this.GetPDPaymentXML(i,e),this.cntrct.PostRentPayXML=this.GetRefundPaymentXML(e.Tables[2],t),this.cntrct.PostSalesRtnXML=this.GetSRTXML(e.Tables[1],e.Tables[7],e.Tables[2],5,!0,e.Tables[0]);let n=0;s.a.rental.TerminateContract(this.cntrct,this.CurrCostCenterID,this.SRTAmount,this.RefundAmt,this.PDCRefund,a,0,this.TerminateContracts.BankAccount.SelectedValue,this.TerminateContracts.ChequeNo.Text,this.TerminateContracts.ChequeDate.Date,this.TerminateContracts.Remarks.Text).subscribe(t=>{this.DisplayMessage=t.Message,n=t.RetValue,n>0&&this.ClearData()})}}GetRefundPaymentXML(t,e){let a="";a+="<RENTRCT>";for(let i=0;i<t.length;i++){a+='<ROWS><ChequeDocDate DD="'+new Date(t[i].docdate).ToString("dd/MMM/yyyy")+'"',new Date(t[i].docdate)>e&&(a+=' CancelDOCID="'+t[i].DocID.toString()+'"'),a+="></ChequeDocDate><DocumentXML>",a+='<Row><Transactions CONTRACTSNO="'+(i+1).toString()+'" ',a+='DocDetailsID="0" DocSeqNo="1" ',a+='CreditAccount="'+t[i].DebitAccount.toString()+'" DebitAccount="'+t[i].CreditAccount.toString()+'" ',a+='Amount="'+t[i].amount.toString()+'" AmtFc="'+t[i].amount.toString()+'" ',a+=this.CurrencyContract.SelectedValue>0?'CurrencyID="'+this.CurrencyContract.SelectedValue+'" ':'CurrencyID="1" ',a+='ExchangeRate="1"  CommonNarration="'+m.d.GetValidXml(this.Narration.Text)+'"  LineNarration="  RENT SETTLEMENT " ChequeBankName="" ChequeNumber="" ',a+="></Transactions> ";let n="";this.DataTableColumns.Contains("Location_Key")&&""!=this.DataTable[0].Location_Key.toString()?n+=" dcCCNID2="+this.DataTable[0].Location_Key.toString()+",":this.LocationContract.Visible&&this.LocationContract.SelectedValue>0&&(n+=" dcCCNID2="+this.LocationContract.SelectedValue+","),this.DataTableColumns.Contains("Dim_Key")&&""!=this.DataTable[0].Dim_Key.toString()&&(n+=" dcCCNID"+(this.DimCCID-5e4).toString()+"="+this.DataTable[0].Dim_Key.toString()+","),n+=this.GetSalemanXml(this.DataTable[0]),s.a.SessionManager.Preferences.ContainsKey("DepositLinkDimension")&&""!=s.a.SessionManager.Preferences.DepositLinkDimension&&parseInt(s.a.SessionManager.Preferences.DepositLinkDimension)>0&&(n+=" dcCCNID"+(parseInt(s.a.SessionManager.Preferences.DepositLinkDimension)-5e4).toString()+"="+this.DataTable[0].NodeID.toString()+","),a+=' <Numeric /> <Alpha /> <CostCenters   Query="'+this.strCCQry.toString()+n+'"  /> <EXTRAXML/>',a+=" </Row>",a+="</DocumentXML></ROWS>"}return a+="</RENTRCT>",a.toString()}OnCustomizeExtraFields(t){return Object(i.b)(this,void 0,void 0,(function*(){Logger.InfoLog("AddEditRenContractViewModel ::Entering OnCustomizeExtraFields");let e="";if("Customize"==t.toString());else if("MultiUnits"==t.toString()){if(0==this.Property.SelectedValue)return this.DisplayMessage="Please select property",void(this.MessageVisibility=!0);let t=" propertyID="+this.Property.SelectedValue.toString();this.ShowOnlyAvailable?(t=t+" and (UnitStatus = "+this.UnitStatusVal+" or UnitStatus is null or   UnitStatus =  0) and a.UnitID not in (select unitid from ren_contract with(nolock) where unitid is not null and (statusid=426 or statusid=427) ",t+=" AND ContractID NOT IN (SELECT DISTINCT RenewRefID FROM ren_contract WITH(NOLOCK) WHERE RenewRefID IS NOT NULL AND RenewRefID >0 )",t+=" AND RefContractID NOT IN (SELECT DISTINCT RenewRefID FROM ren_contract WITH(NOLOCK) WHERE RenewRefID IS NOT NULL AND RenewRefID >0 ))"):t=t+" and (UnitStatus = "+this.UnitStatusVal+" or UnitStatus is null or   UnitStatus =  0) ";let e=new Q.a;e.SearchPickerViewModel(this,"units",t,"",this.SelectedUnits),s.a.page.ShowDialog(e,H.a,{HideClose:!0,ShowCenter:!0,Title:s.a.GetResource("Multi Unit")})}else if("AddContract"==t.toString()){let t=new Z;t.AddEditRenContractViewModel_1(95,0,!1,0,0,this.Title),t.Property.SelectedValue=this.Property.SelectedValue,t.ContractNumber.ComboBox.SelectedValue=this.Property.SelectedValue.toString(),t.OnContractPrefixChanged(t.ContractNumber.ComboBox.SelectedValue),t.onListSelectedChanged(t.Property),t.Tenant.SelectedValue=this.Tenant.SelectedValue,t.LocationContract.SelectedValue=this.LocationContract.SelectedValue,t.DivisionContract.SelectedValue=this.DivisionContract.SelectedValue,t.Salesman.SelectedValue=this.Salesman.SelectedValue,t.Landlord.SelectedValue=this.Landlord.SelectedValue,t.Accountant.SelectedValue=this.Accountant.SelectedValue,t.TermsConditions.Text=this.TermsConditions.Text,t.Purpose.Text=this.Purpose.Text,t.Narration.Text=this.Narration.Text,t.TotalYears.Text=this.TotalYears.Text,t.Months.Text=this.Months.Text,t.TotalDays.Text=this.TotalDays.Text,t.StartDate.Date=this.StartDate.Date,t.EndDate.Date=this.EndDate.Date,t.BasedOn.SelectedValue=this.BasedOn.SelectedValue,t.ParentContractID=this.ContractID;let e,a=s.a.rental.GetNextContractNo(95,this.ContractID);t.SlNO.Text=a.toString(),t.RefNo.Visible=!0,t.RefNo.Enable=!1,t.RefNo.Text=this.SlNO.Text,t.AddUnitWhere(2);for(let i=0;i<6;i++){let e=this.DataTableObj.NewRow();e.Recurr=!1,this.DataTableObj.addRow(e);let a=t.PayTermsDataTableObj.NewRow();this.PayTermsDataTableObj.addRow(a)}this.DataTableObj.UpdateTotals(),this.PayTermsDataTableObj.UpdateTotals(),this.FillExtraFields(t),e={obj:t},s.a.page.addNewTab({title:null,component:K.AddEditRentalContractComponent,params:e})}else if("SuspendReservation"==t.toString()){let t=0;this.cntrct.RemaingPaymentXML=null!=this.TerminateContracts&&null!=this.TerminateContracts.BankAccount&&this.TerminateContracts.BankAccount.SelectedValue>0?this.GetRemaingPaymentXML(!1):"",103==this.CurrCostCenterID?s.a.rental.CancelReservation(this.cntrct,this.ContractID,this.RefundDate.Date,"0").subscribe(e=>{this.DisplayMessage=e.Message,t=e.RetValue,t>0&&(this.ClearData(),this.RefershPage(),this.DeleteVisibility=!1,Logger.InfoLog("AddEditRenContractViewModel :: Exiting SuspendReservation")),this.MessageVisibility=!0,Logger.InfoLog("AddEditRenContractViewModel :: Entering SuspendReservation ")},t=>{alert(JSON.stringify(t)),console.log("SaveContract : "+JSON.stringify(t))}):s.a.rental.CancelReservation(this.cntrct,this.ContractID,this.TerminateContracts.TerminationDate.Date,this.TerminateContracts.PaymentOption.SelectedValue).subscribe(e=>{this.DisplayMessage=e.Message,t=e.RetValue,t>0&&(this.ClearData(),this.RefershPage(),this.DeleteVisibility=!1,Logger.InfoLog("AddEditRenContractViewModel :: Exiting SuspendReservation")),this.MessageVisibility=!0,Logger.InfoLog("AddEditRenContractViewModel :: Entering SuspendReservation ")},t=>{alert(JSON.stringify(t)),console.log("SaveContract : "+JSON.stringify(t))})}else if("ViewQuotation"==t.toString()){let t=s.a.rental.GetQuotationDetails(this.LinkedQuotationID);if(null!=t&&t.Tables.length>0&&t.Tables[0].length>0&&t.Columns[0].Contains("CostCenterID")){let e,a=new Z;a.AddEditRenContractViewModel_1(parseInt(t.Tables[0][0].CostCenterID.toString()),this.LinkedQuotationID,!1,0,0,"",t),e={obj:a},s.a.page.addNewTab({title:this.ScreenName,component:K.AddEditRentalContractComponent,params:e})}}else if("CloseReservation"==t.toString()){let t=0,e=0;if(null==this.VacancyDate.Date)return this.DisplayMessage="Select Close Date",void(this.MessageVisibility=!0);if(null==this.ExtndTill||!this.ExtndTill.Date)return this.DisplayMessage="Select Valid/Extended date",void(this.MessageVisibility=!0);if(null!=this.ExtndTill&&this.ExtndTill.Date&&this.VacancyDate.Date<=this.ExtndTill.Date)return this.DisplayMessage="CloseDate should be higher than Reservation Valid/Extended date",void(this.MessageVisibility=!0);if(!(this.Property.SelectedValue>0))return this.DisplayMessage="Please select property",void(this.MessageVisibility=!0);if(this.cntrct.PropertyID=this.Property.SelectedValue,this.IsMultiunit&&""!=this.SelectedUnits)this.cntrct.MultiIDS=this.SelectedUnits,this.cntrct.multiName=this.StrMultiple;else{if(!(this.Unit.SelectedValue>0))return this.DisplayMessage=s.a.GetResource("PleaseselectUnit"),void(this.MessageVisibility=!0);this.cntrct.UnitID=this.Unit.SelectedValue}if(!(this.Tenant.SelectedValue>0))return this.DisplayMessage="Please select Tenant",void(this.MessageVisibility=!0);this.cntrct.TenantID=this.Tenant.SelectedValue,this.RentRecAc.SelectedValue>0&&(this.cntrct.RentRecID=this.RentRecAc.SelectedValue),this.LocationContract.SelectedValue>0&&this.LocationContract.Visible?this.cntrct.LocationID=this.LocationContract.SelectedValue:this.LocationContract.Visible||(this.cntrct.LocationID=1),this.DivisionContract.SelectedValue>0&&this.DivisionContract.Visible?this.cntrct.DivisionID=this.DivisionContract.SelectedValue:this.DivisionContract.Visible||(this.cntrct.DivisionID=1);let a=this.GetReceipts(0,e);if(this.cntrct.PostPDRecieptXML=a.sbIssue,e=a.Count,e>1)return this.DisplayMessage="Payment terms can not be more than one in reservation.",void(this.MessageVisibility=!0);s.a.rental.CloseReservation(this.cntrct,this.ContractID,this.VacancyDate.Date).subscribe(e=>{this.DisplayMessage=e.Message,t=e.RetValue,this.MessageVisibility=!0,t>0&&(this.ClearData(),this.RefershPage(),this.VacancyDate.Date=null,Logger.InfoLog("AddEditRenContractViewModel :: Exiting SuspendReservation")),this.MessageVisibility=!0,Logger.InfoLog("AddEditRenContractViewModel :: Entering SuspendReservation ")},t=>{alert(JSON.stringify(t)),console.log("SaveContract : "+JSON.stringify(t))})}else if("ViewHistory"==t.toString())this.DocumentDraftsPopup(3);else if("History"==t.toString()&&this.ContractID>0){const{UpdatePayTermsViewModel:t}=yield a.e(68).then(a.bind(null,"Rr92")),{UpdatepaytermsComponent:e}=yield a.e(0).then(a.bind(null,"++ql"));let i=s.a.rental.GetHistoryDS(this.ContractID,this.CurrCostCenterID);if(null!=i&&i.Tables.length>0&&i.Columns[0].Contains("ModifiedBy")){let a=new t("AddEditRenContractViewModel");a.UpdatePayTermsViewModel_1(this,null,null,2),a.PstDocGrid.Columns=[];let r=new D.a;r.Header="User",r.DisplayMember="ModifiedBy",r.ReadOnly=!0,r.Width=150,a.PstDocGrid.Columns.push(r),r=new D.a,r.Header="Date",r.DisplayMember="ModifiedDate",r.ReadOnly=!0,r.DisableTab=!0,r.Width=120,a.PstDocGrid.Columns.push(r),r=new D.a,r.Header="Status",r.DisplayMember="Status",r.ReadOnly=!0,r.DisableTab=!0,r.Width=120,a.PstDocGrid.Columns.push(r),a.PstDocGrid.Width="450",a.PstDocGrid.Table=[],a.PstDocGrid.TableColumns.push("ModifiedBy"),a.PstDocGrid.TableColumns.push("ModifiedDate"),a.PstDocGrid.TableColumns.push("Status");for(let t=0;t<i.Tables[0].length;t++){let e=a.PstDocGrid.NewRow();if(e.ModifiedBy=i.Tables[0][t].ModifiedBy.toString(),n.e.IsEmpty(i.Tables[0][t].ModifiedDate)){if(n.e.IsEmpty(i.Tables[0][t].CreatedDate))continue;e.ModifiedDate=new Date(i.Tables[0][t].CreatedDate.toString()).ToString(s.a.SessionManager.Preferences["Date Format"]+" hh:mm:ss tt")}else e.ModifiedDate=new Date(i.Tables[0][t].ModifiedDate.toString()).ToString(s.a.SessionManager.Preferences["Date Format"]+" hh:mm:ss tt");e.Status=i.Tables[0][t].Status.toString(),a.PstDocGrid.addRow(e)}s.a.page.ShowDialog(a,e,{Title:a.DisplayName,HideClose:!0,ShowCenter:!0})}}else if("Suspend"==t.toString())if(this.resTerm="NO",95==this.CurrCostCenterID){if(confirm(" Are you sure you want to Cancel Contract ? ")){let t=0;s.a.rental.CancelContract(this.ContractID).subscribe(e=>{this.DisplayMessage=e.Message,t=e.RetValue,t>0&&(this.ClearData(),this.RefershPage(),Logger.InfoLog("AddEditRenContractViewModel :: Exiting OnSaveContract")),this.MessageVisibility=!0,Logger.InfoLog("AddEditRenContractViewModel :: Entering OnSaveContract ")},t=>{alert(JSON.stringify(t)),console.log("SaveContract : "+JSON.stringify(t))})}}else 103==this.CurrCostCenterID?confirm(" Are you sure you want to Cancel Quotation ? ")&&(this.RefundDate=new b.a,this.RefundDate.Label=s.a.GetResource("Date"),this.RefundDate.DBColumnName="RefundDate",this.RefundDate.Date=new Date,this.RefundDate.Row=0,this.RefundDate.Column=0,this.SuspendVisiblity=!0,this.CloseVisiblity=!1,s.a.page.ShowDialog(this,q.a,{Title:"Suspend"})):confirm(" Are you sure you want to Cancel Reservation ? ")&&(null==this.ContractNumber.ComboBox.SelectedItem&&(this.ContractNumber.ComboBox.SelectedItem=this.ContractNumber.ComboBox.Items.find(t=>t.Value==this.ContractNumber.ComboBox.SelectedValue)),this.strContractNo=this.ContractNumber.ComboBox.SelectedItem.Name+"~"+this.ContractNumber.TextBox.Text.Trim(),this.TerminateContracts=new E(this,this.ContractID,this.strContractNo,4),this.DeleteVisibility=!0,this.resTerm="",this.TerminateContracts.parent=this,s.a.page.ShowDialog(this.TerminateContracts,O.a,{Title:this.TerminateContracts.Title}));else if("RefundVisiblity"==t.toString())null==this.ContractNumber.ComboBox.SelectedItem&&(this.ContractNumber.ComboBox.SelectedItem=this.ContractNumber.ComboBox.Items.find(t=>t.Value==this.ContractNumber.ComboBox.SelectedValue)),this.strContractNo=this.ContractNumber.ComboBox.SelectedItem.Name+"~"+this.ContractNumber.TextBox.Text.Trim(),this.TerminateContracts=new E(this,this.ContractID,this.strContractNo,3),this.DeleteVisibility=!0,this.TerminateContracts.parent=this,s.a.page.ShowDialog(this.TerminateContracts,O.a,{Title:this.TerminateContracts.Title});else if("Fullrefund"==t.toString())this.resTerm="",confirm(" Are you sure you want Full Refund? ")&&(this.strContractNo=this.ContractNumber.ComboBox.SelectedItem.Name+"~"+this.ContractNumber.TextBox.Text.Trim(),this.TerminateContracts=new E(this,this.ContractID,this.strContractNo,5),this.DeleteVisibility=!0,s.a.page.ShowDialog(this.TerminateContracts,O.a,{Title:this.TerminateContracts.Title}));else if("VacantVisiblity"==t.toString())129==this.CurrCostCenterID?(this.resTerm="NO",confirm(" Are you sure you want to Close Reservation ? ")&&(this.SuspendVisiblity=!1,this.CloseVisiblity=!0,this.VacancyDate=new b.a,this.VacancyDate.Label=s.a.GetResource("Close Date"),this.VacancyDate.DBColumnName="CloseDate",this.VacancyDate.Date=new Date,s.a.page.ShowDialog(this,q.a,{Title:"Close Reservation"}))):(null==this.ContractNumber.ComboBox.SelectedItem&&(this.ContractNumber.ComboBox.SelectedItem=this.ContractNumber.ComboBox.Items.find(t=>t.Value==this.ContractNumber.ComboBox.SelectedValue)),this.strContractNo=this.ContractNumber.ComboBox.SelectedItem.Name+"~"+this.ContractNumber.TextBox.Text.Trim(),this.TerminateContracts=new E(this,this.ContractID,this.strContractNo,2),this.DeleteVisibility=!0,this.TerminateContracts.parent=this,s.a.page.ShowDialog(this.TerminateContracts,O.a,{Title:this.TerminateContracts.Title}));else if("Report"==t.toString())this.SetVisibilityFalse(),this.ReportInfoVisibility=!0,s.a.page.ShowDialog(this,W.a,{Title:"Reports"});else if("UnitStatus"==t.toString())s.a.page.ShowDialog(this,j.a,{Title:"Change Unit Status"}),this.SetVisibilityFalse(),this.StatusVisiblity=!0;else if("RejectVisiblity"==t.toString())if("465"==this.StatusID.SelectedValue){this.cntrct.ContractID=this.ContractID;let t=0;s.a.rental.ApproveContractDocs(this.CostCenterID,!0,"",this.cntrct.ContractID).subscribe(e=>{this.DisplayMessage=e.Message,this.MessageVisibility=!0,t=e.RetValue,t>0&&(this.BtnApprove.Visible=!1,this.RejectVisiblity=!1,this.ClearData(),this.RefershPage(),Logger.InfoLog("AddEditRenContractViewModel :: Exiting terminate approval")),this.SetVisibilityFalse(),this.RejectVisiblity=!0,this.SaveapproveVisiblity=!!s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Save Contracts on approve"),this.RejectRemarks="",Logger.InfoLog("AddEditRenContractViewModel :: terminate approval ")},t=>{alert(JSON.stringify(t)),console.log("SaveContract : "+JSON.stringify(t))})}else this.SetVisibilityFalse(),this.RejectVisiblity=!0,this.RejectRemarks="",s.a.page.ShowDialog(this,x.a,{Title:s.a.GetResource("ApproveReject"),ShowCenter:!0});else if("Cancel"==t.toString())s.a.page.HideDialog(),this.SetVisibilityFalse();else if("ChangeStatus"==t.toString())n.e.StringIsNullOrEmpty(this.UnitStatus.SelectedValue)||(""!=this.SelectedUnits?this.DisplayMessage=s.a.rental.ChangeStatus(this.UnitStatus.SelectedValue,this.SelectedUnits):this.Unit.SelectedValue>0&&(this.DisplayMessage=s.a.rental.ChangeStatus(this.UnitStatus.SelectedValue,this.Unit.SelectedValue.toString())),this.MessageVisibility=!0);else if("Clone"==t.toString())this.Clone();else if("Renew"==t.toString()||"AutoRenew"==t.toString()){let a=0;if(95==this.CostCenterID&&"AutoRenew"!=t.toString()){let t=!1,e=[]=this.ScreenObject.Data.Tables[5].filter(t=>"DonotRenewOnDue"==t.Name);e.length>0&&(t=Object(r.j)(e[0].Value.toString()));let i=s.a.rental.GetContractBalance(this.CostCenterID,this.ContractID);if(!n.e.IsEmpty(i)&&i.length>0&&(a=n.e.DoubleTryParse(i[0].Balance.toString())),t&&a>0)return this.DisplayMessage="Cannot Renew Contract, Amount Due : "+a,void(this.MessageVisibility=!0)}let h="",D="";if("AutoRenew"==t.toString()?D="Yes":h=a>0?"  Amount Due : "+a+".  Do you really want to Renew this Contract? ":"  Do you really want to Renew this Contract?",confirm(h)||"Yes"==D){this.IsRecurPosted=!1,this.TotalYears.IsReadOnly=this.Months.IsReadOnly=this.RecurDuration.IsReadOnly=this.ContractDate.IsReadOnly=this.StartDate.IsReadOnly=this.EndDate.IsReadOnly=!1,this.RenewRefID=this.ContractID,this.ContractID=0,this.ParticularsBodyReadOnly=!1,this.CheckViewForUser(this.ContractID);let t=this.NoofCheques,a=this.InstPeriod,h=this.FirstNumber,D=this.PayeeBnk,u=this.DebitAcc,C=this.DebitName;if(this.Property.Enable=!1,this.Unit.Enable=!1,this.Tenant.Enable=!1,e=this.StartDate.Date?this.EndDate.Date.Subtract(this.StartDate.Date).Days+1:this.EndDate.Date.Subtract(this.EndDate.Date).Days+1,n.e.IsLeapYear(this.EndDate.Date.getFullYear())){let t=new Date(this.EndDate.Date.getFullYear(),1,29);t>this.StartDate.Date&&t<this.EndDate.Date&&(e=(parseInt(e)-1).toString())}else if(n.e.IsLeapYear(this.StartDate.Date.getFullYear())){let t=new Date(this.StartDate.Date.getFullYear(),1,29);t>this.StartDate.Date&&t<this.EndDate.Date&&(e=(parseInt(e)-1).toString())}let m=s.a.rental.GetNextContractNo(this.CurrCostCenterID,this.ParentContractID);if(this.SlNO.Text=m,this.ContractNumber.TextBox.Text=(parseInt(this.ContractNumber.TextBox.Text)+1).toString(),this.StartDate.Date=this.EnableGracePeriod&&this.ExpectedEndDate.Date?this.ExpectedEndDate.Date.AddDays(1):this.EndDate.Date.AddDays(1),""!=e&&this.StartDate.Date?this.EndDate.Date=this.StartDate.Date.AddDays(parseInt(e)-1):""!=e&&(this.EndDate.Date=(new Date).AddDays(parseInt(e)-1)),this.ContractDate.Date=new Date,this.stDate=this.StartDate.Date?this.StartDate.Date:new Date,this.strRenew="Renew",this.NoofCheques=t,this.InstPeriod=a,this.FirstNumber=h,this.PayeeBnk=D,this.DebitAcc=u,this.DebitName=C,this.StatusID.SelectedValue="427",this.ViewAttachments.AttachmentsList.length>0){var i=this.ScreenObject.Data.Tables[5].find(t=>"CopyAttachRenew"==t.Name);if(i.length>0&&""!=i[0].Value.toString()&&Object(r.j)(i[0].Value.toString()))for(let t=0;t<this.ViewAttachments.AttachmentsList.length;t++)this.ViewAttachments.AttachmentsList[t].AttachmentID=0;else this.ViewAttachments.AttachmentsList.Clear()}95==this.CostCenterID&&this.IsExtended.Enable?(this.IsExtended.Visible=!0,this.IsExtended.SelectedValue="false"):this.IsExtended.Visible&&(this.IsExtended.Visible=!1),this.dsPart=104==this.CurrCostCenterID?this.StartDate.Date&&this.EndDate.Date?s.a.rental.GetParticularsDetails(this.RenewRefID,0,this.Property.SelectedValue,this.StartDate.Date,this.EndDate.Date,2,this.ContractID,""):this.StartDate.Date?s.a.rental.GetParticularsDetails(this.RenewRefID,0,this.Property.SelectedValue,this.StartDate.Date,new Date,2,this.ContractID,""):s.a.rental.GetParticularsDetails(this.RenewRefID,0,this.Property.SelectedValue,new Date,this.EndDate.Date?this.EndDate.Date:new Date,2,this.ContractID,""):this.StartDate.Date&&this.EndDate.Date?s.a.rental.GetParticularsDetails(this.RenewRefID,this.Unit.SelectedValue,0,this.StartDate.Date,this.EndDate.Date,1,this.ContractID,this.SelectedUnits):this.StartDate.Date?s.a.rental.GetParticularsDetails(this.RenewRefID,this.Unit.SelectedValue,0,this.StartDate.Date,new Date,1,this.ContractID,this.SelectedUnits):s.a.rental.GetParticularsDetails(this.RenewRefID,this.Unit.SelectedValue,0,new Date,this.EndDate.Date?this.EndDate.Date:new Date,1,this.ContractID,this.SelectedUnits),""!=this.SelectedUnits&&this.multiVisi&&(this.SelectedUnits.Contains(",")?n.e.StringIsNullOrEmpty(this.SlNO.Text)||(this.StrMultiple.Contains(":")&&(this.StrMultiple=this.StrMultiple.Replace(this.StrMultiple.lastIndexOf(":"),"")),this.StrMultiple=this.StrMultiple+" :"+this.SlNO.Text):(this.multiVisi=!1,this.Unit.SelectedValue=parseInt(this.SelectedUnits),this.StrMultiple="",this.SelectedUnits=""));for(let e=1;e<this.DataTable.length;e++)this.DataTableObj.removeRowAt(e),e--;if(null!=this.dsPart&&this.dsPart.Tables.length>0){let t=this.dsPart.Tables[6];null!=t&&t.length>0&&null!=t[0].ccnid70&&(this.Vattype=n.e.IntTryParse(t[0].ccnid70.toString()))}if(null!=this.dsPart&&this.dsPart.Tables.length>0&&this.dsPart.Tables[0].length>0){let t=this.dsPart.Tables[0];t=t.filter(t=>2==t.Type||3==t.Type);let e=this.DataTableObj.NewRow();e=this.FillUnitDetails(e,t,this.dsPart)}else if(null!=this.dsPart&&this.dsPart.Tables.length>1&&this.dsPart.Tables[1].length>0){let t=this.dsPart.Tables[1];if(t=this.dsPart.Columns[1].Contains("UnitID")?t.filter(t=>2==t.Type||3==t.Type&&0==t.UnitID||t.UnitID==this.Unit.SelectedValue):t.filter(t=>2==t.Type||3==t.Type),t.length>0){let e=this.DataTableObj.NewRow();e=this.FillUnitDetails(e,t,this.dsPart)}else this.VatCalcOnRenew(!0)}else this.VatCalcOnRenew(!0);this.DataTable.length>0&&(this.DataTable[0].Status=null,this.DataTable[0].DocPrefix=null,this.DataTable[0].DocNumber=null,this.DataTable[0].CostCenterID=null,this.DataTable[0].DocumentNo=null,this.DataTable[0].DocID=null,this.DataTable[0].TempCCID_Key=null,this.DataTable[0].TempCCID=null,this.DataTable[0].DocumentName=null,this.DataTable[0].Xml=null,(50002==this.DimCCID&&this.DataTableColumns.Contains("Dim_Key")&&null!=this.dsPart&&this.dsPart.Columns[6].Contains("Dimname")&&this.dsPart.Tables[6].length>0&&"0"!=this.dsPart.Tables[6][0].DimNodeID.toString()||this.DataTableColumns.Contains("Dim_Key")&&null!=this.dsPart&&this.dsPart.Columns[6].Contains("Dimname")&&this.dsPart.Tables[6].length>0&&"0"!=this.dsPart.Tables[6][0].DimNodeID.toString())&&(this.DataTable[0].Dim_Key=this.dsPart.Tables[6][0].DimNodeID.toString(),this.DataTable[0].Dim=this.dsPart.Tables[6][0].Dimname.toString())),this.PayTermsDataTableObj.Table.Clear(),this.PayTermsDataTableObj.refreshDataView(),this.CalculateRentBaedOnDays(0,!1);let S=s.a.rental.GetRenewDetails(this.RenewRefID);if(!n.e.IsEmpty(S)&&S.Tables.length>2&&S.Tables[2].length>0&&S.Columns[2].Contains("ParentRefID")&&!n.e.IsEmpty(S.Tables[2][0].ParentRefID)&&parseInt(S.Tables[2][0].ParentRefID.toString())>0&&(this.ParentContractID=parseInt(S.Tables[2][0].ParentRefID.toString()),this.RefNo.Text=S.Tables[2][0].ParentSno.toString()),!n.e.IsEmpty(S)&&S.Tables.length>0&&S.Tables[0].length>0&&S.Columns[0].Contains("NodeID")){let t=0;for(let e=0;e<this.DataTable.length;e++){if(!n.e.IsEmpty(this.DataTable[e].NodeID))continue;let a=[]=S.Tables[0].filter(t=>t.CCNodeID==this.DataTable[e].NodeID.toString());if(a.length>0&&!n.e.IsEmpty(a[0].Detailsxml)){let i,r=new n.f;if(r.LoadXml(a[0].Detailsxml.toString()),null!=r)if(this.multiVisi&&""!=this.SelectedUnits&&r.DocumentElement.children.length>0&&null!=r.DocumentElement.children[0].attributes&&null!=r.DocumentElement.children[0].attributes.Filter&&!n.e.StringIsNullOrEmpty(r.DocumentElement.children[0].attributes.Filter)&&"0"==r.DocumentElement.children[0].attributes.Filter){var l=r.SelectNodes("XML/UnitsRow/Row");let a=0,o=0,c="";c+='<XML Filter="1" >';for(let e=0;e<l.length;e++){let s=l[e];null!=s.attributes.FromDate&&!n.e.StringIsNullOrEmpty(s.attributes.FromDate)&&n.e.isValidDate(s.attributes.FromDate)&&i==this.StartDate.Date&&(i=s.attributes.FromDate,null==s.attributes.Period||n.e.StringIsNullOrEmpty(s.attributes.Period)||(t=parseInt(s.attributes.Period)),a+=parseFloat(s.attributes.Amount),null==s.attributes.Discount||n.e.StringIsNullOrEmpty(s.attributes.Discount)||(o+=parseFloat(s.attributes.Discount)),c+="<Row ",c+='Unit="'+s.attributes.Unit+'" ',null==s.attributes.Period||n.e.StringIsNullOrEmpty(s.attributes.Period)||(c+='Period="'+s.attributes.Period+'" '),c+='Amount="'+s.attributes.Amount+'"/>')}c+="</XML>",this.DataTable[e].Amount=this.RentAmt,this.DataTable[e].NodeID.toString()==this.id2.toString()&&(this.DataTable[e].Discount=o.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()),this.DataTable[e].ActAmount=(a+o).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString())),this.DataTable[e].Xml=c.toString()}else{l=r.SelectNodes("XML/Row");for(let a=0;a<l.length;a++){let s=l[a];null!=s.attributes.FromDate&&!n.e.StringIsNullOrEmpty(s.attributes.FromDate)&&n.e.isValidDate(s.attributes.FromDate)&&i==this.StartDate.Date&&(i=s.attributes.FromDate,null==s.attributes.Period||n.e.StringIsNullOrEmpty(s.attributes.Period)||(t=parseInt(s.attributes.Period)),this.DataTable[e].Amount=parseFloat(s.attributes.Amount),this.DataTable[e].NodeID.toString()==this.id2.toString()&&(null==s.attributes.Discount||n.e.StringIsNullOrEmpty(s.attributes.Discount)?(this.DataTable[e].Discount=0,this.DataTable[e].ActAmount=parseFloat(s.attributes.Amount)):(this.DataTable[e].Discount=s.attributes.Discount,this.DataTable[e].ActAmount=parseFloat(this.DataTable[e].Discount)+parseFloat(this.DataTable[e].Amount))))}}}}for(let e=0;e<S.Tables[1].length;e++){if(t>0&&!n.e.IsEmpty(S.Tables[1][e].Period)&&parseInt(S.Tables[1][e].Period.toString())!=t)continue;if(this.EndDate.Date&&this.StartDate.Date&&!n.e.IsEmpty(S.Tables[1][e].ChequeDate)&&(new Date(S.Tables[1][e].ChequeDate.toString())>this.EndDate.Date||new Date(S.Tables[1][e].ChequeDate.toString())<this.StartDate.Date))continue;let a=this.PayTermsDataTableObj.NewRow();a.ChequeNo=S.Tables[1][e].ChequeNo.toString(),this.InclPostingDate&&S.Columns[1].Contains("PostingDate")&&!n.e.IsEmpty(S.Tables[1][e].PostingDate)&&(a.PostingDate=new Date(S.Tables[1][e].PostingDate).ToString(s.a.SessionManager.Preferences["Date Format"]),a.PostingDate_Key=new Date(S.Tables[1][e].PostingDate)),n.e.IsEmpty(S.Tables[1][e].ChequeDate)||(a.CntrlDate=new Date(S.Tables[1][e].ChequeDate).ToString(s.a.SessionManager.Preferences["Date Format"])),a.CntrlDate_Key=S.Tables[1][e].ChequeDate.toString();let i=0;i=n.e.IntTryParse(S.Tables[1][e].CustomerBank.toString()),i>=0&&(a.PayeeBank=i.toString()),a.Narration="",a.DebitAccountID_Key=S.Tables[1][e].DebitAccID.toString(),a.Narration=S.Tables[1][e].Narration.toString(),a.DebitAccountID=S.Tables[1][e].DebitAccName.toString(),a.Period=S.Tables[1][e].Period.toString(),null!=S.Tables[1][e].Amount&&null!=S.Tables[1][e].Amount&&(a.Amount=parseFloat(S.Tables[1][e].Amount).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString())),this.PayTermsDataTable.push(a)}}this.RefreshGrid=!this.RefreshGrid,this.CalculateFooter();for(let e=0;e<6;e++){let t=this.DataTableObj.NewRow();t.Recurr=!1,this.DataTableObj.addRow(t);let e=this.PayTermsDataTableObj.NewRow();this.PayTermsDataTableObj.addRow(e)}this.ButtonSaveAndPrint.Enable=this.ButtonSave.Enable=!0,s.a.SessionManager.HideUnathorizedAccess?this.ButtonSaveAndPrint.Visible=this.ButtonSave.Visible=s.a.SessionManager.IsActionAssigned(this.CurrCostCenterID,"Create"):this.ButtonSaveAndPrint.Enable=this.ButtonSave.Enable=s.a.SessionManager.IsActionAssigned(this.CurrCostCenterID,"Create"),this.ButtonRenew.Enable=!1,this.ButtonTerminate.Enable=!1,this.BtnApprove.Visible=!1;let b=this.GetButton("Reject");null!=b&&(b.Visible=!1),this.ButtonSuspend.Visible=!1,this.ButtonRefund.Visible=!1,this.BtnFullRefund.Visible=!1,this.ButtonVacant.Visible=!1,this.SetButtonVisibility("Suspend",!1),this.SetButtonVisibility("RefundVisiblity",!1),this.SetButtonVisibility("Vacant",!1),this.SetButtonVisibility("Fullrefund",!1);let d=[];var c=this.ScreenObject.Data.Tables[5].filter(t=>"RenewFields"==t.Name);c.length>0&&c[0].Value.toString().length>0&&(d=c[0].Value.toString().split(",")),null!=d&&d.length>0&&this.ScreenObject.CustomTab.Pages.forEach(t=>{t.Fields.forEach(t=>{t instanceof o.c&&d.Contains(t.DBColumnName)&&this.ScreenObject.SetProperty_DefaultValue(t)})})}}else if("Terminate"==t.toString())this.resTerm="NO",confirm(" Do you really want to Terminate this Contract.? ")&&(null==this.ContractNumber.ComboBox.SelectedItem&&(this.ContractNumber.ComboBox.SelectedItem=this.ContractNumber.ComboBox.Items.find(t=>t.Value==this.ContractNumber.ComboBox.SelectedValue)),this.strContractNo=this.ContractNumber.ComboBox.SelectedItem.Name+"~"+this.ContractNumber.TextBox.Text.Trim(),this.TerminateContracts=new E(this,this.ContractID,this.strContractNo,1),this.DeleteVisibility=!0,this.resTerm="",this.TerminateContracts.parent=this,s.a.page.ShowDialog(this.TerminateContracts,O.a,{Title:this.TerminateContracts.Title}));else if("CancelTerminate"==t.toString())if(this.resTerm="NO",129==this.CurrCostCenterID){if(confirm(" Do you really want to Cancel the Closed Reservation?")){let t=0;s.a.rental.CancelClosedReservation(this.ContractID).subscribe(e=>{this.DisplayMessage=e.Message,t=e.RetValue,t>0&&(this.ClearData(),Logger.InfoLog("AddEditRenContractViewModel :: Exiting OnSaveContract")),this.MessageVisibility=!0,Logger.InfoLog("AddEditRenContractViewModel :: Entering OnSaveContract ")},t=>{alert(JSON.stringify(t)),console.log("SaveContract : "+JSON.stringify(t))})}}else{let t=" Do you really want to Cancel ";if(t+="450"==this.StatusID.SelectedValue||"477"==this.StatusID.SelectedValue?"Refund?":"480"==this.StatusID.SelectedValue||"481"==this.StatusID.SelectedValue?"Close?":"Termination?",confirm(t)){let t=0;s.a.rental.CancelTermination(this.CurrCostCenterID,this.ContractID).subscribe(e=>{this.DisplayMessage=e.Message,t=e.RetValue,t>0&&(this.ClearData(),this.RefershPage(),Logger.InfoLog("AddEditRenContractViewModel :: Exiting OnSaveContract")),this.MessageVisibility=!0,Logger.InfoLog("AddEditRenContractViewModel :: Entering OnSaveContract ")},t=>{alert(JSON.stringify(t)),console.log("SaveContract : "+JSON.stringify(t))})}}else if("Approve"==t.toString()){let t=!0,e=this.ScreenObject.Data.Tables[5].filter(t=>"CommentsMandatoryforApprove"==t.Name);if(e.length>0&&(t=Object(r.j)(e[0].Value.toString())),t&&n.e.IsEmpty(this.RejectRemarks))return this.DisplayMessage="Enter Remarks",void(this.MessageVisibility=!0);let a=this.ContractID;"465"!=this.StatusID.SelectedValue&&"481"!=this.StatusID.SelectedValue&&"479"!=this.StatusID.SelectedValue&&"478"!=this.StatusID.SelectedValue&&s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Save Contracts on approve")&&this.OnSave("Save"),this.cntrct.ContractID=a;let i=0;s.a.rental.ApproveContractDocs(this.CostCenterID,!0,this.RejectRemarks,this.cntrct.ContractID).subscribe(t=>{if(this.DisplayMessage=t.Message,this.MessageVisibility=!0,i=t.RetValue,i>0){this.BtnApprove.Visible=!1;var e=this.GetButton("Reject");null!=e&&(e.Visible=!1),this.BtnApprove.Visible=!1,this.RejectVisiblity=!1,this.ClearData(),this.RefershPage(),Logger.InfoLog("AddEditRenContractViewModel :: Exiting Approve")}this.SetVisibilityFalse(),this.RejectVisiblity=!0,this.RejectRemarks="",Logger.InfoLog("AddEditRenContractViewModel :: terminate Approve ")},t=>{alert(JSON.stringify(t)),console.log("SaveContract : "+JSON.stringify(t))})}else if("Reject"==t.toString()){let t=!0,e=this.ScreenObject.Data.Tables[5].filter(t=>"CommentsMandatoryforReject"==t.Name);if(e.length>0&&(t=Object(r.j)(e[0].Value.toString())),t&&n.e.IsEmpty(this.RejectRemarks))return this.DisplayMessage="Enter Remarks",void(this.MessageVisibility=!0);let a=this.ContractID;if("465"!=this.StatusID.SelectedValue&&s.a.SessionManager.IsActionAssigned(this.CostCenterID,"Save Contracts on approve")){let t,e={RetValue:t};if(this.OnSave("Save",e),0==e.RetValue)return}this.cntrct.ContractID=a;let i=0;s.a.rental.ApproveContractDocs(this.CostCenterID,!1,this.RejectRemarks,this.cntrct.ContractID).subscribe(t=>{if(this.DisplayMessage=t.Message,this.MessageVisibility=!0,i=t.RetValue,i>0){this.BtnApprove.Visible=!1;var e=this.GetButton("Reject");null!=e&&(e.Visible=!1),this.BtnApprove.Visible=!1,this.RejectVisiblity=!1,this.ClearData(),this.RefershPage(),Logger.InfoLog("AddEditRenContractViewModel :: Exiting Reject")}this.SetVisibilityFalse(),this.RejectVisiblity=!0,this.RejectRemarks="",Logger.InfoLog("AddEditRenContractViewModel :: terminate Reject ")},t=>{alert(JSON.stringify(t)),console.log("SaveContract : "+JSON.stringify(t))})}else if("ChangeLocation"==t.toString()){let t=new F.DocumentNumberViewModel(this,this.ScreenObject.Data.Tables[8],!0,null);t.DocumentNumberViewModel_1(this),s.a.page.ShowDialog(t,B.DocumentNumberComponent,{HideClose:!0,ShowCenter:!0,Title:s.a.GetResource("DocumentNumberTitle")})}else if("CheckUnits"==t.toString()){if(0==this.Property.SelectedValue)return this.DisplayMessage="Please select property",void(this.MessageVisibility=!0);if(0==this.Unit.SelectedValue)return this.DisplayMessage=s.a.GetResource("PleaseselectUnit"),void(this.MessageVisibility=!0);if(null==this.TotalDays.Text||""==this.TotalDays.Text||null!=this.TotalDays.Text&&""!=this.TotalDays.Text&&0==parseInt(this.TotalDays.Text))return this.DisplayMessage="Please select dates",void(this.MessageVisibility=!0);this.validateUnit()||(this.DisplayMessage="Unit available",this.MessageVisibility=!0)}Logger.InfoLog("AddEditRenContractViewModel ::Exiting OnCustomizeExtraFields")}))}Clone(){if(confirm(" Do you want to Clone this Contract? ")){this.IsRecurPosted=!1,this.TotalYears.IsReadOnly=this.Months.IsReadOnly=this.RecurDuration.IsReadOnly=this.ContractDate.IsReadOnly=this.StartDate.IsReadOnly=this.EndDate.IsReadOnly=!1,this.RenewRefID=0,this.ContractID=0,this.ParticularsBodyReadOnly=!1,this.CheckViewForUser(this.ContractID);let t=this.NoofCheques,e=this.InstPeriod,a=this.FirstNumber,i=this.PayeeBnk,r=this.DebitAcc,o=this.DebitName;this.SlNO.Text=this.cntrct.GetNextContractNo(this.CostCenterID,this.ParentContractID),this.ContractNumber.TextBox.Text=(parseInt(this.ContractNumber.TextBox.Text)+1).toString(),this.ContractDate.Date=new Date,this.stDate=this.StartDate.Date?this.StartDate.Date:new Date,this.strRenew="Save",this.CntStatus="[New]",this.NoofCheques=t,this.InstPeriod=e,this.FirstNumber=a,this.PayeeBnk=i,this.DebitAcc=r,this.DebitName=o,this.StatusID.SelectedValue="427",this.IsExtended.Visible&&(this.IsExtended.Visible=!1),""!=this.SelectedUnits&&this.multiVisi&&(this.SelectedUnits.Contains(",")?n.e.IsEmpty(this.SlNO.Text)||(this.StrMultiple.Contains(":")&&(this.StrMultiple=this.StrMultiple.Replace(this.StrMultiple.lastIndexOf(":"),"")),this.StrMultiple=this.StrMultiple+" :"+this.SlNO.Text):(this.multiVisi=!1,this.Unit.SelectedValue=parseInt(this.SelectedUnits),this.StrMultiple="",this.SelectedUnits=""));for(let s=0;s<this.DataTable.length;s++)this.DataTable[s].Status=null,this.DataTable[s].DocPrefix=null,this.DataTable[s].DocNumber=null,this.DataTable[s].CostCenterID=null,this.DataTable[s].DocumentNo=null,this.DataTable[s].DocID=null,this.DataTable[s].TempCCID_Key=null,this.DataTable[s].TempCCID=null,this.DataTable[s].DocumentName=null,this.DataTable[s].Xml=null,this.DataTableColumns.Contains("Dim_Key")&&null!=this.dsPart&&this.dsPart.Columns[6].Contains("Dimname")&&this.dsPart.Tables[6].length>0&&"0"!=this.dsPart.Tables[6][0].DimNodeID.toString()&&(this.DataTable[s].Dim_Key=this.dsPart.Tables[6][0].DimNodeID.toString(),this.DataTable[s].Dim=this.dsPart.Tables[6][0].Dimname.toString());this.PayTermsDataTableObj.Clear(),this.CalculateFooter();for(let s=0;s<6;s++){let t=this.DataTableObj.NewRow();t.Recurr=!1,this.DataTableObj.addRows(t);let e=this.PayTermsDataTableObj.NewRow();this.PayTermsDataTableObj.addRows(e)}this.ButtonSaveAndPrint.Enable=this.ButtonSave.Enable=!0,s.a.SessionManager.HideUnathorizedAccess?this.ButtonSaveAndPrint.Visible=this.ButtonSave.Visible=s.a.SessionManager.IsActionAssigned(this.CurrCostCenterID,"Create"):this.ButtonSaveAndPrint.Enable=this.ButtonSave.Enable=s.a.SessionManager.IsActionAssigned(this.CurrCostCenterID,"Create"),this.ContractExists=!1,this.ButtonRenew.Enable=!1,this.ButtonTerminate.Enable=!1,this.BtnApprove.Visible=!1;let l=this.GetButton("Reject");null!=l&&(l.Visible=!1),this.ButtonSuspend.Visible=!1,this.BtnFullRefund.Visible=this.ButtonRefund.Visible=!1,this.ButtonVacant.Visible=!1}}SetVisibilityFalse(){this.ActVisibility=!1,this.NoteVisibility=!1,this.DeleteVisibility=!1,this.AttachmentVisibility=!1,this.RefundVisiblity=!1,this.VacantVisiblity=!1,this.RejectVisiblity=!1,this.StatusVisiblity=!1,this.ReportInfoVisibility=!1,this.SuspendVisiblity=!1,this.CloseVisiblity=!1}FillExtraFields(t){var e=t.ScreenObject.GetCustomField("CCNID"+(t.DimWiseFields-5e4).toString());for(let i=0;i<t.ScreenObject.CustomTab.Pages.length;i++){const s=t.ScreenObject.CustomTab.Pages[i];for(let t=0;t<s.Fields.length;t++){const i=s.Fields[t];if(e!=i&&i instanceof o.c&&!n.e.StringIsNullOrEmpty(i.DBColumnName))if(i.DBColumnName.toLowerCase().Contains("alpha")){for(let t=0;t<this.ScreenObject.CustomTab.Pages.length;t++)if(null!=(a=this.ScreenObject.CustomTab.Pages[t].Fields.find(t=>t instanceof o.c&&t.Label.toLowerCase()==i.Label.toLowerCase()))&&null!=a){a instanceof l.b&&i instanceof l.b?i.SelectedValue=a.SelectedValue:a instanceof b.c&&i instanceof b.c?a.Date&&(i.Date=a.Date):i instanceof m.d||i instanceof m.c?a instanceof m.d||a instanceof m.c?i.Text=a.Text:a instanceof c.e?i.Text=a.SelectedValue:a instanceof v.a&&(i.Text=a.Text):(i instanceof c.e||i instanceof v.a)&&(a instanceof c.e?i.Text=a.SelectedValue:a instanceof v.a&&(i.Text=a.Text));break}}else if(i.DBColumnName.toLowerCase().Contains("ccnid")){var a;if(null==(a=this.ScreenObject.HeaderFields.find(t=>t instanceof l.b&&t.DBColumnName==i.DBColumnName)))for(let t=0;t<this.ScreenObject.CustomTab.Pages.length&&(null==(a=this.ScreenObject.CustomTab.Pages[t].Fields.find(t=>t instanceof l.b&&t.DBColumnName==i.DBColumnName))||null==a);t++);null!=a&&null!=a&&a instanceof l.b&&i instanceof l.b&&(i.SelectedValue=a.SelectedValue)}}}}Export(t){return Object(i.b)(this,void 0,void 0,(function*(){let e=0,a=0;"Print"==t&&"428"==this.StatusID.SelectedValue&&(e=1),"SaveAndPrint"==t&&428==this.SaveAndPrintStatusID&&(e=1),"Export"==t&&"428"==this.StatusID.SelectedValue&&(e=1),"Print"!=t||!this.DoNotPrintUnApprovedContracts||"440"!=this.StatusID.SelectedValue&&"465"!=this.StatusID.SelectedValue&&!this.IsUnapproveDocument(this.ContractID)?"SaveAndPrint"!=t||!this.DoNotPrintUnApprovedContracts||440!=this.SaveAndPrintStatusID&&465!=this.SaveAndPrintStatusID&&!this.IsUnapproveDocument(this.SaveAndPrintContactID)?"Export"!=t||!this.DoNotPrintUnApprovedContracts||"440"!=this.StatusID.SelectedValue&&"465"!=this.StatusID.SelectedValue&&!this.IsUnapproveDocument(this.ContractID)?("Export"==t?a=this.ContractID:"SaveAndPrint"==t?a=this.SaveAndPrintContactID:"Print"==t&&(a=this.ContractID),R.RibbonExtViewModel.PrintMaster(this,t,this.CostCenterID,a,e)):this.DisplayMessage="Un-Approved documents not allowed to export":this.DisplayMessage="Un-Approved documents not allowed to print":this.DisplayMessage="Un-Approved Documents not allowed to print"}))}IsUnapproveDocument(t){let e=s.a.empService.GetQueryData(t,"IsUnapproveDocument","","","");return 1==parseInt(e.Tables[0][0].IVAR)}TerminateContract(t,e,a,i,o){Logger.InfoLog("AddEditRenContractViewModel ::Entering TerminateContract");let l=0;this.cntrct.TerminationDate=new Date(a).ToString("dd/MMM/yyyy"),this.cntrct.UnitID=this.Unit.SelectedValue,this.cntrct.TenantID=this.Tenant.SelectedValue,this.cntrct.PropertyID=this.Property.SelectedValue,this.cntrct.ContractID=t,this.cntrct.RentRecID=this.RentRecAc.SelectedValue,this.TerminationDate=a,1!=i&&2!=i&&3!=i||(this.cntrct.TerminationPostDate=this.TermPosting?this.TerminateContracts.TerminationPostDate.Date:this.cntrct.TerminationDate);let c=s.a.rental.GetPostingDetails(this.cntrct,t,this.CurrCostCenterID,i,this.VatNode,this.InvCCID,this.cntrct.PropertyID,this.cntrct.UnitID,this.cntrct.TenantID,this.cntrct.RentRecID);if(null!=c&&c.Tables.length>0){this.ProductID=parseInt(c.Tables[0][0].PRODUCTID.toString()),this.GetCCData(c.Tables[0]),this.RefundAmt=0,null==this.dtTerm?this.dtTerm=[]:this.dtTerm.Clear(),this.SRTAmount=0,this.PDCRefund=0,this.VatAmt=0;let a=0,h=0;this.DiscReturn=0;let D=!1;n.e.IsEmpty(c.Tables[0][0].IsBillwise)||(D=Object(r.j)(c.Tables[0][0].IsBillwise.toString()));let u=this.EndDate.Date;if(this.IncomeAc.SelectedValue>0&&(this.cntrct.IncomeID=this.IncomeAc.SelectedValue),1==i)this.cntrct.StatusID=s.a.SessionManager.IsActionAssigned(this.CurrCostCenterID,"UnApproveOnTerminate")?465:428,this.cntrct.Reason=e,this.cntrct.PostPaymentXML=104==this.CurrCostCenterID?"":this.GetPaymentXML(D),this.cntrct.PostPDPaymentXML=this.GetPDPaymentXML(D,c),this.cntrct.PostPartPayXML=this.GetPartPaymentXML(D),this.cntrct.PostRentPayXML=!this.nomonthlyincome||!c.Columns[0].Contains("PostIncome")||n.e.IsEmpty(c.Tables[0][0].PostIncome)||"false"!=c.Tables[0][0].PostIncome.toString().toLowerCase()&&"0"!=c.Tables[0][0].PostIncome.toString().toLowerCase()?this.GetRentPaymentXML(c.Tables[2],!0,c.Columns[2]):this.GetRentPaymentXML(c.Tables[2],!1,c.Columns[2]);else if(2==i){let t,e={DonotUpdateAccounts:t},a=s.a.rental.GetVacancyDocumentType(this.CurrCostCenterID,"ContractVacantDocument",e);if(t=e.DonotUpdateAccounts,this.EnableGracePeriod&&this.ExpectedEndDate.Date&&(u=this.ExpectedEndDate.Date),0==a&&this.TerminateContracts.TerminationDate.Date!=u)return this.DisplayMessage="Define Vacancy Document",void(this.MessageVisibility=!0);let i=0;if(17==a?i=1:11==a&&(i=2),n.e.isValidDate(this.TerminateContracts.TerminationDate.Date)&&this.TerminateContracts.TerminationDate.Date.Date>u.Date){this.DisplayMessage="";let e={ActualRentofmnt:h};if(this.cntrct.PostRentPayXML=this.GetVacancyXml(i,c.Tables[0][0].VatAccID.toString(),u,t,e),h=e.ActualRentofmnt,h>0&&""!=this.DisplayMessage)return}else this.cntrct.PostRentPayXML=""}else 3==i&&(this.cntrct.PostRentPayXML="");if(2==i||3==i)for(let t=0;t<this.PayTermsDataTable.length;t++)null==this.PayTermsDataTable[t].DocStatusID||n.e.IsEmpty(this.PayTermsDataTable[t].DocStatusID)||"370"!=this.PayTermsDataTable[t].DocStatusID.toString()||n.e.IsEmpty(this.PayTermsDataTable[t].Amount)||(this.PDCRefund+=parseFloat(this.PayTermsDataTable[t].Amount.toString()));if(this.MessageVisibility=!1,this.cntrct.PostSalesRtnXML=!this.nomonthlyincome||!c.Columns[0].Contains("PostIncome")||n.e.IsEmpty(c.Tables[0][0].PostIncome)||"false"!=c.Tables[0][0].PostIncome.toString().toLowerCase()&&"0"!=c.Tables[0][0].PostIncome.toString().toLowerCase()?this.GetSRTXML(c.Tables[1],c.Tables[7],c.Tables[2],i,!0,c.Tables[0]):this.GetSRTXML(c.Tables[1],c.Tables[7],c.Tables[2],i,!1,c.Tables[0]),this.MessageVisibility)return;let C=this.SRTAmount+this.RefundAmt-this.PDCRefund-h;if(this.cntrct.RemaingPaymentXML=this.TerminateContracts.BankAccount.SelectedValue>0?this.GetRemaingPaymentXML(D):"",this.cntrct.WONO=this.strContractNo,!o){let e=new w(this,this.SRTAmount,this.RefundAmt,this.PDCRefund,C,h,this.VatAmt,i,u,c);s.a.page.ShowDialog(e,L.a,{ShowCenter:!0,NoWidth:!0,Title:e.DisplayName}).subscribe(()=>{e.result&&(this.DisplayMessage="",this.cntrct.PenaltyXml=this.GetPenaltyXML(e.DtExpensesObj.Table,c.Tables[0][0].VatAccID.toString(),c.Tables[0][0].PenAccID),""==this.cntrct.PenaltyXml&&""!=this.DisplayMessage||(this.cntrct.PenaltyParticulars=this.GetPenaltyParticulars(e.DtExpensesObj.Table,c.Tables[0][0].PenAccID),e.BalanceAmt>0?(this.VatAmt>0&&(e.BalanceAmt+=this.VatAmt),this.cntrct.RemaingPaymentXML=this.cntrct.RemaingPaymentXML.replace("##Balance##",e.BalanceAmt.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount).replace(",",""))):this.cntrct.RemaingPaymentXML="",a=e.Totpen,C=e.BalanceAmt,this.cntrct.GUID="GUID",this.cntrct.Wid=this.ScreenObject.CheckWorkFlow_1(1==i?7:9),o||1!=i&&2!=i&&3!=i||this.RenewSubContracts(i,t),1==i?s.a.rental.TerminateContract(this.cntrct,this.CurrCostCenterID,this.SRTAmount,this.RefundAmt,this.PDCRefund,a,C,this.TerminateContracts.BankAccount.SelectedValue,this.TerminateContracts.ChequeNo.Text,this.TerminateContracts.ChequeDate.Date,this.TerminateContracts.Remarks.Text).subscribe(t=>{this.DisplayMessage=t.Message,l=t.RetValue,l>0&&(this.ClearData(),this.RefershPage(),Logger.InfoLog("AddEditRenContractViewModel :: Exiting OnSaveContract")),this.MessageVisibility=!0,Logger.InfoLog("AddEditRenContractViewModel :: Entering OnSaveContract ")},t=>{alert(JSON.stringify(t)),console.log("SaveContract : "+JSON.stringify(t))}):s.a.rental.VacanctContract(this.cntrct,i,this.SRTAmount,this.RefundAmt,this.PDCRefund,a,C,this.TerminateContracts.BankAccount.SelectedValue,this.TerminateContracts.ChequeNo.Text,this.TerminateContracts.ChequeDate.Date,this.TerminateContracts.Remarks.Text,h).subscribe(t=>{this.DisplayMessage=t.Message,l=t.RetValue,l>0&&(this.ClearData(),this.RefershPage(),Logger.InfoLog("AddEditRenContractViewModel :: Exiting OnSaveContract")),this.MessageVisibility=!0,Logger.InfoLog("AddEditRenContractViewModel :: Entering OnSaveContract ")},t=>{alert(JSON.stringify(t)),console.log("SaveContract : "+JSON.stringify(t))})))})}}}BuildPayTermsGridData(){return Object(i.b)(this,void 0,void 0,(function*(){Logger.InfoLog("AddEditRenContractViewModel ::Entering BuildPayTermsGridData"),this.ContractPayTerms=[];let t,e=null,a=[];this.DocumentsGrid=new h.a,this.DocumentsGrid.Width="",this.DocumentsGrid.Columns=[],this.PayTermsDataTableObj.CanUserAddRows=!0,this.PayTermsDataTableObj.CanUserDeleteRows=!0,this.PayTermsDataTableObj.Clear(),this.PayTermsDataTableObj.ContextMenu.Items=[];let i=new D.b;i.Header="Copy",i.Tag="Copy",i.Click.Subscribe(this,"CmenuItem_Click"),this.PayTermsDataTableObj.ContextMenu.Items.push(i),i=new D.b,i.Header="Paste",i.Tag="Paste",i.Click.Subscribe(this,"CmenuItem_Click"),this.PayTermsDataTableObj.ContextMenu.Items.push(i),t=new D.a,t.Header="SNO",t.DisplayMember="SNO",t.DataType="TextBlock",t.ReadOnly=!0,t.Width=50,t.IsVisible=!0,a.push(t),this.InclPostingDate&&(t=new D.a,t.Header="PostingDate",t.DisplayMember="PostingDate",t.ValueMember="PostingDate_Key",t.DataType="DATE",t.Width=100,t.ReadOnly=!1,a.push(t)),t=new D.a,t.Header="Cheque No",t.DisplayMember="ChequeNo",t.DataType="TextBlock",e=this.ScreenObject.Data.Tables[0].filter(95==this.CurrCostCenterID||104==this.CurrCostCenterID?t=>"REN_ContractPayTerms"==t.SysTableName&&"ChequeNO"==t.SysColumnName:t=>"REN_QuotationPayTerms"==t.SysTableName&&"ChequeNO"==t.SysColumnName),e.length>0&&(t.Header=n.e.StringIsNullOrEmpty(e[0].ResourceData.toString())?e[0].UserColumnName.toString():e[0].ResourceData.toString(),t.Width=n.e.StringIsNullOrEmpty(""!=e[0].UIWidth)?parseInt(e[0].UIWidth):150,t.IsVisible=""==e[0].IsVisible.toString()||Object(r.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString(),t.DisplayIndex=n.e.StringIsNullOrEmpty(e[0].SectionSeqNumber.toString())?-1:parseInt(e[0].SectionSeqNumber)),t.ReadOnly=!1,a.push(t),t=new D.a,t.Header="Date",t.DisplayMember="CntrlDate",t.ValueMember="CntrlDate_Key",t.DataType="DATE",t.ReadOnly=!1,e=this.ScreenObject.Data.Tables[0].filter(95==this.CurrCostCenterID||104==this.CurrCostCenterID?t=>"REN_ContractPayTerms"==t.SysTableName&&"ChequeDate"==t.SysColumnName:t=>"REN_QuotationPayTerms"==t.SysTableName&&"ChequeDate"==t.SysColumnName),e.length>0&&(t.Header=n.e.StringIsNullOrEmpty(e[0].ResourceData.toString())?e[0].UserColumnName.toString():e[0].ResourceData.toString(),t.Width=n.e.StringIsNullOrEmpty(""!=e[0].UIWidth)?parseInt(e[0].UIWidth):150,t.IsVisible=!!n.e.IsEmpty(e[0].IsVisible)||Object(r.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString(),t.DisplayIndex=n.e.StringIsNullOrEmpty(e[0].SectionSeqNumber.toString())?-1:parseInt(e[0].SectionSeqNumber)),a.push(t),t=new D.a,t.ComboData=this.ScreenObject.Data.Tables[8],t.DisplayMember="PayNodeID",t.ValueMember="PayeeBank",t.ValueBinding="PayeeBank",t.DataType="ComboBox",t.Header="Payee Bank",e=this.ScreenObject.Data.Tables[0].filter(95==this.CurrCostCenterID||104==this.CurrCostCenterID?t=>"REN_ContractPayTerms"==t.SysTableName&&"PayeeBank"==t.SysColumnName:t=>"REN_QuotationPayTerms"==t.SysTableName&&"PayeeBank"==t.SysColumnName),e.length>0&&(t.Header=n.e.StringIsNullOrEmpty(e[0].ResourceData.toString())?e[0].UserColumnName.toString():e[0].ResourceData.toString(),t.Width=n.e.StringIsNullOrEmpty(""!=e[0].UIWidth)?parseInt(e[0].UIWidth):150,t.IsVisible=!!n.e.IsEmpty(e[0].IsVisible)||Object(r.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString(),t.DisplayIndex=n.e.StringIsNullOrEmpty(e[0].SectionSeqNumber.toString())?-1:parseInt(e[0].SectionSeqNumber)),a.push(t),t=new D.a,t.Header=104==this.CurrCostCenterID?"Credit A/c":"Debit A/c",t.DisplayMember="DebitAccountID",t.DataType="LISTBOX",t.CostCenterID=2,t.TypeID=100,e=this.ScreenObject.Data.Tables[0].filter(95==this.CurrCostCenterID||104==this.CurrCostCenterID?t=>"REN_ContractPayTerms"==t.SysTableName&&"DebitAccID"==t.SysColumnName:t=>"REN_QuotationPayTerms"==t.SysTableName&&"DebitAccID"==t.SysColumnName),e.length>0&&(t.TypeID=n.e.StringIsNullOrEmpty(e[0].ColumnCCListViewTypeID)?100:parseFloat(e[0].ColumnCCListViewTypeID),t.Header=n.e.StringIsNullOrEmpty(e[0].ResourceData)?e[0].UserColumnName.toString():e[0].ResourceData.toString(),t.Width=n.e.StringIsNullOrEmpty(""!=e[0].UIWidth)?parseInt(e[0].UIWidth):150,t.IsVisible=!!n.e.IsEmpty(e[0].IsVisible)||Object(r.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString(),t.DisplayIndex=n.e.StringIsNullOrEmpty(e[0].SectionSeqNumber)?-1:parseInt(e[0].SectionSeqNumber)),a.push(t),t=new D.a,t.Header="Amount",t.DisplayMember="Amount",t.DataType="FLOAT",t.ShowTotal=!0,t.IsCalculated=1,e=this.ScreenObject.Data.Tables[0].filter(95==this.CurrCostCenterID||104==this.CurrCostCenterID?t=>"REN_ContractPayTerms"==t.SysTableName&&"Amount"==t.SysColumnName:t=>"REN_QuotationPayTerms"==t.SysTableName&&"Amount"==t.SysColumnName),e.length>0&&(t.Header=n.e.StringIsNullOrEmpty(e[0].ResourceData.toString())?e[0].UserColumnName.toString():e[0].ResourceData.toString(),t.Width=n.e.StringIsNullOrEmpty(""!=e[0].UIWidth)?parseInt(e[0].UIWidth):150,t.IsVisible=!!n.e.IsEmpty(e[0].IsVisible)||Object(r.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString(),t.DisplayIndex=n.e.StringIsNullOrEmpty(e[0].SectionSeqNumber.toString())?-1:parseInt(e[0].SectionSeqNumber)),t.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinAmount.toString(),a.push(t),t=new D.a,t.Header="RentAmount",t.DisplayMember="RentAmount",t.DataType="FLOAT",e=this.ScreenObject.Data.Tables[0].filter(95==this.CurrCostCenterID||104==this.CurrCostCenterID?t=>"REN_ContractPayTerms"==t.SysTableName&&"RentAmount"==t.SysColumnName:t=>"REN_QuotationPayTerms"==t.SysTableName&&"RentAmount"==t.SysColumnName),e.length>0?(t.Header=n.e.StringIsNullOrEmpty(e[0].ResourceData.toString())?e[0].UserColumnName.toString():e[0].ResourceData.toString(),t.Width=n.e.StringIsNullOrEmpty(""!=e[0].UIWidth)?parseInt(e[0].UIWidth):150,t.IsVisible=!!n.e.IsEmpty(e[0].IsVisible)||Object(r.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString(),t.DisplayIndex=n.e.StringIsNullOrEmpty(e[0].SectionSeqNumber.toString())?-1:parseInt(e[0].SectionSeqNumber)):t.IsVisible=!1,t.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinAmount.toString(),a.push(t),t=new D.a,t.Header="Narration",t.DisplayMember="Narration",t.DataType="TextBlock",e=this.ScreenObject.Data.Tables[0].filter(95==this.CurrCostCenterID||104==this.CurrCostCenterID?t=>"REN_ContractPayTerms"==t.SysTableName&&"Narration"==t.SysColumnName:t=>"REN_QuotationPayTerms"==t.SysTableName&&"Narration"==t.SysColumnName),e.length>0&&(t.Header=n.e.StringIsNullOrEmpty(e[0].ResourceData.toString())?e[0].UserColumnName.toString():e[0].ResourceData.toString(),t.Width=n.e.StringIsNullOrEmpty(""!=e[0].UIWidth)?parseInt(e[0].UIWidth):150,t.IsVisible=!!n.e.IsEmpty(e[0].IsVisible)||Object(r.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString(),t.DisplayIndex=n.e.StringIsNullOrEmpty(e[0].SectionSeqNumber.toString())?-1:parseInt(e[0].SectionSeqNumber)),a.push(t),t=new D.a,t.Header="Period",t.ValueBinding="Period",t.DataType="ComboBox",t.DisplayMember="Name",t.ValueMember="Value",t.Width=100;let o=J.a.GetLookupData(31);if(null!=o){let e=[];for(let t=0;t<o.length;t++)e.push(c.d.ComboBoxItems_2(o[t].Name.toString(),o[t].NodeID.toString()));t.ComboData=e}if(e=this.ScreenObject.Data.Tables[0].filter(95==this.CurrCostCenterID||104==this.CurrCostCenterID?t=>"REN_ContractPayTerms"==t.SysTableName&&"Period"==t.SysColumnName:t=>"REN_QuotationPayTerms"==t.SysTableName&&"Period"==t.SysColumnName),e.length>0&&(t.Header=n.e.StringIsNullOrEmpty(e[0].ResourceData.toString())?e[0].UserColumnName.toString():e[0].ResourceData.toString(),t.Width=n.e.StringIsNullOrEmpty(""!=e[0].UIWidth)?parseInt(e[0].UIWidth):100,t.IsVisible=!!n.e.IsEmpty(e[0].IsVisible)||Object(r.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString(),t.DisplayIndex=n.e.StringIsNullOrEmpty(e[0].SectionSeqNumber.toString())?-1:parseInt(e[0].SectionSeqNumber)),a.push(t),t=new D.a,t.Header="Status",t.DisplayMember="Status",t.DataType="TextBlock",e=this.ScreenObject.Data.Tables[0].filter(95==this.CurrCostCenterID||104==this.CurrCostCenterID?t=>"REN_ContractPayTerms"==t.SysTableName&&"StatusID"==t.SysColumnName:t=>"REN_QuotationPayTerms"==t.SysTableName&&"StatusID"==t.SysColumnName),e.length>0&&(t.Header=n.e.StringIsNullOrEmpty(e[0].ResourceData.toString())?e[0].UserColumnName.toString():e[0].ResourceData.toString(),t.Width=n.e.StringIsNullOrEmpty(""!=e[0].UIWidth)?parseInt(e[0].UIWidth):150,t.IsVisible=!!n.e.IsEmpty(e[0].IsVisible)||Object(r.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString(),t.DisplayIndex=n.e.StringIsNullOrEmpty(e[0].SectionSeqNumber.toString())?-1:parseInt(e[0].SectionSeqNumber)),t.ReadOnly=!0,a.push(t),t=new D.a,t.Click.Subscribe(this,"OnMouseClick"),t.Header="Document No",t.DisplayMember="DocumentNo",t.DataType="LINK",e=this.ScreenObject.Data.Tables[0].filter(95==this.CurrCostCenterID||104==this.CurrCostCenterID?t=>"REN_ContractPayTerms"==t.SysTableName&&"DocID"==t.SysColumnName:t=>"REN_QuotationPayTerms"==t.SysTableName&&"DocID"==t.SysColumnName),e.length>0&&(t.Header=n.e.StringIsNullOrEmpty(e[0].ResourceData.toString())?e[0].UserColumnName.toString():e[0].ResourceData.toString(),t.Width=n.e.StringIsNullOrEmpty(""!=e[0].UIWidth)?parseInt(e[0].UIWidth):150,t.IsVisible=""==e[0].IsVisible.toString()||Object(r.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString(),t.DisplayIndex=n.e.StringIsNullOrEmpty(e[0].SectionSeqNumber.toString())?-1:parseInt(e[0].SectionSeqNumber)),a.push(t),t=new D.a,t.Header="TillDate",t.DisplayMember="TillDate",t.ValueMember="TillDate_Key",t.DataType="DATE",t.ReadOnly=!1,e=this.ScreenObject.Data.Tables[0].filter(95==this.CurrCostCenterID||104==this.CurrCostCenterID?t=>"REN_ContractPayTerms"==t.SysTableName&&"TillDate"==t.SysColumnName:t=>"REN_QuotationPayTerms"==t.SysTableName&&"TillDate"==t.SysColumnName),e.length>0?(t.Header=n.e.StringIsNullOrEmpty(e[0].ResourceData.toString())?e[0].UserColumnName.toString():e[0].ResourceData.toString(),t.Width=n.e.StringIsNullOrEmpty(""!=e[0].UIWidth)?parseInt(e[0].UIWidth):150,t.IsVisible=""==e[0].IsVisible.toString()||Object(r.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString(),t.DisplayIndex=n.e.StringIsNullOrEmpty(e[0].SectionSeqNumber.toString())?-1:parseInt(e[0].SectionSeqNumber)):t.IsVisible=!1,a.push(t),t=new D.a,t.Click.Subscribe(this,"OnMouseClick"),t.Header="Particular",t.DisplayMember="Particulars",t.ValueMember="Particulars_Key",t.DataType="LISTBOX",t.CostCenterID=parseInt(s.a.SessionManager.Preferences.DepositLinkDimension),t.TypeID=1,e=this.ScreenObject.Data.Tables[0].filter(95==this.CurrCostCenterID?t=>"REN_ContractPayTerms"==t.SysTableName&&"Particular"==t.SysColumnName:t=>"REN_QuotationPayTerms"==t.SysTableName&&"Particular"==t.SysColumnName),e.length>0?(t.Header=n.e.StringIsNullOrEmpty(e[0].ResourceData.toString())?e[0].UserColumnName.toString():e[0].ResourceData.toString(),t.Width=""!=e[0].UIWidth?parseInt(e[0].UIWidth):150,t.IsVisible=""==e[0].IsVisible.toString()||Object(r.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString(),t.DisplayIndex=n.e.StringIsNullOrEmpty(e[0].SectionSeqNumber.toString())?-1:parseInt(e[0].SectionSeqNumber)):t.IsVisible=!1,a.push(t),95!=this.CurrCostCenterID&&104!=this.CurrCostCenterID||(t=new D.a,t.Header="Temporary Status",t.DisplayMember="TempCCID",t.DataType="LISTBOX",t.CostCenterID=this.TempCCID,t.TypeID=1,e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_ContractPayTerms"==t.SysTableName&&"TemporaryStatus"==t.SysColumnName),e.length>0&&(t.Header=n.e.StringIsNullOrEmpty(e[0].ResourceData.toString())?e[0].UserColumnName.toString():e[0].ResourceData.toString(),t.Width=n.e.StringIsNullOrEmpty(""!=e[0].UIWidth)?parseInt(e[0].UIWidth):150,t.IsVisible=""==e[0].IsVisible.toString()||Object(r.j)(e[0].IsVisible),t.ID=e[0].CostCenterColID.toString(),t.DisplayIndex=n.e.StringIsNullOrEmpty(e[0].SectionSeqNumber.toString())?-1:parseInt(e[0].SectionSeqNumber)),a.push(t)),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_ContractPayTerms"==t.SysTableName&&"LocationID"==t.SysColumnName),e.length>0&&""!=e[0].IsVisible.toString()&&Object(r.j)(e[0].IsVisible)&&(t=new D.a,t.Header=e[0].ResourceData.toString(),t.DisplayMember="Location",t.ValueMember="Location_Key",t.Mandatory=""!=e[0].IsMandatory.toString()&&Object(r.j)(e[0].IsMandatory),t.DataType="LISTBOX",t.CostCenterID=this.LocationContract.CCID,t.TypeID=this.LocationContract.TypeID,t.Header=n.e.StringIsNullOrEmpty(e[0].ResourceData.toString())?e[0].UserColumnName.toString():e[0].ResourceData.toString(),t.Width=n.e.StringIsNullOrEmpty(""!=e[0].UIWidth)?parseInt(e[0].UIWidth):150,t.ID=e[0].CostCenterColID.toString(),t.DisplayIndex=n.e.StringIsNullOrEmpty(e[0].SectionSeqNumber.toString())?-1:parseInt(e[0].SectionSeqNumber),a.push(t),this.PayTermsDataTableColumns.push("Location"),this.PayTermsDataTableColumns.push("Location_Key")),this.DimCCID>5e4){if(e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_ContractPayTerms"==t.SysTableName&&t.SysColumnName.startsWith(t.ColumnCostCenterID==this.DimCCID)),t=new D.a,t.DisplayMember="Dim",t.ValueMember="Dim_Key",t.DataType="LISTBOX",t.CostCenterID=this.DimCCID,e.length>0)t.TypeID=parseInt(e[0].ColumnCCListViewTypeID.toString()),t.Mandatory=""!=e[0].IsMandatory.toString()&&Object(r.j)(e[0].IsMandatory),t.Header=e[0].ResourceData.toString(),t.Width=""!=e[0].UIWidth.toString()?parseInt(e[0].UIWidth):150,t.ID=e[0].CostCenterColID.toString(),t.DisplayIndex=n.e.IsEmpty(e[0].SectionSeqNumber.toString())?-1:parseInt(e[0].SectionSeqNumber);else{let e=s.a.rental.GetCCName(this.DimCCID);t.TypeID=1,t.Header=e.Message,t.Width=150,t.ID="0",t.DisplayIndex=a.length}a.push(t),this.PayTermsDataTableColumns.push("Dim"),this.PayTermsDataTableColumns.push("Dim_Key")}if(this.LineWiseSalesman&&(e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_ContractPayTerms"==t.SysTableName&&t.SysColumnName.startsWith("ccnid")&&t.ColumnCostCenterID==this.Salesman.CCID),t=new D.a,t.DisplayMember="SalesMan",t.ValueMember="SalesMan_Key",t.DataType="LISTBOX",t.CostCenterID=this.Salesman.CCID,e.length>0?(t.TypeID=parseInt(e[0].ColumnCCListViewTypeID.toString()),t.Header=e[0].ResourceData.toString(),t.Width=""!=e[0].UIWidth.toString()?parseInt(e[0].UIWidth):150,t.ID=e[0].CostCenterColID.toString(),t.DisplayIndex=n.e.IsEmpty(e[0].SectionSeqNumber.toString())?-1:parseInt(e[0].SectionSeqNumber),t.Mandatory=""!=e[0].IsMandatory.toString()&&Object(r.j)(e[0].IsMandatory)):(t.TypeID=this.Salesman.TypeID,t.Header=this.Salesman.Label,t.Width=120,t.ID="0",t.DisplayIndex=a.length),a.push(t),this.PayTermsDataTableColumns.push("SalesMan"),this.PayTermsDataTableColumns.push("SalesMan_Key")),e=this.ScreenObject.Data.Tables[0].filter(t=>"REN_ContractPayTerms"==t.SysTableName&&t.SysColumnName.startsWith("ccnid")),e.length>0)for(let s=0;s<e.length;s++)this.DimCCID!=parseInt(e[s].ColumnCostCenterID.toString())&&(t=new D.a,t.DisplayMember=e[s].SysColumnName.toString(),t.ValueMember=e[s].SysColumnName.toString()+"_Key",t.DataType="LISTBOX",t.Mandatory=""!=e[s].IsMandatory.toString()&&Object(r.j)(e[s].IsMandatory),t.CostCenterID=parseInt(e[s].ColumnCostCenterID.toString()),t.TypeID=parseInt(e[s].ColumnCCListViewTypeID.toString()),t.Header=e[s].ResourceData.toString(),t.Width=""!=e[s].UIWidth.toString()?parseInt(e[s].UIWidth):150,t.ID=e[s].CostCenterColID.toString(),t.DisplayIndex=n.e.IsEmpty(e[s].SectionSeqNumber.toString())?-1:parseInt(e[s].SectionSeqNumber),t.IsVisible=""==e[s].IsVisible.toString()||Object(r.j)(e[s].IsVisible),a.push(t),this.PayTermsDataTableColumns.push(t.DisplayMember),this.PayTermsDataTableColumns.push(t.ValueMember));this.PayTermsDataTableObj.Clear(),a.sort((t,e)=>t.DisplayIndex-e.DisplayIndex).forEach(t=>{this.ContractPayTerms.push(t)}),this.PayTermsDataTableObj.OnLinkClick.Subscribe(this,"OnLinkClickEvent"),this.PayTermsDataTableObj.Columns=this.ContractPayTerms,this.PayTermsDataTableColumns.push("SNO"),this.PayTermsDataTableColumns.push("ChequeNo"),this.PayTermsDataTableColumns.push("CntrlDate"),this.PayTermsDataTableColumns.push("CntrlDate_Key"),this.PayTermsDataTableColumns.push("PostingDate"),this.PayTermsDataTableColumns.push("PostingDate_Key"),this.PayTermsDataTableColumns.push("TillDate"),this.PayTermsDataTableColumns.push("TillDate_Key"),this.PayTermsDataTableColumns.push("PayNodeID"),this.PayTermsDataTableColumns.push("PayeeBank"),this.PayTermsDataTableColumns.push("Narration"),this.PayTermsDataTableColumns.push("DebitAccountID_Key"),this.PayTermsDataTableColumns.push("DebitAccountID"),this.PayTermsDataTableColumns.push("Amount"),this.PayTermsDataTableObj.DataTypes.Double.push("Amount"),this.PayTermsDataTableColumns.push("RentAmount"),this.PayTermsDataTableObj.DataTypes.Double.push("RentAmount"),this.PayTermsDataTableColumns.push("Status"),this.PayTermsDataTableColumns.push("DocumentNo"),this.PayTermsDataTableColumns.push("Period"),this.PayTermsDataTableColumns.push("CostCenterID"),this.PayTermsDataTableColumns.push("DocumentName"),this.PayTermsDataTableColumns.push("DocPrefix"),this.PayTermsDataTableColumns.push("DocNumber"),this.PayTermsDataTableColumns.push("TempCCID_Key"),this.PayTermsDataTableObj.DataTypes.Int.push("TempCCID_Key"),this.PayTermsDataTableColumns.push("TempCCID"),this.PayTermsDataTableColumns.push("Particulars_Key"),this.PayTermsDataTableObj.DataTypes.Int.push("Particulars_Key"),this.PayTermsDataTableColumns.push("Particulars"),this.PayTermsDataTableColumns.push("DocID"),this.PayTermsDataTableColumns.push("DocStatusID"),this.PayTermsDataTableColumns.push("DocumentType"),this.PayTermsDataTableColumns.push("IsFromRes"),this.PayTermsDataTableColumns.push("OpPdcStatus"),Logger.InfoLog("AddEditRenContractViewModel ::Exiting BuildPayTermsGridData")}))}OnLinkClickEvent(t,e,a){try{R.RibbonExtViewModel.LoadDocument(t)}catch(i){Logger.ErrorLog("UnAppDocumentsViewModel","OnLinkClickEvent",i.Message)}}BuildGridData(){let t,e=[];Logger.InfoLog("AddEditRenContractViewModel ::Entering BuildGridData");let a=null;if(this.DocumentContGrid=new h.a,this.DocumentContGrid.Width="",this.DocumentContGrid.Columns=[],this.DataTableObj.Clear(),this.DataTableObj.CanUserAddRows=!0,this.DataTableObj.CanUserDeleteRows=!0,t=new D.a,t.Header="SNO",t.DisplayMember="SNO",t.DataType="TextBlock",t.ReadOnly=!0,t.Width=50,t.IsVisible=!0,e.push(t),t=new D.a,t.ComboData=this.ScreenObject.Data.Tables[10],t.DisplayMember="Particulars",t.ValueMember="NodeID",t.ValueBinding="NodeID",t.DataType="ComboBox",t.Header="Particulars",a=this.ScreenObject.Data.Tables[0].filter(95==this.CurrCostCenterID||104==this.CurrCostCenterID?t=>"REN_ContractParticulars"==t.SysTableName&&"CCNodeID"==t.SysColumnName:t=>"REN_QuotationParticulars"==t.SysTableName&&"CCNodeID"==t.SysColumnName),a.length>0&&(t.Header=n.e.StringIsNullOrEmpty(a[0].ResourceData.toString())?a[0].UserColumnName.toString():a[0].ResourceData.toString(),t.Width=n.e.StringIsNullOrEmpty(""!=a[0].UIWidth)?parseInt(a[0].UIWidth):150,t.IsVisible=""==a[0].IsVisible.toString()||Object(r.j)(a[0].IsVisible),t.ID=a[0].CostCenterColID.toString(),t.Mandatory=!0,t.DisplayIndex=n.e.StringIsNullOrEmpty(a[0].SectionSeqNumber.toString())?-1:parseInt(a[0].SectionSeqNumber)),t.ReadOnly=!this.EnableParticular,e.push(t),t=new D.a,t.Header=104==this.CurrCostCenterID?"Debit A/c":"Credit A/c",t.DisplayMember="CreditAccountID",t.ValueMember="CreditAccountID_Key",t.DataType="LISTBOX",t.ReadOnly=!this.EnableParticular,t.CostCenterID=2,t.TypeID=100,a=this.ScreenObject.Data.Tables[0].filter(95==this.CurrCostCenterID||104==this.CurrCostCenterID?t=>"REN_ContractParticulars"==t.SysTableName&&"CreditAccID"==t.SysColumnName:t=>"REN_QuotationParticulars"==t.SysTableName&&"CreditAccID"==t.SysColumnName),a.length>0&&(t.Header=n.e.StringIsNullOrEmpty(a[0].ResourceData.toString())?a[0].UserColumnName.toString():a[0].ResourceData.toString(),t.Width=n.e.StringIsNullOrEmpty(""!=a[0].UIWidth)?parseInt(a[0].UIWidth):150,t.IsVisible=""==a[0].IsVisible.toString()||Object(r.j)(a[0].IsVisible),t.ID=a[0].CostCenterColID.toString(),t.DisplayIndex=n.e.StringIsNullOrEmpty(a[0].SectionSeqNumber.toString())?-1:parseInt(a[0].SectionSeqNumber),""!=a[0].ColumnCCListViewTypeID.toString()&&parseInt(a[0].ColumnCCListViewTypeID.toString())>0&&(t.TypeID=parseInt(a[0].ColumnCCListViewTypeID.toString()))),e.push(t),t=new D.a,t.Header=104==this.CurrCostCenterID?"Credit A/c":"Debit A/c",t.DisplayMember="DebitAccountID",t.ValueMember="DebitAccountID_Key",t.DataType="LISTBOX",t.CostCenterID=2,t.TypeID=15,a=this.ScreenObject.Data.Tables[0].filter(95==this.CurrCostCenterID||104==this.CurrCostCenterID?t=>"REN_ContractParticulars"==t.SysTableName&&"DebitAccID"==t.SysColumnName:t=>"REN_QuotationParticulars"==t.SysTableName&&"DebitAccID"==t.SysColumnName),a.length>0&&(t.Header=n.e.StringIsNullOrEmpty(a[0].ResourceData.toString())?a[0].UserColumnName.toString():a[0].ResourceData.toString(),t.Width=""!=a[0].UIWidth?parseInt(a[0].UIWidth):150,t.IsVisible=!!n.e.StringIsNullOrEmpty(""!=a[0].IsVisible.toString())&&Object(r.j)(a[0].IsVisible),t.ID=a[0].CostCenterColID.toString(),t.DisplayIndex=n.e.StringIsNullOrEmpty(a[0].SectionSeqNumber.toString())?-1:parseInt(a[0].SectionSeqNumber),""!=a[0].ColumnCCListViewTypeID.toString()&&parseInt(a[0].ColumnCCListViewTypeID.toString())>0&&(t.TypeID=parseInt(a[0].ColumnCCListViewTypeID.toString()))),e.push(t),t=new D.a,t.Header="Cheque No",t.DisplayMember="ChequeNo",t.DataType="TextBlock",a=this.ScreenObject.Data.Tables[0].filter(95==this.CurrCostCenterID||104==this.CurrCostCenterID?t=>"REN_ContractParticulars"==t.SysTableName&&"ChequeNO"==t.SysColumnName:t=>"REN_QuotationParticulars"==t.SysTableName&&"ChequeNO"==t.SysColumnName),a.length>0&&(t.Header=n.e.StringIsNullOrEmpty(a[0].ResourceData.toString())?a[0].UserColumnName.toString():a[0].ResourceData.toString(),t.Width=n.e.StringIsNullOrEmpty(""!=a[0].UIWidth)?parseInt(a[0].UIWidth):150,t.IsVisible=""==a[0].IsVisible.toString()||Object(r.j)(a[0].IsVisible),t.ID=a[0].CostCenterColID.toString(),t.DisplayIndex=n.e.StringIsNullOrEmpty(a[0].SectionSeqNumber.toString())?-1:parseInt(a[0].SectionSeqNumber)),t.ReadOnly=!this.EnableParticular,e.push(t),t=new D.a,t.Header="Date",t.DisplayMember="CntrlDate",t.ValueMember="CntrlDate_Key",t.DataType="DATE",t.ReadOnly=!1,a=this.ScreenObject.Data.Tables[0].filter(95==this.CurrCostCenterID||104==this.CurrCostCenterID?t=>"REN_ContractParticulars"==t.SysTableName&&"ChequeDate"==t.SysColumnName:t=>"REN_QuotationParticulars"==t.SysTableName&&"ChequeDate"==t.SysColumnName),a.length>0&&(t.Header=n.e.StringIsNullOrEmpty(a[0].ResourceData.toString())?a[0].UserColumnName.toString():a[0].ResourceData.toString(),t.Width=n.e.StringIsNullOrEmpty(""!=a[0].UIWidth)?parseInt(a[0].UIWidth):150,t.IsVisible=""==a[0].IsVisible.toString()||Object(r.j)(a[0].IsVisible),t.ID=a[0].CostCenterColID.toString(),t.DisplayIndex=n.e.StringIsNullOrEmpty(a[0].SectionSeqNumber.toString())?-1:parseInt(a[0].SectionSeqNumber)),t.ReadOnly=!this.EnableParticular,e.push(t),t=new D.a,t.ComboData=this.ScreenObject.Data.Tables[8],t.DisplayMember="PayNodeID",t.ValueMember="PayeeBank",t.ValueBinding="PayeeBank",t.DataType="ComboBox",t.Header="PayeeBank",a=this.ScreenObject.Data.Tables[0].filter(95==this.CurrCostCenterID||104==this.CurrCostCenterID?t=>"REN_ContractParticulars"==t.SysTableName&&"PayeeBank"==t.SysColumnName:t=>"REN_QuotationParticulars"==t.SysTableName&&"PayeeBank"==t.SysColumnName),a.length>0&&(t.Header=n.e.StringIsNullOrEmpty(a[0].ResourceData.toString())?a[0].UserColumnName.toString():a[0].ResourceData.toString(),t.Width=n.e.StringIsNullOrEmpty(""!=a[0].UIWidth)?parseInt(a[0].UIWidth):150,t.IsVisible=""==a[0].IsVisible.toString()||Object(r.j)(a[0].IsVisible),t.ID=a[0].CostCenterColID.toString(),t.DisplayIndex=n.e.StringIsNullOrEmpty(a[0].SectionSeqNumber.toString())?-1:parseInt(a[0].SectionSeqNumber)),t.ReadOnly=!this.EnableParticular,e.push(t),t=new D.a,t.Header="Sq.ft",t.DisplayMember="Sqft",t.DataType="FLOAT",a=this.ScreenObject.Data.Tables[0].filter(95==this.CurrCostCenterID||104==this.CurrCostCenterID?t=>"REN_ContractParticulars"==t.SysTableName&&"Sqft"==t.SysColumnName:t=>"REN_QuotationParticulars"==t.SysTableName&&"Sqft"==t.SysColumnName),a.length>0&&(t.Header=n.e.StringIsNullOrEmpty(a[0].ResourceData.toString())?a[0].UserColumnName.toString():a[0].ResourceData.toString(),t.Width=n.e.StringIsNullOrEmpty(""!=a[0].UIWidth)?parseInt(a[0].UIWidth):100,t.IsVisible=""==a[0].IsVisible.toString()||Object(r.j)(a[0].IsVisible),t.ID=a[0].CostCenterColID.toString(),t.DisplayIndex=n.e.StringIsNullOrEmpty(a[0].SectionSeqNumber.toString())?-1:parseInt(a[0].SectionSeqNumber)),t.ReadOnly=!this.EnableParticular,t.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinAmount.toString(),e.push(t),t=new D.a,t.Header="Rate",t.DisplayMember="Rate",t.DataType="FLOAT",a=this.ScreenObject.Data.Tables[0].filter(95==this.CurrCostCenterID||104==this.CurrCostCenterID?t=>"REN_ContractParticulars"==t.SysTableName&&"Rate"==t.SysColumnName:t=>"REN_QuotationParticulars"==t.SysTableName&&"Rate"==t.SysColumnName),a.length>0&&(t.Header=n.e.StringIsNullOrEmpty(a[0].ResourceData.toString())?a[0].UserColumnName.toString():a[0].ResourceData.toString(),t.Width=n.e.StringIsNullOrEmpty(""!=a[0].UIWidth)?parseInt(a[0].UIWidth):100,t.IsVisible=""==a[0].IsVisible.toString()||Object(r.j)(a[0].IsVisible),t.ID=a[0].CostCenterColID.toString(),t.DisplayIndex=n.e.StringIsNullOrEmpty(a[0].SectionSeqNumber.toString())?-1:parseInt(a[0].SectionSeqNumber)),t.ReadOnly=!this.EnableParticular,t.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinAmount.toString(),e.push(t),t=new D.a,t.Header="Rent Amount",t.DisplayMember="ActAmount",t.DataType="FLOAT",a=this.ScreenObject.Data.Tables[0].filter(95==this.CurrCostCenterID||104==this.CurrCostCenterID?t=>"REN_ContractParticulars"==t.SysTableName&&"RentAmount"==t.SysColumnName:t=>"REN_QuotationParticulars"==t.SysTableName&&"RentAmount"==t.SysColumnName),a.length>0&&(t.Header=n.e.StringIsNullOrEmpty(a[0].ResourceData.toString())?a[0].UserColumnName.toString():a[0].ResourceData.toString(),t.Width=n.e.StringIsNullOrEmpty(""!=a[0].UIWidth)?parseInt(a[0].UIWidth):150,t.IsVisible=""==a[0].IsVisible.toString()||Object(r.j)(a[0].IsVisible),t.ID=a[0].CostCenterColID.toString(),t.DisplayIndex=n.e.StringIsNullOrEmpty(a[0].SectionSeqNumber.toString())?-1:parseInt(a[0].SectionSeqNumber)),t.ReadOnly=!this.EnableParticular,t.IsCalculated=1,t.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinAmount.toString(),e.push(t),t=new D.a,t.Header="Discount Amount",t.DisplayMember="Discount",t.DataType="FLOAT",a=this.ScreenObject.Data.Tables[0].filter(95==this.CurrCostCenterID||104==this.CurrCostCenterID?t=>"REN_ContractParticulars"==t.SysTableName&&"Discount"==t.SysColumnName:t=>"REN_QuotationParticulars"==t.SysTableName&&"Discount"==t.SysColumnName),a.length>0&&(t.Header=n.e.StringIsNullOrEmpty(a[0].ResourceData.toString())?a[0].UserColumnName.toString():a[0].ResourceData.toString(),t.Width=n.e.StringIsNullOrEmpty(""!=a[0].UIWidth)?parseInt(a[0].UIWidth):150,t.IsVisible=""==a[0].IsVisible.toString()||Object(r.j)(a[0].IsVisible),t.ID=a[0].CostCenterColID.toString(),t.DisplayIndex=n.e.StringIsNullOrEmpty(a[0].SectionSeqNumber.toString())?-1:parseInt(a[0].SectionSeqNumber)),t.ReadOnly=!this.EnableParticular,t.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinAmount.toString(),e.push(t),t=new D.a,t.Header="After Discount Amount",t.DisplayMember="Amount",t.DataType="FLOAT",t.ShowTotal=!0,t.IsCalculated=1,a=this.ScreenObject.Data.Tables[0].filter(95==this.CurrCostCenterID||104==this.CurrCostCenterID?t=>"REN_ContractParticulars"==t.SysTableName&&"Amount"==t.SysColumnName:t=>"REN_QuotationParticulars"==t.SysTableName&&"Amount"==t.SysColumnName),a.length>0&&(t.Header=n.e.StringIsNullOrEmpty(a[0].ResourceData.toString())?a[0].UserColumnName.toString():a[0].ResourceData.toString(),t.Width=n.e.StringIsNullOrEmpty(""!=a[0].UIWidth)?parseInt(a[0].UIWidth):150,t.IsVisible=""==a[0].IsVisible.toString()||Object(r.j)(a[0].IsVisible),t.ID=a[0].CostCenterColID.toString(),t.DisplayIndex=n.e.StringIsNullOrEmpty(a[0].SectionSeqNumber.toString())?-1:parseInt(a[0].SectionSeqNumber)),t.ReadOnly=!this.EnableParticular,t.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinAmount.toString(),e.push(t),s.a.SessionManager.Preferences.ContainsKey("VATVersion")){t=new D.a,t.Header="Vat %",t.DisplayMember="VatPer",t.DataType="FLOAT",a=this.ScreenObject.Data.Tables[0].filter(95==this.CurrCostCenterID||104==this.CurrCostCenterID?t=>"REN_ContractParticulars"==t.SysTableName&&"VATPer"==t.SysColumnName:t=>"REN_QuotationParticulars"==t.SysTableName&&"VATPer"==t.SysColumnName),a.length>0&&(t.Header=n.e.StringIsNullOrEmpty(a[0].ResourceData.toString())?a[0].UserColumnName.toString():a[0].ResourceData.toString(),t.Width=n.e.StringIsNullOrEmpty(""!=a[0].UIWidth)?parseInt(a[0].UIWidth):60,t.IsVisible=""==a[0].IsVisible.toString()||Object(r.j)(a[0].IsVisible),t.Header=a[0].ResourceData.toString(),t.ID=a[0].CostCenterColID.toString(),t.DisplayIndex=n.e.StringIsNullOrEmpty(a[0].SectionSeqNumber.toString())?-1:parseInt(a[0].SectionSeqNumber)),95==this.CurrCostCenterID&&(t.ReadOnly=!s.a.SessionManager.IsActionAssigned(this.CurrCostCenterID,"EnableVat")),t.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinAmount.toString(),e.push(t),t=new D.a,t.Header="Vat Amount",t.DisplayMember="VatAmount",t.DataType="FLOAT",a=this.ScreenObject.Data.Tables[0].filter(95==this.CurrCostCenterID||104==this.CurrCostCenterID?t=>"REN_ContractParticulars"==t.SysTableName&&"VATAmount"==t.SysColumnName:t=>"REN_QuotationParticulars"==t.SysTableName&&"VATAmount"==t.SysColumnName),a.length>0&&(t.Header=n.e.StringIsNullOrEmpty(a[0].ResourceData.toString())?a[0].UserColumnName.toString():a[0].ResourceData.toString(),t.Width=n.e.StringIsNullOrEmpty(""!=a[0].UIWidth)?parseInt(a[0].UIWidth):100,t.IsVisible=""==a[0].IsVisible.toString()||Object(r.j)(a[0].IsVisible),t.Header=a[0].ResourceData.toString(),t.ID=a[0].CostCenterColID.toString(),t.DisplayIndex=n.e.StringIsNullOrEmpty(a[0].SectionSeqNumber.toString())?-1:parseInt(a[0].SectionSeqNumber)),t.ReadOnly=!0,t.ShowTotal=!0,t.IsCalculated=1,t.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinAmount.toString(),e.push(t),t=new D.a,t.Header="Taxable Amount",t.DisplayMember="TaxableAmt",t.DataType="FLOAT",a=this.ScreenObject.Data.Tables[0].filter(95==this.CurrCostCenterID||104==this.CurrCostCenterID?t=>"REN_ContractParticulars"==t.SysTableName&&"TaxableAmt"==t.SysColumnName:t=>"REN_QuotationParticulars"==t.SysTableName&&"TaxableAmt"==t.SysColumnName),a.length>0&&(t.Header=n.e.StringIsNullOrEmpty(a[0].ResourceData.toString())?a[0].UserColumnName.toString():a[0].ResourceData.toString(),t.Width=n.e.StringIsNullOrEmpty(""!=a[0].UIWidth)?parseInt(a[0].UIWidth):100,t.IsVisible=""==a[0].IsVisible.toString()||Object(r.j)(a[0].IsVisible),t.Header=a[0].ResourceData.toString(),t.ID=a[0].CostCenterColID.toString(),t.DisplayIndex=n.e.StringIsNullOrEmpty(a[0].SectionSeqNumber.toString())?-1:parseInt(a[0].SectionSeqNumber)),t.ReadOnly=!0,t.ShowTotal=!0,t.IsCalculated=1,t.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinAmount.toString(),e.push(t),t=new D.a,t.CostCenterID=50060,t.TypeID=1,t.DisplayMember="TaxCategory",t.ValueMember="TaxCategory_Key",t.Header="TaxCategory",t.DataType="LISTBOX",a=this.ScreenObject.Data.Tables[0].filter(95==this.CurrCostCenterID||104==this.CurrCostCenterID?t=>"REN_ContractParticulars"==t.SysTableName&&"TaxCategory"==t.SysColumnName:t=>"REN_QuotationParticulars"==t.SysTableName&&"TaxCategory"==t.SysColumnName),a.length>0&&(t.Header=n.e.StringIsNullOrEmpty(a[0].ResourceData.toString())?a[0].UserColumnName.toString():a[0].ResourceData.toString(),t.Width=n.e.StringIsNullOrEmpty(""!=a[0].UIWidth)?parseInt(a[0].UIWidth):120,t.IsVisible=""==a[0].IsVisible.toString()||Object(r.j)(a[0].IsVisible),t.Header=a[0].ResourceData.toString(),t.ID=a[0].CostCenterColID.toString(),t.DisplayIndex=n.e.StringIsNullOrEmpty(a[0].SectionSeqNumber.toString())?-1:parseInt(a[0].SectionSeqNumber),""!=a[0].ColumnCCListViewTypeID.toString()&&parseInt(a[0].ColumnCCListViewTypeID.toString())>0&&(t.TypeID=parseInt(a[0].ColumnCCListViewTypeID.toString()))),e.push(t),t=new D.a,t.CostCenterID=50061,t.TypeID=1,t.DisplayMember="SPType",t.ValueMember="SPType_Key",t.Header="SPType",t.DataType="LISTBOX",a=this.ScreenObject.Data.Tables[0].filter(95==this.CurrCostCenterID||104==this.CurrCostCenterID?t=>"REN_ContractParticulars"==t.SysTableName&&"SPType"==t.SysColumnName:t=>"REN_QuotationParticulars"==t.SysTableName&&"SPType"==t.SysColumnName),a.length>0?(t.Header=n.e.StringIsNullOrEmpty(a[0].ResourceData.toString())?a[0].UserColumnName.toString():a[0].ResourceData.toString(),t.Width=n.e.StringIsNullOrEmpty(""!=a[0].UIWidth)?parseInt(a[0].UIWidth):120,t.IsVisible=""==a[0].IsVisible.toString()||Object(r.j)(a[0].IsVisible),t.Header=a[0].ResourceData.toString(),t.ID=a[0].CostCenterColID.toString(),t.DisplayIndex=n.e.StringIsNullOrEmpty(a[0].SectionSeqNumber.toString())?-1:parseInt(a[0].SectionSeqNumber),""!=a[0].ColumnCCListViewTypeID.toString()&&parseInt(a[0].ColumnCCListViewTypeID.toString())>0&&(t.TypeID=parseInt(a[0].ColumnCCListViewTypeID.toString()))):t.IsVisible=!1,e.push(t),t.IsVisible&&(this.DataTableColumns.push("SPType"),this.DataTableColumns.push("SPType_Key")),t=new D.a,t.Header="Vat Type",t.ValueBinding="VatType",t.DataType="ComboBox",t.DisplayMember="Name",t.ValueMember="Value";let i=[];i.push(c.d.ComboBoxItems_2("Exclusive","Exclusive")),i.push(c.d.ComboBoxItems_2("Inclusive","Inclusive")),t.ComboData=i,t.IsVisible=!0,a=this.ScreenObject.Data.Tables[0].filter(95==this.CurrCostCenterID||104==this.CurrCostCenterID?t=>"REN_ContractParticulars"==t.SysTableName&&"VatType"==t.SysColumnName:t=>"REN_QuotationParticulars"==t.SysTableName&&"VatType"==t.SysColumnName),a.length>0&&(t.Header=n.e.StringIsNullOrEmpty(a[0].ResourceData.toString())?a[0].UserColumnName.toString():a[0].ResourceData.toString(),t.Width=n.e.StringIsNullOrEmpty(""!=a[0].UIWidth)?parseInt(a[0].UIWidth):100,t.IsVisible=""==a[0].IsVisible.toString()||Object(r.j)(a[0].IsVisible),t.Header=a[0].ResourceData.toString(),t.ID=a[0].CostCenterColID.toString(),t.DisplayIndex=n.e.StringIsNullOrEmpty(a[0].SectionSeqNumber.toString())?-1:parseInt(a[0].SectionSeqNumber)),e.push(t)}t=new D.a,t.Header="Narration",t.DisplayMember="Narration",t.DataType="TextBlock",a=this.ScreenObject.Data.Tables[0].filter(95==this.CurrCostCenterID||104==this.CurrCostCenterID?t=>"REN_ContractParticulars"==t.SysTableName&&"Narration"==t.SysColumnName:t=>"REN_QuotationParticulars"==t.SysTableName&&"Narration"==t.SysColumnName),a.length>0?(t.Header=n.e.StringIsNullOrEmpty(a[0].ResourceData.toString())?a[0].UserColumnName.toString():a[0].ResourceData.toString(),t.Width=n.e.StringIsNullOrEmpty(""!=a[0].UIWidth)?parseInt(a[0].UIWidth):150,t.IsVisible=""==a[0].IsVisible.toString()||Object(r.j)(a[0].IsVisible),t.ID=a[0].CostCenterColID.toString(),t.DisplayIndex=n.e.StringIsNullOrEmpty(a[0].SectionSeqNumber.toString())?-1:parseInt(a[0].SectionSeqNumber)):t.Width=150,e.push(t),95==this.CurrCostCenterID&&(t=new D.a,t.Header="Tasjeel Amount",t.DisplayMember="TasjeelAmount",t.DataType="FLOAT",a=this.ScreenObject.Data.Tables[0].filter(t=>"REN_ContractParticulars"==t.SysTableName&&"TasjeelAmount"==t.SysColumnName),a.length>0&&(t.Header=n.e.StringIsNullOrEmpty(a[0].ResourceData.toString())?a[0].UserColumnName.toString():a[0].ResourceData.toString(),t.Width=n.e.StringIsNullOrEmpty(""!=a[0].UIWidth)?parseInt(a[0].UIWidth):150,t.IsVisible=""==a[0].IsVisible.toString()||Object(r.j)(a[0].IsVisible),t.ID=a[0].CostCenterColID.toString(),t.DisplayIndex=n.e.StringIsNullOrEmpty(a[0].SectionSeqNumber.toString())?-1:parseInt(a[0].SectionSeqNumber)),t.ReadOnly=!this.EnableParticular,t.DecimalPoints=s.a.SessionManager.Preferences.DecimalsinAmount.toString(),e.push(t)),t=new D.a,t.Header="Generate Cheque",t.ValueBinding="InclChkGen",t.DataType="ComboBox",t.DisplayMember="Name",t.ValueMember="Value",t.Width=120;let i=[];i.push(c.d.ComboBoxItems_2("Yes","1")),i.push(c.d.ComboBoxItems_2("No","0")),i.push(c.d.ComboBoxItems_2("Incl Vat","2")),t.ComboData=i,a=this.ScreenObject.Data.Tables[0].filter(95==this.CurrCostCenterID||104==this.CurrCostCenterID?t=>"REN_ContractParticulars"==t.SysTableName&&"InclChequeGen"==t.SysColumnName:t=>"REN_QuotationParticulars"==t.SysTableName&&"InclChequeGen"==t.SysColumnName),a.length>0&&(t.Header=n.e.StringIsNullOrEmpty(a[0].ResourceData.toString())?a[0].UserColumnName.toString():a[0].ResourceData.toString(),t.Width=n.e.StringIsNullOrEmpty(""!=a[0].UIWidth)?parseInt(a[0].UIWidth):120,t.IsVisible=""==a[0].IsVisible.toString()||Object(r.j)(a[0].IsVisible),t.ID=a[0].CostCenterColID.toString(),t.DisplayIndex=n.e.StringIsNullOrEmpty(a[0].SectionSeqNumber.toString())?-1:parseInt(a[0].SectionSeqNumber)),e.push(t),t=new D.a,t.Header="Recur",t.ValueBinding="RecurInvoice",t.DataType="ComboBox",t.DisplayMember="Name",t.ValueMember="Value",t.Width=120;let o,l=[];if(l.push(c.d.ComboBoxItems_2("Yes","true")),l.push(c.d.ComboBoxItems_2("No","false")),t.ComboData=l,a=this.ScreenObject.Data.Tables[0].filter(95==this.CurrCostCenterID||104==this.CurrCostCenterID?t=>"REN_ContractParticulars"==t.SysTableName&&"Recur"==t.SysColumnName:t=>"REN_QuotationParticulars"==t.SysTableName&&"Recur"==t.SysColumnName),a.length>0&&(t.Header=n.e.StringIsNullOrEmpty(a[0].ResourceData.toString())?a[0].UserColumnName.toString():a[0].ResourceData.toString(),t.Width=n.e.StringIsNullOrEmpty(""!=a[0].UIWidth)?parseInt(a[0].UIWidth):120,t.IsVisible=""==a[0].IsVisible.toString()||Object(r.j)(a[0].IsVisible),t.ID=a[0].CostCenterColID.toString(),t.DisplayIndex=n.e.StringIsNullOrEmpty(a[0].SectionSeqNumber.toString())?-1:parseInt(a[0].SectionSeqNumber)),this.DistribtueInvoice||(t.IsVisible=!1),e.push(t),95!=this.CurrCostCenterID&&104!=this.CurrCostCenterID||(t=new D.a,t.Header="Status",t.DisplayMember="Status",t.DataType="TextBlock",a=this.ScreenObject.Data.Tables[0].filter(t=>"REN_ContractParticulars"==t.SysTableName&&"Status"==t.SysColumnName),a.length>0&&(t.Width=n.e.StringIsNullOrEmpty(""!=a[0].UIWidth)?parseInt(a[0].UIWidth):150,t.IsVisible=""==a[0].IsVisible.toString()||Object(r.j)(a[0].IsVisible),t.ID=a[0].CostCenterColID.toString(),t.DisplayIndex=n.e.StringIsNullOrEmpty(a[0].SectionSeqNumber.toString())?-1:parseInt(a[0].SectionSeqNumber)),t.ReadOnly=!0,e.push(t),t=new D.a,t.Click.Subscribe(this,"OnMouseClickContract"),t.Header="Document No",t.DisplayMember="DocumentNo",t.DataType="LINK",a=this.ScreenObject.Data.Tables[0].filter(t=>"REN_ContractParticulars"==t.SysTableName&&"DocumentNo"==t.SysColumnName),a.length>0&&(t.Header=n.e.StringIsNullOrEmpty(a[0].ResourceData.toString())?a[0].UserColumnName.toString():a[0].ResourceData.toString(),t.Width=n.e.StringIsNullOrEmpty(""!=a[0].UIWidth)?parseInt(a[0].UIWidth):150,t.IsVisible=""==a[0].IsVisible.toString()||Object(r.j)(a[0].IsVisible),t.ID=a[0].CostCenterColID.toString(),t.DisplayIndex=n.e.StringIsNullOrEmpty(a[0].SectionSeqNumber.toString())?-1:parseInt(a[0].SectionSeqNumber)),e.push(t),t=new D.a,t.Header="Temporary Status",t.DisplayMember="TempCCID",t.DataType="LISTBOX",t.CostCenterID=this.TempCCID,t.TypeID=1,a=this.ScreenObject.Data.Tables[0].filter(t=>"REN_ContractParticulars"==t.SysTableName&&"TemporaryStatus"==t.SysColumnName),a.length>0&&(t.Header=n.e.StringIsNullOrEmpty(a[0].ResourceData.toString())?a[0].UserColumnName.toString():a[0].ResourceData.toString(),t.Width=n.e.StringIsNullOrEmpty(""!=a[0].UIWidth)?parseInt(a[0].UIWidth):150,t.IsVisible=""==a[0].IsVisible.toString()||Object(r.j)(a[0].IsVisible),t.ID=a[0].CostCenterColID.toString(),t.DisplayIndex=n.e.StringIsNullOrEmpty(a[0].SectionSeqNumber.toString())?-1:parseInt(a[0].SectionSeqNumber),""!=a[0].ColumnCCListViewTypeID.toString()&&parseInt(a[0].ColumnCCListViewTypeID.toString())>0&&(t.TypeID=parseInt(a[0].ColumnCCListViewTypeID.toString()))),t.ReadOnly=!this.EnableParticular,e.push(t)),a=this.ScreenObject.Data.Tables[0].filter(t=>"REN_ContractParticulars"==t.SysTableName&&"LocationID"==t.SysColumnName),a.length>0&&""!=a[0].IsVisible.toString()&&Object(r.j)(a[0].IsVisible)&&(t=new D.a,t.Header="Location",t.DisplayMember="Location",t.ValueMember="Location_Key",t.DataType="LISTBOX",t.CostCenterID=this.LocationContract.CCID,t.TypeID=this.LocationContract.TypeID,t.Header=n.e.StringIsNullOrEmpty(a[0].ResourceData.toString())?a[0].UserColumnName.toString():a[0].ResourceData.toString(),t.Width=n.e.StringIsNullOrEmpty(""!=a[0].UIWidth)?parseInt(a[0].UIWidth):150,t.ID=a[0].CostCenterColID.toString(),t.DisplayIndex=n.e.StringIsNullOrEmpty(a[0].SectionSeqNumber.toString())?-1:parseInt(a[0].SectionSeqNumber),e.push(t),this.DataTableColumns.push("Location"),this.DataTableColumns.push("Location_Key")),this.DimCCID>5e4){if(a=this.ScreenObject.Data.Tables[0].filter(t=>"REN_ContractParticulars"==t.SysTableName&&t.SysColumnName.startsWith("ccnid")&&t.ColumnCostCenterID==this.DimCCID),t=new D.a,t.DisplayMember="Dim",t.ValueMember="Dim_Key",t.DataType="LISTBOX",t.CostCenterID=this.DimCCID,a.length>0)t.TypeID=parseInt(a[0].ColumnCCListViewTypeID.toString()),t.Mandatory=""!=a[0].IsMandatory.toString()&&Object(r.j)(a[0].IsMandatory),t.Header=a[0].ResourceData.toString(),t.Width=""!=a[0].UIWidth.toString()?parseInt(a[0].UIWidth):150,t.ID=a[0].CostCenterColID.toString(),t.DisplayIndex=n.e.IsEmpty(a[0].SectionSeqNumber.toString())?-1:parseInt(a[0].SectionSeqNumber);else{let a=s.a.rental.GetCCName(this.DimCCID);t.TypeID=1,t.Header=a.Message,t.Width=150,t.ID="0",t.DisplayIndex=e.length}e.push(t),this.DataTableColumns.push("Dim"),this.DataTableColumns.push("Dim_Key")}if(this.LineWiseSalesman&&(a=this.ScreenObject.Data.Tables[0].filter(t=>"REN_ContractParticulars"==t.SysTableName&&t.SysColumnName.startsWith("ccnid")&&t.ColumnCostCenterID==this.Salesman.CCID),t=new D.a,t.DisplayMember="SalesMan",t.ValueMember="SalesMan_Key",t.DataType="LISTBOX",t.CostCenterID=this.Salesman.CCID,a.length>0?(t.TypeID=parseInt(a[0].ColumnCCListViewTypeID.toString()),t.Mandatory=""!=a[0].IsMandatory.toString()&&Object(r.j)(a[0].IsMandatory),t.Header=a[0].ResourceData.toString(),t.Width=""!=a[0].UIWidth.toString()?parseInt(a[0].UIWidth):150,t.ID=a[0].CostCenterColID.toString(),t.DisplayIndex=n.e.IsEmpty(a[0].SectionSeqNumber.toString())?-1:parseInt(a[0].SectionSeqNumber)):(t.TypeID=this.Salesman.TypeID,t.Header=this.Salesman.Label,t.Width=120,t.ID="0",t.DisplayIndex=e.length),e.push(t),this.DataTableColumns.push("SalesMan"),this.DataTableColumns.push("SalesMan_Key")),a=this.ScreenObject.Data.Tables[0].filter(t=>"REN_ContractParticulars"==t.SysTableName&&t.SysColumnName.toLowerCase().startsWith("ccnid")),a.length>0)for(let s=0;s<a.length;s++)this.DimCCID==parseInt(a[s].ColumnCostCenterID.toString())||this.LineWiseSalesman&&this.Salesman.CCID==parseInt(a[s].ColumnCostCenterID.toString())||(t=new D.a,t.DisplayMember=a[s].SysColumnName.toString(),t.ValueMember=a[s].SysColumnName.toString()+"_Key",t.DataType="LISTBOX",t.CostCenterID=parseInt(a[s].ColumnCostCenterID.toString()),t.TypeID=parseInt(a[s].ColumnCCListViewTypeID.toString()),t.Header=a[s].ResourceData.toString(),t.Width=""!=a[s].UIWidth.toString()?parseInt(a[s].UIWidth):150,t.Mandatory=""!=a[s].IsMandatory.toString()&&Object(r.j)(a[s].IsMandatory),t.ID=a[s].CostCenterColID.toString(),t.DisplayIndex=n.e.IsEmpty(a[s].SectionSeqNumber.toString())?-1:parseInt(a[s].SectionSeqNumber),t.IsVisible=""==a[s].IsVisible.toString()||Object(r.j)(a[s].IsVisible),e.push(t),this.DataTableColumns.push(t.DisplayMember),this.DataTableColumns.push(t.ValueMember));this.ContractParticular=[],o=e.sort((t,e)=>t.DisplayIndex-e.DisplayIndex),o.forEach(t=>{this.ContractParticular.push(t)}),this.DataTableObj.Columns=this.ContractParticular,this.DataTableObj.OnLinkClick.Subscribe(this,"OnLinkClickEvent"),this.DataTableColumns.push("SNO"),this.DataTableColumns.push("Recurr"),this.DataTableColumns.push("Particulars"),this.DataTableColumns.push("NodeID"),this.DataTableColumns.push("Xml"),this.DataTableColumns.push("CreditAccountID"),this.DataTableColumns.push("CreditAccountID_Key"),this.DataTableColumns.push("AdvanceAcc"),this.DataTableColumns.push("ChequeNo"),this.DataTableColumns.push("CntrlDate"),this.DataTableColumns.push("CntrlDate_Key"),this.DataTableObj.DataTypes.Date.push("CntrlDate_Key"),this.DataTableColumns.push("PayeeBank"),this.DataTableColumns.push("PayNodeID"),this.DataTableColumns.push("DebitAccountID"),this.DataTableColumns.push("DebitAccountID_Key"),this.DataTableObj.DataTypes.Int.push("DebitAccountID_Key"),this.DataTableColumns.push("Amount"),this.DataTableObj.DataTypes.Double.push("Amount"),this.DataTableColumns.push("ActAmount"),this.DataTableObj.DataTypes.Double.push("ActAmount"),this.DataTableColumns.push("TasjeelAmount"),this.DataTableColumns.push("Discount"),this.DataTableColumns.push("DiscountPercentage"),this.DataTableColumns.push("Months"),this.DataTableColumns.push("Refund"),this.DataTableColumns.push("Narration"),this.DataTableColumns.push("Status"),this.DataTableColumns.push("DocumentNo"),this.DataTableColumns.push("CostCenterID"),this.DataTableColumns.push("DocumentName"),this.DataTableColumns.push("DocPrefix"),this.DataTableColumns.push("DocNumber"),this.DataTableColumns.push("TempCCID_Key"),this.DataTableColumns.push("TempCCID"),this.DataTableColumns.push("DocID"),this.DataTableColumns.push("VatPer"),this.DataTableObj.DataTypes.Double.push("VatPer"),this.DataTableColumns.push("VatAmount"),this.DataTableObj.DataTypes.Double.push("VatAmount"),this.DataTableColumns.push("TaxableAmt"),this.DataTableObj.DataTypes.Double.push("TaxableAmt"),this.DataTableColumns.push("InclChkGen"),this.DataTableColumns.push("VatType"),this.DataTableColumns.push("RecurInvoice"),this.DataTableColumns.push("PostDebit"),this.DataTableColumns.push("TaxCategory"),this.DataTableColumns.push("TaxCategory_Key"),this.DataTableColumns.push("Display"),this.DataTableObj.DataTypes.Int.push("Display"),this.DataTableColumns.push("StyleHeightZero"),this.DataTableColumns.push("BankAccountID"),this.DataTableColumns.push("Sqft"),this.DataTableColumns.push("Rate"),Logger.InfoLog("AddEditRenContractViewModel ::Exiting BuildGridData")}onAddRow(t,e){this.UpdateSequence(),n.e.IsEmpty(e)||(e.Row.SNO=this.SNO,e.Row.Recurr=!1)}onDeleteRow(t,e){this.UpdateSequence()}OnLoad(t){if(Logger.InfoLog("AddEditRenContractViewModel ::Entering OnLoad"),null!=this.ScreenObject.Data&&this.ScreenObject.Data.Tables.length>3&&this.ScreenObject.Data.Tables[3].length>0){for(let t=0;t<this.ScreenObject.Data.Tables[3].length;t++)this.StatusID.Items.push(c.d.ComboBoxItems_2(this.ScreenObject.Data.Tables[3][t].ActualStatus.toString(),this.ScreenObject.Data.Tables[3][t].StatusID.toString()));95==this.CurrCostCenterID||104==this.CurrCostCenterID||103==this.CurrCostCenterID?this.StatusID.SelectedValue="426":129==this.CurrCostCenterID&&(this.StatusID.SelectedValue="467")}if(null!=this.ScreenObject.Data&&this.ScreenObject.Data.Tables.length>0&&this.ScreenObject.Data.Tables[0].length>0){let t=[]=this.ScreenObject.Data.Tables[0].filter(t=>"REN_Contract"==t.SysTableName&&"BasedOn"==t.SysColumnName);if(t.length>0){let e=[]=t[0].UserProbableValues.toString().Trim().split(";");for(let t=0;t<e.length;t++)this.BasedOn.Items.push(c.d.ComboBoxItems_2(e[t].replace("''","'"),e[t].replace("''","'")));this.BasedOn.SelectedValue=t[0].UserDefaultValue.toString()}}if(this.IsExtended.Items.push(c.d.ComboBoxItems_2("NO","false")),this.IsExtended.Items.push(c.d.ComboBoxItems_2("YES","True")),this.IsExtended.Visible?(this.IsExtended.Enable=!0,this.IsExtended.Visible=!1):this.IsExtended.Enable=!1,null!=this.ScreenObject.Data&&this.ScreenObject.Data.Tables.length>5&&this.ScreenObject.Data.Tables[5].length>0){let t=[]=this.ScreenObject.Data.Tables[5].filter(t=>"ContractLocation"==t.Name);t.length>0&&(this.LocationContract.Visible=""==t[0].Value.toString()||"0"!=t[0].Value.toString()&&"1"!=t[0].Value.toString()?Object(r.j)(t[0].Value):Object(r.j)(parseInt(t[0].Value))),t=this.ScreenObject.Data.Tables[5].filter(t=>"ContractDivision"==t.Name),t.length>0&&(this.DivisionContract.Visible=""==t[0].Value.toString()||"0"!=t[0].Value.toString()&&"1"!=t[0].Value.toString()?Object(r.j)(t[0].Value):Object(r.j)(parseInt(t[0].Value))),t=this.ScreenObject.Data.Tables[5].filter(t=>"ContractCurrency"==t.Name),t.length>0&&(this.CurrencyContract.Visible=""==t[0].Value.toString()||"0"!=t[0].Value.toString()&&"1"!=t[0].Value.toString()?Object(r.j)(t[0].Value):Object(r.j)(parseInt(t[0].Value))),t=this.ScreenObject.Data.Tables[5].filter(t=>"DimensionWiseContract"==t.Name),t.length>0&&""!=t[0].Value.toString()&&parseInt(t[0].Value.toString())>5e4&&(this.DimCCID=parseInt(t[0].Value.toString())),t=this.ScreenObject.Data.Tables[5].filter(t=>"DefaultDiminPayterms"==t.Name),this.DimCCID>0&&t.length>0&&""!=t[0].Value.toString()&&(this.DefaultDiminPayterms=parseInt(t[0].Value.toString())),t=this.ScreenObject.Data.Tables[5].filter(t=>"DimensionWiseFields"==t.Name),t.length>0&&""!=t[0].Value.toString()&&104!=this.CostCenterID&&parseInt(t[0].Value.toString())>5e4&&(this.DimWiseFields=parseInt(t[0].Value.toString()))}if(null!=this.ScreenObject.Data&&this.ScreenObject.Data.Tables.length>12&&this.ScreenObject.Data.Tables[12].length>0)for(let e=0;e<this.ScreenObject.Data.Tables[12].length;e++)this.ContractNumber.ComboBox.Items.push(c.d.ComboBoxItems_2(this.ScreenObject.Data.Tables[12][e].Code.toString(),this.ScreenObject.Data.Tables[12][e].NodeID.toString()));if(null!=this.ScreenObject.Data&&this.ScreenObject.Data.Tables.length>6&&this.ScreenObject.Data.Tables[6].length>0&&this.ScreenObject.Data.Columns[6].Contains("NormalUnit")&&""!=this.ScreenObject.Data.Tables[6][0].NormalUnit.toString()&&(this.UnitStatusVal=this.ScreenObject.Data.Tables[6][0].NormalUnit.toString()),this.AddUnitWhere(2),null!=this.ScreenObject.Data&&this.ScreenObject.Data.Tables.length>9&&this.ScreenObject.Data.Columns[9].Contains("ACCOUNTTYPEID")){let t=[]=this.ScreenObject.Data.Tables[9].filter(t=>1==t.ACCOUNTTYPEID);for(let e=0;e<t.length;e++)this.CashAccounts.push(t[e].ACCOUNTID.toString(),t[e].ACCOUNTID.toString());t=this.ScreenObject.Data.Tables[9].filter(t=>1!=t.ACCOUNTTYPEID);for(let e=0;e<t.length;e++)this.BankAccounts.push(t[e].ACCOUNTID.toString(),t[e].ACCOUNTID.toString())}if(null!=this.ScreenObject.Data&&this.ScreenObject.Data.Tables.length>5&&this.ScreenObject.Data.Tables[5].length>0){let t=this.ScreenObject.Data.Tables[5].filter(t=>92==t.CostCenterID);t.length>0&&""!=t[0].Value.toString()&&(this.PropertyCCID=parseInt(t[0].Value.toString())),t=this.ScreenObject.Data.Tables[5].filter(t=>93==t.CostCenterID),t.length>0&&""!=t[0].Value.toString()&&(this.UnitCCID=parseInt(t[0].Value.toString())),t=this.ScreenObject.Data.Tables[5].filter(t=>94==t.CostCenterID),t.length>0&&""!=t[0].Value.toString()&&(this.TenantCCID=parseInt(t[0].Value.toString()))}Logger.InfoLog("AddEditRenContractViewModel ::Exiting OnLoad")}onAddRowPay(t,e){this.UpdateSequencePay(),n.e.IsEmpty(e)||(e.Row.SNO=this.PSNO)}onDeleteRowPay(t,e){this.UpdateSequencePay()}UpdateSequence(){this.SNO=1,this.DataTable.forEach(t=>{"0"!=n.e.StringValue(t.Display)&&(t.SNO=this.SNO++),this.DataTableObj.updateRow(t)})}UpdateSequencePay(){this.PSNO=1,this.PayTermsDataTable.forEach(t=>{t.SNO=this.PSNO++})}GenerateXMLs(){Logger.InfoLog("AddEditRenContractViewModel ::Entering GenerateXMLs"),this.strContractNo=this.ContractNumber.ComboBox.GetselectedItem().Name+"~"+this.ContractNumber.TextBox.Text.Trim();let t=this.cntrct.GetProductID("CONTRACT");return null!=t&&t.Tables.length>0&&t.Tables[0].length>0&&(this.ProductID=parseInt(t.Tables[0][0][0])),0==this.ProductID&&(this.objProduct.ProductCode="CONTRACT",this.objProduct.ProductName="CONTRACT",this.objProduct.AliasName="CONTRACT",this.objProduct.ProductType=1,this.objProduct.ProductStatus=31,this.objProduct.Valuation=1,this.objProduct.LotWise=!1,this.objProduct.UOM=1,this.objProduct.SalesAccount=3,this.objProduct.PurchaseAccount=2,this.objProduct.COGSAccount=4,this.objProduct.ClosingStockAccount=5,this.objProduct.PurchaseRates=0,this.objProduct.SellingRates=0,this.objProduct.ReorderLevel=0,this.objProduct.ReorderQty=0,this.objProduct.ShelfLife=0,this.objProduct.Packing="",this.objProduct.Barcode="",this.objProduct.Category=0,this.objProduct.Department=0,this.objProduct.Description="",this.objProduct.ProductGroup=1,this.objProduct.CustomFieldsQuery="",this.objProduct.CustomCostCenterFieldsQuery="",this.objProduct.ContactsXML="",this.objProduct.NotesXML="",this.objProduct.AttachmetsXML="",this.objProduct.GUID="GUID",this.objProduct.AddProduct("","AddProduct").subscribe(t=>{this.DisplayMessage=t.Message,this.ProductID=t.RetValue})),Logger.InfoLog("AddEditRenContractViewModel ::Exiting GenerateXMLs"),this.ProductID>0}GetContractDetailsXML(){Logger.InfoLog("AddEditRenContractViewModel ::Entering GetContractDetailsXML");let t="";try{let e=0;t+='<ContractXML UpdateQuery="';for(let a=0;a<this.ContractParticular.length;a++)this.ContractParticular[a].DisplayMember.startsWith("CCNID")&&this.DataTableColumns.Contains(this.ContractParticular[a].ValueMember)&&(t+=this.ContractParticular[a].DisplayMember+"=X.value('@"+this.ContractParticular[a].DisplayMember+"','BIGINT'), ");t+='" ><Rows>';for(let a=0;a<this.DataTable.length;a++)if(!n.e.IsEmpty(this.DataTable[a].NodeID)){e++,t+='<Row  CCID="',s.a.SessionManager.Preferences.ContainsKey("DepositLinkDimension")&&""!=s.a.SessionManager.Preferences.DepositLinkDimension?t+=s.a.SessionManager.Preferences.DepositLinkDimension:t+="0",t+='" CCNodeID="'+this.DataTable[a].NodeID.toString(),t+='" CreditAccID="'+this.DataTable[a].CreditAccountID_Key.toString(),""!=n.e.StringValue(this.DataTable[a].AdvanceAcc)&&(t+='" AdvanceAccountID="'+this.DataTable[a].AdvanceAcc.toString()),""!=n.e.StringValue(this.DataTable[a].VatPer)&&(t+='" VatPer="'+this.DataTable[a].VatPer.toString()),""!=n.e.StringValue(this.DataTable[a].VatAmount)&&(t+='" VatAmount="'+this.DataTable[a].VatAmount.toString()),""!=n.e.StringValue(this.DataTable[a].InclChkGen)&&(t+='" InclChkGen="'+this.DataTable[a].InclChkGen.toString()),""!=n.e.StringValue(this.DataTable[a].VatType)&&(t+='" VatType="'+this.DataTable[a].VatType.toString()),""!=n.e.StringValue(this.DataTable[a].TaxCategory_Key)&&(t+='" TaxCategoryID="'+this.DataTable[a].TaxCategory_Key.toString()),this.DataTableColumns.Contains("SPType_Key")&&""!=n.e.StringValue(this.DataTable[a].SPType_Key)&&(t+='" SPType="'+this.DataTable[a].SPType_Key.toString()),""!=n.e.StringValue(this.DataTable[a].RecurInvoice)&&(t+='" Recur="'+this.DataTable[a].RecurInvoice.toString().toLowerCase()),""!=n.e.StringValue(this.DataTable[a].PostDebit)&&(t+='" PostDebit="'+this.DataTable[a].PostDebit.toString()),""!=n.e.StringValue(this.DataTable[a].TaxableAmt)&&(t+='" TaxableAmt="'+this.DataTable[a].TaxableAmt.toString()),t+='" SNO="'+e.toString(),""!=n.e.StringValue(this.DataTable[a].Sqft)&&(t+='" Sqft="'+this.DataTable[a].Sqft.toString()),""!=n.e.StringValue(this.DataTable[a].Rate)&&(t+='" Rate="'+this.DataTable[a].Rate.toString()),t+='" RentAmount="'+n.e.StringValue(this.DataTable[a].ActAmount),t+='" Discount="'+n.e.StringValue(this.DataTable[a].Discount),!n.e.IsEmpty(this.DataTable[a].Amount)&&n.e.DoubleTryParse(this.DataTable[a].Amount.toString())>0?t+='" Amount="'+this.DataTable[a].Amount.toString():t+='" Amount="0',t+='" Narration="'+m.d.GetValidXml(n.e.StringValue(this.DataTable[a].Narration)),this.DataTableColumns.Contains("Location")&&""!=n.e.StringValue(this.DataTable[a].Location_Key)&&(t+='" LocationID="'+this.DataTable[a].Location_Key.toString()),this.DataTableColumns.Contains("Dim_Key")&&""!=n.e.StringValue(this.DataTable[a].Dim_Key)&&(t+='" DimNodeID="'+this.DataTable[a].Dim_Key.toString()),this.DataTableColumns.Contains("SalesMan_Key")&&!n.e.IsEmpty(this.DataTable[a].SalesMan_Key)&&(t+='" SalesManID="'+this.DataTable[a].SalesMan_Key.toString()),null!=this.DataTable[a].ChequeNo&&""!=n.e.StringValue(this.DataTable[a].ChequeNo)&&null!=this.DataTable[a].CntrlDate_Key&&""!=n.e.StringValue(this.DataTable[a].CntrlDate_Key)?(null!=this.DataTable[a].CntrlDate_Key&&""!=n.e.StringValue(this.DataTable[a].CntrlDate_Key)?t+='" ChequeDate="'+new Date(this.DataTable[a].CntrlDate_Key).ToString("dd/MMM/yyyy"):t+='" ChequeDate="',""!=n.e.StringValue(this.DataTable[a].TasjeelAmount)&&(t+='" TasjeelAmount="'+this.DataTable[a].TasjeelAmount.toString()),t+='" ChequeNo="'+n.e.StringValue(this.DataTable[a].ChequeNo),t+='" PayeeBank="'+n.e.StringValue(this.DataTable[a].PayeeBank),t+='" DebitAccID="'+n.e.StringValue(this.DataTable[a].DebitAccountID_Key),t+='" IsRecurr="0'):(a>0&&(null!=this.DataTable[a].CntrlDate_Key&&""!=n.e.StringValue(this.DataTable[a].CntrlDate_Key)?t+='" ChequeDate="'+new Date(this.DataTable[a].CntrlDate_Key).ToString("dd/MMM/yyyy"):t+='" ChequeDate="'),""!=n.e.StringValue(this.DataTable[a].TasjeelAmount)&&(t+='" TasjeelAmount="'+this.DataTable[a].TasjeelAmount.toString()),t+='" ChequeNo="',t+='" PayeeBank="',null!=this.DataTable[a].DebitAccountID_Key&&""!=n.e.StringValue(this.DataTable[a].DebitAccountID_Key)?t+='" DebitAccID="'+this.DataTable[a].DebitAccountID_Key+'" IsRecurr="0':t+='" DebitAccID="" IsRecurr="1'),t+='" ';for(let e=0;e<this.ContractParticular.length;e++)this.ContractParticular[e].DisplayMember.startsWith("CCNID")&&this.DataTableColumns.Contains(this.ContractParticular[e].ValueMember)&&""!=this.DataTable[a][this.ContractParticular[e].ValueMember].toString()&&(t+=this.ContractParticular[e].DisplayMember+'="'+this.DataTable[a][this.ContractParticular[e].ValueMember].toString()+'" ');t+=" >",""!=n.e.StringValue(this.DataTable[a].Xml)&&(t+=this.DataTable[a].Xml.toString()),t+="</Row>"}t+="</Rows></ContractXML>"}catch(e){Logger.ErrorLog("AddEditRenContractViewModel :: GetContractDetailsXML"+e.stack)}return Logger.InfoLog("AddEditRenContractViewModel ::Exiting GetContractDetailsXML"),t.toString()}GetPayTermsXML(){Logger.InfoLog("AddEditRenContractViewModel ::Entering GetPayTermsXML");let t="";try{let e=0;t+='<PayTermXML UpdateQuery="';for(let a=0;a<this.ContractPayTerms.length;a++)this.ContractPayTerms[a].DisplayMember.startsWith("CCNID")&&this.PayTermsDataTableColumns.Contains(this.ContractPayTerms[a].ValueMember)&&(t+=this.ContractPayTerms[a].DisplayMember+"=X.value('@"+this.ContractPayTerms[a].DisplayMember+"','BIGINT'), ");t+='" ><Rows>';for(let a=0;a<this.PayTermsDataTable.length;a++)if(!n.e.IsEmpty(this.PayTermsDataTable[a].CntrlDate_Key)&&!n.e.IsEmpty(this.PayTermsDataTable[a].Amount)&&""!=n.e.StringValue(this.PayTermsDataTable[a].Amount)&&parseFloat(this.PayTermsDataTable[a].Amount.toString())>0){e++;let i=new Date(this.PayTermsDataTable[a].CntrlDate_Key);n.e.IsEmpty(this.PayTermsDataTable[a].ChequeNo)&&(this.PayTermsDataTable[a].ChequeNo=""),n.e.IsEmpty(this.PayTermsDataTable[a].PayeeBank)&&(this.PayTermsDataTable[a].PayeeBank=""),t+='<Row ChequeNo="'+n.e.StringValue(this.PayTermsDataTable[a].ChequeNo),t+='" ChequeDate="'+i.ToString("dd/MMM/yyyy"),t+='" CustomerBank="'+n.e.StringValue(this.PayTermsDataTable[a].PayeeBank),t+='" Narration="'+n.e.EncodeXML(n.e.StringValue(this.PayTermsDataTable[a].Narration)),t+='" Period="'+n.e.StringValue(this.PayTermsDataTable[a].Period),t+='" SNO="'+e.toString(),t+='" DebitAccID="'+n.e.StringValue(this.PayTermsDataTable[a].DebitAccountID_Key),this.InclPostingDate&&""!=n.e.StringValue(this.PayTermsDataTable[a].PostingDate_Key)&&(t+='" PostingDate="'+new Date(this.PayTermsDataTable[a].PostingDate_Key.toString()).ToString("dd/MMM/yyy")),""!=n.e.StringValue(this.PayTermsDataTable[a].TillDate_Key)&&(t+='" TillDate="'+new Date(this.PayTermsDataTable[a].TillDate_Key.toString()).ToString("dd/MMM/yyyy")),this.PayTermsDataTableColumns.Contains("Location")&&""!=n.e.StringValue(this.PayTermsDataTable[a].Location_Key)&&(t+='" LocationID="'+this.PayTermsDataTable[a].Location_Key.toString()),this.PayTermsDataTableColumns.Contains("Dim_Key")&&""!=n.e.StringValue(this.PayTermsDataTable[a].Dim_Key)&&(t+='" DimNodeID="'+this.PayTermsDataTable[a].Dim_Key.toString()),this.PayTermsDataTableColumns.Contains("SalesMan_Key")&&!n.e.IsEmpty(this.PayTermsDataTable[a].SalesMan_Key)&&(t+='" SalesManID="'+this.PayTermsDataTable[a].SalesMan_Key.toString()),this.PayTermsDataTableColumns.Contains("Particulars_Key")&&""!=n.e.StringValue(this.PayTermsDataTable[a].Particulars_Key)&&(t+='" Particular="'+this.PayTermsDataTable[a].Particulars_Key.toString()),""!=n.e.StringValue(this.PayTermsDataTable[a].RentAmount)?t+='" RentAmount="'+this.PayTermsDataTable[a].RentAmount.toString():t+='" RentAmount="0',n.e.IsEmpty(this.PayTermsDataTable[a].Amount)||""==n.e.StringValue(this.PayTermsDataTable[a].Amount)?t+='" Amount="'+parseFloat(n.e.StringValue(this.PayTermsDataTable[a].Amount)).toString():t+='" Amount="'+this.PayTermsDataTable[a].Amount.toString(),t+='" ';for(let e=0;e<this.ContractPayTerms.length;e++)this.ContractPayTerms[e].DisplayMember.startsWith("CCNID")&&this.PayTermsDataTableColumns.Contains(this.ContractPayTerms[e].ValueMember)&&""!=this.PayTermsDataTable[a][this.ContractPayTerms[e].ValueMember].toString()&&(t+=this.ContractPayTerms[e].DisplayMember+'="'+this.PayTermsDataTable[a][this.ContractPayTerms[e].ValueMember].toString()+'" ');t+=" />"}t+="</Rows></PayTermXML>"}catch(e){Logger.ErrorLog("AddEditRenContractViewModel :: GetPayTermsXML"+e.stack)}return Logger.InfoLog("AddEditRenContractViewModel ::Exiting GetPayTermsXML"),t.toString()}GetSalemanXml(t){return n.e.IsEmpty(t.SalesMan_Key)?"":" dcCCNID"+(this.Salesman.CCID-5e4).toString()+"="+t.SalesMan_Key.toString()+","}GetReceiptXML(t){if(0==this.PayTermsDataTable.length||95==this.CostCenterID&&this.SinglePDC)return"";Logger.InfoLog("AddEditRenContractViewModel ::Entering GetReceiptXML");let e=0,a="",i=this.ContractDate.Date;if(n.e.IsEmpty(this.PayTermsDataTable[0].CntrlDate_Key)||(i=new Date(this.PayTermsDataTable[0].CntrlDate_Key)),this.BankAccounts.ContainsKey(n.e.String(this.PayTermsDataTable[0].DebitAccountID_Key))||this.PDCAccounts.ContainsKey(n.e.StringValue(this.PayTermsDataTable[0].DebitAccountID_Key))?(this.PostBankRct&&"cash"==this.GetPayBank(this.PayTermsDataTable[0].PayeeBank.toString()).toLowerCase()?a+='<ReceiptXML><ROWS><AccountType  DD="Rct"></AccountType><Documents DDate="':a+='<ReceiptXML><ROWS><AccountType  DD="BANK"></AccountType><Documents DDate="',this.InclPostingDate&&!n.e.IsEmpty(this.PayTermsDataTable[0].PostingDate_Key)?a+=new Date(this.PayTermsDataTable[0].PostingDate_Key.toString()).ToString("dd/MMM/yyyy"):a+=this.ContractDate.Date.ToString("dd/MMM/yyyy"),a+='"  DocID="'+n.e.String(this.PayTermsDataTable[0].DocID)+'"></Documents><DocumentXML>',this.strType=!0):this.CashAccounts.ContainsKey(n.e.String(this.PayTermsDataTable[0].DebitAccountID_Key))?(a+='<ReceiptXML><ROWS><AccountType  DD="CASH"></AccountType><Documents DDate="',this.InclPostingDate&&!n.e.IsEmpty(this.PayTermsDataTable[0].PostingDate_Key)?a+=new Date(this.PayTermsDataTable[0].PostingDate_Key.toString()).ToString("dd/MMM/yyyy"):a+=this.JVRecieptonPaymentDate?i.ToString("dd/MMM/yyyy"):this.ContractDate.Date.ToString("dd/MMM/yyyy"),a+='"  DocID="'+n.e.String(this.PayTermsDataTable[0].DocID)+'"></Documents><DocumentXML>',this.strType=!0):(a+='<ReceiptXML><ROWS><AccountType  DD="JV"></AccountType><Documents DDate="',this.InclPostingDate&&!n.e.IsEmpty(this.PayTermsDataTable[0].PostingDate_Key)?a+=new Date(this.PayTermsDataTable[0].PostingDate_Key.toString()).ToString("dd/MMM/yyyy"):a+=this.JVRecieptonPaymentDate?i.ToString("dd/MMM/yyyy"):this.ContractDate.Date.ToString("dd/MMM/yyyy"),a+='"  DocID="'+n.e.String(this.PayTermsDataTable[0].DocID)+'"></Documents><DocumentXML>',this.strType=!1),!n.e.IsEmpty(this.PayTermsDataTable[0].Amount)&&parseFloat(this.PayTermsDataTable[0].Amount.toString())>0){let l=0,c=parseFloat(this.PayTermsDataTable[0].Amount.toString()),h=1;null!=this.dsprof&&this.dsprof.Tables.length>0&&this.dsprof.Columns[0].Contains("ProfileID")&&this.dsprof.Tables[0].length>0&&(h=this.dsprof.Tables[0].length);let D=0;var o=s.a.SessionManager.Preferences.DistributeCostDims.split(",");for(let u=0;u<h;u++)if(h>1?(u+1==this.dsprof.Tables[0].length?l=parseFloat((c-D).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString())):!n.e.IsEmpty(this.dsprof.Tables[0][u].Percent)&&parseFloat(this.dsprof.Tables[0][u].Percent.toString())>0?l=parseFloat((c*parseFloat(this.dsprof.Tables[0][u].Percent.toString())/100).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString())):!n.e.IsEmpty(this.dsprof.Tables[0][u].Amount)&&parseFloat(this.dsprof.Tables[0][u].Amount.toString())>0&&(l=parseFloat(this.dsprof.Tables[0][u].Amount.toString())),D+=l):l=c,this.strType){a+='<Row><Transactions  CONTRACTSNO="1"  ',a+=' DocDetailsID="0"  DocSeqNo="'+u+'1"   DebitAccount="'+n.e.String(this.PayTermsDataTable[0].DebitAccountID_Key)+'" CreditAccount="'+n.e.String(this.RentRecAc.SelectedValue)+'" Amount="'+l+'" AmtFc="'+l+'"',a+=this.CurrencyContract.SelectedValue>0?' ChequeDate = "'+i.ToString("dd/MMM/yyyy")+'"  ChequeMaturityDate = "'+i.ToString("dd/MMM/yyyy")+'"  CurrencyID="'+this.CurrencyContract.SelectedValue+'" ExchangeRate="1" CommonNarration="'+m.d.GetValidXml(n.e.String(this.PayTermsDataTable[0].Narration))+'" LineNarration="'+m.d.GetValidXml(n.e.String(this.PayTermsDataTable[0].Narration))+'" ChequeBankName="'+m.d.GetValidXml(this.GetPayBank(n.e.String(this.PayTermsDataTable[0].PayeeBank)))+'" ChequeNumber="'+n.e.String(this.PayTermsDataTable[0].ChequeNo)+'"':' ChequeDate = "'+i.ToString("dd/MMM/yyyy")+'"  ChequeMaturityDate = "'+i.ToString("dd/MMM/yyyy")+'"  CurrencyID="1" ExchangeRate="1" CommonNarration="'+m.d.GetValidXml(n.e.String(this.PayTermsDataTable[0].Narration))+'" LineNarration="'+m.d.GetValidXml(n.e.String(this.PayTermsDataTable[0].Narration))+'" ChequeBankName="'+m.d.GetValidXml(this.GetPayBank(n.e.String(this.PayTermsDataTable[0].PayeeBank)))+'" ChequeNumber="'+n.e.String(this.PayTermsDataTable[0].ChequeNo)+'"',a+="></Transactions> ";let r=this.AddRowCC(this.PayTermsDataTable[0],null,0,0,this.PayTermsDataTable);if(r+=this.GetSalemanXml(this.PayTermsDataTable[0]),h>1?o.forEach(t=>{parseInt(t)>5e4&&this.dsprof.Columns[0].Contains("DCCCNID"+(parseInt(t)-5e4))&&!n.e.IsEmpty(this.dsprof.Tables[0][u]["DCCCNID"+(parseInt(t)-5e4)])&&(r+="DCCCNID"+(parseInt(t)-5e4)+"="+this.dsprof.Tables[0][u]["DCCCNID"+(parseInt(t)-5e4)].toString()+",")}):null!=this.dsprof&&this.dsprof.Tables.length>0&&this.dsprof.Columns[0].Contains("ProfileID")&&1==this.dsprof.Tables[0].length&&o.forEach(t=>{parseInt(t)>5e4&&this.dsprof.Columns[0].Contains("DCCCNID"+(parseInt(t)-5e4))&&""!=this.dsprof.Tables[0][0]["DCCCNID"+(parseInt(t)-5e4)].toString()&&(r+="DCCCNID"+(parseInt(t)-5e4)+"="+this.dsprof.Tables[0][0]["DCCCNID"+(parseInt(t)-5e4)].toString()+",")}),a+=' <Numeric /> <Alpha /> <CostCenters   Query="'+this.strCCQry.toString()+r+'"  /> ',a+="<EXTRAXML> ",s.a.SessionManager.Preferences.ContainsKey("On")&&"True"==s.a.SessionManager.Preferences.On&&t&&l>0){a+="<BillWise> ";let t=l;for(let i=0;i<this.DataTable.length;i++)if(!n.e.IsEmpty(this.DataTable[i].Amount)){let s=0;if(this.SingleInvoice&&this.DistribtueInvoice&&this.Invoiced>0){let a=this.Invoiced-e;t>a?(t-=a,s=a):(s=t,t=0)}else t>parseFloat(n.e.String(this.DataTable[i].Amount))?(t-=parseFloat(this.DataTable[i].Amount.toString()),s=parseFloat(this.DataTable[i].Amount.toString())):(s=t,t=0);if(s>0&&(a+=' <Row DocSeqNo="'+u+'1" AccountID="'+n.e.String(this.RentRecAc.SelectedValue),a+='" AmountFC="-'+s+'" AdjAmount="-'+s+'"',a+=' AdjCurrID="1" ',a+='AdjExchRT="1" ',a+='IsNewReference="0" ',a+='Narration="" ',a+='IsDocPDC="0" ',a+='RefDocNo="'+(i+1).toString()+'" ',a+=" ></Row>",e+=s),this.SingleInvoice&&this.DistribtueInvoice&&this.Invoiced>0&&t>0&&(a+=' <Row DocSeqNo="'+u+'1" AccountID="'+n.e.String(this.RentRecAc.SelectedValue),a+='" AmountFC="-'+t+'" AdjAmount="-'+t+'"',a+=' AdjCurrID="1" ',a+='AdjExchRT="1" ',a+='IsNewReference="1" ',a+='Narration="" ',a+='IsDocPDC="0" ',a+=" ></Row>",t=0),t<=0)break}a+=" </BillWise>"}a+="</EXTRAXML> ",a+=" </Row>"}else{a+='<Row><Transactions  CONTRACTSNO="1"  ',a+=' DocDetailsID="0"  DocSeqNo="'+2*u+'1"   DebitAccount="'+n.e.String(this.PayTermsDataTable[0].DebitAccountID_Key)+'" CreditAccount="-99" Amount="'+l+'" AmtFc="'+l+'"',a+=this.CurrencyContract.SelectedValue>0?' ChequeDate = "'+i.ToString("dd/MMM/yyyy")+'"  ChequeMaturityDate = "'+i.ToString("dd/MMM/yyyy")+'"  CurrencyID="'+this.CurrencyContract.SelectedValue+'" ExchangeRate="1" CommonNarration="'+m.d.GetValidXml(n.e.String(this.PayTermsDataTable[0].Narration))+'" LineNarration="'+m.d.GetValidXml(n.e.String(this.PayTermsDataTable[0].Narration))+'" ChequeBankName="'+m.d.GetValidXml(this.GetPayBank(n.e.String(this.PayTermsDataTable[0].PayeeBank)))+'" ChequeNumber="'+n.e.String(this.PayTermsDataTable[0].ChequeNo)+'"':' ChequeDate = "'+i.ToString("dd/MMM/yyyy")+'"  ChequeMaturityDate = "'+i.ToString("dd/MMM/yyyy")+'"  CurrencyID="1" ExchangeRate="1" CommonNarration="'+m.d.GetValidXml(n.e.String(this.PayTermsDataTable[0].Narration))+'" LineNarration="'+m.d.GetValidXml(n.e.String(this.PayTermsDataTable[0].Narration))+'" ChequeBankName="'+m.d.GetValidXml(this.GetPayBank(n.e.String(this.PayTermsDataTable[0].PayeeBank)))+'" ChequeNumber="'+n.e.String(this.PayTermsDataTable[0].ChequeNo)+'"',a+="></Transactions> ";let e="";if(this.TempCCID>5e4&&!this.strCCQry.toString().Contains("dcCCNID"+(this.TempCCID-5e4).toString()+"=")&&(e=n.e.IsEmpty(this.PayTermsDataTable[0].TempCCID_Key)?" dcCCNID"+(this.TempCCID-5e4).toString()+"=1,":" dcCCNID"+(this.TempCCID-5e4).toString()+"="+n.e.String(this.PayTermsDataTable[0].TempCCID_Key)+","),this.PayTermsDataTableColumns.Contains("Location_Key")&&!n.e.IsEmpty(this.PayTermsDataTable[0].Location_Key)?e+=" dcCCNID2="+n.e.String(this.PayTermsDataTable[0].Location_Key)+",":this.LocationContract.Visible&&this.LocationContract.SelectedValue>0&&(e+=" dcCCNID2="+this.LocationContract.SelectedValue+","),this.PayTermsDataTableColumns.Contains("Dim_Key")&&!n.e.IsEmpty(this.PayTermsDataTable[0].Dim_Key)&&(e+=" dcCCNID"+(this.DimCCID-5e4).toString()+"="+n.e.String(this.PayTermsDataTable[0].Dim_Key)+","),e+=this.GetSalemanXml(this.PayTermsDataTable[0]),this.PayTermsDataTableColumns.Contains("Particulars_Key")&&!n.e.IsEmpty(this.PayTermsDataTable[0].Particulars_Key)&&(e+=" dcCCNID"+(parseInt(s.a.SessionManager.Preferences.DepositLinkDimension)-5e4).toString()+"="+n.e.String(this.PayTermsDataTable[0].Particulars_Key)+","),this.multiVisi&&!this.strCCQry.toString().Contains("dcCCNID"+(this.UnitCCID-5e4).toString()+"=")&&(e+=" dcCCNID"+(this.UnitCCID-5e4).toString()+"="+this.UnitNodeID+","),a+=' <Numeric /> <Alpha /> <CostCenters   Query="'+this.strCCQry.toString()+e+'"  /> ',a+="<EXTRAXML> ",s.a.SessionManager.Preferences.ContainsKey("On")&&"True"==s.a.SessionManager.Preferences.On&&l>0&&!n.e.IsEmpty(this.PayTermsDataTable[0].DebitAccountID_Key)){let t=!1,e=s.a.rental.IsBillWiseAccount(parseInt(n.e.String(this.PayTermsDataTable[0].DebitAccountID_Key)));if(null!=e&&e.Tables.length>0&&e.Tables[0].length>0&&!n.e.IsEmpty(e.Tables[0][0].IsBillwise)&&(t=Object(r.j)(e.Tables[0][0].IsBillwise)),t){a+="<BillWise> ";let t=l;a+=' <Row DocSeqNo="'+2*u+'1" AccountID="'+n.e.String(this.PayTermsDataTable[0].DebitAccountID_Key),a+='" AmountFC="'+t+'" AdjAmount="'+t+'"',a+=' AdjCurrID="1" ',a+='AdjExchRT="1" ',a+='IsNewReference="1" ',a+='Narration="" ',a+='IsDocPDC="0" ',a+=" ></Row>",a+=" </BillWise>"}}if(a+="</EXTRAXML> ",a+=" </Row>",a+='<Row><Transactions  CONTRACTSNO="1"  ',a+=' DocDetailsID="0"  DocSeqNo="'+2*u+'2"   DebitAccount="-99" CreditAccount="'+n.e.String(this.RentRecAc.SelectedValue)+'" Amount="'+l+'" AmtFc="'+l+'"',a+=this.CurrencyContract.SelectedValue>0?' ChequeDate = "'+i.ToString("dd/MMM/yyyy")+'"  ChequeMaturityDate = "'+i.ToString("dd/MMM/yyyy")+'"  CurrencyID="'+this.CurrencyContract.SelectedValue+'" ExchangeRate="1" CommonNarration="'+m.d.GetValidXml(n.e.String(this.PayTermsDataTable[0].Narration))+'" LineNarration="'+m.d.GetValidXml(n.e.String(this.PayTermsDataTable[0].Narration))+'" ChequeBankName="'+m.d.GetValidXml(this.GetPayBank(n.e.String(this.PayTermsDataTable[0].PayeeBank)))+'" ChequeNumber="'+n.e.String(this.PayTermsDataTable[0].ChequeNo)+'"':' ChequeDate = "'+i.ToString("dd/MMM/yyyy")+'"  ChequeMaturityDate = "'+i.ToString("dd/MMM/yyyy")+'"  CurrencyID="1" ExchangeRate="1" CommonNarration="'+m.d.GetValidXml(n.e.String(this.PayTermsDataTable[0].Narration))+'" LineNarration="'+m.d.GetValidXml(n.e.String(this.PayTermsDataTable[0].Narration))+'" ChequeBankName="'+m.d.GetValidXml(this.GetPayBank(n.e.String(this.PayTermsDataTable[0].PayeeBank)))+'" ChequeNumber="'+n.e.String(this.PayTermsDataTable[0].ChequeNo)+'"',a+="></Transactions> ",e="",this.TempCCID>5e4&&!this.strCCQry.toString().Contains("dcCCNID"+(this.TempCCID-5e4).toString()+"=")&&(e=n.e.IsEmpty(this.PayTermsDataTable[0].TempCCID_Key)?" dcCCNID"+(this.TempCCID-5e4).toString()+"=1,":" dcCCNID"+(this.TempCCID-5e4).toString()+"="+this.PayTermsDataTable[0].TempCCID_Key.toString()+","),this.PayTermsDataTableColumns.Contains("Location_Key")&&!n.e.IsEmpty(this.PayTermsDataTable[0].Location_Key)?e+=" dcCCNID2="+this.PayTermsDataTable[0].Location_Key.toString()+",":this.LocationContract.Visible&&this.LocationContract.SelectedValue>0&&(e+=" dcCCNID2="+this.LocationContract.SelectedValue+","),this.PayTermsDataTableColumns.Contains("Dim_Key")&&!n.e.IsEmpty(this.PayTermsDataTable[0].Dim_Key)&&(e+=" dcCCNID"+(this.DimCCID-5e4).toString()+"="+n.e.String(this.PayTermsDataTable[0].Dim_Key)+","),e+=this.GetSalemanXml(this.PayTermsDataTable[0]),this.PayTermsDataTableColumns.Contains("Particulars_Key")&&!n.e.IsEmpty(this.PayTermsDataTable[0].Particulars_Key)&&(e+=" dcCCNID"+(parseInt(s.a.SessionManager.Preferences.DepositLinkDimension)-5e4).toString()+"="+n.e.String(this.PayTermsDataTable[0].Particulars_Key)+","),this.multiVisi&&!this.strCCQry.toString().Contains("dcCCNID"+(this.UnitCCID-5e4).toString()+"=")&&(e+=" dcCCNID"+(this.UnitCCID-5e4).toString()+"="+this.UnitNodeID+","),a+=' <Numeric /> <Alpha /> <CostCenters   Query="'+this.strCCQry.toString()+e+'"  /> ',a+="<EXTRAXML> ",s.a.SessionManager.Preferences.ContainsKey("On")&&"True"==s.a.SessionManager.Preferences.On&&t&&l>0){a+="<BillWise> ";let t=l;for(let e=0;e<this.DataTable.length;e++)if((n.e.IsEmpty(this.DataTable[e].DebitAccountID_Key)||!(parseInt(n.e.String(this.DataTable[e].DebitAccountID_Key))>0))&&!n.e.IsEmpty(this.DataTable[e].Amount)){let i=0;if(this.SingleInvoice&&this.DistribtueInvoice&&this.Invoiced>0?t>this.Invoiced?(t-=this.Invoiced,i=this.Invoiced):(i=t,t=0):t>parseFloat(n.e.String(this.DataTable[e].Amount))?(t-=parseFloat(n.e.String(this.DataTable[e].Amount)),i=parseFloat(n.e.String(this.DataTable[e].Amount))):(i=t,t=0),a+=' <Row DocSeqNo="'+2*u+'2" AccountID="'+n.e.String(this.RentRecAc.SelectedValue),a+='" AmountFC="-'+i+'" AdjAmount="-'+i+'"',a+=' AdjCurrID="1" ',a+='AdjExchRT="1" ',a+='IsNewReference="0" ',a+='Narration="" ',a+='IsDocPDC="0" ',a+='RefDocNo="'+(e+1).toString()+'" ',a+=" ></Row>",this.ValueUsed+=i,this.SingleInvoice&&this.DistribtueInvoice&&this.Invoiced>0&&t>0&&(a+=' <Row DocSeqNo="'+2*u+'2" AccountID="'+n.e.String(this.RentRecAc.SelectedValue),a+='" AmountFC="-'+t+'" AdjAmount="-'+t+'"',a+=' AdjCurrID="1" ',a+='AdjExchRT="1" ',a+='IsNewReference="1" ',a+='Narration="" ',a+='IsDocPDC="0" ',a+=" ></Row>",this.ValueUsed+=t,t=0),t<=0)break}a+=" </BillWise>"}a+="</EXTRAXML> ",a+=" </Row>"}}return a+="</DocumentXML></ROWS></ReceiptXML>",Logger.InfoLog("AddEditRenContractViewModel ::Exiting GetReceiptXML"),a.toString()}GetReceipts(t,e){Logger.InfoLog("AddEditRenContractViewModel ::Entering GetPDReceiptXML");let a="",i=null;e=0;let o=!1,l=0;for(let c=0;c<this.PayTermsDataTable.length;c++)if(!n.e.IsEmpty(this.PayTermsDataTable[c].DebitAccountID_Key)&&""!=n.e.StringValue(this.PayTermsDataTable[c].DebitAccountID_Key)&&parseInt(this.PayTermsDataTable[c].DebitAccountID_Key)>0&&!n.e.IsEmpty(this.PayTermsDataTable[c].Amount)&&""!=n.e.StringValue(this.PayTermsDataTable[c].Amount)&&parseFloat(this.PayTermsDataTable[c].Amount.toString())>0){if(e++,0==t&&this.BankAccounts.ContainsKey(this.PayTermsDataTable[c].DebitAccountID_Key.toString())||this.PDCAccounts.ContainsKey(this.PayTermsDataTable[c].DebitAccountID_Key.toString())?(a+='<ROWS><Documents DD="BANK" ></Documents><DocumentXML>',this.strType=!0):0==t&&this.CashAccounts.ContainsKey(this.PayTermsDataTable[c].DebitAccountID_Key.toString())?(a+='<ROWS><Documents DD="CASH" ></Documents><DocumentXML>',this.strType=!0):(a+='<ROWS><Documents DD="JV" ></Documents><DocumentXML>',this.strType=!1),null==i&&(i=s.a.rental.GetPostingDetails(this.cntrct,0,this.CurrCostCenterID,0,0,0,this.cntrct.PropertyID,this.cntrct.UnitID,this.cntrct.TenantID,this.cntrct.RentRecID)),null!=i&&i.Tables.length>0&&(this.ProductID=parseInt(i.Tables[0][0].PRODUCTID.toString()),this.GetCCData(i.Tables[0]),n.e.IsEmpty(i.Tables[0][0].IsBillwise)||(o=Object(r.j)(i.Tables[0][0].IsBillwise.toString())),471==t&&(n.e.IsEmpty(i.Tables[0][0].AdvReceivableCloseAccID)||(l=parseInt(i.Tables[0][0].AdvReceivableCloseAccID.toString())),n.e.IsEmpty(i.Tables[0][0].AdvReceivableBillwise)||(o=Object(r.j)(i.Tables[0][0].AdvReceivableBillwise.toString())))),this.strType){a+='<Row><Transactions   CONTRACTSNO="'+(c+1).toString()+'" ',a+=' DocDetailsID="0"  DocSeqNo="1" ',a+=471==t?' DebitAccount="'+this.RentRecAc.SelectedValue.toString()+'" CreditAccount="'+l.toString():' DebitAccount="'+this.PayTermsDataTable[c].DebitAccountID_Key.toString()+'" CreditAccount="'+this.RentRecAc.SelectedValue.toString(),a+='" Amount="'+parseFloat(this.PayTermsDataTable[c].Amount)+'"  AmtFc="'+parseFloat(this.PayTermsDataTable[c].Amount)+'" ',n.e.IsEmpty(this.PayTermsDataTable[c].CntrlDate_Key)||(a+=' ChequeDate = "'+new Date(this.PayTermsDataTable[c].CntrlDate_Key.toString()).ToString("dd/MMM/yyyy")+'" ChequeMaturityDate = "'+new Date(this.PayTermsDataTable[c].CntrlDate_Key).ToString("dd/MMM/yyyy")+'" '),a+=' CurrencyID="1" ExchangeRate="1" CommonNarration="'+m.d.GetValidXml(this.PayTermsDataTable[c].Narration.toString())+'" LineNarration="'+m.d.GetValidXml(this.PayTermsDataTable[c].Narration.toString())+'"  ChequeBankName="'+m.d.GetValidXml(this.GetPayBank(this.PayTermsDataTable[c].PayeeBank.toString()))+'" ChequeNumber="'+this.PayTermsDataTable[c].ChequeNo.toString()+'"',a+="></Transactions> ";let e="";this.PayTermsDataTableColumns.Contains("Location_Key")&&""!=n.e.StringValue(this.PayTermsDataTable[c].Location_Key)?e+=" dcCCNID2="+this.PayTermsDataTable[c].Location_Key.toString()+",":this.LocationContract.Visible&&this.LocationContract.SelectedValue>0&&(e+=" dcCCNID2="+this.LocationContract.SelectedValue+","),this.PayTermsDataTableColumns.Contains("Dim_Key")&&""!=n.e.StringValue(this.PayTermsDataTable[c].Dim_Key)&&(e+=" dcCCNID"+(this.DimCCID-5e4).toString()+"="+this.PayTermsDataTable[c].Dim_Key.toString()+","),e+=this.GetSalemanXml(this.PayTermsDataTable[c]),this.TempCCID>5e4&&!this.strCCQry.toString().Contains("dcCCNID"+(this.TempCCID-5e4).toString()+"=")&&(""!=n.e.StringValue(this.PayTermsDataTable[c].TempCCID_Key)?e+=" dcCCNID"+(this.TempCCID-5e4).toString()+"="+this.PayTermsDataTable[c].TempCCID_Key.toString()+",":e+=" dcCCNID"+(this.TempCCID-5e4).toString()+"=1,"),a+=' <Numeric /> <Alpha /> <CostCenters   Query="'+this.strCCQry.toString()+e+'"  />   ',a+="<EXTRAXML> ",s.a.SessionManager.Preferences.ContainsKey("On")&&"True"==s.a.SessionManager.Preferences.On&&o&&(a+="<BillWise> ",a+=' <Row DocSeqNo="1" AccountID="',a+=471==t?l.toString():this.RentRecAc.SelectedValue.toString(),a+='" AmountFC="-'+this.PayTermsDataTable[c].Amount.toString()+'" AdjAmount="-'+this.PayTermsDataTable[c].Amount.toString()+'"',a+=' AdjCurrID="1" ',a+='AdjExchRT="1" ',a+='IsNewReference="1" ',a+='Narration="" ',a+='IsDocPDC="0" ',a+=" ></Row>",a+=" </BillWise>"),a+="</EXTRAXML> ",a+=" </Row>"}else{a+='<Row><Transactions   CONTRACTSNO="'+(c+1).toString()+'" ',a+=' DocDetailsID="0"  DocSeqNo="1" ',a+=471==t?' DebitAccount="'+this.RentRecAc.SelectedValue.toString()+'" ':' DebitAccount="'+this.PayTermsDataTable[c].DebitAccountID_Key.toString()+'" ',a+=' CreditAccount="-99" Amount="'+parseFloat(this.PayTermsDataTable[c].Amount)+'"  AmtFc="'+parseFloat(this.PayTermsDataTable[c].Amount)+'" ',a+=' CurrencyID="1" ExchangeRate="1" CommonNarration="'+m.d.GetValidXml(this.PayTermsDataTable[c].Narration.toString())+'" LineNarration="'+m.d.GetValidXml(this.PayTermsDataTable[c].Narration.toString())+'"  ChequeBankName="'+m.d.GetValidXml(this.GetPayBank(this.PayTermsDataTable[c].PayeeBank.toString()))+'" ChequeNumber="'+this.PayTermsDataTable[c].ChequeNo.toString()+'"',a+="></Transactions> ";let e="";if(this.TempCCID>5e4&&!this.strCCQry.toString().Contains("dcCCNID"+(this.TempCCID-5e4).toString()+"=")&&(e=""!=n.e.StringValue(this.PayTermsDataTable[c].TempCCID_Key)?" dcCCNID"+(this.TempCCID-5e4).toString()+"="+this.PayTermsDataTable[c].TempCCID_Key.toString()+",":" dcCCNID"+(this.TempCCID-5e4).toString()+"=1,"),this.PayTermsDataTableColumns.Contains("Location_Key")&&""!=n.e.StringValue(this.PayTermsDataTable[c].Location_Key)?e+=" dcCCNID2="+this.PayTermsDataTable[c].Location_Key.toString()+",":this.LocationContract.Visible&&this.LocationContract.SelectedValue>0&&(e+=" dcCCNID2="+this.LocationContract.SelectedValue+","),this.PayTermsDataTableColumns.Contains("Dim_Key")&&""!=n.e.StringValue(this.PayTermsDataTable[c].Dim_Key)&&(e+=" dcCCNID"+(this.DimCCID-5e4).toString()+"="+this.PayTermsDataTable[c].Dim_Key.toString()+","),e+=this.GetSalemanXml(this.PayTermsDataTable[c]),a+=' <Numeric /> <Alpha /> <CostCenters   Query="'+this.strCCQry.toString()+e+'"  /> ',a+="<EXTRAXML> ",s.a.SessionManager.Preferences.ContainsKey("On")&&"True"==s.a.SessionManager.Preferences.On){let e=!1,i=s.a.rental.IsBillWiseAccount(parseInt(this.PayTermsDataTable[c].DebitAccountID_Key.toString()));null!=i&&i.Tables.length>0&&i.Tables[0].length>0&&!n.e.IsEmpty(i.Tables[0][0].IsBillwise)&&(e=Object(r.j)(i.Tables[0][0].IsBillwise)),e&&(a+="<BillWise> ",a+=' <Row DocSeqNo="1" AccountID="',a+=471==t?this.RentRecAc.SelectedValue.toString():this.PayTermsDataTable[c].DebitAccountID_Key.toString(),a+='" AmountFC="'+this.PayTermsDataTable[c].Amount.toString()+'" AdjAmount="'+this.PayTermsDataTable[c].Amount.toString()+'"',a+=' AdjCurrID="1" ',a+='AdjExchRT="1" ',a+='IsNewReference="1" ',a+='Narration="" ',a+='IsDocPDC="0" ',a+=" ></Row>",a+=" </BillWise>")}a+="</EXTRAXML> ",a+=" </Row>",a+='<Row><Transactions   CONTRACTSNO="'+(c+1).toString()+'" ',a+=' DocDetailsID="0"  DocSeqNo="2"   DebitAccount="-99" ',a+=471==t?' CreditAccount="'+l.toString()+'" ':' CreditAccount="'+this.RentRecAc.SelectedValue.toString()+'" ',a+=' Amount="'+parseFloat(this.PayTermsDataTable[c].Amount)+'"  AmtFc="'+parseFloat(this.PayTermsDataTable[c].Amount)+'" ',a+=' CurrencyID="1" ExchangeRate="1" CommonNarration="'+m.d.GetValidXml(this.PayTermsDataTable[c].Narration.toString())+'" LineNarration="'+m.d.GetValidXml(this.PayTermsDataTable[c].Narration.toString())+'"  ChequeBankName="'+m.d.GetValidXml(this.GetPayBank(this.PayTermsDataTable[c].PayeeBank.toString()))+'" ChequeNumber="'+this.PayTermsDataTable[c].ChequeNo.toString()+'"',a+="></Transactions> ",e="",this.TempCCID>5e4&&!this.strCCQry.toString().Contains("dcCCNID"+(this.TempCCID-5e4).toString()+"=")&&(e=""!=n.e.StringValue(this.PayTermsDataTable[c].TempCCID_Key)?" dcCCNID"+(this.TempCCID-5e4).toString()+"="+this.PayTermsDataTable[c].TempCCID_Key.toString()+",":" dcCCNID"+(this.TempCCID-5e4).toString()+"=1,"),this.PayTermsDataTableColumns.Contains("Location_Key")&&""!=n.e.StringValue(this.PayTermsDataTable[c].Location_Key)?e+=" dcCCNID2="+this.PayTermsDataTable[c].Location_Key.toString()+",":this.LocationContract.Visible&&this.LocationContract.SelectedValue>0&&(e+=" dcCCNID2="+this.LocationContract.SelectedValue+","),this.PayTermsDataTableColumns.Contains("Dim_Key")&&""!=n.e.StringValue(this.PayTermsDataTable[c].Dim_Key)&&(e+=" dcCCNID"+(this.DimCCID-5e4).toString()+"="+this.PayTermsDataTable[c].Dim_Key.toString()+","),e+=this.GetSalemanXml(this.PayTermsDataTable[c]),a+=' <Numeric /> <Alpha /> <CostCenters   Query="'+this.strCCQry.toString()+e+'"  /> ',a+="<EXTRAXML> ",s.a.SessionManager.Preferences.ContainsKey("On")&&"True"==s.a.SessionManager.Preferences.On&&o&&(a+="<BillWise> ",a+=' <Row DocSeqNo="2" AccountID="',a+=471==t?l.toString():this.RentRecAc.SelectedValue.toString(),a+='" AmountFC="-'+this.PayTermsDataTable[c].Amount.toString()+'" AdjAmount="-'+this.PayTermsDataTable[c].Amount.toString()+'"',a+=' AdjCurrID="1" ',a+='AdjExchRT="1" ',a+='IsNewReference="0" ',a+='Narration="" ',a+='IsDocPDC="0" ',a+=" ></Row>",a+=" </BillWise>"),a+="</EXTRAXML> ",a+=" </Row>"}a+="</DocumentXML></ROWS>"}return a.length>0&&(a="<PDR>"+a,a+="</PDR>"),Logger.InfoLog("AddEditRenContractViewModel ::Exiting GetPDReceiptXML"),{sbIssue:a,Count:e}}GetJVPayXML(t,e,a){let i="",o=0,l=parseFloat(n.e.String(this.PayTermsDataTable[e].Amount)),c=1;null!=this.dsprof&&this.dsprof.Tables.length>0&&this.dsprof.Columns[0].Contains("ProfileID")&&this.dsprof.Tables[0].length>0&&(c=this.dsprof.Tables[0].length);let h=0;var D=s.a.SessionManager.Preferences.DistributeCostDims.split(",");for(let u=0;u<c;u++){c>1?(u+1==this.dsprof.Tables[0].length?o=parseFloat((l-h).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString())):!n.e.IsEmpty(this.dsprof.Tables[0][u].Percent)&&parseFloat(this.dsprof.Tables[0][u].Percent.toString())>0?o=parseFloat((l*parseFloat(this.dsprof.Tables[0][u].Percent.toString())/100).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString())):!n.e.IsEmpty(this.dsprof.Tables[0][u].Amount)&&parseFloat(this.dsprof.Tables[0][u].Amount.toString())>0&&(o=parseFloat(this.dsprof.Tables[0][u].Amount.toString())),h+=o):o=l,i+='<Row><Transactions CONTRACTSNO="'+(e+1).toString()+'" ',i+='DocDetailsID="0" DocSeqNo="'+2*u+'1" ',i+=104==this.CurrCostCenterID?'CreditAccount="'+n.e.String(this.PayTermsDataTable[e].DebitAccountID_Key)+'" DebitAccount="-99" ':'DebitAccount="'+n.e.String(this.PayTermsDataTable[e].DebitAccountID_Key)+'" CreditAccount="-99" ',i+='Amount="'+o+'" AmtFc="'+o+'" ',i+=' ChequeDate = "'+a.ToString("dd/MMM/yyyy")+'" ChequeMaturityDate = "'+a.ToString("dd/MMM/yyyy")+'" ',i+=this.CurrencyContract.SelectedValue>0?'CurrencyID="'+this.CurrencyContract.SelectedValue+'" ':'CurrencyID="1" ',i+='ExchangeRate="1" CommonNarration="'+m.d.GetValidXml(n.e.String(this.PayTermsDataTable[e].Narration))+'" LineNarration="'+m.d.GetValidXml(n.e.String(this.PayTermsDataTable[e].Narration))+'"  ChequeBankName="'+m.d.GetValidXml(this.GetPayBank(n.e.String(this.PayTermsDataTable[e].PayeeBank)))+'" ChequeNumber="'+n.e.String(this.PayTermsDataTable[e].ChequeNo)+'" ',i+="></Transactions> ";let C=this.AddRowCC(this.PayTermsDataTable[e],null,0,0,this.PayTermsDataTable);if(C+=this.GetSalemanXml(this.PayTermsDataTable[e]),c>1?D.forEach(t=>{parseInt(t)>5e4&&this.dsprof.Columns[0].Contains("DCCCNID"+(parseInt(t)-5e4))&&!n.e.IsEmpty(this.dsprof.Tables[0][u]["DCCCNID"+(parseInt(t)-5e4)])&&(C+="DCCCNID"+(parseInt(t)-5e4)+"="+this.dsprof.Tables[0][u]["DCCCNID"+(parseInt(t)-5e4)].toString()+",")}):null!=this.dsprof&&this.dsprof.Tables.length>0&&this.dsprof.Columns[0].Contains("ProfileID")&&1==this.dsprof.Tables[0].length&&D.forEach(t=>{parseInt(t)>5e4&&this.dsprof.Columns[0].Contains("DCCCNID"+(parseInt(t)-5e4))&&""!=this.dsprof.Tables[0][0]["DCCCNID"+(parseInt(t)-5e4)].toString()&&(C+="DCCCNID"+(parseInt(t)-5e4)+"="+this.dsprof.Tables[0][0]["DCCCNID"+(parseInt(t)-5e4)].toString()+",")}),i+="<EXTRAXML> ",s.a.SessionManager.Preferences.ContainsKey("On")&&"True"==s.a.SessionManager.Preferences.On&&o>0&&!n.e.IsEmpty(this.PayTermsDataTable[e].DebitAccountID_Key)){let t=!1,a=s.a.rental.IsBillWiseAccount(parseInt(n.e.String(this.PayTermsDataTable[e].DebitAccountID_Key)));if(null!=a&&a.Tables.length>0&&a.Tables[0].length>0&&!n.e.IsEmpty(a.Tables[0][0].IsBillwise)&&(t=Object(r.j)(a.Tables[0][0].IsBillwise)),t){i+="<BillWise> ";let t=o;i+=' <Row DocSeqNo="'+2*u+'1" AccountID="'+n.e.String(this.PayTermsDataTable[e].DebitAccountID_Key),i+=104==this.CurrCostCenterID?'" AmountFC="-'+t+'" AdjAmount="-'+t+'"':'" AmountFC="'+t+'" AdjAmount="'+t+'"',i+=' AdjCurrID="1" ',i+='AdjExchRT="1" ',i+='IsNewReference="1" ',i+='Narration="" ',i+='IsDocPDC="0" ',i+=" ></Row>",i+=" </BillWise>"}}if(i+="</EXTRAXML> ",i+=" </Row>",i+='<Row><Transactions CONTRACTSNO="'+(e+1).toString()+'" ',i+='DocDetailsID="0" DocSeqNo="'+2*(u+1)+'" ',i+=104==this.CurrCostCenterID?'CreditAccount="-99" DebitAccount="'+n.e.String(this.RentRecAc.SelectedValue)+'" ':'DebitAccount="-99" CreditAccount="'+n.e.String(this.RentRecAc.SelectedValue)+'" ',i+='Amount="'+o+'" AmtFc="'+o+'" ',i+='ChequeDate = "'+a.ToString("dd/MMM/yyyy")+'" ChequeMaturityDate = "'+a.ToString("dd/MMM/yyyy")+'" ',i+=this.CurrencyContract.SelectedValue>0?'CurrencyID="'+this.CurrencyContract.SelectedValue+'" ':'CurrencyID="1" ',i+='ExchangeRate="1" CommonNarration="'+m.d.GetValidXml(n.e.String(this.PayTermsDataTable[e].Narration))+'" LineNarration="'+m.d.GetValidXml(n.e.String(this.PayTermsDataTable[e].Narration))+'"  ChequeBankName="'+m.d.GetValidXml(this.GetPayBank(n.e.String(this.PayTermsDataTable[e].PayeeBank)))+'" ChequeNumber="'+n.e.String(this.PayTermsDataTable[e].ChequeNo)+'" ',i+="></Transactions> ",c>1?D.forEach(t=>{parseInt(t)>5e4&&this.dsprof.Columns[0].Contains("DCCCNID"+(parseInt(t)-5e4))&&!n.e.IsEmpty(this.dsprof.Tables[0][u]["DCCCNID"+(parseInt(t)-5e4)])&&(C+="DCCCNID"+(parseInt(t)-5e4)+"="+this.dsprof.Tables[0][u]["DCCCNID"+(parseInt(t)-5e4)].toString()+",")}):null!=this.dsprof&&this.dsprof.Tables.length>0&&this.dsprof.Columns[0].Contains("ProfileID")&&1==this.dsprof.Tables[0].length&&D.forEach(t=>{parseInt(t)>5e4&&this.dsprof.Columns[0].Contains("DCCCNID"+(parseInt(t)-5e4))&&""!=this.dsprof.Tables[0][0]["DCCCNID"+(parseInt(t)-5e4)].toString()&&(C+="DCCCNID"+(parseInt(t)-5e4)+"="+this.dsprof.Tables[0][0]["DCCCNID"+(parseInt(t)-5e4)].toString()+",")}),i+=' <Numeric /> <Alpha /> <CostCenters   Query="'+this.strCCQry.toString()+C+'"  /> ',i+="<EXTRAXML> ",s.a.SessionManager.Preferences.ContainsKey("On")&&"True"==s.a.SessionManager.Preferences.On&&t&&o>0){i+="<BillWise> ";let t=o,e=0;for(let a=0;a<this.DataTable.length;a++)if((n.e.IsEmpty(this.DataTable[a].DebitAccountID_Key)||!(parseInt(n.e.String(this.DataTable[a].DebitAccountID_Key))>0))&&!n.e.IsEmpty(this.DataTable[a].Amount)){let s=0;if(this.SingleInvoice&&this.DistribtueInvoice&&this.Invoiced>0){let e=this.Invoiced-this.ValueUsed;e>0&&(t>e?(t-=e,s=e):(s=t,t=0))}else{if(e+=parseFloat(n.e.String(this.DataTable[a].Amount)),e<this.ValueUsed)continue;let i=e-this.ValueUsed;t>i?(t-=i,s=i):(s=t,t=0)}if(s>0&&(i+=' <Row DocSeqNo="'+2*(u+1)+'" AccountID="'+n.e.String(this.RentRecAc.SelectedValue),i+=104==this.CurrCostCenterID?'" AmountFC="'+t+'" AdjAmount="'+t+'"':'" AmountFC="-'+s+'" AdjAmount="-'+s+'"',i+=' AdjCurrID="1" ',i+='AdjExchRT="1" ',i+='IsNewReference="0" ',i+='Narration="" ',i+='IsDocPDC="0" ',i+='RefDocNo="'+(a+1).toString()+'" ',i+=" ></Row>",this.ValueUsed+=s),this.SingleInvoice&&this.DistribtueInvoice&&this.Invoiced>0&&t>0&&(i+=' <Row DocSeqNo="'+2*(u+1)+'" AccountID="'+n.e.String(this.RentRecAc.SelectedValue),i+=104==this.CurrCostCenterID?'" AmountFC="'+t+'" AdjAmount="'+t+'"':'" AmountFC="-'+t+'" AdjAmount="-'+t+'"',i+=' AdjCurrID="1" ',i+='AdjExchRT="1" ',i+='IsNewReference="1" ',i+='Narration="" ',i+='IsDocPDC="0" ',i+=" ></Row>",this.ValueUsed+=s,t=0),t<=0)break}i+=" </BillWise>"}i+="</EXTRAXML> ",i+=" </Row>"}return i.toString()}GetOpeningPayXML(){let t,e=0,a="";for(let i=0;i<this.PayTermsDataTable.length;i++)if(!n.e.IsEmpty(this.PayTermsDataTable[i].DebitAccountID_Key)&&parseInt(this.PayTermsDataTable[i].DebitAccountID_Key)>0&&!n.e.IsEmpty(this.PayTermsDataTable[i].Amount)&&parseFloat(this.PayTermsDataTable[i].Amount.toString())>0){e++,t=new Date(this.PayTermsDataTable[i].CntrlDate_Key),a+='<ROWS><AccountType DD="OPB"></AccountType><Documents  DocID="'+n.e.StringValue(this.PayTermsDataTable[i].DocID)+'" DDate="'+this.ContractDate.Date.ToString("dd/MMM/yyyy")+'" /><DocumentXML>',a+='<Row><Transactions   CONTRACTSNO="'+(i+1).toString()+'" ',a+='DocDetailsID="0"  DocSeqNo="'+e+'" ',a+=104==this.CurrCostCenterID?'CreditAccount="'+n.e.StringValue(this.PayTermsDataTable[i].DebitAccountID_Key)+'" DebitAccount="-100" ':'DebitAccount="'+n.e.StringValue(this.PayTermsDataTable[i].DebitAccountID_Key)+'" CreditAccount="-100" ',(this.BankAccounts.Contains(n.e.StringValue(this.PayTermsDataTable[i].DebitAccountID_Key))||this.PDCAccounts.ContainsKey(n.e.StringValue(this.PayTermsDataTable[i].DebitAccountID_Key)))&&(""!=n.e.StringValue(this.PayTermsDataTable[i].OpPdcStatus)?a+=' OpPdcStatus="'+this.PayTermsDataTable[i].OpPdcStatus.toString()+'" ':a+=' OpPdcStatus="370" ',a+='Description="'+this.RentRecAc.SelectedValue+'" PostPDC="1" '),a+='Amount="'+parseFloat(this.PayTermsDataTable[i].Amount)+'"  AmtFc="'+parseFloat(this.PayTermsDataTable[i].Amount)+'" ',a+=' ChequeDate = "'+t.ToString("dd/MMM/yyyy")+'" ChequeMaturityDate = "'+t.ToString("dd/MMM/yyyy")+'" ',a+=this.CurrencyContract.SelectedValue>0?'CurrencyID="'+this.CurrencyContract.SelectedValue+'" ':'CurrencyID="1" ',a+='ExchangeRate="1" CommonNarration="'+m.d.GetValidXml(n.e.StringValue(this.PayTermsDataTable[i].Narration))+'" LineNarration="'+m.d.GetValidXml(this.PayTermsDataTable[i].Narration.toString())+'"  ChequeBankName="'+m.d.GetValidXml(this.GetPayBank(n.e.StringValue(this.PayTermsDataTable[i].PayeeBank)))+'" ChequeNumber="'+n.e.StringValue(this.PayTermsDataTable[i].ChequeNo)+'" ',a+="></Transactions> ";let r="";this.TempCCID>5e4&&!this.strCCQry.toString().Contains("dcCCNID"+(this.TempCCID-5e4).toString()+"=")&&(r=n.e.IsEmpty(this.PayTermsDataTable[i].TempCCID_Key)?" dcCCNID"+(this.TempCCID-5e4).toString()+"=1,":" dcCCNID"+(this.TempCCID-5e4).toString()+"="+this.PayTermsDataTable[i].TempCCID_Key.toString()+","),this.PayTermsDataTableColumns.Contains("Location_Key")&&!n.e.IsEmpty(this.PayTermsDataTable[i].Location_Key)?r+=" dcCCNID2="+this.PayTermsDataTable[i].Location_Key.toString()+",":this.LocationContract.Visible&&this.LocationContract.SelectedValue>0&&(r+=" dcCCNID2="+this.LocationContract.SelectedValue+","),this.PayTermsDataTableColumns.Contains("Dim_Key")&&!n.e.IsEmpty(this.PayTermsDataTable[i].Dim_Key)&&(r+=" dcCCNID"+(this.DimCCID-5e4).toString()+"="+this.PayTermsDataTable[i].Dim_Key.toString()+","),r+=this.GetSalemanXml(this.PayTermsDataTable[i]),this.multiVisi&&!this.strCCQry.toString().Contains("dcCCNID"+(this.UnitCCID-5e4).toString()+"=")&&(r+=" dcCCNID"+(this.UnitCCID-5e4).toString()+"="+this.UnitNodeID+","),this.PayTermsDataTableColumns.Contains("Particulars_Key")&&!n.e.IsEmpty(this.PayTermsDataTable[i].Particulars_Key)&&(r+=" dcCCNID"+(parseInt(s.a.SessionManager.Preferences.DepositLinkDimension)-5e4).toString()+"="+this.PayTermsDataTable[i].Particulars_Key.toString()+","),a+=' <Numeric /> <Alpha /> <CostCenters   Query="'+this.strCCQry.toString()+r+'"  /> ',a+="<EXTRAXML> ",a+="</EXTRAXML> ",a+=" </Row></DocumentXML></ROWS>"}return a.length>0&&(a="<PDR>"+a,a+="</PDR>"),a.toString()}GetRecPayXML(t,e,a,i,r){let o="",l=0,c=parseFloat(n.e.String(this.PayTermsDataTable[e].Amount)),h=1;null!=this.dsprof&&this.dsprof.Tables.length>0&&this.dsprof.Columns[0].Contains("ProfileID")&&this.dsprof.Tables[0].length>0&&(h=this.dsprof.Tables[0].length);let D=0;var u=s.a.SessionManager.Preferences.DistributeCostDims.split(",");for(let C=0;C<h;C++){h>1?(C+1==this.dsprof.Tables[0].length?l=parseFloat((c-D).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString())):!n.e.IsEmpty(this.dsprof.Tables[0][C].Percent)&&parseFloat(this.dsprof.Tables[0][C].Percent.toString())>0?l=parseFloat((c*parseFloat(this.dsprof.Tables[0][C].Percent.toString())/100).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString())):!n.e.IsEmpty(this.dsprof.Tables[0][C].Amount)&&parseFloat(this.dsprof.Tables[0][C].Amount.toString())>0&&(l=parseFloat(this.dsprof.Tables[0][C].Amount.toString())),D+=l):l=c,o+='<Row><Transactions   CONTRACTSNO="'+e+'1" ',i&&this.PayTermsDataTableColumns.Contains("AccDocDetailsid")&&""!=this.PayTermsDataTable[e].AccDocDetailsid.toString()&&this.PayTermsDataTableColumns.Contains("DocumentType")&&("19"==this.PayTermsDataTable[e].DocumentType.toString()||"369"==this.PayTermsDataTable[e].DocStatusID.toString()||"429"==this.PayTermsDataTable[e].DocStatusID.toString())?o+=' IgnoreEdit="1" DocDetailsID="'+this.PayTermsDataTable[e].AccDocDetailsid.toString()+'" ':o+=' DocDetailsID="0"',o+=this.SinglePDC&&i&&1==h?' DocSeqNo="'+r+'1" ':' DocSeqNo="'+C+'1" ',o+=104==this.CurrCostCenterID?'CreditAccount="'+n.e.String(this.PayTermsDataTable[e].DebitAccountID_Key)+'" DebitAccount="'+n.e.String(this.RentRecAc.SelectedValue)+'" ':'DebitAccount="'+n.e.String(this.PayTermsDataTable[e].DebitAccountID_Key)+'" CreditAccount="'+n.e.String(this.RentRecAc.SelectedValue)+'" ',o+='Amount="'+l+'"  AmtFc="'+l+'" ',o+=' ChequeDate = "'+a.ToString("dd/MMM/yyyy")+'" ChequeMaturityDate = "'+a.ToString("dd/MMM/yyyy")+'" ',o+=this.CurrencyContract.SelectedValue>0?'CurrencyID="'+this.CurrencyContract.SelectedValue+'" ':'CurrencyID="1" ',o+='ExchangeRate="1" CommonNarration="'+m.d.GetValidXml(n.e.String(this.PayTermsDataTable[e].Narration))+'" LineNarration="'+m.d.GetValidXml(n.e.String(this.PayTermsDataTable[e].Narration))+'"  ChequeBankName="'+m.d.GetValidXml(this.GetPayBank(n.e.String(this.PayTermsDataTable[e].PayeeBank)))+'" ChequeNumber="'+n.e.String(this.PayTermsDataTable[e].ChequeNo)+'" ',o+="></Transactions> ";let S=this.AddRowCC(this.PayTermsDataTable[e],null,0,0,this.PayTermsDataTable);if(S+=this.GetSalemanXml(this.PayTermsDataTable[e]),h>1?u.forEach(t=>{parseInt(t)>5e4&&this.dsprof.Columns[0].Contains("DCCCNID"+(parseInt(t)-5e4))&&!n.e.IsEmpty(this.dsprof.Tables[0][C]["DCCCNID"+(parseInt(t)-5e4)])&&(S+="DCCCNID"+(parseInt(t)-5e4)+"="+this.dsprof.Tables[0][C]["DCCCNID"+(parseInt(t)-5e4)].toString()+",")}):null!=this.dsprof&&this.dsprof.Tables.length>0&&this.dsprof.Columns[0].Contains("ProfileID")&&1==this.dsprof.Tables[0].length&&u.forEach(t=>{parseInt(t)>5e4&&this.dsprof.Columns[0].Contains("DCCCNID"+(parseInt(t)-5e4))&&""!=this.dsprof.Tables[0][0]["DCCCNID"+(parseInt(t)-5e4)].toString()&&(S+="DCCCNID"+(parseInt(t)-5e4)+"="+this.dsprof.Tables[0][0]["DCCCNID"+(parseInt(t)-5e4)].toString()+",")}),o+=' <Numeric /> <Alpha /> <CostCenters   Query="'+this.strCCQry.toString()+S+'"  /> ',o+="<EXTRAXML> ",s.a.SessionManager.Preferences.ContainsKey("On")&&"True"==s.a.SessionManager.Preferences.On&&t&&l>0){o+="<BillWise> ";let t=l,e=0;for(let a=0;a<this.DataTable.length;a++)if((n.e.IsEmpty(this.DataTable[a].DebitAccountID_Key)||!(parseInt(this.DataTable[a].DebitAccountID_Key.toString())>0))&&!n.e.IsEmpty(this.DataTable[a].Amount)){let i=0;if(this.SingleInvoice&&this.DistribtueInvoice&&this.Invoiced>0){let e=this.Invoiced-this.ValueUsed;e>0&&(t>e?(t-=e,i=e):(i=t,t=0))}else{if(e+=parseFloat(n.e.String(this.DataTable[a].Amount)),e<=this.ValueUsed)continue;let s=e-this.ValueUsed;t>s?(t-=s,i=s):(i=t,t=0)}if(i>0&&(o+=' <Row DocSeqNo="'+C+'1"  AccountID="'+n.e.String(this.RentRecAc.SelectedValue),o+=104==this.CurrCostCenterID?'" AmountFC="'+i+'" AdjAmount="'+i+'"':'" AmountFC="-'+i+'" AdjAmount="-'+i+'"',o+=' AdjCurrID="1" ',o+='AdjExchRT="1" ',o+='IsNewReference="0" ',o+='Narration="" ',o+='IsDocPDC="0" ',o+='RefDocNo="'+(a+1).toString()+'" ',o+=" ></Row>",this.ValueUsed+=i),this.SingleInvoice&&this.DistribtueInvoice&&this.Invoiced>0&&t>0&&(o+=' <Row DocSeqNo="'+C+'1" AccountID="'+n.e.String(this.RentRecAc.SelectedValue),o+=104==this.CurrCostCenterID?'" AmountFC="'+t+'" AdjAmount="'+t+'"':'" AmountFC="-'+t+'" AdjAmount="-'+t+'"',o+=' AdjCurrID="1" ',o+='AdjExchRT="1" ',o+='IsNewReference="1" ',o+='Narration="" ',o+='IsDocPDC="0" ',o+=" ></Row>",this.ValueUsed+=i,t=0),t<=0)break}o+=" </BillWise>"}o+="</EXTRAXML> ",o+=" </Row>"}return o.toString()}GetPDReceiptXML(t){Logger.InfoLog("AddEditRenContractViewModel ::Entering GetPDReceiptXML");let e,a,i,s="";104==this.CurrCostCenterID?(s+="<PDPayment>",i=0):(s+="<PDR>",i=95==this.CostCenterID&&(this.SinglePDC||this.IsOpening)?0:1);let r=new T.a,o=new T.a,l=new T.a,c=new T.a,h=new T.a;for(;i<this.PayTermsDataTable.length;i++)!n.e.IsEmpty(this.PayTermsDataTable[i].DebitAccountID_Key)&&""!=n.e.StringValue(this.PayTermsDataTable[i].DebitAccountID_Key)&&parseInt(this.PayTermsDataTable[i].DebitAccountID_Key)>0&&!n.e.IsEmpty(this.PayTermsDataTable[i].Amount)&&""!=n.e.StringValue(this.PayTermsDataTable[i].Amount)&&parseFloat(this.PayTermsDataTable[i].Amount.toString())>0&&(e=new Date(this.PayTermsDataTable[i].CntrlDate_Key),a=95==this.CurrCostCenterID&&this.InclPostingDate&&""!=n.e.StringValue(this.PayTermsDataTable[i].PostingDate_Key)?new Date(this.PayTermsDataTable[i].PostingDate_Key.toString()):this.JVRecieptonPaymentDate?e:this.ContractDate.Date,this.BankAccounts.ContainsKey(this.PayTermsDataTable[i].DebitAccountID_Key.toString())||this.PDCAccounts.ContainsKey(this.PayTermsDataTable[i].DebitAccountID_Key.toString())?(this.PostBankRct&&"cash"==this.GetPayBank(this.PayTermsDataTable[i].PayeeBank.toString()).toLowerCase()?s+='<ROWS><AccountType DD="Rct"></AccountType><Documents  DDate="':s+='<ROWS><AccountType DD="BANK"></AccountType><Documents  DDate="',95==this.CurrCostCenterID&&this.InclPostingDate&&""!=n.e.StringValue(this.PayTermsDataTable[i].PostingDate_Key)?s+=new Date(this.PayTermsDataTable[i].PostingDate_Key.toString()).ToString("dd/MMM/yyyy"):s+=this.ContractDate.Date.ToString("dd/MMM/yyyy"),s+='"  DocID="'+n.e.StringValue(this.PayTermsDataTable[i].DocID)+'"></Documents><DocumentXML>',this.strType=!0,95==this.CostCenterID&&this.SinglePDC&&(this.PostBankRct&&"cash"==this.GetPayBank(this.PayTermsDataTable[i].PayeeBank.toString()).toLowerCase()?(c.ContainsKey(a)||c.push(a,""),c[a]+=this.GetRecPayXML(t,i,e,!1,1)):(o.ContainsKey(a)||(o.push(a,""),h.push(a,0)),o[a]+=this.GetRecPayXML(t,i,e,!0,h[a]),h[a]++))):this.CashAccounts.ContainsKey(this.PayTermsDataTable[i].DebitAccountID_Key.toString())?(s+='<ROWS><AccountType DD="CASH"></AccountType><Documents  DDate="',95==this.CurrCostCenterID&&this.InclPostingDate&&""!=n.e.StringValue(this.PayTermsDataTable[i].PostingDate_Key)?s+=new Date(this.PayTermsDataTable[i].PostingDate_Key.toString()).ToString("dd/MMM/yyyy"):s+=this.JVRecieptonPaymentDate?e.ToString("dd/MMM/yyyy"):this.ContractDate.Date.ToString("dd/MMM/yyyy"),s+='"  DocID="'+n.e.StringValue(this.PayTermsDataTable[i].DocID)+'"></Documents><DocumentXML>',this.strType=!0,95==this.CostCenterID&&this.SinglePDC&&(l.ContainsKey(a)||l.push(a,""),l[a]+=this.GetRecPayXML(t,i,e,!1,1))):(s+='<ROWS><AccountType DD="JV"></AccountType><Documents  DDate="',95==this.CurrCostCenterID&&this.InclPostingDate&&""!=n.e.StringValue(this.PayTermsDataTable[i].PostingDate_Key)?s+=new Date(this.PayTermsDataTable[i].PostingDate_Key.toString()).ToString("dd/MMM/yyyy"):s+=this.JVRecieptonPaymentDate?e.ToString("dd/MMM/yyyy"):this.ContractDate.Date.ToString("dd/MMM/yyyy"),s+='"  DocID="'+n.e.StringValue(this.PayTermsDataTable[i].DocID)+'"></Documents><DocumentXML>',this.strType=!1,95==this.CostCenterID&&this.SinglePDC&&(r.ContainsKey(a)||r.push(a,""),r[a]+=this.GetJVPayXML(t,i,e))),95==this.CostCenterID&&this.SinglePDC||(s+=this.strType?this.GetRecPayXML(t,i,e,!1,1):this.GetJVPayXML(t,i,e)),s+='</DocumentXML><ChequeDocDate DD="'+e.ToString("dd/MMM/yyyy")+'"></ChequeDocDate></ROWS>');if(95==this.CostCenterID&&this.SinglePDC){s="",s+="<PDR>";for(let t=0;t<o.length;t++)console.log(o),s+='<ROWS><AccountType DD="BANK"></AccountType><Documents  DDate="',s+=o.ElementAt(t).Key.ToString("dd/MMM/yyyy"),s+='"  DocID="0"></Documents>',s+='<DocumentXML IgnoreConvertedPDC="1" >',s+=o.ElementAt(t).Value.toString(),s+="</DocumentXML>",s+='<ChequeDocDate DD="'+o.ElementAt(t).Key.ToString("dd/MMM/yyyy")+'"></ChequeDocDate></ROWS>';if(this.PostBankRct)for(let t=0;t<c.length;t++)console.log(c),s+='<ROWS><AccountType DD="Rct"></AccountType><Documents  DDate="',s+=c.ElementAt(t).Key.ToString("dd/MMM/yyyy"),s+='"  DocID="0"></Documents>',s+="<DocumentXML >",s+=c.ElementAt(t).Value.toString(),s+="</DocumentXML>",s+='<ChequeDocDate DD="'+c.ElementAt(t).Key.ToString("dd/MMM/yyyy")+'"></ChequeDocDate></ROWS>';for(let t=0;t<l.length;t++)console.log(l),s+='<ROWS><AccountType DD="CASH"></AccountType><Documents  DDate="',s+=l.ElementAt(t).Key.ToString("dd/MMM/yyyy"),s+='"  DocID="0"></Documents>',s+="<DocumentXML>",s+=l.ElementAt(t).Value.toString(),s+="</DocumentXML>",s+='<ChequeDocDate DD="'+l.ElementAt(t).Key.ToString("dd/MMM/yyyy")+'"></ChequeDocDate></ROWS>';for(let t=0;t<r.length;t++)console.log(r),s+='<ROWS><AccountType DD="JV"></AccountType><Documents  DDate="',s+=r.ElementAt(t).Key.ToString("dd/MMM/yyyy"),s+='"  DocID="0"></Documents>',s+="<DocumentXML>",s+=r.ElementAt(t).Value.toString(),s+="</DocumentXML>",s+='<ChequeDocDate DD="'+r.ElementAt(t).Key.ToString("dd/MMM/yyyy")+'"></ChequeDocDate></ROWS>';s+="</PDR>"}else s+=104==this.CurrCostCenterID?"</PDPayment>":"</PDR>";return Logger.InfoLog("AddEditRenContractViewModel ::Exiting GetPDReceiptXML"),s.toString()}GetPayBank(t){if(!n.e.IsEmpty(t)){let e=this.ContractPayTerms.find(t=>"PayNodeID"==t.DisplayMember);if(null!=e&&e.ComboData instanceof DataView){let a=e.ComboData.filter(e=>e.PayeeBank==t);if(a.length>0)return a[0].PayNodeID.toString()}return t}}GetPartReceiptXML(t){let e="",a=null;Logger.InfoLog("AddEditRenContractViewModel ::Entering GetPartReceiptXML"),e+="<PARTICULARS>";for(let i=1;i<this.DataTable.length;i++)if(!n.e.IsEmpty(this.DataTable[i].DebitAccountID_Key)&&""!=n.e.StringValue(this.DataTable[i].DebitAccountID_Key)&&parseInt(this.DataTable[i].DebitAccountID_Key.toString())>0&&!n.e.IsEmpty(this.DataTable[i].Amount)&&""!=n.e.StringValue(this.DataTable[i].Amount)&&parseFloat(this.DataTable[i].Amount.toString())>0){if("True"==n.e.StringValue(this.DataTable[i].PostDebit))continue;n.e.IsEmpty(this.DataTable[i].CntrlDate_Key)||""==this.DataTable[i].CntrlDate_Key.toString()||(a=new Date(this.DataTable[i].CntrlDate_Key)),this.BankAccounts.ContainsKey(n.e.StringValue(this.DataTable[i].DebitAccountID_Key))?e+='<ROWS><AccountType DD="BANK"></AccountType><Documents DocID="'+n.e.StringValue(this.DataTable[i].DocID)+'"></Documents><DocumentXML>':e+='<ROWS><AccountType DD="CASH"></AccountType><Documents DocID="'+n.e.StringValue(this.DataTable[i].DocID)+'"></Documents><DocumentXML>';let r=1,o=null;if(""!=n.e.StringValue(this.DataTable[i].Xml)&&this.multiVisi){let t=new n.f;t.LoadXml(this.DataTable[i].Xml.toString()),t.DocumentElement.children.length>0&&null!=t.DocumentElement.children[0].attributes&&null!=t.DocumentElement.children[0].attributes.Filter&&!n.e.StringIsNullOrEmpty(t.DocumentElement.children[0].attributes.Filter.value)&&(0!=parseInt(t.DocumentElement.children[0].attributes.Filter.value)&&1!=parseInt(t.DocumentElement.children[0].attributes.Filter.value)||(r=this.SelectedUnits.split(",").length,o=0==parseInt(t.DocumentElement.children[0].attributes.Filter.value)?t.SelectNodes("XML/UnitsRow"):t.SelectNodes("XML/Row"),null==this.MultiNode&&(this.MultiNode=s.a.rental.GetUnitNodeIDs(this.SelectedUnits))))}for(let c=0;c<r;c++){e+='<Row><Transactions  CONTRACTSNO="'+(i+1).toString()+'" ',e+=' DocDetailsID="0"  DocSeqNo="1" ',e+=104==this.CurrCostCenterID?'CreditAccount="'+n.e.StringValue(this.DataTable[i].DebitAccountID_Key)+'" DebitAccount="'+this.RentRecAc.SelectedValue+'" ':this.DontpostSIV?'DebitAccount="'+n.e.StringValue(this.DataTable[i].DebitAccountID_Key)+'" CreditAccount="'+n.e.StringValue(this.DataTable[i].CreditAccountID_Key)+'" ':'DebitAccount="'+n.e.StringValue(this.DataTable[i].DebitAccountID_Key)+'" CreditAccount="'+this.RentRecAc.SelectedValue+'" ',null!=o&&r>1&&o.length>c&&null!=o[c].attributes.Amount&&!n.e.StringIsNullOrEmpty(o[c].attributes.Amount.value)?e+='Amount="'+parseFloat(o[c].attributes.Amount.value)+'" AmtFc="'+parseFloat(o[c].attributes.Amount.value)+'" ':e+='Amount="'+parseFloat(this.DataTable[i].Amount)+'" AmtFc="'+parseFloat(this.DataTable[i].Amount)+'" ',n.e.IsEmpty(a)||n.e.IsEmpty(this.DataTable[i].ChequeNo)||!n.e.StringValue(this.DataTable[i].ChequeNo)||n.e.IsEmpty(this.DataTable[i].PayeeBank)||""==n.e.StringValue(this.DataTable[i].PayeeBank)?(!n.e.IsEmpty(a)&&this.CurrencyContract.SelectedValue>0?e+='ChequeDate = "'+a.Value.ToString("dd/MMM/yyyy")+'" ChequeMaturityDate = "'+a.Value.ToString("dd/MMM/yyyy")+'" ':e+='ChequeDate = "" ChequeMaturityDate = "" ',this.CurrencyContract.SelectedValue>0?e+='CurrencyID="'+this.CurrencyContract.SelectedValue+'" ':n.e.IsEmpty(a)||(e+='CurrencyID="1" '),e+='ExchangeRate="1"  ChequeBankName="" ChequeNumber="" '):(e+='ChequeDate = "'+a.Value.ToString("dd/MMM/yyyy")+'" ChequeMaturityDate = "'+a.Value.ToString("dd/MMM/yyyy")+'" ',e+=this.CurrencyContract.SelectedValue>0?'CurrencyID="'+this.CurrencyContract.SelectedValue+'" ':'CurrencyID="1" ',e+='ExchangeRate="1"  ChequeBankName="'+m.d.GetValidXml(this.GetPayBank(this.DataTable[i].PayeeBank.toString()))+'" ChequeNumber="'+n.e.StringValue(this.DataTable[i].ChequeNo)+'" '),e+=' CommonNarration="'+m.d.GetValidXml(n.e.StringValue(this.DataTable[i].Narration))+'" LineNarration="'+m.d.GetValidXml(n.e.StringValue(this.DataTable[i].Narration))+'" ',e+="></Transactions> ";let l="";if(this.TempCCID>5e4&&!this.strCCQry.toString().Contains("dcCCNID"+(this.TempCCID-5e4).toString()+"=")&&(l=""!=n.e.StringValue(this.DataTable[i].TempCCID_Key)?" dcCCNID"+(this.TempCCID-5e4).toString()+"="+this.DataTable[i].TempCCID_Key.toString()+",":" dcCCNID"+(this.TempCCID-5e4).toString()+"=1,"),this.DataTableColumns.Contains("Location_Key")&&""!=n.e.StringValue(this.DataTable[i].Location_Key)?l+=" dcCCNID2="+this.DataTable[i].Location_Key.toString()+",":this.LocationContract.Visible&&this.LocationContract.SelectedValue>0&&(l+=" dcCCNID2="+this.LocationContract.SelectedValue+","),this.DataTableColumns.Contains("Dim_Key")&&""!=n.e.StringValue(this.DataTable[i].Dim_Key)&&(l+=" dcCCNID"+(this.DimCCID-5e4).toString()+"="+this.DataTable[i].Dim_Key.toString()+","),l+=this.GetSalemanXml(this.DataTable[i]),this.multiVisi&&!this.strCCQry.toString().Contains("dcCCNID"+(this.UnitCCID-5e4).toString()+"="))if(null!=o&&r>1&&o.length>c&&null!=o[c].attributes.Unit&&!n.e.StringIsNullOrEmpty(o[c].attributes.Unit.value)){let t=this.MultiNode.filter(t=>t.UnitID==o[c].attributes.Unit.value);t.length>0&&(l+=" dcCCNID"+(this.UnitCCID-5e4).toString()+"="+t[0].nodeid.toString()+",")}else l+=" dcCCNID"+(this.UnitCCID-5e4).toString()+"="+this.UnitNodeID+",";e+=' <Numeric /> <Alpha /> <CostCenters   Query="'+this.strCCQry.toString()+l+'"  /> ',e+="<EXTRAXML> ",s.a.SessionManager.Preferences.ContainsKey("On")&&"True"==s.a.SessionManager.Preferences.On&&t&&""!=n.e.StringValue(this.DataTable[i].Amount)&&(e+='<BillWise> <Row DocSeqNo="1" AccountID="'+this.RentRecAc.SelectedValue.toString(),e+=104==this.CurrCostCenterID?'" AmountFC="'+this.DataTable[i].Amount.toString()+'" AdjAmount="'+this.DataTable[i].Amount.toString()+'"':'" AmountFC="-'+this.DataTable[i].Amount.toString()+'" AdjAmount="-'+this.DataTable[i].Amount.toString()+'"',e+=' AdjCurrID="1" ',e+='AdjExchRT="1" ',e+='IsNewReference="0" ',e+='Narration="" ',e+='IsDocPDC="0" ',e+='RefDocNo="'+(i+1).toString()+'" ',e+=" ></Row></BillWise>"),e+="</EXTRAXML> ",e+=" </Row>"}let l=new Date;n.e.IsEmpty(a)?e+='</DocumentXML><ChequeDocDate DD="'+l.ToString("dd/MMM/yyyy")+'"></ChequeDocDate></ROWS>':e+='</DocumentXML><ChequeDocDate DD="'+a.Value.ToString("dd/MMM/yyyy")+'"></ChequeDocDate></ROWS>'}return e+="</PARTICULARS>",Logger.InfoLog("AddEditRenContractViewModel ::Exiting GetPartReceiptXML"),e.toString()}GetOpeningSales(){let t="",e=0;Logger.InfoLog("AddEditRenContractViewModel ::Entering GetOpeningSales"),t+="<DocumentXML >";for(let a=0;a<this.DataTable.length;a++)if(!n.e.IsEmpty(this.DataTable[a].Amount)&&parseFloat(this.DataTable[a].Amount.toString())>0){e++,t+='<Row><Transactions   CONTRACTSNO="'+e+'" ',t+='DocDetailsID="0"  BillDate="'+this.ContractDate.Date.ToString("dd/MMM/yyyy")+'"  DocSeqNo="'+e+'"  ',t+=this.CurrencyContract.SelectedValue>0?'CurrencyID="'+this.CurrencyContract.SelectedValue+'" ':'CurrencyID="1" ',t+='ExchangeRate="1" ',104==this.CurrCostCenterID?t+=' CreditAccount="-100" DebitAccount ="'+n.e.StringValue(this.DataTable[a].CreditAccountID_Key)+'" ':(t+=' CreditAccount="'+n.e.StringValue(this.DataTable[a].CreditAccountID_Key)+'" ',t+=' DebitAccount ="-100" '),t+='  CommonNarration="'+m.d.GetValidXml(n.e.StringValue(this.DataTable[a].Narration))+'"  ',t+=' Amount="'+this.DataTable[a].Amount.toString().Replace(",",""),t+='" LineNarration="'+m.d.GetValidXml(n.e.String(this.Narration.Text))+'" ',t+="></Transactions> ";let i="";this.TempCCID>5e4&&!this.strCCQry.toString().Contains("dcCCNID"+(this.TempCCID-5e4).toString()+"=")&&(n.e.IsEmpty(this.DataTable[a].TempCCID_Key)?i+=" dcCCNID"+(this.TempCCID-5e4).toString()+"=1,":i+=" dcCCNID"+(this.TempCCID-5e4).toString()+"="+n.e.StringValue(this.DataTable[a].TempCCID_Key)+","),this.DataTableColumns.Contains("Location_Key")&&!n.e.IsEmpty(this.DataTable[a].Location_Key)?i+=" dcCCNID2="+this.DataTable[a].Location_Key.toString()+",":this.LocationContract.Visible&&this.LocationContract.SelectedValue>0&&(i+=" dcCCNID2="+this.LocationContract.SelectedValue+","),s.a.SessionManager.Preferences.ContainsKey("DepositLinkDimension")&&""!=s.a.SessionManager.Preferences.DepositLinkDimension&&parseInt(s.a.SessionManager.Preferences.DepositLinkDimension)>0&&(i+=" dcCCNID"+(parseInt(s.a.SessionManager.Preferences.DepositLinkDimension)-5e4).toString()+"="+this.DataTable[a].NodeID.toString()+","),n.e.IsEmpty(this.DataTable[a].TaxCategory_Key)||(i+=" dcCCNID60="+this.DataTable[a].TaxCategory_Key.toString()+","),this.DataTableColumns.Contains("SPType_Key")&&!n.e.IsEmpty(this.DataTable[a].SPType_Key)&&(i+=" dcCCNID61="+this.DataTable[a].SPType_Key.toString()+","),this.DataTableColumns.Contains("Dim_Key")&&!n.e.IsEmpty(this.DataTable[a].Dim_Key)&&(i+=" dcCCNID"+(this.DimCCID-5e4).toString()+"="+this.DataTable[a].Dim_Key.toString()+","),i+=this.GetSalemanXml(this.DataTable[a]),t+=' <Numeric Query="',t+='" /> <Alpha />',t+=' <CostCenters   Query="'+this.strCCQry.toString()+i+'"  /> <EXTRAXML/> ',t+=" </Row>"}return t+="</DocumentXML >",Logger.InfoLog("AddEditRenContractViewModel ::Exiting GetOpeningSales"),t.toString()}GetWhere(t,e){if(this.TenantCCID==t)return" and DCCCNID"+(t-5e4)+"="+e[0].TenantID.toString();if(this.UnitCCID==t)return" and DCCCNID"+(t-5e4)+"="+e[0].UnitID.toString();if(this.PropertyCCID==t)return" and DCCCNID"+(t-5e4)+"="+e[0].PropertyID.toString();if(this.Landlord.CCID==t)return" and DCCCNID"+(t-5e4)+"="+this.Landlord.SelectedValue.toString();if(this.Salesman.CCID==t)return" and DCCCNID"+(t-5e4)+"="+this.Salesman.SelectedValue.toString();if(this.Accountant.CCID==t)return" and DCCCNID"+(t-5e4)+"="+this.Accountant.SelectedValue.toString();var a=this.ScreenObject.GetCustomCCField_1(t);return null!=a?" and DCCCNID"+(t-5e4)+"="+a.SelectedValue.toString():""}FillCostPosting(t,e,a,i,r,o,l,c,h,D,u,C=null){if(u.CostXML1="",!(s.a.SessionManager.Preferences.ContainsKey("DistributeCost")&&"True"==s.a.SessionManager.Preferences.DistributeCost&&s.a.SessionManager.Preferences.ContainsKey("CostBasedON")&&"True"==s.a.SessionManager.Preferences.CostBasedON&&s.a.SessionManager.Preferences.ContainsKey("CostBasedONDims")&&""!=s.a.SessionManager.Preferences.CostBasedONDims))return!1;if(this.dsprof=this.GetCostingds(t,e,a,o),null!=this.dsprof&&this.dsprof.Tables.length>0&&this.dsprof.Columns[0].Contains("ProfileID")&&this.dsprof.Tables[0].length>0){let t="",o=0;var S=s.a.SessionManager.Preferences.DistributeCostDims.split(",");let b=!1;for(let s=0;s<this.dsprof.Tables[0].length;s++){let u=0;!n.e.IsEmpty(this.dsprof.Tables[0][s].Percent)&&parseFloat(this.dsprof.Tables[0][s].Percent.toString())>0?(u=parseFloat((i*parseFloat(this.dsprof.Tables[0][s].Percent.toString())/100).ToString("N"+l)),b=!0):!n.e.IsEmpty(this.dsprof.Tables[0][s].Amount)&&parseFloat(this.dsprof.Tables[0][s].Amount.toString())>0&&(u=parseFloat(this.dsprof.Tables[0][s].Amount.toString())),u>0&&(b&&s+1==this.dsprof.Tables[0].length&&(u=parseFloat((i-o).ToString("N"+l))),o+=u,t+="<RowHead/>",t+='<Row><Transactions DocDetailsID="0" IsQtyIgnored="1" DocSeqNo="50" ',t+='Quantity="" UOMConversion="1" UOMConvertedQty="1" Unit="1" Rate="'+u+'" ',t+=' CurrencyID="1" ExchangeRate="1" ',t+='Gross="'+u+'" StockValue="'+u.ToString("N"+l).Replace(",","")+'" ',t+=' StockValueFC="'+u+'" ',t+=' DynamicInvDocDetailsID="-1" ProductID="'+this.ProductID+'" CommonNarration="'+m.d.GetValidXml(n.e.StringValue(["Narration"]))+'"  ',t+=null!=c&&h>1&&c.length>D&&null!=c[D].attributes.Narration?' LineNarration="'+m.d.GetValidXml(c[D].attributes.Narration.value)+'" ':' LineNarration="'+m.d.GetValidXml(n.e.StringValue(r.Narration))+'" ',t+='  CreditAccount="'+a+'" ',t+='  DebitAccount="'+e.toString()+'" ',t+=" ></Transactions>",t+="<AccountsXML><Accounts ",t+=' CreditAccount="'+a+'" ',t+='  DebitAccount="'+e.toString()+'" ',t+=' CurrencyID="1" ExchangeRate="1" ',t+='Amount="'+u.ToString("N"+l).Replace(",","")+'" AmtFc="'+u+'" ></Accounts></AccountsXML>',t+="<EXTRAXML></EXTRAXML>",t+="<Numeric /><Alpha />",t+='<CostCenters Query="'+this.strCCQry.toString(),S.forEach(e=>{parseInt(e)>5e4&&this.dsprof.Columns[0].Contains("DCCCNID"+(parseInt(e)-5e4))&&!n.e.IsEmpty(this.dsprof.Tables[0][s]["DCCCNID"+(parseInt(e)-5e4)])&&(t+="DCCCNID"+(parseInt(e)-5e4)+"="+this.dsprof.Tables[0][s]["DCCCNID"+(parseInt(e)-5e4)].toString()+",")}),t+='" ></CostCenters>',t+="</Row>")}if(o=i-o,o>.01){t+="<RowHead/>",t+='<Row><Transactions DocDetailsID="0" IsQtyIgnored="1" DocSeqNo="50" ',t+='Quantity="" UOMConversion="1" UOMConvertedQty="1" Unit="1" Rate="'+o+'" ',t+=' CurrencyID="1" ExchangeRate="1" ',t+='Gross="'+o+'" StockValue="'+o.ToString("N"+l).Replace(",","")+'" ',t+=' StockValueFC="'+o+'" ',t+=' DynamicInvDocDetailsID="-1" ProductID="'+this.ProductID+'"  CommonNarration="'+m.d.GetValidXml(r.Narration.toString())+'"  ',t+=null!=c&&h>1&&c.length>D&&null!=c[D].attributes.Narration?' LineNarration="'+m.d.GetValidXml(c[D].attributes.Narration.value)+'" ':' LineNarration="'+m.d.GetValidXml(r.Narration.toString())+'" ',t+='  CreditAccount="'+a+'" ',t+='  DebitAccount="'+e.toString()+'" ',t+=" ></Transactions>",t+="<AccountsXML><Accounts ",t+=' CreditAccount="'+a+'" ',t+='  DebitAccount="'+e.toString()+'" ',t+=' CurrencyID="1" ExchangeRate="1" ',t+='Amount="'+o.ToString("N"+l).Replace(",","")+'" AmtFc="'+o+'" ></Accounts></AccountsXML>',t+="<EXTRAXML></EXTRAXML>",t+="<Numeric /><Alpha />";let i=this.AddRowCC(r,c,h,D,C);i+=this.GetSalemanXml(r),t+='<CostCenters Query="'+this.strCCQry.toString(),t+='" ></CostCenters>',t+="</Row>"}return u.CostXML1=t.toString(),!0}return!1}AddRowCC(t,e,a,i,r=[]){let o="";if(this.TempCCID>5e4&&!this.strCCQry.toString().Contains("dcCCNID"+(this.TempCCID-5e4).toString()+"=")&&(Object.keys(t).Contains("dcCCNID"+(this.TempCCID-5e4).toString())&&""!=t["dcCCNID"+(this.TempCCID-5e4)].toString()?o+=" dcCCNID"+(this.TempCCID-5e4).toString()+"="+t["dcCCNID"+(this.TempCCID-5e4)].toString()+",":Object.keys(t).Contains("TempCCID_Key")&&!n.e.IsEmpty(t.TempCCID_Key)?o+=" dcCCNID"+(this.TempCCID-5e4).toString()+"="+t.TempCCID_Key.toString()+",":o+=" dcCCNID"+(this.TempCCID-5e4).toString()+"=1,"),this.DimCCID>0&&50002==this.DimCCID||(Object.keys(t).Contains("dcCCNID2")&&!n.e.IsEmpty(t.dcCCNID2)?o+=" dcCCNID2="+t.dcCCNID2.toString()+",":Object.keys(t).Contains("Location_Key")&&!n.e.IsEmpty(t.Location_Key)?o+=" dcCCNID2="+t.Location_Key.toString()+",":this.LocationContract.Visible&&this.LocationContract.SelectedValue>0&&(o+=" dcCCNID2="+this.LocationContract.SelectedValue+",")),this.PayTermsDataTable.filter(e=>e==t)?this.PayTermsDataTableColumns.Contains("Particulars_Key")&&""!=n.e.String(t.Particulars_Key)&&(o+=" dcCCNID"+(parseInt(s.a.SessionManager.Preferences.DepositLinkDimension)-5e4).toString()+"="+t.Particulars_Key.toString()+","):s.a.SessionManager.Preferences.ContainsKey("DepositLinkDimension")&&""!=s.a.SessionManager.Preferences.DepositLinkDimension&&parseInt(s.a.SessionManager.Preferences.DepositLinkDimension)>0&&Object.keys(t).Contains("NodeID")&&(o+=" dcCCNID"+(parseInt(s.a.SessionManager.Preferences.DepositLinkDimension)-5e4).toString()+"="+t.NodeID.toString()+","),Object.keys(t).Contains("TaxCategory_Key")&&!n.e.IsEmpty(t.TaxCategory_Key)&&(o+=" dcCCNID60="+t.TaxCategory_Key.toString()+","),Object.keys(t).Contains("dcCCNID61")&&!n.e.IsEmpty(t.dcCCNID61)?o+=" dcCCNID61="+t.dcCCNID61.toString()+",":Object.keys(t).Contains("SPType_Key")&&!n.e.IsEmpty(t.SPType_Key)&&(o+=" dcCCNID61="+t.SPType_Key.toString()+","),Object.keys(t).Contains("Dim_Key")&&!n.e.IsEmpty(t.Dim_Key)?o+=" dcCCNID"+(this.DimCCID-5e4).toString()+"="+t.Dim_Key.toString()+",":this.DimCCID>5e4&&Object.keys(t).Contains("dcCCNID"+(this.DimCCID-5e4).toString())&&""!=t[" dcCCNID"+(this.DimCCID-5e4).toString()].toString()&&(o+=" dcCCNID"+(this.DimCCID-5e4).toString()+"="+t[" dcCCNID"+(this.DimCCID-5e4).toString()].toString()+","),this.multiVisi&&!this.strCCQry.toString().Contains("dcCCNID"+(this.UnitCCID-5e4).toString()+"="))if(null!=e&&a>1&&e.length>i&&null!=e[i].attributes.Unit&&!n.e.IsEmpty(e[i].attributes.Unit.value)){let t=this.MultiNode.filter(t=>t.UnitID==e[i].attributes.Unit.value);t.length>0&&(o+=" dcCCNID"+(this.UnitCCID-5e4).toString()+"="+t[0].nodeid.toString()+",")}else o+=" dcCCNID"+(this.UnitCCID-5e4).toString()+"="+this.UnitNodeID+",";if(r==this.DataTable)for(let s=0;s<this.ContractParticular.length;s++)this.ContractParticular[s].DisplayMember.startsWith("CCNID")&&this.DataTableColumns.Contains(this.ContractParticular[s].ValueMember)&&""!=t[this.ContractParticular[s].ValueMember].toString()&&(o+=" dc"+this.ContractParticular[s].DisplayMember+"="+t[this.ContractParticular[s].ValueMember].toString()+",");else if(r==this.PayTermsDataTable)for(let s=0;s<this.ContractPayTerms.length;s++)this.ContractPayTerms[s].DisplayMember.startsWith("CCNID")&&this.PayTermsDataTableColumns.Contains(this.ContractPayTerms[s].ValueMember)&&""!=t[this.ContractPayTerms[s].ValueMember].toString()&&(o+=" dc"+this.ContractPayTerms[s].DisplayMember+"="+t[this.ContractPayTerms[s].ValueMember].toString()+",");return o}GetSalesInvXML(t,e){if(this.IsRecurPosted){if(s.a.SessionManager.Preferences.ContainsKey("DistributeCost")&&"True"==s.a.SessionManager.Preferences.DistributeCost&&s.a.SessionManager.Preferences.ContainsKey("CostBasedON")&&"True"==s.a.SessionManager.Preferences.CostBasedON&&s.a.SessionManager.Preferences.ContainsKey("CostBasedONDims")&&""!=s.a.SessionManager.Preferences.CostBasedONDims&&(this.dsprof=this.GetCostingds(e,"0","0",this.costDims)),this.SingleInvoice&&this.DistribtueInvoice&&this.DataTable.length>0&&!n.e.IsEmpty(this.DataTable[0].DocumentNo)){let t=s.a.rental.GetAmtByVoucherNo(n.e.String(this.DataTable[0].DocumentNo));this.Invoiced=n.e.IntTryParse(t)}return""}let a="",i="",o=1,l=0;this.Invoiced=0,Logger.InfoLog("AddEditRenContractViewModel ::Entering GetSalesInvXML"),i+=104==this.CurrCostCenterID?"<PIV>":"<SIV>";let c=!1,h=!1,D=new n.f,u=1,C=0,S=null,b=this.ScreenObject.Data.Tables[5].find(t=>"DistStartDate"==t.Name);h=!!(b.length>0&&Object(r.j)(b[0].Value.toString()))&&Object(r.j)(b[0].Value),this.DistribtueInvoice&&this.DataTable.length>0&&!n.e.IsEmpty(this.DataTable[0].Xml)&&"true"==n.e.String(this.DataTable[0].RecurInvoice.toLowerCase())&&(D.LoadXml(this.DataTable[0].Xml.toString()),D.DocumentElement.children.length>0&&null!=D.DocumentElement.children[0].attributes&&null!=D.DocumentElement.children[0].attributes.Filter&&!n.e.StringIsNullOrEmpty(D.DocumentElement.children[0].attributes.Filter.value)&&(C=parseInt(D.DocumentElement.children[0].attributes.Filter.value)),1!=C&&(this.multiVisi&&0==C?(u=D.DocumentElement.children[0].children[0].children.length,S=D.DocumentElement.children[0].children[0].children):(u=D.DocumentElement.children[0].children.length,S=D.DocumentElement.children[0].children)));let d=0;n.e.IsEmpty(this.RecurDuration.Text)||(d=parseInt(this.RecurDuration.Text));for(let T=0;T<u;T++){let t,C=new Date,b=new Date;u>1?(n.e.isValidDate(S[T].attributes.FromDate.value)&&(C=new Date(S[T].attributes.FromDate.value)),n.e.isValidDate(S[T].attributes.ToDate.value)&&(b=new Date(S[T].attributes.ToDate.value)),null==S[T].attributes.Distribute||n.e.IsEmpty(S[T].attributes.Distribute.value)||(d=parseInt(S[T].attributes.Distribute.value))):C=h&&this.StartDate.Date?this.StartDate.Date:this.ContractDate.Date,t=this.DimCCID>5e4?this.DataTable.filter(t=>t.Amount>0,"Dim_Key desc,SNO"):this.DataTable;let g="";l=0;for(let h=0;h<t.length;h++)if(!n.e.IsEmpty(t[h].Amount)&&parseFloat(t[h].Amount.toString())>0){if(h>0&&"True"!=n.e.String(t[h].PostDebit)&&this.DontpostSIV&&!n.e.IsEmpty(t[h].DebitAccountID_Key)&&parseInt(t[h].DebitAccountID_Key.toString())>0)continue;if(l++,this.DimCCID>5e4){if(g!=n.e.String(t[h].Dim_Key)||0==h){if(l>1){if(i+="</DocumentXML>",c){let t;t=u>1?this.CalculateMonths_1(C,b):n.e.IntTryParse(Math.floor(this.CalculateMonths())),t/=d,t<1&&(t=1),i+="<recurXML>";let e=1;for(T>0&&(e=0);e<d;e++)i+='<Row Date="'+C.AddMonths(t*e).ToString("dd/MMM/yyyy")+'" Seq="'+e+'" />';i+="</recurXML>"}i+="</ROWS>",c=!1}i+='<ROWS DimID="'+n.e.String(t[h].Dim_Key)+'" ><Documents DocID="'+n.e.String(t[h].DocID),i+=0==T?'" CostCenterid="'+this.InvCCID:'" CostCenterid="'+this.DummyCCID,i+='" CONTRACTSNO="'+(o++).toString()+'" ></Documents><DocumentXML>'}g=n.e.String(t[h].Dim_Key)}else this.SingleInvoice&&1!=l||(i+='<ROWS><Documents DocID="'+n.e.String(t[h].DocID),i+=0==T?'" CostCenterid="'+this.InvCCID:'" CostCenterid="'+this.DummyCCID,i+='" CONTRACTSNO="'+(o++).toString()+'" ></Documents><DocumentXML>');let S=1,y=null;if(n.e.IsEmpty(t[h].Xml)){if(this.DistribtueInvoice&&!n.e.IsEmpty(t[h].RecurInvoice)&&"true"!=n.e.String(t[h].RecurInvoice.toLowerCase())&&this.SingleInvoice&&T>0)continue}else if(D.LoadXml(t[h].Xml.toString()),D.DocumentElement.children.length>0&&null!=D.DocumentElement.children[0].attributes&&null!=D.DocumentElement.children[0].attributes.Filter&&!n.e.StringIsNullOrEmpty(D.DocumentElement.children[0].attributes.Filter.value)&&(0==parseInt(D.DocumentElement.children[0].attributes.Filter.value)||1==parseInt(D.DocumentElement.children[0].attributes.Filter.value))?(S=this.SelectedUnits.split(",").length,y=0==parseInt(D.DocumentElement.children[0].attributes.Filter.value)?D.SelectNodes(u>1?"XML/UnitsRow/Row[@FromDate='"+C.ToString("dd/MMM/yyyy")+"']":"XML/UnitsRow"):D.SelectNodes("XML/Row"),null==this.MultiNode&&(this.MultiNode=s.a.rental.GetUnitNodeIDs(this.SelectedUnits))):y=D.SelectNodes("XML/Row"),1==u&&this.DistribtueInvoice&&!n.e.IsEmpty(t[h].RecurInvoice)&&"true"!=n.e.String(t[h].RecurInvoice.toLowerCase())&&this.SingleInvoice&&T>0)continue;for(let o=0;o<S;o++){i+="<RowHead/><Row><Transactions  ",i+='DocDetailsID="0"  BillDate="'+this.ContractDate.Date.ToString("dd/MMM/yyyy")+'"  DocSeqNo="1"  LinkedInvDocDetailsID= ""  LinkedFieldName= "" ProductID="'+this.ProductID+'" ',i+=this.CurrencyContract.SelectedValue>0?'CurrencyID="'+this.CurrencyContract.SelectedValue+'" ':'CurrencyID="1" ',i+='ExchangeRate="1" Unit="1" UOMConversion="1" ',104==this.CurrCostCenterID?i+='CreditAccount="'+n.e.String(this.RentRecAc.SelectedValue)+'" DebitAccount ="'+n.e.String(t[h].CreditAccountID_Key)+'" ':(n.e.IsEmpty(t[h].AdvanceAcc)?i+='CreditAccount="'+n.e.String(t[h].CreditAccountID_Key)+'"':i+='CreditAccount="'+n.e.String(t[h].AdvanceAcc)+'"',"True"!=n.e.String(t[h].PostDebit)||n.e.IsEmpty(t[h].DebitAccountID_Key)?i+=' DebitAccount ="'+n.e.String(this.RentRecAc.SelectedValue)+'" ':i+=' DebitAccount ="'+t[h].DebitAccountID_Key.toString()+'" '),i+=' Quantity="1" CommonNarration="'+m.d.GetValidXml(n.e.String(t[h].Narration))+'"  ';let l="",D="",C="",b="";u>1&&null!=y?S>1&&y.length>o&&null!=y[o].attributes.Amount&&!n.e.IsEmpty(y[o].attributes.Amount.value)?(l=y[o].attributes.Amount.value,this.DiscountPosting&&null!=y[o].attributes.Discount&&!n.e.IsEmpty(y[o].attributes.Discount.value)&&parseFloat(y[o].attributes.Discount.value)>0&&(b=y[o].attributes.Discount.value,l=(parseFloat(y[o].attributes.Discount.value)+parseFloat(l)).toString()),C=m.d.GetValidXml(null!=y[o].attributes.Narration?y[o].attributes.Narration.value:n.e.String(t[h].Narration))):(l=y[T].attributes.Amount.value,this.DiscountPosting&&null!=y[T].attributes.Discount&&!n.e.IsEmpty(y[T].attributes.Discount.value)&&parseFloat(y[T].attributes.Discount.value)>0&&(b=y[T].attributes.Discount.value,l=(parseFloat(y[o].attributes.Discount.value)+parseFloat(l)).toString()),C=m.d.GetValidXml(null!=y[T].attributes.Narration?y[T].attributes.Narration.value:n.e.String(t[h].Narration))):null!=y&&S>1&&y.length>o&&null!=y[o].attributes.Amount&&!n.e.IsEmpty(y[o].attributes.Amount.value)?(l=y[o].attributes.Amount.value,this.DiscountPosting&&null!=y[o].attributes.Discount&&!n.e.IsEmpty(y[o].attributes.Discount.value)&&parseFloat(y[o].attributes.Discount.value)>0&&(b=y[o].attributes.Discount.value,l=(parseFloat(y[o].attributes.Discount.value)+parseFloat(l)).toString()),C=m.d.GetValidXml(null!=y[o].attributes.Narration?y[o].attributes.Narration.value:n.e.String(t[h].Narration))):(l=n.e.String(t[h].Amount),this.DiscountPosting&&!n.e.IsEmpty(t[h].Discount.toString())&&parseFloat(t[h].Discount.toString())>0&&(b=t[h].Discount.toString(),l=(parseFloat(t[h].Discount.toString())+parseFloat(l)).toString()),C=m.d.GetValidXml(n.e.String(t[h].Narration))),this.DistribtueInvoice&&!n.e.IsEmpty(t[h].RecurInvoice)&&"true"==n.e.String(t[h].RecurInvoice.toLowerCase())&&d>0?(l=(parseFloat(l)/d).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()),n.e.IsEmpty(b)||(b=(parseFloat(b)/d).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString())),i+=' CanRecur="1" ',(d>1||T>0)&&(c=!0)):i+=' CanRecur="0" ',i+=' Rate="'+l.Replace(",","")+'"  Gross="'+l.Replace(",","")+'" ',i+=' LineNarration="'+C+'" ',i+="></Transactions> ";let g=this.AddRowCC(t[h],y,S,o,t);g+=this.GetSalemanXml(t[h]),i+=' <Numeric Query="',""!=b&&""!=this.Discountfield&&(i+=this.Discountfield+"=-"+b.Replace(",","")+","+this.Discountfield.Replace("dcNum","dcCalcNum")+"=-"+b.Replace(",","")+","),s.a.SessionManager.Preferences.ContainsKey("VATVersion")?(n.e.IsEmpty(t[h].VatPer)||"Inclusive"!=n.e.StringValue(t[h].VatType)||(l=(100*parseFloat(l)/(parseFloat(t[h].VatPer)+100)).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString())),D=!n.e.IsEmpty(t[h].VatPer)&&parseFloat(t[h].VatPer.toString())>0?(parseFloat(l)*parseFloat(t[h].VatPer)/100).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()):"0",i+=" dcNum51="+l.Replace(",","")+",dcCalcNum51="+l.Replace(",",""),s.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(r.j)(s.a.SessionManager.Preferences["Use Foreign Currency"])&&(i+=",dcCalcNumFC51="+l.Replace(",","")),!n.e.IsEmpty(t[h].VatPer)&&parseFloat(t[h].VatPer.toString())>0?(i+=",dcNum52="+t[h].VatPer.toString().Replace(",","")+",dcCalcNum52="+t[h].VatPer.toString().Replace(",",""),i+=",dcNum60="+t[h].VatPer.toString().Replace(",","")+",dcCalcNum60="+t[h].VatPer.toString().Replace(",",""),s.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(r.j)(s.a.SessionManager.Preferences["Use Foreign Currency"])&&(i+=",dcCalcNumFC52="+t[h].VatPer.toString().Replace(",",""),i+=",dcCalcNumFC60="+t[h].VatPer.toString().Replace(",",""))):(s.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(r.j)(s.a.SessionManager.Preferences["Use Foreign Currency"])&&(i+=",dcCalcNumFC60=0,dcCalcNumFC52=0"),i+=",dcCalcNum52=0,dcNum52=0,dcNum60=0,dcCalcNum60=0"),i+=",dcNum53="+D.Replace(",","")+",dcCalcNum53="+D.Replace(",",""),i+=",dcNum61="+D.Replace(",","")+",dcCalcNum61="+D.Replace(",",""),s.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(r.j)(s.a.SessionManager.Preferences["Use Foreign Currency"])&&(i+=",dcCalcNumFC53="+D.Replace(",",""),i+=",dcCalcNumFC61="+D.Replace(",","")),i+=",",n.e.IsEmpty(t[h].VatPer)||"Inclusive"!=n.e.StringValue(t[h].VatType)||(i+="dcNum62=-"+D.Replace(",","")+",dcCalcNum62=-"+D.Replace(",",""),s.a.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&Object(r.j)(s.a.SessionManager.Preferences["Use Foreign Currency"])&&(i+=",dcCalcNumFC62=-"+D.Replace(",","")),i+=","),i+='" /> <Alpha  Query="',i+="dcAlpha153='"+n.e.StringValue(t[h].VatType)+"',",i+="dcAlpha152='Service',",i+='" />'):i+='" /> <Alpha />',i+=' <CostCenters   Query="'+this.strCCQry.toString()+g+'"  /> <EXTRAXML/> ';let I="",p="";if(104==this.CurrCostCenterID?(I=n.e.String(t[h].CreditAccountID_Key),p=n.e.String(this.RentRecAc.SelectedValue)):(p=n.e.IsEmpty(t[h].AdvanceAcc)?n.e.String(t[h].CreditAccountID_Key):n.e.String(t[h].AdvanceAcc),I="True"!=n.e.String(t[h].PostDebit)||n.e.IsEmpty(t[h].DebitAccountID_Key)?n.e.String(this.RentRecAc.SelectedValue):t[h].DebitAccountID_Key.toString()),!(this.DonotUpdateAccounts||this.SingleInvoice&&0!=T)){this.DistribtueInvoice&&this.SingleInvoice&&(this.Invoiced+=parseFloat(l)),i+="<AccountsXML>";let r={CostXML1:""};if(this.FillCostPosting(e,I,p,parseFloat(l),t[h],this.costDims,s.a.SessionManager.Preferences.DecimalsinAmount.toString(),y,S,o,r,t)?a+=r.CostXML1:(i+="<Accounts ",i+='CreditAccount="'+p+'"  DebitAccount="'+I+'" ',i+='Amount="'+l.Replace(",","")+'" AmtFc="'+l.Replace(",","")+'"  ',i+=this.CurrencyContract.SelectedValue>0?'CurrencyID="'+this.CurrencyContract.SelectedValue+'" ':'CurrencyID="1" ',i+='ExchangeRate="1"  ></Accounts>'),!n.e.IsEmpty(D)&&"0"!=D){this.DistribtueInvoice&&this.SingleInvoice&&(this.Invoiced+=parseFloat(D)),104==this.CurrCostCenterID?(p=n.e.String(this.RentRecAc.SelectedValue),I=n.e.String(this.VatAccountID)):(p=n.e.String(this.VatAccountID),I="True"!=n.e.String(t[h].PostDebit)||n.e.IsEmpty(t[h].DebitAccountID_Key)?n.e.String(this.RentRecAc.SelectedValue):n.e.String(t[h].DebitAccountID_Key));let r={CostXML1:""};this.FillCostPosting(e,I,p,parseFloat(D),t[h],this.costDims,s.a.SessionManager.Preferences.DecimalsinAmount.toString(),y,S,o,r,t)?a+=r.CostXML1:(i+="<Accounts ",i+='CreditAccount="'+p+'"  DebitAccount="'+I+'" ',i+='Amount="'+D.Replace(",","")+'" AmtFc="'+D.Replace(",","")+'"  ',i+=this.CurrencyContract.SelectedValue>0?'CurrencyID="'+this.CurrencyContract.SelectedValue+'" ':'CurrencyID="1" ',i+='ExchangeRate="1"  ></Accounts>')}n.e.IsEmpty(b)||"0"==b||(this.DistribtueInvoice&&this.SingleInvoice&&(this.Invoiced-=parseFloat(b)),104==this.CurrCostCenterID?(I=this.RentRecAc.SelectedValue.toString(),p=this.DiscountAccount.toString()):(I=this.DiscountAccount.toString(),p="True"==t[h].PostDebit.toString()&&""!=t[h].DebitAccountID_Key.toString()?t[h].DebitAccountID_Key.toString():this.RentRecAc.SelectedValue.toString()),this.FillCostPosting(e,I,p,-parseFloat(b),t[h],this.costDims,s.a.SessionManager.Preferences.DecimalsinAmount.toString(),y,S,o,r,t)?a+=r.CostXML1:(i+="<Accounts ",i+='CreditAccount="'+p+'"  DebitAccount="'+I+'" ',i+='Amount="'+b.Replace(",","")+'" AmtFc="'+b.Replace(",","")+'"  ',i+=this.CurrencyContract.SelectedValue>0?'CurrencyID="'+this.CurrencyContract.SelectedValue+'" ':'CurrencyID="1" ',i+='ExchangeRate="1"  ></Accounts>')),i+="</AccountsXML>"}i+=" </Row>"}this.SingleInvoice||0!=this.DimCCID||(n.e.IsEmpty(a)||(i+=a),a="",i+="</DocumentXML></ROWS>")}if((this.SingleInvoice||this.DimCCID>5e4)&&l>0){if(n.e.IsEmpty(a)||(i+=a),a="",i+="</DocumentXML>",c){let t;t=u>1?this.CalculateMonths_1(C,b):n.e.IntTryParse(Math.floor(this.CalculateMonths())),t/=d,i+="<recurXML>";let e=1;for(T>0&&(e=0);e<d;e++)i+='<Row Date="'+C.AddMonths(t*e).ToString("dd/MMM/yyyy")+'" Seq="'+e+'" />';i+="</recurXML>"}i+="</ROWS>"}}return i+=104==this.CurrCostCenterID?"</PIV>":"</SIV>",Logger.InfoLog("AddEditRenContractViewModel ::Exiting GetSalesInvXML"),i.toString()}onCopy(t){return Object(i.b)(this,void 0,void 0,(function*(){const{UpdatePayTermsViewModel:e}=yield a.e(68).then(a.bind(null,"Rr92")),{UpdatepaytermsComponent:i}=yield a.e(0).then(a.bind(null,"++ql"));let n=new e("AddEditRenContractViewModel");n.UpdatePayTermsViewModel_1(this,t.item,null,1),s.a.page.ShowDialog(n,i,{Title:"Distribute",HideClose:!0,ShowCenter:!0})}))}onDistribute(t){return Object(i.b)(this,void 0,void 0,(function*(){if(!this.StartDate.Date)return this.DisplayMessage="Select Start Date",void(this.MessageVisibility=!0);if(!this.EndDate.Date)return this.DisplayMessage="Select End Date",void(this.MessageVisibility=!0);if(this.StartDate.Date>this.EndDate.Date)return this.DisplayMessage="End Date cannot be less than Start Date",this.TotalDays.Text="",void(this.MessageVisibility=!0);if(!n.e.IsEmpty(t.column.field)&&"ActAmount"==t.column.field){const{UpdatePayTermsViewModel:e}=yield a.e(68).then(a.bind(null,"Rr92")),{UpdatepaytermsComponent:i}=yield a.e(0).then(a.bind(null,"++ql"));let n=new e("AddEditRenContractViewModel");n.UpdatePayTermsViewModel_1(this,t.item,null),s.a.page.ShowDialog(n,i,{Title:"Distribute",HideClose:!0,ShowCenter:!0})}}))}GetRentReceiptXML(t){let e,a,i,r="";r+="<RENTRCT>";let o=!1;for(let h=0;h<this.DataTable.length;h++)if(!n.e.IsEmpty(this.DataTable[h].NodeID)&&null!=this.DataTable[h].Amount&&""!=this.DataTable[h].Amount.toString().Trim()&&parseFloat(this.DataTable[h].Amount.toString())>0&&(0==h&&t||!n.e.IsEmpty(this.DataTable[h].AdvanceAcc))){let t=null;0==h&&!n.e.IsEmpty(this.SelectedUnits)&&this.nomonthlyincome&&(t=s.a.rental.getPOstIntCome(this.SelectedUnits));let D=this.DataTable[h].CreditAccountID_Key.toString(),u=this.IncomeAc.SelectedValue.toString();h>0&&(u=n.e.String(this.DataTable[h].CreditAccountID_Key),D=n.e.String(this.DataTable[h].AdvanceAcc));let C=new n.f,S=-1,b=-1,d=1,T=this.UnitNodeID,g=null;n.e.IsEmpty(this.DataTable[h].Xml)||(C.LoadXml(this.DataTable[h].Xml.toString()),C.DocumentElement.children.length>0&&null!=C.DocumentElement.children[0].attributes&&null!=C.DocumentElement.children[0].attributes.Filter&&!n.e.StringIsNullOrEmpty(C.DocumentElement.children[0].attributes.Filter.value)&&(b=parseInt(C.DocumentElement.children[0].attributes.Filter.value)),1!=b&&(S=0),!this.multiVisi||0!=b&&1!=b||(d=this.SelectedUnits.split(",").length,null==this.MultiNode&&(this.MultiNode=s.a.rental.GetUnitNodeIDs(this.SelectedUnits))));for(let y=0;y<d;y++){this.IncomeOnContDate&&this.ContractDate.Date>this.StartDate.Date&&this.ContractDate.Date.getMonth()!=this.StartDate.Date.getMonth()&&(this.ContractDate.Date.getFullYear()>this.StartDate.Date.getFullYear()||this.ContractDate.Date.getMonth()>this.StartDate.Date.getMonth()&&this.ContractDate.Date.getFullYear()==this.StartDate.Date.getFullYear())&&(o=!0);let b,I,p,A,P=0,N=0,V=0,R=0,f=0,M=0,E=0,O=0,w=0,L=n.e.DoubleTryParse(this.DataTable[h].Amount),j=0,x=this.CalculateMonths();if(this.DiscountPosting&&""!=this.DataTable[h].Discount.toString()&&parseFloat(this.DataTable[h].Discount.toString())>0&&(P=n.e.DoubleTryParse(this.DataTable[h].Discount),L+=P,N=x>1?n.e.Round(P/x,this.Mdeci):P,V=n.e.Round(P/this.GetDays(),this.dDeci)),A=x>1?n.e.Round(L/x,this.Mdeci):L,p=n.e.Round(L/this.GetDays(),this.dDeci),e=this.StartDate.Date,S>=0&&(S=0),1==d&&0==S)g=C.DocumentElement.children;else if(d>1){if(null!=C.DocumentElement.children[0].children[y].attributes.Unit&&!n.e.StringIsNullOrEmpty(C.DocumentElement.children[0].children[y].attributes.Unit.value)){var l=this.MultiNode.filter(t=>t.UnitID==C.DocumentElement.children[0].children[y].attributes.Unit.value);if(l.length>0&&(T=parseInt(n.e.String(l[0].nodeid))),null!=t&&(l=t.filter(t=>t.UnitID==C.DocumentElement.children[0].children[y].attributes.Unit.value)).length>0&&("false"==l[0].PostIncome.toString().toLowerCase()||"0"==l[0].PostIncome.toString().toLowerCase()))continue}null==C.DocumentElement.children[0].children[y].attributes.Amount||n.e.StringIsNullOrEmpty(C.DocumentElement.children[0].children[y].attributes.Amount.value)||(L=n.e.DoubleTryParse(C.DocumentElement.children[0].children[y].attributes.Amount.value),this.DiscountPosting&&null!=C.ChildNodes[0].ChildNodes[y].Attributes.Discount&&!n.e.StringIsNullOrEmpty(C.ChildNodes[0].ChildNodes[y].Attributes.Discount.value)&&n.e.DoubleTryParse(C.ChildNodes[0].ChildNodes[y].Attributes.Discount.value)>0&&(P=n.e.DoubleTryParse(C.ChildNodes[0].ChildNodes[y].Attributes.Discount),L+=P,N=x>1?n.e.Round(P/x,this.Mdeci):P,V=n.e.Round(P/this.GetDays(),this.dDeci)),A=x>1?n.e.Round(L/x,this.Mdeci):L,p=n.e.Round(L/this.GetDays(),this.dDeci)),g=C.DocumentElement.children[0].children[y].children}for(0==h&&s.a.SessionManager.Preferences.ContainsKey("VATVersion")&&""!=n.e.String(this.DataTable[h].VatPer)&&"Inclusive"==n.e.String(this.DataTable[h].VatType)&&(L=n.e.DoubleTryParse((100*parseFloat(L.toString())/(parseFloat(this.DataTable[h].VatPer)+100)).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString())),p=n.e.DoubleTryParse((100*parseFloat(p.toString())/(parseFloat(this.DataTable[h].VatPer)+100)).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString())),A=n.e.DoubleTryParse((100*parseFloat(A.toString())/(parseFloat(this.DataTable[h].VatPer)+100)).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString())),P>0&&(P=n.e.DoubleTryParse((100*parseFloat(P.toString())/(parseFloat(this.DataTable[h].VatPer)+100)).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString())),V=n.e.DoubleTryParse((100*parseFloat(V.toString())/(parseFloat(this.DataTable[h].VatPer)+100)).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString())),N=n.e.DoubleTryParse((100*parseFloat(N.toString())/(parseFloat(this.DataTable[h].VatPer)+100)).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()))));e<=this.EndDate.Date;){let t=!1;S>=0&&(n.e.isValidDate(g[S].attributes.FromDate.value)&&(a=new Date(g[S].attributes.FromDate.value)),n.e.isValidDate(g[S].attributes.ToDate.value)&&(i=new Date(g[S].attributes.ToDate.value)),0==j?t=!0:i<e.AddDays(e.DaysInMonth()-1)&&e.AddMonths(1)<this.EndDate.Date&&(S++,n.e.isValidDate(g[S].attributes.FromDate.value)&&(a=new Date(g[S].attributes.FromDate.value)),n.e.isValidDate(g[S].attributes.ToDate.value)&&(i=new Date(g[S].attributes.ToDate.value)),t=!0),w=0,f=0,t&&(O>0&&L-O>0&&(w=L-O),R>0&&P-R>0&&(f=P-R),L=n.e.DoubleTryParse(g[S].attributes.Amount.value),this.DiscountPosting&&null!=g[S].attributes.Discount&&!n.e.IsEmpty(g[S].attributes.Discount.value)&&parseFloat(g[S].attributes.Discount.value)>0&&(P=n.e.DoubleTryParse(g[S].attributes.Discount),L+=P,N=x>1?n.e.Round(P/x,this.Mdeci):P,V=n.e.Round(P/this.GetDays(),this.dDeci)),x=this.CalculateMonthsbetweenDates(a,i),A=x>1?n.e.Round(L/x,this.Mdeci):L,p=n.e.Round(L/this.GetDays_1(a,i),this.dDeci),O=0,R=0)),0==j?e.getMonth()==this.EndDate.Date.getMonth()&&e.getFullYear()==this.EndDate.Date.getFullYear()?(I=L,b=P):1==e.getDate()?"Daily"==this.BasedOn.SelectedValue?(I=n.e.Round(p*e.DaysInMonth(),this.Mdeci),b=n.e.Round(V*e.DaysInMonth(),this.Mdeci)):(I=A,b=N):("Daily"!=this.BasedOn.SelectedValue&&(p=A/e.DaysInMonth(),V=N/e.DaysInMonth()),I=n.e.Round(p*(e.DaysInMonth()-e.getDate()+1),this.Mdeci),b=n.e.Round(V*(e.DaysInMonth()-e.getDate()+1),this.Mdeci)):e.AddMonths(1)>this.EndDate.Date?(I=L-O,b=P-R):((t||w)>0&&S>0?(n.e.isValidDate(g[S].attributes.FromDate.value)&&(a=new Date(g[S].attributes.FromDate.value)),1!=a.Day||"Daily"==this.BasedOn.SelectedValue?(I=n.e.Round(p*(a.DaysInMonth()-a.getDate()+1),this.Mdeci),b=n.e.Round(V*(a.DaysInMonth()-a.getDate()+1),this.Mdeci)):(I=A,b=N)):"Daily"==this.BasedOn.SelectedValue?I=n.e.Round(p*e.DaysInMonth(),this.Mdeci):(I=A,b=N),S>=0&&g.length>S&&(n.e.isValidDate(g[S].attributes.ToDate.value)&&(i=new Date(g[S].attributes.ToDate.value)),i==e.AddDays(e.DaysInMonth()-1)&&(I=L-O,b=P-R))),O+=I,R+=b,w>0&&S>0&&(I+=w);let l=0,C=!1,d=!1;if(o&&e<=this.ContractDate.Date&&(M+=I,E+=b,e.Month.getMonth()==this.ContractDate.Date.getMonth()&&e.Year.getFullYear()==this.ContractDate.Date.getFullYear()?(l=M,b=E,o=!1,d=!0):C=!0),!C){r+="<ROWS><DocumentXML>";let t=1;null!=this.dsprof&&this.dsprof.Tables.length>0&&this.dsprof.Columns[0].Contains("ProfileID")&&this.dsprof.Tables[0].length>0&&(t=this.dsprof.Tables[0].length);let a=0;var c=s.a.SessionManager.Preferences.DistributeCostDims.split(",");for(let i=0;i<t;i++){t>1?(i+1==this.dsprof.Tables[0].length?l=parseFloat((I-a).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString())):!n.e.IsEmpty(this.dsprof.Tables[0][i].Percent)&&parseFloat(this.dsprof.Tables[0][i].Percent.toString())>0?l=parseFloat((I*parseFloat(this.dsprof.Tables[0][i].Percent.toString())/100).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString())):!n.e.IsEmpty(this.dsprof.Tables[0][i].Amount)&&parseFloat(this.dsprof.Tables[0][i].Amount.toString())>0&&(l=parseFloat(this.dsprof.Tables[0][i].Amount.toString())),a+=l):0==l&&(l=I),r+='<Row><Transactions NodeID="'+this.DataTable[h].NodeID.toString()+'"  CONTRACTSNO="'+(j+1).toString()+'" ',r+='DocDetailsID="0"  DocSeqNo="1" ',r+=104==this.CurrCostCenterID?'CreditAccount="'+D+'" DebitAccount="'+u+'" ':'DebitAccount="'+D+'" CreditAccount="'+u+'" ',r+='Amount="'+l.toString()+'" AmtFc="'+l.toString()+'" ',r+=this.CurrencyContract.SelectedValue>0?'CurrencyID="'+this.CurrencyContract.SelectedValue+'" ':'CurrencyID="1" ',r+=' ChequeDate = "'+e.ToString("dd/MMM/yyyy")+'" ExchangeRate="1"  CommonNarration="'+m.d.GetValidXml(this.Narration.Text)+'"  LineNarration=" ADVANCE RENT ADJUSTMENT " ChequeBankName="" ChequeNumber=""',r+="></Transactions> ";let o="";this.TempCCID>5e4&&!this.strCCQry.toString().Contains("dcCCNID"+(this.TempCCID-5e4).toString()+"=")&&(o=n.e.IsEmpty(this.DataTable[h].TempCCID_Key)?" dcCCNID"+(this.TempCCID-5e4).toString()+"=1,":" dcCCNID"+(this.TempCCID-5e4).toString()+"="+this.DataTable[h].TempCCID_Key.toString()+","),this.DataTableColumns.Contains("Location_Key")&&!n.e.IsEmpty(this.DataTable[h].Location_Key)?o+=" dcCCNID2="+this.DataTable[h].Location_Key.toString()+",":this.LocationContract.Visible&&this.LocationContract.SelectedValue>0&&(o+=" dcCCNID2="+this.LocationContract.SelectedValue+","),this.DataTableColumns.Contains("Dim_Key")&&!n.e.IsEmpty(this.DataTable[h].Dim_Key)&&(o+=" dcCCNID"+(this.DimCCID-5e4).toString()+"="+this.DataTable[h].Dim_Key.toString()+","),o+=this.GetSalemanXml(this.DataTable[h]),this.multiVisi&&!this.strCCQry.toString().Contains("dcCCNID"+(this.UnitCCID-5e4).toString()+"=")&&(o+=" dcCCNID"+(this.UnitCCID-5e4).toString()+"="+T+","),t>1?c.forEach(t=>{parseInt(t)>5e4&&this.dsprof.Columns[0].Contains("DCCCNID"+(parseInt(t)-5e4))&&""!=this.dsprof.Tables[0][i]["DCCCNID"+(parseInt(t)-5e4)].toString()&&(o+="DCCCNID"+(parseInt(t)-5e4)+"="+this.dsprof.Tables[0][i]["DCCCNID"+(parseInt(t)-5e4)].toString()+",")}):null!=this.dsprof&&this.dsprof.Tables.length>0&&this.dsprof.Columns[0].Contains("ProfileID")&&1==this.dsprof.Tables[0].length&&c.forEach(t=>{parseInt(t)>5e4&&this.dsprof.Columns[0].Contains("DCCCNID"+(parseInt(t)-5e4))&&""!=this.dsprof.Tables[0][0]["DCCCNID"+(parseInt(t)-5e4)].toString()&&(o+="DCCCNID"+(parseInt(t)-5e4)+"="+this.dsprof.Tables[0][0]["DCCCNID"+(parseInt(t)-5e4)].toString()+",")}),s.a.SessionManager.Preferences.ContainsKey("DepositLinkDimension")&&""!=s.a.SessionManager.Preferences.DepositLinkDimension&&parseInt(s.a.SessionManager.Preferences.DepositLinkDimension)>0&&(o+=" dcCCNID"+(parseInt(s.a.SessionManager.Preferences.DepositLinkDimension)-5e4).toString()+"="+this.DataTable[h].NodeID.toString()+","),r+=' <Numeric Query="',this.NegateIncomeFld.toLowerCase().Contains("dcnum")&&(r+=this.NegateIncomeFld+"=-"+I+","+this.NegateIncomeFld.toLowerCase().Replace("dcnum","dcCalcNum")+"=-"+I+","),""!=this.Discountfield&&b>0&&(r+=this.Discountfield+"=-"+b+","+this.Discountfield.Replace("dcNum","dcCalcNum")+"=-"+b+","),r+='"  /> <Alpha /> <CostCenters   Query="'+this.strCCQry.toString()+o+'"  /> <EXTRAXML/> ',r+="<AccountsXML>",this.NegateIncomeFld.toLowerCase().Contains("dcnum")&&(r+="<Accounts ",104==this.CurrCostCenterID?(r+='CreditAccount="'+u+'" ',r+='DebitAccount="'+D+'" '):(r+='DebitAccount="'+u+'" ',r+='CreditAccount="'+D+'" '),r+='Amount="'+l.toString()+'" ',r+='AmtFc="'+l.toString()+'" ',r+='CurrencyID="1" ',r+='ExchangeRate="1" ',r+='IsNegative="1" ',r+="></Accounts>"),""!=this.Discountfield&&b>0&&(r+="<Accounts ",104==this.CurrCostCenterID?(r+='CreditAccount="'+u+'" ',r+='DebitAccount="'+this.DiscountAccount+'" '):(r+='DebitAccount="'+u+'" ',r+='CreditAccount="'+this.DiscountAccount+'" '),r+='Amount="'+b.toString()+'" ',r+='AmtFc="'+b.toString()+'" ',r+='CurrencyID="1" ',r+='ExchangeRate="1" ',r+='IsNegative="1" ',r+="></Accounts>"),r+=" </AccountsXML></Row>"}r+='</DocumentXML><ChequeDocDate DD="',r+=d?this.ContractDate.Date.ToString("dd/MMM/yyyy"):e.ToString("dd/MMM/yyyy"),r+='"></ChequeDocDate></ROWS>'}e=0==j?e.AddDays(e.DaysInMonth()-e.getDate()+1):e.AddMonths(1),j++}}}return r+="</RENTRCT>",r.toString()}getTotalMonths(){let t=new Date;return""!=this.Months.Text&&null!=this.Months.Text||!this.StartDate.Date?""!=this.Months.Text&&null!=this.Months.Text||(this.Months.Text=((this.EndDate.Date.Subtract(t).Days+1)/30).toString()):this.Months.Text=((this.EndDate.Date.Subtract(this.StartDate.Date).Days+1)/30).toString(),parseInt(this.Months.Text)}CalculateMonths_1(t,e){try{let a=0,i=t;for(;e>i;)a++,i=i.AddMonths(1);return(t.DaysInMonth()!=t.Day||e.DaysInMonth()!=e.Day)&&t.Day>=e.Day&&(a+=1),a}catch(a){return 0}}CalculateMonthsbetweenDates(t,e){try{let a=0,i=0,s=t;for(;e>s;)0==a&&0==i?1==s.getDate()?(a++,s=s.AddMonths(1)):(i=s.DaysInMonth()-s.getDate()+1,s=s.AddDays(parseFloat(i))):(s=s.AddMonths(1),s>e?n.e.DaysInMonth(s.AddMonths(-1).getFullYear(),s.AddMonths(-1).getMonth())==e.getDate()?a++:i+=e.getDate():a++);return e==s&&(i+=1),i>0&&(t.Month==e.Date.Month||t.getDate()==e.getDate()+1?i==t.DaysInMonth()||i==e.DaysInMonth()?a++:a+=i/e.DaysInMonth():1==t.Day?i==e.DaysInMonth()?a++:a+=i/e.DaysInMonth():e.Day==e.DaysInMonth()?a+=i/e.DaysInMonth():a+=i/30),a}catch(a){return 0}}CalculateMonths(){try{let t=0,e=0,a=this.StartDate.Date;for(;this.EndDate.Date>a;)0==t&&0==e?1==a.getDate()?(t++,a=a.AddMonths(1)):(e=a.DaysInMonth()-a.getDate()+1,a=a.AddDays(e)):(a=a.AddMonths(1),a>this.EndDate.Date?n.e.DaysInMonth(a.AddMonths(-1).getFullYear(),a.AddMonths(-1).getMonth())==this.EndDate.Date.getDate()?t++:e+=this.EndDate.Date.getDate():t++);return n.e.isValidDate(this.EndDate.Date)&&this.EndDate.Date==a&&(e+=1),e>0&&(this.StartDate.Date.getMonth()==this.EndDate.Date.getMonth()||this.StartDate.Date.getDate()==this.EndDate.Date.getDate()+1?e==this.StartDate.Date.DaysInMonth()||e==this.EndDate.Date.DaysInMonth()?t++:t+=e/this.EndDate.Date.DaysInMonth():1==this.StartDate.Date.getDate()?e==this.EndDate.Date.DaysInMonth()?t++:t+=e/this.EndDate.Date.DaysInMonth():this.EndDate.Date.getDate()==this.EndDate.Date.DaysInMonth()?t+=e/this.StartDate.Date.DaysInMonth():t+=e/30),t}catch(t){return 0}}getTotalMonthsTerm(){return this.Months.Text=((this.EndDate.Date.Subtract(this.TerminationDate.Date()).Days+1)/30).toString(),(this.EndDate.Date.Subtract(this.TerminationDate).Days+1)%30>0?parseInt(this.Months.Text)+1:parseInt(this.Months.Text)}GetCCData(t){s.a.SessionManager.Preferences.ContainsKey("DistributeCost")&&"True"==s.a.SessionManager.Preferences.DistributeCost&&s.a.SessionManager.Preferences.ContainsKey("CostBasedON")&&"True"==s.a.SessionManager.Preferences.CostBasedON&&s.a.SessionManager.Preferences.ContainsKey("CostBasedONDims")&&""!=s.a.SessionManager.Preferences.CostBasedONDims&&(this.costDims=s.a.SessionManager.Preferences.CostBasedONDims.split(",")),this.strCCQry="";let e=new Array;e.push(this.TenantCCID),e.push(this.UnitCCID),e.push(this.PropertyCCID),e.push(this.Landlord.CCID),e.push(this.Accountant.CCID),e.push(this.Salesman.CCID),e.push(50060),e.push(parseInt(s.a.SessionManager.Preferences.DepositLinkDimension));var a=this.ContractParticular.find(t=>null!=t.ValueMember&&"SPType_Key"==t.ValueMember);null!=a&&null!=a&&a.IsVisible&&e.push(50061),null!=(a=this.ContractParticular.find(t=>null!=t.ValueMember&&"Dim_Key"==t.ValueMember))&&null!=a&&a.CostCenterID>0&&e.push(a.CostCenterID);for(let i=0;i<this.ContractParticular.length;i++)this.ContractParticular[i].DisplayMember.startsWith("CCNID")&&this.DataTableColumns.Contains(this.ContractParticular[i].ValueMember)&&e.push(this.ContractParticular[i].CostCenterID);for(let i=0;i<this.ContractPayTerms.length;i++)this.ContractPayTerms[i].DisplayMember.startsWith("CCNID")&&this.DataTableColumns.Contains(this.ContractPayTerms[i].ValueMember)&&e.push(this.ContractPayTerms[i].CostCenterID);this.ScreenObject.CustomTab.Pages.forEach(t=>{t.Fields.forEach(t=>{t instanceof l.b&&(null!=t.DBColumnName&&t.DBColumnName.toLowerCase().Contains("ccnid")||null!=t.DBColumnName&&("accountid"==t.DBColumnName.toLowerCase()||"productid"==t.DBColumnName.toLowerCase()))&&!e.Contains(t.CCID)&&(n.e.IsEmpty(t.SelectedValue)||0==t.SelectedValue||(this.strCCQry+=t.DBColumnName.replace("CCNID","dcCCNID")+"="+t.SelectedValue+","))})}),this.ScreenObject.HeaderFields.forEach(t=>{t instanceof l.b&&(null!=t.DBColumnName&&t.DBColumnName.toLowerCase().Contains("ccnid")||null!=t.DBColumnName&&("accountid"==t.DBColumnName.toLowerCase()||"productid"==t.DBColumnName.toLowerCase()))&&!e.Contains(t.CCID)&&(n.e.IsEmpty(t.SelectedValue)||0==t.SelectedValue||(this.strCCQry+=t.DBColumnName.replace("CCNID","dcCCNID")+"="+t.SelectedValue+","))}),this.LineWiseSalesman||this.strCCQry.toString().Contains("dcCCNID"+(this.Salesman.CCID-5e4).toString()+"=")||this.Salesman.CCID>5e4&&this.Salesman.SelectedValue>0&&(this.strCCQry+=" dcCCNID"+(this.Salesman.CCID-5e4)+"="+this.Salesman.SelectedValue+","),this.strCCQry.toString().Contains("dcCCNID"+(this.Accountant.CCID-5e4).toString()+"=")||this.Accountant.CCID>5e4&&this.Accountant.SelectedValue>0&&(this.strCCQry+=" dcCCNID"+(this.Accountant.CCID-5e4)+"="+this.Accountant.SelectedValue+","),this.strCCQry.toString().Contains("dcCCNID"+(this.Landlord.CCID-5e4).toString()+"=")||this.Landlord.CCID>5e4&&this.Landlord.SelectedValue>0&&(this.strCCQry+=" dcCCNID"+(this.Landlord.CCID-5e4)+"="+this.Landlord.SelectedValue+","),this.strCCQry.toString().Contains("dcCCNID1=")||this.DivisionContract.Visible&&this.DivisionContract.SelectedValue>0&&(this.strCCQry+=" dcCCNID1="+this.DivisionContract.SelectedValue+","),this.strCCQry.toString().Contains("dcCCNID"+(this.PropertyCCID-5e4).toString()+"=")||this.PropertyCCID>5e4&&(this.strCCQry+=" dcCCNID"+(this.PropertyCCID-5e4)+"="+t[0].PropertyID.toString()+","),this.strCCQry.toString().Contains("dcCCNID"+(this.UnitCCID-5e4).toString()+"=")||this.UnitCCID>5e4&&(this.multiVisi&&!n.e.IsEmpty(t[0].UnitID)?this.UnitNodeID=parseInt(t[0].UnitID.toString()):this.strCCQry+=" dcCCNID"+(this.UnitCCID-5e4)+"="+t[0].UnitID.toString()+","),this.strCCQry.toString().Contains("dcCCNID"+(this.TenantCCID-5e4).toString()+"=")||this.TenantCCID>5e4&&(this.strCCQry+=" dcCCNID"+(this.TenantCCID-5e4)+"="+t[0].TenantID.toString()+",")}GetRemaingPaymentXML(t){let e,a,i="",o="";if(Logger.InfoLog("AddEditRenContractViewModel ::Entering GetRemaingPaymentXML"),a=this.TerminateContracts.ChequeDate.Date,e=a,i=this.BankAccounts.ContainsKey(this.TerminateContracts.BankAccount.SelectedValue.toString())||!n.e.IsEmpty(this.PayTermsDataTable[0].DebitAccountID_Key)&&this.PDPAccounts.ContainsKey(this.PayTermsDataTable[0].DebitAccountID_Key.toString())?"BANK":"JV",o+='<ReceiptXML><ROWS><AccountType DD="'+i+'"></AccountType><Documents DocID="0"></Documents><DocumentXML>',this.strType="JV"!=i,this.strType)o+='<Row><Transactions  CONTRACTSNO="1"  ',o+=' DocDetailsID="0"  DocSeqNo="1"   CreditAccount="'+this.TerminateContracts.BankAccount.SelectedValue.toString()+'" DebitAccount="'+this.RentRecAc.SelectedValue.toString()+'" Amount="##Balance##" AmtFc="##Balance##"',o+=' ChequeDate = "'+a.ToString("dd/MMM/yyyy")+'"  ChequeMaturityDate = "'+a.ToString("dd/MMM/yyyy")+'"  CurrencyID="1" ExchangeRate="1" CommonNarration="'+m.d.GetValidXml(this.TerminateContracts.Remarks.Text)+'" LineNarration="'+m.d.GetValidXml(this.TerminateContracts.Remarks.Text)+'" ChequeBankName="" ChequeNumber="'+this.TerminateContracts.ChequeNo.Text+'"',o+="></Transactions> ",o+=' <Numeric /> <Alpha /> <CostCenters   Query="'+this.strCCQry.toString()+'"  /> ',o+="<EXTRAXML> ",s.a.SessionManager.Preferences.ContainsKey("On")&&"True"==s.a.SessionManager.Preferences.On&&t&&(o+="<BillWise> ",o+=' <Row DocSeqNo="1" AccountID="'+this.RentRecAc.SelectedValue.toString(),o+='" AmountFC="##Balance##" AdjAmount="##Balance##"',o+=' AdjCurrID="1" ',o+='AdjExchRT="1" ',o+='IsNewReference="1" ',o+='Narration="" ',o+='IsDocPDC="0" ',o+=" ></Row>",o+=" </BillWise>"),o+="</EXTRAXML> ",o+=" </Row>";else{if(o+='<Row><Transactions  CONTRACTSNO="1"  ',o+=' DocDetailsID="0"  DocSeqNo="1"   CreditAccount="'+this.TerminateContracts.BankAccount.SelectedValue.toString()+'" DebitAccount="-99" Amount="##Balance##" AmtFc="##Balance##"',o+=' ChequeDate = "'+a.ToString("dd/MMM/yyyy")+'"  ChequeMaturityDate = "'+a.ToString("dd/MMM/yyyy")+'"  CurrencyID="1" ExchangeRate="1" CommonNarration="'+m.d.GetValidXml(this.TerminateContracts.Remarks.Text)+'" LineNarration="'+m.d.GetValidXml(this.TerminateContracts.Remarks.Text)+'" ChequeBankName="" ChequeNumber="'+this.TerminateContracts.ChequeNo.Text+'"',o+="></Transactions> ",o+=' <Numeric /> <Alpha /> <CostCenters   Query="'+this.strCCQry.toString()+'"  />  ',o+="<EXTRAXML> ",s.a.SessionManager.Preferences.ContainsKey("On")&&"True"==s.a.SessionManager.Preferences.On&&!n.e.IsEmpty(this.PayTermsDataTable[0].Amount)&&!n.e.IsEmpty(this.PayTermsDataTable[0].DebitAccountID_Key)){let t=!1,e=s.a.rental.IsBillWiseAccount(this.TerminateContracts.BankAccount.SelectedValue);null!=e&&e.Tables.length>0&&e.Tables[0].length>0&&!n.e.IsEmpty(e.Tables[0][0].IsBillwise)&&(t=Object(r.j)(e.Tables[0][0].IsBillwise)),t&&(o+="<BillWise> ",o+=' <Row DocSeqNo="1" AccountID="'+this.PayTermsDataTable[0].DebitAccountID_Key.toString(),o+='" AmountFC="-##Balance##" AdjAmount="-##Balance##"',o+=' AdjCurrID="1" ',o+='AdjExchRT="1" ',o+='IsNewReference="1" ',o+='Narration="" ',o+='IsDocPDC="0" ',o+=" ></Row>",o+=" </BillWise>")}o+="</EXTRAXML> ",o+=" </Row>",o+='<Row><Transactions  CONTRACTSNO="1"  ',o+=' DocDetailsID="0"  DocSeqNo="2"   CreditAccount="-99" DebitAccount="'+this.RentRecAc.SelectedValue.toString()+'" Amount="##Balance##" AmtFc="##Balance##"',o+=' ChequeDate = "'+a.ToString("dd/MMM/yyyy")+'"  ChequeMaturityDate = "'+a.ToString("dd/MMM/yyyy")+'"  CurrencyID="1" ExchangeRate="1" CommonNarration="'+m.d.GetValidXml(this.TerminateContracts.Remarks.Text)+'" LineNarration="'+m.d.GetValidXml(this.TerminateContracts.Remarks.Text)+'" ',o+="></Transactions> ",o+=' <Numeric /> <Alpha /> <CostCenters   Query="'+this.strCCQry.toString()+'"  />  ',o+="<EXTRAXML> ",s.a.SessionManager.Preferences.ContainsKey("On")&&"True"==s.a.SessionManager.Preferences.On&&t&&!n.e.IsEmpty(this.PayTermsDataTable[0].Amount)&&(o+="<BillWise> ",o+=' <Row DocSeqNo="2" AccountID="'+this.RentRecAc.SelectedValue.toString(),o+='" AmountFC="##Balance##" AdjAmount="##Balance##"',o+=' AdjCurrID="1" ',o+='AdjExchRT="1" ',o+='IsNewReference="1" ',o+='Narration="" ',o+='IsDocPDC="0" ',o+=" ></Row>",o+=" </BillWise>"),o+="</EXTRAXML> ",o+=" </Row>"}return o+="</DocumentXML></ROWS></ReceiptXML>",Logger.InfoLog("AddEditRenContractViewModel ::Exiting GetRemaingPaymentXML"),o.toString()}GetPaymentXML(t){if(95==this.CostCenterID&&this.SinglePDC)return"";if(this.PayTermsDataTable.length>0&&null!=this.PayTermsDataTable[0].DebitAccountID_Key&&""!=this.PayTermsDataTable[0].DebitAccountID_Key.toString()&&parseInt(this.PayTermsDataTable[0].DebitAccountID_Key)>0&&null!=this.PayTermsDataTable[0].Amount&&""!=this.PayTermsDataTable[0].Amount.toString()&&parseFloat(this.PayTermsDataTable[0].Amount.toString())>0){let e="",a="",i=new Date,o=new Date;if(Logger.InfoLog("AddEditRenContractViewModel ::Entering GetPaymentXML"),o=new Date(this.PayTermsDataTable[0].CntrlDate_Key),i=o,e=this.BankAccounts.ContainsKey(this.PayTermsDataTable[0].DebitAccountID_Key.toString())||this.PDPAccounts.ContainsKey(this.PayTermsDataTable[0].DebitAccountID_Key.toString())?"BANK":this.CashAccounts.ContainsKey(this.PayTermsDataTable[0].DebitAccountID_Key.toString())?"CASH":"JV","370"==this.PayTermsDataTable[0].DocStatusID.toString()&&"BANK"==e){if(a+='<ReceiptXML><ROWS><AccountType DD="'+e+'"></AccountType><Documents DocID="0"></Documents><DocumentXML>',this.strType="JV"!=e,null!=this.PayTermsDataTable[0].CntrlDate&&""!=this.PayTermsDataTable[0].CntrlDate.toString()&&null!=this.PayTermsDataTable[0].Amount&&""!=this.PayTermsDataTable[0].Amount.toString()&&parseFloat(this.PayTermsDataTable[0].Amount.toString())>0)if(this.PDCRefund+=parseFloat(this.PayTermsDataTable[0].Amount.toString()),this.strType){a+='<Row><Transactions  CONTRACTSNO="1"  ',null!=this.PayTermsDataTable[0].Amount&&""!=this.PayTermsDataTable[0].Amount.toString()?a+=' DocDetailsID="0"  DocSeqNo="1"   CreditAccount="'+this.PayTermsDataTable[0].DebitAccountID_Key.toString()+'" DebitAccount="'+this.RentRecAc.SelectedValue.toString()+'" Amount="'+parseFloat(this.PayTermsDataTable[0].Amount)+'" AmtFc="'+parseFloat(this.PayTermsDataTable[0].Amount)+'"':a+=' DocDetailsID="0"  DocSeqNo="1"   CreditAccount="'+this.PayTermsDataTable[0].DebitAccountID_Key.toString()+'" DebitAccount="'+this.RentRecAc.SelectedValue.toString()+'" Amount="0" AmtFc="0" ',a+=this.CurrencyContract.SelectedValue>0?' ChequeDate = "'+o.ToString("dd/MMM/yyyy")+'"  ChequeMaturityDate = "'+o.ToString("dd/MMM/yyyy")+'"  CurrencyID="'+this.CurrencyContract.SelectedValue+'" ExchangeRate="1" CommonNarration="'+m.d.GetValidXml(this.PayTermsDataTable[0].Narration.toString())+'" LineNarration="'+m.d.GetValidXml(this.PayTermsDataTable[0].Narration.toString())+'" ChequeBankName="'+m.d.GetValidXml(this.GetPayBank(this.PayTermsDataTable[0].PayeeBank.toString()))+'" ChequeNumber="'+this.PayTermsDataTable[0].ChequeNo.toString()+'"':' ChequeDate = "'+o.ToString("dd/MMM/yyyy")+'"  ChequeMaturityDate = "'+o.ToString("dd/MMM/yyyy")+'"  CurrencyID="1" ExchangeRate="1" CommonNarration="'+m.d.GetValidXml(this.PayTermsDataTable[0].Narration.toString())+'" LineNarration="'+m.d.GetValidXml(this.PayTermsDataTable[0].Narration.toString())+'" ChequeBankName="'+m.d.GetValidXml(this.GetPayBank(this.PayTermsDataTable[0].PayeeBank.toString()))+'" ChequeNumber="'+this.PayTermsDataTable[0].ChequeNo.toString()+'"',a+="></Transactions> ";let e="";if(this.TempCCID>5e4&&!this.strCCQry.toString().Contains("dcCCNID"+(this.TempCCID-5e4).toString()+"=")&&(e=""!=this.PayTermsDataTable[0].TempCCID_Key.toString()?" dcCCNID"+(this.TempCCID-5e4).toString()+"="+this.PayTermsDataTable[0].TempCCID_Key.toString()+",":" dcCCNID"+(this.TempCCID-5e4).toString()+"=1,"),this.PayTermsDataTableColumns.Contains("Location_Key")&&""!=this.PayTermsDataTable[0].Location_Key.toString()?e+=" dcCCNID2="+this.PayTermsDataTable[0].Location_Key.toString()+",":this.LocationContract.Visible&&this.LocationContract.SelectedValue>0&&(e+=" dcCCNID2="+this.LocationContract.SelectedValue+","),this.PayTermsDataTableColumns.Contains("Dim_Key")&&!n.e.IsEmpty(this.PayTermsDataTable[0].Dim_Key)&&(e+=" dcCCNID"+(this.DimCCID-5e4).toString()+"="+this.PayTermsDataTable[0].Dim_Key.toString()+","),e+=this.GetSalemanXml(this.PayTermsDataTable[0]),this.multiVisi&&!this.strCCQry.toString().Contains("dcCCNID"+(this.UnitCCID-5e4).toString()+"=")&&(e+=" dcCCNID"+(this.UnitCCID-5e4).toString()+"="+this.UnitNodeID+","),a+=' <Numeric /> <Alpha /> <CostCenters   Query="'+this.strCCQry.toString()+e+'"  /> ',a+="<EXTRAXML> ",s.a.SessionManager.Preferences.ContainsKey("On")&&"True"==s.a.SessionManager.Preferences.On&&t&&""!=this.PayTermsDataTable[0].Amount.toString()){a+="<BillWise> ";let t=parseFloat(this.PayTermsDataTable[0].Amount.toString());for(let e=0;e<this.DataTable.length;e++)if(!n.e.IsEmpty(this.DataTable[e].Amount)){let i=0;if(t>parseFloat(this.DataTable[e].Amount.toString())?(t-=parseFloat(this.DataTable[e].Amount.toString()),i=parseFloat(this.DataTable[e].Amount.toString())):(i=t,t=0),a+=' <Row DocSeqNo="1" AccountID="'+this.RentRecAc.SelectedValue.toString(),a+='" AmountFC="'+i+'" AdjAmount="'+i+'"',a+=' AdjCurrID="1" ',a+='AdjExchRT="1" ',a+='IsNewReference="0" ',a+='Narration="" ',a+='IsDocPDC="0" ',a+='RefDocNo="'+(e+1).toString()+'" ',a+=" ></Row>",this.ValueUsed+=i,t<=0)break}a+=" </BillWise>"}a+="</EXTRAXML> ",a+=" </Row>"}else{a+='<Row><Transactions  CONTRACTSNO="1"  ',null!=this.PayTermsDataTable[0].Amount&&""!=this.PayTermsDataTable[0].Amount.toString()?a+=' DocDetailsID="0"  DocSeqNo="1"   CreditAccount="'+this.PayTermsDataTable[0].DebitAccountID_Key.toString()+'" DebitAccount="-99" Amount="'+parseFloat(this.PayTermsDataTable[0].Amount)+'" AmtFc="'+parseFloat(this.PayTermsDataTable[0].Amount)+'"':a+=' DocDetailsID="0"  DocSeqNo="1"   CreditAccount="'+this.PayTermsDataTable[0].DebitAccountID_Key.toString()+'" DebitAccount="-99" Amount="0" AmtFc="0" ',a+=this.CurrencyContract.SelectedValue>0?' ChequeDate = "'+o.ToString("dd/MMM/yyyy")+'"  ChequeMaturityDate = "'+o.ToString("dd/MMM/yyyy")+'"  CurrencyID="'+this.CurrencyContract.SelectedValue+'" ExchangeRate="1" CommonNarration="'+m.d.GetValidXml(this.PayTermsDataTable[0].Narration.toString())+'" LineNarration="'+m.d.GetValidXml(this.PayTermsDataTable[0].Narration.toString())+'" ChequeBankName="'+m.d.GetValidXml(this.GetPayBank(this.PayTermsDataTable[0].PayeeBank.toString()))+'" ChequeNumber="'+this.PayTermsDataTable[0].ChequeNo.toString()+'"':' ChequeDate = "'+o.ToString("dd/MMM/yyyy")+'"  ChequeMaturityDate = "'+o.ToString("dd/MMM/yyyy")+'"  CurrencyID="1" ExchangeRate="1" CommonNarration="'+m.d.GetValidXml(this.PayTermsDataTable[0].Narration.toString())+'" LineNarration="'+m.d.GetValidXml(this.PayTermsDataTable[0].Narration.toString())+'" ChequeBankName="'+m.d.GetValidXml(this.GetPayBank(this.PayTermsDataTable[0].PayeeBank.toString()))+'" ChequeNumber="'+this.PayTermsDataTable[0].ChequeNo.toString()+'"',a+="></Transactions> ";let e="";if(this.TempCCID>5e4&&!this.strCCQry.toString().Contains("dcCCNID"+(this.TempCCID-5e4).toString()+"=")&&(e=""!=this.PayTermsDataTable[0].TempCCID_Key.toString()?" dcCCNID"+(this.TempCCID-5e4).toString()+"="+this.PayTermsDataTable[0].TempCCID_Key.toString()+",":" dcCCNID"+(this.TempCCID-5e4).toString()+"=1,"),this.PayTermsDataTableColumns.Contains("Location_Key")&&!n.e.IsEmpty(this.PayTermsDataTable[0].Location_Key)?e+=" dcCCNID2="+this.PayTermsDataTable[0].Location_Key.toString()+",":this.LocationContract.Visible&&this.LocationContract.SelectedValue>0&&(e+=" dcCCNID2="+this.LocationContract.SelectedValue+","),this.PayTermsDataTableColumns.Contains("Dim_Key")&&!n.e.IsEmpty(this.PayTermsDataTable[0].Dim_Key)&&(e+=" dcCCNID"+(this.DimCCID-5e4).toString()+"="+this.PayTermsDataTable[0].Dim_Key.toString()+","),e+=this.GetSalemanXml(this.PayTermsDataTable[0]),this.multiVisi&&!this.strCCQry.toString().Contains("dcCCNID"+(this.UnitCCID-5e4).toString()+"=")&&(e+=" dcCCNID"+(this.UnitCCID-5e4).toString()+"="+this.UnitNodeID+","),a+=' <Numeric /> <Alpha /> <CostCenters   Query="'+this.strCCQry.toString()+e+'"  /> ',a+="<EXTRAXML> ",s.a.SessionManager.Preferences.ContainsKey("On")&&"True"==s.a.SessionManager.Preferences.On&&!n.e.IsEmpty(this.PayTermsDataTable[0].Amount)&&!n.e.IsEmpty(this.PayTermsDataTable[0].DebitAccountID_Key)){let t=!1,e=s.a.rental.IsBillWiseAccount(parseInt(this.PayTermsDataTable[0].DebitAccountID_Key.toString()));if(null!=e&&e.Tables.length>0&&e.Tables[0].length>0&&!n.e.IsEmpty(e.Tables[0][0].IsBillwise)&&(t=Object(r.j)(e.Tables[0][0].IsBillwise)),t){a+="<BillWise> ";let t=parseFloat(this.PayTermsDataTable[0].Amount.toString());a+=' <Row DocSeqNo="1" AccountID="'+this.PayTermsDataTable[0].DebitAccountID_Key.toString(),a+='" AmountFC="-'+t+'" AdjAmount="-'+t+'"',a+=' AdjCurrID="1" ',a+='AdjExchRT="1" ',a+='IsNewReference="1" ',a+='Narration="" ',a+='IsDocPDC="0" ',a+=" ></Row>",a+=" </BillWise>"}}if(a+="</EXTRAXML> ",a+=" </Row>",a+='<Row><Transactions  CONTRACTSNO="1"  ',n.e.IsEmpty(this.PayTermsDataTable[0].Amount)?a+=' DocDetailsID="0"  DocSeqNo="2"   CreditAccount="-99" DebitAccount="'+this.RentRecAc.SelectedValue.toString()+'" Amount="0" AmtFc="0" ':a+=' DocDetailsID="0"  DocSeqNo="2"   CreditAccount="-99" DebitAccount="'+this.RentRecAc.SelectedValue.toString()+'" Amount="'+parseFloat(this.PayTermsDataTable[0].Amount)+'" AmtFc="'+parseFloat(this.PayTermsDataTable[0].Amount)+'"',a+=this.CurrencyContract.SelectedValue>0?' ChequeDate = "'+o.ToString("dd/MMM/yyyy")+'"  ChequeMaturityDate = "'+o.ToString("dd/MMM/yyyy")+'"  CurrencyID="'+this.CurrencyContract.SelectedValue+'" ExchangeRate="1" CommonNarration="'+m.d.GetValidXml(this.PayTermsDataTable[0].Narration.toString())+'" LineNarration="'+m.d.GetValidXml(this.PayTermsDataTable[0].Narration.toString())+'" ChequeBankName="'+m.d.GetValidXml(this.GetPayBank(this.PayTermsDataTable[0].PayeeBank.toString()))+'" ChequeNumber="'+this.PayTermsDataTable[0].ChequeNo.toString()+'"':' ChequeDate = "'+o.ToString("dd/MMM/yyyy")+'"  ChequeMaturityDate = "'+o.ToString("dd/MMM/yyyy")+'"  CurrencyID="1" ExchangeRate="1" CommonNarration="'+m.d.GetValidXml(this.PayTermsDataTable[0].Narration.toString())+'" LineNarration="'+m.d.GetValidXml(this.PayTermsDataTable[0].Narration.toString())+'" ChequeBankName="'+m.d.GetValidXml(this.GetPayBank(this.PayTermsDataTable[0].PayeeBank.toString()))+'" ChequeNumber="'+this.PayTermsDataTable[0].ChequeNo.toString()+'"',a+="></Transactions> ",e="",this.TempCCID>5e4&&!this.strCCQry.toString().Contains("dcCCNID"+(this.TempCCID-5e4).toString()+"=")&&(e=n.e.IsEmpty(this.PayTermsDataTable[0].TempCCID_Key)?" dcCCNID"+(this.TempCCID-5e4).toString()+"=1,":" dcCCNID"+(this.TempCCID-5e4).toString()+"="+this.PayTermsDataTable[0].TempCCID_Key.toString()+","),this.PayTermsDataTableColumns.Contains("Location_Key")&&!n.e.IsEmpty(this.PayTermsDataTable[0].Location_Key)?e+=" dcCCNID2="+this.PayTermsDataTable[0].Location_Key.toString()+",":this.LocationContract.Visible&&this.LocationContract.SelectedValue>0&&(e+=" dcCCNID2="+this.LocationContract.SelectedValue+","),this.multiVisi&&!this.strCCQry.toString().Contains("dcCCNID"+(this.UnitCCID-5e4).toString()+"=")&&(e+=" dcCCNID"+(this.UnitCCID-5e4).toString()+"="+this.UnitNodeID+","),this.PayTermsDataTableColumns.Contains("Dim_Key")&&!n.e.IsEmpty(this.PayTermsDataTable[0].Dim_Key)&&(e+=" dcCCNID"+(this.DimCCID-5e4).toString()+"="+this.PayTermsDataTable[0].Dim_Key.toString()+","),e+=this.GetSalemanXml(this.PayTermsDataTable[0]),a+=' <Numeric /> <Alpha /> <CostCenters   Query="'+this.strCCQry.toString()+e+'"  /> ',a+="<EXTRAXML> ",s.a.SessionManager.Preferences.ContainsKey("On")&&"True"==s.a.SessionManager.Preferences.On&&t&&""!=this.PayTermsDataTable[0].Amount.toString()){a+="<BillWise> ";let t=parseFloat(this.PayTermsDataTable[0].Amount.toString());for(let e=0;e<this.DataTable.length;e++)if((n.e.IsEmpty(this.DataTable[e].DebitAccountID_Key)||!(parseInt(this.DataTable[e].DebitAccountID_Key.toString())>0))&&""!=this.DataTable[e].Amount.toString()){let i=0;if(t>parseFloat(this.DataTable[e].Amount.toString())?(t-=parseFloat(this.DataTable[e].Amount.toString()),i=parseFloat(this.DataTable[e].Amount.toString())):(i=t,t=0),a+=' <Row DocSeqNo="2" AccountID="'+this.RentRecAc.SelectedValue.toString(),a+='" AmountFC="'+i+'" AdjAmount="'+i+'"',a+=' AdjCurrID="1" ',a+='AdjExchRT="1" ',a+='IsNewReference="0" ',a+='Narration="" ',a+='IsDocPDC="0" ',a+='RefDocNo="'+(e+1).toString()+'" ',a+=" ></Row>",this.ValueUsed+=i,t<=0)break}a+=" </BillWise>"}a+="</EXTRAXML> ",a+=" </Row>"}return a+="</DocumentXML></ROWS></ReceiptXML>",Logger.InfoLog("AddEditRenContractViewModel ::Exiting GetReceiptXML"),a.toString()}}return""}GetPDPaymentXML(t,e){let a,i="",o=new Date;Logger.InfoLog("AddEditRenContractViewModel ::Entering GetPDPaymentXML"),104==this.CurrCostCenterID?(a=0,i+="<PDPayment>"):(a=95==this.CostCenterID&&this.SinglePDC?0:1,i+="<PDR>");let l=0,c="";for(;a<this.PayTermsDataTable.length;a++)if(null!=this.PayTermsDataTable[a].DebitAccountID_Key&&""!=this.PayTermsDataTable[a].DebitAccountID_Key.toString()&&parseInt(this.PayTermsDataTable[a].DebitAccountID_Key)>0&&null!=this.PayTermsDataTable[a].Amount&&""!=this.PayTermsDataTable[a].Amount.toString()&&parseFloat(this.PayTermsDataTable[a].Amount.toString())>0&&(o=new Date(this.PayTermsDataTable[a].CntrlDate_Key),c=this.BankAccounts.ContainsKey(this.PayTermsDataTable[a].DebitAccountID_Key.toString())||this.PDPAccounts.ContainsKey(this.PayTermsDataTable[a].DebitAccountID_Key.toString())?"BANK":this.CashAccounts.ContainsKey(this.PayTermsDataTable[a].DebitAccountID_Key.toString())?"CASH":"JV","370"==this.PayTermsDataTable[a].DocStatusID.toString()&&"BANK"==c)){if(l++,l>1&&95==this.CostCenterID&&this.SinglePDC||(i+='<ROWS><AccountType DD="'+c+'"',"370"==this.PayTermsDataTable[a].DocStatusID.toString()&&"BANK"==c&&this.CancelOnTerminate&&(i+=' CancelDOCID="'+this.PayTermsDataTable[a].DocID.toString()+'"'),i+=' ></AccountType><Documents DocID="0"></Documents><DocumentXML>'),this.strType="JV"!=c,""!=this.PayTermsDataTable[a].Amount.toString()&&(this.PDCRefund+=parseFloat(this.PayTermsDataTable[a].Amount.toString())),this.strType){i+='<Row><Transactions CONTRACTSNO="'+(a+1).toString()+'" ',i+='DocDetailsID="0" DocSeqNo="1" ',i+=104==this.CurrCostCenterID?'DebitAccount="'+this.PayTermsDataTable[a].DebitAccountID_Key.toString()+'" CreditAccount="'+this.RentRecAc.SelectedValue.toString()+'" ':'CreditAccount="'+this.PayTermsDataTable[a].DebitAccountID_Key.toString()+'" DebitAccount="'+this.RentRecAc.SelectedValue.toString()+'" ',null!=this.PayTermsDataTable[a].Amount&&""!=this.PayTermsDataTable[a].Amount.toString()?i+='Amount="'+parseFloat(this.PayTermsDataTable[a].Amount)+'"  AmtFc="'+parseFloat(this.PayTermsDataTable[a].Amount)+'" ':i+='Amount="0"  AmtFc="0" ',i+='ChequeDate = "'+o.ToString("dd/MMM/yyyy")+'" ChequeMaturityDate = "'+o.ToString("dd/MMM/yyyy")+'" ',i+=this.CurrencyContract.SelectedValue>0?'CurrencyID="'+this.CurrencyContract.SelectedValue+'" ':'CurrencyID="1" ',i+='ExchangeRate="1" CommonNarration="'+m.d.GetValidXml(this.PayTermsDataTable[a].Narration.toString())+'" LineNarration="'+m.d.GetValidXml(this.PayTermsDataTable[a].Narration.toString())+'"  ChequeBankName="'+m.d.GetValidXml(this.GetPayBank(this.PayTermsDataTable[a].PayeeBank.toString()))+'" ChequeNumber="'+this.PayTermsDataTable[a].ChequeNo.toString()+'" ',i+="></Transactions> ";let e="";if(this.TempCCID>5e4&&!this.strCCQry.toString().Contains("dcCCNID"+(this.TempCCID-5e4).toString()+"=")&&(e=""!=this.PayTermsDataTable[a].TempCCID_Key.toString()?" dcCCNID"+(this.TempCCID-5e4).toString()+"="+this.PayTermsDataTable[a].TempCCID_Key.toString()+",":" dcCCNID"+(this.TempCCID-5e4).toString()+"=1,"),this.PayTermsDataTableColumns.Contains("Location_Key")&&!n.e.IsEmpty(this.PayTermsDataTable[a].Location_Key)?e+=" dcCCNID2="+this.PayTermsDataTable[a].Location_Key.toString()+",":this.LocationContract.Visible&&this.LocationContract.SelectedValue>0&&(e+=" dcCCNID2="+this.LocationContract.SelectedValue+","),this.PayTermsDataTableColumns.Contains("Dim_Key")&&!n.e.IsEmpty(this.PayTermsDataTable[a].Dim_Key)&&(e+=" dcCCNID"+(this.DimCCID-5e4).toString()+"="+this.PayTermsDataTable[a].Dim_Key.toString()+","),e+=this.GetSalemanXml(this.PayTermsDataTable[a]),this.multiVisi&&!this.strCCQry.toString().Contains("dcCCNID"+(this.UnitCCID-5e4).toString()+"=")&&(e+=" dcCCNID"+(this.UnitCCID-5e4).toString()+"="+this.UnitNodeID+","),i+=' <Numeric /> <Alpha /> <CostCenters   Query="'+this.strCCQry.toString()+e+'"  /> ',i+="<EXTRAXML> ",s.a.SessionManager.Preferences.ContainsKey("On")&&"True"==s.a.SessionManager.Preferences.On&&t&&!n.e.IsEmpty(this.PayTermsDataTable[a].Amount)){i+="<BillWise> ";let t=parseFloat(this.PayTermsDataTable[a].Amount.toString()),e=0;for(let a=0;a<this.DataTable.length;a++)if((n.e.IsEmpty(this.DataTable[a].DebitAccountID_Key)||!(parseInt(this.DataTable[a].DebitAccountID_Key.toString())>0))&&!n.e.IsEmpty(this.DataTable[a].Amount)){if(e+=parseFloat(this.DataTable[a].Amount.toString()),e<=this.ValueUsed)continue;let s=0,n=e-this.ValueUsed;if(t>n?(t-=n,s=n):(s=t,t=0),i+=' <Row DocSeqNo="1" AccountID="'+this.RentRecAc.SelectedValue.toString(),i+='" AmountFC="'+s+'" AdjAmount="'+s+'"',i+=' AdjCurrID="1" ',i+='AdjExchRT="1" ',i+='IsNewReference="0" ',i+='Narration="" ',i+='IsDocPDC="0" ',i+='RefDocNo="'+(a+1).toString()+'" ',i+=" ></Row>",this.ValueUsed+=s,t<=0)break}i+=" </BillWise>"}i+="</EXTRAXML> ",i+=" </Row>"}else{i+='<Row><Transactions   CONTRACTSNO="'+(a+1).toString()+'" ',i+='DocDetailsID="0"  DocSeqNo="1"   CreditAccount="'+this.PayTermsDataTable[a].DebitAccountID_Key.toString()+'" DebitAccount="-99" ',null!=this.PayTermsDataTable[a].Amount&&""!=this.PayTermsDataTable[a].Amount.toString()?i+='Amount="'+parseFloat(this.PayTermsDataTable[a].Amount)+'" AmtFc="'+parseFloat(this.PayTermsDataTable[a].Amount)+'" ':i+='Amount="0" AmtFc="0" ',i+=' ChequeDate = "'+o.ToString("dd/MMM/yyyy")+'" ChequeMaturityDate = "'+o.ToString("dd/MMM/yyyy")+'" ',i+=this.CurrencyContract.SelectedValue>0?'CurrencyID="'+this.CurrencyContract.SelectedValue+'" ':'CurrencyID="1" ',i+='ExchangeRate="1" CommonNarration="'+m.d.GetValidXml(this.PayTermsDataTable[a].Narration.toString())+'" LineNarration="'+m.d.GetValidXml(this.PayTermsDataTable[a].Narration.toString())+'"  ChequeBankName="'+m.d.GetValidXml(this.GetPayBank(this.PayTermsDataTable[a].PayeeBank.toString()))+'" ChequeNumber="'+this.PayTermsDataTable[a].ChequeNo.toString()+'" ',i+="></Transactions> ";let e="";if(this.TempCCID>5e4&&!this.strCCQry.toString().Contains("dcCCNID"+(this.TempCCID-5e4).toString()+"=")&&(e=n.e.IsEmpty(this.PayTermsDataTable[a].TempCCID_Key)?" dcCCNID"+(this.TempCCID-5e4).toString()+"=1,":" dcCCNID"+(this.TempCCID-5e4).toString()+"="+this.PayTermsDataTable[a].TempCCID_Key.toString()+","),this.PayTermsDataTableColumns.Contains("Location_Key")&&!n.e.IsEmpty(this.PayTermsDataTable[a].Location_Key)?e+=" dcCCNID2="+this.PayTermsDataTable[a].Location_Key.toString()+",":this.LocationContract.Visible&&this.LocationContract.SelectedValue>0&&(e+=" dcCCNID2="+this.LocationContract.SelectedValue+","),this.PayTermsDataTableColumns.Contains("Dim_Key")&&!n.e.IsEmpty(this.PayTermsDataTable[a].Dim_Key)&&(e+=" dcCCNID"+(this.DimCCID-5e4).toString()+"="+this.PayTermsDataTable[a].Dim_Key.toString()+","),e+=this.GetSalemanXml(this.PayTermsDataTable[a]),this.multiVisi&&!this.strCCQry.toString().Contains("dcCCNID"+(this.UnitCCID-5e4).toString()+"=")&&(e+=" dcCCNID"+(this.UnitCCID-5e4).toString()+"="+this.UnitNodeID+","),i+=' <Numeric /> <Alpha /> <CostCenters   Query="'+this.strCCQry.toString()+e+'"  /> ',i+="<EXTRAXML> ",s.a.SessionManager.Preferences.ContainsKey("On")&&"True"==s.a.SessionManager.Preferences.On&&!n.e.IsEmpty(this.PayTermsDataTable[a].Amount)&&!n.e.IsEmpty(this.PayTermsDataTable[a].DebitAccountID_Key)){let t=!1,e=s.a.rental.IsBillWiseAccount(parseInt(this.PayTermsDataTable[a].DebitAccountID_Key.toString()));if(null!=e&&e.Tables.length>0&&e.Tables[0].length>0&&!n.e.IsEmpty(e.Tables[0][0].IsBillwise)&&(t=Object(r.j)(e.Tables[0][0].IsBillwise)),t){i+="<BillWise> ";let t=parseFloat(this.PayTermsDataTable[a].Amount.toString());i+=' <Row DocSeqNo="1" AccountID="'+this.PayTermsDataTable[a].DebitAccountID_Key.toString(),i+='" AmountFC="-'+t+'" AdjAmount="-'+t+'"',i+=' AdjCurrID="1" ',i+='AdjExchRT="1" ',i+='IsNewReference="1" ',i+='Narration="" ',i+='IsDocPDC="0" ',i+=" ></Row>",i+=" </BillWise>"}}if(i+="</EXTRAXML> ",i+=" </Row>",i+='<Row><Transactions CONTRACTSNO="'+(a+1).toString()+'" ',i+=' DocDetailsID="0" DocSeqNo="2" CreditAccount="-99" DebitAccount="'+this.RentRecAc.SelectedValue.toString()+'" ',null!=this.PayTermsDataTable[0].Amount&&""!=this.PayTermsDataTable[0].Amount.toString()?i+='Amount="'+parseFloat(this.PayTermsDataTable[a].Amount)+'"  AmtFc="'+parseFloat(this.PayTermsDataTable[a].Amount)+'" ':i+='Amount="0"  AmtFc="0" ',i+=' ChequeDate = "'+o.ToString("dd/MMM/yyyy")+'" ChequeMaturityDate = "'+o.ToString("dd/MMM/yyyy")+'" ',i+=this.CurrencyContract.SelectedValue>0?'CurrencyID="'+this.CurrencyContract.SelectedValue+'" ':'CurrencyID="1" ',i+='ExchangeRate="1" CommonNarration="'+m.d.GetValidXml(this.PayTermsDataTable[a].Narration.toString())+'" LineNarration="'+m.d.GetValidXml(this.PayTermsDataTable[a].Narration.toString())+'"  ChequeBankName="'+m.d.GetValidXml(this.GetPayBank(this.PayTermsDataTable[a].PayeeBank.toString()))+'" ChequeNumber="'+this.PayTermsDataTable[a].ChequeNo.toString()+'" ',i+="></Transactions> ",e="",this.TempCCID>5e4&&!this.strCCQry.toString().Contains("dcCCNID"+(this.TempCCID-5e4).toString()+"=")&&(e=""!=this.PayTermsDataTable[a].TempCCID_Key.toString()?" dcCCNID"+(this.TempCCID-5e4).toString()+"="+this.PayTermsDataTable[a].TempCCID_Key.toString()+",":" dcCCNID"+(this.TempCCID-5e4).toString()+"=1,"),this.PayTermsDataTableColumns.Contains("Location_Key")&&!n.e.IsEmpty(this.PayTermsDataTable[a].Location_Key)?e+=" dcCCNID2="+this.PayTermsDataTable[a].Location_Key.toString()+",":this.LocationContract.Visible&&this.LocationContract.SelectedValue>0&&(e+=" dcCCNID2="+this.LocationContract.SelectedValue+","),this.PayTermsDataTableColumns.Contains("Dim_Key")&&!n.e.IsEmpty(this.PayTermsDataTable[a].Dim_Key)&&(e+=" dcCCNID"+(this.DimCCID-5e4).toString()+"="+this.PayTermsDataTable[a].Dim_Key.toString()+","),e+=this.GetSalemanXml(this.PayTermsDataTable[a]),this.multiVisi&&!this.strCCQry.toString().Contains("dcCCNID"+(this.UnitCCID-5e4).toString()+"=")&&(e+=" dcCCNID"+(this.UnitCCID-5e4).toString()+"="+this.UnitNodeID+","),i+=' <Numeric /> <Alpha /> <CostCenters   Query="'+this.strCCQry.toString()+e+'"  /> ',i+="<EXTRAXML> ",s.a.SessionManager.Preferences.ContainsKey("On")&&"True"==s.a.SessionManager.Preferences.On&&t&&!n.e.IsEmpty(this.PayTermsDataTable[a].Amount)){i+="<BillWise> ";let t=parseFloat(this.PayTermsDataTable[a].Amount.toString()),e=0;for(let a=0;a<this.DataTable.length;a++)if((n.e.IsEmpty(this.DataTable[a].DebitAccountID_Key)||!(parseInt(this.DataTable[a].DebitAccountID_Key.toString())>0))&&!n.e.IsEmpty(this.DataTable[a].Amount)){if(e+=parseFloat(this.DataTable[a].Amount.toString()),e<this.ValueUsed)continue;let s=0,n=e-this.ValueUsed;if(t>n?(t-=n,s=n):(s=t,t=0),i+=' <Row DocSeqNo="2" AccountID="'+this.RentRecAc.SelectedValue.toString(),i+='" AmountFC="'+s+'" AdjAmount="'+s+'"',i+=' AdjCurrID="1" ',i+='AdjExchRT="1" ',i+='IsNewReference="0" ',i+='Narration="" ',i+='IsDocPDC="0" ',i+='RefDocNo="'+(a+1).toString()+'" ',i+=" ></Row>",this.ValueUsed+=s,t<=0)break}i+=" </BillWise>"}i+="</EXTRAXML> ",i+=" </Row>"}95==this.CostCenterID&&this.SinglePDC||(i+='</DocumentXML><ChequeDocDate DD="'+o.ToString("dd/MMM/yyyy")+'"></ChequeDocDate></ROWS>')}if(null!=e&&e.Tables.length>6&&e.Tables[6].length>0)for(a=0;a<e.Tables[6].length;a++)if(""!=e.Tables[6][a].Amount.toString()&&parseFloat(e.Tables[6][a].Amount.toString())>0){95==this.CostCenterID&&this.SinglePDC||(i+='<ROWS><AccountType DD="BANK"',this.CancelOnTerminate&&(i+=' CancelDOCID="'+e.Tables[6][a].DocID.toString()+'"'),i+=' ></AccountType><Documents DocID="0"></Documents><DocumentXML>'),i+='<Row><Transactions CONTRACTSNO="'+(a+1).toString()+'" DocDetailsID="0" DocSeqNo="1" ',i+='CreditAccount="'+e.Tables[6][a].DebitAccount.toString()+'" DebitAccount="'+e.Tables[6][a].CreditAccount.toString()+'" ',i+=' CurrencyID="1" ExchangeRate="1"  Amount="'+parseFloat(e.Tables[6][a].Amount)+'"  AmtFc="'+parseFloat(e.Tables[6][a].Amount)+'" ',""!=e.Tables[6][a].ChequeDate.toString()&&(i+='ChequeDate = "'+new Date(e.Tables[6][a].ChequeDate.toString()).ToString("dd/MMM/yyyy")+'" '),""!=e.Tables[6][a].ChequeMaturityDate.toString()&&(i+='ChequeMaturityDate = "'+new Date(e.Tables[6][a].ChequeMaturityDate.toString()).ToString("dd/MMM/yyyy")+'" '),i+='CommonNarration="'+e.Tables[6][a].Narration.toString()+'" LineNarration="'+e.Tables[6][a].Narration.toString()+'"  ChequeBankName="'+e.Tables[6][a].ChequeBankName.toString()+'" ChequeNumber="'+e.Tables[6][a].ChequeNumber.toString()+'" ',i+="></Transactions> ";let t=this.AddRowCC(e.Tables[6][a],null,0,0,e.Tables[6]);i+=' <Numeric /> <Alpha /> <CostCenters   Query="'+this.strCCQry.toString()+t+'"  />   ',i+="<EXTRAXML> </EXTRAXML>  </Row>",95==this.CostCenterID&&this.SinglePDC||(i+=" </DocumentXML></ROWS>")}return 104==this.CurrCostCenterID?i+="</PDPayment>":(95==this.CostCenterID&&this.SinglePDC&&i.length>10&&(i+=" </DocumentXML></ROWS>"),i+="</PDR>"),Logger.InfoLog("AddEditRenContractViewModel ::Exiting GetPDReceiptXML"),i.toString()}GetMonthlyTerminatedValue(t,e){let a=n.e.Round(t/e,this.Mdeci),i=0,s=this.TerminationDate.Date(),r=0;for(;s<=this.EndDate.Date;)r++,1==r&&1!=s.getDate()?i+=n.e.Round(a/s.DaysInMonth()*(s.DaysInMonth()-s.getDate()),this.Mdeci):s.AddMonths(1)>this.EndDate.Date&&this.EndDate.Date.getDate()!=s.DaysInMonth()?i+=n.e.Round(a/s.DaysInMonth()*this.EndDate.Date.getDate(),this.Mdeci):i+=a,s=1==r?s.AddDays(s.DaysInMonth()-s.getDate()+1):s.AddMonths(1);return t-a*e!=0&&(i+=t-a*e),n.e.Round(i,this.Mdeci)}GetPartPaymentXML(t){let e="",a=new Date;Logger.InfoLog("AddEditRenContractViewModel ::Entering GetPartPaymentXML"),e+="<PARTICULARS>";for(let i=1;i<this.DataTable.length;i++)if(null!=this.DataTable[i].DebitAccountID_Key&&""!=this.DataTable[i].DebitAccountID_Key.toString()&&parseInt(this.DataTable[i].DebitAccountID_Key.toString())>0&&null!=this.DataTable[i].Amount&&""!=this.DataTable[i].Amount.toString()&&parseFloat(this.DataTable[i].Amount.toString())>0&&"0"!=this.DataTable[i].Refund.toString()){let r=parseFloat(this.DataTable[i].Amount.toString());if("True"==this.DataTable[i].PostDebit.toString())continue;if("2"==this.DataTable[i].Refund.toString()){let t=this.CalculateMonths();t>1&&"Daily"!=this.BasedOn.SelectedValue?r=this.GetMonthlyTerminatedValue(r,t):(r-=r/this.GetDays()*(this.TerminationDate.Date.Subtract(this.StartDate.Date).Days+1),r=n.e.Round(r,this.Mdeci))}n.e.IsEmpty(this.DataTable[i].CntrlDate_Key)||""==n.e.StringValue(this.DataTable[i].CntrlDate_Key)||(a=new Date(this.DataTable[i].CntrlDate_Key)),this.BankAccounts.ContainsKey(n.e.StringValue(this.DataTable[i].DebitAccountID_Key))?e+='<ROWS><AccountType DD="BANK"></AccountType><Documents DocID="0"></Documents><DocumentXML>':e+='<ROWS><AccountType DD="CASH"></AccountType><Documents DocID="0"></Documents><DocumentXML>';let o=1,l=null;if(!n.e.IsEmpty(this.DataTable[i].Xml)&&this.multiVisi){let t=new n.f;t.LoadXml(this.DataTable[i].Xml.toString()),t.ChildNodes.length>0&&null!=t.ChildNodes[0].Attributes&&null!=t.ChildNodes[0].attributes.Filter&&!n.e.StringIsNullOrEmpty(t.ChildNodes[0].attributes.Filter.value)&&(0!=parseInt(t.ChildNodes[0].attributes.Filter.value)&&1!=parseInt(t.ChildNodes[0].attributes.Filter.value)||(o=this.SelectedUnits.split(",").length,l=0==parseInt(t.ChildNodes[0].attributes.Filter.value)?t.SelectNodes("XML/UnitsRow"):t.SelectNodes("XML/Row"),null==this.MultiNode&&(this.MultiNode=s.a.rental.GetUnitNodeIDs(this.SelectedUnits))))}for(let c=0;c<o;c++){null!=l&&o>1&&l.length>c&&null!=l[c].attributes.Amount&&!n.e.StringIsNullOrEmpty(l[c].attributes.Amount.value)&&(r=parseFloat(l[c].attributes.Amount.value),"2"==this.DataTable[i].Refund.toString())&&(r-=r/this.GetDays()*(this.TerminationDate.Date.Subtract(this.StartDate.Date).Days+1),r=n.e.Round(r,this.Mdeci)),e+='<Row><Transactions  CONTRACTSNO="'+(i+1).toString()+'" ',e+='DocDetailsID="0"  DocSeqNo="1" ',e+=104==this.CurrCostCenterID?'DebitAccount="'+this.DataTable[i].DebitAccountID_Key.toString()+'" CreditAccount="'+this.RentRecAc.SelectedValue+'" ':this.DontpostSIV?'CreditAccount="'+this.DataTable[i].DebitAccountID_Key.toString()+'" DebitAccount="'+this.DataTable[i].CreditAccountID_Key.toString()+'" ':'CreditAccount="'+this.DataTable[i].DebitAccountID_Key.toString()+'" DebitAccount="'+this.RentRecAc.SelectedValue+'" ',e+='Amount="'+r+'" AmtFc="'+r+'" ',a&&null!=this.DataTable[i].ChequeNo&&""!=this.DataTable[i].ChequeNo.toString()&&null!=this.DataTable[i].PayeeBank&&""!=this.DataTable[i].PayeeBank.toString()?(e+='ChequeDate = "'+a.ToString("dd/MMM/yyyy")+'" ChequeMaturityDate = "'+a.ToString("dd/MMM/yyyy")+'" ',e+=this.CurrencyContract.SelectedValue>0?'CurrencyID="'+this.CurrencyContract.SelectedValue+'" ':'CurrencyID="1" ',e+='ExchangeRate="1"  ChequeBankName="'+m.d.GetValidXml(this.GetPayBank(this.DataTable[i].PayeeBank.toString()))+'" ChequeNumber="'+this.DataTable[i].ChequeNo.toString()+'" '):(e+=a?' ChequeDate = "'+a.ToString("dd/MMM/yyyy")+'" ChequeMaturityDate = "'+a.ToString("dd/MMM/yyyy")+'" ':' ChequeDate = "" ChequeMaturityDate = "" ',e+=this.CurrencyContract.SelectedValue>0?'CurrencyID="'+this.CurrencyContract.SelectedValue+'" ':'CurrencyID="1" ',e+='ExchangeRate="1" ChequeBankName="" ChequeNumber="" '),e+='CommonNarration="'+m.d.GetValidXml(this.DataTable[i].Narration.toString())+'" LineNarration="'+m.d.GetValidXml(this.DataTable[i].Narration.toString())+'" ',e+="></Transactions> ";let h="";if(this.TempCCID>5e4&&!this.strCCQry.toString().Contains("dcCCNID"+(this.TempCCID-5e4).toString()+"=")&&(h=n.e.IsEmpty(this.DataTable[i].TempCCID_Key)?" dcCCNID"+(this.TempCCID-5e4).toString()+"=1,":" dcCCNID"+(this.TempCCID-5e4).toString()+"="+this.DataTable[i].TempCCID_Key.toString()+","),this.DataTableColumns.Contains("Location_Key")&&!n.e.IsEmpty(this.DataTable[i].Location_Key)?h+=" dcCCNID2="+this.DataTable[i].Location_Key.toString()+",":this.LocationContract.Visible&&this.LocationContract.SelectedValue>0&&(h+=" dcCCNID2="+this.LocationContract.SelectedValue+","),this.DataTableColumns.Contains("Dim_Key")&&!n.e.IsEmpty(this.DataTable[i].Dim_Key)&&(h+=" dcCCNID"+(this.DimCCID-5e4).toString()+"="+this.DataTable[i].Dim_Key.toString()+","),h+=this.GetSalemanXml(this.DataTable[i]),this.multiVisi&&!this.strCCQry.toString().Contains("dcCCNID"+(this.UnitCCID-5e4).toString()+"="))if(null!=l&&o>1&&l.length>c&&null!=l[c].attributes.Unit&&!n.e.StringIsNullOrEmpty(l[c].attributes.Unit.Value)){let t=this.MultiNode.filter(t=>t.UnitID==l[c].attributes.Unit.value);t.length>0&&(h+=" dcCCNID"+(this.UnitCCID-5e4).toString()+"="+t[0].nodeid.toString()+",")}else h+=" dcCCNID"+(this.UnitCCID-5e4).toString()+"="+this.UnitNodeID+",";e+=' <Numeric /> <Alpha /> <CostCenters   Query="'+this.strCCQry.toString()+h+'"  /> ',e+="<EXTRAXML> ",s.a.SessionManager.Preferences.ContainsKey("On")&&"True"==s.a.SessionManager.Preferences.On&&t&&!this.DontpostSIV&&(e+='<BillWise> <Row DocSeqNo="1" AccountID="'+this.RentRecAc.SelectedValue.toString(),e+=104==this.CurrCostCenterID?'" AmountFC="'+r+'" AdjAmount="'+r+'"':'" AmountFC="-'+r+'" AdjAmount="-'+r+'"',e+=' AdjCurrID="1" ',e+='AdjExchRT="1" ',e+='IsNewReference="0" ',e+='Narration="" ',e+='IsDocPDC="0" ',e+='RefDocNo="'+(i+1).toString()+'" ',e+=" ></Row></BillWise>"),e+="</EXTRAXML> ",e+=" </Row>"}e+=a?'</DocumentXML><ChequeDocDate DD="'+a.ToString("dd/MMM/yyyy")+'"></ChequeDocDate></ROWS>':'</DocumentXML><ChequeDocDate DD="'+(new Date).ToString("dd/MMM/yyyy")+'"></ChequeDocDate></ROWS>'}return e+="</PARTICULARS>",Logger.InfoLog("AddEditRenContractViewModel ::Exiting GetPartPaymentXML"),e.toString()}GetSRTXML(t,e,a,i,r,o){Logger.InfoLog("AddEditRenContractViewModel ::Entering GetSRTXML");let l="",c=1,h="";l+=104==this.CurrCostCenterID?"<PIV>":"<SIV>",this.DimCCID<5e4&&this.SingleInvoice&&(l+='<ROWS><Documents DocID="0" CONTRACTSNO="'+(c++).toString()+'"></Documents><DocumentXML>');let D,u=0;this.DataTable.length>0&&""!=this.DataTable[0].Amount.toString()&&(u=n.e.Round(n.e.Double(this.DataTable[0].Amount.toString())/this.GetDays(),this.dDeci)),D=this.DimCCID>5e4?this.DataTable.filter(t=>t.Amount>0,"Dim_Key desc"):this.DataTable;let C=0,S="",b=0;for(let y=0;y<D.length;y++){let t=0,T=0,I=0;if(this.DistribtueInvoice&&this.SingleInvoice&&95==this.CostCenterID&&(2==i||3==i)&&!n.e.IsEmpty(D[y].Amount)&&n.e.Double(D[y].Amount)>0){T=n.e.Double(D[y].Amount.toString());let a=e.filter(t=>t.PartID==D[y].NodeID.toString()).Compute("sum","TotInv");if(n.e.IsEmpty(a)||(t=n.e.Double(D[y].Amount.toString())-n.e.Double(a)),t>.01)return this.DisplayMessage="Pending recur invoice.",this.MessageVisibility=!0,""}if(!n.e.IsEmpty(D[y].Amount)&&n.e.Double(D[y].Amount)>0&&(D[y].NodeID.toString()==this.id2.toString()||5==i||"1"==n.e.String(D[y].Refund)||1==i&&""!=n.e.String(D[y].AdvanceAcc)&&"2"==n.e.String(D[y].Refund))){if(D[y].NodeID.toString()!=this.id2.toString()&&this.DontpostSIV&&!n.e.IsEmpty(D[y].DebitAccountID_Key)&&parseInt(D[y].DebitAccountID_Key.toString())>0)continue;if(T=0,I=0,5==i){let t=e.filter(t=>t.PartID==D[y].NodeID.toString()).Compute("sum","TotInv");null!=t&&null!=t&&(T=n.e.Double(t))}else D[y].NodeID.toString()==this.id2.toString()?(r||1!=i||this.GetSalesReturnAmount(a),T=this.SRTAmount):T=n.e.Double(D[y].Amount.toString());if(T>0){this.DimCCID>5e4?(S!=D[y].Dim_Key.toString()&&(C>0&&(l+="</DocumentXML></ROWS>"),l+='<ROWS><Documents DocID="0" CONTRACTSNO="'+(c++).toString()+'"></Documents><DocumentXML>'),C++,S=D[y].Dim_Key.toString()):this.SingleInvoice||(l+='<ROWS><Documents DocID="0" CONTRACTSNO="'+(c++).toString()+'"></Documents><DocumentXML>');let a=1,r=null;if(5!=i&&!n.e.IsEmpty(D[y].Xml)&&this.multiVisi){let t=new n.f;t.LoadXml(D[y].Xml.toString()),t.ChildNodes.length>0&&null!=t.ChildNodes[0].Attributes&&null!=t.ChildNodes[0].attributes.Filter&&!n.e.StringIsNullOrEmpty(t.ChildNodes[0].attributes.Filter.value)&&(0!=parseInt(t.ChildNodes[0].attributes.Filter.value)&&1!=parseInt(t.ChildNodes[0].attributes.Filter.value)||(a=this.SelectedUnits.split(",").length,r=0==parseInt(t.ChildNodes[0].attributes.Filter.value)?t.SelectNodes("XML/UnitsRow"):t.SelectNodes("XML/Row"),null==this.MultiNode&&(this.MultiNode=s.a.rental.GetUnitNodeIDs(this.SelectedUnits))))}for(let c=0;c<a;c++){let C=null;if(null!=r&&a>1&&r.length>c&&null!=r[c].attributes.Unit&&!n.e.StringIsNullOrEmpty(r[c].attributes.Unit.value)){var d=this.MultiNode.filter(t=>t.UnitID==r[c].attributes.Unit.value);d.length>0&&(C=d[0])}if(t=0,this.DistribtueInvoice&&this.SingleInvoice&&e.length>0)if(null!=r&&null!=C&&a>1&&r.length>c&&null!=r[c].attributes.Amount&&!n.e.StringIsNullOrEmpty(r[c].attributes.Amount.value)){let a=e.filter(t=>t.PartID==D[y].NodeID.toString()&&t.UnitID==C.nodeid.toString()).Compute("sum","TotInv");null!=a&&null!=a&&(t=n.e.Double(r[c].attributes.Amount.value)-n.e.Double(a))}else{let a=e.filter(t=>t.PartID==D[y].NodeID.toString()).Compute("sum","TotInv");null!=a&&null!=a&&(t=n.e.Double(D[y].Amount.toString())-n.e.Double(a))}if(5!=i){if(D[y].NodeID.toString()!=this.id2.toString()&&1==a&&"2"==D[y].Refund.toString()&&this.DataTableColumns.Contains("srtAmt")&&!n.e.IsEmpty(D[y].srtAmt)?(T=n.e.Double(D[y].srtAmt.toString()),this.DataTableColumns.Contains("DiscReturn")&&""!=D[y].DiscReturn.toString()&&(I=parseFloat(D[y].DiscReturn.toString()))):null!=C&&C.Table.Columns.Contains(D[y].NodeID.toString())&&""!=C[D[y].NodeID.toString()].toString()?(T=n.e.Double(C[D[y].NodeID.toString()].toString()),C.Table.Columns.Contains(D[y].NodeID.toString()+"Disc")&&""!=C[D[y].NodeID.toString()+"Disc"].toString()&&(I=parseFloat(C[D[y].NodeID.toString()+"Disc"].toString()))):null!=r&&a>1&&r.length>c&&null!=r[c].attributes.Amount&&!n.e.IsEmpty(r[c].attributes.Amount.value)&&(T=n.e.Double(r[c].attributes.Amount.value)),u<1&&T-t<-.01)return this.DisplayMessage="Pending recur invoice.",this.MessageVisibility=!0,"";if(T-t<-1)return this.DisplayMessage="Pending recur invoice.",this.MessageVisibility=!0,"";if(1==i&&(T-=t),D[y].NodeID.toString()!=this.id2.toString())if(this.RefundAmt+=T,(g=this.dtTerm.filter(t=>t.NodeID==D[y].NodeID.toString())).length>0)g[0].Amt=parseFloat(g[0].Amt.toString())+T;else{let t={};t.NodeID=D[y].NodeID.toString(),t.Amt=T,!n.e.IsEmpty(D[y].AdvanceAcc)&&parseInt(D[y].AdvanceAcc.toString())>0&&(t.IsAdv=1),this.dtTerm.push(t)}}if(0==T){this.DimCCID<5e4&&!this.SingleInvoice&&(l+="</DocumentXML></ROWS>");continue}l+="<RowHead/><Row><Transactions ",l+='DocDetailsID="0" BillDate="'+this.ContractDate.Date.ToString("dd/MMM/yyyy")+'" DocSeqNo="1" LinkedInvDocDetailsID= "" LinkedFieldName= "" ProductID="'+this.ProductID+'" ',l+=this.CurrencyContract.SelectedValue>0?'CurrencyID="'+this.CurrencyContract.SelectedValue+'" ':'CurrencyID="1" ',l+='ExchangeRate="1" Unit="1" UOMConversion="1" ',104==this.CurrCostCenterID?l+='CreditAccount="'+D[y].CreditAccountID_Key.toString()+'" DebitAccount="'+this.RentRecAc.SelectedValue.toString()+'" ':(n.e.IsEmpty(D[y].AdvanceAcc)?l+='DebitAccount="'+D[y].CreditAccountID_Key.toString():l+='DebitAccount="'+D[y].AdvanceAcc.toString(),"True"!=D[y].PostDebit.toString()||n.e.IsEmpty(D[y].DebitAccountID_Key)?l+='" CreditAccount="'+this.RentRecAc.SelectedValue.toString()+'" ':l+='" CreditAccount="'+D[y].DebitAccountID_Key.toString()+'" '),l+=' Quantity="1" Rate="'+T.toString()+'" Gross="'+T.toString()+'" CommonNarration="'+m.d.GetValidXml(this.Narration.Text)+'" LineNarration="'+m.d.GetValidXml(D[y].Narration.toString())+'" ',l+="></Transactions> ";let S="";this.TempCCID>5e4&&!this.strCCQry.toString().Contains("dcCCNID"+(this.TempCCID-5e4).toString()+"=")&&(S=n.e.IsEmpty(D[y].TempCCID_Key)?" dcCCNID"+(this.TempCCID-5e4).toString()+"=1,":" dcCCNID"+(this.TempCCID-5e4).toString()+"="+D[y].TempCCID_Key.toString()+","),this.DataTableColumns.Contains("Location_Key")&&!n.e.IsEmpty(D[y].Location_Key)?S+=" dcCCNID2="+D[y].Location_Key.toString()+",":this.LocationContract.Visible&&this.LocationContract.SelectedValue>0&&(S+=" dcCCNID2="+this.LocationContract.SelectedValue+","),this.DataTableColumns.Contains("Dim_Key")&&!n.e.IsEmpty(D[y].Dim_Key)&&(S+=" dcCCNID"+(this.DimCCID-5e4).toString()+"="+D[y].Dim_Key.toString()+","),S+=this.GetSalemanXml(D[y]),s.a.SessionManager.Preferences.ContainsKey("DepositLinkDimension")&&""!=s.a.SessionManager.Preferences.DepositLinkDimension&&parseInt(s.a.SessionManager.Preferences.DepositLinkDimension)>0&&(S+=" dcCCNID"+(parseInt(s.a.SessionManager.Preferences.DepositLinkDimension)-5e4).toString()+"="+D[y].NodeID.toString()+","),n.e.IsEmpty(D[y].TaxCategory_Key)||(S+=" dcCCNID60="+D[y].TaxCategory_Key.toString()+","),this.DataTableColumns.Contains("SPType_Key")&&!n.e.IsEmpty(D[y].SPType_Key)&&(S+=" dcCCNID61="+D[y].SPType_Key.toString()+","),this.multiVisi&&!this.strCCQry.toString().Contains("dcCCNID"+(this.UnitCCID-5e4).toString()+"=")&&(S+=null!=C?" dcCCNID"+(this.UnitCCID-5e4).toString()+"="+C.nodeid.toString()+",":" dcCCNID"+(this.UnitCCID-5e4).toString()+"="+this.UnitNodeID+","),l+=' <Numeric Query="',I>0&&""!=this.Discountfield&&(l+=this.Discountfield+"=-"+I.toString().Replace(",","")+","+this.Discountfield.Replace("dcNum","dcCalcNum")+"=-"+I.toString().Replace(",","")+",");let p="";if(s.a.SessionManager.Preferences.ContainsKey("VATVersion")?("Inclusive"==D[y].VatType.toString()&&!n.e.IsEmpty(D[y].VatPer)&&n.e.Double(D[y].VatPer.toString())>0&&(T=100*T/(n.e.Double(D[y].VatPer)+100)),p=!n.e.IsEmpty(D[y].VatPer)&&n.e.Double(D[y].VatPer.toString())>0?(T*n.e.Double(D[y].VatPer)/100).ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()):"0",l+=" dcNum51="+T.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()).replace(",","")+",dcCalcNum51="+T.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount.toString()).replace(",",""),!n.e.IsEmpty(D[y].VatPer)&&n.e.Double(D[y].VatPer.toString())>0?(l+=",dcNum52="+D[y].VatPer.toString().replace(",","")+",dcCalcNum52="+D[y].VatPer.toString().replace(",",""),l+=",dcNum60="+D[y].VatPer.toString().replace(",","")+",dcCalcNum60="+D[y].VatPer.toString().replace(",","")):l+=",dcCalcNum52=0,dcNum52=0,dcNum60=0,dcCalcNum60=0",l+=",dcNum53="+p.replace(",","")+",dcCalcNum53="+p.replace(",",""),l+=",dcNum61="+p.replace(",","")+",dcCalcNum61="+p.replace(",","")+",",this.VatAmt=this.VatAmt+n.e.Double(p.replace(",","")),l+='" /> <Alpha  Query="',l+="dcAlpha153='"+D[y].VatType.toString()+"',",l+="dcAlpha152='Service',",l+='" />'):l+='" /> <Alpha />',l+=' <CostCenters   Query="'+this.strCCQry.toString()+S+'"  /> <EXTRAXML/> ',!this.DonotUpdateAccounts){let t,e;l+="<AccountsXML>",104==this.CurrCostCenterID?(e=D[y].CreditAccountID_Key.toString(),t=this.RentRecAc.SelectedValue.toString()):(t=n.e.IsEmpty(D[y].AdvanceAcc)?n.e.StringValue(D[y].CreditAccountID_Key):D[y].AdvanceAcc.toString(),e=n.e.IsEmpty(D[y].DebitAccountID_Key)||"True"!=D[y].PostDebit.toString()?this.RentRecAc.SelectedValue.toString():n.e.StringValue(D[y].DebitAccountID_Key));let i={CostXML1:""};if(this.FillCostPosting(o,t,e,parseFloat(T.toString()),D[y],this.costDims,s.a.SessionManager.Preferences.DecimalsinAmount.toString(),r,a,c,i,D)?h+=i.CostXML1:(l+="<Accounts  ",l+='CreditAccount="'+e+'"  DebitAccount="'+t+'" ',l+='Amount="'+T.toString()+'" AmtFc="'+T.toString()+'" ',l+=this.CurrencyContract.SelectedValue>0?'CurrencyID="'+this.CurrencyContract.SelectedValue+'" ':'CurrencyID="1" ',l+='ExchangeRate="1"  ></Accounts>'),!n.e.IsEmpty(p)&&"0"!=p){104==this.CurrCostCenterID?(e=this.VatAccountID.toString(),t=this.RentRecAc.SelectedValue.toString()):(t=this.VatAccountID.toString(),e=this.RentRecAc.SelectedValue.toString());let i={CostXML1:""};this.FillCostPosting(o,t,e,parseFloat(p),D[y],this.costDims,s.a.SessionManager.Preferences.DecimalsinAmount.toString(),r,a,c,i,D)?h+=i.CostXML1:(l+="<Accounts ",l+='CreditAccount="'+e+'"  DebitAccount="'+t+'" ',l+='Amount="'+p.toString().Replace(",","")+'" AmtFc="'+p.toString().Replace(",","")+'" ',l+=this.CurrencyContract.SelectedValue>0?'CurrencyID="'+this.CurrencyContract.SelectedValue+'" ':'CurrencyID="1" ',l+='ExchangeRate="1"  ></Accounts>')}I>0&&(104==this.CurrCostCenterID?(e=this.RentRecAc.SelectedValue.toString(),t=this.DiscountAccount.toString()):(e=this.DiscountAccount.toString(),t="True"==D[y].PostDebit.toString()&&""!=D[y].DebitAccountID_Key.toString()?D[y].DebitAccountID_Key.toString():this.RentRecAc.SelectedValue.toString()),this.FillCostPosting(o,t,e,-I,D[y],this.costDims,s.a.SessionManager.Preferences.DecimalsinAmount.toString(),r,a,c,i,D)?h+=i.CostXML1:(l+="<Accounts ",l+='CreditAccount="'+e+'"  DebitAccount="'+t+'" ',l+='Amount="'+I.toString().Replace(",","")+'" AmtFc="'+I.toString().Replace(",","")+'"  ',l+=this.CurrencyContract.SelectedValue>0?'CurrencyID="'+this.CurrencyContract.SelectedValue+'" ':'CurrencyID="1" ',l+='ExchangeRate="1"  ></Accounts>')),l+="</AccountsXML>"}l+=" </Row>",n.e.IsEmpty(D[y].VatPer)||(b+=T*n.e.Double(D[y].VatPer)/100)}this.DimCCID<5e4&&!this.SingleInvoice&&(n.e.IsEmpty(h)||(l+=h),h="",l+="</DocumentXML></ROWS>")}}}if(!s.a.SessionManager.Preferences.ContainsKey("VATVersion")&&1==i&&b>0&&this.VatNode>0&&95==this.CurrCostCenterID){var T=D.filter(t=>t.NodeID==this.VatNode);T.length>0&&"2"==n.e.StringValue(T[0].Refund)&&(l+='<ROWS><Documents DocID="0" CONTRACTSNO="'+(c++).toString()+'"></Documents><DocumentXML>',l+="<RowHead/><Row><Transactions  ",l+='DocDetailsID="0" BillDate="'+this.ContractDate.Date.ToString("dd/MMM/yyyy")+'"  DocSeqNo="1"  LinkedInvDocDetailsID= ""  LinkedFieldName= "" ProductID="'+this.ProductID+'" CurrencyID="1" ExchangeRate="1" Unit="1" UOMConversion="1" ',l+='DebitAccount="'+T[0].CreditAccountID_Key.toString()+'" CreditAccount="'+this.RentRecAc.SelectedValue.toString()+'" ',l+=' Quantity="1"  Rate="'+b.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount)+'"  Gross="'+b.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount)+'"   CommonNarration="'+m.d.GetValidXml(this.Narration.Text)+'" ',l+="></Transactions> ",l+=' <Numeric /> <Alpha /> <CostCenters   Query="'+this.strCCQry.toString()+'"   /> <EXTRAXML/>',this.DonotUpdateAccounts||(l+="<AccountsXML><Accounts ",l+='DebitAccount="'+T[0].CreditAccountID_Key.toString()+'"  CreditAccount="'+this.RentRecAc.SelectedValue.toString()+'" ',l+='Amount="'+b.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount).replace(",","")+'" AmtFc="'+b.ToString("N"+s.a.SessionManager.Preferences.DecimalsinAmount).replace(",","")+'" ',l+=this.CurrencyContract.SelectedValue>0?'CurrencyID="'+this.CurrencyContract.SelectedValue+'" ':'CurrencyID="1" ',l+='ExchangeRate="1"  ></Accounts></AccountsXML>'),l+=" </Row>",this.SingleInvoice||(l+="</DocumentXML></ROWS>"))}if(t.length>0)for(let y=0;y<t.length;y++)if(!n.e.IsEmpty(t[y].Amount)&&n.e.Double(t[y]["Amount".toString()])>0){var g;if(this.RefundAmt+=parseFloat(t[y].Amount.toString()),(g=this.dtTerm.filter(e=>e.NodeID==t[y].CCNodeID.toString())).length>0)g[0].Amt=parseFloat(g[0].Amt.toString())+parseFloat(t[y].Amount.toString());else{let e={};e.NodeID=t[y].CCNodeID.toString(),e.Amt=parseFloat(t[y].Amount.toString()),this.dtTerm.push(e)}this.SingleInvoice||(l+='<ROWS><Documents DocID="0" CONTRACTSNO="'+(c++).toString()+'"></Documents><DocumentXML>'),l+="<RowHead/><Row><Transactions  ",l+='DocDetailsID="0" BillDate="'+this.ContractDate.Date.ToString("dd/MMM/yyyy")+'"  DocSeqNo="1"  LinkedInvDocDetailsID= ""  LinkedFieldName= "" ProductID="'+this.ProductID+'" CurrencyID="1" ExchangeRate="1" Unit="1" UOMConversion="1" ',l+=104==this.CurrCostCenterID?'CreditAccount="'+t[y].CreditAccID.toString()+'" DebitAccount="'+this.RentRecAc.SelectedValue.toString()+'" ':'DebitAccount="'+t[y].CreditAccID.toString()+'" CreditAccount="'+this.RentRecAc.SelectedValue.toString()+'" ',l+=' Quantity="1"  Rate="'+t[y].Amount.toString()+'"  Gross="'+t[y].Amount.toString()+'"   CommonNarration="'+m.d.GetValidXml(this.Narration.Text)+'" ',l+="></Transactions> ";let e="";s.a.SessionManager.Preferences.ContainsKey("DepositLinkDimension")&&""!=s.a.SessionManager.Preferences.DepositLinkDimension&&parseInt(s.a.SessionManager.Preferences.DepositLinkDimension)>0&&(e+=" dcCCNID"+(parseInt(s.a.SessionManager.Preferences.DepositLinkDimension)-5e4).toString()+"="+t[y].CCNodeID.toString()+","),n.e.IsEmpty(t[y].TaxCategoryID)||(e+=" dcCCNID60="+t[y].TaxCategoryID.toString()+","),this.DimCCID>0&&50002==this.DimCCID||(Object.keys(t[y]).Contains("LocationID")&&!n.e.IsEmpty(t[y].LocationID)?e+=" dcCCNID2="+t[y].LocationID.toString()+",":this.LocationContract.Visible&&this.LocationContract.SelectedValue>0&&(e+=" dcCCNID2="+this.LocationContract.SelectedValue+",")),Object.keys(t[y]).Contains("SPType")&&!n.e.IsEmpty(t[y].SPType)&&(e+=" dcCCNID61="+t[y].SPType.toString()+","),Object.keys(t[y]).Contains("DimNodeID")&&!n.e.IsEmpty(t[y].DimNodeID)&&(e+=" dcCCNID"+(this.DimCCID-5e4).toString()+"="+t[y].DimNodeID.toString()+",");for(let a=0;a<this.ContractParticular.length;a++)this.ContractParticular[a].DisplayMember.startsWith("CCNID")&&t.Contains(this.ContractParticular[a].DisplayMember)&&""!=t[y][this.ContractParticular[a].DisplayMember].toString()&&(e+=" dc"+this.ContractParticular[a].DisplayMember+"="+t[y][this.ContractParticular[a].DisplayMember].toString()+",");l+=' <Numeric Query="',s.a.SessionManager.Preferences.ContainsKey("VATVersion")&&(n.e.IsEmpty(t[y].TaxableAmt)?l+=" dcNum51="+t[y].Amount.toString()+",dcCalcNum51="+t[y].Amount.toString():l+=" dcNum51="+t[y].TaxableAmt.toString()+",dcCalcNum51="+t[y].TaxableAmt.toString(),!n.e.IsEmpty(t[y].VatPer)&&n.e.Double(t[y].VatPer.toString())>0?(l+=",dcNum52="+t[y].VatPer.toString().replace(",","")+",dcCalcNum52="+t[y].VatPer.toString().replace(",",""),l+=",dcNum60="+t[y].VatPer.toString().replace(",","")+",dcCalcNum60="+t[y].VatPer.toString().replace(",","")):l+=",dcCalcNum52=0,dcNum52=0,dcNum60=0,dcCalcNum60=0",n.e.IsEmpty(t[y].VatAmount)?l+=",dcCalcNum53=0,dcNum53=0,dcNum61=0,dcCalcNum61=0":(l+=",dcNum53="+t[y].VatAmount.toString().replace(",","")+",dcCalcNum53="+t[y].VatAmount.toString().replace(",",""),l+=",dcNum61="+t[y].VatAmount.toString().replace(",","")+",dcCalcNum61="+t[y].VatAmount.toString().replace(",","")+",",this.VatAmt=this.VatAmt+n.e.Double(t[y].VatAmount.toString().replace(",","")))),l+='" /> <Alpha  Query="',s.a.SessionManager.Preferences.ContainsKey("VATVersion")&&(l+="dcAlpha153='"+t[y].VatType.toString()+"',",l+="dcAlpha152='Service',"),l+='" />',l+=' <CostCenters   Query="'+this.strCCQry.toString()+e+' "   /> <EXTRAXML/>',this.DonotUpdateAccounts||(l+="<AccountsXML><Accounts ",l+=104==this.CurrCostCenterID?'CreditAccount="'+t[y].CreditAccID.toString()+'" DebitAccount="'+this.RentRecAc.SelectedValue.toString()+'" ':'DebitAccount="'+t[y].CreditAccID.toString()+'"  CreditAccount="'+this.RentRecAc.SelectedValue.toString()+'" ',l+='Amount="'+t[y].Amount.toString()+'" AmtFc="'+t[y].Amount.toString()+'" ',l+=this.CurrencyContract.SelectedValue>0?'CurrencyID="'+this.CurrencyContract.SelectedValue+'" ':'CurrencyID="1" ',l+='ExchangeRate="1"  ></Accounts>',!n.e.IsEmpty(t[y].VatPer)&&n.e.Double(t[y].VatPer.toString())>0&&!n.e.IsEmpty(t[y].VatAmount)&&n.e.Double(t[y].VatAmount.toString())>0&&(l+="<Accounts ",104==this.CurrCostCenterID?l+='CreditAccount="'+this.VatAccountID+'"  DebitAccount="'+this.RentRecAc.SelectedValue.toString()+'" ':(l+='DebitAccount="'+this.VatAccountID,l+='"  CreditAccount="'+this.RentRecAc.SelectedValue.toString()+'" '),l+='Amount="'+t[y].VatAmount.toString().replace(",","")+'" AmtFc="'+t[y].VatAmount.toString().replace(",","")+'" ',l+=this.CurrencyContract.SelectedValue>0?'CurrencyID="'+this.CurrencyContract.SelectedValue+'" ':'CurrencyID="1" ',l+='ExchangeRate="1"  ></Accounts>'),l+="</AccountsXML>"),l+=" </Row>",this.SingleInvoice||(l+="</DocumentXML></ROWS>")}return this.SingleInvoice&&"<SIV>"!=l.toString()&&(l+="</DocumentXML></ROWS>"),l+=104==this.CurrCostCenterID?"</PIV>":"</SIV>",Logger.InfoLog("AddEditRenContractViewModel ::Exiting GetSRTXML"),l.toString()}GetRentPaymentXML(t,e,a=[]){Logger.InfoLog("AddEditRenContractViewModel ::Entering GetRentPaymentXML");let i,r,o="",l=new Date,c=new Date,h=new Date,D=0,u=0;o+="<RENTRCT>";let C=t.map(t=>t.Type).filter((t,e,a)=>a.indexOf(t)==e).length;for(let S=0;S<this.DataTable.length;S++)if(null!=this.DataTable[S].NodeID&&!n.e.IsEmpty(this.DataTable[S].NodeID)&&null!=this.DataTable[S].Amount&&""!=this.DataTable[S].Amount.toString().Trim()&&n.e.Double(this.DataTable[S].Amount.toString())>0&&(0==S&&e||!n.e.IsEmpty(this.DataTable[S].AdvanceAcc)&&"2"==this.DataTable[S].Refund.toString())){let e=0,b=0,d=this.DataTable[S].CreditAccountID_Key.toString(),T=this.IncomeAc.SelectedValue.toString();S>0&&(d=this.DataTable[S].AdvanceAcc.toString(),T=this.DataTable[S].CreditAccountID_Key.toString());let g=new n.f,y=-1,I=-1,p=1,A=this.UnitNodeID,P=null;n.e.IsEmpty(this.DataTable[S].Xml)||(g.LoadXml(this.DataTable[S].Xml.toString()),g.ChildNodes.length>0&&null!=g.ChildNodes[0].Attributes&&null!=g.ChildNodes[0].attributes.Filter&&!n.e.StringIsNullOrEmpty(g.ChildNodes[0].attributes.Filter.value)&&(I=parseInt(g.ChildNodes[0].attributes.Filter.value)),1!=I&&(y=0),!this.multiVisi||0!=I&&1!=I||(p=this.SelectedUnits.split(",").length,null==this.MultiNode&&(this.MultiNode=s.a.rental.GetUnitNodeIDs(this.SelectedUnits)),p>1&&!this.MultiNode.Columns.Contains(this.DataTable[S].NodeID.toString())&&this.MultiNode.Columns.push(this.DataTable[S].NodeID.toString())));for(let N=0;N<p;N++){let I=0,V=null;b=e=0,D=n.e.Round(parseFloat(this.DataTable[0].Amount.toString())/this.GetDays(),this.dDeci);let R=0,f=this.CalculateMonths();if(R=this.TotalMonths>1?n.e.Round(parseFloat(this.DataTable[S].Amount.toString())/f,this.Mdeci):parseFloat(this.DataTable[S].Amount.toString()),1==p&&0==y)P=g.ChildNodes[0].ChildNodes;else if(p>1){if(null!=g.ChildNodes[0].ChildNodes[N].attributes.Unit&&!n.e.StringIsNullOrEmpty(g.ChildNodes[0].ChildNodes[N].attributes.Unit.value)){let t=this.MultiNode.filter(t=>t.UnitID==g.ChildNodes[0].ChildNodes[N].attributes.Unit.value);t.length>0&&(A=parseInt(t[0].nodeid.toString()),V=t[0])}null==g.ChildNodes[0].ChildNodes[N].attributes.Amount||n.e.StringIsNullOrEmpty(g.ChildNodes[0].ChildNodes[N].attributes.Amount.value)||(D=n.e.Round(parseFloat(g.ChildNodes[0].ChildNodes[N].attributes.Amount.value)/this.GetDays(),this.dDeci)),P=g.ChildNodes[0].ChildNodes[N].ChildNodes}for(l=this.TerminationDate.Date();l<=this.EndDate.Date;){let g="";r=i=0;let N=null,V=new Date(l.getFullYear(),l.getMonth(),1,0,0,0);if(N=t.filter(t=>new Date(t.docdate)>=V),g="DocDate>='"+V.toString(),V=new Date(l.getFullYear(),l.getMonth(),l.DaysInMonth(),23,59,59),N=N.filter(t=>new Date(t.docdate)<=V),g+="' and DocDate<='"+V.toString()+"'",I>0){p>1&&null!=t[0].unitNodeID&&(g+=" and unitNodeID="+A,N=N.filter(t=>t.unitNodeID==A)),C>1&&(N=N.filter(t=>t.Type==this.DataTable[S].NodeID.toString()),g+=" and Type="+this.DataTable[S].NodeID.toString());let e=N;e.length>0&&!n.e.IsEmpty(e[0].amount)?(u=parseFloat(e[0].amount.toString()),a.Contains("Disc")&&""!=e[0].Disc.toString()&&(i=parseFloat(e[0].Disc.toString().Replace("-","")))):l.AddMonths(1)>this.EndDate.Date?("Daily"!=this.BasedOn.SelectedValue&&(D=R/l.DaysInMonth()),u=n.e.Round(D*this.EndDate.Date.getDate(),this.Mdeci)):u="Daily"==this.BasedOn.SelectedValue?n.e.Round(D*l.DaysInMonth(),this.Mdeci):R}else{p>1&&null!=t[0].unitNodeID&&(g+=" and unitNodeID="+A,N=N.filter(t=>t.unitNodeID==A)),C>1&&(N=N.filter(t=>t.Type==this.DataTable[S].NodeID.toString()),g+=" and Type="+this.DataTable[S].NodeID.toString());let e=N;if(e.length>0&&!n.e.IsEmpty(e[0].amount))l.getFullYear()==this.StartDate.Date.getFullYear()&&l.getMonth()==this.StartDate.Date.getMonth()&&(D=n.e.Round(parseFloat(e[0].amount.toString())/this.EndDate.Date.getDay(),this.dDeci)),a.Contains("Disc")&&""!=e[0].Disc.toString()?r=n.e.Round(parseFloat(e[0].Disc.toString().Replace("-",""))/this.EndDate.Date.getDay(),this.dDeci):l.getFullYear()==this.EndDate.Date.getFullYear()&&l.getMonth()==this.EndDate.Date.getMonth()&&(D=n.e.Round(parseFloat(e[0].amount.toString())/(l.DaysInMonth()-this.StartDate.Date.getDate()+1),this.dDeci)),a.Contains("Disc")&&""!=e[0].Disc.toString()?r=n.e.Round(parseFloat(e[0].Disc.toString().Replace("-",""))/(l.DaysInMonth()-this.StartDate.Date.getDate()+1),this.dDeci):D=n.e.Round(parseFloat(e[0].amount.toString())/l.DaysInMonth(),this.dDeci),a.Contains("Disc")&&""!=e[0].Disc.toString()&&(r=n.e.Round(parseFloat(e[0].Disc.toString().Replace("-",""))/l.DaysInMonth(),this.dDeci));else if(0==y)for(let t=0;t<P.length;t++)if(n.e.isValidDate(P[t].attributes.FromDate.value)&&(c=new Date(P[t].attributes.FromDate.value)),n.e.isValidDate(P[t].attributes.ToDate.value)&&(h=new Date(P[t].attributes.ToDate.value)),l>c&&l<h){D=n.e.Round(parseFloat(P[t].attributes.Amount.value)/this.GetDays_1(c,h),this.dDeci);break}l.getMonth()==this.EndDate.Date.getMonth()&&l.getFullYear()==this.EndDate.Date.getFullYear()?(u=n.e.Round(D*n.e.GetDateDifference(this.EndDate.Date,l),this.Mdeci),r>0&&(i=n.e.Round(r*n.e.GetDateDifference(this.EndDate.Date,l),this.Mdeci))):u=n.e.Round(D*((new Date).DaysInMonth()-l.getDate()),this.Mdeci),r>0&&(i=n.e.Round(r*((new Date).DaysInMonth()-l.getDate()),this.Mdeci))}if(u>0&&(0==I||!this.CancelIncomeonTerminate)){o+='<ROWS><ChequeDocDate DD="'+l.ToString("dd/MMM/yyyy")+'"></ChequeDocDate><DocumentXML>',o+='<Row><Transactions CONTRACTSNO="'+(I+1).toString()+'" ',o+='DocDetailsID="0" DocSeqNo="1" ',o+=104==this.CurrCostCenterID?'CreditAccount="'+T+'" DebitAccount="'+d+'" ':'CreditAccount="'+d+'" DebitAccount="'+T+'" ',o+='Amount="'+u.toString()+'" AmtFc="'+u.toString()+'" ',o+='ChequeDate = "'+l.ToString("dd/MMM/yyyy")+'" ',o+=this.CurrencyContract.SelectedValue>0?'CurrencyID="'+this.CurrencyContract.SelectedValue+'" ':'CurrencyID="1" ',o+='ExchangeRate="1"  CommonNarration="'+m.d.GetValidXml(this.Narration.Text)+'"  LineNarration="  RENT SETTLEMENT " ChequeBankName="" ChequeNumber="" ',o+="></Transactions> ";let t="";this.multiVisi&&!this.strCCQry.toString().Contains("dcCCNID"+(this.UnitCCID-5e4).toString()+"=")&&(t+=" dcCCNID"+(this.UnitCCID-5e4).toString()+"="+A+","),this.DataTableColumns.Contains("Location_Key")&&!n.e.IsEmpty(this.DataTable[S].Location_Key)?t+=" dcCCNID2="+this.DataTable[S].Location_Key.toString()+",":this.LocationContract.Visible&&this.LocationContract.SelectedValue>0&&(t+=" dcCCNID2="+this.LocationContract.SelectedValue+","),this.DataTableColumns.Contains("Dim_Key")&&!n.e.IsEmpty(this.DataTable[S].Dim_Key)&&(t+=" dcCCNID"+(this.DimCCID-5e4).toString()+"="+this.DataTable[S].Dim_Key.toString()+","),t+=this.GetSalemanXml(this.DataTable[S]),s.a.SessionManager.Preferences.ContainsKey("DepositLinkDimension")&&""!=s.a.SessionManager.Preferences.DepositLinkDimension&&parseInt(s.a.SessionManager.Preferences.DepositLinkDimension)>0&&(t+=" dcCCNID"+(parseInt(s.a.SessionManager.Preferences.DepositLinkDimension)-5e4).toString()+"="+this.DataTable[S].NodeID.toString()+","),o+=' <Numeric Query="',""!=this.Discountfield&&i>0&&(o+=this.Discountfield+"=-"+i+","+this.Discountfield.Replace("dcNum","dcCalcNum")+"=-"+i+","),o+='" /> <Alpha /> <CostCenters   Query="'+this.strCCQry.toString()+t+'"  /> <EXTRAXML/>',o+="<AccountsXML>",""!=this.Discountfield&&i>0&&(o+="<Accounts ",104==this.CurrCostCenterID?(o+='CreditAccount="'+this.DiscountAccount+'" ',o+='DebitAccount="'+T+'" '):(o+='DebitAccount="'+this.DiscountAccount+'" ',o+='CreditAccount="'+T+'" '),o+='Amount="'+i.toString()+'" ',o+='AmtFc="'+i.toString()+'" ',o+='CurrencyID="1" ',o+='ExchangeRate="1" ',o+='IsNegative="1" ',o+="></Accounts>"),o+=" </AccountsXML></Row>",o+="</DocumentXML></ROWS>"}l=0==I?l.AddDays((new Date).DaysInMonth()-l.getDate()+1):l.AddMonths(1),I++,0==S&&(this.SRTAmount=this.SRTAmount+u,this.DiscReturn=this.DiscReturn+n.e.DoubleTryParse(i)),e+=u,b+=n.e.DoubleTryParse(i)}null!=V&&(V[this.DataTable[S].NodeID.toString()]=e,b>0?(this.MultiNode.Columns.Contains(this.DataTable[S].NodeID.toString()+"Disc")||this.MultiNode.Columns.push(this.DataTable[S].NodeID.toString()+"Disc"),V[this.DataTable[S].NodeID.toString()+"Disc"]=b):this.MultiNode.Columns.Contains(this.DataTable[S].NodeID.toString()+"Disc")&&(V[this.DataTable[S].NodeID.toString()+"Disc"]=0))}S>0&&1==p&&(this.DataTableColumns.Contains("srtAmt")||this.DataTableColumns.push("srtAmt"),this.DataTable[S].srtAmt=e),b>0&&(this.DataTableColumns.Contains("DiscReturn")||this.DataTableColumns.push("DiscReturn"),this.DataTable[S].DiscReturn=b)}return o+="</RENTRCT>",Logger.InfoLog("AddEditRenContractViewModel ::Exiting GetRentPaymentXML"),o.toString()}GetSalesReturnAmount(t){Logger.InfoLog("AddEditRenContractViewModel ::Entering GetSalesReturnAmount");let e=new Date,a=new Date,i=new Date,r=0,o=0;for(let l=0;l<this.DataTable.length;l++)if(null!=this.DataTable[l].NodeID&&!n.e.IsEmpty(this.DataTable[l].NodeID)&&null!=this.DataTable[l].Amount&&""!=this.DataTable[l].Amount.toString().Trim()&&parseFloat(this.DataTable[l].Amount.toString())>0&&(0==l||!n.e.IsEmpty(this.DataTable[l].AdvanceAcc)&&"2"==this.DataTable[l].Refund.toString())){let c=0,h=new n.f,D=-1,u=-1,C=1,m=this.UnitNodeID,S=null;n.e.IsEmpty(this.DataTable[l].Xml)||(h.LoadXml(this.DataTable[l].Xml.toString()),h.ChildNodes.length>0&&null!=h.ChildNodes[0].Attributes&&null!=h.ChildNodes[0].attributes.Filter&&!n.e.StringIsNullOrEmpty(h.ChildNodes[0].attributes.Filter.Value)&&(u=parseInt(h.ChildNodes[0].attributes.Filter.value)),1!=u&&(D=0),!this.multiVisi||0!=u&&1!=u||(C=this.SelectedUnits.split(",").length,null==this.MultiNode&&(this.MultiNode=s.a.rental.GetUnitNodeIDs(this.SelectedUnits)),C>1&&!this.MultiNode.Columns.Contains(this.DataTable[l].NodeID.toString())&&this.MultiNode.Columns.push(this.DataTable[l].NodeID.toString())));for(let s=0;s<C;s++){let u,b=0,d=null;c=0,r=n.e.Round(parseFloat(this.DataTable[l].Amount.toString())/this.GetDays(),this.dDeci);let T=this.CalculateMonths();if(u=T>1?n.e.Round(parseFloat(this.DataTable[l].Amount.toString())/T,this.Mdeci):parseFloat(this.DataTable[l].Amount.toString()),1==C&&0==D)S=h.ChildNodes[0].ChildNodes;else if(C>1){if(null!=h.ChildNodes[0].ChildNodes[s].attributes.Unit&&!n.e.StringIsNullOrEmpty(h.ChildNodes[0].ChildNodes[s].attributes.Unit.value)){let t=this.MultiNode.filter(t=>t.UnitID==h.ChildNodes[0].ChildNodes[s].attributes.Unit.value);t.length>0&&(m=parseInt(t[0].nodeid.toString()),d=t[0])}null==h.ChildNodes[0].ChildNodes[s].attributes.Amount||n.e.StringIsNullOrEmpty(h.ChildNodes[0].ChildNodes[s].attributes.Amount.value)||(r=n.e.Round(parseFloat(h.ChildNodes[0].ChildNodes[s].attributes.Amount.value)/this.GetDays(),this.dDeci)),S=h.ChildNodes[0].ChildNodes[s].ChildNodes}for(e=this.TerminationDate.Date();e<=this.EndDate.Date;){if(b>0){let s=new Date(e.getFullYear(),e.getMonth(),1,0,0,0).ToString("dd/MMM/yyyy"),c="x=>x.DocDate>='"+s.toString();s=new Date(e.getFullYear(),e.getMonth(),e.DaysInMonth(),23,59,59).ToString("dd/MMM/yyyy"),c+="' && x.DocDate<='"+s.toString()+"'",C>1&&t.Columns.Contains("unitNodeID")&&(c+=" && x.unitNodeID=="+m),c+=" && x.Type=="+this.DataTable[l].NodeID.toString();let h=[];!n.e.IsEmpty(t)&&t.length>0&&(h=t.filter(c)),!n.e.IsEmpty(h)&&h.length>0&&""!=h[0].Amount.toString()?o=parseFloat(h[0].Amount.toString()):e.AddMonths(1)>this.EndDate.Date?o="Daily"!=this.BasedOn.SelectedValue&&this.EndDate.Date.getDate()==e.DaysInMonth()?u:n.e.Round(r*this.EndDate.Date.getDate(),this.Mdeci):D>=0?(i<e.AddDays(e.DaysInMonth()-1)&&e.AddMonths(1)<this.EndDate.Date&&(D++,n.e.isValidDate(S[D].attributes.FromDate.value)&&(a=S[D].attributes.FromDate.value),n.e.isValidDate(S[D].attributes.ToDate.value)&&(i=S[D].attributes.ToDate.value),T=this.CalculateMonthsbetweenDates(a,i),u=T>1?n.e.Round(n.e.DoubleTryParse(S[D].attributes.Amount.value)/T,this.Mdeci):n.e.DoubleTryParse(S[D].attributes.Amount.value),r=n.e.Round(n.e.DoubleTryParse(S[D].attributes.Amount.value)/this.GetDays_1(a,i),this.dDeci)),n.e.isValidDate(S[D].attributes.FromDate.value)&&(a=S[D].attributes.FromDate.value),o=1!=a.getDate()||"Daily"==this.BasedOn.SelectedValue?n.e.Round(r*(a.DaysInMonth()-a.getDate()+1),this.Mdeci):u):o="Daily"==this.BasedOn.SelectedValue?n.e.Round(r*e.DaysInMonth(),this.Mdeci):u}else{if(0==D){for(let t=0;t<S.length;t++)if(n.e.isValidDate(S[t].attributes.FromDate.value)&&(a=new Date(S[t].attributes.FromDate.value)),n.e.isValidDate(S[t].attributes.ToDate.value)&&(i=new Date(S[t].attributes.ToDate.value)),e>=a&&e<=i){T=this.CalculateMonthsbetweenDates(a,i),u=T>1?n.e.Round(n.e.DoubleTryParse(S[t].attributes.Amount.value)/T,this.Mdeci):n.e.DoubleTryParse(S[t].attributes.Amount.value),r=n.e.Round(n.e.DoubleTryParse(S[t].attributes.Amount.value)/this.GetDays_1(a,i),this.dDeci),D=t;break}}else"Monthly"==this.BasedOn.SelectedValue&&(r=u/e.DaysInMonth());o=e.getMonth()==this.EndDate.Date.getMonth()&&e.getFullYear()==this.EndDate.Date.getFullYear()?n.e.Round(r*n.e.GetDateDifference(this.EndDate.Date,e),this.Mdeci):n.e.Round(r*(e.DaysInMonth()-e.getDate()),this.Mdeci)}e=0==b?e.AddDays(e.DaysInMonth()-e.getDate()+1):e.AddMonths(1),b++,0==l&&(this.SRTAmount=this.SRTAmount+o),c+=o}null!=d&&(d[this.DataTable[l].NodeID.toString()]=c)}l>0&&1==C&&(this.DataTableColumns.Contains("srtAmt")||this.DataTableColumns.push("srtAmt"),this.DataTableObj.Table[l].srtAmt=c)}Logger.InfoLog("AddEditRenContractViewModel ::Exiting GetSalesReturnAmount")}OnMessageCallBack(){this.res="Yes",this.resTerm="Yes"}OnShowAttachment(){}OnAddNote(){this.Note=new I.AddNoteViewModel,this.Note.AddNoteViewModel_2(this)}OnAddAttachment(){this.Attachment=new g.AddAttachmentViewModel,this.Attachment.AddAttachmentViewModel_2(this)}OnShowNote(){}OnShowContact(){}OnAddContact(){}get NoteVisibility(){return this._NoteVisibility}set NoteVisibility(t){this._NoteVisibility=t}ClearCallBack(t,e){if(t>0){"AutoSave"!=e&&0==this.ContractID&&this.RenewRefID>0&&this.RenewSubContracts(10,this.RenewRefID),this.SaveAndPrintContactID=t,this.draftid>0&&"SaveDraft"!=e&&(95==this.CurrCostCenterID||104==this.CurrCostCenterID)&&s.a.rental.DeleteQuotation(95,this.draftid),this.RenewRefID=0,this.DataTableObj.Clear(),this.PayTermsDataTableObj.Clear(),this.CalculateFooter(),this.TotalYears.Text="",this.Months.Text="",this.NonRecAmount.Text="0.00",this.RecAmount.Text="0.00",this.TotalAmount.Text="0.00";let a=s.a.rental.GetNextContractNo(this.CurrCostCenterID,this.ParentContractID);this.SlNO.Text=a,this.StartDate.Date=null,this.EndDate.Date=null,this.ViewNotes.NotesListObj.Clear(),this.ViewNotes.DeletedNotes.Clear(),this.ViewAttachments.AttachmentsListObj.Clear(),this.ViewAttachments.OnShowNewAttachment(null),this.ViewAttachments.DeletedAttachments.Clear(),null!=this.ViewActivities&&this.ViewActivities.ActivityGridData.Clear(),this.IsSavePrintClick&&(this.IsSavePrintClick=!1,this.Export("Print")),this.ClearData();for(let t=0;t<6;t++){let t=this.DataTableObj.NewRow();t.Recurr=!1,this.DataTableObj.addRow(t);let e=this.PayTermsDataTableObj.NewRow();this.PayTermsDataTableObj.addRow(e)}Logger.InfoLog("AddEditRenContractViewModel :: Exiting OnSaveContract")}}SetButtonEnable(t,e){let a=this.ButtonsLeft.find(e=>e.ComParam.toUpperCase()==t.toUpperCase());!n.e.IsEmpty(a)&&a.length>0&&(a[0].Enable=e)}CheckUnits(t){n.e.IsEmpty(t)||this.OnSave("CheckUnits")}DocumentDraftsPopup(t){return Object(i.b)(this,void 0,void 0,(function*(){const{DocumentDraftsViewModel:e}=yield Promise.resolve().then(a.bind(null,"ouML")),{DocumentDraftsComponent:i}=yield Promise.resolve().then(a.bind(null,"vgHJ"));s.a.page.ShowDialog(new e(this,t,this.CurrCostCenterID),i,{HideClose:!0,ShowCenter:!0})}))}GetCostingds(t,e,a,i){let n="",r=!1;return i.forEach(i=>{parseInt(i)>5e4?n+=this.GetWhere(parseInt(i),t):2==parseInt(i)?n+=" and AccountID in("+e+","+a+")":502==parseInt(i)&&(r=!0,n+=" and (db.AccountID is not null or Cr.AccountID is not null)")}),s.a.rental.getProfileBasedon(e,a,r,n)}RefershPage(){if(0==this.DataTableObj.Table.length)for(let t=0;t<6;t++){let t=this.DataTableObj.NewRow();t.Recurr=!1,this.DataTableObj.addRow(t);let e=this.PayTermsDataTableObj.NewRow();this.PayTermsDataTableObj.addRow(e)}this.RentAmt.Text="",this.ContractID=0,this.Months.Text="",this.TotalYears.Text="",this.Narration.Text="",this.RefershTitle()}OnKeyDown_Payment(t,e){if(9==e.which){let e=this.PayTermsDataTableObj.Table.indexOf(t.grid.getDataItem(t.row));if(-1==e)e=1;else if(e+=1,this.PayTermsDataTableObj.Table.length-e<3&&this.PayTermsDataTableObj.CanUserAddRows){let t=this.PayTermsDataTableObj.NewRow();this.UpdateSequencePay(),t.SNO=this.PSNO,t.Recurr=!1,this.PayTermsDataTableObj.addRow(t)}}}OnKeyDown(t,e){if("F6"==e.key)e.preventDefault(),this.onCopy(this.DataTableObj.getArgsObj(t));else if(9==e.which){let e=this.DataTableObj.Table.indexOf(t.grid.getDataItem(t.row));if(-1==e)e=1;else if(e+=1,this.DataTableObj.Table.length-e<3&&this.DataTableObj.CanUserAddRows){let t=this.DataTableObj.NewRow();this.UpdateSequence(),t.SNO=this.SNO,t.Recurr=!1,this.DataTableObj.addRow(t)}}else if(9==e.which){let e=this.PayTermsDataTableObj.Table.indexOf(t.grid.getDataItem(t.row));if(-1==e)e=1;else if(e+=1,this.PayTermsDataTableObj.Table.length-e<3&&this.PayTermsDataTableObj.CanUserAddRows){let t=this.PayTermsDataTableObj.NewRow();this.UpdateSequence(),t.SNO=this.SNO,t.Recurr=!1,this.PayTermsDataTableObj.addRow(t)}}else("F5"==e.key||e.ctrlKey&&"F5"==e.key)&&(e.preventDefault(),this.onDistribute(this.DataTableObj.getArgsObj(t)))}CmenuItem_Click(t,e){if(console.log("CmenuItem_Click"),null!=this.PayTermsDataTableObj.SelectedItem&&null!=this.PayTermsDataTableObj.angularGrid.dataView.getItems()&&this.PayTermsDataTableObj.angularGrid.dataView.getItems()&&null!=t&&t instanceof D.b){let e=t.Tag.toString();if("Copy"==e||"CopyRef"==e)this.PayTermsDataTableObj.SelectedItem&&(this.CopiedRow=this.PayTermsDataTableObj.SelectedItem),this.IsRef="CopyRef"==e;else if("Paste"==e&&null!=this.CopiedRow&&this.PayTermsDataTableObj.Table.Contains(this.CopiedRow)&&this.PayTermsDataTableObj.SelectedItem){if(!this.PayTermsDataTableObj.CanUserAddRows)return;for(let t=0;t<this.PayTermsDataTableObj.TableColumns.length;t++)"cntrldate"!=this.PayTermsDataTableObj.TableColumns[t].toString().toLowerCase()&&"cntrldate_key"!=this.PayTermsDataTableObj.TableColumns[t].toString().toLowerCase()&&"postingdate"!=this.PayTermsDataTableObj.TableColumns[t].toString().toLowerCase()&&"postingdate_key"!=this.PayTermsDataTableObj.TableColumns[t].toString().toLowerCase()&&"paynodeid"!=this.PayTermsDataTableObj.TableColumns[t].toString().toLowerCase()&&"payeebank"!=this.PayTermsDataTableObj.TableColumns[t].toString().toLowerCase()&&"narration"!=this.PayTermsDataTableObj.TableColumns[t].toString().toLowerCase()&&"debitaccountid"!=this.PayTermsDataTableObj.TableColumns[t].toString().toLowerCase()&&"debitaccountid_key"!=this.PayTermsDataTableObj.TableColumns[t].toString().toLowerCase()&&"amount"!=this.PayTermsDataTableObj.TableColumns[t].toString().toLowerCase()&&"chequeno"!=this.PayTermsDataTableObj.TableColumns[t].toString().toLowerCase()||(this.PayTermsDataTableObj.SelectedItem[this.PayTermsDataTableObj.TableColumns[t]]=this.CopiedRow[this.PayTermsDataTableObj.TableColumns[t]]);this.CalculateFooter(),this.PayTermsDataTableObj.updateRow(this.PayTermsDataTableObj.SelectedItem)}else s.a.toastr.warning("Not Implemented "+t)}}}class $ extends A.b{constructor(){super(...arguments),this.IsOpening=new c.e}PromptIsOpening(t){this.Parent=t,this.IsOpening.Label="Is Opening",this.IsOpening.Items.push(c.d.ComboBoxItems_2("YES","1")),this.IsOpening.Items.push(c.d.ComboBoxItems_2("NO","0")),this.IsOpening.SelectedValue="1",this.IsOpening.Width="200"}OnCLick(t){this.Parent.DialogResult="OK"==t,s.a.page.HideDialog()}}}}]);
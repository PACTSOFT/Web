function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var i,n=_getPrototypeOf(e);if(t){var s=_getPrototypeOf(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return _possibleConstructorReturn(this,i)}}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{f8PW:function(e,t,i){"use strict";i.r(t),i.d(t,"AddCCMapViewModel",(function(){return C})),i.d(t,"AddRoleTreeNodes",(function(){return p})),i.d(t,"CheckBoxTreeViewModel",(function(){return c}));var n=i("0/4Q"),s=i("PDNK"),a=i("EQd/"),o=i("4HhE"),l=i("Do2H"),r=i("ScVY"),d=i("eQJW"),h=i("Lp6j"),C=function(e){_inherits(i,e);var t=_createSuper(i);function i(e){var r;return _classCallCheck(this,i),(r=t.call(this)).CompanyList=new n.b(0),r.Administration={},r.Product={},r.SelectionChangedCommand=new o.b,r.LocationChanged=new o.b,r.Save=new o.b,r.ButtonClick=new o.b,r.CntCheck=0,r.isFilter=!1,r.CheckBoxTreeViewModel=new c,Logger.InfoLog("AddCCMapViewModel::Entering AddCCMapViewModel with Parent="+e),r.ViewModel=e,r.SearchText=new a.d(0),r.BindControls(),r.Save.Subscribe(_assertThisInitialized(r),"onSave"),r.ButtonClick.Subscribe(_assertThisInitialized(r),"onSelectionChanged"),r.Fields=new s.b,r.Fields=new s.b(""),r.Fields.Items.push(new s.a("Name",0)),r.Fields.Items[0].Label=l.a.GetResource("Name"),r.Fields.Items[0].IsChecked=!1,r.Fields.Items.push(new s.a("Code",1)),r.Fields.Items[1].Label=l.a.GetResource("Code"),r.Fields.Items[1].IsChecked=!1,r.Fields.Items.push(new s.a("Name-Code",1)),r.Fields.Items[2].Label=l.a.GetResource("Name-Code"),r.Fields.Items[2].IsChecked=!0,r.Fields.Items[0].CheckedChangedCommand.Subscribe(_assertThisInitialized(r),"FieldChanged"),r.Fields.Items[1].CheckedChangedCommand.Subscribe(_assertThisInitialized(r),"FieldChanged"),r.Fields.Items[2].CheckedChangedCommand.Subscribe(_assertThisInitialized(r),"FieldChanged"),r.SelectionChangedCommand.Subscribe(_assertThisInitialized(r),"onSelectionChanged","onCanSelectionChanged"),r.LocationChanged.Subscribe(_assertThisInitialized(r),"onLocationChanged, onCanSelectionChanged"),null!=e&&6==e.ParentFeatureID&&(r.SelectedType="6"),r.onSelectionChanged(""),Logger.InfoLog("AddCCMapViewModel::Exiting AddCCMapViewModel"),r}return _createClass(i,[{key:"onSave",value:function(e){if("Cancel"==e.toString())this.ViewModel.CCMapVisibility=!1,"6"==this.SelectedType&&(this.onLocationChanged(null),this.ViewModel.CCMapVisibility=!1),l.a.page.HideDialog();else{this.CntCheck=0;var t=this.ViewModel.ViewCCMapping.DataList.length,i=t-1;if(!this.isFilter)if(null!=this.SelectedType&&"6"!=this.SelectedType&&null!=this.ViewModel.ViewCCMapping.DataList&&null!=this.ViewModel.ViewCCMapping.TempData){for(var n=t;n>0;n--,i--)h.e.IsEmpty(this.ViewModel.ViewCCMapping.DataList[i].CostCenterId)||this.ViewModel.ViewCCMapping.DataList[i].CostCenterId.toString()!=this.SelectedType.toString()||this.ViewModel.ViewCCMapping.DataList.RemoveAt(i);i=(t=this.ViewModel.ViewCCMapping.TempData.length)-1;for(var s=t;s>0;s--,i--)h.e.IsEmpty(this.ViewModel.ViewCCMapping.TempData[i].CostCenterId)||this.ViewModel.ViewCCMapping.TempData[i].CostCenterId.toString()!=this.SelectedType.toString()||this.ViewModel.ViewCCMapping.TempData.RemoveAt(i)}else{for(var a=t;a>0;a--,i--)this.ViewModel.ViewCCMapping.DataList.length>=i&&(h.e.IsEmpty(this.ViewModel.ViewCCMapping.DataList[i].ParentNodeId)||this.ViewModel.ViewCCMapping.DataList[i].ParentNodeId.toString()!=this.LocationSelectedType.toString()||this.ViewModel.ViewCCMapping.DataList.RemoveAt(i),this.ViewModel.ViewCCMapping.DataList.length>i&&(h.e.IsEmpty(this.ViewModel.ViewCCMapping.DataList[i].NodeID)||this.ViewModel.ViewCCMapping.DataList[i].NodeID.toString()!=this.LocationSelectedType.toString()||this.ViewModel.ViewCCMapping.DataList.RemoveAt(i)));i=(t=this.ViewModel.ViewCCMapping.TempData.length)-1;for(var o=t;o>0;o--,i--)this.ViewModel.ViewCCMapping.TempData.length>=i&&(h.e.IsEmpty(this.ViewModel.ViewCCMapping.TempData[i].ParentNodeId)||this.ViewModel.ViewCCMapping.TempData[i].ParentNodeId.toString()!=this.LocationSelectedType.toString()||this.ViewModel.ViewCCMapping.TempData.RemoveAt(i),this.ViewModel.ViewCCMapping.TempData.length>i&&(h.e.IsEmpty(this.ViewModel.ViewCCMapping.TempData[i].NodeID)||this.ViewModel.ViewCCMapping.TempData[i].NodeID.toString()!=this.LocationSelectedType.toString()||this.ViewModel.ViewCCMapping.TempData.RemoveAt(i)))}if(this.BindTbl(),"6"==this.SelectedType&&this.CntCheck>0){var r=this.ViewModel.ViewCCMapping.DataListObj.NewRow();r.CostCenterId="50002",r.CostCenterName="Location",r.NodeID=this.LocationSelectedType,r.Value=this.SelectedItem.Name,this.ViewModel.ViewCCMapping.DataListObj.addRow(r);var d={CostCenterId:"50002",CostCenterName:"Location"};d.NodeID=this.LocationSelectedType,d.Value=this.SelectedItem.Name,this.ViewModel.ViewCCMapping.TempData.push(d)}this.ViewModel.ViewCCMapping.DataListObj.refreshDataView(),this.ViewModel.ViewCCMapping.UpdateSequence()}}},{key:"AddDataRow",value:function(e){this.CntCheck++;for(var t,i=-1,n=0;n<this.ViewModel.ViewCCMapping.DataListObj.Table.length;n++)if(h.e.IsEmpty(this.ViewModel.ViewCCMapping.DataListObj.Table[n].CostCenterId)){i=n;break}if(t=i>-1?this.ViewModel.ViewCCMapping.DataListObj.Table[i]:this.ViewModel.ViewCCMapping.DataListObj.NewRow(),"6"!=this.SelectedType){t.CostCenterId=this.SelectedType,t.CostCenterName="",t.NodeID=e.FeatureActionID,t.Value=e.Name,this.ViewModel.ViewCCMapping.DataListObj.TableColumns.Contains("Code")&&null!=t&&this.ViewModel.ViewCCMapping.GetCodeInfo(t),-1==i?this.ViewModel.ViewCCMapping.DataListObj.addRow(t):this.ViewModel.ViewCCMapping.DataListObj.updateRow(t);var s={};s.CostCenterId=this.SelectedType,s.CostCenterName="",s.NodeID=e.FeatureActionID,s.Value=e.Name,this.ViewModel.ViewCCMapping.TempDataColumns.Contains("Code")&&null!=t&&this.ViewModel.ViewCCMapping.DataListObj.TableColumns.Contains("Code")&&""!=t.Code.toString()&&(s.Code=t.Code.toString()),this.ViewModel.ViewCCMapping.TempData.push(s)}else{t.ParentNodeId=this.LocationSelectedType,t.CostCenterId="50001",t.CostCenterName="Division",t.NodeID=e.FeatureActionID,t.Value=e.Name,this.ViewModel.ViewCCMapping.DataListObj.TableColumns.Contains("Code")&&null!=t&&this.ViewModel.ViewCCMapping.GetCodeInfo(t),-1==i?this.ViewModel.ViewCCMapping.DataListObj.addRow(t):this.ViewModel.ViewCCMapping.DataListObj.updateRow(t);var a={};a.ParentNodeId=this.LocationSelectedType,a.CostCenterId="50001",a.CostCenterName="Division",a.NodeID=e.FeatureActionID,a.Value=e.Name,h.e.IsEmpty(t.Code)||(a.Code=t.Code.toString()),this.ViewModel.ViewCCMapping.TempData.push(a)}}},{key:"GetListNodes",value:function(e){var t=this;if(e.IsChecked){var i=!1;if(this.isFilter){if(this.ViewModel.ViewCCMapping.DataList.filter((function(i){return i.CostCenterID==t.SelectedType&&i.NodeID==e.FeatureActionID})).length>0)return;e.AChildren.length>0&&e.AChildren.forEach((function(e){i=!0,t.GetListNodes(e)}))}i||this.AddDataRow(e)}else e.AChildren.length>0&&e.AChildren.forEach((function(e){t.GetListNodes(e)}))}},{key:"BindTbl",value:function(){var e=this;null!=this.CheckBoxTreeViewModel&&this.CheckBoxTreeViewModel.AChildren.forEach((function(t){e.GetListNodes(t)}))}},{key:"BindControls",value:function(){Logger.InfoLog("AddCCMapViewModel::Entering BindControls");try{this.CostCenter=[];var e={Name:"",FEATUREID:""};this.CostCenter.push(e);var t=l.a.admin.GetTableData(this.ViewModel.ParentFeatureID);null!=t&&t.Tables[0].length>0&&t.Tables.length>0&&(this.CostCenter=t.Tables[0],7==this.ViewModel.ParentFeatureID)&&this.CostCenter.push({FEATUREID:-7,Name:"User_Manager"}),Logger.InfoLog("CustomizeCostCenterViewModel::Leaving BindControls with ColumnName ="+e+",Rows="+e)}catch(i){Logger.ErrorLog("AddCCMapViewModel:: BuildControls"+i.stack)}}},{key:"onLocationChanged",value:function(e){try{if(Logger.InfoLog("AddCCMapViewModel::Entering onLocationChanged Type="+e),null!=this.LocationSelectedType&&"0"!=this.LocationSelectedType){var t=[];t.push(50001),t.push(l.a.SessionManager.LanguageID);var i,n=l.a.admin.getLocationRoles(t),s=[];s.push(50002),s.push(this.LocationSelectedType),s.push(50001),s.push(l.a.SessionManager.UserID),this.dsetMappedNodes=l.a.admin.GetCCCCMap(s),null!=(i=null!=n&&n.Tables.length>0?n.Tables[0]:[])&&n.Tables.length>1&&this.AddRows(i,!1,"Div")}Logger.InfoLog("AddCCMapViewModel::Exiting onLocationChanged Type="+e)}catch(a){Logger.ErrorLog("AddCCMapViewModel:: onLocationChanged"+a.stack)}}},{key:"DivList",value:function(e){for(var t="",i=0;i<e.length;i++)t+=0==i?e.Rows[i].NodeID.toString():","+e.Rows[i].NodeID.toString();return""==t?"1":t}},{key:"FieldChanged",value:function(e){null!=this.SelectedType&&"0"!=this.SelectedType&&this.onSelectionChanged(this.SelectedType)}},{key:"onSelectionChanged",value:function(e){if(Logger.InfoLog("AddCCMapViewModel::Entering onSelectionChanged Type="+e),null!=this.SelectedType&&"0"!=this.SelectedType){this.CompanyList.Items.Clear();var t,i=[];if("6"!=this.SelectedType){var n=[];n.push("-7"==this.SelectedType?7:this.SelectedType),n.push(l.a.SessionManager.LanguageID),null!=this.SearchText&&null!=this.SearchText.Text&&""!=this.SearchText.Text?(this.isFilter=!0,"7"==this.SelectedType||"-7"==this.SelectedType?n.push(" where username like '%"+this.SearchText.Text+"%' "):this.Fields.Items[0].IsChecked?n.push(" where name like '%"+this.SearchText.Text+"%' or parentid =0 "):this.Fields.Items[1].IsChecked?n.push(" where code like '%"+this.SearchText.Text+"%'  or parentid =0 "):this.Fields.Items[2].IsChecked&&n.push(" where (name like '%"+this.SearchText.Text+"%' or  code like '%"+this.SearchText.Text+"%')  or parentid =0 ")):this.isFilter=!1,i=l.a.admin.getLocationRoles(n);var s=[];s.push(this.ViewModel.ParentFeatureID),s.push(this.ViewModel.PNodeID),s.push("-7"==this.SelectedType?7:parseInt(this.SelectedType)),s.push(l.a.SessionManager.UserID),this.dsetMappedNodes=l.a.admin.GetCCCCMap(s)}if(t=null!=i&&i.Tables.length>0?i.Tables[0]:[],"7"==this.SelectedType||"-7"==this.SelectedType?this.AddRows(i.Tables[0],!1,"Usr"):null!=i&&i.Tables.length>0&&this.AddRows(i.Tables[0],!1,""),"6"==this.SelectedType){var a=[];a.push(50002),a.push(l.a.SessionManager.LanguageID),i=l.a.admin.getLocationRoles(a);var o=[];o.push(this.ViewModel.ParentFeatureID),o.push(this.ViewModel.PNodeID),o.push(parseInt(this.SelectedType)),o.push(l.a.SessionManager.UserID),this.dsetMappedNodes=this.Administration.GetCCCCMap(o),t=i.Tables[0],null!=i&&i.Tables.length>0&&(Logger.InfoLog("AddCCMapViewModel::Entering GetDivisions"),null!=l.a.SessionManager.LocationWhere&&""!=l.a.SessionManager.LocationWhere&&(t.RowFilter=" NodeID  in ("+l.a.SessionManager.LocationWhere+")"),this.BindLocationControl(t))}}}},{key:"BindLocationControl",value:function(e){Logger.InfoLog("AddCCMapViewModel::Entering BindLocationControl");try{this.LocationList=[];var t={Name:"",NodeID:""};this.LocationList.push(t);for(var i=0;i<e.length;i++)(t=this.LocationList.NewRow()).Name=e[i].Name.toString(),t.NodeID=e[i].NodeID.toString(),this.LocationList.push(t);e.length>0&&(this.SelectedItem=e[0]),Logger.InfoLog("AddCCMapViewModel::Leaving BindControls with ColumnName ="+t)}catch(n){Logger.ErrorLog("AddCCMapViewModel:: BuildControls"+n.stack)}}},{key:"AddRows",value:function(e,t,i){var n=this;try{!function(){n.lstParents=[],Logger.InfoLog("AddCCMapViewModel::Entering AddRows");var t=0,s=0;n.CheckBoxTreeViewModel.AChildren=[];for(var a,o=!0;t<e.length;t++){if((a=new p).FeatureActionID=parseInt(e[t].NodeID),a.id=a.FeatureActionID,a.Name=e[t].Name.toString(),null!=n.Fields&&n.Fields.Items.length>1&&n.Fields.Items[1].IsChecked&&e.some((function(e){return e.hasOwnProperty("Code")}))&&(a.Name=e[t].Code.toString()),null!=n.Fields&&n.Fields.Items.length>2&&n.Fields.Items[2].IsChecked&&e.some((function(e){return e.hasOwnProperty("Code")}))&&(a.Name=e[t].Name.toString()+"~"+e[t].Code.toString()),o=Object(d.j)(e[t].IsGroup),a.Depth=parseInt(e[t].Depth),n.dsetMappedNodes.Tables.length>1&&((n.dsetMappedNodes.Tables[1].filter((function(e){return e.NodeID==a.FeatureActionID})).length>0||1==n.dsetMappedNodes.Tables[1].length&&"1"==n.dsetMappedNodes.Tables[1][0].Nodeid.toString())&&(a._IsChecked=!0),n.dsetMappedNodes.Tables.length>0&&n.dsetMappedNodes.Tables[2].length>0&&n.dsetMappedNodes.Tables[2].forEach((function(e){a.FeatureActionID==parseInt(e.NodeID.toString())&&(a._IsChecked=!0)}))),"Loc"==i&&""!=l.a.SessionManager.LocationWhere?(e.RowFilter=" NodeID  in ("+l.a.SessionManager.LocationWhere+")",0==e.length&&(a.IsEnabled=!1)):"Div"==i&&n.dsetMappedNodes.Tables.length>1&&n.dsetMappedNodes.Tables[1].length>0&&(e.RowFilter=" NodeID  in ("+n.DivList(n.dsetMappedNodes.Tables[1])+")",0==e.length&&(a.IsEnabled=!1)),o)if(n.lstParents.length>0){if(a.Depth>n.lstParents[n.lstParents.length-1].Depth)a.Parent=n.lstParents[n.lstParents.length-1],n.lstParents[n.lstParents.length-1].IsChecked&&(a._IsChecked=!0),n.lstParents[n.lstParents.length-1].AChildren.push(a),n.lstParents.push(a);else if(a.Depth==n.lstParents[n.lstParents.length-1].Depth)n.lstParents.RemoveAt(n.lstParents.length-1),n.lstParents.length>0&&(a.Parent=n.lstParents[n.lstParents.length-1],n.lstParents[n.lstParents.length-1].IsChecked&&(a._IsChecked=!0),n.lstParents[n.lstParents.length-1].AChildren.push(a)),n.lstParents.push(a);else if(a.Depth<n.lstParents[n.lstParents.length-1].Depth){for(var r=n.lstParents.length-1;r>=0&&a.Depth<=n.lstParents[r].Depth;r--)n.lstParents.RemoveAt(n.lstParents.length-1);n.lstParents.length>0&&(a.Parent=n.lstParents[n.lstParents.length-1],n.lstParents[n.lstParents.length-1].IsChecked&&(a._IsChecked=!0),n.lstParents[n.lstParents.length-1].AChildren.push(a)),n.lstParents.push(a)}}else 0==s&&h.e.IntTryParse(l.a.SessionManager.RoleID)>1&&""!=i&&"Div"==i?(t=-1,s++,a.IsEnabled=!1,n.lstParents.push(a)):n.lstParents.push(a);else if(n.lstParents.length>0){if(a.Depth>n.lstParents[n.lstParents.length-1].Depth)n.lstParents.length>0&&(a.Parent=n.lstParents[n.lstParents.length-1],n.lstParents[n.lstParents.length-1].IsChecked&&(a._IsChecked=!0),n.lstParents[n.lstParents.length-1].AChildren.push(a));else if(a.Depth==n.lstParents[n.lstParents.length-1].Depth){for(var C=n.lstParents.length-1;C>=0&&a.Depth<=n.lstParents[C].Depth;C--)n.lstParents.RemoveAt(n.lstParents.length-1);n.lstParents.length>0&&(a.Parent=n.lstParents[n.lstParents.length-1],n.lstParents[n.lstParents.length-1].IsChecked&&(a._IsChecked=!0),n.lstParents[n.lstParents.length-1].AChildren.push(a))}else if(a.Depth<n.lstParents[n.lstParents.length-1].Depth){for(var c=n.lstParents.length-1;c>=0&&a.Depth<=n.lstParents[c].Depth;c--)n.lstParents.RemoveAt(n.lstParents.length-1);n.lstParents.length>0&&(a.Parent=n.lstParents[n.lstParents.length-1],n.lstParents[n.lstParents.length-1].IsChecked&&(a._IsChecked=!0),n.lstParents[n.lstParents.length-1].AChildren.push(a))}}else n.lstParents.push(a);if(n.ViewModel.ViewCCMapping.DataList.length>0)for(var g=0;g<n.ViewModel.ViewCCMapping.DataList.length;g++)n.SelectedType.toString()==h.e.StringValue(n.ViewModel.ViewCCMapping.DataList[g].CostCenterID)&&(1==Object(d.j)(e[t].IsGroup)&&n.ViewModel.ViewCCMapping.DataList[g].NodeID.toString()==e[t].NodeID.toString()&&"1"!=e[t].NodeID.toString()?n.lstParents[n.lstParents.length-1]._IsChecked=!0:1!=Object(d.j)(e[t].IsGroup)&&n.ViewModel.ViewCCMapping.DataList[g].NodeID.toString()==e[t].NodeID.toString()&&(a._IsChecked=!0))}n.lstParents.length>0&&n.CheckBoxTreeViewModel.AChildren.push(n.lstParents[0]);for(var u=0;u<n.CheckBoxTreeViewModel.AChildren[0].AChildren.length;u++)n.CallRecursiveCheck(n.CheckBoxTreeViewModel.AChildren[0].AChildren[u]);Logger.InfoLog("AddCCMapViewModel:: Leaving AddRows")}()}catch(s){Logger.ErrorLog("AddCCMapViewModel:: AddRows"+s.stack)}}},{key:"CallRecursiveCheck",value:function(e){var t=this;if(e.AChildren.length>0){var i=0;e.AChildren.forEach((function(e){e.AChildren.length>0?(t.CallRecursiveCheck(e),e._IsChecked&&i++):e._IsChecked&&i++})),e._IsChecked=i==e.AChildren.length}}},{key:"GetDivisions",value:function(){}},{key:"onCanSelectionChanged",value:function(e){return!0}},{key:"Title",get:function(){return this._ScreenName},set:function(e){e!=this._ScreenName&&(this._ScreenName=e)}}]),i}(r.b),p=function(){function e(){_classCallCheck(this,e),this._children=[],this._pchildren=[],this.Parent=null,this._MasterChildren=[],this.IsEnabled=!0,this._IsChecked=!1}return _createClass(e,[{key:"SetChildren",value:function(e,t){var i=this;e._children.forEach((function(e){e._IsChecked=t,i.SetChildren(e,t)}))}},{key:"SetParent",value:function(e,t){if(null!=e){var i=0;for(i=0;i<e._children.length&&e._children[i].IsChecked==t;i++);1==t?i==e._children.length?(e._IsChecked=t,this.SetParent(e.Parent,t)):e._IsChecked=!t:(e._IsChecked=t,this.SetParent(e.Parent,t))}}},{key:"OnSelectionChanged",value:function(e){}},{key:"AChildren",get:function(){return this._children}},{key:"PChildren",get:function(){return this._pchildren}},{key:"MChildren",get:function(){return this._MasterChildren}},{key:"IsChecked",get:function(){return this._IsChecked},set:function(e){e!=this._IsChecked&&(this._IsChecked=e),l.a.SessionManager.IsWebApplication&&(this.SetChildren(this,e),this.SetParent(this.Parent,e))}}]),e}(),c=function(e){_inherits(i,e);var t=_createSuper(i);function i(){var e;return _classCallCheck(this,i),(e=t.apply(this,arguments)).AChildren=[],e._Childrens=[],e}return i}(r.b)}}]);
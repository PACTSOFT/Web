(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{f8PW:function(e,t,s){"use strict";s.r(t),s.d(t,"AddCCMapViewModel",(function(){return C})),s.d(t,"AddRoleTreeNodes",(function(){return p})),s.d(t,"CheckBoxTreeViewModel",(function(){return g}));var i=s("0/4Q"),n=s("PDNK"),h=s("EQd/"),a=s("4HhE"),l=s("Do2H"),o=s("ScVY"),d=s("eQJW"),r=s("Lp6j");class C extends o.b{constructor(e){super(),this.CompanyList=new i.b(0),this.Administration={},this.Product={},this.SelectionChangedCommand=new a.b,this.LocationChanged=new a.b,this.Save=new a.b,this.ButtonClick=new a.b,this.CntCheck=0,this.isFilter=!1,this.CheckBoxTreeViewModel=new g,Logger.InfoLog("AddCCMapViewModel::Entering AddCCMapViewModel with Parent="+e),this.ViewModel=e,this.SearchText=new h.d(0),this.BindControls(),this.Save.Subscribe(this,"onSave"),this.ButtonClick.Subscribe(this,"onSelectionChanged"),this.Fields=new n.b,this.Fields=new n.b(""),this.Fields.Items.push(new n.a("Name",0)),this.Fields.Items[0].Label=l.a.GetResource("Name"),this.Fields.Items[0].IsChecked=!1,this.Fields.Items.push(new n.a("Code",1)),this.Fields.Items[1].Label=l.a.GetResource("Code"),this.Fields.Items[1].IsChecked=!1,this.Fields.Items.push(new n.a("Name-Code",1)),this.Fields.Items[2].Label=l.a.GetResource("Name-Code"),this.Fields.Items[2].IsChecked=!0,this.Fields.Items[0].CheckedChangedCommand.Subscribe(this,"FieldChanged"),this.Fields.Items[1].CheckedChangedCommand.Subscribe(this,"FieldChanged"),this.Fields.Items[2].CheckedChangedCommand.Subscribe(this,"FieldChanged"),this.SelectionChangedCommand.Subscribe(this,"onSelectionChanged","onCanSelectionChanged"),this.LocationChanged.Subscribe(this,"onLocationChanged, onCanSelectionChanged"),null!=e&&6==e.ParentFeatureID&&(this.SelectedType="6"),this.onSelectionChanged(""),Logger.InfoLog("AddCCMapViewModel::Exiting AddCCMapViewModel")}get Title(){return this._ScreenName}set Title(e){e!=this._ScreenName&&(this._ScreenName=e)}onSave(e){if("Cancel"==e.toString())this.ViewModel.CCMapVisibility=!1,"6"==this.SelectedType&&(this.onLocationChanged(null),this.ViewModel.CCMapVisibility=!1),l.a.page.HideDialog();else{this.CntCheck=0;let e=this.ViewModel.ViewCCMapping.DataList.length,t=e-1;if(!this.isFilter)if(null!=this.SelectedType&&"6"!=this.SelectedType&&null!=this.ViewModel.ViewCCMapping.DataList&&null!=this.ViewModel.ViewCCMapping.TempData){for(let s=e;s>0;s--,t--)r.e.IsEmpty(this.ViewModel.ViewCCMapping.DataList[t].CostCenterId)||this.ViewModel.ViewCCMapping.DataList[t].CostCenterId.toString()!=this.SelectedType.toString()||this.ViewModel.ViewCCMapping.DataList.RemoveAt(t);e=this.ViewModel.ViewCCMapping.TempData.length,t=e-1;for(let s=e;s>0;s--,t--)r.e.IsEmpty(this.ViewModel.ViewCCMapping.TempData[t].CostCenterId)||this.ViewModel.ViewCCMapping.TempData[t].CostCenterId.toString()!=this.SelectedType.toString()||this.ViewModel.ViewCCMapping.TempData.RemoveAt(t)}else{for(let s=e;s>0;s--,t--)this.ViewModel.ViewCCMapping.DataList.length>=t&&(r.e.IsEmpty(this.ViewModel.ViewCCMapping.DataList[t].ParentNodeId)||this.ViewModel.ViewCCMapping.DataList[t].ParentNodeId.toString()!=this.LocationSelectedType.toString()||this.ViewModel.ViewCCMapping.DataList.RemoveAt(t),this.ViewModel.ViewCCMapping.DataList.length>t&&(r.e.IsEmpty(this.ViewModel.ViewCCMapping.DataList[t].NodeID)||this.ViewModel.ViewCCMapping.DataList[t].NodeID.toString()!=this.LocationSelectedType.toString()||this.ViewModel.ViewCCMapping.DataList.RemoveAt(t)));e=this.ViewModel.ViewCCMapping.TempData.length,t=e-1;for(let s=e;s>0;s--,t--)this.ViewModel.ViewCCMapping.TempData.length>=t&&(r.e.IsEmpty(this.ViewModel.ViewCCMapping.TempData[t].ParentNodeId)||this.ViewModel.ViewCCMapping.TempData[t].ParentNodeId.toString()!=this.LocationSelectedType.toString()||this.ViewModel.ViewCCMapping.TempData.RemoveAt(t),this.ViewModel.ViewCCMapping.TempData.length>t&&(r.e.IsEmpty(this.ViewModel.ViewCCMapping.TempData[t].NodeID)||this.ViewModel.ViewCCMapping.TempData[t].NodeID.toString()!=this.LocationSelectedType.toString()||this.ViewModel.ViewCCMapping.TempData.RemoveAt(t)))}if(this.BindTbl(),"6"==this.SelectedType&&this.CntCheck>0){let e=this.ViewModel.ViewCCMapping.DataListObj.NewRow();e.CostCenterId="50002",e.CostCenterName="Location",e.NodeID=this.LocationSelectedType,e.Value=this.SelectedItem.Name,this.ViewModel.ViewCCMapping.DataListObj.addRow(e);let t={CostCenterId:"50002",CostCenterName:"Location"};t.NodeID=this.LocationSelectedType,t.Value=this.SelectedItem.Name,this.ViewModel.ViewCCMapping.TempData.push(t)}this.ViewModel.ViewCCMapping.DataListObj.refreshDataView(),this.ViewModel.ViewCCMapping.UpdateSequence()}}AddDataRow(e){this.CntCheck++;let t,s=-1;for(let i=0;i<this.ViewModel.ViewCCMapping.DataListObj.Table.length;i++)if(r.e.IsEmpty(this.ViewModel.ViewCCMapping.DataListObj.Table[i].CostCenterId)){s=i;break}if(t=s>-1?this.ViewModel.ViewCCMapping.DataListObj.Table[s]:this.ViewModel.ViewCCMapping.DataListObj.NewRow(),"6"!=this.SelectedType){t.CostCenterId=this.SelectedType,t.CostCenterName="",t.NodeID=e.FeatureActionID,t.Value=e.Name,this.ViewModel.ViewCCMapping.DataListObj.TableColumns.Contains("Code")&&null!=t&&this.ViewModel.ViewCCMapping.GetCodeInfo(t),-1==s?this.ViewModel.ViewCCMapping.DataListObj.addRow(t):this.ViewModel.ViewCCMapping.DataListObj.updateRow(t);let i={};i.CostCenterId=this.SelectedType,i.CostCenterName="",i.NodeID=e.FeatureActionID,i.Value=e.Name,this.ViewModel.ViewCCMapping.TempDataColumns.Contains("Code")&&null!=t&&this.ViewModel.ViewCCMapping.DataListObj.TableColumns.Contains("Code")&&""!=t.Code.toString()&&(i.Code=t.Code.toString()),this.ViewModel.ViewCCMapping.TempData.push(i)}else{t.ParentNodeId=this.LocationSelectedType,t.CostCenterId="50001",t.CostCenterName="Division",t.NodeID=e.FeatureActionID,t.Value=e.Name,this.ViewModel.ViewCCMapping.DataListObj.TableColumns.Contains("Code")&&null!=t&&this.ViewModel.ViewCCMapping.GetCodeInfo(t),-1==s?this.ViewModel.ViewCCMapping.DataListObj.addRow(t):this.ViewModel.ViewCCMapping.DataListObj.updateRow(t);let i={};i.ParentNodeId=this.LocationSelectedType,i.CostCenterId="50001",i.CostCenterName="Division",i.NodeID=e.FeatureActionID,i.Value=e.Name,r.e.IsEmpty(t.Code)||(i.Code=t.Code.toString()),this.ViewModel.ViewCCMapping.TempData.push(i)}}GetListNodes(e){if(e.IsChecked){let t=!1;if(this.isFilter){if(this.ViewModel.ViewCCMapping.DataList.filter(t=>t.CostCenterID==this.SelectedType&&t.NodeID==e.FeatureActionID).length>0)return;e.AChildren.length>0&&e.AChildren.forEach(e=>{t=!0,this.GetListNodes(e)})}t||this.AddDataRow(e)}else e.AChildren.length>0&&e.AChildren.forEach(e=>{this.GetListNodes(e)})}BindTbl(){null!=this.CheckBoxTreeViewModel&&this.CheckBoxTreeViewModel.AChildren.forEach(e=>{this.GetListNodes(e)})}BindControls(){Logger.InfoLog("AddCCMapViewModel::Entering BindControls");try{this.CostCenter=[];let e={Name:"",FEATUREID:""};this.CostCenter.push(e);let t=l.a.admin.GetTableData(this.ViewModel.ParentFeatureID);null!=t&&t.Tables[0].length>0&&t.Tables.length>0&&(this.CostCenter=t.Tables[0],7==this.ViewModel.ParentFeatureID)&&this.CostCenter.push({FEATUREID:-7,Name:"User_Manager"}),Logger.InfoLog("CustomizeCostCenterViewModel::Leaving BindControls with ColumnName ="+e+",Rows="+e)}catch(e){Logger.ErrorLog("AddCCMapViewModel:: BuildControls"+e.stack)}}onLocationChanged(e){try{if(Logger.InfoLog("AddCCMapViewModel::Entering onLocationChanged Type="+e),null!=this.LocationSelectedType&&"0"!=this.LocationSelectedType){let e=[];e.push(50001),e.push(l.a.SessionManager.LanguageID);let t,s=l.a.admin.getLocationRoles(e),i=[];i.push(50002),i.push(this.LocationSelectedType),i.push(50001),i.push(l.a.SessionManager.UserID),this.dsetMappedNodes=l.a.admin.GetCCCCMap(i),t=null!=s&&s.Tables.length>0?s.Tables[0]:[],null!=t&&s.Tables.length>1&&this.AddRows(t,!1,"Div")}Logger.InfoLog("AddCCMapViewModel::Exiting onLocationChanged Type="+e)}catch(t){Logger.ErrorLog("AddCCMapViewModel:: onLocationChanged"+t.stack)}}DivList(e){let t="";for(let s=0;s<e.length;s++)t+=0==s?e.Rows[s].NodeID.toString():","+e.Rows[s].NodeID.toString();return""==t?"1":t}FieldChanged(e){null!=this.SelectedType&&"0"!=this.SelectedType&&this.onSelectionChanged(this.SelectedType)}onSelectionChanged(e){if(Logger.InfoLog("AddCCMapViewModel::Entering onSelectionChanged Type="+e),null!=this.SelectedType&&"0"!=this.SelectedType){this.CompanyList.Items.Clear();let e,t=[];if("6"!=this.SelectedType){let e=[];e.push("-7"==this.SelectedType?7:this.SelectedType),e.push(l.a.SessionManager.LanguageID),null!=this.SearchText&&null!=this.SearchText.Text&&""!=this.SearchText.Text?(this.isFilter=!0,"7"==this.SelectedType||"-7"==this.SelectedType?e.push(" where username like '%"+this.SearchText.Text+"%' "):this.Fields.Items[0].IsChecked?e.push(" where name like '%"+this.SearchText.Text+"%' or parentid =0 "):this.Fields.Items[1].IsChecked?e.push(" where code like '%"+this.SearchText.Text+"%'  or parentid =0 "):this.Fields.Items[2].IsChecked&&e.push(" where (name like '%"+this.SearchText.Text+"%' or  code like '%"+this.SearchText.Text+"%')  or parentid =0 ")):this.isFilter=!1,t=l.a.admin.getLocationRoles(e);let s=[];s.push(this.ViewModel.ParentFeatureID),s.push(this.ViewModel.PNodeID),s.push("-7"==this.SelectedType?7:parseInt(this.SelectedType)),s.push(l.a.SessionManager.UserID),this.dsetMappedNodes=l.a.admin.GetCCCCMap(s)}if(e=null!=t&&t.Tables.length>0?t.Tables[0]:[],"7"==this.SelectedType||"-7"==this.SelectedType?this.AddRows(t.Tables[0],!1,"Usr"):null!=t&&t.Tables.length>0&&this.AddRows(t.Tables[0],!1,""),"6"==this.SelectedType){let s=[];s.push(50002),s.push(l.a.SessionManager.LanguageID),t=l.a.admin.getLocationRoles(s);let i=[];i.push(this.ViewModel.ParentFeatureID),i.push(this.ViewModel.PNodeID),i.push(parseInt(this.SelectedType)),i.push(l.a.SessionManager.UserID),this.dsetMappedNodes=this.Administration.GetCCCCMap(i),e=t.Tables[0],null!=t&&t.Tables.length>0&&(Logger.InfoLog("AddCCMapViewModel::Entering GetDivisions"),null!=l.a.SessionManager.LocationWhere&&""!=l.a.SessionManager.LocationWhere&&(e.RowFilter=" NodeID  in ("+l.a.SessionManager.LocationWhere+")"),this.BindLocationControl(e))}}}BindLocationControl(e){Logger.InfoLog("AddCCMapViewModel::Entering BindLocationControl");try{this.LocationList=[];let t={Name:"",NodeID:""};this.LocationList.push(t);for(let s=0;s<e.length;s++)t=this.LocationList.NewRow(),t.Name=e[s].Name.toString(),t.NodeID=e[s].NodeID.toString(),this.LocationList.push(t);e.length>0&&(this.SelectedItem=e[0]),Logger.InfoLog("AddCCMapViewModel::Leaving BindControls with ColumnName ="+t)}catch(t){Logger.ErrorLog("AddCCMapViewModel:: BuildControls"+t.stack)}}AddRows(e,t,s){try{this.lstParents=[],Logger.InfoLog("AddCCMapViewModel::Entering AddRows");let t=0,i=0;this.CheckBoxTreeViewModel.AChildren=[];let n,h=!0;for(;t<e.length;t++){if(n=new p,n.FeatureActionID=parseInt(e[t].NodeID),n.id=n.FeatureActionID,n.Name=e[t].Name.toString(),null!=this.Fields&&this.Fields.Items.length>1&&this.Fields.Items[1].IsChecked&&e.some(e=>e.hasOwnProperty("Code"))&&(n.Name=e[t].Code.toString()),null!=this.Fields&&this.Fields.Items.length>2&&this.Fields.Items[2].IsChecked&&e.some(e=>e.hasOwnProperty("Code"))&&(n.Name=e[t].Name.toString()+"~"+e[t].Code.toString()),h=Object(d.j)(e[t].IsGroup),n.Depth=parseInt(e[t].Depth),this.dsetMappedNodes.Tables.length>1&&((this.dsetMappedNodes.Tables[1].filter(e=>e.NodeID==n.FeatureActionID).length>0||1==this.dsetMappedNodes.Tables[1].length&&"1"==this.dsetMappedNodes.Tables[1][0].Nodeid.toString())&&(n._IsChecked=!0),this.dsetMappedNodes.Tables.length>0&&this.dsetMappedNodes.Tables[2].length>0&&this.dsetMappedNodes.Tables[2].forEach(e=>{n.FeatureActionID==parseInt(e.NodeID.toString())&&(n._IsChecked=!0)})),"Loc"==s&&""!=l.a.SessionManager.LocationWhere?(e.RowFilter=" NodeID  in ("+l.a.SessionManager.LocationWhere+")",0==e.length&&(n.IsEnabled=!1)):"Div"==s&&this.dsetMappedNodes.Tables.length>1&&this.dsetMappedNodes.Tables[1].length>0&&(e.RowFilter=" NodeID  in ("+this.DivList(this.dsetMappedNodes.Tables[1])+")",0==e.length&&(n.IsEnabled=!1)),h)if(this.lstParents.length>0){if(n.Depth>this.lstParents[this.lstParents.length-1].Depth)n.Parent=this.lstParents[this.lstParents.length-1],this.lstParents[this.lstParents.length-1].IsChecked&&(n._IsChecked=!0),this.lstParents[this.lstParents.length-1].AChildren.push(n),this.lstParents.push(n);else if(n.Depth==this.lstParents[this.lstParents.length-1].Depth)this.lstParents.RemoveAt(this.lstParents.length-1),this.lstParents.length>0&&(n.Parent=this.lstParents[this.lstParents.length-1],this.lstParents[this.lstParents.length-1].IsChecked&&(n._IsChecked=!0),this.lstParents[this.lstParents.length-1].AChildren.push(n)),this.lstParents.push(n);else if(n.Depth<this.lstParents[this.lstParents.length-1].Depth){for(let e=this.lstParents.length-1;e>=0&&n.Depth<=this.lstParents[e].Depth;e--)this.lstParents.RemoveAt(this.lstParents.length-1);this.lstParents.length>0&&(n.Parent=this.lstParents[this.lstParents.length-1],this.lstParents[this.lstParents.length-1].IsChecked&&(n._IsChecked=!0),this.lstParents[this.lstParents.length-1].AChildren.push(n)),this.lstParents.push(n)}}else 0==i&&r.e.IntTryParse(l.a.SessionManager.RoleID)>1&&""!=s&&"Div"==s?(t=-1,i++,n.IsEnabled=!1,this.lstParents.push(n)):this.lstParents.push(n);else if(this.lstParents.length>0){if(n.Depth>this.lstParents[this.lstParents.length-1].Depth)this.lstParents.length>0&&(n.Parent=this.lstParents[this.lstParents.length-1],this.lstParents[this.lstParents.length-1].IsChecked&&(n._IsChecked=!0),this.lstParents[this.lstParents.length-1].AChildren.push(n));else if(n.Depth==this.lstParents[this.lstParents.length-1].Depth){for(let e=this.lstParents.length-1;e>=0&&n.Depth<=this.lstParents[e].Depth;e--)this.lstParents.RemoveAt(this.lstParents.length-1);this.lstParents.length>0&&(n.Parent=this.lstParents[this.lstParents.length-1],this.lstParents[this.lstParents.length-1].IsChecked&&(n._IsChecked=!0),this.lstParents[this.lstParents.length-1].AChildren.push(n))}else if(n.Depth<this.lstParents[this.lstParents.length-1].Depth){for(let e=this.lstParents.length-1;e>=0&&n.Depth<=this.lstParents[e].Depth;e--)this.lstParents.RemoveAt(this.lstParents.length-1);this.lstParents.length>0&&(n.Parent=this.lstParents[this.lstParents.length-1],this.lstParents[this.lstParents.length-1].IsChecked&&(n._IsChecked=!0),this.lstParents[this.lstParents.length-1].AChildren.push(n))}}else this.lstParents.push(n);if(this.ViewModel.ViewCCMapping.DataList.length>0)for(let s=0;s<this.ViewModel.ViewCCMapping.DataList.length;s++)this.SelectedType.toString()==r.e.StringValue(this.ViewModel.ViewCCMapping.DataList[s].CostCenterID)&&(1==Object(d.j)(e[t].IsGroup)&&this.ViewModel.ViewCCMapping.DataList[s].NodeID.toString()==e[t].NodeID.toString()&&"1"!=e[t].NodeID.toString()?this.lstParents[this.lstParents.length-1]._IsChecked=!0:1!=Object(d.j)(e[t].IsGroup)&&this.ViewModel.ViewCCMapping.DataList[s].NodeID.toString()==e[t].NodeID.toString()&&(n._IsChecked=!0))}this.lstParents.length>0&&this.CheckBoxTreeViewModel.AChildren.push(this.lstParents[0]);for(let e=0;e<this.CheckBoxTreeViewModel.AChildren[0].AChildren.length;e++)this.CallRecursiveCheck(this.CheckBoxTreeViewModel.AChildren[0].AChildren[e]);Logger.InfoLog("AddCCMapViewModel:: Leaving AddRows")}catch(i){Logger.ErrorLog("AddCCMapViewModel:: AddRows"+i.stack)}}CallRecursiveCheck(e){if(e.AChildren.length>0){let t=0;e.AChildren.forEach(e=>{e.AChildren.length>0?(this.CallRecursiveCheck(e),e._IsChecked&&t++):e._IsChecked&&t++}),e._IsChecked=t==e.AChildren.length}}GetDivisions(){}onCanSelectionChanged(e){return!0}}class p{constructor(){this._children=[],this._pchildren=[],this.Parent=null,this._MasterChildren=[],this.IsEnabled=!0,this._IsChecked=!1}get AChildren(){return this._children}get PChildren(){return this._pchildren}get MChildren(){return this._MasterChildren}get IsChecked(){return this._IsChecked}set IsChecked(e){e!=this._IsChecked&&(this._IsChecked=e),l.a.SessionManager.IsWebApplication&&(this.SetChildren(this,e),this.SetParent(this.Parent,e))}SetChildren(e,t){e._children.forEach(e=>{e._IsChecked=t,this.SetChildren(e,t)})}SetParent(e,t){if(null!=e){let s=0;for(s=0;s<e._children.length&&e._children[s].IsChecked==t;s++);1==t?s==e._children.length?(e._IsChecked=t,this.SetParent(e.Parent,t)):e._IsChecked=!t:(e._IsChecked=t,this.SetParent(e.Parent,t))}}OnSelectionChanged(e){}}class g extends o.b{constructor(){super(...arguments),this.AChildren=[],this._Childrens=[]}}}}]);
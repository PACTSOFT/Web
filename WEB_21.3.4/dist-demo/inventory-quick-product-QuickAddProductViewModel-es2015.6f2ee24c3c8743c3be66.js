(window.webpackJsonp=window.webpackJsonp||[]).push([[186],{WEnO:function(e,t,o){"use strict";o.r(t),o.d(t,"QuickAddProductViewModel",(function(){return g}));var i=o("VxiT"),s=o("0/4Q"),r=o("n56n"),a=o("NkMH"),c=o("Do2H"),n=o("eQJW"),l=o("Lp6j"),h=o("ScVY"),u=o("sW9y"),d=o("DLiw"),b=o("MJVe"),m=o("4k0m"),S=o("++IR"),C=o("pcVU"),P=o("4HhE");class g extends h.b{constructor(e,t,o,s,r){super(),this.oProduct=new C.a,this.ImageView=null,this.InheritImage=!1,this.InheritGrpImage=!1,this.InheritDimImageID=-1,this.ScreenObject=new i.a,this.NameSameasCode=!1,this.MessageVisibility=!1,this.RetValue=0,this.DisplayMessage="",this.Height="",this.IsAutoBarCode=!1,this.ParentId=0,this.SelectedNode=0,this.ScreenName="",this.Title="",this.NodeID=0,this.objProduct={},this.GParentID=0,this.LinkColumnCostcenterID=-1,this.DefaultValuation=1,this.FileID=0,this.ProductPhoto="",this.isPhotoChanged=!1,this.ClassName="QuickAddProductViewModel",this.LoadViewModel(e,t,o,s,r)}LoadViewModel(e,t,o,i,s){Logger.InfoLog("QuickAddProductViewModel::Entering QuickAddProductViewModel"),0==t&&(t=1),this.NodeID=e,this.GParentID=i,this.oProduct.ProductID=this.NodeID,this.ParentId=t,this.oProduct.IsGroup=s,this.ScreenObject.LoadQuickScreen(this,3,s),this.OnLoad(),this.FillControls(),this.Title=s?0!=this.NodeID?"Edit Group":"Add Group":c.a.GetResource(0!=this.NodeID?"Product_QuickEdit":"Product_QuickAdd"),this.DisplayName=this.Title;var r=this.ScreenObject.StaticFields.find(e=>26722==e.DBColumnID);s||null==r||null==r||(r.Visible=!1),null!=this.Code&&this.Code.TextChangedCommand.Subscribe(this,"OnTextChanged"),this.SetViewByType(),Logger.InfoLog("QuickAddProductViewModel::BuildControls Success")}SetViewFilter(e,t){return t.filter="",e.forEach(e=>{if("3"==e){if(!(null!=(o=this.ScreenObject.QuickAddFields.find(e=>281==e.DBColumnID))&&null!=o&&o instanceof r.b&&o.SelectedValue>0))return!1;t.filter+=" and GroupID="+o.SelectedValue}else if(!l.e.IsEmpty(e)&&parseInt(e)>5e4){var o;if(!(null!=(o=this.ScreenObject.QuickAddFields.find(t=>t instanceof r.b&&t.CCID==parseInt(e)))&&null!=o&&o instanceof r.b&&o.SelectedValue>0))return!1;t.filter+=" and DcCCNID"+(parseInt(e)-5e4)+"="+o.SelectedValue}}),!0}SetViewByType(){let e,t=null,o="",i=this.ScreenObject.Data.Tables[10].filter(e=>"PrDimWiseFields"==e.Name),s=null;if(i.length>0&&""!=i[0].Value.toString()&&(s=i[0].Value.toString().split(";")),null!=s){let e={filter:o};this.SetViewFilter(s,e)||(o=e.filter),o=e.filter,s.forEach(e=>{if("3"==e)t=this.ScreenObject.QuickAddFields.find(e=>281==e.DBColumnID),null!=t&&null!=t&&t instanceof r.b&&(t.Enable=!1);else if(!l.e.IsEmpty(e)&&parseInt(e)>5e4){var o=this.ScreenObject.QuickAddFields.find(t=>t instanceof r.b&&t.CCID==parseInt(e));null!=o&&null!=o&&o instanceof r.b&&(o.Enable=!1)}})}l.e.IsEmpty(o)||(this.ScreenObject.Data.Tables[18].filter(e=>0==e.IsTab).forEach(o=>{t=this.ScreenObject.QuickAddFields.find(e=>e instanceof P.c&&e.DBColumnID==parseInt(o.CostCenterColID)),null!=t&&null!=t&&(e=parseInt(o.Hide),1!=e&&2!=e||(t.Visible=!1),e=parseInt(o.Mandatory),1!=e&&2!=e||(t.Mandatory=!0))}),this.SetFieldPOsition())}SetFieldPOsition(){let e=this.ScreenObject.QuickAddFields.filter(e=>!l.e.IsEmpty(e.Row));e.sort((e,t)=>e.Row-t.Row);let t=0;for(let o=0;o<e.length;o++){let i=e.ElementAt(o);i.Visible&&(i.Row=t++)}}OnLoad(){if(this.ButtonSave=new a.a,0==this.NodeID?c.a.SessionManager.HideUnathorizedAccess?this.ButtonSave.Visible=c.a.SessionManager.IsActionAssigned(3,"Create"):this.ButtonSave.Enable=c.a.SessionManager.IsActionAssigned(3,"Create"):(this.ScreenObject.IsEdit=!0,c.a.SessionManager.HideUnathorizedAccess?this.ButtonSave.Visible=c.a.SessionManager.IsActionAssigned(3,"Update"):this.ButtonSave.Enable=c.a.SessionManager.IsActionAssigned(3,"Update")),this.QuickAssign=new u.a,this.QuickAssign.QuickAssignGrid_1(2,this.ScreenObject.Data,this.oProduct.IsGroup),this.Code=this.ScreenObject.GetQuickCode(261),this.Name=this.ScreenObject.GetQuickText(262),this.BarCode=this.ScreenObject.GetQuickText(280),this.ProductLength=this.ScreenObject.GetQuickText(601),null!=this.ProductLength){this.ProductLength.TextChangedCommand.Subscribe(this,"onTextValueChanged");let e=0;e=l.e.IntTryParse(this.ScreenObject.Data.Tables[10].filter(e=>"LengthDecimals"==e.Name)[0].Value.toString()),this.ProductLength.DecimalPoints=e.toString(),this.ProductLength.LostFocusCommand.Subscribe(this,"onLostFocus")}if(this.ProductWidth=this.ScreenObject.GetQuickText(602),null!=this.ProductWidth){this.ProductWidth.TextChangedCommand.Subscribe(this,"onTextValueChanged");let e=0;e=l.e.IntTryParse(this.ScreenObject.Data.Tables[10].filter(e=>"WidthDecimals"==e.Name)[0].Value.toString()),this.ProductWidth.DecimalPoints=e.toString(),this.ProductWidth.LostFocusCommand.Subscribe(this,"onLostFocus")}if(this.ProductHeight=this.ScreenObject.GetQuickText(603),null!=this.ProductHeight){this.ProductHeight.TextChangedCommand.Subscribe(this,"onTextValueChanged");let e=0;e=l.e.IntTryParse(this.ScreenObject.Data.Tables[10].filter(e=>"HeightDecimals"==e.Name)[0].Value.toString()),this.ProductHeight.DecimalPoints=e.toString(),this.ProductHeight.LostFocusCommand.Subscribe(this,"onLostFocus")}if(this.ProductVolume=this.ScreenObject.GetQuickText(604),null!=this.ProductVolume){let e=0;e=l.e.IntTryParse(this.ScreenObject.Data.Tables[10].filter(e=>"VolumeDecimals"==e.Name)[0].Value.toString()),this.ProductVolume.DecimalPoints=e.toString(),this.ProductVolume.LostFocusCommand.Subscribe(this,"onLostFocus")}if(this.ProductWeight=this.ScreenObject.GetQuickText(605),null!=this.ProductWeight){let e=0;e=l.e.IntTryParse(this.ScreenObject.Data.Tables[10].filter(e=>"VolumeDecimals"==e.Name)[0].Value.toString()),this.ProductWeight.DecimalPoints=e.toString(),this.ProductWeight.LostFocusCommand.Subscribe(this,"onLostFocus")}if(this.ProductWastage=this.ScreenObject.GetQuickText(584),null!=this.ProductWastage){let e=0;e=l.e.IntTryParse(this.ScreenObject.Data.Tables[10].filter(e=>"VolumeDecimals"==e.Name)[0].Value.toString()),this.ProductWastage.DecimalPoints=e.toString(),this.ProductWastage.LostFocusCommand.Subscribe(this,"onLostFocus")}let e;null!=this.Name&&this.Name.LostFocusCommand.Subscribe(this,"OnNameLostFocus"),this.oCombo=this.ScreenObject.GetQuickCombo(266),null!=this.oCombo&&(this.ScreenObject.Data.Tables[3].forEach(e=>{this.oCombo.Items.push(s.d.ComboBoxItems_2(e[Object.keys(e)[1]].toString(),e[Object.keys(e)[0]].toString()))}),this.ScreenObject.Data.Tables[3].length>0&&(l.e.StringIsNullOrEmpty(this.oCombo.SelectedValue)||parseInt(this.oCombo.SelectedValue)<=1||0==this.ScreenObject.Data.Tables[3].filter(e=>e.StatusID==this.oCombo.SelectedValue).length)&&(this.oCombo.SelectedValue=this.ScreenObject.Data.Tables[3][0][Object.keys(this.ScreenObject.Data.Tables[3][0])[0]].toString())),this.oCombo=this.ScreenObject.GetQuickCombo(264),null!=this.oCombo&&(this.ScreenObject.Data.Tables[4].forEach(e=>{"2"==e[Object.keys(e)[0]].toString()&&!Object(n.j)(c.a.SessionManager.Preferences.EnableSerialProducts.toString())||"5"==e[Object.keys(e)[0]].toString()&&!Object(n.j)(c.a.SessionManager.Preferences.EnableBatchProducts.toString())||!("8"!=e[Object.keys(e)[0]].toString()&&"3"!=e[Object.keys(e)[0]].toString()||Object(n.j)(c.a.SessionManager.Preferences.EnableDynamicProducts.toString()))||this.oCombo.Items.push(s.d.ComboBoxItems_2(e[Object.keys(e)[1]].toString(),e[Object.keys(e)[0]].toString()))}),this.ProductType=this.oCombo,this.ProductType.SelectionChangedCommand.Subscribe(this,"OnProductTypeChange")),this.ProductGroup=this.ScreenObject.GetQuickField(281),null!=this.ProductGroup&&(0!=this.ParentId&&0==this.NodeID?(this.ProductGroup.SelectedValue=this.ParentId,this.ProductGroup.DefaultValue=this.ProductGroup.SelectedValue.toString()):(this.ProductGroup.SelectedValue=this.GParentID,this.ProductGroup.DefaultValue=this.ProductGroup.SelectedValue.toString()),this.ProductGroup.SelectionChangedCommand.Subscribe(this,"OnGroupSelectionChanged"),this.ProductGroup.Enable=0==this.NodeID);let t=this.ScreenObject.Data.Tables[10];if(e=t,t=t.filter(e=>"DefaultProductValuation"==e.Name),null!=t&&t.length>0){let e=this.ScreenObject.Data.Tables[6].filter(e=>e.ValuationMethod==t[0][Object.keys(t[0])[1]].toString());null!=e&&e.length>0&&(this.DefaultValuation=parseInt(e[0].ValuationID))}t=e,t=t.filter(e=>"AutoBarcode"==e.Name),null!=t&&t.length>0&&Object(n.j)(t[0].Value)?(this.IsAutoBarCode=!0,null!=this.BarCode&&(this.BarCode.Enable=!1)):this.IsAutoBarCode=!1;let o=this.ScreenObject.Data.Tables[10].filter(e=>"DefaultImage"==e.Name);if(null!=o&&o.length>0&&(this.InheritImage=Object(n.j)(o[0].Value)),o=this.ScreenObject.Data.Tables[10].filter(e=>"InheritGroupImage"==e.Name),null!=o&&o.length>0&&(this.InheritGrpImage=Object(n.j)(o[0].Value)),o=this.ScreenObject.Data.Tables[10].filter(e=>"InheritDimensionImage"==e.Name),null!=o&&o.length>0&&(this.InheritDimImageID=""!=o[0].Value.toString()?parseInt(o[0].Value):-1),null!=this.ScreenObject.Data&&null!=this.ScreenObject.Data&&this.ScreenObject.Data.Tables.length>14&&(this.ImageView=this.ScreenObject.Data.Tables[14]),this.oCombo=this.ScreenObject.GetQuickCombo(265),null!=this.oCombo&&(this.ScreenObject.Data.Tables[6].forEach(e=>{this.oCombo.Items.push(s.d.ComboBoxItems_2(e[Object.keys(e)[1]].toString(),e[Object.keys(e)[0]].toString()))}),this.oCombo.SelectedValue=this.DefaultValuation.toString()),this.oCombo=this.ScreenObject.GetQuickCombo(269),null!=this.oCombo&&this.ScreenObject.Data.Tables[7].forEach(e=>{this.oCombo.Items.push(s.d.ComboBoxItems_2(e[Object.keys(e)[1]].toString(),e[Object.keys(e)[0]].toString()))}),this.oCombo=this.ScreenObject.GetQuickCombo(50392),null!=this.oCombo&&(this.oCombo.Items.push(s.d.ComboBoxItems_2("Yes","1")),this.oCombo.Items.push(s.d.ComboBoxItems_2("No","0")),this.oCombo.SelectedValue=this.oCombo.DefaultValue),this.oCombo=this.ScreenObject.GetQuickCombo(275),null!=this.oCombo&&(this.oCombo.Items.push(s.d.ComboBoxItems_2("Yes","1")),this.oCombo.Items.push(s.d.ComboBoxItems_2("No","0")),this.oCombo.SelectedValue="0"),this.oCombo=this.ScreenObject.GetQuickCombo(600),null!=this.oCombo&&(this.oCombo.Items.push(s.d.ComboBoxItems_2("No","0")),this.oCombo.Items.push(s.d.ComboBoxItems_2("Yes","1")),this.oCombo.SelectedValue=c.a.SessionManager.Preferences.ContainsKey("PackDimension")&&""!=c.a.SessionManager.Preferences.PackDimension&&parseInt(c.a.SessionManager.Preferences.PackDimension)>0?"1":"0"),this.oCombo=this.ScreenObject.GetQuickCombo(587),null!=this.oCombo&&(this.oCombo.Items.push(s.d.ComboBoxItems_2("No","0")),this.oCombo.Items.push(s.d.ComboBoxItems_2("Yes","1")),this.oCombo.Items.push(s.d.ComboBoxItems_2("FIFO","2")),this.oCombo.SelectedValue="0"),this.oCombo=this.ScreenObject.GetQuickCombo(588),null!=this.oCombo&&(this.oCombo.Items.push(s.d.ComboBoxItems_2("None","0")),this.oCombo.Items.push(s.d.ComboBoxItems_2("Order","1")),this.oCombo.Items.push(s.d.ComboBoxItems_2("Max.Level","2")),this.oCombo.Items.push(s.d.ComboBoxItems_2("Reorder","3")),this.oCombo.SelectedValue="0"),this.oCombo=this.ScreenObject.GetQuickCombo(593),null!=this.oCombo&&(this.oCombo.Items.push(s.d.ComboBoxItems_2("None","0")),this.oCombo.Items.push(s.d.ComboBoxItems_2("MRP","1")),this.oCombo.SelectedValue="0"),this.oCombo=this.ScreenObject.GetQuickCombo(594),null!=this.oCombo&&(this.oCombo.Items.push(s.d.ComboBoxItems_2("Purchased","0")),this.oCombo.Items.push(s.d.ComboBoxItems_2("Produced","1")),this.oCombo.SelectedValue="0"),this.oCombo=this.ScreenObject.GetQuickCombo(585),null!=this.oCombo){if(this.ScreenObject.Data.Tables.length>17&&this.ScreenObject.Data.Tables[17].length>0){let e=this.ScreenObject.Data.Tables[17];if(e=e.filter(e=>0==e.RuleType),null!=e&&null!=e&&e.length>0)for(let t=0;t<e.length;t++)this.oCombo.Items.push(s.d.ComboBoxItems_2(e[t].ProfileName.toString(),e[t].ProfileID.toString()))}this.oCombo.SelectedValue=""}if(this.oCombo=this.ScreenObject.GetQuickCombo(586),null!=this.oCombo){if(this.ScreenObject.Data.Tables.length>17&&this.ScreenObject.Data.Tables[17].length>0){let e=this.ScreenObject.Data.Tables[17];if(e=e.filter(e=>0==e.RuleType),null!=e&&null!=e&&e.length>0)for(let t=0;t<e.length;t++)this.oCombo.Items.push(s.d.ComboBoxItems_2(e[t].ProfileName.toString(),e[t].ProfileID.toString()))}this.oCombo.SelectedValue=""}this.oCombo=this.ScreenObject.GetQuickCombo(274),null!=this.oCombo&&(this.oCombo.Items.push(s.d.ComboBoxItems_2("Not Applicable","3")),this.oCombo.Items.push(s.d.ComboBoxItems_2("Optional","2")),this.oCombo.Items.push(s.d.ComboBoxItems_2("Mandatory","1")),this.oCombo.SelectedValue="3"),this.ReorderQty=this.ScreenObject.GetQuickTextBoxWithCombo(277),null!=this.ReorderQty&&(this.ReorderQty.Items.push(s.d.ComboBoxItems_2("Value","0")),this.ReorderQty.Items.push(s.d.ComboBoxItems_2("Percentage","1")),this.ReorderQty.SelectedValue="0"),this.ReorderTrigger=this.ScreenObject.GetQuickTextBoxWithCombo(11496),null!=this.ReorderTrigger&&(this.ReorderTrigger.Items.push(s.d.ComboBoxItems_2("Value","0")),this.ReorderTrigger.Items.push(s.d.ComboBoxItems_2("Percentage","1")),this.ReorderTrigger.SelectedValue="0"),this.UOM=this.ScreenObject.GetQuickUom(268),null!=this.UOM&&(this.ScreenObject.Data.Tables[13].forEach(e=>{this.UOM.Items.push(s.d.ComboBoxItems_2(e.UnitName.toString(),e.UOMID.toString()))}),this.UOM.Items.push(s.d.ComboBoxItems_2("Product-Wise","-399")),this.UOM.SelectedValue=this.UOM.DefaultValue),null!=this.ScreenObject.Data&&this.ScreenObject.Data.Tables.length>15&&this.ScreenObject.Data.Columns[15].Contains("IsParentCodeInherited")&&this.ScreenObject.Data.Tables[15].length>0&&this.ScreenObject.InitAutoCode(this.ScreenObject.Data.Tables[15],this.oProduct.IsGroup);let i=this.ScreenObject.Data.Tables[10].filter(e=>e.Name==(this.oProduct.IsGroup?"GroupNameSameasCode":"NameSameasCode"));null!=i&&i.length>0&&Object(n.j)(i[0].Value)?(this.NameSameasCode=!0,null!=this.Name&&(this.Name.Enable=!1)):(this.NameSameasCode=!1,null!=this.Name&&(this.Name.Enable=!0))}LoadUnitsProductWise(e){}AutoGenerateCode(){let e=this.ScreenObject.Data.Tables[10].filter(e=>"CodeCapsLock"==e.Name);if(null!=this.Code&&(e.length>0&&Object(n.j)(e[0].Value)&&(this.Code.IsAllCaps=!0),e=this.ScreenObject.Data.Tables[10].filter(e=>"CodeCapsToFirstLetter"==e.Name),null!=this.Code&&e.length>0&&Object(n.j)(e[0].Value)&&(this.Code.IsFirstLetterCaps=!0),e=this.ScreenObject.Data.Tables[10].filter(e=>"CodeIgnoreSpaces"==e.Name),e.length>0&&Object(n.j)(e[0].Value)&&(this.Code.IgnoreSpaces=!0)),e=this.ScreenObject.Data.Tables[10].filter(e=>e.Name==(this.oProduct.IsGroup?"GroupNameSameasCode":"NameSameasCode")),e.length>0&&Object(n.j)(e[0].Value)?(this.NameSameasCode=!0,null!=this.Name&&(this.Name.Enable=!1)):(this.NameSameasCode=!1,null!=this.Name&&(this.Name.Enable=!0)),0==this.NodeID&&null!=this.BarCode&&this.IsAutoBarCode&&(this.BarCode.Text=this.oProduct.GetAutoBarcode()),0==this.NodeID&&null!=this.Code?(null!=this.ProductGroup&&null!=this.ProductGroup.SelectedValue&&(this.ParentId=this.ProductGroup.SelectedValue),this.ScreenObject.SetAutoCode(this.Code,this.oProduct.IsGroup,this.ParentId,this.ScreenObject.Data.Tables[15]),this.OnTextChanged("")):this.ScreenObject.GetCodeParams(this.ScreenObject.Data.Tables[15]),null!=this.Name){let e=this.ScreenObject.Data.Tables[10].filter(e=>"CapsLock"==e.Name);if(e.length>0&&Object(n.j)(e[0].Value)&&(this.Name.IsAllCaps=!0),e=this.ScreenObject.Data.Tables[10].filter(e=>"CapsToFirstLetter"==e.Name),e.length>0&&Object(n.j)(e[0].Value)&&(this.Name.IsFirstLetterCaps=!0),e=this.ScreenObject.Data.Tables[10].filter(e=>"IgnoreSpaces"==e.Name),e.length>0&&Object(n.j)(e[0].Value)&&(this.Name.IgnoreSpaces=!0),null!=this.ScreenObject.Data.Tables[10]){if(e=this.ScreenObject.Data.Tables[10].filter(e=>"ProductName"==e.Name),e.length>0&&""!=e[0].Value.toString()&&(this.LinkColumnCostcenterID=parseInt(e[0].Value),this.ScreenObject.LinkColumnCostcenterID=this.LinkColumnCostcenterID,this.LinkColumnCostcenterID>0)){if(null!=this.ScreenObject.Data.Tables[12]&&this.ScreenObject.Data.Tables[12].length>0){let e=this.ScreenObject.Data.Tables[12].filter(e=>e.FeatureID==this.LinkColumnCostcenterID);e.length>0&&!l.e.StringIsNullOrEmpty(e[0].NAME)&&0==this.NodeID&&(this.Name.Text=e[0].NAME.toString())}this.Name.Enable=!1}-1!=this.LinkColumnCostcenterID&&0!=this.LinkColumnCostcenterID||(e=this.ScreenObject.Data.Tables[10].filter(e=>e.Name==(this.oProduct.IsGroup?"GroupNameSameasCode":"NameSameasCode")),e.length>0&&Object(n.j)(e[0].Value)?this.Name.Enable=!1:this.ScreenObject.IsAutoName?(this.ScreenObject.IsNameAutoGenerate=!0,this.Name.Enable=!1):(this.ScreenObject.IsNameAutoGenerate=!1,this.Name.Enable=!0))}}let t=this.ScreenObject.GetQuickCombo(264);if(null!=t&&0==this.NodeID){let e=this.ScreenObject.Data.Tables[10].filter(e=>"DefaultProductType"==e.Name);e.length>0&&""!=e[0].Value.toString()&&(t.SelectedValue=e[0].Value.toString())}if(null!=this.UOM&&null!=this.UOM&&null!=this.ScreenObject.Data.Tables[10]&&0==this.NodeID){let e=this.ScreenObject.Data.Tables[10].filter(e=>"DefaultUOM"==e.Name);e.length>0&&""!=e[0].Value.toString()&&(this.UOM.SelectedValue=e[0].Value.toString())}}OnTextChanged(e){null!=this.Name&&null!=this.Name&&(!this.NameSameasCode||this.Code.PrefixVisibility||this.Code.SuffixVisibility?this.NameSameasCode&&this.Code.PrefixVisibility&&this.Code.SuffixVisibility&&this.Code.Enable?this.Name.Text=this.Code.PrefixCode+this.Code.SuffixCode:this.NameSameasCode&&this.Code.PrefixVisibility&&!this.Code.SuffixVisibility?this.Name.Text=this.Code.PrefixCode+this.Code.Text:this.NameSameasCode&&!this.Code.PrefixVisibility&&this.Code.SuffixVisibility&&(this.Name.Text=this.Code.Text+this.Code.SuffixCode):this.Name.Text=this.Code.Text)}onTextValueChanged(e){let t=0,o=0,i=0;t=l.e.DoubleTryParse(this.ProductLength.Text),o=l.e.DoubleTryParse(this.ProductWidth.Text),i=l.e.DoubleTryParse(this.ProductHeight.Text),this.ProductVolume.Text=(t*o*i).ToString("N"+this.ProductVolume.DecimalPoints)}onLostFocus(e){let t=0;t=l.e.DoubleTryParse(e.Text),t&&(e.Text=t.ToString("N"+e.DecimalPoints)),this.ScreenObject.onTextBoxLostFocus(e)}FillControls(){if(0!=this.NodeID){this.oProduct.ProductID=this.NodeID;let e=this.oProduct.GetProductDetails();this.QuickAssign.LoadGrid(this.NodeID,e.Tables[11]),null!=this.Code&&(this.Code.Text=this.oProduct.ProductCode,this.Code.Code=this.oProduct.ProductCode,(this.ScreenObject.InheritParentCode||this.ScreenObject.IsAutoCode)&&(this.Code.Enable=parseInt(e.Tables[0][0].Depth)<=1&&!this.ScreenObject.IsRootAutoCode));let t=this.ScreenObject.GetQuickField(281);null!=t&&(t.SelectedValue=this.oProduct.ProductGroup),this.ScreenObject.FillControls(e.Tables[0][0],e.Tables[1][0],e.Tables[7].length>0?e.Tables[7][0]:null,null,e.Tables[19],e.Tables[4]),e.Tables[7].length>0&&this.ScreenObject.LoadCustomFieldsCCData(e.Tables[7],e.Tables[19]),this.ScreenObject.CanApprove(e.Tables[0][0],e.Tables[16][0],this.ButtonSave),null!=this.ScreenObject.StatusAssignGrid&&this.ScreenObject.StatusAssignGrid.Load(e.Tables[20]),this.AddCCFieldsSelectionChange(),this.AutoGenerateCode(),e.Tables.length>13&&null!=this.UOM&&e.Tables[13].length>0&&(this.UOM.SelectedValue="-399",this.UOM.DefaultValue=e.Tables[0][0].UOMID.toString());let o=e.Tables[4].filter(e=>1==e.IsProductImage);o.length>0?this.FileID=parseInt(o[0].FileID):this.InheritImage?this.FileID=0:(this.FileID=0,this.InheritGrpImage?this.OnLoadImage("Group",this.ProductGroup.SelectedValue):this.OnLoadImage("Dimension",this.GetImageCCVal())),c.a.SessionManager.IsOffline&&this.NodeID>0&&(this.ButtonSave.Visible=!1)}else this.AutoGenerateCode(),this.LoadParentData(),this.oProduct.GUID="";this.OnProductTypeChange(null)}OnLoadImage(e,t){"Group"!=e&&"Dimension"!=e||this.InheritImage||(null!=this.ScreenObject.Data&&null!=this.ScreenObject.Data&&this.ScreenObject.Data.Tables.length>14&&(this.ImageView=this.ScreenObject.Data.Tables[14]),this.InheritGrpImage?this.ImageView=this.ImageView.filter(e=>3==e.FeatureID&&e.FeaturePK==t&&1==e.IsProductImage):this.InheritDimImageID>5e4&&(this.ImageView=this.ImageView.filter(e=>e.FeatureID==this.InheritDimImageID&&e.FeaturePK==t&&1==e.IsProductImage)),this.ImageView.length>0&&(this.isPhotoChanged=!0))}onSaveProduct(e){Logger.InfoLog("QuickAddProductViewModel::Entering onSaveProduct");try{if("Save"==e.toString()||"APPROVE_CALL"==e.toString()){if(0==this.oProduct.ProductID){if(null!=this.Code){let e;e=this.ScreenObject.Data.Tables[15],e=e.filter(e=>0==e.IsName);let t={StrCode:this.oProduct.ProductCode,CodePrefix:this.oProduct.CodePrefix,CodeNumber:this.oProduct.CodeNumber};if(this.DisplayMessage=this.ScreenObject.SetAutoCodeParams_3(this.Code,this.ParentId,e,t),this.oProduct.ProductCode=t.StrCode,this.oProduct.CodePrefix=t.CodePrefix,this.oProduct.CodeNumber=t.CodeNumber,this.OnTextChanged(""),this.DisplayMessage.length>0)return}}else if(this.oProduct.ProductID>0&&null!=this.Code){if(this.Code.Enable||this.ScreenObject.CodeSeqExist)null!=this.Code&&(this.oProduct.ProductCode=this.Code.Text);else{let e;e=this.ScreenObject.Data.Tables[15],e=e.filter(e=>0==e.IsName);let t={StrCode:this.oProduct.ProductCode,CodePrefix:this.oProduct.CodePrefix,CodeNumber:this.oProduct.CodeNumber};if(this.DisplayMessage=this.ScreenObject.SetAutoCodeParams_3(this.Code,this.ParentId,e,t),this.oProduct.ProductCode=t.StrCode,this.oProduct.CodePrefix=t.CodePrefix,this.oProduct.CodeNumber=t.CodeNumber,this.OnTextChanged(""),this.DisplayMessage.length>0)return}this.Code.Code=this.Code.Text}if(this.oProduct.ProductName=this.ScreenObject.GetTextComboValue_string(262,"").trim(),null!=this.Name&&this.ScreenObject.IsNameAutoGenerate){let e;e=this.ScreenObject.Data.Tables[15],e=e.filter(e=>1==e.IsName),this.ScreenObject.IsName=!0,null!=e&&e.length>0&&(this.Name.Text=this.ScreenObject.SetAutoCodeParams_1(this.Name,this.ParentId,e),this.oProduct.ProductName=this.Name.Text.trim())}let e=this.ScreenObject.ValidateData();if(e.length>0)return this.MessageVisibility=!0,void(this.DisplayMessage=e);if(0==this.oProduct.ProductID){this.oProduct.AliasName=this.ScreenObject.GetTextComboValue_string(263,this.oProduct.ProductName),this.oProduct.ProductType=this.ScreenObject.GetTextComboValue_int(264,1,"ProductTypeID"),this.oProduct.UOM=this.ScreenObject.GetTextComboValue_int(268,1,"UOMID"),this.oProduct.ProductStatus=this.ScreenObject.GetTextComboValue_int(266,31,"StatusID"),this.oProduct.Valuation=this.ScreenObject.GetTextComboValue_int(265,this.DefaultValuation,"ValuationID"),this.oProduct.ProductGroup=this.ScreenObject.GetPactListValue(281,this.ParentId),this.oProduct.Currency=this.ScreenObject.GetTextComboValue_int(269,1,"CurrencyID");let e=1;null!=this.ScreenObject.dsParentData&&this.ScreenObject.dsParentData.Tables.length>0&&!l.e.StringIsNullOrEmpty(this.ScreenObject.dsParentData.Tables[0][0].ManufacturerBarcode)&&(e=Object(n.j)(this.ScreenObject.dsParentData.Tables[0][0].ManufacturerBarcode)?1:0);let o=!1,i=this.ScreenObject.GetTextComboValue_int(50392,e);if(null!=i&&1===i&&(o=!0),this.oProduct.ManufacturerBarcode=o,this.oProduct.SalesAccount=this.ScreenObject.GetPactListValue(270,3,"SalesAccountID"),this.oProduct.PurchaseAccount=this.ScreenObject.GetPactListValue(271,2,"PurchaseAccountID"),this.oProduct.COGSAccount=this.ScreenObject.GetPactListValue(272,4,"COGSAccountID"),this.oProduct.ClosingStockAccount=this.ScreenObject.GetPactListValue(273,5,"ClosingStockAccountID"),this.oProduct.QtyAdjustment=this.ScreenObject.GetTextComboValue_int(274,3,"QtyAdjustType"),l.e.StringIsNullOrEmpty(this.ScreenObject.Data.Tables[10].filter(e=>"BinsDimension"==e.Name)[0].Value))this.oProduct.BinWise=!1;else{e=0,null!=this.ScreenObject.dsParentData&&null!=this.ScreenObject.dsParentData&&this.ScreenObject.dsParentData.Tables.length>0&&!l.e.StringIsNullOrEmpty(this.ScreenObject.dsParentData.Tables[0][0].BinWise)&&(e=Object(n.j)(this.ScreenObject.dsParentData.Tables[0][0].BinWise)?1:0);let t=!1,o=this.ScreenObject.GetTextComboValue_int(275,0,"BinWise");null!=o&&1===o&&(t=!0),this.oProduct.BinWise=t}this.oProduct.PurchaseRates=this.ScreenObject.GetTextComboValue_double(22820,0,"PurchaseRate"),this.oProduct.PurchaseRateA=this.ScreenObject.GetTextComboValue_double(22786,0,"PurchaseRateA"),this.oProduct.PurchaseRateB=this.ScreenObject.GetTextComboValue_double(22787,0,"PurchaseRateB"),this.oProduct.PurchaseRateC=this.ScreenObject.GetTextComboValue_double(22788,0,"PurchaseRateC"),this.oProduct.PurchaseRateD=this.ScreenObject.GetTextComboValue_double(22789,0,"PurchaseRateD"),this.oProduct.PurchaseRateE=this.ScreenObject.GetTextComboValue_double(22790,0,"PurchaseRateE"),this.oProduct.PurchaseRateF=this.ScreenObject.GetTextComboValue_double(22791,0,"PurchaseRateF"),this.oProduct.PurchaseRateG=this.ScreenObject.GetTextComboValue_double(22792,0,"PurchaseRateG"),this.oProduct.SellingRates=this.ScreenObject.GetTextComboValue_double(22821,0,"SellingRate"),this.oProduct.SellingRateA=this.ScreenObject.GetTextComboValue_double(22793,0,"SellingRateA"),this.oProduct.SellingRateB=this.ScreenObject.GetTextComboValue_double(22794,0,"SellingRateB"),this.oProduct.SellingRateC=this.ScreenObject.GetTextComboValue_double(22795,0,"SellingRateC"),this.oProduct.SellingRateD=this.ScreenObject.GetTextComboValue_double(22796,0,"SellingRateD"),this.oProduct.SellingRateE=this.ScreenObject.GetTextComboValue_double(22797,0,"SellingRateE"),this.oProduct.SellingRateF=this.ScreenObject.GetTextComboValue_double(22798,0,"SellingRateF"),this.oProduct.SellingRateG=this.ScreenObject.GetTextComboValue_double(22799,0,"SellingRateG"),this.oProduct.ProductLength=this.ScreenObject.GetTextComboValue_double(601,0,"Length"),this.oProduct.ProductWidth=this.ScreenObject.GetTextComboValue_double(602,0,"Width"),this.oProduct.ProductHeight=this.ScreenObject.GetTextComboValue_double(603,0,"Height"),this.oProduct.ProductVolume=this.ScreenObject.GetTextComboValue_double(604,0,"Volume"),this.oProduct.ProductWeight=this.ScreenObject.GetTextComboValue_double(605,0,"Weight"),this.oProduct.ProductWastage=this.ScreenObject.GetTextComboValue_double(584,0,"Wastage"),this.oProduct.ProductPacking=this.ScreenObject.GetTextComboValue_int(600,0,"IsPacking"),this.oProduct.ProductBillOfEntry=this.ScreenObject.GetTextComboValue_int(587,0,"IsBillOfEntry"),this.oProduct.ReorderPolicy=this.ScreenObject.GetTextComboValue_int(588,0,"ReorderPolicy"),this.oProduct.MaxInventoryLevel=this.ScreenObject.GetTextComboValue_double(589,0,"MaxInventoryLevel"),this.oProduct.ReorderMinOrderQty=this.ScreenObject.GetTextComboValue_double(590,0,"ReorderMinOrderQty"),this.oProduct.ReorderMaxOrderQty=this.ScreenObject.GetTextComboValue_double(591,0,"ReorderMaxOrderQty"),this.oProduct.ReorderOrderMultiple=this.ScreenObject.GetTextComboValue_double(592,0,"ReorderOrderMultiple"),this.oProduct.PlanningMethod=this.ScreenObject.GetTextComboValue_int(593,0,"PlanningMethod"),this.oProduct.ProcurementMethod=this.ScreenObject.GetTextComboValue_int(594,0,"ProcurementMethod"),this.oProduct.LeadTime=this.ScreenObject.GetTextComboValue_double(597,0,"LeadTime"),this.oProduct.SafetyStock=this.ScreenObject.GetTextComboValue_double(598,0,"SafetyStock"),this.oProduct.ProductBOM=this.ScreenObject.GetPactListValue(599,0,"BOM"),this.oProduct.ReorderLevel=this.ScreenObject.GetTextComboValue_double(276,0,"ReorderLevel"),null!=this.ReorderQty&&null!=this.ReorderQty&&(this.oProduct.ReorderQty=l.e.DoubleTryParse(this.ReorderQty.Text),this.oProduct.ReorderQtyType=l.e.IntTryParse(this.ReorderQty.SelectedValue)),null!=this.ReorderTrigger&&null!=this.ReorderTrigger&&(this.oProduct.ReorderTrigger=l.e.DoubleTryParse(this.ReorderTrigger.Text),this.oProduct.ReorderTriggerType=l.e.IntTryParse(this.ReorderTrigger.SelectedValue)),this.oProduct.ShelfLife=this.ScreenObject.GetTextComboValue_double(278,0,"ShelfLife"),this.oProduct.Packing=this.ScreenObject.GetTextComboValue_string(279,"0","Packing"),this.oProduct.Barcode=this.ScreenObject.GetTextComboValue_string(280,""),this.oProduct.Category=this.ScreenObject.GetPactListValue(284,0,"CategoryID"),this.oProduct.Department=this.ScreenObject.GetPactListValue(285,0,"DepartmentID"),this.oProduct.Description=this.ScreenObject.GetTextComboValue_string(282,"","Description"),this.oProduct.ProductPacking=this.ScreenObject.GetTextComboValue_int(581,0,"IsWeightable"),this.oProduct.SerialNumber=this.ScreenObject.GetTextComboValue_string(582,"","SerialNumber"),this.oProduct.KitSize=this.ScreenObject.GetTextComboValue_double(583,0,"KitSize"),this.oProduct.MinTolerancePer=this.ScreenObject.GetTextComboValue_double(53726,0,"MinTolerancePer"),this.oProduct.MinToleranceVal=this.ScreenObject.GetTextComboValue_double(53727,0,"MinToleranceVal"),this.oProduct.MaxTolerancePer=this.ScreenObject.GetTextComboValue_double(53586,0,"MaxTolerancePer"),this.oProduct.MaxToleranceVal=this.ScreenObject.GetTextComboValue_double(53587,0,"MaxToleranceVal"),this.oProduct.CreditDays=this.ScreenObject.GetTextComboValue_int(53588,0,"CreditDays"),this.oProduct.PreExpiryDays=this.ScreenObject.GetTextComboValue_int(53585,0,"PreexpiryDays");var t=this.ScreenObject.StaticFields.find(e=>26722==e.DBColumnID);this.oProduct.GroupSeqNoLength=null!=t&&null!=t&&this.oProduct.IsGroup?parseInt(t.Text):0,this.oProduct.LotWise=!1,this.oProduct.CustomFieldsQuery=this.ScreenObject.GetQuickExtraFieldsQuery(),this.oProduct.CustomCostCenterFieldsQuery=this.ScreenObject.GetQuickExtraCCFieldsQuery(),this.oProduct.ContactsXML="",this.oProduct.NotesXML="",this.GetAttachmentXML(),this.oProduct.AttachmetsXML+=this.ScreenObject.GetExtraAttachmentXML(),this.oProduct.ProductwiseUOM="",this.oProduct.ProductwiseUOM1="";let s={};if(this.DisplayMessage=this.QuickAssign.GetXML(s),!l.e.StringIsNullOrEmpty(this.DisplayMessage))return;if(this.oProduct.CCCCMapDATA=s.strXML,this.oProduct.HistoryXML=this.ScreenObject.HistoryCCXML,this.oProduct.StatusXML=null!=this.ScreenObject.StatusAssignGrid?this.ScreenObject.StatusAssignGrid.GetXML():"",!this.ScreenObject.ValidateDataonSave())return;this.oProduct.WID=this.ScreenObject.CheckWorkFlow(),this.oProduct.IsLink=this.ScreenObject.EvaluateExpression(this.ScreenObject.Data.Tables[10].filter(e=>"LinkDimensionBasedOn"==e.Name)[0].Value.toString(),this.oProduct.IsGroup),this.oProduct.AddProduct("","AddProduct").subscribe(e=>{this.SaveCallBack(e)},e=>{alert(JSON.stringify(e)),console.log("Quick Product Save : "+JSON.stringify(e))})}else{null!=this.Name&&(this.oProduct.ProductName=this.Name.Text.trim()),this.oProduct.AliasName=this.ScreenObject.GetTextComboValue_string(263,this.oProduct.ProductName),this.oProduct.ProductType=this.ScreenObject.GetTextComboValue_int(264,1),this.oProduct.ProductGroup=this.ScreenObject.GetPactListValue(281,this.ParentId),this.oProduct.QuickStaticFieldsQuery=this.ScreenObject.GetStaticFieldsQuery(),this.oProduct.CustomFieldsQuery=this.ScreenObject.GetQuickExtraFieldsQuery(),this.oProduct.CustomCostCenterFieldsQuery=this.ScreenObject.GetQuickExtraCCFieldsQuery();let e={};if(this.DisplayMessage=this.QuickAssign.GetXML(e),!l.e.StringIsNullOrEmpty(this.DisplayMessage))return;if(this.oProduct.CCCCMapDATA=e.strXML,this.oProduct.HistoryXML=this.ScreenObject.HistoryCCXML,this.oProduct.StatusXML=null!=this.ScreenObject.StatusAssignGrid?this.ScreenObject.StatusAssignGrid.GetXML():"",this.GetAttachmentXML(),this.oProduct.AttachmetsXML+=this.ScreenObject.GetExtraAttachmentXML(),!this.ScreenObject.ValidateDataonSave())return;this.oProduct.WID=this.ScreenObject.CheckWorkFlow(),this.oProduct.IsLink=this.ScreenObject.EvaluateExpression(this.ScreenObject.Data.Tables[10].filter(e=>"LinkDimensionBasedOn"==e.Name)[0].Value.toString(),this.oProduct.IsGroup),this.oProduct.AddProduct("","SetProductQuick").subscribe(e=>{this.SaveCallBack(e)},e=>{alert(JSON.stringify(e)),console.log("Quick Product Save : "+JSON.stringify(e))})}}else if("Details"==e.toString())c.a.page.ShowLoading=!0,setTimeout(()=>{c.a.page.HideDialog();let e="";e=c.a.GetResource(0==this.oProduct.ProductID?"Product_NewScreenName":"Product_EditScreenName");let t=new d.AddProductScreenViewModel(this.NodeID,this.ScreenName,this.ParentId,this.oProduct.IsGroup),o={obj:t};null!=this.Name&&(t.ProductName.Text=this.Name.Text),null!=this.Code&&(t.ProductCode.Text=this.Code.Text,t.ProductCode.PrefixCode=this.Code.PrefixCode),t.OnGroupSelectionChanged("Group"),t.ScreenObject.CopyQuickToDetail(this.ScreenObject.QuickAddFields,[null!=this.Code?this.Code.DBColumnID:0,null!=this.Name?this.Name.DBColumnID:0]),t.OnTypeChanged(),null!=t.DimFields&&t.DimFields.length>0&&(t.SetViewByType(),t.SetFieldsposition()),c.a.page.addNewTab({title:e,component:b.AddProductComponent,params:o})},50);else if("Cancel"==e.toString())c.a.page.HideDialog();else if("ShowApprove"==e.toString()){let e=new m.a(3,this.oProduct.ProductID,this.ScreenObject,this);c.a.page.ShowDialog(e,S.a,{ShowCenter:!0,Title:c.a.GetResource("ApproveReject")})}Logger.InfoLog("QuickAddProductViewModel::Exiting onSaveProduct")}catch(o){Logger.ErrorLog("QuickAddProductViewModel:: onSaveProduct"+o.stack)}}SaveCallBack(e){e.Message&&(this.MessageVisibility=!0,this.DisplayMessage=e.Message,this.RetValue=e.RetValue,(this.RetValue>0||this.RetValue<-1e4)&&(this.NodeID=0,this.oProduct.ProductID=0,this.QuickAssign.Clear(),this.ScreenObject.Clear(),null!=this.Code&&(this.Code.Text=""),this.Title=this.oProduct.IsGroup?"Add Group":c.a.GetResource("Product_QuickAdd"),this.AutoGenerateCode(),this.LoadParentData(),null==this.Parent||null==this.Parent?c.a.page.HideDialog():(null!=this.Parent.SelectedNode&&(this.Parent.obj.SetFocusNodeID=this.Parent.SelectedNode.Id),this.Parent.Refresh(),this.Parent.AddEditProductVisibility=!0)))}GetAttachmentXML(){this.InheritImage||!this.isPhotoChanged&&this.FileID>0?this.oProduct.AttachmetsXML="":(null!=this.ScreenObject.Data&&null!=this.ScreenObject.Data&&this.ScreenObject.Data.Tables.length>14&&(this.ImageView=this.ScreenObject.Data.Tables[14]),this.InheritGrpImage?this.ImageView=this.ImageView.filter(e=>3==e.FeatureID&&e.FeaturePK==this.oProduct.ProductGroup&&1==e.IsProductImage):this.InheritDimImageID>5e4&&(this.ImageView=this.ImageView.filter(e=>e.FeatureID==this.InheritDimImageID&&e.FeaturePK==this.GetImageCCVal()&&1==e.IsProductImage)),this.ImageView.length>0?l.e.GetPath(this.ImageView[0].GUID.toString()+"."+this.ImageView[0].FileExtension.toString()):this.oProduct.AttachmetsXML="")}GetImageCCVal(){return this.ScreenObject.StaticFields.forEach(e=>{if(e instanceof r.b&&e.DBColumnName.toUpperCase().startsWith("CCNID")&&e.CCID==this.InheritDimImageID)return e.SelectedValue}),0}OnNameLostFocus(e){if(!l.e.StringIsNullOrEmpty(this.Name.Text)){let e=c.a.accounting.CheckDuplicateName(3,this.NodeID,this.Name.Text,0,this.oProduct.IsGroup);e.length>0&&(this.DisplayMessage=e)}this.ScreenObject.onTextBoxLostFocus(e)}OnGroupSelectionChanged(e){this.ProductGroup.SelectedValue>0&&(this.ProductGroup.DefaultValue=this.ProductGroup.SelectedValue.toString(),this.AutoGenerateCode(),this.LoadParentData()),this.InheritGrpImage&&this.OnLoadImage("Group",this.ProductGroup.SelectedValue)}OnProductTypeChange(e){null!=this.ProductType&&this.ScreenObject.SetViewByType(this.ProductType.SelectedValue,this.oProduct.IsGroup)}ParentCallBack(e){null!=e.SelectedNode&&e.PickerType.startsWith("PRODUCTGROUPS")&&(this.ProductGroup.SelectedValue=e.SelectedNode.Id,this.ProductGroup.DefaultValue=this.ProductGroup.SelectedValue.toString())}AddCCFieldsSelectionChange(){this.ScreenObject.StaticFields.forEach(e=>{e instanceof r.b&&e.CCID==this.InheritDimImageID&&e.SelectionChangedCommand.Subscribe(this,"OnccChanged")})}OnccChanged(e){null!=e&&null!=e&&e instanceof r.b&&e.SelectedValue>1&&e.CCID==this.InheritDimImageID&&this.OnLoadImage("Dimension",e.SelectedValue)}LoadParentData(){if(this.ScreenObject.dsParentData=null,0!=this.NodeID||0==this.ParentId||this.oProduct.IsGroup)return;let e=this.ScreenObject.Data.Tables[10].filter(e=>"Copygroupdatatonode"==e.Name);0!=e.length&&l.e.StringIsNullOrEmpty(e[0].Value)&&Object(n.j)(e[0].Value)&&(this.ScreenObject.dsParentData=this.oProduct.GetCopyProductDetails(this.ParentId),0!=this.ScreenObject.dsParentData.Tables[0].length?this.ScreenObject.FillParentData(this.ScreenObject.dsParentData.Tables[0][0],this.ScreenObject.dsParentData.Tables[1][0],this.ScreenObject.dsParentData.Tables[7][0],["ProductCode","ProductName","ProductGroup"]):this.ScreenObject.dsParentData=null)}}}}]);
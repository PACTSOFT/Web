function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{"0LKI":function(e,t,i){"use strict";i.d(t,"b",(function(){return s})),i.d(t,"a",(function(){return h})),i.d(t,"c",(function(){return l}));var n,r=i("Do2H"),o=function(e){return e[e.None=0]="None",e[e.ExchangeParent=1]="ExchangeParent",e[e.ExchangeChild=2]="ExchangeChild",e[e.RemoveParent=3]="RemoveParent",e[e.RemoveChild=4]="RemoveChild",e[e.AddParent=5]="AddParent",e[e.AddChild=6]="AddChild",e[e.NewParent=7]="NewParent",e}({}),s=function(e){return e[e.None=0]="None",e[e.Parent=1]="Parent",e[e.Child=2]="Child",e[e.Self=3]="Self",e}({}),a=function(e){return e[e.None=0]="None",e[e.SubSet=1]="SubSet",e[e.SuperSet=2]="SuperSet",e[e.Intersect=3]="Intersect",e[e.Duplicate=4]="Duplicate",e[e.Independent=5]="Independent",e}({}),d=function(e){return e[e.None=0]="None",e[e.Immediate=1]="Immediate",e[e.Regular=2]="Regular",e[e.Independent=3]="Independent",e}({}),h=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";_classCallCheck(this,e),this.nDims=0,n.set(this,void 0),this.currBudgetTable=t,this.newBudgetRow=null,this.nDims=i,this.anyDefn=o.Trim(),this.processedDimRows=[],this.strDecimals="N"+r.a.SessionManager.Preferences.DecimalsinAmount}return _createClass(e,[{key:"setBudgetTable",value:function(e){this.currBudgetTable=e}},{key:"deleteBudgetDimRow",value:function(e,t,i){var n=0;if(this.newBudgetRow=e,e.getRowDim()!=this.nDims)return i.errMsg="Incorrect number of dimensions being added in the new row",1;try{if(0==this.currBudgetTable.length||null==this.newBudgetRow||0==this.nDims)n=0;else{var r={delRowId:0};if(!this.alreadyExistInBudgetTable(e,r))return i.errMsg="RowID : "+e.rowID+" not found!",2;for(var o=this.getDimensionRow(r.delRowId),s=[],h=[],l=0;l<o.childSet.length;l++){var u=parseInt(o.childSet[l]),w=this.getDimensionRow(u);s.push(u),this.removeParent(w,o,t)}for(var c=0;c<o.parentSet.length;c++){var g=parseInt(o.parentSet[c]),I=this.getDimensionRow(g);h.push(g),this.removeChild(o,I,t)}for(var m=0;m<s.length;m++)for(var R=0;R<h.length;R++){var D=parseInt(s[m]),p=parseInt(h[R]),f=this.getDimensionRow(D),v=this.getDimensionRow(p),S={sType:a.None,ssType:d.None};this.isDimRowSubset(f,v,S),S.sType==a.SubSet&&(this.addParent(f,v,t),this.addChild(f,v,t))}for(var y=0;y<this.currBudgetTable.length;y++)if(0==this.currBudgetTable[y].rowID){this.currBudgetTable.RemoveAt(y);break}}}catch(b){throw b}return n}},{key:"checkAddBudgetConflicts",value:function(e,t,i){var n=0;this.newBudgetRow=e;try{if(0==this.currBudgetTable.length||null==this.newBudgetRow||0==this.nDims)n=0;else if((n=this.getRowsToEvaluateFurther(t,i))>0)return n}catch(r){throw r}return n}},{key:"checkEditBudgetConflicts",value:function(e,t){try{if(0==this.currBudgetTable.length||null==e||0==this.nDims)return 0;var i=e,n=this.getDimensionRow(i.rowID),r={sType:a.None,ssType:d.None};if(this.newBudgetRow=e,this.isDimRowSubset(i,n,r),r.sType==a.Duplicate){if(i.amount==n.amount)return t.errMsg="No edits performed!!!",0;for(var o=0,s="",h=0;h<n.childSet.length;h++){var l=parseInt(n.childSet[h]);o+=this.getDimensionRow(l).amount,s+=l.toString()+", "}if(i.amount<o)return t.errMsg="Invalid budget edit between : "+i.rowID.toString()+" & RowId group "+s+". Changed amount shall be minimum "+o.toString(),1;for(var u=0;u<n.parentSet.length;u++){o=0,s="";for(var w=parseInt(n.parentSet[u]),c=this.getDimensionRow(w),g=0;g<c.childSet.length;g++){var I=parseInt(c.childSet[g]);o+=this.getDimensionRow(I).amount,s+=I.toString()+", "}if(c.amount<o)return t.errMsg="Invalid budget edit between : "+c.rowID.toString()+" & RowId group "+s+". Parent's amount shall be minimum "+o.toString(),2}}}catch(m){throw m}return 0}},{key:"checkBudgetTransUsage",value:function(e,t,i){var n=0;try{if(0==this.currBudgetTable.length||0==this.nDims)return n=1,i.errMsg="No budget defined to check validity of current transaction",n;if(e.getRowDim()!=this.nDims)return n=2,i.errMsg="Dimensions mis-match between input transaction and Budget Definition instance",n;n=this.getRelatedBudgetDefinitions(e,t,i),this.newBudgetRow=e}catch(r){throw r}return n}},{key:"updateDimsRowsWithNewRowId",value:function(e,t,i){var n=t.length;try{for(var r=e.rowID,s=0;s<n;s++){var a=t[s];if(a.isNewRowInvolved)switch(a.operation){case o.AddChild:var d=null;a.childRowId==r&&(this.getDimensionRow(r).rowID=i,a.childRowId=i),a.parentRowId==r?((d=this.getDimensionRow(r)).rowID=i,a.parentRowId=i):d=this.getDimensionRow(a.parentRowId);for(var h=0;h<d.childSet.length;h++)r==parseInt(d.childSet[h])&&(d.childSet[h]=i);break;case o.AddParent:var l=null;a.childRowId==r?((l=this.getDimensionRow(r)).rowID=i,a.childRowId=i):l=this.getDimensionRow(a.childRowId),a.parentRowId==r&&(this.getDimensionRow(r).rowID=i,a.parentRowId=i);for(var u=0;u<l.parentSet.length;u++)r==parseInt(l.parentSet[u])&&(l.parentSet[u]=i);break;case o.ExchangeChild:var w=null,c=null;a.currentDimRowId==r?((w=this.getDimensionRow(r)).rowID=i,a.currentDimRowId=i):w=this.getDimensionRow(a.currentDimRowId),a.oldChildRowId==r?(this.getDimensionRow(r).rowID=i,a.oldChildRowId=i):this.getDimensionRow(a.oldChildRowId),a.newChildRowId==r?((c=this.getDimensionRow(r)).rowID=i,a.newChildRowId=i):c=this.getDimensionRow(a.newChildRowId);for(var g=0;g<w.childSet.length;g++)r==parseInt(w.childSet[g])&&(w.childSet[g]=i);for(var I=0;I<c.childSet.length;I++)r==parseInt(c.childSet[I])&&(c.childSet[I]=i);break;case o.ExchangeParent:var m=null,R=null;a.currentDimRowId==r?((m=this.getDimensionRow(r)).rowID=i,a.currentDimRowId=i):m=this.getDimensionRow(a.currentDimRowId),a.oldParentRowId==r?(this.getDimensionRow(r).rowID=i,a.oldParentRowId=i):this.getDimensionRow(a.oldParentRowId),a.newParentRowId==r?((R=this.getDimensionRow(r)).rowID=i,a.newParentRowId=i):R=this.getDimensionRow(a.newParentRowId);for(var D=0;D<m.parentSet.length;D++)r==parseInt(m.parentSet[D])&&(m.parentSet[D]=i);for(var p=0;p<R.parentSet.length;p++)r==parseInt(R.parentSet[p])&&(R.parentSet[p]=i);break;case o.RemoveChild:case o.RemoveParent:a.childRowId==r&&(this.getDimensionRow(r).rowID=i,a.childRowId=i),a.parentRowId==r&&(this.getDimensionRow(r).rowID=i,a.parentRowId=i)}}}catch(f){throw f}return 0}},{key:"getTransactionLogSummary",value:function(e,t){for(var i=e.length,n="",r=0;r<i;r++){var s=e[r];switch(s.operation){case o.AddChild:n+="Added Child(RowID:"+s.childRowId.toString()+") to Parent(RowID:"+s.parentRowId.toString()+")\r\n";break;case o.AddParent:n+="Added Parent(RowID:"+s.parentRowId.toString()+") to Child(RowID:"+s.childRowId.toString()+")\r\n";break;case o.ExchangeChild:n+="Exchanged Child of DimRow(RowID:"+s.currentDimRowId.toString()+") - Old Child(RowID:",n+=s.oldChildRowId.toString()+") + New Child(RowID:"+s.newChildRowId.toString()+")\r\n";break;case o.ExchangeParent:n+="Exchanged Parent of DimRow(RowID:"+s.currentDimRowId.toString()+") - Old Parent(RowID:",n+=s.oldParentRowId.toString()+") + New Parent(RowID:"+s.newParentRowId.toString()+")\r\n";break;case o.RemoveChild:n+="Removed Child(RowID:"+s.childRowId.toString()+") from Parent(RowID:"+s.parentRowId.toString()+")\r\n";break;case o.RemoveParent:n+="Removed Parent(RowID:"+s.parentRowId.toString()+") from Child(RowID:"+s.childRowId.toString()+")\r\n"}}return t.strTransLog=n,!0}},{key:"checkTransValidity",value:function(e,t,i,n,o){var a=0;try{if(0==n.length)return a=1,0!=e||r.a.SessionManager.IsActionAssigned(101,"Dont Show Transactional Logs")?Logger.DebugLog("Budget : checkTransValidity : No dimension rows to check validity of current transaction"):o.errMsg="No dimension rows to check validity of current transaction\r\n",a;if(i.getRowDim()!=this.nDims)return a=2,o.errMsg="Dimensions mis-match between input transaction and Budget Definition instance\r\n",a;o.errMsg="",o.errMsgCmplt="";for(var d={errMsg:"",errMsgCmplt:""},h=0;h<n.length;h++){var l=n[h],u=this.getDimensionRow(l.childRowId),w=this.getDimensionRow(l.parentRowId);if(l.relation==s.Child||l.relation==s.Self){var c;(c=this.checkTransAmountValidity(w,u,l.relation,e,t,d))>0&&(o.errMsg+=d.errMsg,d.errMsg="",o.errMsgCmplt+=d.errMsgCmplt,d.errMsgCmplt="",a=c)}}}catch(g){throw g}return a}},{key:"rollbackChanges",value:function(e){this.rollbackTransactions(e)}},{key:"isDimRowProcessed",value:function(e){for(var t=0;t<this.processedDimRows.length;t++)if(e==parseInt(this.processedDimRows[t]))return!0;return!1}},{key:"clearProcessedDimRows",value:function(){this.processedDimRows.Clear()}},{key:"checkTransAmountValidity",value:function(e,t,i,n,r,o){var a=0;if(i==s.Self){for(var d=0;d<e.parentSet.length;d++){var h=parseInt(e.parentSet[d]),l=this.getDimensionRow(h),u=l.amount-l.budgetUsed;if(u<t.budgetUsed){var w={Msg:o.errMsg};this.ErrorMessage(n,r,t.budgetUsed,u,l.rowID,l.docSeqNo,w),o.errMsg=w.Msg,a=11}if((u=l.totalAmount-l.budgetUsed)<t.budgetUsed){var c={Msg:o.errMsgCmplt};this.ErrorMessage(n,r,t.budgetUsed,u,l.rowID,l.docSeqNo,c),o.errMsgCmplt=c.Msg,a=11}}var g=e.amount-e.budgetUsed;if(g<t.budgetUsed){var I={Msg:o.errMsg};this.ErrorMessage(n,r,t.budgetUsed,g,e.rowID,e.docSeqNo,I),o.errMsg=I.Msg,a=12}if((g=e.totalAmount-e.budgetUsed)<t.budgetUsed){var m={Msg:o.errMsgCmplt};this.ErrorMessage(n,r,t.budgetUsed,g,e.rowID,e.docSeqNo,m),o.errMsgCmplt=m.Msg,a=12}}else{var R=e.amount-e.budgetUsed;if(R<t.budgetUsed){var D={Msg:o.errMsg};this.ErrorMessage(n,r,t.budgetUsed,R,e.rowID,e.docSeqNo,D),o.errMsg=D.Msg,a=13}if((R=e.totalAmount-e.budgetUsed)<t.budgetUsed){var p={Msg:o.errMsgCmplt};this.ErrorMessage(n,r,t.budgetUsed,R,e.rowID,e.docSeqNo,p),o.errMsgCmplt=p.Msg,a=13}}return a}},{key:"ErrorMessage",value:function(e,t,i,n,r,o,s){1==e?s.Msg+=" Invalid Quantity "+this.GetNumberFormat(i)+". Quantity left to use is "+this.GetNumberFormat(n)+".":2==e?s.Msg+="Invalid Value "+this.GetNumberFormat(i)+". Value left to use is "+this.GetNumberFormat(n)+".":(3==t&&(s.Msg+=" Requested amount is exceeding monthly budget amount.\r\n"),s.Msg+=" Invalid Transaction Amount "+this.GetNumberFormat(i)+". Budget left to use is "+this.GetNumberFormat(n)+"."),s.Msg+="\r\nRefer RowId : "+r+" for budget definition",s.Msg+="\r\nRefer RowNo : "+o+"\r\n"}},{key:"checkAmountValidity",value:function(e,t,i){var n=0,r=0,o="";if(e.childSet.length>0)for(var s=0;s<e.childSet.length;s++){var a=parseInt(e.childSet[s]);o+=a.toString()+", ",r+=this.getDimensionRow(a).amount}return r+=t.amount,e.amount<r&&(n=1,i.errMsg=e.childSet.length>0?"Budget conflict between rowID : "+e.rowID.toString()+" and rowID group : "+o+t.rowID.toString()+". Budget should be atleast "+r.toString()+" !!!":"Budget conflict between rowID : "+e.rowID.toString()+" and rowID : "+t.rowID.toString()+". Budget should be atleast "+r.toString()+" !!!"),n}},{key:"isDimRowChild",value:function(e,t){if(t.childSet.length>0)for(var i=0;i<t.childSet.length;i++)if(e.rowID==t.childSet[i])return!0;return!1}},{key:"getDimensionRow",value:function(e){var t=!1,i=null;if(null!=this.newBudgetRow&&e==this.newBudgetRow.rowID)return i=this.newBudgetRow;for(var n=0;n<this.currBudgetTable.length;n++)if((i=this.currBudgetTable[n]).rowID==e){t=!0;break}return t||((i=new l).rowID=-1),i}},{key:"getDimensionRowId",value:function(e,t){for(var i=0;i<this.currBudgetTable.length;i++)if(this.currBudgetTable[i].rowID==e)return 0;return 1}},{key:"isDimRowSubset",value:function(e,t,i){var n=0,r=!1,o=0,s=0;i.sType=a.None,i.ssType=d.None;for(var h=0,l=0,u=0;u<this.nDims;u++){var w=e.row[u].toString().Trim(),c=t.row[u].toString().Trim();""==w&&(w=this.anyDefn),""==c&&(c=this.anyDefn),w!=this.anyDefn&&c!=this.anyDefn?(r=!1,w==c?o++:s++):(r=r&&!0,c==this.anyDefn?t.nAnysComputed||t.nAnys++:l++,w==this.anyDefn?e.nAnysComputed||e.nAnys++:h++)}return t.nAnysComputed||(t.nAnysComputed=!0),e.nAnysComputed||(e.nAnysComputed=!0),r?(n=0,i.sType=a.Independent,i.ssType=d.Independent):(0==o&&0==s&&(h>0&&l>0?(n=0,i.sType=a.Independent,i.ssType=d.None):(n=0,i.sType=a.None,i.ssType=d.None)),0==o&&s>0&&(n=0,i.sType=a.Independent,i.ssType=d.Independent),o>0&&s>0&&(n=0,i.sType=a.Intersect,i.ssType=d.None),o>0&&0==s&&(h>0&&l>0?(n=0,i.sType=a.Intersect,i.ssType=d.None):t.nAnys!=e.nAnys?(e.nAnys==t.nAnys+1&&(n=0,i.sType=a.SuperSet,i.ssType=d.Immediate),e.nAnys>t.nAnys+1&&(n=0,i.sType=a.SuperSet,i.ssType=d.Regular),e.nAnys+1==t.nAnys&&(n=0,i.sType=a.SubSet,i.ssType=d.Immediate),e.nAnys+1<t.nAnys&&(n=0,i.sType=a.SubSet,i.ssType=d.Regular)):t.nAnys+o==this.nDims?(n=0,i.sType=a.Duplicate,i.ssType=d.None):(n=0,i.sType=a.Intersect,i.ssType=d.None))),n}},{key:"addChild",value:function(e,t,i){t.addChild(e.rowID);var n=new u;n.operation=o.AddChild,n.childRowId=e.rowID,n.parentRowId=t.rowID,0!=t.rowID&&0!=e.rowID||(n.isNewRowInvolved=!0),i.push(n)}},{key:"addParent",value:function(e,t,i){e.addParent(t.rowID);var n=new u;n.operation=o.AddParent,n.childRowId=e.rowID,n.parentRowId=t.rowID,0!=t.rowID&&0!=e.rowID||(n.isNewRowInvolved=!0),i.push(n)}},{key:"removeChild",value:function(e,t,i){t.childSet.length>0&&t.childSet.Remove(e.rowID);var n=new u;n.operation=o.RemoveChild,n.childRowId=e.rowID,n.parentRowId=t.rowID,0==t.rowID&&(n.isNewRowInvolved=!0),i.push(n)}},{key:"removeParent",value:function(e,t,i){e.parentSet.length>0&&e.parentSet.Remove(t.rowID);var n=new u;n.operation=o.RemoveParent,n.childRowId=e.rowID,n.parentRowId=t.rowID,0==e.rowID&&(n.isNewRowInvolved=!0),i.push(n)}},{key:"exchangeParent",value:function(e,t,i,n){e.parentSet.length>0&&e.parentSet.Remove(t.rowID),e.addParent(i.rowID),i.addParent(t.rowID);var r=new u;r.operation=o.ExchangeParent,r.currentDimRowId=e.rowID,r.oldParentRowId=t.rowID,r.newParentRowId=i.rowID,0!=e.rowID&&0!=t.rowID&&0!=i.rowID||(r.isNewRowInvolved=!0),n.push(r)}},{key:"exchangeChild",value:function(e,t,i,n){e.childSet.length>0&&e.childSet.Remove(t.rowID),e.addChild(i.rowID),i.addChild(t.rowID);var r=new u;r.operation=o.ExchangeChild,r.currentDimRowId=e.rowID,r.oldChildRowId=t.rowID,r.newChildRowId=i.rowID,0!=e.rowID&&0!=t.rowID&&0!=i.rowID||(r.isNewRowInvolved=!0),n.push(r)}},{key:"existParent",value:function(e,t){for(var i=0;i<e.parentSet.length;i++)if(parseInt(e.parentSet[i])==t.rowID)return!0;return!1}},{key:"existChild",value:function(e,t){for(var i=0;i<t.childSet.length;i++)if(parseInt(t.childSet[i])==e.rowID)return!0;return!1}},{key:"isDuplicate",value:function(e,t){var i=!1,n={sType:a.None,ssType:d.None};return this.isDimRowSubset(e,t,n),n.sType==a.Duplicate&&(i=!0),i}},{key:"alreadyExistInBudgetTable",value:function(e,t){for(var i=0;i<this.currBudgetTable.length;i++){var n=this.currBudgetTable[i];if(e!=n&&this.isDuplicate(e,n))return t.delRowId=n.rowID,!0}return!1}},{key:"alreadyExchanged",value:function(e,t,i){return!(this.existParent(e,t)&&this.existChild(t,e)||!this.existParent(e,i)||!this.existChild(i,e))}},{key:"insertDimRowAsChild",value:function(e,t,i,n){for(var r=!1,o=0;o<e.childSet.length;o++){var s={sType:a.None,ssType:d.None},h=parseInt(e.childSet[o]),l=this.getDimensionRow(h);if(this.isDimRowSubset(t,l,s),this.isDimRowProcessed(h))r=s.sType==a.SubSet||s.sType==a.SuperSet;else switch(this.processedDimRows.push(l.rowID),s.sType){case a.SuperSet:if(s.sType==a.SuperSet){if(0!=this.checkAmountValidity(t,l,n))return!1;if(0!=this.checkAmountValidity(e,t,n))return!1;this.exchangeParent(l,e,t,i),this.exchangeChild(e,l,t,i),r=!0}break;case a.SubSet:if(s.ssType==d.Immediate){if(0!=this.checkAmountValidity(l,t,n))return!1;for(var u=0;u<t.parentSet.length;u++){var w=parseInt(t.parentSet[u]),c=this.getDimensionRow(w),g={sType:a.None,ssType:d.None};this.isDimRowSubset(l,c,g),g.sType==a.SubSet&&(this.removeChild(t,c,i),this.removeParent(t,c,i))}this.addParent(t,l,i),this.addChild(t,l,i),r=!0}if(s.ssType==d.Regular&&(!(r=this.insertDimRowAsChild(l,t,i,n))&&""==n.errMsg)){if(0!=this.checkAmountValidity(l,t,n))return!1;this.addParent(t,l,i),this.addChild(t,l,i),r=!0}break;default:r||(r=!1)}}return r}},{key:"insertDimRowAsParent",value:function(e,t,i,n){for(var r=!1,o=0;o<e.parentSet.length;o++){var s={sType:a.None,ssType:d.None},h=parseInt(e.parentSet[o]),l=this.getDimensionRow(h);if(this.isDimRowSubset(l,t,s),this.isDimRowProcessed(h))r=s.sType==a.SubSet||s.sType==a.SuperSet;else switch(this.processedDimRows.push(l.rowID),s.sType){case a.SuperSet:if(0!=this.checkAmountValidity(l,t,n))return!1;if(0!=this.checkAmountValidity(t,e,n))return!1;this.exchangeParent(e,l,t,i),this.exchangeChild(l,e,t,i),r=!0;break;case a.SubSet:if(s.ssType==d.Immediate){if(0!=this.checkAmountValidity(t,l,n))return!1;for(var u=0;u<l.parentSet.length;u++){var w=parseInt(l.parentSet[u]),c=this.getDimensionRow(w),g={sType:a.None,ssType:d.None};this.isDimRowSubset(t,c,g),g.sType==a.SubSet&&(this.removeChild(l,c,i),this.removeParent(l,c,i))}this.addParent(l,t,i),this.addChild(l,t,i),r=!0}if(s.ssType==d.Regular&&(!(r=this.insertDimRowAsParent(l,t,i,n))&&""==n.errMsg)){if(0!=this.checkAmountValidity(t,l,n))return!1;this.addParent(l,t,i),this.addChild(l,t,i),r=!0}break;default:r||(r=!1)}}return r}},{key:"getRowsToEvaluateFurther",value:function(e,t){var i=0,n=this.newBudgetRow;if(n.getRowDim()!=this.nDims)return t.errMsg="Incorrect number of dimensions being added in the new row",2;var r={delRowId:-1};if(this.alreadyExistInBudgetTable(n,r))return t.errMsg="DimensionRow already exist as RowId : "+r.delRowId.toString(),6;for(var o=0;o<this.currBudgetTable.length;o++){var s={sType:a.None,ssType:d.None},h=this.currBudgetTable[o];if(h.getRowDim()!=this.nDims)return t.errMsg="Incorrect number of dimensions in the budget table",3;if(!this.isDimRowProcessed(h.rowID))switch(this.processedDimRows.push(h.rowID),this.isDimRowSubset(n,h,s),s.sType){case a.SubSet:switch(s.ssType){case d.Immediate:for(var l={sType:a.None,ssType:d.None},u=null,w=0;w<h.childSet.length;w++){var c=parseInt(h.childSet[w]);if(u=this.getDimensionRow(c),this.processedDimRows.push(u.rowID),this.isDimRowSubset(u,n,l),l.sType==a.SubSet&&!this.isDimRowChild(u,n)){if(0!=(i=this.checkAmountValidity(n,u,t)))return i=6;this.exchangeParent(u,h,n,e),this.exchangeChild(h,u,n,e)}}if(!this.existChild(n,h)&&!this.existParent(n,h)){if(0!=(i=this.checkAmountValidity(h,n,t)))return i=7;this.addChild(n,h,e),this.addParent(n,h,e)}break;case d.Regular:if(h.childSet.length>0){var g=this.insertDimRowAsChild(h,n,e,t);if(!g&&""==t.errMsg&&!this.existChild(n,h)&&!this.existParent(n,h)){if(0!=(i=this.checkAmountValidity(h,n,t)))return i=8;this.addChild(n,h,e),this.addParent(n,h,e)}if(!g&&""!=t.errMsg)return i=9}else if(!this.isDimRowChild(n,h)){if(0!=(i=this.checkAmountValidity(h,n,t)))return i=10;this.addParent(n,h,e),this.addChild(n,h,e)}}break;case a.SuperSet:switch(s.ssType){case d.Immediate:for(var I={sType:a.None,ssType:d.None},m=null,R=0;R<h.parentSet.length;R++){var D=parseInt(h.parentSet[R]);if(m=this.getDimensionRow(D),this.processedDimRows.push(m.rowID),this.isDimRowSubset(m,n,I),I.sType==a.SuperSet&&!this.isDimRowChild(n,m)){if(0!=(i=this.checkAmountValidity(m,n,t)))return i=11;this.exchangeChild(m,h,n,e),this.exchangeParent(h,m,n,e)}}if(!this.existChild(h,n)&&!this.existParent(h,n)){if(0!=(i=this.checkAmountValidity(n,h,t)))return i=11;this.addChild(h,n,e),this.addParent(h,n,e)}break;case d.Regular:if(h.parentSet.length>0){var p=this.insertDimRowAsParent(h,n,e,t);if(!p&&""==t.errMsg&&!this.existChild(h,n)&&!this.existParent(h,n)){if(0!=(i=this.checkAmountValidity(n,h,t)))return i=13;this.addChild(h,n,e),this.addParent(h,n,e)}if(!p&&""!=t.errMsg)return i=14}else if(!this.isDimRowChild(h,n)){if(0!=(i=this.checkAmountValidity(n,h,t)))return i=15;this.addParent(h,n,e),this.addChild(h,n,e)}}break;case a.Independent:case a.Intersect:break;case a.Duplicate:return t.errMsg="Duplicate rows. RowID : "+n.rowID.toString()+" & RowID : "+h.rowID.toString(),4;case a.None:return t.errMsg="Cannot evaluate dimension rows! RowID : "+n.rowID.toString()+" & RowID : "+h.rowID.toString(),5}}return this.clearProcessedDimRows(),i}},{key:"addDimRowAction",value:function(e,t){for(var i=!1,n=0;n<t.length;n++)if(t[n].isEqual(e)){i=!0;break}i||t.push(e)}},{key:"getRelatedBudgetDefinitions",value:function(e,t,i){if(this.clearProcessedDimRows(),null!=Logger.logLevel&&Logger.logLevel.Contains("BUDGET")){var n="";n+="<Buget>",n+='<Input amt="'+e.amount+'" d="';for(var r=0;r<e.row.length;r++)n+=","+e.row[r].toString();n+='" />';for(var o=0;o<this.currBudgetTable.length;o++){n+='<r amt="'+this.currBudgetTable[o].amount+'" d="';for(var h=0;h<this.currBudgetTable[o].row.length;h++)n+=","+this.currBudgetTable[o].row[h].toString();n+='" />'}n+="</Buget>",Logger.DebugLog("Buget XML: "+n.toString())}for(var l=0;l<this.currBudgetTable.length;l++){var w={sType:a.None,ssType:d.None},c=this.currBudgetTable[l];this.isDimRowSubset(e,c,w);var g=new u;if(!this.isDimRowProcessed(c.rowID))if(this.processedDimRows.push(c.rowID),w.sType==a.Duplicate)g.relation=s.Self,g.parentRowId=c.rowID,g.childRowId=e.rowID,this.addDimRowAction(g,t);else if(w.sType==a.SubSet&&w.ssType==d.Immediate)g.relation=s.Child,g.parentRowId=c.rowID,g.childRowId=e.rowID,this.addDimRowAction(g,t);else if(w.sType==a.SuperSet&&w.ssType==d.Immediate)g.relation=s.Parent,g.parentRowId=e.rowID,g.childRowId=c.rowID,this.addDimRowAction(g,t);else if(w.sType==a.SubSet||w.sType==a.SuperSet){for(var I=-1,m=!0,R=c,D=w.sType;m;){I=R.rowID;var p=void 0,f=null;for(w.sType==a.SubSet&&(f=R.childSet),w.sType==a.SuperSet&&(f=R.parentSet),p=0;p<f.length;p++){var v=parseInt(f[p]);if(R=this.getDimensionRow(v),this.isDimRowSubset(e,R,w),w.sType==a.SubSet||w.sType==a.SuperSet){D=w.sType,I=R.rowID,w.ssType==d.Immediate&&(m=!1);break}}if(p>=f.length)break}D==a.SubSet&&(g.relation=s.Child,g.parentRowId=I,g.childRowId=e.rowID,this.addDimRowAction(g,t)),w.sType==a.SuperSet&&(g.relation=s.Parent,g.parentRowId=e.rowID,g.childRowId=I,this.addDimRowAction(g,t))}}return this.clearProcessedDimRows(),0}},{key:"rollbackTransactions",value:function(e){var t=e.length,i=[],n=null,r=null,s=null,a=null,d=null,h=null,l=null;try{for(var u=t;u>0;u--){var w=e[u-1];switch(w.operation){case o.AddChild:n=this.getDimensionRow(w.childRowId),r=this.getDimensionRow(w.parentRowId),this.removeChild(n,r,i);break;case o.AddParent:n=this.getDimensionRow(w.childRowId),r=this.getDimensionRow(w.parentRowId),this.removeParent(n,r,i);break;case o.RemoveChild:n=this.getDimensionRow(w.childRowId),r=this.getDimensionRow(w.parentRowId),this.addChild(n,r,i);break;case o.RemoveParent:n=this.getDimensionRow(w.childRowId),r=this.getDimensionRow(w.parentRowId),this.addParent(n,r,i);break;case o.ExchangeChild:s=this.getDimensionRow(w.oldChildRowId),a=this.getDimensionRow(w.newChildRowId),l=this.getDimensionRow(w.currentDimRowId),this.exchangeChild(l,a,s,i);break;case o.ExchangeParent:d=this.getDimensionRow(w.oldParentRowId),h=this.getDimensionRow(w.newParentRowId),l=this.getDimensionRow(w.currentDimRowId),this.exchangeParent(l,h,d,i)}}}catch(c){throw c}}},{key:"GetNumberFormat",value:function(e){return e.ToString(this.strDecimals)}}]),e}();n=new WeakMap;var l=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;_classCallCheck(this,e),this.rowID=0,this.docSeqNo=0,this.amount=0,this.totalAmount=0,this.budgetUsed=0,this.nAnys=0,this.nAnysComputed=!1,this.dbCalled=!1,this.row=[],this.nAnys=0,this.rowID=t,this.docSeqNo=0,this.linkedDimRows=i,this.tempLinkedDimRows=-1,this.nAnysComputed=!1,this.budgetUsed=0,this.parentRowID=-1,this.childSet=[],this.parentSet=[]}return _createClass(e,[{key:"DimensionRow_1",value:function(e){this.rowID=e.rowID,this.docSeqNo=e.docSeqNo,this.amount=e.amount,this.totalAmount=e.totalAmount,this.budgetUsed=e.budgetUsed,this.nAnys=e.nAnys,this.nAnysComputed=e.nAnysComputed,this.CF=e.CF;for(var t=0;t<e.row.length;t++)this.row.push(e.row[t]);for(var i=0;i<e.childSet.length;i++)this.childSet.push(e.childSet[i]);for(var n=0;n<e.parentSet.length;n++)this.parentSet.push(e.parentSet[n])}},{key:"addDimValue",value:function(e){this.row.push(e)}},{key:"addChild",value:function(e){for(var t=!1,i=0;i<this.childSet.length;i++)if(e==this.childSet[i]){t=!0;break}t||this.childSet.push(e)}},{key:"addParent",value:function(e){for(var t=!1,i=0;i<this.parentSet.length;i++)if(e==this.parentSet[i]){t=!0;break}t||this.parentSet.push(e)}},{key:"getRowDim",value:function(){return this.row.length}}]),e}(),u=function(){function e(){_classCallCheck(this,e),this.isNewRowInvolved=!1,this.currentDimRowId=0,this.oldParentRowId=0,this.newParentRowId=0,this.oldChildRowId=0,this.newChildRowId=0,this.childRowId=0,this.parentRowId=0}return _createClass(e,[{key:"DimensionRowAction",value:function(){this.operation=o.None,this.relation=s.None,this.currentDimRowId=-1,this.oldParentRowId=-1,this.newParentRowId=-1,this.oldChildRowId=-1,this.newChildRowId=-1,this.childRowId=-1,this.parentRowId=-1,this.isNewRowInvolved=!1}},{key:"isEqual",value:function(e){var t=!1;return this.operation==e.operation&&this.relation==e.relation&&this.currentDimRowId==e.currentDimRowId&&this.isNewRowInvolved==e.isNewRowInvolved&&this.oldParentRowId==e.oldParentRowId&&this.newParentRowId==e.newParentRowId&&this.oldChildRowId==e.oldChildRowId&&this.newChildRowId==e.newChildRowId&&this.childRowId==e.childRowId&&this.parentRowId==e.parentRowId&&(t=!0),t}}]),e}()}}]);